cscope 15 $HOME/AntWork/odbc_dev/libobclient/obclient -q 0000009653 0002051110
	@client/ma_plugin_info.c

2 
	~<my_glob®.h
>

3 
	~<my_sys.h
>

4 
	~<mysql.h
>

5 
	~<mysql/þ›Á_¶ugš.h
>

6 
	~<g‘Ýt.h
>

7 
	~<¡dio.h
>

8 
	~<my_dœ.h
>

9 
	~<ma_¡ršg.h
>

11 
	#CLIENT_PLUGIN_INFO_VERSION
 "1.0.0"

	)

13 
ÝtiÚ
 
	glÚg_ÝtiÚs
[]=

15 {"®l", 
no_¬gum’t
, 0, 'a'},

16 {"bužtš", 
no_¬gum’t
, 0, 'b'},

17 {"dyÇmic", 
no_¬gum’t
, 0, 'd'},

20 {"v”siÚ", 
no_¬gum’t
, 0, 'v'},

21 {"h–p", 
no_¬gum’t
, 0, '?'},

22 {
NULL
, 0, 0, 0}

25 *
	gv®ues
[] =

34 
NULL


37 
	s¡_¶ugš_ty³


39 
	mty³
;

40 *
	mty³Çme
;

43 #iâdeà
_WIN32


44 
	gmy_”ºo
=0;

47 
¡_¶ugš_ty³
 
	g¶ugš_ty³s
[]=

49 {
MYSQL_CLIENT_AUTHENTICATION_PLUGIN
, "authentication"},

50 {
MARIADB_CLIENT_PVIO_PLUGIN
, "virtual IO"},

51 {
MARIADB_CLIENT_TRACE_PLUGIN
, "trace"},

52 {
MARIADB_CLIENT_REMOTEIO_PLUGIN
, "remote file‡ccess"},

53 {
MARIADB_CLIENT_CONNECTION_PLUGIN
, "connection handler"},

57 
	$v”siÚ
()

59 
	`´štf
("% V”siÚ %s\n", 
ma_´ogÇme
, 
CLIENT_PLUGIN_INFO_VERSION
);

60 
	}
}

62 
	$u§ge
()

64 
i
=0;

65 
	`´štf
("% V”siÚ %s\n", 
ma_´ogÇme
, 
CLIENT_PLUGIN_INFO_VERSION
);

66 
	`puts
("Copyright 2015 MariaDB Corporation AB");

67 
	`puts
("Show client…lugin information for MariaDB Connector/C.");

68 
	`´štf
("U§ge: % [OPTIONS] [¶ugš_Çme]\n", 
ma_´ogÇme
);

69 
lÚg_ÝtiÚs
[
i
].
Çme
)

71 
	`´štf
(" --%-12 -%s\n", 
lÚg_ÝtiÚs
[
i
].
Çme
, 
v®ues
[i]);

72 
i
++;

74 
	}
}

76 *
	$ma_g‘_ty³_Çme
(
ty³
)

78 
i
=0;

79 
¶ugš_ty³s
[
i
].
ty³
)

81 ià(
ty³
=ð
¶ugš_ty³s
[
i
].type)

82  
¶ugš_ty³s
[
i
].
ty³Çme
;

83 
i
++;

85  
¶ugš_ty³s
[
i
].
ty³Çme
;

86 
	}
}

88 
	$show_¶ugš_šfo
(
¡_mysql_þ›Á_¶ugš
 *
¶ugš
, 
my_boÞ
 
bužtš
)

90 
	`´štf
("Name: %s\n", 
¶ugš
->
Çme
);

91 
	`´štf
("Ty³: %s\n", 
	`ma_g‘_ty³_Çme
(
¶ugš
->
ty³
));

92 
	`´štf
("Desc: %s\n", 
¶ugš
->
desc
);

93 
	`´štf
("AuthÜ: %s\n", 
¶ugš
->
authÜ
);

94 
	`´štf
("Liûn£: %s\n", 
¶ugš
->
liûn£
);

95 
	`´štf
("V”siÚ: %d.%d.%d\n", 
¶ugš
->
v”siÚ
[0],…lugin->version[1],…lugin->version[2]);

96 
	`´štf
("API V”siÚ: 0x%04X\n", 
¶ugš
->
š‹rçû_v”siÚ
);

97 
	`´štf
("Buždy³: %s\n", 
bužtš
 ? "builtin" : "dynamic");

98 
	`´štf
("\n");

99 
	}
}

101 
	$show_bužtš
()

103 
¡_mysql_þ›Á_¶ugš
 **
bužtš
;

105 
bužtš
ð
mysql_þ›Á_bužtšs
; *builtin; builtin++)

106 
	`show_¶ugš_šfo
(*
bužtš
, 
TRUE
);

107 
	}
}

109 
	$show_fže
(*
fž’ame
)

111 
dÍ©h
[
FN_REFLEN
+1];

112 *
sym
, *
dlhªdË
;

113 
¡_mysql_þ›Á_¶ugš
 *
¶ugš
;

114 *
’v_¶ugš_dœ
ð
	`g‘’v
("MARIADB_PLUGIN_DIR");

115 *
has_so_ext
ð
	`¡r¡r
(
fž’ame
, 
SO_EXT
);

117 ià(!
	`¡rchr
(
fž’ame
, 
FN_LIBCHAR
))

118 
	`¢´štf
(
dÍ©h
, (dlpath) - 1, "%s/%s%s",

119 (
’v_¶ugš_dœ
è?ƒnv_¶ugš_dœ : 
PLUGINDIR
,

120 
fž’ame
,

121 
has_so_ext
 ? "" : 
SO_EXT
);

123 
	`¡rýy
(
dÍ©h
, 
fž’ame
);

124 ià((
dlhªdË
ð
	`dlÝ’
((cÚ¡ *)
dÍ©h
, 
RTLD_NOW
)))

126 ià(
sym
ð
	`dlsym
(
dlhªdË
, 
¶ugš_deþ¬©iÚs_sym
))

128 
¶ugš
ð(
¡_mysql_þ›Á_¶ugš
 *)
sym
;

129 
	`show_¶ugš_šfo
(
¶ugš
, 0);

131 
	`dlþo£
(
dlhªdË
);

133 
	}
}

135 
	$show_dyÇmic
(cÚ¡ *
dœeùÜy
)

137 
MY_DIR
 *
dœ
ð
NULL
;

138 
i
;

139 *
¶ugš_dœ
ð
dœeùÜy
 ? (*)dœeùÜy : 
	`g‘’v
("MARIADB_PLUGIN_DIR");

141 ià(!
¶ugš_dœ
)

142 
¶ugš_dœ
ð
PLUGINDIR
;

144 
	`´štf
("¶ugš_dœ %s\n", 
¶ugš_dœ
);

146 
dœ
ð
	`my_dœ
(
¶ugš_dœ
, 0);

148 ià(!
dœ
 || !dœ->
numb”_off_fžes
)

150 
	`´štf
("NØ¶ugš found iÀ%s\n", 
¶ugš_dœ
);

151 
’d
;

154 
i
=0; i < 
dœ
->
numb”_off_fžes
; i++)

156 *
p
ð
	`¡r¡r
(
dœ
->
dœ_’Œy
[
i
].
Çme
, 
SO_EXT
);

157 ià(
p
)

158 
	`show_fže
(
dœ
->
dœ_’Œy
[
i
].
Çme
);

160 
’d
:

161 ià(
dœ
)

162 
	`my_dœ’d
(
dœ
);

163 
	}
}

165 
	$maš
(
¬gc
, *
¬gv
[])

167 
ÝtiÚ_šdex
= 0;

168 
c
;

169 
ma_´ogÇme
ð
¬gv
[0];

171 
	`mysql_£rv”_š™
(0, 
NULL
, NULL);

173 ià(
¬gc
 <= 1)

175 
	`u§ge
();

176 
	`ex™
(1);

179 
c
ð
	`g‘Ýt_lÚg
(
¬gc
, 
¬gv
, "bd­nvh?", 
lÚg_ÝtiÚs
, &
ÝtiÚ_šdex
);

181 
c
) {

183 
	`show_bužtš
();

184 
	`show_dyÇmic
(
NULL
);

187 
	`show_bužtš
();

190 
	`show_dyÇmic
(
NULL
);

193 
	`v”siÚ
();

196 ià(
¬gc
 > 2)

197 
	`show_fže
(
¬gv
[2]);

200 ià(
¬gc
 > 2)

201 
	`show_dyÇmic
(
¬gv
[2]);

204 
	`u§ge
();

207 
	`´štf
("uÄecocognized o±iÚ: %s", 
¬gv
[1]);

208 
	`ex™
(1);

210 
	`ex™
(0);

211 
	}
}

	@cmake/libressl_version.c

1 
	~<Ý’s¦/Ý’s¦v.h
>

2 
	~<¡dio.h
>

4 
	$maš
()

6 
	`´štf
("%s", 
LIBRESSL_VERSION_TEXT
);

7 
	}
}

	@include/errmsg.h

21 #iâdeà
_”rmsg_h_


22 
	#_”rmsg_h_


	)

24 #ifdef 
__ýlu¥lus


27 
š™_þ›Á_”rs
();

28 cÚ¡ *
þ›Á_”rÜs
[];

29 cÚ¡ *
m¬Ÿdb_þ›Á_”rÜs
[];

30 #ifdef 
__ýlu¥lus


36 
	#CR_MIN_ERROR
 2000

	)

37 
	#CR_MAX_ERROR
 2999

	)

38 
	#CER_MIN_ERROR
 5000

	)

39 
	#CER_MAX_ERROR
 5999

	)

40 
	#CER
(
X
è
m¬Ÿdb_þ›Á_”rÜs
[(X)-
CER_MIN_ERROR
]

	)

41 
	#ER
(
X
è
þ›Á_”rÜs
[(X)-
CR_MIN_ERROR
]

	)

42 
	#CLIENT_ERRMAP
 2

	)

44 
	#CR_UNKNOWN_ERROR
 2000

	)

45 
	#CR_SOCKET_CREATE_ERROR
 2001

	)

46 
	#CR_CONNECTION_ERROR
 2002

	)

47 
	#CR_CONN_HOST_ERROR
 2003

	)

48 
	#CR_IPSOCK_ERROR
 2004

	)

49 
	#CR_UNKNOWN_HOST
 2005

	)

50 
	#CR_SERVER_GONE_ERROR
 2006

	)

51 
	#CR_VERSION_ERROR
 2007

	)

52 
	#CR_OUT_OF_MEMORY
 2008

	)

53 
	#CR_WRONG_HOST_INFO
 2009

	)

54 
	#CR_LOCALHOST_CONNECTION
 2010

	)

55 
	#CR_TCP_CONNECTION
 2011

	)

56 
	#CR_SERVER_HANDSHAKE_ERR
 2012

	)

57 
	#CR_SERVER_LOST
 2013

	)

58 
	#CR_COMMANDS_OUT_OF_SYNC
 2014

	)

59 
	#CR_NAMEDPIPE_CONNECTION
 2015

	)

60 
	#CR_NAMEDPIPEWAIT_ERROR
 2016

	)

61 
	#CR_NAMEDPIPEOPEN_ERROR
 2017

	)

62 
	#CR_NAMEDPIPESETSTATE_ERROR
 2018

	)

63 
	#CR_CANT_READ_CHARSET
 2019

	)

64 
	#CR_NET_PACKET_TOO_LARGE
 2020

	)

65 
	#CR_SSL_CONNECTION_ERROR
 2026

	)

66 
	#CR_MALFORMED_PACKET
 2027

	)

67 
	#CR_NO_PREPARE_STMT
 2030

	)

68 
	#CR_PARAMS_NOT_BOUND
 2031

	)

69 
	#CR_INVALID_PARAMETER_NO
 2034

	)

70 
	#CR_INVALID_BUFFER_USE
 2035

	)

71 
	#CR_UNSUPPORTED_PARAM_TYPE
 2036

	)

73 
	#CR_SHARED_MEMORY_CONNECTION
 2037

	)

74 
	#CR_SHARED_MEMORY_CONNECT_ERROR
 2038

	)

76 
	#CR_CONN_UNKNOWN_PROTOCOL
 2047

	)

77 
	#CR_SECURE_AUTH
 2049

	)

78 
	#CR_NO_DATA
 2051

	)

79 
	#CR_NO_STMT_METADATA
 2052

	)

80 
	#CR_NOT_IMPLEMENTED
 2054

	)

81 
	#CR_SERVER_LOST_EXTENDED
 2055

	)

82 
	#CR_STMT_CLOSED
 2056

	)

83 
	#CR_NEW_STMT_METADATA
 2057

	)

84 
	#CR_ALREADY_CONNECTED
 2058

	)

85 
	#CR_AUTH_PLUGIN_CANNOT_LOAD
 2059

	)

86 
	#CR_DUPLICATE_CONNECTION_ATTR
 2060

	)

87 
	#CR_AUTH_PLUGIN_ERR
 2061

	)

90 
	#CR_MYSQL_LAST_ERROR
 
CR_AUTH_PLUGIN_ERR


	)

95 
	#CR_EVENT_CREATE_FAILED
 5000

	)

96 
	#CR_BIND_ADDR_FAILED
 5001

	)

97 
	#CR_ASYNC_NOT_SUPPORTED
 5002

	)

98 
	#CR_FUNCTION_NOT_SUPPORTED
 5003

	)

99 
	#CR_FILE_NOT_FOUND
 5004

	)

100 
	#CR_FILE_READ
 5005

	)

101 
	#CR_BULK_WITHOUT_PARAMETERS
 5006

	)

102 
	#CR_INVALID_STMT
 5007

	)

103 
	#CR_VERSION_MISMATCH
 5008

	)

106 
	#CR_MARIADB_LAST_ERROR
 
CR_VERSION_MISMATCH


	)

	@include/ma_common.h

20 #iâdeà
_ma_commÚ_h


21 
	#_ma_commÚ_h


	)

23 
	~<mysql.h
>

24 
	~<ma_hash.h
>

26 
	e’um_muÉi_¡©us
 {

27 
	mCOM_MULTI_OFF
= 0,

28 
	mCOM_MULTI_CANCEL
,

29 
	mCOM_MULTI_ENABLED
,

30 
	mCOM_MULTI_DISABLED
,

31 
	mCOM_MULTI_END


36 
	mALWAYS_ACCEPT
,

37 
	mWAIT_FOR_QUERY
,

38 
	mACCEPT_FILE_REQUEST


39 } 
	tauto_loÿl_šfže_¡©e
;

41 
	s¡_m¬Ÿdb_db_driv”


43 
¡_m¬Ÿdb_þ›Á_¶ugš_DB
 *
	m¶ugš
;

44 *
	mÇme
;

45 *
	mbufãr
;

46 } 
	tMARIADB_DB_DRIVER
;

48 
	gmysql_async_cÚ‹xt
;

50 
	s¡_mysql_ÝtiÚs_ex‹nsiÚ
 {

51 *
	m¶ugš_dœ
;

52 *
	mdeçuÉ_auth
;

53 *
	ms¦_ül
;

54 *
	ms¦_üÍ©h
;

55 *
	m£rv”_public_key_·th
;

56 
mysql_async_cÚ‹xt
 *
	masync_cÚ‹xt
;

57 
HASH
 
	mcÚÃù_©Œs
;

58 
size_t
 
	mcÚÃù_©Œs_Ën
;

59 (*
	m»pÜt_´og»ss
)(cÚ¡ 
MYSQL
 *
	mmysql
,

60 
	m¡age
,

61 
	mmax_¡age
,

62 
	m´og»ss
,

63 cÚ¡ *
	m´oc_šfo
,

64 
	m´oc_šfo_Ëngth
);

65 
MARIADB_DB_DRIVER
 *
	mdb_driv”
;

66 *
	mŽs_å
;

67 *
	mŽs_å_li¡
;

68 *
	mŽs_pw
;

69 
my_boÞ
 
	mmuÉi_commªd
;

71 *
	mu¾
;

72 
	mŽs_ch”_¡»ngth
;

73 *
	mŽs_v”siÚ
;

74 
my_boÞ
 
	m»ad_Úly
;

75 *
	mcÚÃùiÚ_hªdËr
;

76 
my_boÞ
 (*
£t_ÝtiÚ
)(
MYSQL
 *
	mmysql
, cÚ¡ *
	mcÚfig_ÝtiÚ
, cÚ¡ *
	mcÚfig_v®ue
);

77 
HASH
 
	mu£rd©a
;

78 *
	m£rv”_public_key
;

79 *
	m´oxy_h—d”
;

80 
size_t
 
	m´oxy_h—d”_Ën
;

81 (*
	mio_wa™
)(
my_sock‘
 
	mhªdË
, 
my_boÞ
 
	mis_»ad
, 
	mtimeout
);

84 
	s¡_cÚÃùiÚ_hªdËr


86 
¡_ma_cÚÃùiÚ_¶ugš
 *
	m¶ugš
;

87 *
	md©a
;

88 
my_boÞ
 
	maùive
;

89 
my_boÞ
 
	mä“_d©a
;

90 } 
	tMA_CONNECTION_HANDLER
;

92 
	s¡_m¬Ÿdb_Ãt_ex‹nsiÚ
 {

93 
’um_muÉi_¡©us
 
	mmuÉi_¡©us
;

94 
	mex‹nded_”ºo
;

97 
	s¡_m¬Ÿdb_£ssiÚ_¡©e


99 
LIST
 *
	mli¡
,

100 *
	mcu¼’t
;

103 
	s¡_m¬Ÿdb_ex‹nsiÚ
 {

104 
MA_CONNECTION_HANDLER
 *
	mcÚn_hdÌ
;

105 
¡_m¬Ÿdb_£ssiÚ_¡©e
 
	m£ssiÚ_¡©e
[
SESSION_TRACK_TYPES
];

106 
	mm¬Ÿdb_þ›Á_æag
;

107 
	mm¬Ÿdb_£rv”_ÿ·bž™›s
;

108 
my_boÞ
 
	mauto_loÿl_šfže
;

111 
	#OPT_EXT_VAL
(
a
,
key
) \

112 (((
a
)->
ÝtiÚs
.
ex‹nsiÚ
 && (a)->ÝtiÚs.ex‹nsiÚ->
key
) ?\

113 (
a
)->
ÝtiÚs
.
ex‹nsiÚ
->
key
 : 0)

	)

118 
	s¡_m¬Ÿdb_f›ld_ex‹nsiÚ


120 
MARIADB_CONST_STRING
 
	mm‘ad©a
[
MARIADB_FIELD_ATTR_LAST
+1];

121 } 
	tMA_FIELD_EXTENSION
;

	@include/ma_context.h

28 #ifdeà
_WIN32


29 
	#MY_CONTEXT_USE_WIN32_FIBERS
 1

	)

30 #–ià
defšed
(
__GNUC__
è&& __GNUC__ >ð3 && defšed(
__x86_64__
è&& !defšed(
__ILP32__
)

31 
	#MY_CONTEXT_USE_X86_64_GCC_ASM


	)

32 #–ià
defšed
(
__GNUC__
è&& __GNUC__ >ð3 && defšed(
__i386__
)

33 
	#MY_CONTEXT_USE_I386_GCC_ASM


	)

34 #–ià
defšed
(
HAVE_UCONTEXT_H
)

35 
	#MY_CONTEXT_USE_UCONTEXT


	)

37 
	#MY_CONTEXT_DISABLE


	)

40 #ifdeà
MY_CONTEXT_USE_WIN32_FIBERS


41 
	smy_cÚ‹xt
 {

42 (*
	mu£r_func
)(*);

43 *
	mu£r_¬g
;

44 *
	m­p_fib”
;

45 *
	mlib_fib”
;

46 
	m»tuº_v®ue
;

47 #iâdeà
DBUG_OFF


48 *
	mdbug_¡©e
;

54 #ifdeà
MY_CONTEXT_USE_UCONTEXT


55 #ià
defšed
(
__APPLE__
è&& !defšed(
_XOPEN_SOURCE
)

56 
	#_XOPEN_SOURCE
 600

	)

58 
	~<ucÚ‹xt.h
>

60 
	smy_cÚ‹xt
 {

61 (*
	mu£r_func
)(*);

62 *
	mu£r_d©a
;

63 *
	m¡ack
;

64 
size_t
 
	m¡ack_size
;

65 
ucÚ‹xt_t
 
	mba£_cÚ‹xt
;

66 
ucÚ‹xt_t
 
	m¥awÃd_cÚ‹xt
;

67 
	maùive
;

68 #ifdeà
HAVE_VALGRIND


69 
	mv®gršd_¡ack_id
;

71 #iâdeà
DBUG_OFF


72 *
	mdbug_¡©e
;

78 #ifdeà
MY_CONTEXT_USE_X86_64_GCC_ASM


79 
	~<¡dšt.h
>

81 
	smy_cÚ‹xt
 {

82 
ušt64_t
 
	m§ve
[9];

83 *
	m¡ack_tÝ
;

84 *
	m¡ack_bÙ
;

85 #ifdeà
HAVE_VALGRIND


86 
	mv®gršd_¡ack_id
;

88 #iâdeà
DBUG_OFF


89 *
	mdbug_¡©e
;

95 #ifdeà
MY_CONTEXT_USE_I386_GCC_ASM


96 
	~<¡dšt.h
>

98 
	smy_cÚ‹xt
 {

99 
ušt64_t
 
	m§ve
[7];

100 *
	m¡ack_tÝ
;

101 *
	m¡ack_bÙ
;

102 #ifdeà
HAVE_VALGRIND


103 
	mv®gršd_¡ack_id
;

105 #iâdeà
DBUG_OFF


106 *
	mdbug_¡©e
;

112 #ifdeà
MY_CONTEXT_DISABLE


113 
	smy_cÚ‹xt
 {

114 
	mdummy
;

122 
my_cÚ‹xt_š™
(
my_cÚ‹xt
 *
c
, 
size_t
 
¡ack_size
);

125 
my_cÚ‹xt_de¡roy
(
my_cÚ‹xt
 *
c
);

143 
my_cÚ‹xt_¥awn
(
my_cÚ‹xt
 *
c
, (*
f
)(*), *
d
);

155 
	`my_cÚ‹xt_y›ld
(
my_cÚ‹xt
 *
c
);

169 
	`my_cÚ‹xt_cÚtšue
(
my_cÚ‹xt
 *
c
);

171 
¡_ma_pvio
;

173 
	smysql_async_cÚ‹xt
 {

178 
ev’ts_to_wa™_fÜ
;

184 
ev’ts_occu»d
;

191 *
r_±r
;

192 cÚ¡ *
r_cÚ¡_±r
;

193 
r_št
;

194 
my_boÞ
 
r_my_boÞ
;

195 } 
»t_»suÉ
;

200 
timeout_v®ue
;

210 
my_boÞ
 
aùive
;

220 
my_boÞ
 
su¥’ded
;

226 
¡_ma_pvio
 *
pvio
;

227 (*
su¥’d_»sume_hook
)(
my_boÞ
 
su¥’d
, *
u£r_d©a
);

228 *
su¥’d_»sume_hook_u£r_d©a
;

235 
my_cÚ‹xt
 
async_cÚ‹xt
;

	@include/ma_crypt.h

20 #iâdeà
_ma_hash_h_


21 
	#_ma_hash_h_


	)

23 
	~<¡ddef.h
>

24 
	~<¡d¬g.h
>

27 
	#MA_HASH_MD5
 1

	)

28 
	#MA_HASH_SHA1
 2

	)

29 
	#MA_HASH_SHA224
 3

	)

30 
	#MA_HASH_SHA256
 4

	)

31 
	#MA_HASH_SHA384
 5

	)

32 
	#MA_HASH_SHA512
 6

	)

33 
	#MA_HASH_RIPEMD160
 7

	)

36 
	#MA_MD5_HASH_SIZE
 16

	)

37 
	#MA_SHA1_HASH_SIZE
 20

	)

38 
	#MA_SHA224_HASH_SIZE
 28

	)

39 
	#MA_SHA256_HASH_SIZE
 32

	)

40 
	#MA_SHA384_HASH_SIZE
 48

	)

41 
	#MA_SHA512_HASH_SIZE
 64

	)

42 
	#MA_RIPEMD160_HASH_SIZE
 20

	)

44 
	#MA_MAX_HASH_SIZE
 64

	)

47 #ià
defšed
(
WIN32
)

48 
	~<wšdows.h
>

49 
	~<büy±.h
>

51 
	mä“_me
;

52 
BCRYPT_ALG_HANDLE
 
	mhAlg
;

53 
BCRYPT_HASH_HANDLE
 
	mhHash
;

54 
PBYTE
 
	mhashObjeù
;

55 
DWORD
 
	mdige¡_Ën
;

56 } 
	tMA_HASH_CTX
;

57 #–ià
defšed
(
HAVE_OPENSSL
)

58 
	tMA_HASH_CTX
;

59 #–ià
defšed
(
HAVE_GNUTLS
)

61 *
	mùx
;

62 cÚ¡ 
Ã‰Ë_hash
 *
	mhash
;

63 } 
	tMA_HASH_CTX
;

74 
MA_HASH_CTX
 *
ma_hash_Ãw
(
®gÜ™hm
, MA_HASH_CTX *
ùx
);

83 
ma_hash_ä“
(
MA_HASH_CTX
 *
ùx
);

96 
ma_hash_šput
(
MA_HASH_CTX
 *
ùx
,

97 cÚ¡ *
bufãr
,

98 
size_t
 
Ën
);

108 
ma_hash_»suÉ
(
MA_HASH_CTX
 *
ùx
, *
dige¡
);

118 
šlše
 
size_t
 
	$ma_hash_dige¡_size
(
hash_®g
)

120 
hash_®g
) {

121 
MA_HASH_MD5
:

122  
MA_MD5_HASH_SIZE
;

123 
MA_HASH_SHA1
:

124  
MA_SHA1_HASH_SIZE
;

125 
MA_HASH_SHA224
:

126  
MA_SHA224_HASH_SIZE
;

127 
MA_HASH_SHA256
:

128  
MA_SHA256_HASH_SIZE
;

129 
MA_HASH_SHA384
:

130  
MA_SHA384_HASH_SIZE
;

131 
MA_HASH_SHA512
:

132  
MA_SHA512_HASH_SIZE
;

133 
MA_HASH_RIPEMD160
:

134  
MA_RIPEMD160_HASH_SIZE
;

138 
	}
}

150 
šlše
 
	$ma_hash
(
®gÜ™hm
,

151 cÚ¡ *
bufãr
,

152 
size_t
 
bufãr_Ëngth
,

153 *
dige¡
)

155 
MA_HASH_CTX
 *
ùx
ð
NULL
;

156 #ifdeà
HAVE_SCHANNEL


157 
MA_HASH_CTX
 
dùx
;

158 
ùx
ð&
dùx
;

160 
ùx
ð
	`ma_hash_Ãw
(
®gÜ™hm
, ctx);

161 
	`ma_hash_šput
(
ùx
, 
bufãr
, 
bufãr_Ëngth
);

162 
	`ma_hash_»suÉ
(
ùx
, 
dige¡
);

163 
	`ma_hash_ä“
(
ùx
);

164 
	}
}

	@include/ma_global.h

21 #iâdeà
_glob®_h


22 
	#_glob®_h


	)

24 #ifdeà
_WIN32


25 
	~<wšsock2.h
>

26 
	~<wšdows.h
>

27 
	~<¡dlib.h
>

28 
	#¡rÿ£cmp
 
_¡ricmp


	)

29 
	#¦“p
(
x
è
	`SË•
(1000*(x))

	)

30 #ifdeà
_MSC_VER


31 
	#šlše
 
__šlše


	)

32 #ià
_MSC_VER
 < 1900

33 
	#¢´štf
 
_¢´štf


	)

36 
	#STDCALL
 
__¡dÿÎ


	)

39 
	~<ma_cÚfig.h
>

40 
	~<as£¹.h
>

41 #iâdeà
__GNUC__


42 
	#__©Œibu‹
(
A
)

	)

46 #ià
defšed
(
HAVE_LINUXTHREADS
)

47 #undeà
_GNU_SOURCE


48 
	#_GNU_SOURCE
 1

	)

52 #ià
defšed
(
UNDEF_THREADS_HACK
)

53 #undeà
THREAD


54 #undeà
HAVE_m™_th»ad


55 #undeà
HAVE_LINUXTHREADS


56 #undeà
HAVE_UNIXWARE7_THREADS


59 #ifdeà
HAVE_THREADS_WITHOUT_SOCKETS


61 #undeà
HAVE_SYS_UN_H


64 
	#__EXTENSIONS__
 1

	)

65 #iâdeà
__STDC_EXT__


66 
	#__STDC_EXT__
 1

	)

69 #ià
defšed
(
THREAD
è&& !defšed(
_WIN32
)

70 #iâdeà
_POSIX_PTHREAD_SEMANTICS


71 
	#_POSIX_PTHREAD_SEMANTICS


	)

74 #ià!
defšed
(
SCO
)

75 
	#_REENTRANT
 1

	)

77 #ià!
defšed
(
_THREAD_SAFE
è&& !defšed(
_AIX
)

78 
	#_THREAD_SAFE


	)

80 #iâdeà
HAVE_m™_th»ad


81 #ifdeà
HAVE_UNIXWARE7_THREADS


82 
	~<th»ad.h
>

84 
	~<±h»ad.h
>

87 #ià!
defšed
(
SCO
è&& !defšed(
_REENTRANT
)

88 
	#_REENTRANT
 1

	)

93 #ifdeà
HAVE_BROKEN_SNPRINTF


94 #undeà
HAVE_SNPRINTF


96 #ià
defšed
(
HAVE_BROKEN_INLINE
è&& !defšed(
__ýlu¥lus
)

97 #undeà
šlše


98 
	#šlše


	)

101 #ifdeà
UNDEF_HAVE_GETHOSTBYNAME_R


102 #undeà
HAVE_GETHOSTBYNAME_R


104 #ifdeà
UNDEF_HAVE_INITGROUPS


105 #undeà
HAVE_INITGROUPS


109 #ià
SIZEOF_LONG
 =ð4 && 
defšed
(
__LONG_MAX__
)

110 #undeà
__LONG_MAX__


111 
	#__LONG_MAX__
 2147483647

	)

115 #ifdeà
DEFINE_CXA_PURE_VIRTUAL


116 
	#FIX_GCC_LINKING_PROBLEM
 "C" { 
	`__cxa_pu»_vœtu®
(è{ 0;} }

	)

118 
	#FIX_GCC_LINKING_PROBLEM


	)

122 #ià
defšed
(
__GNUC__
è&& defšed(
__®pha__
è&& ! (__GNUC__ > 2 || (__GNUC__ =ð2 && 
__GNUC_MINOR__
 >= 95))

123 
	#BAD_MEMCPY


	)

127 #ià
defšed
(
HAVE_LINUXTHREADS
è&& defšed(
__GNUC__
è&& defšed(
__®pha__
è&& (__GNUC__ > 2 || ( __GNUC__ =ð2 && 
__GNUC_MINOR__
 >ð95)è&& !defšed(
HAVE_ATOMIC_ADD
)

128 
	#HAVE_ATOMIC_ADD


	)

129 
	#HAVE_ATOMIC_SUB


	)

133 #ià(
defšed
(
HAVE_LINUXTHREADS
è&& defšed(
__GNUC__
è&& (defšed(
__Ÿ64__
è|| defšed(
__pow”pc64__
))è|| !defšed(
THREAD
)

134 #undeà
HAVE_ATOMIC_ADD


135 #undeà
HAVE_ATOMIC_SUB


138 #ià
defšed
(
_lšt
è&& !defšed(
lšt
)

139 
	#lšt


	)

141 #ià
SIZEOF_LONG_LONG
 > 4 && !
defšed
(
_LONG_LONG
)

142 
	#_LONG_LONG
 1

	)

145 #iâdeà
¡dš


146 
	~<¡dio.h
>

148 #ifdeà
HAVE_STDLIB_H


149 
	~<¡dlib.h
>

151 #ifdeà
HAVE_STDDEF_H


152 
	~<¡ddef.h
>

155 
	~<m©h.h
>

156 #ifdeà
HAVE_LIMITS_H


157 
	~<lim™s.h
>

159 #ifdeà
HAVE_FLOAT_H


160 
	~<æßt.h
>

163 #ifdeà
HAVE_SYS_TYPES_H


164 
	~<sys/ty³s.h
>

166 #ifdeà
HAVE_FCNTL_H


167 
	~<fúŽ.h
>

169 #ià
defšed
(
TIME_WITH_SYS_TIME
)

170 
	~<sys/time.h
>

171 
	~<time.h
>

173 #ià
defšed
(
HAVE_SYS_TIME_H
)

174 
	~<sys/time.h
>

176 
	~<time.h
>

179 #ifdeà
HAVE_UNISTD_H


180 
	~<uni¡d.h
>

182 #ià
defšed
(
__ýlu¥lus
è&& defšed(
NO_CPLUSPLUS_ALLOCA
)

183 #undeà
HAVE_ALLOCA


184 #undeà
HAVE_ALLOCA_H


186 #ifdeà
HAVE_ALLOCA_H


187 
	~<®loÿ.h
>

189 #ifdeà
HAVE_ATOMIC_ADD


190 
	#__SMP__


	)

191 
	#CONFIG_SMP


	)

192 
	~<asm/©omic.h
>

194 
	~<”ºo.h
>

195 
	~<as£¹.h
>

198 #ià
defšed
(
_HPUX_SOURCE
è&& defšed(
HAVE_SYS_STREAM_H
)

199 
	~<sys/¡»am.h
>

200 
	#HAVE_ULONG


	)

202 #ifdeà
DONT_USE_FINITE


203 #undeà
HAVE_FINITE


205 #ià
defšed
(
HPUX
è&& defšed(
_LARGEFILE64_SOURCE
è&& defšed(
THREAD
)

207 #undeà
£Œlim™


208 
	#£Œlim™
 
cma_£Œlim™64


	)

213 
	#USE_MYFUNC
 1

	)

214 
	#MASTER
 1

	)

215 
	#ENGLISH
 1

	)

216 
	#POSIX_MISTAKE
 1

	)

217 
	#USE_REGEX
 1

	)

219 
	#USE_BMOVE512
 1

	)

222 #ifdeà
I_AM_PARANOID


223 
	#DONT_ALLOW_USER_CHANGE
 1

	)

224 
	#DONT_USE_MYSQL_PWD
 1

	)

232 #iâdeà
HAVE_BSD_SIGNALS


233 
	#DONT_REMEMBER_SIGNAL


	)

237 #ià
defšed
(
_lšt
è|| defšed(
FORCE_INIT_OF_VARS
)

238 
	#LINT_INIT
(
v¬
èdo{v¬=0;}0è

	)

239 
	#LINT_INIT_STRUCT
(
v¬
è
	`mem£t
(&v¬, 0, (v¬)è

	)

241 
	#LINT_INIT
(
v¬
)

	)

242 
	#LINT_INIT_STRUCT
(
v¬
)

	)

246 #ià
defšed
(
__ýlu¥lus
è&& defšed(
__GNUC__
)

247 
	#max
(
a
, 
b
è(×è>? (b))

	)

248 
	#mš
(
a
, 
b
è(×è<? (b))

	)

249 #–ià!
defšed
(
max
)

250 
	#max
(
a
, 
b
è(×è> (bè? (aè: (b))

	)

251 
	#mš
(
a
, 
b
è(×è< (bè? (aè: (b))

	)

254 #ià
defšed
(
__EMX__
è|| !defšed(
HAVE_UINT
)

255 
	tušt
;

256 
	tushÜt
;

259 
	#sgn
(
a
è((×è< 0è? -1 : (×è> 0è? 1 : 0)

	)

260 
	#sw­
(
t
,
a
,
b
èdo{ˆ
dummy
; dummy =‡;‡ = b; b = dummy;}0)

	)

261 
	#‹¡
(
a
è(×è? 1 : 0)

	)

262 
	#£t_if_bigg”
(
a
,
b
èdo{ ià(×è< (b)è×)=(b); }0)

	)

263 
	#£t_if_sm®Ër
(
a
,
b
èdo{ ià(×è> (b)è×)=(b); }0)

	)

264 
	#‹¡_®l_b™s
(
a
,
b
è((×è& (b)è=ð(b))

	)

265 
	#£t_b™s
(
ty³
, 
b™_couÁ
è(Ñy³)*8 <ð(b™_couÁè? ~Ñy³è0 : (((Ñy³è1è<< (b™_couÁ)è- (ty³è1))

	)

266 
	#¬¿y_–em’ts
(
A
è((
ušt
è((A)/(A[0])))

	)

267 #iâdeà
HAVE_RINT


268 
	#ršt
(
A
è
	`æoÜ
((A)+0.5)

	)

272 #iâdeà
TRUE


273 
	#TRUE
 (1è

	)

274 
	#FALSE
 (0è

	)

277 #ià
defšed
(
__GNUC__
)

278 
	#funùiÚ_vÞ©že
 vÞ©že

	)

279 #iâdeà
my_»š‹½»t_ÿ¡


280 
	#my_»š‹½»t_ÿ¡
(
A
è
»š‹½»t_ÿ¡
<A>

	)

282 
	#my_cÚ¡_ÿ¡
(
A
è
cÚ¡_ÿ¡
<A>

	)

283 #–ià!
defšed
(
my_»š‹½»t_ÿ¡
)

284 
	#my_»š‹½»t_ÿ¡
(
A
è(A)

	)

285 
	#my_cÚ¡_ÿ¡
(
A
è(A)

	)

287 #ià!
defšed
(
__GNUC__
è&& !defšed(
__þªg__
)

288 
	#__©Œibu‹__
(
A
)

	)

298 
	#_VARARGS
(
X
è
	)
X

299 
	#_STATIC_VARARGS
(
X
è
	)
X

301 #ià
defšed
(
DBUG_ON
è&& defšed(
DBUG_OFF
)

302 #undeà
DBUG_OFF


305 #ià
defšed
(
_lšt
è&& !defšed(
DBUG_OFF
)

306 
	#DBUG_OFF


	)

309 
	#MIN_ARRAY_SIZE
 0

	)

310 
	#ASCII_BITS_USED
 8

	)

311 
	#NEAR_F


	)

315 
	tFže
;

316 #iâdeà
my_sock‘_defšed


317 
	#my_sock‘_defšed


	)

318 #ià
defšed
(
_WIN64
)

319 
	#my_sock‘
 

	)

320 #–ià
defšed
(
_WIN32
)

321 
	#my_sock‘
 

	)

323 
	tmy_sock‘
;

325 
	#my_sock‘_defšed


	)

327 #iâdeà
INVALID_SOCKET


328 
	#INVALID_SOCKET
 -1

	)

331 #ià
defšed
(
__GNUC__
è&& !defšed(
_lšt
)

332 
	tpch¬
;

333 
	tpuch¬
;

334 
	tpboÞ
;

335 
	tpshÜt
;

336 
	tpæßt
;

338 
	tpch¬
;

339 
ušt
 
	tpuch¬
;

340 
	tpboÞ
;

341 
	tpshÜt
;

342 
	tpæßt
;

344 (*
	tqsÜt_cmp
)(const *,const *);

345 #ifdeà
HAVE_m™_th»ad


346 
	#qsÜt_t
 

	)

347 #undeà
QSORT_TYPE_IS_VOID


348 
	#QSORT_TYPE_IS_VOID


	)

350 
	#qsÜt_t
 
RETQSORTTYPE


	)

353 #ifdeà
HAVE_SYS_SOCKET_H


354 
	~<sys/sock‘.h
>

356 
SOCKET_SIZE_TYPE
 
	tsize_sock‘
;

358 #iâdeà
SOCKOPT_OPTLEN_TYPE


359 
	#SOCKOPT_OPTLEN_TYPE
 
size_sock‘


	)

364 #iâdeà
O_SHARE


365 
	#O_SHARE
 0

	)

366 #iâdeà
O_BINARY


367 
	#O_BINARY
 0

	)

369 
	#FILE_BINARY
 0

	)

370 #ifdeà
HAVE_FCNTL


371 
	#HAVE_FCNTL_LOCK


	)

372 
	#F_TO_EOF
 0L

	)

375 #iâdeà
O_TEMPORARY


376 
	#O_TEMPORARY
 0

	)

378 #iâdeà
O_SHORT_LIVED


379 
	#O_SHORT_LIVED
 0

	)

385 
	#UNSINT8


	)

386 
	#UNSINT16


	)

387 
	#UNSINT32


	)

390 
	#SC_MAXWIDTH
 256

	)

391 
	#FN_LEN
 256

	)

392 
	#FN_HEADLEN
 253

	)

393 
	#FN_EXTLEN
 20

	)

394 
	#FN_REFLEN
 512

	)

395 
	#FN_EXTCHAR
 '.'

	)

396 
	#FN_HOMELIB
 '~'

	)

397 
	#FN_CURLIB
 '.'

	)

398 
	#FN_PARENTDIR
 ".."

	)

399 
	#FN_DEVCHAR
 ':'

	)

401 #iâdeà
FN_LIBCHAR


402 #ifdeà
_WIN32


403 
	#FN_LIBCHAR
 '\\'

	)

404 
	#FN_ROOTDIR
 "\\"

	)

406 
	#FN_LIBCHAR
 '/'

	)

407 
	#FN_ROOTDIR
 "/"

	)

409 
	#MY_NFILE
 1024

	)

421 
	#IO_SIZE
 4096

	)

426 
	#MALLOC_OVERHEAD
 8

	)

428 
	#ONCE_ALLOC_INIT
 ((
ušt
è(4096-
MALLOC_OVERHEAD
))

	)

430 
	#RECORD_CACHE_SIZE
 ((
ušt
è(64*1024-
MALLOC_OVERHEAD
))

	)

432 
	#KEY_CACHE_SIZE
 ((
ušt
è(8*1024*1024-
MALLOC_OVERHEAD
))

	)

436 
	#ONLY_OWN_DATABASES


	)

437 
	#NO_PISAM


	)

438 
	#NO_MISAM


	)

439 
	#NO_HASH


	)

440 #ifdeà
_WIN32


441 
	#NO_DIR_LIBRARY


	)

442 
	#USE_MY_STAT_STRUCT


	)

443 #ifdeà
_MSC_VER


444 
SSIZE_T
 
	tssize_t
;

450 #iâdeà
HAVE_ITOA


451 
	#USE_MY_ITOA


	)

456 #iâdeà
HAVE_ATOD


457 
	#©od
 
©of


	)

459 #ifdeà
USE_MY_ATOF


460 
	#©of
 
my_©of


	)

461 
	`š™_my_©of
();

462 
	`my_©of
(const *);

464 #undeà
»move


465 #iâdeà
_WIN32


466 
	#þo£sock‘
(
A
è
	`þo£
(A)

	)

468 #iâdeà
ulÚglÚg2doubË


469 
	#ulÚglÚg2doubË
(
A
è((è(A))

	)

470 
	#my_off_t2doubË
(
A
è((è(A))

	)

474 #iâdeà
off£tof


475 
	#off£tof
(
TYPE
, 
MEMBER
è((
size_t
è&((TYPE *)0)->MEMBER)

	)

477 
	#ulÚg_to_doubË
(
X
è((è(
ulÚg
è(X))

	)

478 
	#SET_STACK_SIZE
(
X
è

	)

481 #ifdeà
HAVE_LINUXTHREADS


486 #ià
	`defšed
(
_lšt
è|| defšed(
FORCE_INIT_OF_VARS
) || \

487 
	`defšed
(
__ýlu¥lus
è|| !
	$defšed
(
__GNUC__
)

488 
	#UNINIT_VAR
(
x
èxð0

	)

491 
	#UNINIT_VAR
(
x
èxð
	)
x

497 #ià
SIZEOF_LONG_LONG
 > 4

498 
	#HAVE_LONG_LONG
 1

	)

501 #ià
	`defšed
(
HAVE_LONG_LONG
è&& !defšed(
LONGLONG_MIN
)

502 
	#LONGLONG_MIN
 ((è0x8000000000000000LL)

	)

503 
	#LONGLONG_MAX
 ((è0x7FFFFFFFFFFFFFFFLL)

	)

507 
	#INT_MIN64
 (~0x7FFFFFFFFFFFFFFFLL)

	)

508 
	#INT_MAX64
 0x7FFFFFFFFFFFFFFFLL

	)

509 
	#INT_MIN32
 (~0x7FFFFFFFL)

	)

510 
	#INT_MAX32
 0x7FFFFFFFL

	)

511 
	#UINT_MAX32
 0xFFFFFFFFL

	)

512 
	#INT_MIN24
 (~0x007FFFFF)

	)

513 
	#INT_MAX24
 0x007FFFFF

	)

514 
	#UINT_MAX24
 0x00FFFFFF

	)

515 
	#INT_MIN16
 (~0x7FFF)

	)

516 
	#INT_MAX16
 0x7FFF

	)

517 
	#UINT_MAX16
 0xFFFF

	)

518 
	#INT_MIN8
 (~0x7F)

	)

519 
	#INT_MAX8
 0x7F

	)

520 
	#UINT_MAX8
 0xFF

	)

522 #iâdeà
ULL


523 #ifdeà
HAVE_LONG_LONG


524 
	#ULL
(
A
èA ## 
ULL


	)

526 
	#ULL
(
A
èA ## 
UL


	)

530 #ià
	`defšed
(
HAVE_LONG_LONG
è&& !defšed(
ULONGLONG_MAX
)

532 #ifdeà
ULLONG_MAX


533 
	#ULONGLONG_MAX
 
ULLONG_MAX


	)

535 
	#ULONGLONG_MAX
 (()(~0ULL))

	)

540 #iâdeà
DBL_MIN


541 
	#DBL_MIN
 4.94065645841246544e-324

	)

542 
	#FLT_MIN
 (()1.40129846432481707e-45)

	)

544 #iâdeà
DBL_MAX


545 
	#DBL_MAX
 1.79769313486231470e+308

	)

546 
	#FLT_MAX
 (()3.40282346638528860e+38)

	)

553 
	tmy_±rdiff_t
;

554 
	#MY_ALIGN
(
A
,
L
è(((Aè+ (Lè- 1è& ~((Lè- 1))

	)

555 
	#ALIGN_SIZE
(
A
è
	`MY_ALIGN
((A),())

	)

557 
	#ALIGN_PTR
(
A
, 
t
è(Ñ*è
	`MY_ALIGN
((A),Ñ)))

	)

559 
	#OFFSET
(
t
, 
f
è((
size_t
)(*)&(Ñ *)0)->f)

	)

560 
	#ADD_TO_PTR
(
±r
,
size
,
ty³
èÑy³è((*èÕŒ)+size)

	)

561 
	#PTR_BYTE_DIFF
(
A
,
B
è(
my_±rdiff_t
è((*è(Aè- (*è(B))

	)

563 
	#NuÎS
 (*è0

	)

565 #iâdeà
NEAR


566 
	#NEAR


	)

567 
	#FAR


	)

568 #iâdeà
HUGE_PTR


569 
	#HUGE_PTR


	)

572 #ià
	`defšed
(
__IBMC__
è|| defšed(
__IBMCPP__
)

573 
	#STDCALL
 
_Sy¡em
 
_ExpÜt


	)

574 #–ià!
	`defšed
Ð
STDCALL
)

575 
	#STDCALL


	)

580 #ià
	`defšed
(
VOIDTYPE
)

581 *
	tg±r
;

583 *
	tg±r
;

585 #iâdeà
HAVE_INT_8_16_32


586 sigÃd 
	tšt8
;

587 sigÃd 
	tšt16
;

589 #iâdeà
HAVE_UCHAR


590 
	tuch¬
;

592 
	tušt8
;

593 
	tušt16
;

595 #ià
SIZEOF_INT
 == 4

596 #iâdeà
HAVE_INT_8_16_32


597 
	tšt32
;

599 
	tušt32
;

600 #–ià
SIZEOF_LONG
 == 4

601 #iâdeà
HAVE_INT_8_16_32


602 
	tšt32
;

604 
	tušt32
;

609 #ià!
	`defšed
(
HAVE_ULONG
è&& !defšed(
HAVE_LINUXTHREADS
è&& !defšed(
__USE_MISC
)

610 
	tulÚg
;

612 #iâdeà
lÚglÚg_defšed


613 #ià
	`defšed
(
HAVE_LONG_LONG
è&& 
SIZEOF_LONG
 != 8

614 
	tulÚglÚg
;

615 
	tlÚglÚg
;

617 
	tulÚglÚg
;

618 
	tlÚglÚg
;

620 
	#lÚglÚg_defšed


	)

623 #iâdeà
HAVE_INT64


624 
lÚglÚg
 
	tšt64
;

626 #iâdeà
HAVE_UINT64


627 
ulÚglÚg
 
	tušt64
;

630 #iâdeà
MIN


631 
	#MIN
(
a
,
b
è((×è< (b)è? (aè: (b))

	)

633 #iâdeà
MAX


634 
	#MAX
(
a
,
b
è((×è> (b)è? (aè: (b))

	)

636 
	#CMP_NUM
(
a
,
b
è((×è< (b)è? -1 : (×è=ð(b)è? 0 : 1)

	)

637 #ifdeà
USE_RAID


642 #ià
	`defšed
(
SIZEOF_OFF_T
) && SIZEOF_OFF_T == 4

643 
	#SYSTEM_SIZEOF_OFF_T
 4

	)

645 
	#SYSTEM_SIZEOF_OFF_T
 8

	)

647 #undeà
SIZEOF_OFF_T


648 
	#SIZEOF_OFF_T
 8

	)

650 
	#SYSTEM_SIZEOF_OFF_T
 
SIZEOF_OFF_T


	)

653 #ià
	`defšed
(
SIZEOF_OFF_T
) && SIZEOF_OFF_T > 4

654 
ulÚglÚg
 
	tmy_off_t
;

656 
	tmy_off_t
;

658 
	#MY_FILEPOS_ERROR
 (~(
my_off_t
è0)

	)

659 #iâdeà
_WIN32


660 
off_t
 
	tos_off_t
;

663 #ià
	`defšed
(
_WIN32
)

664 
	#sock‘_”ºo
 
	`WSAG‘La¡E¼Ü
()

	)

665 
	#SOCKET_EINTR
 
WSAEINTR


	)

666 
	#SOCKET_EAGAIN
 
WSAEWOULDBLOCK


	)

667 
	#SOCKET_ENFILE
 
ENFILE


	)

668 
	#SOCKET_EMFILE
 
EMFILE


	)

669 
	#SOCKET_EWOULDBLOCK
 
WSAEWOULDBLOCK


	)

671 
	#sock‘_”ºo
 
”ºo


	)

672 
	#þo£sock‘
(
A
è
	`þo£
(A)

	)

673 
	#SOCKET_EINTR
 
EINTR


	)

674 
	#SOCKET_EAGAIN
 
EAGAIN


	)

675 
	#SOCKET_EWOULDBLOCK
 
EWOULDBLOCK


	)

676 
	#SOCKET_ENFILE
 
ENFILE


	)

677 
	#SOCKET_EMFILE
 
EMFILE


	)

680 
ušt8
 
	tšt7
;

681 
	tšt15
;

682 *
	tmy_¡ršg
;

683 
	tsize_s
;

684 
	tmyf
;

685 
	tmy_boÞ
;

686 
	tmy_ulÚglÚg
;

687 #ià!
	`defšed
(
boÞ
è&& !defšed(
boÞ_defšed
è&& (!defšed(
HAVE_BOOL
è|| !defšed(
__ýlu¥lus
))

688 
	tboÞ
;

691 
	#INT8
(
v
è(
št8
è(v)

	)

692 
	#INT16
(
v
è(
št16
è(v)

	)

693 
	#INT32
(
v
è(
št32
è(v)

	)

694 
	#MYF
(
v
è(
myf
è(v)

	)

700 #iâdeà
USING_X


701 
	#»g1
 

	)

702 
	#»g2
 

	)

703 
	#»g3
 

	)

704 
	#»g4
 

	)

705 
	#»g5
 

	)

706 
	#»g6
 

	)

707 
	#»g7
 

	)

708 
	#»g8
 

	)

709 
	#»g9
 

	)

710 
	#»g10
 

	)

711 
	#»g11
 

	)

712 
	#»g12
 

	)

713 
	#»g13
 

	)

714 
	#»g14
 

	)

715 
	#»g15
 

	)

716 
	#»g16
 

	)

720 
	#SCALE_SEC
 100

	)

721 
	#SCALE_USEC
 10000

	)

722 
	#MY_HOW_OFTEN_TO_ALARM
 2

	)

723 
	#MY_HOW_OFTEN_TO_WRITE
 1000

	)

725 
	#NOT_FIXED_DEC
 31

	)

727 #ià
	`defšed
(
_WIN32
è&& defšed(
_MSVC
)

728 
	#MYSQLND_LLU_SPEC
 "%I64u"

	)

729 
	#MYSQLND_LL_SPEC
 "%I64d"

	)

730 #iâdeà
L64


731 
	#L64
(
x
èx##
i64


	)

734 
	#MYSQLND_LLU_SPEC
 "%Îu"

	)

735 
	#MYSQLND_LL_SPEC
 "%Îd"

	)

736 #iâdeà
L64


737 
	#L64
(
x
èx##
LL


	)

746 
	#št1¡Üe
(
T
,
A
è*((
št8
*è(T)èð(A)

	)

747 
	#ušt1kÜr
(
A
è(*(((
ušt8
*)(A))))

	)

748 #ià
	`defšed
(
__i386__
è|| defšed(
_WIN32
)

749 
	#sšt2kÜr
(
A
è(*((
št16
 *è(A)))

	)

750 
	#sšt3kÜr
(
A
è((
št32
è((((
uch¬
) (A)[2]) & 128) ? \

751 (((
ušt32
) 255L << 24) | \

752 (((
ušt32
è(
uch¬
è(
A
)[2]) << 16) |\

753 (((
ušt32
è(
uch¬
è(
A
)[1]) << 8) | \

754 ((
ušt32
è(
uch¬
è(
A
)[0])) : \

755 (((
ušt32
è(
uch¬
è(
A
)[2]) << 16) |\

756 (((
ušt32
è(
uch¬
è(
A
)[1]) << 8) | \

757 ((
ušt32
è(
uch¬
è(
A
)[0])))

	)

758 
	#sšt4kÜr
(
A
è(*((*è(A)))

	)

759 
	#ušt2kÜr
(
A
è(*((
ušt16
 *è(A)))

	)

760 #ià
	`defšed
(
HAVE_purify
è&& !defšed(
_WIN32
)

761 
	#ušt3kÜr
(
A
è(
ušt32
è(((ušt32è((
uch¬
) (A)[0])) +\

762 (((
ušt32
è((
uch¬
è(
A
)[1])) << 8) +\

763 (((
ušt32
è((
uch¬
è(
A
)[2])è<< 16))

	)

771 
	#ušt3kÜr
(
A
è(è(*((*è(A)è& 0xFFFFFF)

	)

773 
	#ušt4kÜr
(
A
è(*((
ušt32
 *è(A)))

	)

774 
	#ušt5kÜr
(
A
è((
ulÚglÚg
)(((
ušt32
è((
uch¬
) (A)[0])) +\

775 (((
ušt32
è((
uch¬
è(
A
)[1])) << 8) +\

776 (((
ušt32
è((
uch¬
è(
A
)[2])) << 16) +\

777 (((
ušt32
è((
uch¬
è(
A
)[3])) << 24)) +\

778 (((
ulÚglÚg
è((
uch¬
è(
A
)[4])è<< 32))

	)

779 
	#ušt6kÜr
(
A
è((
ulÚglÚg
)(((
ušt32
è((
uch¬
) (A)[0])) + \

780 (((
ušt32
è((
uch¬
è(
A
)[1])) << 8) + \

781 (((
ušt32
è((
uch¬
è(
A
)[2])) << 16) + \

782 (((
ušt32
è((
uch¬
è(
A
)[3])) << 24)) + \

783 (((
ulÚglÚg
è((
uch¬
è(
A
)[4])) << 32) + \

784 (((
ulÚglÚg
è((
uch¬
è(
A
)[5])è<< 40))

	)

785 
	#ušt8kÜr
(
A
è(*((
ulÚglÚg
 *è(A)))

	)

786 
	#sšt8kÜr
(
A
è(*((
lÚglÚg
 *è(A)))

	)

787 
	#št2¡Üe
(
T
,
A
è*((
ušt16
*è(T))ð(ušt16è(A)

	)

788 
	#št3¡Üe
(
T
,
A
èdØ{ *(T)ð(
uch¬
) ((A));\

789 *(
T
+1)=(
uch¬
è(((
ušt
è(
A
) >> 8));\

790 *(
T
+2)=(
uch¬
è(((
A
è>> 16)); 
	}
} 0)

	)

791 
	#št4¡Üe
(
T
,
A
è*((*è(T))ð(è(A)

	)

792 
	#št5¡Üe
(
T
,
A
èdØ{ *(T)ð(
uch¬
)((A));\

793 *((
T
)+1)=(
uch¬
è(((
A
) >> 8));\

794 *((
T
)+2)=(
uch¬
è(((
A
) >> 16));\

795 *((
T
)+3)=(
uch¬
è(((
A
) >> 24)); \

796 *((
T
)+4)=(
uch¬
è(((
A
è>> 32)); } 0)

	)

797 
	#št6¡Üe
(
T
,
A
èdØ{ *(T)ð(
uch¬
)((A)); \

798 *((
T
)+1)=(
uch¬
è(((
A
) >> 8)); \

799 *((
T
)+2)=(
uch¬
è(((
A
) >> 16)); \

800 *((
T
)+3)=(
uch¬
è(((
A
) >> 24)); \

801 *((
T
)+4)=(
uch¬
è(((
A
) >> 32)); \

802 *((
T
)+5)=(
uch¬
è(((
A
è>> 40)); } 0)

	)

803 
	#št8¡Üe
(
T
,
A
èdØ{*((
ulÚglÚg
 *è(T))ð(ulÚglÚgè(A);} 0)

	)

806 
	mv
;

807 
	mm
[2];

808 } 
	tdoubËg‘_uniÚ
;

809 
	#doubËg‘
(
V
,
M
) \

810 dØ{ 
doubËg‘_uniÚ
 
_tmp
; \

811 
_tmp
.
m
[0] = *((*)(
M
)); \

812 
_tmp
.
m
[1] = *(((*è(
M
))+1); \

813 (
V
èð
_tmp
.
v
; } 0)

	)

814 
	#doubË¡Üe
(
T
,
V
èdØ{ *((*èTèð((
doubËg‘_uniÚ
 *)&V)->
m
[0]; \

815 *(((*è
T
)+1èð((
doubËg‘_uniÚ
 *)&
V
)->
m
[1]; \

816 } 0)

	)

817 
	#æßt4g‘
(
V
,
M
èdØ{ *((*è&(V)èð*((*è(M)); } 0)

	)

818 
	#æßt8g‘
(
V
,
M
è
	`doubËg‘
((V),(M))

	)

819 
	#æßt4¡Üe
(
V
,
M
è
	`memýy
((
uch¬
*èV,(uch¬*è(&M),())

	)

820 
	#æßt¡Üe
(
T
,
V
è
	`memýy
((
uch¬
*)(T), (uch¬*)(&V),())

	)

821 
	#æßtg‘
(
V
,
M
è
	`memýy
((
uch¬
*è&V,(uch¬*è(M),())

	)

822 
	#æßt8¡Üe
(
V
,
M
è
	`doubË¡Üe
((V),(M))

	)

829 
	#sšt2kÜr
(
A
è(
št16
è(((št16è((
uch¬
) (A)[0])) +\

830 ((
št16
è((št16è(
A
)[1]è<< 8))

	)

831 
	#sšt3kÜr
(
A
è((
št32
è((((
uch¬
) (A)[2]) & 128) ? \

832 (((
ušt32
) 255L << 24) | \

833 (((
ušt32
è(
uch¬
è(
A
)[2]) << 16) |\

834 (((
ušt32
è(
uch¬
è(
A
)[1]) << 8) | \

835 ((
ušt32
è(
uch¬
è(
A
)[0])) : \

836 (((
ušt32
è(
uch¬
è(
A
)[2]) << 16) |\

837 (((
ušt32
è(
uch¬
è(
A
)[1]) << 8) | \

838 ((
ušt32
è(
uch¬
è(
A
)[0])))

	)

839 
	#sšt4kÜr
(
A
è(
št32
è(((št32è((
uch¬
) (A)[0])) +\

840 (((
št32
è((
uch¬
è(
A
)[1]) << 8)) +\

841 (((
št32
è((
uch¬
è(
A
)[2]) << 16)) +\

842 (((
št32
è((
št16
è(
A
)[3]è<< 24)))

	)

843 
	#sšt8kÜr
(
A
è(
lÚglÚg
è
	`ušt8kÜr
(A)

	)

844 
	#ušt2kÜr
(
A
è(
ušt16
è(((ušt16è((
uch¬
) (A)[0])) +\

845 ((
ušt16
è((
uch¬
è(
A
)[1]è<< 8))

	)

846 
	#ušt3kÜr
(
A
è(
ušt32
è(((ušt32è((
uch¬
) (A)[0])) +\

847 (((
ušt32
è((
uch¬
è(
A
)[1])) << 8) +\

848 (((
ušt32
è((
uch¬
è(
A
)[2])è<< 16))

	)

849 
	#ušt4kÜr
(
A
è(
ušt32
è(((ušt32è((
uch¬
) (A)[0])) +\

850 (((
ušt32
è((
uch¬
è(
A
)[1])) << 8) +\

851 (((
ušt32
è((
uch¬
è(
A
)[2])) << 16) +\

852 (((
ušt32
è((
uch¬
è(
A
)[3])è<< 24))

	)

853 
	#ušt5kÜr
(
A
è((
ulÚglÚg
)(((
ušt32
è((
uch¬
) (A)[0])) +\

854 (((
ušt32
è((
uch¬
è(
A
)[1])) << 8) +\

855 (((
ušt32
è((
uch¬
è(
A
)[2])) << 16) +\

856 (((
ušt32
è((
uch¬
è(
A
)[3])) << 24)) +\

857 (((
ulÚglÚg
è((
uch¬
è(
A
)[4])è<< 32))

	)

858 
	#ušt6kÜr
(
A
è((
ulÚglÚg
)(((
ušt32
è((
uch¬
) (A)[0])) + \

859 (((
ušt32
è((
uch¬
è(
A
)[1])) << 8) + \

860 (((
ušt32
è((
uch¬
è(
A
)[2])) << 16) + \

861 (((
ušt32
è((
uch¬
è(
A
)[3])) << 24)) + \

862 (((
ulÚglÚg
è((
uch¬
è(
A
)[4])) << 32) + \

863 (((
ulÚglÚg
è((
uch¬
è(
A
)[5])è<< 40))

	)

864 
	#ušt8kÜr
(
A
è((
ulÚglÚg
)(((
ušt32
è((
uch¬
) (A)[0])) +\

865 (((
ušt32
è((
uch¬
è(
A
)[1])) << 8) +\

866 (((
ušt32
è((
uch¬
è(
A
)[2])) << 16) +\

867 (((
ušt32
è((
uch¬
è(
A
)[3])) << 24)) +\

868 (((
ulÚglÚg
è(((
ušt32
è((
uch¬
è(
A
)[4])) +\

869 (((
ušt32
è((
uch¬
è(
A
)[5])) << 8) +\

870 (((
ušt32
è((
uch¬
è(
A
)[6])) << 16) +\

871 (((
ušt32
è((
uch¬
è(
A
)[7])) << 24))) <<\

872 32))

	)

873 
	#št2¡Üe
(
T
,
A
èdØ{ 
ušt
 
def_‹mp
= (uint) (A) ;\

874 *((
uch¬
*è(
T
))ð(uch¬)(
def_‹mp
); \

875 *((
uch¬
*è(
T
)+1)=(uch¬)((
def_‹mp
 >> 8)); \

876 } 0)

	)

877 
	#št3¡Üe
(
T
,
A
) do { \

878 *((
uch¬
*)(
T
))=(uch¬è((
A
));\

879 *((
uch¬
*è(
T
)+1)=(uch¬è(((
A
) >> 8));\

880 *((
uch¬
*)(
T
)+2)=(uch¬è(((
A
) >> 16)); \

881  } 0)

	)

882 
	#št4¡Üe
(
T
,
A
) do { *((*)(T))=() ((A));\

883 *(((*)(
T
))+1)=(è(((
A
) >> 8));\

884 *(((*)(
T
))+2)=(è(((
A
) >> 16));\

885 *(((*)(
T
))+3)=(è(((
A
è>> 24)); } 0)

	)

886 
	#št5¡Üe
(
T
,
A
) do { *((*)(T))= ()((A)); \

887 *(((*)(
T
))+1)ð()(((
A
) >> 8)); \

888 *(((*)(
T
))+2)ð()(((
A
) >> 16)); \

889 *(((*)(
T
))+3)ð()(((
A
) >> 24)); \

890 *(((*)(
T
))+4)ð()(((
A
) >> 32)); \

891 } 0)

	)

892 
	#št6¡Üe
(
T
,
A
) do { *((*)(T))= ()((A)); \

893 *(((*)(
T
))+1)ð()(((
A
) >> 8)); \

894 *(((*)(
T
))+2)ð()(((
A
) >> 16)); \

895 *(((*)(
T
))+3)ð()(((
A
) >> 24)); \

896 *(((*)(
T
))+4)ð()(((
A
) >> 32)); \

897 *(((*)(
T
))+5)ð()(((
A
) >> 40)); \

898 } 0)

	)

899 
	#št8¡Üe
(
T
,
A
èdØ{ 
ušt
 
def_‹mp
ð(uštè(A), 
def_‹mp2
= (uint) ((A) >> 32); \

900 
	`št4¡Üe
((
T
),
def_‹mp
); \

901 
	`št4¡Üe
((
T
+4),
def_‹mp2
); } 0)

	)

902 #ifdeà
HAVE_BIGENDIAN


903 
	#æßt4¡Üe
(
T
,
A
èdØ{ *(T)ð((
uch¬
 *) &A)[3];\

904 *((
T
)+1)=(è((
uch¬
 *è&
A
)[2];\

905 *((
T
)+2)=(è((
uch¬
 *è&
A
)[1];\

906 *((
T
)+3)=(è((
uch¬
 *è&
A
)[0]; } 0)

	)

908 
	#æßt4g‘
(
V
,
M
èdØ{ 
def_‹mp
;\

909 ((
uch¬
*è&
def_‹mp
)[0]=(
M
)[3];\

910 ((
uch¬
*è&
def_‹mp
)[1]=(
M
)[2];\

911 ((
uch¬
*è&
def_‹mp
)[2]=(
M
)[1];\

912 ((
uch¬
*è&
def_‹mp
)[3]=(
M
)[0];\

913 (
V
)=
def_‹mp
; } 0)

	)

914 
	#æßt8¡Üe
(
T
,
V
èdØ{ *(T)ð((
uch¬
 *) &V)[7];\

915 *((
T
)+1)=(è((
uch¬
 *è&
V
)[6];\

916 *((
T
)+2)=(è((
uch¬
 *è&
V
)[5];\

917 *((
T
)+3)=(è((
uch¬
 *è&
V
)[4];\

918 *((
T
)+4)=(è((
uch¬
 *è&
V
)[3];\

919 *((
T
)+5)=(è((
uch¬
 *è&
V
)[2];\

920 *((
T
)+6)=(è((
uch¬
 *è&
V
)[1];\

921 *((
T
)+7)=(è((
uch¬
 *è&
V
)[0]; } 0)

	)

923 
	#æßt8g‘
(
V
,
M
èdØ{ 
def_‹mp
;\

924 ((
uch¬
*è&
def_‹mp
)[0]=(
M
)[7];\

925 ((
uch¬
*è&
def_‹mp
)[1]=(
M
)[6];\

926 ((
uch¬
*è&
def_‹mp
)[2]=(
M
)[5];\

927 ((
uch¬
*è&
def_‹mp
)[3]=(
M
)[4];\

928 ((
uch¬
*è&
def_‹mp
)[4]=(
M
)[3];\

929 ((
uch¬
*è&
def_‹mp
)[5]=(
M
)[2];\

930 ((
uch¬
*è&
def_‹mp
)[6]=(
M
)[1];\

931 ((
uch¬
*è&
def_‹mp
)[7]=(
M
)[0];\

932 (
V
èð
def_‹mp
; } 0)

	)

934 
	#æßt4g‘
(
V
,
M
è
	`memýy
(&V, (M), ())

	)

935 
	#æßt4¡Üe
(
V
,
M
è
	`memýy
(V, (&M), ())

	)

937 #ià
defšed
(
__FLOAT_WORD_ORDER
è&& (__FLOAT_WORD_ORDER =ð
__BIG_ENDIAN
)

938 
	#doubË¡Üe
(
T
,
V
èdØ{ *(((*)T)+0)=(è((
uch¬
 *) &V)[4];\

939 *(((*)
T
)+1)=(è((
uch¬
 *è&
V
)[5];\

940 *(((*)
T
)+2)=(è((
uch¬
 *è&
V
)[6];\

941 *(((*)
T
)+3)=(è((
uch¬
 *è&
V
)[7];\

942 *(((*)
T
)+4)=(è((
uch¬
 *è&
V
)[0];\

943 *(((*)
T
)+5)=(è((
uch¬
 *è&
V
)[1];\

944 *(((*)
T
)+6)=(è((
uch¬
 *è&
V
)[2];\

945 *(((*)
T
)+7)=(è((
uch¬
 *è&
V
)[3]; }\

946 0)

	)

947 
	#doubËg‘
(
V
,
M
èdØ{ 
def_‹mp
;\

948 ((
uch¬
*è&
def_‹mp
)[0]=(
M
)[4];\

949 ((
uch¬
*è&
def_‹mp
)[1]=(
M
)[5];\

950 ((
uch¬
*è&
def_‹mp
)[2]=(
M
)[6];\

951 ((
uch¬
*è&
def_‹mp
)[3]=(
M
)[7];\

952 ((
uch¬
*è&
def_‹mp
)[4]=(
M
)[0];\

953 ((
uch¬
*è&
def_‹mp
)[5]=(
M
)[1];\

954 ((
uch¬
*è&
def_‹mp
)[6]=(
M
)[2];\

955 ((
uch¬
*è&
def_‹mp
)[7]=(
M
)[3];\

956 (
V
èð
def_‹mp
; } 0)

	)

959 
	#æßt8g‘
(
V
,
M
è
	`doubËg‘
((V),(M))

	)

960 
	#æßt8¡Üe
(
V
,
M
è
	`doubË¡Üe
((V),(M))

	)

969 
	#št4Ãt
(
A
è(
št32
è(((
ušt32
è((
uch¬
) (A)[3])) |\

970 (((
ušt32
è((
uch¬
è(
A
)[2])) << 8) |\

971 (((
ušt32
è((
uch¬
è(
A
)[1])) << 16) |\

972 (((
ušt32
è((
uch¬
è(
A
)[0])è<< 24))

	)

979 #ifdeà
HAVE_BIGENDIAN


981 
	#ushÜtg‘
(
V
,
M
èdØ{ V = (
ušt16
è(((ušt16è((
uch¬
) (M)[1]))+\

982 ((
ušt16
è((ušt16è(
M
)[0]è<< 8)); } 0)

	)

983 
	#shÜtg‘
(
V
,
M
èdØ{ V = (è(((è((
uch¬
) (M)[1]))+\

984 ((è((è(
M
)[0]è<< 8)); } 0)

	)

985 
	#lÚgg‘
(
V
,
M
èdØ{ 
št32
 
def_‹mp
;\

986 ((
uch¬
*è&
def_‹mp
)[0]=(
M
)[0];\

987 ((
uch¬
*è&
def_‹mp
)[1]=(
M
)[1];\

988 ((
uch¬
*è&
def_‹mp
)[2]=(
M
)[2];\

989 ((
uch¬
*è&
def_‹mp
)[3]=(
M
)[3];\

990 (
V
)=
def_‹mp
; } 0)

	)

991 
	#ulÚgg‘
(
V
,
M
èdØ{ 
ušt32
 
def_‹mp
;\

992 ((
uch¬
*è&
def_‹mp
)[0]=(
M
)[0];\

993 ((
uch¬
*è&
def_‹mp
)[1]=(
M
)[1];\

994 ((
uch¬
*è&
def_‹mp
)[2]=(
M
)[2];\

995 ((
uch¬
*è&
def_‹mp
)[3]=(
M
)[3];\

996 (
V
)=
def_‹mp
; } 0)

	)

997 
	#shÜt¡Üe
(
T
,
A
èdØ{ 
ušt
 
def_‹mp
=(uint) (A) ;\

998 *(((*)
T
)+1)=()(
def_‹mp
); \

999 *(((*)
T
)+0)=()(
def_‹mp
 >> 8); } 0)

	)

1000 
	#lÚg¡Üe
(
T
,
A
) do { *(((*)T)+3)=((A));\

1001 *(((*)
T
)+2)=(((
A
) >> 8));\

1002 *(((*)
T
)+1)=(((
A
) >> 16));\

1003 *(((*)
T
)+0)=(((
A
è>> 24)); } 0)

	)

1005 
	#æßtg‘
(
V
,
M
è
	`memýy
(&V, (M), ())

	)

1006 
	#æßt¡Üe
(
T
,
V
è
	`memýy
((T), (*è(&V), ())

	)

1007 
	#doubËg‘
(
V
,
M
è
	`memýy
(&V, (M), ())

	)

1008 
	#doubË¡Üe
(
T
,
V
è
	`memýy
((T), (*è&V, ())

	)

1009 
	#lÚglÚgg‘
(
V
,
M
è
	`memýy
(&V, (M), (
ulÚglÚg
))

	)

1010 
	#lÚglÚg¡Üe
(
T
,
V
è
	`memýy
((T), &V, (
ulÚglÚg
))

	)

1014 
	#ushÜtg‘
(
V
,
M
èdØ{ V = 
	`ušt2kÜr
(M); } 0)

	)

1015 
	#shÜtg‘
(
V
,
M
èdØ{ V = 
	`sšt2kÜr
(M); } 0)

	)

1016 
	#lÚgg‘
(
V
,
M
èdØ{ V = 
	`sšt4kÜr
(M); } 0)

	)

1017 
	#ulÚgg‘
(
V
,
M
èdØ{ V = 
	`ušt4kÜr
(M); } 0)

	)

1018 
	#shÜt¡Üe
(
T
,
V
è
	`št2¡Üe
(T,V)

	)

1019 
	#lÚg¡Üe
(
T
,
V
è
	`št4¡Üe
(T,V)

	)

1020 #iâdeà
æßt¡Üe


1021 
	#æßt¡Üe
(
T
,
V
è
	`memýy
((T), (*è(&V), ())

	)

1022 
	#æßtg‘
(
V
,
M
è
	`memýy
(&V, (M), ())

	)

1024 #iâdeà
doubËg‘


1025 
	#doubËg‘
(
V
,
M
è
	`memýy
(&V, (M), ())

	)

1026 
	#doubË¡Üe
(
T
,
V
è
	`memýy
((T), (*è&V, ())

	)

1028 
	#lÚglÚgg‘
(
V
,
M
è
	`memýy
(&V, (M), (
ulÚglÚg
))

	)

1029 
	#lÚglÚg¡Üe
(
T
,
V
è
	`memýy
((T), &V, (
ulÚglÚg
))

	)

1033 #iâdeà
THREAD


1034 
	#th»ad_§ã_šüem’t
(
V
,
L
è((V)++)

	)

1035 
	#th»ad_§ã_add
(
V
,
C
,
L
è((V)+=(C))

	)

1036 
	#th»ad_§ã_sub
(
V
,
C
,
L
è((V)-=(C))

	)

1037 
	#¡©i¡ic_šüem’t
(
V
,
L
è((V)++)

	)

1038 
	#¡©i¡ic_add
(
V
,
C
,
L
è((V)+=(C))

	)

1041 #ifdeà
_WIN32


1042 
	#SO_EXT
 ".dÎ"

	)

1044 
	#SO_EXT
 ".so"

	)

1047 #iâdeà
DBUG_OFF


1048 
	#dbug_as£¹
(
A
è
	`as£¹
(A)

	)

1049 
	#DBUG_ASSERT
(
A
è
	`as£¹
(A)

	)

1051 
	#dbug_as£¹
(
A
)

	)

1052 
	#DBUG_ASSERT
(
A
)

	)

1055 #ifdeà
HAVE_DLOPEN


1056 #ifdeà
_WIN32


1057 
	#dlsym
(
lib
, 
Çme
è
	`G‘ProcAdd»ss
((
HMODULE
)Öib),‚ame)

	)

1058 
	#dlÝ’
(
libÇme
, 
unu£d
è
	`LßdLib¿ryEx
ÖibÇme, 
NULL
, 0)

	)

1059 
	#dlþo£
(
lib
è
	`F»eLib¿ry
((
HMODULE
)Öib))

	)

1060 #–ià
defšed
(
HAVE_DLFCN_H
)

1061 
	~<dlfú.h
>

1063 #iâdeà
HAVE_DLERROR


1064 
	#dË¼Ü
(è""

	)

1068 #ià
SIZEOF_CHARP
 =ð
SIZEOF_INT


1069 
	tšŒ
;

1070 #–ià
SIZEOF_CHARP
 =ð
SIZEOF_LONG


1071 
	tšŒ
;

1072 #–ià
SIZEOF_CHARP
 =ð
SIZEOF_LONG_LONG


1073 
	tšŒ
;

1075 #”rÜ (*è
is
 
nÙ
 (, 
Ü
 )

1078 #ifdeà
_WIN32


1079 
	#IF_WIN
(
A
,
B
è
	)
A

1081 
	#IF_WIN
(
A
,
B
è
	)
B

1084 #ià
defšed
(
SOLARIS
è|| defšed(
__sun
)

1085 
	#IF_SOLARIS
(
A
,
B
è
	)
A

1087 
	#IF_SOLARIS
(
A
,
B
è
	)
B

1090 #iâdeà
RTLD_NOW


1091 
	#RTLD_NOW
 1

	)

	@include/ma_hash.h

24 #iâdeà
_ma_hash_h


25 
	#_ma_hash_h


	)

26 #ifdef 
__ýlu¥lus


30 
uch¬
 *(*
	thash_g‘_key
)(cÚ¡ 
	tuch¬
 *,
	tušt
*,
	tmy_boÞ
);

31 (*
hash_ä“_key
)(*);

34 
	#HASH_CASE_INSENSITIVE
 1

	)

36 
	s¡_hash_šfo
 {

37 
ušt
 
Ãxt
;

38 
uch¬
 *
d©a
;

39 } 
	tHASH_LINK
;

41 
	s¡_hash
 {

42 
ušt
 
key_off£t
,
key_Ëngth
;

43 
ušt
 
»cÜds
,
bËngth
,
cu¼’t_»cÜd
;

44 
ušt
 
æags
;

45 
DYNAMIC_ARRAY
 
¬¿y
;

46 
hash_g‘_key
 
g‘_key
;

47 (*
ä“
)(*);

48 
ušt
 (*
ÿlc_hashÄ
)(cÚ¡ 
uch¬
 *
key
,ušˆ
Ëngth
);

49 } 
	tHASH
;

51 
	#hash_š™
(
A
,
B
,
C
,
D
,
E
,
F
,
G
è
	`_hash_š™
(A,B,C,D,E,F,G 
CALLER_INFO
)

	)

52 
my_boÞ
 
_hash_š™
(
HASH
 *
hash
,
ušt
 
deçuÉ_¬¿y_–em’ts
, ušˆ
key_off£t
,

53 
ušt
 
key_Ëngth
, 
hash_g‘_key
 
g‘_key
,

54 (*
ä“_–em’t
)(*), 
ušt
 
æags
 
CALLER_INFO_PROTO
);

55 
hash_ä“
(
HASH
 *
Œ“
);

56 
uch¬
 *
hash_–em’t
(
HASH
 *
hash
,
ušt
 
idx
);

57 * 
hash_£¬ch
(
HASH
 *
šfo
,cÚ¡ 
uch¬
 *
key
,
ušt
 
Ëngth
);

58 * 
hash_Ãxt
(
HASH
 *
šfo
,cÚ¡ 
uch¬
 *
key
,
ušt
 
Ëngth
);

59 
my_boÞ
 
hash_š£¹
(
HASH
 *
šfo
,cÚ¡ 
uch¬
 *
d©a
);

60 
my_boÞ
 
hash_d–‘e
(
HASH
 *
hash
,
uch¬
 *
»cÜd
);

61 
my_boÞ
 
hash_upd©e
(
HASH
 *
hash
,
uch¬
 *
»cÜd
,uch¬ *
Þd_key
,
ušt
 
Þd_key_Ëngth
);

62 
my_boÞ
 
hash_check
(
HASH
 *
hash
);

64 
	#hash_þ—r
(
H
è
	`mem£t
((*è(H), 0,(*(H)))

	)

65 
	#hash_š™ed
(
H
è((H)->
¬¿y
.
bufãr
 !ð0)

	)

67 #ifdef 
__ýlu¥lus


	@include/ma_list.h

18 #iâdeà
_li¡_h_


19 
	#_li¡_h_


	)

21 #ifdef 
__ýlu¥lus


25 
	s¡_li¡
 {

26 
¡_li¡
 *
´ev
,*
Ãxt
;

27 *
d©a
;

28 } 
	tLIST
;

30 (*
li¡_w®k_aùiÚ
)(*,*);

32 
LIST
 *
li¡_add
(LIST *
roÙ
,LIST *
–em’t
);

33 
LIST
 *
li¡_d–‘e
(LIST *
roÙ
,LIST *
–em’t
);

34 
LIST
 *
li¡_cÚs
(*
d©a
,LIST *
roÙ
);

35 
LIST
 *
li¡_»v”£
(LIST *
roÙ
);

36 
li¡_ä“
(
LIST
 *
roÙ
,
ä“_d©a
);

37 
li¡_Ëngth
(
LIST
 *
li¡
);

38 
li¡_w®k
(
LIST
 *
li¡
,
li¡_w®k_aùiÚ
 
aùiÚ
,* 
¬gum’t
);

40 
	#li¡_»¡
(
a
è(×)->
Ãxt
)

	)

41 
	#li¡_push
(
a
,
b
è×)=
	`li¡_cÚs
((b),×))

	)

42 
	#li¡_pÝ
(
A
èdØ{
LIST
 *
Þd
=(A); (A)=
	`li¡_d–‘e
(Þd,Þdè; 
	`ma_ä“
((*èÞd,
	`MYF
(
MY_FAE
)); } 0)

	)

44 #ifdef 
__ýlu¥lus


	@include/ma_priv.h

22 #iâdeà
MA_PRIV_H


23 
	#MA_PRIV_H


	)

25 
ä“_rows
(
MYSQL_DATA
 *
cur
);

26 
ma_muÉi_commªd
(
MYSQL
 *
mysql
, 
’um_muÉi_¡©us
 
¡©us
);

27 
MYSQL_FIELD
 * 
uÅack_f›lds
(cÚ¡ 
MYSQL
 *
mysql
, 
MYSQL_DATA
 *
d©a
,

28 
MA_MEM_ROOT
 *
®loc
,
ušt
 
f›lds
,

29 
my_boÞ
 
deçuÉ_v®ue
);

31 
šlše
 
my_boÞ
 
	$ma_has_ex‹nded_ty³_šfo
(cÚ¡ 
MYSQL
 *
mysql
)

33  ((
mysql
->
ex‹nsiÚ
->
m¬Ÿdb_£rv”_ÿ·bž™›s
) &

34 (
MARIADB_CLIENT_EXTENDED_METADATA
 >> 32)) != 0;

35 
	}
}

37 
šlše
 
ušt
 
	$ma_ex‹nded_ty³_šfo_rows
(cÚ¡ 
MYSQL
 *
mysql
)

39  
	`ma_has_ex‹nded_ty³_šfo
(
mysql
) ? 1 : 0;

40 
	}
}

42 
šlše
 
ušt
 
	$ma_»suÉ_£t_rows
(cÚ¡ 
MYSQL
 *
mysql
)

44  
	`ma_has_ex‹nded_ty³_šfo
(
mysql
) ? 9 : 8;

45 
	}
}

47 
MA_FIELD_EXTENSION
 *
ma_f›ld_ex‹nsiÚ_d“p_dup
(
MA_MEM_ROOT
 *
memroÙ
,

48 cÚ¡ 
MA_FIELD_EXTENSION
 *
äom
);

	@include/ma_pthread.h

21 #iâdeà
_my_±h»ad_h


22 
	#_my_±h»ad_h


	)

24 #ià
defšed
(
_WIN32
)

25 
	~<wšdows.h
>

26 
CRITICAL_SECTION
 
	t±h»ad_mu‹x_t
;

27 
	#±h»ad_mu‹x_š™
(
A
,
B
è
	`In™ŸlizeCr™iÿlSeùiÚ
(A)

	)

28 
	#±h»ad_mu‹x_lock
(
A
è(
	`EÁ”Cr™iÿlSeùiÚ
(A),0)

	)

29 
	#±h»ad_mu‹x_uÆock
(
A
è
	`L—veCr™iÿlSeùiÚ
(A)

	)

30 
	#±h»ad_mu‹x_de¡roy
(
A
è
	`D–‘eCr™iÿlSeùiÚ
(A)

	)

31 
	#±h»ad_£lf
(è
	`G‘Cu¼’tTh»adId
()

	)

	@include/ma_pvio.h

1 #iâdeà
_ma_pvio_h_


2 
	#_ma_pvio_h_


	)

3 
	#cio_defšed


	)

5 #ifdeà
HAVE_TLS


6 
	~<ma_Žs.h
>

8 
	#MARIADB_TLS
 

	)

13 #ià!
defšed
(
_glob®_h
è&& !defšed(
MY_GLOBAL_INCLUDED
)

14 
	tuch¬
;

17 
	#PVIO_SET_ERROR
 ià(
pvio
->
£t_”rÜ
) \

18 
pvio
->
£t_”rÜ


	)

20 
	#PVIO_READ_AHEAD_CACHE_SIZE
 16384

	)

21 
	#PVIO_READ_AHEAD_CACHE_MIN_SIZE
 2048

	)

22 
	#PVIO_EINTR_TRIES
 2

	)

24 
	g¡_ma_pvio_m‘hods
;

25 
¡_ma_pvio_m‘hods
 
	tPVIO_METHODS
;

27 
	#IS_PVIO_ASYNC
(
a
) \

28 ((
a
)->
mysql
 && (a)->mysql->
ÝtiÚs
.
ex‹nsiÚ
 && (a)->mysql->ÝtiÚs.ex‹nsiÚ->
async_cÚ‹xt
)

	)

30 
	#IS_PVIO_ASYNC_ACTIVE
(
a
) \

31 (
	`IS_PVIO_ASYNC
(
a
)&& (a)->
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
async_cÚ‹xt
->
aùive
)

	)

33 
	#IS_MYSQL_ASYNC
(
a
) \

34 ((
a
)->
ÝtiÚs
.
ex‹nsiÚ
 && (a)->ÝtiÚs.ex‹nsiÚ->
async_cÚ‹xt
)

	)

36 
	#IS_MYSQL_ASYNC_ACTIVE
(
a
) \

37 (
	`IS_MYSQL_ASYNC
(
a
)&& (a)->
ÝtiÚs
.
ex‹nsiÚ
->
async_cÚ‹xt
->
aùive
)

	)

39 
	e’um_pvio_timeout
 {

40 
	mPVIO_CONNECT_TIMEOUT
= 0,

41 
	mPVIO_READ_TIMEOUT
,

42 
	mPVIO_WRITE_TIMEOUT


45 
	e’um_pvio_io_ev’t


47 
	mVIO_IO_EVENT_READ
,

48 
	mVIO_IO_EVENT_WRITE
,

49 
	mVIO_IO_EVENT_CONNECT


52 
	e’um_pvio_ty³
 {

53 
	mPVIO_TYPE_UNIXSOCKET
= 0,

54 
	mPVIO_TYPE_SOCKET
,

55 
	mPVIO_TYPE_NAMEDPIPE
,

56 
	mPVIO_TYPE_SHAREDMEM
,

59 
	e’um_pvio_Ý”©iÚ
 {

60 
	mPVIO_READ
= 0,

61 
	mPVIO_WRITE
=1

64 
	#SHM_DEFAULT_NAME
 "MYSQL"

	)

66 
	g¡_pvio_ÿÎback
;

68 
	s¡_pvio_ÿÎback
 {

69 (*
	mÿÎback
)(
MYSQL
 *
	mmysql
, 
uch¬
 *
	mbufãr
, 
size_t
 
	msize
);

70 
¡_pvio_ÿÎback
 *
	mÃxt
;

71 } 
	tPVIO_CALLBACK
;

73 
	s¡_ma_pvio
 {

74 *
	md©a
;

76 
uch¬
 *
	mÿche
;

77 
uch¬
 *
	mÿche_pos
;

78 
size_t
 
	mÿche_size
;

79 
’um_pvio_ty³
 
	mty³
;

80 
	mtimeout
[3];

81 
	ms¦_ty³
;

82 
MARIADB_TLS
 *
	mùls
;

83 
MYSQL
 *
	mmysql
;

84 
PVIO_METHODS
 *
	mm‘hods
;

85 (*
	m£t_”rÜ
)(
MYSQL
 *
	mmysql
, 
	m”rÜ_Ä
, cÚ¡ *
	msql¡©e
, cÚ¡ *
	mfÜm©
, ...);

86 (*
	mÿÎback
)(
MARIADB_PVIO
 *
	mpvio
, 
my_boÞ
 
	mis_»ad
, cÚ¡ 
uch¬
 *
	mbufãr
, 
size_t
 
	mËngth
);

89 
	s¡_ma_pvio_cšfo


91 cÚ¡ *
	mho¡
;

92 cÚ¡ *
	munix_sock‘
;

93 
	mpÜt
;

94 
’um_pvio_ty³
 
	mty³
;

95 
MYSQL
 *
	mmysql
;

96 } 
	tMA_PVIO_CINFO
;

98 
	s¡_ma_pvio_m‘hods


100 
my_boÞ
 (*
£t_timeout
)(
MARIADB_PVIO
 *
	mpvio
, 
’um_pvio_timeout
 
	mty³
, 
	mtimeout
);

101 (*
	mg‘_timeout
)(
MARIADB_PVIO
 *
	mpvio
, 
’um_pvio_timeout
 
	mty³
);

102 
ssize_t
 (*
»ad
)(
MARIADB_PVIO
 *
	mpvio
, 
uch¬
 *
	mbufãr
, 
size_t
 
	mËngth
);

103 
ssize_t
 (*
async_»ad
)(
MARIADB_PVIO
 *
	mpvio
, 
uch¬
 *
	mbufãr
, 
size_t
 
	mËngth
);

104 
ssize_t
 (*
wr™e
)(
MARIADB_PVIO
 *
	mpvio
, cÚ¡ 
uch¬
 *
	mbufãr
, 
size_t
 
	mËngth
);

105 
ssize_t
 (*
async_wr™e
)(
MARIADB_PVIO
 *
	mpvio
, cÚ¡ 
uch¬
 *
	mbufãr
, 
size_t
 
	mËngth
);

106 (*
	mwa™_io_Ü_timeout
)(
MARIADB_PVIO
 *
	mpvio
, 
my_boÞ
 
	mis_»ad
, 
	mtimeout
);

107 (*
	mblockšg
)(
MARIADB_PVIO
 *
	mpvio
, 
my_boÞ
 
	mv®ue
, my_boÞ *
	mÞd_v®ue
);

108 
my_boÞ
 (*
cÚÃù
)(
MARIADB_PVIO
 *
	mpvio
, 
MA_PVIO_CINFO
 *
	mcšfo
);

109 
my_boÞ
 (*
þo£
)(
MARIADB_PVIO
 *
	mpvio
);

110 (*
	mç¡_£nd
)(
MARIADB_PVIO
 *
	mpvio
);

111 (*
	mk“·live
)(
MARIADB_PVIO
 *
	mpvio
);

112 
my_boÞ
 (*
g‘_hªdË
)(
MARIADB_PVIO
 *
	mpvio
, *
	mhªdË
);

113 
my_boÞ
 (*
is_blockšg
)(
MARIADB_PVIO
 *
	mpvio
);

114 
my_boÞ
 (*
is_®ive
)(
MARIADB_PVIO
 *
	mpvio
);

115 
my_boÞ
 (*
has_d©a
)(
MARIADB_PVIO
 *
	mpvio
, 
ssize_t
 *
	md©a_Ën
);

116 (*
	mshutdown
)(
MARIADB_PVIO
 *
	mpvio
);

120 
MARIADB_PVIO
 *
ma_pvio_š™
(
MA_PVIO_CINFO
 *
cšfo
);

121 
ma_pvio_þo£
(
MARIADB_PVIO
 *
pvio
);

122 
ssize_t
 
ma_pvio_ÿche_»ad
(
MARIADB_PVIO
 *
pvio
, 
uch¬
 *
bufãr
, 
size_t
 
Ëngth
);

123 
ssize_t
 
ma_pvio_»ad
(
MARIADB_PVIO
 *
pvio
, 
uch¬
 *
bufãr
, 
size_t
 
Ëngth
);

124 
ssize_t
 
ma_pvio_wr™e
(
MARIADB_PVIO
 *
pvio
, cÚ¡ 
uch¬
 *
bufãr
, 
size_t
 
Ëngth
);

125 
ma_pvio_g‘_timeout
(
MARIADB_PVIO
 *
pvio
, 
’um_pvio_timeout
 
ty³
);

126 
my_boÞ
 
ma_pvio_£t_timeout
(
MARIADB_PVIO
 *
pvio
, 
’um_pvio_timeout
 
ty³
, 
timeout
);

127 
ma_pvio_ç¡_£nd
(
MARIADB_PVIO
 *
pvio
);

128 
ma_pvio_k“·live
(
MARIADB_PVIO
 *
pvio
);

129 
my_sock‘
 
ma_pvio_g‘_sock‘
(
MARIADB_PVIO
 *
pvio
);

130 
my_boÞ
 
ma_pvio_is_blockšg
(
MARIADB_PVIO
 *
pvio
);

131 
my_boÞ
 
ma_pvio_blockšg
(
MARIADB_PVIO
 *
pvio
, my_boÞ 
block
, my_boÞ *
´evious_mode
);

132 
my_boÞ
 
ma_pvio_is_blockšg
(
MARIADB_PVIO
 *
pvio
);

133 
ma_pvio_wa™_io_Ü_timeout
(
MARIADB_PVIO
 *
pvio
, 
my_boÞ
 
is_»ad
, 
timeout
);

134 
my_boÞ
 
ma_pvio_cÚÃù
(
MARIADB_PVIO
 *
pvio
, 
MA_PVIO_CINFO
 *
cšfo
);

135 
my_boÞ
 
ma_pvio_is_®ive
(
MARIADB_PVIO
 *
pvio
);

136 
my_boÞ
 
ma_pvio_g‘_hªdË
(
MARIADB_PVIO
 *
pvio
, *
hªdË
);

137 
my_boÞ
 
ma_pvio_has_d©a
(
MARIADB_PVIO
 *
pvio
, 
ssize_t
 *
Ëngth
);

	@include/ma_server_error.h

2 
	~"mysqld_”rÜ.h
"

	@include/ma_sha1.h

24 #iâdeà
SHA1_H


25 
	#SHA1_H


	)

27 
	#SHA1_MAX_LENGTH
 20

	)

28 
	#SCRAMBLE_LENGTH
 20

	)

29 
	#SCRAMBLE_LENGTH_323
 8

	)

33 
ušt32
 
	m¡©e
[5];

34 
ušt32
 
	mcouÁ
[2];

35 
	mbufãr
[64];

36 } 
	t_MA_SHA1_CTX
;

38 
ma_SHA1In™
(
_MA_SHA1_CTX
 *);

39 
ma_SHA1Upd©e
(
_MA_SHA1_CTX
 *, cÚ¡ *, 
size_t
);

40 
ma_SHA1Fš®
([20], 
_MA_SHA1_CTX
 *);

	@include/ma_string.h

21 #iâdeà
_ma_¡ršg_h_


22 
	#_ma_¡ršg_h_


	)

24 
	~<¡ršg.h
>

27 
	mMY_GCVT_ARG_FLOAT
,

28 
	mMY_GCVT_ARG_DOUBLE


29 } 
	tmy_gcvt_¬g_ty³
;

31 
size_t
 
ma_fcvt
(
x
, 
´ecisiÚ
, *
to
, 
my_boÞ
 *
”rÜ
);

32 
size_t
 
ma_gcvt
(
x
, 
my_gcvt_¬g_ty³
 
ty³
, 
width
, *
to
,

33 
my_boÞ
 *
”rÜ
);

34 *
ma_Î2¡r
(
v®
,*
d¡
, 
¿dix
);

36 
	#MAX_ENV_SIZE
 1024

	)

38 
šlše
 
my_boÞ
 
	$ma_check_’v_¡r
(cÚ¡ *
’v
)

40 
i
;

42 ià(!
’v
)

45 
i
=0; i < 
MAX_ENV_SIZE
; i++)

47 ià(
’v
[
i
] == 0)

50 ià(
i
 >ð
MAX_ENV_SIZE
)

53 
	}
}

	@include/ma_sys.h

18 #iâdeà
_my_sys_h


19 
	#_my_sys_h


	)

20 #ifdef 
__ýlu¥lus


24 #ifdeà
HAVE_AIOWAIT


25 
	~<sys/asynch.h
>

26 
	smy_aio_»suÉ
 {

27 
aio_»suÉ_t
 
»suÉ
;

28 
³ndšg
;

29 } 
	tmy_aio_»suÉ
;

32 #iâdeà
_m¬Ÿdb_ùy³_h


33 
	~<m¬Ÿdb_ùy³.h
>

36 
	~<¡d¬g.h
>

38 
	#MYSYS_PROGRAM_USES_CURSES
() \

40 
ma_”rÜ_hªdËr_hook
 = 
ma_mes§ge_cur£s
;\

41 
mysys_u£s_cur£s
=1;\

42 } 0)

	)

43 
	#MYSYS_PROGRAM_DONT_USE_CURSES
() \

45 
ma_”rÜ_hªdËr_hook
 = 
ma_mes§ge_no_cur£s
; \

46 
mysys_u£s_cur£s
=0; \

47 } 0)

	)

48 
	#MY_INIT
(
Çme
) \

50 
ma_´ogÇme
ð
Çme
;\

51 
	`ma_š™
();\

52 } 0)

	)

54 
	#MAXMAPS
 (4è

	)

55 
	#ERRMOD
 (1000è

	)

56 
	#ERRMSGSIZE
 (
SC_MAXWIDTH
è

	)

57 
	#NRERRBUFFS
 (2è

	)

58 
	#MY_FILE_ERROR
 ((
ušt
è~0)

	)

61 
	#MY_FFNF
 1

	)

62 
	#MY_FNABP
 2

	)

63 
	#MY_NABP
 4

	)

64 
	#MY_FAE
 8

	)

65 
	#MY_WME
 16

	)

66 
	#MY_WAIT_IF_FULL
 32

	)

67 
	#MY_RAID
 64

	)

68 
	#MY_DONT_CHECK_FILESIZE
 128

	)

69 
	#MY_LINK_WARNING
 32

	)

70 
	#MY_COPYTIME
 64

	)

71 
	#MY_DELETE_OLD
 256

	)

72 
	#MY_RESOLVE_LINK
 128

	)

73 
	#MY_HOLD_ORIGINAL_MODES
 128

	)

74 
	#MY_REDEL_MAKE_BACKUP
 256

	)

75 
	#MY_SEEK_NOT_DONE
 32

	)

76 
	#MY_DONT_WAIT
 64

	)

77 
	#MY_ZEROFILL
 32

	)

78 
	#MY_ALLOW_ZERO_PTR
 64

	)

79 
	#MY_FREE_ON_ERROR
 128

	)

80 
	#MY_HOLD_ON_ERROR
 256

	)

81 
	#MY_THREADSAFE
 128

	)

82 
	#MY_DONT_OVERWRITE_FILE
 1024

	)

84 
	#MY_CHECK_ERROR
 1

	)

85 
	#MY_GIVE_INFO
 2

	)

87 
	#ME_HIGHBYTE
 8

	)

88 
	#ME_NOCUR
 1

	)

89 
	#ME_OLDWIN
 2

	)

90 
	#ME_BELL
 4

	)

91 
	#ME_HOLDTANG
 8

	)

92 
	#ME_WAITTOT
 16

	)

93 
	#ME_WAITTANG
 32

	)

94 
	#ME_NOREFRESH
 64

	)

95 
	#ME_NOINPUT
 128

	)

96 
	#ME_COLOUR1
 ((1 << 
ME_HIGHBYTE
)è

	)

97 
	#ME_COLOUR2
 ((2 << 
ME_HIGHBYTE
))

	)

98 
	#ME_COLOUR3
 ((3 << 
ME_HIGHBYTE
))

	)

101 
	#MY_SEEK_SET
 0

	)

102 
	#MY_SEEK_CUR
 1

	)

103 
	#MY_SEEK_END
 2

	)

106 
	#MY_NO_SETS
 0

	)

107 
	#MY_COMPILED_SETS
 1

	)

108 
	#MY_CONFIG_SETS
 2

	)

109 
	#MY_INDEX_SETS
 4

	)

110 
	#MY_LOADED_SETS
 8

	)

113 
	#MY_WAIT_FOR_USER_TO_FIX_PANIC
 60

	)

114 
	#MY_WAIT_GIVE_USER_A_MESSAGE
 10

	)

115 
	#MIN_COMPRESS_LENGTH
 50

	)

116 
	#KEYCACHE_BLOCK_SIZE
 1024

	)

119 
	#MY_KEEP_PREALLOC
 1

	)

123 
	#my_checkm®loc
(è(0)

	)

124 #undeà
TERMINATE


125 
	#TERMINATE
(
A
è{}

	)

126 
	#QUICK_SAFEMALLOC


	)

127 
	#NORMAL_SAFEMALLOC


	)

128 
	#ma_m®loc_ci
(
SZ
,
FLAG
è
	`ma_m®loc
ÐSZ, FLAG )

	)

129 
	#CALLER_INFO_PROTO


	)

130 
	#CALLER_INFO


	)

131 
	#ORIG_CALLER_INFO


	)

133 #ifdeà
HAVE_ALLOCA


134 #ià
defšed
(
_AIX
è&& !defšed(
__GNUC__
)

135 #´agm¨
®loÿ


137 #ià
defšed
(
__GNUC__
è&& !defšed(
HAVE_ALLOCA_H
)

138 #iâdeà
®loÿ


139 
	#®loÿ
 
__bužtš_®loÿ


	)

142 
	#my_®loÿ
(
SZ
è
	`®loÿ
((
size_t
è(SZ))

	)

143 
	#my_aä“
(
PTR
è{}

	)

145 
	#my_®loÿ
(
SZ
è
	`ma_m®loc
(SZ,
	`MYF
(0))

	)

146 
	#my_aä“
(
PTR
è
	`ma_ä“
(PTR)

	)

149 #iâdeà
”ºo


150 #ifdeà
HAVE_ERRNO_AS_DEFINE


151 
	~<”ºo.h
>

153 
”ºo
;

156 cÚ¡ ** 
NEAR
 
my_”rmsg
[];

157 
NEAR
 
”rbuff
[
NRERRBUFFS
][
ERRMSGSIZE
];

174 
MARIADB_CHARSET_INFO
 *
g‘_ch¬£t
(
ušt
 
cs_numb”
, 
myf
 
æags
);

175 
MARIADB_CHARSET_INFO
 *
g‘_ch¬£t_by_Çme
(cÚ¡ *
cs_Çme
);

176 
MARIADB_CHARSET_INFO
 *
g‘_ch¬£t_by_Ä
(
ušt
 
cs_numb”
);

179 *
ma_¡rmake
(*
d¡
, cÚ¡ *
¤c
, 
size_t
 
Ëngth
);

182 #ifdeà
TBR


183 
ulÚg
 
_my_ÿche_w_»que¡s
,
_my_ÿche_wr™e
,
_my_ÿche_r_»que¡s
,

184 
_my_ÿche_»ad
;

185 
ulÚg
 
_my_blocks_u£d
,
_my_blocks_chªged
;

186 
ulÚg
 
ma_fže_Ý’ed
,
ma_¡»am_Ý’ed
, 
ma_tmp_fže_ü—‹d
;

187 
my_boÞ
 
key_ÿche_š™ed
;

190 (*
my_sigt¡p_þ—nup
)(),

192 (*
my_sigt¡p_»¡¬t
)(),

193 (*
my_abÜt_hook
)();

195 
NEAR
 
ma_umask
,

196 
NEAR
 
ma_umask_dœ
,

197 
NEAR
 
my_»cived_sigÇls
,

198 
NEAR
 
my_§ã_to_hªdË_sigÇl
,

199 
NEAR
 
ma_dÚt_š‹¼u±
;

200 
my_boÞ
 
NEAR
 
mysys_u£s_cur£s
, 
ma_u£_symdœ
;

201 
size_t
 
lCurMemÜy
,
lMaxMemÜy
;

203 
ulÚg
 
ma_deçuÉ_»cÜd_ÿche_size
;

204 
my_boÞ
 
NEAR
 
ma_di§bË_lockšg
,NEAR 
ma_di§bË_async_io
,

205 
NEAR
 
ma_di§bË_æush_key_blocks
, NEAR 
ma_di§bË_symlšks
;

206 
wžd_mªy
,
wžd_Úe
,
wžd_´efix
;

207 cÚ¡ *
ch¬£ts_dœ
;

208 *
deçuÉs_exŒa_fže
;

209 
	swžd_fže_·ck


211 
ušt
 
	gwžds
;

212 
ušt
 
	gnÙ_pos
;

213 
my_¡ršg
 *
	gwžd
;

214 } 
	tWF_PACK
;

216 
	smy_ºd_¡ruù
 {

217 
	g£ed1
,
	g£ed2
,
	gmax_v®ue
;

218 
	gmax_v®ue_dbl
;

222 
	s¡_ty³lib
 {

223 
ušt
 
	gcouÁ
;

224 cÚ¡ *
	gÇme
;

225 cÚ¡ **
	gty³_Çmes
;

226 } 
	tTYPELIB
;

228 
	eÿche_ty³
 {
	gREAD_CACHE
,
	gWRITE_CACHE
,
	gREAD_FIFO
,
	gREAD_NET
,
	gWRITE_NET
};

229 
	eæush_ty³
 { 
	gFLUSH_KEEP
, 
	gFLUSH_RELEASE
, 
	gFLUSH_IGNORE_CHANGED
,

230 
	gFLUSH_FORCE_WRITE
};

232 
	s¡_»cÜd_ÿche


234 
Fže
 
	gfže
;

235 
	grc_£ek
,
	g”rÜ
,
	gš™ed
;

236 
ušt
 
	grc_Ëngth
,
	g»ad_Ëngth
,
	g»þ’gth
;

237 
my_off_t
 
	grc_»cÜd_pos
,
	g’d_of_fže
;

238 *
	grc_buff
,*
	grc_buff2
,*
	grc_pos
,*
	grc_’d
,*
	grc_»que¡_pos
;

239 #ifdeà
HAVE_AIOWAIT


240 
	gu£_async_io
;

241 
my_aio_»suÉ
 
	gaio_»suÉ
;

243 
ÿche_ty³
 
	gty³
;

244 } 
	tRECORD_CACHE
;

247 
	s¡_dyÇmic_¬¿y
 {

248 *
	gbufãr
;

249 
ušt
 
	g–em’ts
,
	gmax_–em’t
;

250 
ušt
 
	g®loc_šüem’t
;

251 
ušt
 
	gsize_of_–em’t
;

252 } 
	tDYNAMIC_ARRAY
;

254 
	s¡_dyÇmic_¡ršg
 {

255 *
	g¡r
;

256 
size_t
 
	gËngth
,
	gmax_Ëngth
,
	g®loc_šüem’t
;

257 } 
	tDYNAMIC_STRING
;

260 
	s¡_io_ÿche


262 
my_off_t
 
	gpos_š_fže
,
	g’d_of_fže
;

263 *
	grc_pos
,*
	grc_’d
,*
	gbufãr
,*
	grc_»que¡_pos
;

264 (*
	g»ad_funùiÚ
)(
	g¡_io_ÿche
 *,*,
	gušt
);

265 *
	gfže_Çme
;

266 *
	gdœ
,*
	g´efix
;

267 
Fže
 
	gfže
;

268 
	g£ek_nÙ_dÚe
,
	g”rÜ
;

269 
ušt
 
	gbufãr_Ëngth
,
	g»ad_Ëngth
;

270 
myf
 
	gmyæags
;

271 
ÿche_ty³
 
	gty³
;

272 #ifdeà
HAVE_AIOWAIT


273 
ušt
 
	gš™ed
;

274 
my_off_t
 
	gaio_»ad_pos
;

275 
my_aio_»suÉ
 
	gaio_»suÉ
;

277 } 
	tIO_CACHE
;

279 (*
	gqsÜt2_cmp
)(const *, const *, const *);

284 
	#my_b_þ—r
(
šfo
èdo{(šfo)->
bufãr
ð0;} 0)

	)

285 
	#my_b_š™ed
(
šfo
è((šfo)->
bufãr
)

	)

286 
	#my_b_EOF
 
INT_MIN


	)

288 
	#my_b_»ad
(
šfo
,
Bufãr
,
CouÁ
) \

289 ((
šfo
)->
rc_pos
 + (
CouÁ
è<ð(šfo)->
rc_’d
 ?\

290 (
	`memýy
((
Bufãr
),(
šfo
)->
rc_pos
,(
size_t
è(
CouÁ
)), \

291 ((
šfo
)->
rc_pos
+=(
CouÁ
)),0) :\

292 (*(
šfo
)->
»ad_funùiÚ
)((šfo),(
Bufãr
),(
CouÁ
)))

	)

294 
	#my_b_g‘
(
šfo
) \

295 ((
šfo
)->
rc_pos
 !ð(šfo)->
rc_’d
 ?\

296 ((
šfo
)->
rc_pos
++, (è(
uch¬
) (info)->rc_pos[-1]) :\

297 
	`_my_b_g‘
(
šfo
))

	)

299 
	#my_b_wr™e
(
šfo
,
Bufãr
,
CouÁ
) \

300 ((
šfo
)->
rc_pos
 + (
CouÁ
è<ð(šfo)->
rc_’d
 ?\

301 (
	`memýy
((
šfo
)->
rc_pos
,(
Bufãr
),(
size_t
è(
CouÁ
)), \

302 ((
šfo
)->
rc_pos
+=(
CouÁ
)),0) :\

303 
	`_my_b_wr™e
((
šfo
),(
Bufãr
),(
CouÁ
)))

	)

306 
	#my_b_wr™e_by‹
(
šfo
,
chr
) \

307 (((
šfo
)->
rc_pos
 < (šfo)->
rc_’d
) ?\

308 ((*(
šfo
)->
rc_pos
++)=(
chr
)) :\

309 (
	`_my_b_wr™e
((
šfo
),0,0è, ((*(šfo)->
rc_pos
++)=(
chr
))))

	)

311 
	#my_b_fžl_ÿche
(
šfo
) \

312 (((
šfo
)->
rc_’d
=(šfo)->
rc_pos
),(*(šfo)->
»ad_funùiÚ
)((šfo),0,0))

	)

314 
	#my_b_‹Î
(
šfo
è((šfo)->
pos_š_fže
 + \

315 ((
šfo
)->
rc_pos
 - (šfo)->
rc_»que¡_pos
))

	)

317 
	#my_b_by‹s_š_ÿche
(
šfo
è((
ušt
è((šfo)->
rc_’d
 - (šfo)->
rc_pos
))

	)

319 
	s¡_chªg—bË_v¬
 {

320 cÚ¡ *
	gÇme
;

321 *
	gv¬±r
;

322 
	gdef_v®ue
,

323 
	gmš_v®ue
,

324 
	gmax_v®ue
,

325 
	gsub_size
,

326 
	gblock_size
;

327 } 
	tCHANGEABLE_VAR
;

332 #iâdeà
ST_MA_USED_MEM_DEFINED


333 
	#ST_MA_USED_MEM_DEFINED


	)

334 
	s¡_ma_u£d_mem
 {

335 
¡_ma_u£d_mem
 *
	gÃxt
;

336 
size_t
 
	gËá
;

337 
size_t
 
	gsize
;

338 } 
	tMA_USED_MEM
;

340 
	s¡_ma_mem_roÙ
 {

341 
MA_USED_MEM
 *
	gä“
;

342 
MA_USED_MEM
 *
	gu£d
;

343 
MA_USED_MEM
 *
	g´e_®loc
;

344 
size_t
 
	gmš_m®loc
;

345 
size_t
 
	gblock_size
;

346 
	gblock_num
;

347 
	gfœ¡_block_u§ge
;

348 (*
	g”rÜ_hªdËr
)();

349 } 
	tMA_MEM_ROOT
;

354 * 
_mym®loc
(
size_t
 
uSize
,cÚ¡ *
sFže
,

355 
ušt
 
uLše
, 
myf
 
MyFÏg
);

356 * 
_my»®loc
(* 
pPŒ
,
size_t
 
uSize
,cÚ¡ *
sFže
,

357 
ušt
 
uLše
, 
myf
 
MyFÏg
);

358 *
ma_muÉi_m®loc
(
myf
 
MyFÏgs
, ...);

359 
_myä“
(* 
pPŒ
,cÚ¡ *
sFže
,
ušt
 
uLše
, 
myf
 
MyFÏg
);

360 
_§n™y
(cÚ¡ *
sFže
,
uLše
);

361 #iâdeà
TERMINATE


362 
TERMINATE
(
FILE
 *
fže
);

364 
ma_š™_glob_”rs
();

365 
FILE
 *
my_fÝ’
(cÚ¡ *
FžeName
,
FÏgs
,
myf
 
MyFÏgs
);

366 
FILE
 *
my_fdÝ’
(
Fže
 
Fžedes
,cÚ¡ *
Çme
, 
FÏgs
,
myf
 
MyFÏgs
);

367 
my_fþo£
(
FILE
 *
fd
,
myf
 
MyFÏgs
);

368 
my_chsize
(
Fže
 
fd
,
my_off_t
 
ÃwËngth
,
myf
 
MyFÏgs
);

369 
ma_”rÜ
 
_VARARGS
((
Ä
,
myf
 
MyFÏgs
, ...));

370 
ma_´štf_”rÜ
 
_VARARGS
((
ušt
 
my_”r
, cÚ¡ *
fÜm©
,

371 
myf
 
MyFÏgs
, ...)

372 
__©Œibu‹__
 ((
fÜm©
 (
´štf
, 2, 4))));

373 
ma_v¢´štf
Ð*
¡r
, 
size_t
 
n
,

374 cÚ¡ *
fÜm©
, 
va_li¡
 
­
 );

375 
ma_¢´štf
(* 
to
, 
size_t
 
n
, cÚ¡ * 
fmt
, ...);

376 
ma_mes§ge
(
ušt
 
my_”r
, cÚ¡ *
¡r
,
myf
 
MyFÏgs
);

377 
_m¬Ÿdb_¡d”r_out
(
”rÜ
, cÚ¡ *
”rmsg
, 
myf
 
MyFÏgs
);

379 
ma_š™
();

380 
ma_’d
(
šfoæag
);

381 
my_»d–
(cÚ¡ *
äom
, cÚ¡ *
to
, 
MyFÏgs
);

382 
my_cÝy¡©
(cÚ¡ *
äom
, cÚ¡ *
to
, 
MyFÏgs
);

383 
my_¡ršg
 
my_fž’ame
(
Fže
 
fd
);

385 #iâdeà
THREAD


386 
dÚt_b»ak
();

387 
®low_b»ak
();

389 
	#dÚt_b»ak
()

	)

390 
	#®low_b»ak
()

	)

393 
ÿ£up
(
my_¡ršg
 
¡r
,
ušt
 
Ëngth
);

394 
ÿ£dn
(
my_¡ršg
 
¡r
,
ušt
 
Ëngth
);

395 
ÿ£up_¡r
(
my_¡ršg
 
¡r
);

396 
ÿ£dn_¡r
(
my_¡ršg
 
¡r
);

397 
ÿ£_sÜt
(
my_¡ršg
 
¡r
,
ušt
 
Ëngth
);

398 
ušt
 
ma_dœÇme_·¹
(
my_¡ršg
 
to
,cÚ¡ *
Çme
);

399 
ušt
 
ma_dœÇme_Ëngth
(cÚ¡ *
Çme
);

400 
	#ba£_Çme
(
A
è((A)+
	`dœÇme_Ëngth
(A))

	)

401 
‹¡_if_h¬d_·th
(cÚ¡ *
dœ_Çme
);

402 *
ma_cÚv”t_dœÇme
(
my_¡ršg
 
Çme
);

403 
to_unix_·th
(
my_¡ršg
 
Çme
);

404 
my_¡ršg
 
ma_â_ext
(cÚ¡ *
Çme
);

405 
my_¡ršg
 
â_§me
(my_¡ršg 
tÚame
,cÚ¡ *
Çme
,
æag
);

406 
my_¡ršg
 
ma_â_fÜm©
(my_¡ršg 
to
,cÚ¡ *
Çme
,cÚ¡ *
dsk
,

407 cÚ¡ *
fÜm
,
æag
);

408 
size_s
 
ma_¡¾’gth
(cÚ¡ *
¡r
);

409 
ma_·ck_dœÇme
(
my_¡ršg
 
to
,cÚ¡ *
äom
);

410 
ušt
 
unma_·ck_dœÇme
(
my_¡ršg
 
to
,cÚ¡ *
äom
);

411 
ušt
 
ma_þ—nup_dœÇme
(
my_¡ršg
 
to
,cÚ¡ *
äom
);

412 
ušt
 
ma_sy¡em_fž’ame
(
my_¡ršg
 
to
,cÚ¡ *
äom
);

413 
my_¡ršg
 
ma_uÅack_fž’ame
(my_¡ršg 
to
,cÚ¡ *
äom
);

414 
my_¡ršg
 
ma_š‹º_fž’ame
(my_¡ršg 
to
,cÚ¡ *
äom
);

415 
my_¡ršg
 
dœeùÜy_fže_Çme
(my_¡ršg 
d¡
, cÚ¡ *
¤c
);

416 
·ck_fž’ame
(
my_¡ršg
 
to
, cÚ¡ *
Çme
, 
size_s
 
max_Ëngth
);

417 
my_¡ršg
 
my_·th
(my_¡ršg 
to
,cÚ¡ *
´ogÇme
,

418 cÚ¡ *
own_·thÇme_·¹
);

419 
my_¡ršg
 
my_lßd_·th
(my_¡ršg 
to
, cÚ¡ *
·th
,

420 cÚ¡ *
own_·th_´efix
);

421 
wžd_com·»
(cÚ¡ *
¡r
,cÚ¡ *
wžd¡r
);

422 
my_¡ršg
 
my_¡rÿ£¡r
(cÚ¡ *
¤c
,cÚ¡ *
suffix
);

423 
my_¡rÿ£cmp
(cÚ¡ *
s
,cÚ¡ *
t
);

424 
my_¡rsÜtcmp
(cÚ¡ *
s
,cÚ¡ *
t
);

425 
my_ÿ£cmp
(cÚ¡ *
s
,cÚ¡ *
t
,
ušt
 
Ëngth
);

426 
my_sÜtcmp
(cÚ¡ *
s
,cÚ¡ *
t
,
ušt
 
Ëngth
);

427 
my_sÜŠcmp
(cÚ¡ *
s
,
ušt
 
s_Ën
, cÚ¡ *
t
,ušˆ
t_Ën
);

428 #ifdeà
TBR


429 
WF_PACK
 *
wf_comp
(
my_¡ršg
 
¡r
);

430 
wf_‹¡
(
wžd_fže_·ck
 *
wf_·ck
,cÚ¡ *
Çme
);

431 
wf_’d
(
wžd_fže_·ck
 *
bufãr
);

432 
size_s
 
¡r_¥
(
my_¡ršg
 
¡r
);

433 
g‘_d©e
(
my_¡ršg
 
to
,
timeæag
,
time_t
 
u£_time
);

434 
soundex
(
my_¡ršg
 
out_²Œ
, my_¡ršg 
š_²Œ
,
pboÞ
 
»move_g¬bage
);

435 
š™_»cÜd_ÿche
(
RECORD_CACHE
 *
šfo
,
ušt
 
ÿchesize
,
Fže
 
fže
,

436 
ušt
 
»þ’gth
,
ÿche_ty³
 
ty³
,

437 
pboÞ
 
u£_async_io
);

438 
»ad_ÿche_»cÜd
(
RECORD_CACHE
 *
šfo
,*
to
);

439 
’d_»cÜd_ÿche
(
RECORD_CACHE
 *
šfo
);

440 
wr™e_ÿche_»cÜd
(
RECORD_CACHE
 *
šfo
,
my_off_t
 
fž•os
,

441 cÚ¡ *
»cÜd
,
ušt
 
Ëngth
);

442 
æush_wr™e_ÿche
(
RECORD_CACHE
 *
šfo
);

443 
my_þock
();

444 
sig_hªdËr
 
sigt¡p_hªdËr
(
sigÇl_numb”
);

445 
hªdË_»cived_sigÇls
();

446 
š™_key_ÿche
(
ulÚg
 
u£_mem
,ulÚg 
Ëave_this_much_mem
);

447 *
key_ÿche_»ad
(
Fže
 
fže
,
my_off_t
 
fž•os
,* 
buff
,
ušt
 
Ëngth
,

448 
ušt
 
block_Ëngth
,
»tuº_bufãr
);

449 
key_ÿche_wr™e
(
Fže
 
fže
,
my_off_t
 
fž•os
,* 
buff
,
ušt
 
Ëngth
,

450 
ušt
 
block_Ëngth
,
fÜû_wr™e
);

451 
æush_key_blocks
(
fže
, 
æush_ty³
 
ty³
);

452 
’d_key_ÿche
();

453 
sig_hªdËr
 
my_£t_®¬m_v¬ŸbË
(
signo
);

454 
my_¡ršg_±r_sÜt
(*
ba£
,
ušt
 
™ems
,
size_s
 
size
);

455 
¿dixsÜt_fÜ_¡r_±r
(
uch¬
* 
ba£
[], 
ušt
 
numb”_of_–em’ts
,

456 
size_s
 
size_of_–em’t
,
uch¬
 *
bufãr
[]);

457 
qsÜt_t
 
qsÜt2
(*
ba£_±r
, 
size_t
 
tÙ®_–ems
, size_ˆ
size
,

458 
qsÜt2_cmp
 
cmp
, *
cmp_¬gum’t
);

459 
qsÜt2_cmp
 
g‘_±r_com·»
(
ušt
);

460 
š™_io_ÿche
(
IO_CACHE
 *
šfo
,
Fže
 
fže
,
ušt
 
ÿchesize
,

461 
ÿche_ty³
 
ty³
,
my_off_t
 
£ek_off£t
,

462 
pboÞ
 
u£_async_io
, 
myf
 
ÿche_myæags
);

463 
my_boÞ
 
»š™_io_ÿche
(
IO_CACHE
 *
šfo
,
ÿche_ty³
 
ty³
,

464 
my_off_t
 
£ek_off£t
,
pboÞ
 
u£_async_io
,

465 
pboÞ
 
þ—r_ÿche
);

466 
_my_b_»ad
(
IO_CACHE
 *
šfo
,*
Bufãr
,
ušt
 
CouÁ
);

467 
_my_b_Ãt_»ad
(
IO_CACHE
 *
šfo
,*
Bufãr
,
ušt
 
CouÁ
);

468 
_my_b_g‘
(
IO_CACHE
 *
šfo
);

469 
_my_b_async_»ad
(
IO_CACHE
 *
šfo
,*
Bufãr
,
ušt
 
CouÁ
);

470 
_my_b_wr™e
(
IO_CACHE
 *
šfo
,cÚ¡ *
Bufãr
,
ušt
 
CouÁ
);

471 
my_block_wr™e
(
IO_CACHE
 *
šfo
, cÚ¡ *
Bufãr
,

472 
ušt
 
CouÁ
, 
my_off_t
 
pos
);

473 
æush_io_ÿche
(
IO_CACHE
 *
šfo
);

474 
’d_io_ÿche
(
IO_CACHE
 *
šfo
);

475 
ušt
 
my_b_fžl
(
IO_CACHE
 *
šfo
);

476 
my_b_£ek
(
IO_CACHE
 *
šfo
,
my_off_t
 
pos
);

477 
ušt
 
my_b_g‘s
(
IO_CACHE
 *
šfo
, *
to
, ušˆ
max_Ëngth
);

478 
ušt
 
my_b_´štf
(
IO_CACHE
 *
šfo
, cÚ¡ * 
fmt
, ...);

479 
ušt
 
my_b_v´štf
(
IO_CACHE
 *
šfo
, cÚ¡ * 
fmt
, 
va_li¡
 
­
);

480 
my_boÞ
 
Ý’_ÿched_fže
(
IO_CACHE
 *
ÿche
,cÚ¡ *
dœ
,

481 cÚ¡ *
´efix
, 
ušt
 
ÿche_size
,

482 
myf
 
ÿche_myæags
);

483 
my_boÞ
 
»®_Ý’_ÿched_fže
(
IO_CACHE
 *
ÿche
);

484 
þo£_ÿched_fže
(
IO_CACHE
 *
ÿche
);

485 
Fže
 
ü—‹_‹mp_fže
(*
to
, cÚ¡ *
dœ
, cÚ¡ *
pfx
,

486 
mode
, 
myf
 
MyFÏgs
);

487 
	#ma_š™_dyÇmic_¬¿y
(
A
,
B
,
C
,
D
è
	`š™_dyÇmic_¬¿y
(A,B,C,D 
CALLER_INFO
)

	)

489 
my_boÞ
 
ma_š™_dyÇmic_¬¿y
(
DYNAMIC_ARRAY
 *
¬¿y
,
ušt
 
–em’t_size
,

490 
ušt
 
š™_®loc
,ušˆ
®loc_šüem’t
 
CALLER_INFO_PROTO
);

491 
	#ma_š™_dyÇmic_¬¿y_ci
(
A
,
B
,
C
,
D
è
	`ma_š™_dyÇmic_¬¿y
(A,B,C,D 
ORIG_CALLER_INFO
)

	)

492 
my_boÞ
 
ma_š£¹_dyÇmic
(
DYNAMIC_ARRAY
 *
¬¿y
,* 
–em’t
);

493 *
ma_®loc_dyÇmic
(
DYNAMIC_ARRAY
 *
¬¿y
);

494 *
ma_pÝ_dyÇmic
(
DYNAMIC_ARRAY
*);

495 
my_boÞ
 
ma_£t_dyÇmic
(
DYNAMIC_ARRAY
 *
¬¿y
,* 
–em’t
,
ušt
 
¬¿y_šdex
);

496 
ma_g‘_dyÇmic
(
DYNAMIC_ARRAY
 *
¬¿y
,* 
–em’t
,
ušt
 
¬¿y_šdex
);

497 
ma_d–‘e_dyÇmic
(
DYNAMIC_ARRAY
 *
¬¿y
);

498 
ma_d–‘e_dyÇmic_–em’t
(
DYNAMIC_ARRAY
 *
¬¿y
, 
ušt
 
¬¿y_šdex
);

499 
ma_ä“ze_size
(
DYNAMIC_ARRAY
 *
¬¿y
);

500 
	#dyÇmic_¬¿y_±r
(
¬¿y
,
¬¿y_šdex
è(×¼ay)->
bufãr
+×¼ay_šdex)*×¼ay)->
size_of_–em’t
)

	)

501 
	#dyÇmic_–em’t
(
¬¿y
,
¬¿y_šdex
,
ty³
è(Ñy³)(×¼ay)->
bufãr
è+×¼ay_šdex))

	)

502 
	#push_dyÇmic
(
A
,
B
è
	`ma_š£¹_dyÇmic
(A,B)

	)

504 
ma_fšd_ty³
(
my_¡ršg
 
x
,
TYPELIB
 *
ty³lib
,
ušt
 
fuÎ_Çme
);

505 
ma_make_ty³
(
my_¡ršg
 
to
,
ušt
 
Ä
,
TYPELIB
 *
ty³lib
);

506 cÚ¡ *
ma_g‘_ty³
(
TYPELIB
 *
ty³lib
,
ušt
 
Ä
);

507 
my_boÞ
 
ma_š™_dyÇmic_¡ršg
(
DYNAMIC_STRING
 *
¡r
, cÚ¡ *
š™_¡r
,

508 
size_t
 
š™_®loc
, size_ˆ
®loc_šüem’t
);

509 
my_boÞ
 
ma_dyn¡r_­³nd
(
DYNAMIC_STRING
 *
¡r
, cÚ¡ *
­³nd
);

510 
my_boÞ
 
ma_dyn¡r_­³nd_quÙed
(
DYNAMIC_STRING
 *
¡r
,

511 cÚ¡ *
­³nd
, 
size_t
 
Ën
,

512 
quÙe
);

513 
my_boÞ
 
ma_dyn¡r_­³nd_mem
(
DYNAMIC_STRING
 *
¡r
, cÚ¡ *
­³nd
,

514 
size_t
 
Ëngth
);

515 
my_boÞ
 
ma_dyn¡r_£t
(
DYNAMIC_STRING
 *
¡r
, cÚ¡ *
š™_¡r
);

516 
my_boÞ
 
ma_dyn¡r_»®loc
(
DYNAMIC_STRING
 *
¡r
, 
size_t
 
add™iÚ®_size
);

517 
ma_dyn¡r_ä“
(
DYNAMIC_STRING
 *
¡r
);

518 
£t_®l_chªg—bË_v¬s
(
CHANGEABLE_VAR
 *
v¬s
);

519 
my_boÞ
 
£t_chªg—bË_v¬
(
my_¡ršg
 
¡r
,
CHANGEABLE_VAR
 *
v¬s
);

520 
my_boÞ
 
£t_chªg—bË_v¬v®
(cÚ¡ *
v¬
, 
ulÚg
 
v®
,

521 
CHANGEABLE_VAR
 *
v¬s
);

522 
	#ma_®loc_roÙ_š™ed
(
A
è((A)->
mš_m®loc
 !ð0)

	)

523 
ma_š™_®loc_roÙ
(
MA_MEM_ROOT
 *
mem_roÙ
, 
size_t
 
block_size
, size_ˆ
´e_®loc_size
);

524 *
ma_®loc_roÙ
(
MA_MEM_ROOT
 *
mem_roÙ
, 
size_t
 
Size
);

525 
ma_ä“_roÙ
(
MA_MEM_ROOT
 *
roÙ
, 
myf
 
MyFLAGS
);

526 *
ma_¡rdup_roÙ
(
MA_MEM_ROOT
 *
roÙ
,cÚ¡ *
¡r
);

527 *
ma_memdup_roÙ
(
MA_MEM_ROOT
 *
roÙ
,cÚ¡ *
¡r
, 
size_t
 
Ën
);

528 
ma_ä“_deçuÉs
(**
¬gv
);

529 
ma_´št_deçuÉs
(cÚ¡ *
cÚf_fže
, cÚ¡ **
groups
);

530 
my_boÞ
 
_m¬Ÿdb_com´ess
(*, 
size_t
 *, size_t *);

531 
my_boÞ
 
_m¬Ÿdb_uncom´ess
(*, 
size_t
 *, size_t *);

532 *
_m¬Ÿdb_com´ess_®loc
(cÚ¡ *
·ck‘
, 
size_t
 *
Ën
, size_ˆ*
com¶’
);

533 
ulÚg
 
checksum
(cÚ¡ *
mem
, 
ušt
 
couÁ
);

535 #ià
defšed
(
_MSC_VER
è&& !defšed(
_WIN32
)

536 
¦“p
(
£c
);

539 #ifdef 
__ýlu¥lus


	@include/ma_tls.h

1 #iâdeà
_ma_Žs_h_


2 
	#_ma_Žs_h_


	)

4 
	e’um_pvio_Žs_ty³
 {

5 
	mSSL_TYPE_DEFAULT
=0,

6 #ifdeà
_WIN32


7 
	mSSL_TYPE_SCHANNEL
,

9 
	mSSL_TYPE_OPENSSL
,

10 
	mSSL_TYPE_GNUTLS


13 
	#PROTOCOL_SSLV3
 0

	)

14 
	#PROTOCOL_TLS_1_0
 1

	)

15 
	#PROTOCOL_TLS_1_1
 2

	)

16 
	#PROTOCOL_TLS_1_2
 3

	)

17 
	#PROTOCOL_TLS_1_3
 4

	)

18 
	#PROTOCOL_UNKNOWN
 5

	)

19 
	#PROTOCOL_MAX
 
PROTOCOL_TLS_1_3


	)

21 
	#TLS_VERSION_LENGTH
 64

	)

22 
Žs_lib¿ry_v”siÚ
[
TLS_VERSION_LENGTH
];

24 
	s¡_ma_pvio_Žs
 {

25 *
	md©a
;

26 
MARIADB_PVIO
 *
	mpvio
;

27 *
	ms¦
;

28 } 
	tMARIADB_TLS
;

43 
ma_Žs_¡¬t
(*
”rmsg
, 
size_t
 
”rmsg_Ën
);

49 
ma_Žs_’d
();

60 * 
ma_Žs_š™
(
MYSQL
 *
mysql
);

70 
my_boÞ
 
ma_Žs_cÚÃù
(
MARIADB_TLS
 *
ùls
);

82 
ssize_t
 
ma_Žs_»ad
(
MARIADB_TLS
 *
ùls
, cÚ¡ 
uch¬
* 
bufãr
, 
size_t
 
Ëngth
);

94 
ssize_t
 
ma_Žs_wr™e
(
MARIADB_TLS
 *
ùls
, cÚ¡ 
uch¬
* 
bufãr
, 
size_t
 
Ëngth
);

105 
my_boÞ
 
ma_Žs_þo£
(
MARIADB_TLS
 *
ùls
);

115 
ma_Žs_v”ify_£rv”_û¹
(
MARIADB_TLS
 *
ùls
);

125 cÚ¡ *
ma_Žs_g‘_ch”
(
MARIADB_TLS
 *
s¦
);

136 
ma_Žs_g‘_fšg”_´št
(
MARIADB_TLS
 *
ùls
, *
å
, 
å_Ën
);

145 
ma_Žs_g‘_´ÙocÞ_v”siÚ
(
MARIADB_TLS
 *
ùls
);

146 cÚ¡ *
ma_pvio_Žs_g‘_´ÙocÞ_v”siÚ
(
MARIADB_TLS
 *
ùls
);

147 
ma_pvio_Žs_g‘_´ÙocÞ_v”siÚ_id
(
MARIADB_TLS
 *
ùls
);

150 
MARIADB_TLS
 *
ma_pvio_Žs_š™
(
MYSQL
 *
mysql
);

151 
my_boÞ
 
ma_pvio_Žs_cÚÃù
(
MARIADB_TLS
 *
ùls
);

152 
ssize_t
 
ma_pvio_Žs_»ad
(
MARIADB_TLS
 *
ùls
, cÚ¡ 
uch¬
 *
bufãr
, 
size_t
 
Ëngth
);

153 
ssize_t
 
ma_pvio_Žs_wr™e
(
MARIADB_TLS
 *
ùls
, cÚ¡ 
uch¬
 *
bufãr
, 
size_t
 
Ëngth
);

154 
my_boÞ
 
ma_pvio_Žs_þo£
(
MARIADB_TLS
 *
ùls
);

155 
ma_pvio_Žs_v”ify_£rv”_û¹
(
MARIADB_TLS
 *
ùls
);

156 cÚ¡ *
ma_pvio_Žs_ch”
(
MARIADB_TLS
 *
ùls
);

157 
my_boÞ
 
ma_pvio_Žs_check_å
(
MARIADB_TLS
 *
ùls
, cÚ¡ *
å
, cÚ¡ *
å_li¡
);

158 
my_boÞ
 
ma_pvio_¡¬t_s¦
(
MARIADB_PVIO
 *
pvio
);

159 
ma_pvio_Žs_’d
();

	@include/mariadb/ma_io.h

18 #iâdeà
_ma_io_h_


19 
	#_ma_io_h_


	)

22 #ifdeà
HAVE_REMOTEIO


23 
	~<cu¾/cu¾.h
>

26 
	e’um_fže_ty³
 {

27 
	mMA_FILE_NONE
=0,

28 
	mMA_FILE_LOCAL
=1,

29 
	mMA_FILE_REMOTE
=2

34 
’um_fže_ty³
 
	mty³
;

35 *
	m±r
;

36 } 
	tMA_FILE
;

38 #ifdeà
HAVE_REMOTEIO


39 
	s¡_rio_m‘hods
 {

40 
	mMA_FILE
 *(*
	mmÝ’
)(cÚ¡ *
	mu¾
, cÚ¡ *
	mmode
);

41 (*
	mmþo£
)(
MA_FILE
 *
	m±r
);

42 (*
	mmãof
)(
MA_FILE
 *
	mfže
);

43 
size_t
 (*
m»ad
)(*
	m±r
, size_ˆ
	msize
, size_ˆ
	mnmemb
, 
MA_FILE
 *
	mfže
);

44 * (*
	mmg‘s
)(*
	m±r
, 
size_t
 
	msize
, 
MA_FILE
 *
	mfže
);

49 
MA_FILE
 *
ma_Ý’
(cÚ¡ *
loÿtiÚ
, cÚ¡ *
mode
, 
MYSQL
 *
mysql
);

50 
ma_þo£
(
MA_FILE
 *
fže
);

51 
ma_ãof
(
MA_FILE
 *
fže
);

52 
size_t
 
ma_»ad
(*
±r
, size_ˆ
size
, size_ˆ
nmemb
, 
MA_FILE
 *
fže
);

53 *
ma_g‘s
(*
±r
, 
size_t
 
size
, 
MA_FILE
 *
fže
);

	@include/mariadb_async.h

19 #iâdeà
MYSQL_ASYNC_H


20 
	#MYSQL_ASYNC_H


	)

22 
my_cÚÃù_async
(
MARIADB_PVIO
 *
pvio
,

23 cÚ¡ 
sockaddr
 *
Çme
, 
ušt
 
Çm–’
,

24 
vio_timeout
);

25 
ssize_t
 
my_»cv_async
(
MARIADB_PVIO
 *
pvio
,

26 *
buf
, 
size_t
 
size
, 
timeout
);

27 
ssize_t
 
my_£nd_async
(
MARIADB_PVIO
 *
pvio
,

28 cÚ¡ *
buf
, 
size_t
 
size
,

29 
timeout
);

30 
my_boÞ
 
my_io_wa™_async
(
mysql_async_cÚ‹xt
 *
b
,

31 
’um_pvio_io_ev’t
 
ev’t
, 
timeout
);

32 #ifdeà
HAVE_TLS


33 
ssize_t
 
ma_Žs_»ad_async
(
MARIADB_PVIO
 *
pvio
, cÚ¡ 
uch¬
 *
buf
, 
size_t
 
size
);

34 
ssize_t
 
ma_Žs_wr™e_async
(
MARIADB_PVIO
 *
pvio
, cÚ¡ 
uch¬
 *
buf
, 
size_t
 
size
);

	@include/mariadb_com.h

28 #iâdeà
_mysql_com_h


29 
	#_mysql_com_h


	)

32 
	#NAME_CHAR_LEN
 64

	)

33 
	#NAME_LEN
 256

	)

34 
	#HOSTNAME_LENGTH
 60

	)

35 
	#SYSTEM_MB_MAX_CHAR_LENGTH
 4

	)

36 
	#USERNAME_CHAR_LENGTH
 128

	)

37 
	#USERNAME_LENGTH
 (
USERNAME_CHAR_LENGTH
 * 
SYSTEM_MB_MAX_CHAR_LENGTH
)

	)

38 
	#SERVER_VERSION_LENGTH
 60

	)

39 
	#SQLSTATE_LENGTH
 5

	)

40 
	#SCRAMBLE_LENGTH
 20

	)

41 
	#SCRAMBLE_LENGTH_323
 8

	)

43 
	#LOCAL_HOST
 "loÿlho¡"

	)

44 
	#LOCAL_HOST_NAMEDPIPE
 "."

	)

46 #ià
defšed
(
_WIN32
è&& !defšedÐ
_CUSTOMCONFIG_
)

47 
	#MARIADB_NAMEDPIPE
 "MySQL"

	)

48 
	#MYSQL_SERVICENAME
 "MySql"

	)

52 
	#MYSQL_AUTODETECT_CHARSET_NAME
 "auto"

	)

53 
	#BINCMP_FLAG
 131072

	)

55 
	emysql_’um_shutdown_Ëv–


57 
	mSHUTDOWN_DEFAULT
 = 0,

58 
	mKILL_QUERY
= 254,

59 
	mKILL_CONNECTION
= 255

62 
	e’um_£rv”_commªd


64 
	mCOM_SLEEP
 = 0,

65 
	mCOM_QUIT
,

66 
	mCOM_INIT_DB
,

67 
	mCOM_QUERY
,

68 
	mCOM_FIELD_LIST
,

69 
	mCOM_CREATE_DB
,

70 
	mCOM_DROP_DB
,

71 
	mCOM_REFRESH
,

72 
	mCOM_SHUTDOWN
,

73 
	mCOM_STATISTICS
,

74 
	mCOM_PROCESS_INFO
,

75 
	mCOM_CONNECT
,

76 
	mCOM_PROCESS_KILL
,

77 
	mCOM_DEBUG
,

78 
	mCOM_PING
,

79 
	mCOM_TIME
 = 15,

80 
	mCOM_DELAYED_INSERT
,

81 
	mCOM_CHANGE_USER
,

82 
	mCOM_BINLOG_DUMP
,

83 
	mCOM_TABLE_DUMP
,

84 
	mCOM_CONNECT_OUT
 = 20,

85 
	mCOM_REGISTER_SLAVE
,

86 
	mCOM_STMT_PREPARE
 = 22,

87 
	mCOM_STMT_EXECUTE
 = 23,

88 
	mCOM_STMT_SEND_LONG_DATA
 = 24,

89 
	mCOM_STMT_CLOSE
 = 25,

90 
	mCOM_STMT_RESET
 = 26,

91 
	mCOM_SET_OPTION
 = 27,

92 
	mCOM_STMT_FETCH
 = 28,

93 
	mCOM_DAEMON
= 29,

94 
	mCOM_UNSUPPORTED
= 30,

95 
	mCOM_RESET_CONNECTION
 = 31,

96 
	mCOM_STMT_BULK_EXECUTE
 = 250,

97 
	mCOM_RESERVED_1
 = 254,

98 
	mCOM_END


102 
	#NOT_NULL_FLAG
 1

	)

103 
	#PRI_KEY_FLAG
 2

	)

104 
	#UNIQUE_KEY_FLAG
 4

	)

105 
	#MULTIPLE_KEY_FLAG
 8

	)

106 
	#BLOB_FLAG
 16

	)

107 
	#UNSIGNED_FLAG
 32

	)

108 
	#ZEROFILL_FLAG
 64

	)

109 
	#BINARY_FLAG
 128

	)

111 
	#ENUM_FLAG
 256

	)

112 
	#AUTO_INCREMENT_FLAG
 512

	)

113 
	#TIMESTAMP_FLAG
 1024

	)

114 
	#SET_FLAG
 2048

	)

116 
	#NO_DEFAULT_VALUE_FLAG
 4096

	)

117 
	#ON_UPDATE_NOW_FLAG
 8192

	)

119 
	#NUM_FLAG
 32768

	)

120 
	#PART_KEY_FLAG
 16384

	)

121 
	#GROUP_FLAG
 32768

	)

122 
	#UNIQUE_FLAG
 65536

	)

124 
	#REFRESH_GRANT
 1

	)

125 
	#REFRESH_LOG
 2

	)

126 
	#REFRESH_TABLES
 4

	)

127 
	#REFRESH_HOSTS
 8

	)

128 
	#REFRESH_STATUS
 16

	)

129 
	#REFRESH_THREADS
 32

	)

130 
	#REFRESH_SLAVE
 64

	)

132 
	#REFRESH_MASTER
 128

	)

136 
	#REFRESH_READ_LOCK
 16384

	)

137 
	#REFRESH_FAST
 32768

	)

139 
	#CLIENT_MYSQL
 1

	)

140 
	#CLIENT_FOUND_ROWS
 2

	)

141 
	#CLIENT_LONG_FLAG
 4

	)

142 
	#CLIENT_CONNECT_WITH_DB
 8

	)

143 
	#CLIENT_NO_SCHEMA
 16

	)

144 
	#CLIENT_COMPRESS
 32

	)

145 
	#CLIENT_ODBC
 64

	)

146 
	#CLIENT_LOCAL_FILES
 128

	)

147 
	#CLIENT_IGNORE_SPACE
 256

	)

148 
	#CLIENT_INTERACTIVE
 1024

	)

149 
	#CLIENT_SSL
 2048

	)

150 
	#CLIENT_IGNORE_SIGPIPE
 4096

	)

151 
	#CLIENT_TRANSACTIONS
 8192

	)

153 
	#CLIENT_PROTOCOL_41
 512

	)

154 
	#CLIENT_RESERVED
 16384

	)

155 
	#CLIENT_SECURE_CONNECTION
 32768

	)

156 
	#CLIENT_MULTI_STATEMENTS
 (1UL << 16)

	)

157 
	#CLIENT_MULTI_RESULTS
 (1UL << 17)

	)

158 
	#CLIENT_PS_MULTI_RESULTS
 (1UL << 18)

	)

159 
	#CLIENT_PLUGIN_AUTH
 (1UL << 19)

	)

160 
	#CLIENT_CONNECT_ATTRS
 (1UL << 20)

	)

161 
	#CLIENT_PLUGIN_AUTH_LENENC_CLIENT_DATA
 (1UL << 21)

	)

162 
	#CLIENT_CAN_HANDLE_EXPIRED_PASSWORDS
 (1UL << 22)

	)

163 
	#CLIENT_SESSION_TRACKING
 (1UL << 23)

	)

165 
	#CLIENT_SUPPORT_ORACLE_MODE
 (1UL << 27)

	)

166 
	#CLIENT_RETURN_HIDDEN_ROWID
 (1UL << 28)

	)

168 
	#CLIENT_PROGRESS
 (1UL << 29è

	)

169 
	#CLIENT_PROGRESS_OBSOLETE
 
CLIENT_PROGRESS


	)

170 
	#CLIENT_SSL_VERIFY_SERVER_CERT
 (1UL << 30)

	)

171 
	#CLIENT_REMEMBER_OPTIONS
 (1UL << 31)

	)

174 
	#MARIADB_CLIENT_FLAGS
 0xFFFFFFFF00000000ULL

	)

175 
	#MARIADB_CLIENT_PROGRESS
 (1ULL << 32)

	)

176 
	#MARIADB_CLIENT_RESERVED_1
 (1ULL << 33è

	)

177 
	#MARIADB_CLIENT_STMT_BULK_OPERATIONS
 (1ULL << 34)

	)

179 
	#MARIADB_CLIENT_EXTENDED_METADATA
 (1ULL << 35)

	)

181 
	#IS_MARIADB_EXTENDED_SERVER
(
mysql
)\

182 (!(
mysql
->
£rv”_ÿ·bž™›s
 & 
CLIENT_MYSQL
))

	)

184 
	#MARIADB_CLIENT_SUPPORTED_FLAGS
 (
MARIADB_CLIENT_PROGRESS
 |\

185 
MARIADB_CLIENT_STMT_BULK_OPERATIONS
|\

186 
MARIADB_CLIENT_EXTENDED_METADATA
)

	)

188 
	#CLIENT_SUPPORTED_FLAGS
 (
CLIENT_MYSQL
 |\

189 
CLIENT_FOUND_ROWS
 |\

190 
CLIENT_LONG_FLAG
 |\

191 
CLIENT_CONNECT_WITH_DB
 |\

192 
CLIENT_NO_SCHEMA
 |\

193 
CLIENT_COMPRESS
 |\

194 
CLIENT_ODBC
 |\

195 
CLIENT_LOCAL_FILES
 |\

196 
CLIENT_IGNORE_SPACE
 |\

197 
CLIENT_INTERACTIVE
 |\

198 
CLIENT_SSL
 |\

199 
CLIENT_IGNORE_SIGPIPE
 |\

200 
CLIENT_TRANSACTIONS
 |\

201 
CLIENT_PROTOCOL_41
 |\

202 
CLIENT_RESERVED
 |\

203 
CLIENT_SECURE_CONNECTION
 |\

204 
CLIENT_MULTI_STATEMENTS
 |\

205 
CLIENT_MULTI_RESULTS
 |\

206 
CLIENT_PROGRESS
 |\

207 
CLIENT_SSL_VERIFY_SERVER_CERT
 |\

208 
CLIENT_REMEMBER_OPTIONS
 |\

209 
CLIENT_PLUGIN_AUTH
 |\

210 
CLIENT_SESSION_TRACKING
 |\

211 
CLIENT_CONNECT_ATTRS
)

	)

212 
	#CLIENT_CAPABILITIES
 (
CLIENT_MYSQL
 | \

213 
CLIENT_LONG_FLAG
 |\

214 
CLIENT_TRANSACTIONS
 |\

215 
CLIENT_SECURE_CONNECTION
 |\

216 
CLIENT_MULTI_RESULTS
 | \

217 
CLIENT_PS_MULTI_RESULTS
 |\

218 
CLIENT_PROTOCOL_41
 |\

219 
CLIENT_PLUGIN_AUTH
 |\

220 
CLIENT_PLUGIN_AUTH_LENENC_CLIENT_DATA
 | \

221 
CLIENT_SESSION_TRACKING
 |\

222 
CLIENT_CONNECT_ATTRS
)

	)

224 
	#CLIENT_DEFAULT_FLAGS
 ((
CLIENT_SUPPORTED_FLAGS
 & ~
CLIENT_COMPRESS
)\

225 & ~
CLIENT_SSL
)

	)

227 
	#SERVER_STATUS_IN_TRANS
 1

	)

228 
	#SERVER_STATUS_AUTOCOMMIT
 2

	)

229 
	#SERVER_ORACLE_MODE
 4

	)

230 
	#SERVER_MORE_RESULTS_EXIST
 8

	)

231 
	#SERVER_QUERY_NO_GOOD_INDEX_USED
 16

	)

232 
	#SERVER_QUERY_NO_INDEX_USED
 32

	)

233 
	#SERVER_STATUS_CURSOR_EXISTS
 64

	)

234 
	#SERVER_STATUS_LAST_ROW_SENT
 128

	)

235 
	#SERVER_STATUS_DB_DROPPED
 256

	)

236 
	#SERVER_STATUS_NO_BACKSLASH_ESCAPES
 512

	)

237 
	#SERVER_STATUS_METADATA_CHANGED
 1024

	)

238 
	#SERVER_QUERY_WAS_SLOW
 2048

	)

239 
	#SERVER_PS_OUT_PARAMS
 4096

	)

240 
	#SERVER_STATUS_IN_TRANS_READONLY
 8192

	)

241 
	#SERVER_SESSION_STATE_CHANGED
 16384

	)

242 
	#SERVER_STATUS_ANSI_QUOTES
 32768

	)

244 
	#MYSQL_ERRMSG_SIZE
 512

	)

245 
	#NET_READ_TIMEOUT
 30

	)

246 
	#NET_WRITE_TIMEOUT
 60

	)

247 
	#NET_WAIT_TIMEOUT
 (8*60*60è

	)

250 
	#LIST_PROCESS_HOST_LEN
 64

	)

251 
	#MYSQL50_TABLE_NAME_PREFIX
 "#mysql50#"

	)

252 
	#MYSQL50_TABLE_NAME_PREFIX_LENGTH
 ((
MYSQL50_TABLE_NAME_PREFIX
)-1)

	)

253 
	#SAFE_NAME_LEN
 (
NAME_LEN
 + 
MYSQL50_TABLE_NAME_PREFIX_LENGTH
)

	)

255 
	g¡_ma_pvio
;

256 
¡_ma_pvio
 
	tMARIADB_PVIO
;

258 
	#MAX_CHAR_WIDTH
 255

	)

259 
	#MAX_BLOB_WIDTH
 8192

	)

264 
	#MAX_TINYINT_WIDTH
 3

	)

265 
	#MAX_SMALLINT_WIDTH
 5

	)

266 
	#MAX_MEDIUMINT_WIDTH
 8

	)

267 
	#MAX_INT_WIDTH
 10

	)

268 
	#MAX_BIGINT_WIDTH
 20

	)

270 
	g¡_ma_cÚÃùiÚ_¶ugš
;

273 
	s¡_Ãt
 {

274 
MARIADB_PVIO
 *
	mpvio
;

275 *
	mbuff
;

276 *
	mbuff_’d
,*
	mwr™e_pos
,*
	m»ad_pos
;

277 
my_sock‘
 
	mfd
;

278 
	m»maš_š_buf
,
	mËngth
;

279 
	mbuf_Ëngth
, 
	mwh”e_b
;

280 
	mmax_·ck‘
, 
	mmax_·ck‘_size
;

281 
	mpkt_Ä
, 
	mcom´ess_pkt_Ä
;

282 
	mwr™e_timeout
, 
	m»ad_timeout
, 
	m»Œy_couÁ
;

283 
	mfúŽ
;

284 *
	m»tuº_¡©us
;

285 
	m»adšg_Ü_wr™šg
;

286 
	m§ve_ch¬
;

287 
	munu£d_1
;

288 
my_boÞ
 
	munu£d_2
;

289 
my_boÞ
 
	mcom´ess
;

290 
my_boÞ
 
	munu£d_3
;

291 *
	munu£d_4
;

292 
	mÏ¡_”ºo
;

293 
	m”rÜ
;

294 
my_boÞ
 
	munu£d_5
;

295 
my_boÞ
 
	munu£d_6
;

296 
	mÏ¡_”rÜ
[
MYSQL_ERRMSG_SIZE
];

297 
	msql¡©e
[
SQLSTATE_LENGTH
+1];

298 
¡_m¬Ÿdb_Ãt_ex‹nsiÚ
 *
	mex‹nsiÚ
;

299 } 
	tNET
;

301 
	#·ck‘_”rÜ
 ((è-1)

	)

304 
	e’um_mysql_£t_ÝtiÚ


306 
	mMYSQL_OPTION_MULTI_STATEMENTS_ON
,

307 
	mMYSQL_OPTION_MULTI_STATEMENTS_OFF


310 
	e’um_£ssiÚ_¡©e_ty³


312 
	mSESSION_TRACK_SYSTEM_VARIABLES
= 0,

313 
	mSESSION_TRACK_SCHEMA
,

314 
	mSESSION_TRACK_STATE_CHANGE
,

316 
	mSESSION_TRACK_GTIDS
,

317 
	mSESSION_TRACK_TRANSACTION_CHARACTERISTICS
,

318 
	mSESSION_TRACK_TRANSACTION_STATE


322 
	#SESSION_TRACK_BEGIN
 0

	)

323 
	#SESSION_TRACK_END
 
SESSION_TRACK_TRANSACTION_STATE


	)

324 
	#SESSION_TRACK_TYPES
 (
SESSION_TRACK_END
 + 1)

	)

330 
	#SESSION_TRACK_TRANSACTION_TYPE
 
SESSION_TRACK_TRANSACTION_STATE


	)

332 
	e’um_f›ld_ty³s
 { 
	mMYSQL_TYPE_DECIMAL
, 
	mMYSQL_TYPE_TINY
,

333 
	mMYSQL_TYPE_SHORT
, 
	mMYSQL_TYPE_LONG
,

334 
	mMYSQL_TYPE_FLOAT
, 
	mMYSQL_TYPE_DOUBLE
,

335 
	mMYSQL_TYPE_NULL
, 
	mMYSQL_TYPE_TIMESTAMP
,

336 
	mMYSQL_TYPE_LONGLONG
,
	mMYSQL_TYPE_INT24
,

337 
	mMYSQL_TYPE_DATE
, 
	mMYSQL_TYPE_TIME
,

338 
	mMYSQL_TYPE_DATETIME
, 
	mMYSQL_TYPE_YEAR
,

339 
	mMYSQL_TYPE_NEWDATE
, 
	mMYSQL_TYPE_VARCHAR
,

340 
	mMYSQL_TYPE_BIT
,

345 
	mMYSQL_TYPE_TIMESTAMP2
,

346 
	mMYSQL_TYPE_DATETIME2
,

347 
	mMYSQL_TYPE_TIME2
,

350 
	mMYSQL_TYPE_OBJECT
 = 160,

351 
	mMYSQL_TYPE_ARRAY
 = 161,

352 
	mMYSQL_TYPE_STRUCT
 = 162,

353 
	mMYSQL_TYPE_CURSOR
 = 163,

354 
	mMYSQL_TYPE_OB_TIMESTAMP_WITH_TIME_ZONE
 = 200,

355 
	mMYSQL_TYPE_OB_TIMESTAMP_WITH_LOCAL_TIME_ZONE
 = 201,

356 
	mMYSQL_TYPE_OB_TIMESTAMP_NANO
 = 202,

357 
	mMYSQL_TYPE_OB_RAW
 = 203,

358 
	mMYSQL_TYPE_OB_INTERVAL_YM
 = 204,

359 
	mMYSQL_TYPE_OB_INTERVAL_DS
 = 205,

360 
	mMYSQL_TYPE_OB_NUMBER_FLOAT
 = 206,

361 
	mMYSQL_TYPE_OB_NVARCHAR2
 = 207,

362 
	mMYSQL_TYPE_OB_NCHAR
 = 208,

363 
	mMYSQL_TYPE_OB_UROWID
 = 209,

364 
	mMYSQL_TYPE_ORA_BLOB
=210,

365 
	mMYSQL_TYPE_ORA_CLOB
=211,

367 
	mMYSQL_TYPE_JSON
=245,

368 
	mMYSQL_TYPE_NEWDECIMAL
=246,

369 
	mMYSQL_TYPE_ENUM
=247,

370 
	mMYSQL_TYPE_SET
=248,

371 
	mMYSQL_TYPE_TINY_BLOB
=249,

372 
	mMYSQL_TYPE_MEDIUM_BLOB
=250,

373 
	mMYSQL_TYPE_LONG_BLOB
=251,

374 
	mMYSQL_TYPE_BLOB
=252,

375 
	mMYSQL_TYPE_VAR_STRING
=253,

376 
	mMYSQL_TYPE_STRING
=254,

377 
	mMYSQL_TYPE_GEOMETRY
=255,

378 
	mMAX_NO_FIELD_TYPES
 } 
	t’um_f›ld_ty³s
;

380 
	#FIELD_TYPE_CHAR
 
FIELD_TYPE_TINY


	)

381 
	#FIELD_TYPE_INTERVAL
 
FIELD_TYPE_ENUM


	)

382 
	#FIELD_TYPE_DECIMAL
 
MYSQL_TYPE_DECIMAL


	)

383 
	#FIELD_TYPE_NEWDECIMAL
 
MYSQL_TYPE_NEWDECIMAL


	)

384 
	#FIELD_TYPE_TINY
 
MYSQL_TYPE_TINY


	)

385 
	#FIELD_TYPE_SHORT
 
MYSQL_TYPE_SHORT


	)

386 
	#FIELD_TYPE_LONG
 
MYSQL_TYPE_LONG


	)

387 
	#FIELD_TYPE_FLOAT
 
MYSQL_TYPE_FLOAT


	)

388 
	#FIELD_TYPE_DOUBLE
 
MYSQL_TYPE_DOUBLE


	)

389 
	#FIELD_TYPE_NULL
 
MYSQL_TYPE_NULL


	)

390 
	#FIELD_TYPE_TIMESTAMP
 
MYSQL_TYPE_TIMESTAMP


	)

391 
	#FIELD_TYPE_LONGLONG
 
MYSQL_TYPE_LONGLONG


	)

392 
	#FIELD_TYPE_INT24
 
MYSQL_TYPE_INT24


	)

393 
	#FIELD_TYPE_DATE
 
MYSQL_TYPE_DATE


	)

394 
	#FIELD_TYPE_TIME
 
MYSQL_TYPE_TIME


	)

395 
	#FIELD_TYPE_DATETIME
 
MYSQL_TYPE_DATETIME


	)

396 
	#FIELD_TYPE_YEAR
 
MYSQL_TYPE_YEAR


	)

397 
	#FIELD_TYPE_NEWDATE
 
MYSQL_TYPE_NEWDATE


	)

398 
	#FIELD_TYPE_ENUM
 
MYSQL_TYPE_ENUM


	)

399 
	#FIELD_TYPE_SET
 
MYSQL_TYPE_SET


	)

400 
	#FIELD_TYPE_TINY_BLOB
 
MYSQL_TYPE_TINY_BLOB


	)

401 
	#FIELD_TYPE_MEDIUM_BLOB
 
MYSQL_TYPE_MEDIUM_BLOB


	)

402 
	#FIELD_TYPE_LONG_BLOB
 
MYSQL_TYPE_LONG_BLOB


	)

403 
	#FIELD_TYPE_BLOB
 
MYSQL_TYPE_BLOB


	)

404 
	#FIELD_TYPE_VAR_STRING
 
MYSQL_TYPE_VAR_STRING


	)

405 
	#FIELD_TYPE_STRING
 
MYSQL_TYPE_STRING


	)

406 
	#FIELD_TYPE_GEOMETRY
 
MYSQL_TYPE_GEOMETRY


	)

407 
	#FIELD_TYPE_BIT
 
MYSQL_TYPE_BIT


	)

409 
max_®lowed_·ck‘
;

410 
Ãt_bufãr_Ëngth
;

412 
	#Ãt_Ãw_Œª§ùiÚ
(
Ãt
è(Ò‘)->
pkt_Ä
=0)

	)

414 
ma_Ãt_š™
(
NET
 *
Ãt
, 
MARIADB_PVIO
 *
pvio
);

415 
ma_Ãt_’d
(
NET
 *
Ãt
);

416 
ma_Ãt_þ—r
(
NET
 *
Ãt
);

417 
ma_Ãt_æush
(
NET
 *
Ãt
);

418 
ma_Ãt_wr™e
(
NET
 *
Ãt
,cÚ¡ *
·ck‘
, 
size_t
 
Ën
);

419 
ma_Ãt_wr™e_commªd
(
NET
 *
Ãt
,
commªd
,cÚ¡ *
·ck‘
,

420 
size_t
 
Ën
, 
my_boÞ
 
di§bË_æush
);

421 
ma_Ãt_»®_wr™e
(
NET
 *
Ãt
,cÚ¡ *
·ck‘
, 
size_t
 
Ën
);

422 
ma_Ãt_»ad
(
NET
 *
Ãt
);

424 
	s¿nd_¡ruù
 {

425 
	m£ed1
,
	m£ed2
,
	mmax_v®ue
;

426 
	mmax_v®ue_dbl
;

431 
	eI‹m_»suÉ
 {
	mSTRING_RESULT
,
	mREAL_RESULT
,
	mINT_RESULT
,
	mROW_RESULT
,
	mDECIMAL_RESULT
};

433 
	s¡_udf_¬gs


435 
	m¬g_couÁ
;

436 
I‹m_»suÉ
 *
	m¬g_ty³
;

437 **
	m¬gs
;

438 *
	mËngths
;

439 *
	mmaybe_nuÎ
;

440 } 
	tUDF_ARGS
;

444 
	s¡_udf_š™


446 
my_boÞ
 
	mmaybe_nuÎ
;

447 
	mdecim®s
;

448 
	mmax_Ëngth
;

449 *
	m±r
;

450 
my_boÞ
 
	mcÚ¡_™em
;

451 } 
	tUDF_INIT
;

454 
	#MARIADB_CONNECTION_UNIXSOCKET
 0

	)

455 
	#MARIADB_CONNECTION_TCP
 1

	)

456 
	#MARIADB_CONNECTION_NAMEDPIPE
 2

	)

457 
	#MARIADB_CONNECTION_SHAREDMEM
 3

	)

460 
	#NET_HEADER_SIZE
 4

	)

461 
	#COMP_HEADER_SIZE
 3

	)

464 
	#Çtive_·sswÜd_¶ugš_Çme
 "mysql_Çtive_·sswÜd"

	)

465 
	#Þd_·sswÜd_¶ugš_Çme
 "mysql_Þd_·sswÜd"

	)

467 #ifdeà
__ýlu¥lus


471 *
ma_süambË_323
(*
to
,cÚ¡ *
mes§ge
,cÚ¡ *
·sswÜd
);

472 
ma_süambË_41
(cÚ¡ *
bufãr
, cÚ¡ *
süambË
, cÚ¡ *
·sswÜd
);

473 
ma_hash_·sswÜd
(*
»suÉ
, cÚ¡ *
·sswÜd
, 
size_t
 
Ën
);

474 
ma_make_süambËd_·sswÜd
(*
to
,cÚ¡ *
·sswÜd
);

478 
m¬Ÿdb_lßd_deçuÉs
(cÚ¡ *
cÚf_fže
, cÚ¡ **
groups
,

479 *
¬gc
, ***
¬gv
);

480 
my_boÞ
 
ma_th»ad_š™
();

481 
ma_th»ad_’d
();

483 #ifdeà
__ýlu¥lus


487 
	#NULL_LENGTH
 ((è~0è

	)

	@include/mariadb_ctype.h

23 #iâdeà
_m¬Ÿdb_ùy³_h


24 
	#_m¬Ÿdb_ùy³_h


	)

26 
	~<ùy³.h
>

28 #ifdef 
__ýlu¥lus


32 
	#CHARSET_DIR
 "ch¬£ts/"

	)

33 
	#MY_CS_NAME_SIZE
 32

	)

35 
	#MADB_DEFAULT_CHARSET_NAME
 "Ïtš1"

	)

36 
	#MADB_DEFAULT_COLLATION_NAME
 "Ïtš1_swedish_ci"

	)

37 
	#MADB_AUTODETECT_CHARSET_NAME
 "auto"

	)

40 
	sma_ch¬£t_šfo_¡


42 
Ä
;

43 
¡©e
;

44 cÚ¡ *
c¢ame
;

45 cÚ¡ *
Çme
;

46 cÚ¡ *
dœ
;

47 
cod•age
;

48 cÚ¡ *
’codšg
;

49 
ch¬_mšËn
;

50 
ch¬_maxËn
;

51 (*
mb_ch¬Ën
)(
c
);

52 (*
mb_v®id
)(cÚ¡ *
¡¬t
, cÚ¡ *
’d
);

53 } 
	tMARIADB_CHARSET_INFO
;

55 cÚ¡ 
MARIADB_CHARSET_INFO
 
m¬Ÿdb_compžed_ch¬£ts
[];

56 
MARIADB_CHARSET_INFO
 *
ma_deçuÉ_ch¬£t_šfo
;

57 
MARIADB_CHARSET_INFO
 *
ma_ch¬£t_bš
;

58 
MARIADB_CHARSET_INFO
 *
ma_ch¬£t_Ïtš1
;

59 
MARIADB_CHARSET_INFO
 *
ma_ch¬£t_utf8_g’”®_ci
;

60 
MARIADB_CHARSET_INFO
 *
ma_ch¬£t_utf16Ë_g’”®_ci
;

62 
MARIADB_CHARSET_INFO
 *
fšd_compžed_ch¬£t
(
cs_numb”
);

63 
MARIADB_CHARSET_INFO
 *
fšd_compžed_ch¬£t_by_Çme
(cÚ¡ *
Çme
);

65 
size_t
 
mysql_c£t_esÿ³_quÙes
(cÚ¡ 
MARIADB_CHARSET_INFO
 *
c£t
, *
Ãw¡r
, cÚ¡ *
esÿ³¡r
, size_ˆ
esÿ³¡r_Ën
);

66 
size_t
 
mysql_c£t_esÿ³_¦ashes
(cÚ¡ 
MARIADB_CHARSET_INFO
 *
c£t
, *
Ãw¡r
, cÚ¡ *
esÿ³¡r
, size_ˆ
esÿ³¡r_Ën
);

67 cÚ¡ * 
madb_g‘_os_ch¬aù”_£t
();

68 #ifdeà
_WIN32


69 
madb_g‘_wšdows_ý
(cÚ¡ *
ch¬£t
);

72 #ifdef 
__ýlu¥lus


	@include/mariadb_dyncol.h

29 #iâdeà
ma_dyncÞ_h


30 
	#ma_dyncÞ_h


	)

32 #ifdef 
__ýlu¥lus


36 #iâdeà
LIBMARIADB


37 
	~<decim®.h
>

38 
	~<my_decim®_lim™s.h
>

40 
	~<mysql.h
>

42 #iâdeà
lÚglÚg_defšed


43 #ià
defšed
(
HAVE_LONG_LONG
è&& 
SIZEOF_LONG
 != 8

44 
	tulÚglÚg
;

45 
	tlÚglÚg
;

47 
	tulÚglÚg
;

48 
	tlÚglÚg
;

50 
	#lÚglÚg_defšed


	)

54 #iâdeà
_my_sys_h


55 
	s¡_dyÇmic_¡ršg


57 *
¡r
;

58 
size_t
 
Ëngth
,
max_Ëngth
,
®loc_šüem’t
;

59 } 
	tDYNAMIC_STRING
;

62 
	s¡_mysql_Ëx_¡ršg


64 *
¡r
;

65 
size_t
 
Ëngth
;

67 
¡_mysql_Ëx_¡ršg
 
	tMYSQL_LEX_STRING
;

68 
¡_mysql_Ëx_¡ršg
 
	tLEX_STRING
;

72 
	#MAX_TOTAL_NAME_LENGTH
 65535

	)

73 
	#MAX_NAME_LENGTH
 (
MAX_TOTAL_NAME_LENGTH
/4)

	)

76 
	#ER_DYNCOL_NO
 
ER_DYNCOL_OK


	)

78 
	e’um_dyncÞ_func_»suÉ


80 
ER_DYNCOL_OK
= 0,

81 
ER_DYNCOL_YES
= 1,

82 
ER_DYNCOL_FORMAT
= -1,

83 
ER_DYNCOL_LIMIT
= -2,

84 
ER_DYNCOL_RESOURCE
= -3,

85 
ER_DYNCOL_DATA
= -4,

86 
ER_DYNCOL_UNKNOWN_CHARSET
= -5,

87 
ER_DYNCOL_TRUNCATED
= 2

90 
DYNAMIC_STRING
 
	tDYNAMIC_COLUMN
;

92 
	e’um_dyÇmic_cÞumn_ty³


94 
DYN_COL_NULL
= 0,

95 
DYN_COL_INT
,

96 
DYN_COL_UINT
,

97 
DYN_COL_DOUBLE
,

98 
DYN_COL_STRING
,

99 
DYN_COL_DECIMAL
,

100 
DYN_COL_DATETIME
,

101 
DYN_COL_DATE
,

102 
DYN_COL_TIME
,

103 
DYN_COL_DYNCOL


106 
’um_dyÇmic_cÞumn_ty³
 
	tDYNAMIC_COLUMN_TYPE
;

108 
	s¡_dyÇmic_cÞumn_v®ue


110 
DYNAMIC_COLUMN_TYPE
 
ty³
;

113 
lÚg_v®ue
;

114 
ulÚg_v®ue
;

115 
doubË_v®ue
;

117 
MYSQL_LEX_STRING
 
v®ue
;

118 
MARIADB_CHARSET_INFO
 *
ch¬£t
;

119 } 
¡ršg
;

120 #iâdeà
LIBMARIADB


122 
decim®_dig™_t
 
bufãr
[
DECIMAL_BUFF_LENGTH
];

123 
decim®_t
 
v®ue
;

124 } 
decim®
;

126 
MYSQL_TIME
 
time_v®ue
;

127 } 
x
;

130 
¡_dyÇmic_cÞumn_v®ue
 
	tDYNAMIC_COLUMN_VALUE
;

132 #ifdeà
MADYNCOL_DEPRECATED


133 
’um_dyncÞ_func_»suÉ


134 
dyÇmic_cÞumn_ü—‹
(
DYNAMIC_COLUMN
 *
¡r
,

135 
ušt
 
cÞumn_Ä
, 
DYNAMIC_COLUMN_VALUE
 *
v®ue
);

137 
’um_dyncÞ_func_»suÉ


138 
dyÇmic_cÞumn_ü—‹_mªy
(
DYNAMIC_COLUMN
 *
¡r
,

139 
ušt
 
cÞumn_couÁ
,

140 
ušt
 *
cÞumn_numb”s
,

141 
DYNAMIC_COLUMN_VALUE
 *
v®ues
);

142 
’um_dyncÞ_func_»suÉ


143 
dyÇmic_cÞumn_upd©e
(
DYNAMIC_COLUMN
 *
Üg
, 
ušt
 
cÞumn_Ä
,

144 
DYNAMIC_COLUMN_VALUE
 *
v®ue
);

145 
’um_dyncÞ_func_»suÉ


146 
dyÇmic_cÞumn_upd©e_mªy
(
DYNAMIC_COLUMN
 *
¡r
,

147 
ušt
 
add_cÞumn_couÁ
,

148 
ušt
 *
cÞumn_numb”s
,

149 
DYNAMIC_COLUMN_VALUE
 *
v®ues
);

151 
’um_dyncÞ_func_»suÉ


152 
dyÇmic_cÞumn_exi¡s
(
DYNAMIC_COLUMN
 *
Üg
, 
ušt
 
cÞumn_Ä
);

154 
’um_dyncÞ_func_»suÉ


155 
dyÇmic_cÞumn_li¡
(
DYNAMIC_COLUMN
 *
Üg
, 
DYNAMIC_ARRAY
 *
¬¿y_of_ušt
);

157 
’um_dyncÞ_func_»suÉ


158 
dyÇmic_cÞumn_g‘
(
DYNAMIC_COLUMN
 *
Üg
, 
ušt
 
cÞumn_Ä
,

159 
DYNAMIC_COLUMN_VALUE
 *
¡Üe_™_h”e
);

163 
’um_dyncÞ_func_»suÉ


164 
m¬Ÿdb_dyncÞ_ü—‹_mªy_num
(
DYNAMIC_COLUMN
 *
¡r
,

165 
ušt
 
cÞumn_couÁ
,

166 
ušt
 *
cÞumn_numb”s
,

167 
DYNAMIC_COLUMN_VALUE
 *
v®ues
,

168 
my_boÞ
 
Ãw_¡ršg
);

169 
’um_dyncÞ_func_»suÉ


170 
m¬Ÿdb_dyncÞ_ü—‹_mªy_Çmed
(
DYNAMIC_COLUMN
 *
¡r
,

171 
ušt
 
cÞumn_couÁ
,

172 
MYSQL_LEX_STRING
 *
cÞumn_keys
,

173 
DYNAMIC_COLUMN_VALUE
 *
v®ues
,

174 
my_boÞ
 
Ãw_¡ršg
);

177 
’um_dyncÞ_func_»suÉ


178 
m¬Ÿdb_dyncÞ_upd©e_mªy_num
(
DYNAMIC_COLUMN
 *
¡r
,

179 
ušt
 
add_cÞumn_couÁ
,

180 
ušt
 *
cÞumn_keys
,

181 
DYNAMIC_COLUMN_VALUE
 *
v®ues
);

182 
’um_dyncÞ_func_»suÉ


183 
m¬Ÿdb_dyncÞ_upd©e_mªy_Çmed
(
DYNAMIC_COLUMN
 *
¡r
,

184 
ušt
 
add_cÞumn_couÁ
,

185 
MYSQL_LEX_STRING
 *
cÞumn_keys
,

186 
DYNAMIC_COLUMN_VALUE
 *
v®ues
);

189 
’um_dyncÞ_func_»suÉ


190 
m¬Ÿdb_dyncÞ_exi¡s_num
(
DYNAMIC_COLUMN
 *
Üg
, 
ušt
 
cÞumn_Ä
);

191 
’um_dyncÞ_func_»suÉ


192 
m¬Ÿdb_dyncÞ_exi¡s_Çmed
(
DYNAMIC_COLUMN
 *
¡r
, 
MYSQL_LEX_STRING
 *
Çme
);

195 
’um_dyncÞ_func_»suÉ


196 
m¬Ÿdb_dyncÞ_li¡_num
(
DYNAMIC_COLUMN
 *
¡r
, 
ušt
 *
couÁ
, ušˆ**
nums
);

197 
’um_dyncÞ_func_»suÉ


198 
m¬Ÿdb_dyncÞ_li¡_Çmed
(
DYNAMIC_COLUMN
 *
¡r
, 
ušt
 *
couÁ
,

199 
MYSQL_LEX_STRING
 **
Çmes
);

204 
’um_dyncÞ_func_»suÉ


205 
m¬Ÿdb_dyncÞ_g‘_num
(
DYNAMIC_COLUMN
 *
Üg
, 
ušt
 
cÞumn_Ä
,

206 
DYNAMIC_COLUMN_VALUE
 *
¡Üe_™_h”e
);

207 
’um_dyncÞ_func_»suÉ


208 
m¬Ÿdb_dyncÞ_g‘_Çmed
(
DYNAMIC_COLUMN
 *
¡r
, 
MYSQL_LEX_STRING
 *
Çme
,

209 
DYNAMIC_COLUMN_VALUE
 *
¡Üe_™_h”e
);

211 
my_boÞ
 
m¬Ÿdb_dyncÞ_has_Çmes
(
DYNAMIC_COLUMN
 *
¡r
);

213 
’um_dyncÞ_func_»suÉ


214 
m¬Ÿdb_dyncÞ_check
(
DYNAMIC_COLUMN
 *
¡r
);

216 
’um_dyncÞ_func_»suÉ


217 
m¬Ÿdb_dyncÞ_jsÚ
(
DYNAMIC_COLUMN
 *
¡r
, 
DYNAMIC_STRING
 *
jsÚ
);

219 
m¬Ÿdb_dyncÞ_ä“
(
DYNAMIC_COLUMN
 *
¡r
);

221 
	#m¬Ÿdb_dyncÞ_š™
(
A
è
	`mem£t
((A), 0, (
DYNAMIC_COLUMN
))

	)

222 
	#dyÇmic_cÞumn_š™Ÿlize
(
A
è
	`m¬Ÿdb_dyncÞ_š™
((A))

	)

223 
	#dyÇmic_cÞumn_cÞumn_ä“
(
A
è
	`m¬Ÿdb_dyncÞ_ä“
((A))

	)

226 
’um_dyncÞ_func_»suÉ


227 
m¬Ÿdb_dyncÞ_v®_¡r
(
DYNAMIC_STRING
 *
¡r
, 
DYNAMIC_COLUMN_VALUE
 *
v®
,

228 
MARIADB_CHARSET_INFO
 *
cs
, 
quÙe
);

229 
’um_dyncÞ_func_»suÉ


230 
m¬Ÿdb_dyncÞ_v®_lÚg
(
lÚglÚg
 *
Î
, 
DYNAMIC_COLUMN_VALUE
 *
v®
);

231 
’um_dyncÞ_func_»suÉ


232 
m¬Ÿdb_dyncÞ_v®_doubË
(*
dbl
, 
DYNAMIC_COLUMN_VALUE
 *
v®
);

234 
’um_dyncÞ_func_»suÉ


235 
m¬Ÿdb_dyncÞ_uÅack
(
DYNAMIC_COLUMN
 *
¡r
,

236 
ušt
 *
couÁ
,

237 
MYSQL_LEX_STRING
 **
Çmes
, 
DYNAMIC_COLUMN_VALUE
 **
v®s
);

239 
m¬Ÿdb_dyncÞ_cÞumn_cmp_Çmed
(cÚ¡ 
MYSQL_LEX_STRING
 *
s1
,

240 cÚ¡ 
MYSQL_LEX_STRING
 *
s2
);

242 
’um_dyncÞ_func_»suÉ


243 
m¬Ÿdb_dyncÞ_cÞumn_couÁ
(
DYNAMIC_COLUMN
 *
¡r
, 
ušt
 *
cÞumn_couÁ
);

245 
	#m¬Ÿdb_dyncÞ_v®ue_š™
(
V
) \

247 (
V
)->
ty³
ð
DYN_COL_NULL
;\

248 } 0)

	)

253 
m¬Ÿdb_dyncÞ_´•¬e_decim®
(
DYNAMIC_COLUMN_VALUE
 *
v®ue
);

256 #ifdef 
__ýlu¥lus


	@include/mariadb_rpl.h

17 #iâdeà
_m¬Ÿdb_½l_h_


18 
	#_m¬Ÿdb_½l_h_


	)

20 #ifdef 
__ýlu¥lus


24 
	~<¡dšt.h
>

26 
	#MARIADB_RPL_VERSION
 0x0001

	)

27 
	#MARIADB_RPL_REQUIRED_VERSION
 0x0001

	)

30 
	#MARIADB_RPL_BINLOG_DUMP_NON_BLOCK
 1

	)

31 
	#MARIADB_RPL_BINLOG_SEND_ANNOTATE_ROWS
 2

	)

32 
	#MARIADB_RPL_IGNORE_HEARTBEAT
 (1 << 17)

	)

34 
	#EVENT_HEADER_OFS
 20

	)

36 
	#FL_GROUP_COMMIT_ID
 2

	)

37 
	#FL_STMT_END
 1

	)

39 
	#LOG_EVENT_ARTIFICIAL_F
 0x20

	)

43 
	em¬Ÿdb_½l_ÝtiÚ
 {

44 
MARIADB_RPL_FILENAME
,

45 
MARIADB_RPL_START
,

46 
MARIADB_RPL_SERVER_ID
,

47 
MARIADB_RPL_FLAGS
,

48 
MARIADB_RPL_GTID_CALLBACK
,

49 
MARIADB_RPL_GTID_DATA
,

50 
MARIADB_RPL_BUFFER


54 
	em¬Ÿdb_½l_ev’t
 {

55 
UNKNOWN_EVENT
= 0,

56 
START_EVENT_V3
= 1,

57 
QUERY_EVENT
= 2,

58 
STOP_EVENT
= 3,

59 
ROTATE_EVENT
= 4,

60 
INTVAR_EVENT
= 5,

61 
LOAD_EVENT
= 6,

62 
SLAVE_EVENT
= 7,

63 
CREATE_FILE_EVENT
= 8,

64 
APPEND_BLOCK_EVENT
= 9,

65 
EXEC_LOAD_EVENT
= 10,

66 
DELETE_FILE_EVENT
= 11,

67 
NEW_LOAD_EVENT
= 12,

68 
RAND_EVENT
= 13,

69 
USER_VAR_EVENT
= 14,

70 
FORMAT_DESCRIPTION_EVENT
= 15,

71 
XID_EVENT
= 16,

72 
BEGIN_LOAD_QUERY_EVENT
= 17,

73 
EXECUTE_LOAD_QUERY_EVENT
= 18,

74 
TABLE_MAP_EVENT
 = 19,

76 
PRE_GA_WRITE_ROWS_EVENT
 = 20,

77 
PRE_GA_UPDATE_ROWS_EVENT
 = 21,

78 
PRE_GA_DELETE_ROWS_EVENT
 = 22,

80 
WRITE_ROWS_EVENT_V1
 = 23,

81 
UPDATE_ROWS_EVENT_V1
 = 24,

82 
DELETE_ROWS_EVENT_V1
 = 25,

83 
INCIDENT_EVENT
= 26,

84 
HEARTBEAT_LOG_EVENT
= 27,

85 
IGNORABLE_LOG_EVENT
= 28,

86 
ROWS_QUERY_LOG_EVENT
= 29,

87 
WRITE_ROWS_EVENT
 = 30,

88 
UPDATE_ROWS_EVENT
 = 31,

89 
DELETE_ROWS_EVENT
 = 32,

90 
GTID_LOG_EVENT
= 33,

91 
ANONYMOUS_GTID_LOG_EVENT
= 34,

92 
PREVIOUS_GTIDS_LOG_EVENT
= 35,

93 
TRANSACTION_CONTEXT_EVENT
= 36,

94 
VIEW_CHANGE_EVENT
= 37,

95 
XA_PREPARE_LOG_EVENT
= 38,

103 
MYSQL_EVENTS_END
,

105 
MARIA_EVENTS_BEGIN
= 160,

106 
ANNOTATE_ROWS_EVENT
= 160,

107 
BINLOG_CHECKPOINT_EVENT
= 161,

108 
GTID_EVENT
= 162,

109 
GTID_LIST_EVENT
= 163,

110 
START_ENCRYPTION_EVENT
= 164,

111 
QUERY_COMPRESSED_EVENT
 = 165,

112 
WRITE_ROWS_COMPRESSED_EVENT_V1
 = 166,

113 
UPDATE_ROWS_COMPRESSED_EVENT_V1
 = 167,

114 
DELETE_ROWS_COMPRESSED_EVENT_V1
 = 168,

115 
WRITE_ROWS_COMPRESSED_EVENT
 = 169,

116 
UPDATE_ROWS_COMPRESSED_EVENT
 = 170,

117 
DELETE_ROWS_COMPRESSED_EVENT
 = 171,

121 
ENUM_END_EVENT


125 *
¡r
;

126 
size_t
 
Ëngth
;

127 } 
	tMARIADB_STRING
;

129 
	em¬Ÿdb_row_ev’t_ty³
 {

130 
WRITE_ROWS
= 0,

131 
UPDATE_ROWS
= 1,

132 
DELETE_ROWS
= 2

136 
	s¡_m¬Ÿdb_gtid
 {

137 
domaš_id
;

138 
£rv”_id
;

139 
£qu’û_Ä
;

140 } 
	tMARIADB_GTID
;

143 
	s¡_m¬Ÿdb_½l
 {

144 
v”siÚ
;

145 
MYSQL
 *
mysql
;

146 *
fž’ame
;

147 
ušt32_t
 
fž’ame_Ëngth
;

148 *
bufãr
;

149 
bufãr_size
;

150 
ušt32_t
 
£rv”_id
;

151 
¡¬t_pos™iÚ
;

152 
ušt32_t
 
æags
;

153 
ušt8_t
 
fd_h—d”_Ën
;

154 
ušt8_t
 
u£_checksum
;

155 } 
	tMARIADB_RPL
;

158 
	s¡_m¬Ÿdb_½l_rÙ©e_ev’t
 {

159 
pos™iÚ
;

160 
MARIADB_STRING
 
fž’ame
;

163 
	s¡_m¬Ÿdb_½l_qu”y_ev’t
 {

164 
ušt32_t
 
th»ad_id
;

165 
ušt32_t
 
£cÚds
;

166 
MARIADB_STRING
 
d©aba£
;

167 
ušt32_t
 
”rÜÄ
;

168 
MARIADB_STRING
 
¡©us
;

169 
MARIADB_STRING
 
¡©em’t
;

172 
	s¡_m¬Ÿdb_½l_gtid_li¡_ev’t
 {

173 
ušt32_t
 
gtid_út
;

174 
MARIADB_GTID
 *
gtid
;

177 
	s¡_m¬Ÿdb_½l_fÜm©_desütiÚ_ev’t


179 
ušt16_t
 
fÜm©
;

180 *
£rv”_v”siÚ
;

181 
ušt32_t
 
time¡amp
;

182 
ušt8_t
 
h—d”_Ën
;

185 
	s¡_m¬Ÿdb_½l_checkpošt_ev’t
 {

186 
MARIADB_STRING
 
fž’ame
;

189 
	s¡_m¬Ÿdb_½l_xid_ev’t
 {

190 
ušt64_t
 
Œª§ùiÚ_Ä
;

193 
	s¡_m¬Ÿdb_½l_gtid_ev’t
 {

194 
ušt64_t
 
£qu’û_Ä
;

195 
ušt32_t
 
domaš_id
;

196 
ušt8_t
 
æags
;

197 
ušt64_t
 
comm™_id
;

200 
	s¡_m¬Ÿdb_½l_ªnÙ©e_rows_ev’t
 {

201 
MARIADB_STRING
 
¡©em’t
;

204 
	s¡_m¬Ÿdb_½l_bË_m­_ev’t
 {

205 
bË_id
;

206 
MARIADB_STRING
 
d©aba£
;

207 
MARIADB_STRING
 
bË
;

208 
cÞumn_couÁ
;

209 
MARIADB_STRING
 
cÞumn_ty³s
;

210 
MARIADB_STRING
 
m‘ad©a
;

211 *
nuÎ_šdiÿtÜ
;

214 
	s¡_m¬Ÿdb_½l_¿nd_ev’t
 {

215 
fœ¡_£ed
;

216 
£cÚd_£ed
;

219 
	s¡_m¬Ÿdb_½l_’üy±iÚ_ev’t
 {

220 
scheme
;

221 
key_v”siÚ
;

222 *
nÚû
;

225 
	s¡_m¬Ÿdb_½l_štv¬_ev’t
 {

226 
ty³
;

227 
v®ue
;

230 
	s¡_m¬Ÿdb_½l_u£rv¬_ev’t
 {

231 
MARIADB_STRING
 
Çme
;

232 
ušt8_t
 
is_nuÎ
;

233 
ušt8_t
 
ty³
;

234 
ušt32_t
 
ch¬£t_Ä
;

235 
MARIADB_STRING
 
v®ue
;

236 
ušt8_t
 
æags
;

239 
	s¡_m¬Ÿdb_½l_rows_ev’t
 {

240 
m¬Ÿdb_row_ev’t_ty³
 
ty³
;

241 
ušt64_t
 
bË_id
;

242 
ušt16_t
 
æags
;

243 
ušt32_t
 
cÞumn_couÁ
;

244 *
cÞumn_b™m­
;

245 *
cÞumn_upd©e_b™m­
;

246 
size_t
 
row_d©a_size
;

247 *
row_d©a
;

250 
	s¡_m¬Ÿdb_½l_h—¹b—t_ev’t
 {

251 
ušt32_t
 
time¡amp
;

252 
ušt32_t
 
Ãxt_pos™iÚ
;

253 
ušt8_t
 
ty³
;

254 
ušt16_t
 
æags
;

257 
	s¡_m¬Ÿdb_½l_ev’t


260 
MA_MEM_ROOT
 
memroÙ
;

261 
checksum
;

262 
ok
;

263 
m¬Ÿdb_½l_ev’t
 
ev’t_ty³
;

264 
time¡amp
;

265 
£rv”_id
;

266 
ev’t_Ëngth
;

267 
Ãxt_ev’t_pos
;

268 
æags
;

271 
¡_m¬Ÿdb_½l_rÙ©e_ev’t
 
rÙ©e
;

272 
¡_m¬Ÿdb_½l_qu”y_ev’t
 
qu”y
;

273 
¡_m¬Ÿdb_½l_fÜm©_desütiÚ_ev’t
 
fÜm©_desütiÚ
;

274 
¡_m¬Ÿdb_½l_gtid_li¡_ev’t
 
gtid_li¡
;

275 
¡_m¬Ÿdb_½l_checkpošt_ev’t
 
checkpošt
;

276 
¡_m¬Ÿdb_½l_xid_ev’t
 
xid
;

277 
¡_m¬Ÿdb_½l_gtid_ev’t
 
gtid
;

278 
¡_m¬Ÿdb_½l_ªnÙ©e_rows_ev’t
 
ªnÙ©e_rows
;

279 
¡_m¬Ÿdb_½l_bË_m­_ev’t
 
bË_m­
;

280 
¡_m¬Ÿdb_½l_¿nd_ev’t
 
¿nd
;

281 
¡_m¬Ÿdb_½l_’üy±iÚ_ev’t
 
’üy±iÚ
;

282 
¡_m¬Ÿdb_½l_štv¬_ev’t
 
štv¬
;

283 
¡_m¬Ÿdb_½l_u£rv¬_ev’t
 
u£rv¬
;

284 
¡_m¬Ÿdb_½l_rows_ev’t
 
rows
;

285 
¡_m¬Ÿdb_½l_h—¹b—t_ev’t
 
h—¹b—t
;

286 } 
ev’t
;

287 } 
	tMARIADB_RPL_EVENT
;

289 
	#m¬Ÿdb_½l_š™
(
a
è
	`m¬Ÿdb_½l_š™_ex
(×), 
MARIADB_RPL_VERSION
)

	)

292 
MARIADB_RPL
 * 
STDCALL
 
m¬Ÿdb_½l_š™_ex
(
MYSQL
 *
mysql
, 
v”siÚ
);

294 
m¬Ÿdb_½l_ÝtiÚsv
(
MARIADB_RPL
 *
½l
, 
m¬Ÿdb_½l_ÝtiÚ
, ...);

295 
m¬Ÿdb_½l_g‘_ÝtiÚsv
(
MARIADB_RPL
 *
½l
, 
m¬Ÿdb_½l_ÝtiÚ
, ...);

297 
STDCALL
 
m¬Ÿdb_½l_Ý’
(
MARIADB_RPL
 *
½l
);

298 
STDCALL
 
m¬Ÿdb_½l_þo£
(
MARIADB_RPL
 *
½l
);

299 
MARIADB_RPL_EVENT
 * 
STDCALL
 
m¬Ÿdb_½l_ãtch
(
MARIADB_RPL
 *
½l
, MARIADB_RPL_EVENT *
ev’t
);

300 
STDCALL
 
m¬Ÿdb_ä“_½l_ev’t
(
MARIADB_RPL_EVENT
 *
ev’t
);

302 #ifdef 
__ýlu¥lus


	@include/mariadb_stmt.h

23 
	~<¡dšt.h
>

25 
	#MYSQL_NO_DATA
 100

	)

26 
	#MYSQL_DATA_TRUNCATED
 101

	)

27 
	#MYSQL_DEFAULT_PREFETCH_ROWS
 (è1

	)

30 
	#MADB_BIND_DUMMY
 1

	)

32 
	#MARIADB_STMT_BULK_SUPPORTED
(
¡mt
)\

33 ((
¡mt
)->
mysql
 && \

34 (!((
¡mt
)->
mysql
->
£rv”_ÿ·bž™›s
 & 
CLIENT_MYSQL
) &&\

35 ((
¡mt
)->
mysql
->
ex‹nsiÚ
->
m¬Ÿdb_£rv”_ÿ·bž™›s
 & \

36 (
MARIADB_CLIENT_STMT_BULK_OPERATIONS
 >> 32))))

	)

38 
	#SET_CLIENT_STMT_ERROR
(
a
, 
b
, 
c
, 
d
) \

40 (
a
)->
Ï¡_”ºo
ð(
b
);\

41 
	`¡ºýy
((
a
)->
sql¡©e
, (
c
), 
SQLSTATE_LENGTH
);\

42 (
a
)->
sql¡©e
[
SQLSTATE_LENGTH
]= 0;\

43 
	`¡ºýy
((
a
)->
Ï¡_”rÜ
, (
d
è? (dè: 
	`ER
((
b
)), 
MYSQL_ERRMSG_SIZE
);\

44 (
a
)->
Ï¡_”rÜ
[
MYSQL_ERRMSG_SIZE
 - 1]= 0;\

45 } 0)

	)

47 
	#CLEAR_CLIENT_STMT_ERROR
(
a
) \

49 (
a
)->
Ï¡_”ºo
= 0;\

50 
	`¡rýy
((
a
)->
sql¡©e
, "00000");\

51 (
a
)->
Ï¡_”rÜ
[0]= 0;\

52 } 0)

	)

54 
	#MYSQL_PS_SKIP_RESULT_W_LEN
 -1

	)

55 
	#MYSQL_PS_SKIP_RESULT_STR
 -2

	)

56 
	#STMT_ID_LENGTH
 4

	)

59 
¡_mysql_¡mt
 
	tMYSQL_STMT
;

61 
	gMYSQL_RES
* (*
	tmysql_¡mt_u£_Ü_¡Üe_func
)(
	tMYSQL_STMT
 *);

63 
	e’um_¡mt_©Œ_ty³


65 
	mSTMT_ATTR_UPDATE_MAX_LENGTH
,

66 
	mSTMT_ATTR_CURSOR_TYPE
,

67 
	mSTMT_ATTR_PREFETCH_ROWS
,

70 
	mSTMT_ATTR_PREBIND_PARAMS
=200,

71 
	mSTMT_ATTR_ARRAY_SIZE
,

72 
	mSTMT_ATTR_ROW_SIZE
,

73 
	mSTMT_ATTR_STATE
,

74 
	mSTMT_ATTR_CB_USER_DATA
,

75 
	mSTMT_ATTR_CB_PARAM
,

76 
	mSTMT_ATTR_CB_RESULT


79 
	e’um_cursÜ_ty³


81 
	mCURSOR_TYPE_NO_CURSOR
= 0,

82 
	mCURSOR_TYPE_READ_ONLY
= 1,

83 
	mCURSOR_TYPE_FOR_UPDATE
= 2,

84 
	mCURSOR_TYPE_SCROLLABLE
= 4

87 
	e’um_šdiÿtÜ_ty³


89 
	mSTMT_INDICATOR_NTS
=-1,

90 
	mSTMT_INDICATOR_NONE
=0,

91 
	mSTMT_INDICATOR_NULL
=1,

92 
	mSTMT_INDICATOR_DEFAULT
=2,

93 
	mSTMT_INDICATOR_IGNORE
=3,

94 
	mSTMT_INDICATOR_IGNORE_ROW
=4

100 
	#STMT_BULK_FLAG_CLIENT_SEND_TYPES
 128

	)

101 
	#STMT_BULK_FLAG_INSERT_ID_REQUEST
 64

	)

103 
	emysql_¡mt_¡©e


105 
	mMYSQL_STMT_INITTED
 = 0,

106 
	mMYSQL_STMT_PREPARED
,

107 
	mMYSQL_STMT_EXECUTED
,

108 
	mMYSQL_STMT_WAITING_USE_OR_STORE
,

109 
	mMYSQL_STMT_USE_OR_STORE_CALLED
,

110 
	mMYSQL_STMT_USER_FETCHING
,

111 
	mMYSQL_STMT_FETCH_DONE


112 } 
	t’um_mysqÊd_¡mt_¡©e
;

114 
	s¡_mysql_bšd


116 *
	mËngth
;

117 
my_boÞ
 *
	mis_nuÎ
;

118 *
	mbufãr
;

120 
my_boÞ
 *
	m”rÜ
;

122 *
	mrow_±r
;

123 *
	mšdiÿtÜ
;

124 } 
	mu
;

125 (*
	m¡Üe_·¿m_func
)(
NET
 *
	mÃt
, 
¡_mysql_bšd
 *
	m·¿m
);

126 (*
	mãtch_»suÉ
)(
	m¡_mysql_bšd
 *, 
	mMYSQL_FIELD
 *,

127 **
	mrow
);

128 (*
	msk_»suÉ
)(
	m¡_mysql_bšd
 *, 
	mMYSQL_FIELD
 *,

129 **
	mrow
);

131 
	mbufãr_Ëngth
;

132 
	moff£t
;

133 
	mËngth_v®ue
;

134 
	mæags
;

135 
	m·ck_Ëngth
;

136 
’um_f›ld_ty³s
 
	mbufãr_ty³
;

137 
my_boÞ
 
	m”rÜ_v®ue
;

138 
my_boÞ
 
	mis_unsigÃd
;

139 
my_boÞ
 
	mlÚg_d©a_u£d
;

140 
my_boÞ
 
	mis_nuÎ_v®ue
;

141 *
	mex‹nsiÚ
;

142 } 
	tMYSQL_BIND
;

145 
	#COMPLEX_BIND_HEADER
 \

146 
’um_f›ld_ty³s
 
bufãr_ty³
;\

147 *
bufãr
; \

148 
my_boÞ
 
is_nuÎ


	)

150 
	#COMPLEX_OBJECT_HEADER
 \

151 
COMPLEX_BIND_HEADER
; \

152 *
ty³_Çme
; \

153 *
owÃr_Çme
; \

154 
Ëngth


	)

156 
	s¡_mysql_com¶ex_bšd_h—d”


158 
	mCOMPLEX_BIND_HEADER
;

159 } 
	tMYSQL_COMPLEX_BIND_HEADER
;

161 
¡_mysql_com¶ex_bšd_h—d”
 
	tMYSQL_COMPLEX_BIND_BASIC
;

163 
	s¡_mysql_com¶ex_bšd_¡ršg


165 
	mCOMPLEX_BIND_HEADER
;

166 
	mËngth
;

167 } 
	tMYSQL_COMPLEX_BIND_STRING
;

169 
¡_mysql_com¶ex_bšd_¡ršg
 
	tMYSQL_COMPLEX_BIND_DECIMAL
;

171 
	s¡_mysql_com¶ex_bšd_objeù


173 
	mCOMPLEX_OBJECT_HEADER
;

174 } 
	tMYSQL_COMPLEX_BIND_OBJECT
;

176 
¡_mysql_com¶ex_bšd_objeù
 
	tMYSQL_COMPLEX_BIND_ARRAY
;

178 
	#MAX_OB_LOB_LOCATOR_HEADER_LENGTH
 40

	)

180 
	sObLobLoÿtÜ


182 
ušt32_t
 
	mmagic_code_
;

183 
ušt32_t
 
	mv”siÚ_
;

184 
št64_t
 
	m¢­shÙ_v”siÚ_
;

185 
ušt64_t
 
	mbË_id_
;

186 
ušt32_t
 
	mcÞumn_id_
;

187 
ušt16_t
 
	mmode_
;

188 
ušt16_t
 
	mÝtiÚ_
;

189 
ušt32_t
 
	m·ylßd_off£t_
;

190 
ušt32_t
 
	m·ylßd_size_
;

191 
	md©a_
[1];

192 } 
	tOB_LOB_LOCATOR
;

194 
	s¡_mysqÊd_up£¹_»suÉ


196 
	mw¬nšg_couÁ
;

197 
	m£rv”_¡©us
;

198 
	mafãùed_rows
;

199 
	mÏ¡_š£¹_id
;

200 } 
	tmysql_up£¹_¡©us
;

202 
	s¡_mysql_cmd_bufãr


204 *
	mbufãr
;

205 
size_t
 
	mËngth
;

206 } 
	tMYSQL_CMD_BUFFER
;

208 
	s¡_mysql_”rÜ_šfo


210 
	m”rÜ_no
;

211 
	m”rÜ
[
MYSQL_ERRMSG_SIZE
+1];

212 
	msql¡©e
[
SQLSTATE_LENGTH
 + 1];

213 } 
	tmysql_”rÜ_šfo
;

216 
	s¡_mysqÊd_¡mt_m‘hods


218 
my_boÞ
 (*
´•¬e
)(cÚ¡ 
MYSQL_STMT
 * 
	m¡mt
, cÚ¡ * cÚ¡ 
	mqu”y
, 
size_t
 
	mqu”y_Ën
);

219 
my_boÞ
 (*
execu‹
)(cÚ¡ 
MYSQL_STMT
 * 
	m¡mt
);

220 
	mMYSQL_RES
 * (*
	mu£_»suÉ
)(cÚ¡ 
MYSQL_STMT
 * 
	m¡mt
);

221 
	mMYSQL_RES
 * (*
	m¡Üe_»suÉ
)(cÚ¡ 
MYSQL_STMT
 * 
	m¡mt
);

222 
	mMYSQL_RES
 * (*
	mg‘_»suÉ
)(cÚ¡ 
MYSQL_STMT
 * 
	m¡mt
);

223 
my_boÞ
 (*
ä“_»suÉ
)(cÚ¡ 
MYSQL_STMT
 * 
	m¡mt
);

224 
my_boÞ
 (*
£ek_d©a
)(cÚ¡ 
MYSQL_STMT
 * 
	m¡mt
, 
	mrow
);

225 
my_boÞ
 (*
»£t
)(cÚ¡ 
MYSQL_STMT
 * 
	m¡mt
);

226 
my_boÞ
 (*
þo£
)(cÚ¡ 
MYSQL_STMT
 * 
	m¡mt
);

227 
my_boÞ
 (*
dtÜ
)(cÚ¡ 
MYSQL_STMT
 * 
	m¡mt
);

229 
my_boÞ
 (*
ãtch
)(cÚ¡ 
MYSQL_STMT
 * 
	m¡mt
, my_boÞ * cÚ¡ 
	mãtched_ªythšg
);

231 
my_boÞ
 (*
bšd_·¿m
)(cÚ¡ 
MYSQL_STMT
 * 
	m¡mt
, cÚ¡ 
MYSQL_BIND
 
	mbšd
);

232 
my_boÞ
 (*
»äesh_bšd_·¿m
)(cÚ¡ 
MYSQL_STMT
 * 
	m¡mt
);

233 
my_boÞ
 (*
bšd_»suÉ
)(cÚ¡ 
MYSQL_STMT
 * 
	m¡mt
, cÚ¡ 
MYSQL_BIND
 *
	mbšd
);

234 
my_boÞ
 (*
£nd_lÚg_d©a
)(cÚ¡ 
MYSQL_STMT
 * 
	m¡mt
, 
	m·¿m_num
,

235 cÚ¡ * cÚ¡ 
	md©a
, 
size_t
 
	mËngth
);

236 
	mMYSQL_RES
 *(*
	mg‘_·¿m‘”_m‘ad©a
)(cÚ¡ 
MYSQL_STMT
 * 
	m¡mt
);

237 
	mMYSQL_RES
 *(*
	mg‘_»suÉ_m‘ad©a
)(cÚ¡ 
MYSQL_STMT
 * 
	m¡mt
);

238 (*
	mg‘_Ï¡_š£¹_id
)(cÚ¡ 
MYSQL_STMT
 * 
	m¡mt
);

239 (*
	mg‘_afãùed_rows
)(cÚ¡ 
MYSQL_STMT
 * 
	m¡mt
);

240 (*
	mg‘_num_rows
)(cÚ¡ 
MYSQL_STMT
 * 
	m¡mt
);

242 (*
	mg‘_·¿m_couÁ
)(cÚ¡ 
MYSQL_STMT
 * 
	m¡mt
);

243 (*
	mg‘_f›ld_couÁ
)(cÚ¡ 
MYSQL_STMT
 * 
	m¡mt
);

244 (*
	mg‘_w¬nšg_couÁ
)(cÚ¡ 
MYSQL_STMT
 * 
	m¡mt
);

246 (*
	mg‘_”rÜ_no
)(cÚ¡ 
MYSQL_STMT
 * 
	m¡mt
);

247 cÚ¡ * (*
	mg‘_”rÜ_¡r
)(cÚ¡ 
MYSQL_STMT
 * 
	m¡mt
);

248 cÚ¡ * (*
	mg‘_sql¡©e
)(cÚ¡ 
MYSQL_STMT
 * 
	m¡mt
);

250 
my_boÞ
 (*
g‘_©Œibu‹
)(cÚ¡ 
MYSQL_STMT
 * 
	m¡mt
, 
’um_¡mt_©Œ_ty³
 
	m©Œ_ty³
, cÚ¡ * 
	mv®ue
);

251 
my_boÞ
 (*
£t_©Œibu‹
)(cÚ¡ 
MYSQL_STMT
 * 
	m¡mt
, 
’um_¡mt_©Œ_ty³
 
	m©Œ_ty³
, cÚ¡ * 
	mv®ue
);

252 (*
	m£t_”rÜ
)(
MYSQL_STMT
 *
	m¡mt
, 
	m”rÜ_Ä
, cÚ¡ *
	msql¡©e
, cÚ¡ *
	mfÜm©
, ...);

255 (*
	tmysql_¡mt_ãtch_row_func
)(
	tMYSQL_STMT
 *
	t¡mt
, **
	trow
);

256 (*
	tps_»suÉ_ÿÎback
)(*
	td©a
, 
	tcÞumn
, **
	trow
);

257 
my_boÞ
 *(*
	tps_·¿m_ÿÎback
)(*
	td©a
, 
	tMYSQL_BIND
 *
	tbšd
, 
	trow_Ä
);

259 
	s¡_mysql_¡mt


261 
MA_MEM_ROOT
 
mem_roÙ
;

262 
MYSQL
 *
mysql
;

263 
¡mt_id
;

264 
æags
;

265 
’um_mysqÊd_¡mt_¡©e
 
¡©e
;

266 
MYSQL_FIELD
 *
f›lds
;

267 
f›ld_couÁ
;

268 
·¿m_couÁ
;

269 
£nd_ty³s_to_£rv”
;

270 
MYSQL_BIND
 *
·¿ms
;

271 
MYSQL_BIND
 *
bšd
;

272 
MYSQL_DATA
 
»suÉ
;

273 
MYSQL_ROWS
 *
»suÉ_cursÜ
;

274 
my_boÞ
 
bšd_»suÉ_dÚe
;

275 
my_boÞ
 
bšd_·¿m_dÚe
;

277 
mysql_up£¹_¡©us
 
up£¹_¡©us
;

279 
Ï¡_”ºo
;

280 
Ï¡_”rÜ
[
MYSQL_ERRMSG_SIZE
+1];

281 
sql¡©e
[
SQLSTATE_LENGTH
 + 1];

283 
my_boÞ
 
upd©e_max_Ëngth
;

284 
´eãtch_rows
;

285 
LIST
 
li¡
;

287 
my_boÞ
 
cursÜ_exi¡s
;

289 *
ex‹nsiÚ
;

290 
mysql_¡mt_ãtch_row_func
 
ãtch_row_func
;

291 
execu‹_couÁ
;

292 
mysql_¡mt_u£_Ü_¡Üe_func
 
deçuÉ_r£t_hªdËr
;

293 
¡_mysqÊd_¡mt_m‘hods
 *
m
;

294 
¬¿y_size
;

295 
size_t
 
row_size
;

296 
´ebšd_·¿ms
;

297 *
u£r_d©a
;

298 
ps_»suÉ_ÿÎback
 
»suÉ_ÿÎback
;

299 
ps_·¿m_ÿÎback
 
·¿m_ÿÎback
;

302 (*
	tps_f›ld_ãtch_func
)(
	tMYSQL_BIND
 *
	tr_·¿m
, cÚ¡ 
	tMYSQL_FIELD
 * 
	tf›ld
, **
	trow
);

303 
	s¡_mysql_³rm_bšd
 {

304 
ps_f›ld_ãtch_func
 
func
;

306 
·ck_Ën
;

307 
max_Ën
;

308 } 
	tMYSQL_PS_CONVERSION
;

310 
MYSQL_PS_CONVERSION
 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_GEOMETRY
 + 1];

311 
	`ma_Ãt_§ã_»ad
(
MYSQL
 *
mysql
);

312 
	`mysql_š™_ps_subsy¡em
();

313 
	`Ãt_f›ld_Ëngth
(**
·ck‘
);

314 
	`ma_sim¶e_commªd
(
MYSQL
 *
mysql
,
’um_£rv”_commªd
 
commªd
, cÚ¡ *
¬g
,

315 
size_t
 
Ëngth
, 
my_boÞ
 
skp_check
, *
Ýt_¬g
);

319 
MYSQL_STMT
 * 
STDCALL
 
	`mysql_¡mt_š™
(
MYSQL
 *
mysql
);

320 
STDCALL
 
	`mysql_¡mt_´•¬e
(
MYSQL_STMT
 *
¡mt
, cÚ¡ *
qu”y
, 
Ëngth
);

321 
STDCALL
 
	`mysql_¡mt_execu‹
(
MYSQL_STMT
 *
¡mt
);

322 
STDCALL
 
	`mysql_¡mt_ãtch
(
MYSQL_STMT
 *
¡mt
);

323 
STDCALL
 
	`mysql_¡mt_ãtch_cÞumn
(
MYSQL_STMT
 *
¡mt
, 
MYSQL_BIND
 *
bšd_¬g
, 
cÞumn
, 
off£t
);

324 
STDCALL
 
	`mysql_¡mt_¡Üe_»suÉ
(
MYSQL_STMT
 *
¡mt
);

325 
STDCALL
 
	`mysql_¡mt_·¿m_couÁ
(
MYSQL_STMT
 * 
¡mt
);

326 
my_boÞ
 
STDCALL
 
	`mysql_¡mt_©Œ_£t
(
MYSQL_STMT
 *
¡mt
, 
’um_¡mt_©Œ_ty³
 
©Œ_ty³
, cÚ¡ *
©Œ
);

327 
my_boÞ
 
STDCALL
 
	`mysql_¡mt_©Œ_g‘
(
MYSQL_STMT
 *
¡mt
, 
’um_¡mt_©Œ_ty³
 
©Œ_ty³
, *
©Œ
);

328 
my_boÞ
 
STDCALL
 
	`mysql_¡mt_bšd_·¿m
(
MYSQL_STMT
 * 
¡mt
, 
MYSQL_BIND
 * 
bnd
);

329 
my_boÞ
 
STDCALL
 
	`mysql_¡mt_bšd_»suÉ
(
MYSQL_STMT
 * 
¡mt
, 
MYSQL_BIND
 * 
bnd
);

330 
my_boÞ
 
STDCALL
 
	`mysql_¡mt_þo£
(
MYSQL_STMT
 * 
¡mt
);

331 
my_boÞ
 
STDCALL
 
	`mysql_¡mt_»£t
(
MYSQL_STMT
 * 
¡mt
);

332 
my_boÞ
 
STDCALL
 
	`mysql_¡mt_ä“_»suÉ
(
MYSQL_STMT
 *
¡mt
);

333 
my_boÞ
 
STDCALL
 
	`mysql_¡mt_£nd_lÚg_d©a
(
MYSQL_STMT
 *
¡mt
, 
·¿m_numb”
, cÚ¡ *
d©a
, 
Ëngth
);

334 
MYSQL_RES
 *
STDCALL
 
	`mysql_¡mt_»suÉ_m‘ad©a
(
MYSQL_STMT
 *
¡mt
);

335 
MYSQL_RES
 *
STDCALL
 
	`mysql_¡mt_·¿m_m‘ad©a
(
MYSQL_STMT
 *
¡mt
);

336 
STDCALL
 
	`mysql_¡mt_”ºo
(
MYSQL_STMT
 * 
¡mt
);

337 cÚ¡ *
STDCALL
 
	`mysql_¡mt_”rÜ
(
MYSQL_STMT
 * 
¡mt
);

338 cÚ¡ *
STDCALL
 
	`mysql_¡mt_sql¡©e
(
MYSQL_STMT
 * 
¡mt
);

339 
MYSQL_ROW_OFFSET
 
STDCALL
 
	`mysql_¡mt_row_£ek
(
MYSQL_STMT
 *
¡mt
, MYSQL_ROW_OFFSET 
off£t
);

340 
MYSQL_ROW_OFFSET
 
STDCALL
 
	`mysql_¡mt_row_‹Î
(
MYSQL_STMT
 *
¡mt
);

341 
STDCALL
 
	`mysql_¡mt_d©a_£ek
(
MYSQL_STMT
 *
¡mt
, 
off£t
);

342 
STDCALL
 
	`mysql_¡mt_num_rows
(
MYSQL_STMT
 *
¡mt
);

343 
STDCALL
 
	`mysql_¡mt_afãùed_rows
(
MYSQL_STMT
 *
¡mt
);

344 
STDCALL
 
	`mysql_¡mt_š£¹_id
(
MYSQL_STMT
 *
¡mt
);

345 
STDCALL
 
	`mysql_¡mt_f›ld_couÁ
(
MYSQL_STMT
 *
¡mt
);

346 
STDCALL
 
	`mysql_¡mt_Ãxt_»suÉ
(
MYSQL_STMT
 *
¡mt
);

347 
my_boÞ
 
STDCALL
 
	`mysql_¡mt_mÜe_»suÉs
(
MYSQL_STMT
 *
¡mt
);

348 
STDCALL
 
	`m¬Ÿdb_¡mt_execu‹_dœeù
(
MYSQL_STMT
 *
¡mt
, cÚ¡ *
¡mt_¡r
, 
size_t
 
Ëngth
);

349 
MYSQL_FIELD
 * 
STDCALL
 
	`m¬Ÿdb_¡mt_ãtch_f›lds
(
MYSQL_STMT
 *
¡mt
);

	@include/mysql.h

21 #iâdeà
_mysql_h


22 
	#_mysql_h


	)

24 #ifdef 
__ýlu¥lus


28 #iâdeà
LIBMARIADB


29 
	#LIBMARIADB


	)

31 #iâdeà
MYSQL_CLIENT


32 
	#MYSQL_CLIENT


	)

35 
	~<¡d¬g.h
>

37 #ià!
defšed
 (
_glob®_h
è&& !defšed (
MY_GLOBAL_INCLUDED
)

38 
	~<sys/ty³s.h
>

39 
	tmy_boÞ
;

40 
	tmy_ulÚglÚg
;

42 #ià!
defšed
(
_WIN32
)

43 
	#STDCALL


	)

45 
	#STDCALL
 
__¡dÿÎ


	)

48 #iâdeà
my_sock‘_defšed


49 
	#my_sock‘_defšed


	)

50 #ià
defšed
(
_WIN64
)

51 
	#my_sock‘
 

	)

52 #–ià
defšed
(
_WIN32
)

53 
	#my_sock‘
 

	)

55 
	tmy_sock‘
;

59 
	~"m¬Ÿdb_com.h
"

60 
	~"m¬Ÿdb_v”siÚ.h
"

61 
	~"ma_li¡.h
"

62 
	~"m¬Ÿdb_ùy³.h
"

65 
	s¡_ma_cÚ¡_¡ršg


67 cÚ¡ *
¡r
;

68 
size_t
 
Ëngth
;

69 } 
	tMARIADB_CONST_STRING
;

72 #iâdeà
ST_MA_USED_MEM_DEFINED


73 
	#ST_MA_USED_MEM_DEFINED


	)

74 
	s¡_ma_u£d_mem
 {

75 
¡_ma_u£d_mem
 *
Ãxt
;

76 
size_t
 
Ëá
;

77 
size_t
 
size
;

78 } 
	tMA_USED_MEM
;

80 
	s¡_ma_mem_roÙ
 {

81 
MA_USED_MEM
 *
ä“
;

82 
MA_USED_MEM
 *
u£d
;

83 
MA_USED_MEM
 *
´e_®loc
;

84 
size_t
 
mš_m®loc
;

85 
size_t
 
block_size
;

86 
block_num
;

87 
fœ¡_block_u§ge
;

88 (*
”rÜ_hªdËr
)();

89 } 
	tMA_MEM_ROOT
;

92 
mysql_pÜt
;

93 *
mysql_unix_pÜt
;

94 
m¬Ÿdb_deš™Ÿlize_s¦
;

96 
	#IS_PRI_KEY
(
n
è(Òè& 
PRI_KEY_FLAG
)

	)

97 
	#IS_NOT_NULL
(
n
è(Òè& 
NOT_NULL_FLAG
)

	)

98 
	#IS_BLOB
(
n
è(Òè& 
BLOB_FLAG
)

	)

99 
	#IS_NUM
(
t
è((Ñè<ð
MYSQL_TYPE_INT24
 && (tè!ð
MYSQL_TYPE_TIMESTAMP
è|| (tè=ð
MYSQL_TYPE_YEAR
 || (tè=ð
MYSQL_TYPE_NEWDECIMAL
)

	)

100 
	#IS_NUM_FIELD
(
f
è((f)->
æags
 & 
NUM_FLAG
)

	)

101 
	#INTERNAL_NUM_FIELD
(
f
è(((f)->
ty³
 <ð
MYSQL_TYPE_INT24
 && ((f)->ty³ !ð
MYSQL_TYPE_TIMESTAMP
 || (f)->
Ëngth
 =ð14 || (f)->Ëngth =ð8)è|| (f)->ty³ =ð
MYSQL_TYPE_YEAR
 || (f)->ty³ =ð
MYSQL_TYPE_NEWDECIMAL
 || (f)->ty³ =ð
MYSQL_TYPE_DECIMAL
)

	)

103 
	s¡_mysql_f›ld
 {

104 *
	gÇme
;

105 *
	gÜg_Çme
;

106 *
	gbË
;

107 *
	gÜg_bË
;

108 *
	gdb
;

109 *
	gÿlog
;

110 *
	gdef
;

111 
	gËngth
;

112 
	gmax_Ëngth
;

114 
	gÇme_Ëngth
;

115 
	gÜg_Çme_Ëngth
;

116 
	gbË_Ëngth
;

117 
	gÜg_bË_Ëngth
;

118 
	gdb_Ëngth
;

119 
	gÿlog_Ëngth
;

120 
	gdef_Ëngth
;

122 
	gæags
;

123 
	gdecim®s
;

124 
	gch¬£Šr
;

125 
’um_f›ld_ty³s
 
	gty³
;

126 *
	gex‹nsiÚ
;

127 } 
	tMYSQL_FIELD
;

129 **
	tMYSQL_ROW
;

130 
	tMYSQL_FIELD_OFFSET
;

132 
	#SET_CLIENT_ERROR
(
a
, 
b
, 
c
, 
d
) \

134 (
a
)->
Ãt
.
Ï¡_”ºo
ð(
b
);\

135 
	`¡ºýy
((
a
)->
Ãt
.
sql¡©e
, (
c
), 
SQLSTATE_LENGTH
);\

136 (
a
)->
Ãt
.
sql¡©e
[
SQLSTATE_LENGTH
]= 0;\

137 
	`¡ºýy
((
a
)->
Ãt
.
Ï¡_”rÜ
, (
d
è? (dè: 
	`ER
((
b
)), 
MYSQL_ERRMSG_SIZE
 - 1);\

138 (
a
)->
Ãt
.
Ï¡_”rÜ
[
MYSQL_ERRMSG_SIZE
 - 1]= 0;\

139 } 0)

	)

142 
	#£t_m¬Ÿdb_”rÜ
(
A
,
B
,
C
è
	`SET_CLIENT_ERROR
((A),(B),(C),0)

	)

143 cÚ¡ *
SQLSTATE_UNKNOWN
;

144 
	#unknown_sql¡©e
 
SQLSTATE_UNKNOWN


	)

146 
	#CLEAR_CLIENT_ERROR
(
a
) \

148 (
a
)->
Ãt
.
Ï¡_”ºo
= 0;\

149 
	`¡rýy
((
a
)->
Ãt
.
sql¡©e
, "00000");\

150 (
a
)->
Ãt
.
Ï¡_”rÜ
[0]= '\0';\

151 ià((
a
)->
Ãt
.
ex‹nsiÚ
)\

152 (
a
)->
Ãt
.
ex‹nsiÚ
->
ex‹nded_”ºo
= 0;\

153 } 0)

	)

155 
	#MYSQL_COUNT_ERROR
 (~(è0)

	)

158 
	s¡_mysql_rows
 {

159 
¡_mysql_rows
 *
	gÃxt
;

160 
MYSQL_ROW
 
	gd©a
;

161 
	gËngth
;

162 } 
	tMYSQL_ROWS
;

164 
MYSQL_ROWS
 *
	tMYSQL_ROW_OFFSET
;

166 
	s¡_mysql_d©a
 {

167 
MYSQL_ROWS
 *
	gd©a
;

168 *
	gembedded_šfo
;

169 
MA_MEM_ROOT
 
	g®loc
;

170 
	grows
;

171 
	gf›lds
;

172 *
	gex‹nsiÚ
;

173 } 
	tMYSQL_DATA
;

175 
	emysql_ÝtiÚ


177 
	gMYSQL_OPT_CONNECT_TIMEOUT
,

178 
	gMYSQL_OPT_COMPRESS
,

179 
	gMYSQL_OPT_NAMED_PIPE
,

180 
	gMYSQL_INIT_COMMAND
,

181 
	gMYSQL_READ_DEFAULT_FILE
,

182 
	gMYSQL_READ_DEFAULT_GROUP
,

183 
	gMYSQL_SET_CHARSET_DIR
,

184 
	gMYSQL_SET_CHARSET_NAME
,

185 
	gMYSQL_OPT_LOCAL_INFILE
,

186 
	gMYSQL_OPT_PROTOCOL
,

187 
	gMYSQL_SHARED_MEMORY_BASE_NAME
,

188 
	gMYSQL_OPT_READ_TIMEOUT
,

189 
	gMYSQL_OPT_WRITE_TIMEOUT
,

190 
	gMYSQL_OPT_USE_RESULT
,

191 
	gMYSQL_OPT_USE_REMOTE_CONNECTION
,

192 
	gMYSQL_OPT_USE_EMBEDDED_CONNECTION
,

193 
	gMYSQL_OPT_GUESS_CONNECTION
,

194 
	gMYSQL_SET_CLIENT_IP
,

195 
	gMYSQL_SECURE_AUTH
,

196 
	gMYSQL_REPORT_DATA_TRUNCATION
,

197 
	gMYSQL_OPT_RECONNECT
,

198 
	gMYSQL_OPT_SSL_VERIFY_SERVER_CERT
,

199 
	gMYSQL_PLUGIN_DIR
,

200 
	gMYSQL_DEFAULT_AUTH
,

201 
	gMYSQL_OPT_BIND
,

202 
	gMYSQL_OPT_SSL_KEY
,

203 
	gMYSQL_OPT_SSL_CERT
,

204 
	gMYSQL_OPT_SSL_CA
,

205 
	gMYSQL_OPT_SSL_CAPATH
,

206 
	gMYSQL_OPT_SSL_CIPHER
,

207 
	gMYSQL_OPT_SSL_CRL
,

208 
	gMYSQL_OPT_SSL_CRLPATH
,

210 
	gMYSQL_OPT_CONNECT_ATTR_RESET
,

211 
	gMYSQL_OPT_CONNECT_ATTR_ADD
,

212 
	gMYSQL_OPT_CONNECT_ATTR_DELETE
,

213 
	gMYSQL_SERVER_PUBLIC_KEY
,

214 
	gMYSQL_ENABLE_CLEARTEXT_PLUGIN
,

215 
	gMYSQL_OPT_CAN_HANDLE_EXPIRED_PASSWORDS
,

216 
	gMYSQL_OPT_SSL_ENFORCE
,

217 
	gMYSQL_OPT_MAX_ALLOWED_PACKET
,

218 
	gMYSQL_OPT_NET_BUFFER_LENGTH
,

219 
	gMYSQL_OPT_TLS_VERSION
,

222 
	gMYSQL_PROGRESS_CALLBACK
=5999,

223 
	gMYSQL_OPT_NONBLOCK
,

225 
	gMYSQL_DATABASE_DRIVER
=7000,

226 
	gMARIADB_OPT_SSL_FP
,

227 
	gMARIADB_OPT_SSL_FP_LIST
,

228 
	gMARIADB_OPT_TLS_PASSPHRASE
,

229 
	gMARIADB_OPT_TLS_CIPHER_STRENGTH
,

230 
	gMARIADB_OPT_TLS_VERSION
,

231 
	gMARIADB_OPT_TLS_PEER_FP
,

232 
	gMARIADB_OPT_TLS_PEER_FP_LIST
,

233 
	gMARIADB_OPT_CONNECTION_READ_ONLY
,

234 
	gMYSQL_OPT_CONNECT_ATTRS
,

235 
	gMARIADB_OPT_USERDATA
,

236 
	gMARIADB_OPT_CONNECTION_HANDLER
,

237 
	gMARIADB_OPT_PORT
,

238 
	gMARIADB_OPT_UNIXSOCKET
,

239 
	gMARIADB_OPT_PASSWORD
,

240 
	gMARIADB_OPT_HOST
,

241 
	gMARIADB_OPT_USER
,

242 
	gMARIADB_OPT_SCHEMA
,

243 
	gMARIADB_OPT_DEBUG
,

244 
	gMARIADB_OPT_FOUND_ROWS
,

245 
	gMARIADB_OPT_MULTI_RESULTS
,

246 
	gMARIADB_OPT_MULTI_STATEMENTS
,

247 
	gMARIADB_OPT_INTERACTIVE
,

248 
	gMARIADB_OPT_PROXY_HEADER
,

249 
	gMARIADB_OPT_IO_WAIT


252 
	em¬Ÿdb_v®ue
 {

253 
	gMARIADB_CHARSET_ID
,

254 
	gMARIADB_CHARSET_NAME
,

255 
	gMARIADB_CLIENT_ERRORS
,

256 
	gMARIADB_CLIENT_VERSION
,

257 
	gMARIADB_CLIENT_VERSION_ID
,

258 
	gMARIADB_CONNECTION_ASYNC_TIMEOUT
,

259 
	gMARIADB_CONNECTION_ASYNC_TIMEOUT_MS
,

260 
	gMARIADB_CONNECTION_MARIADB_CHARSET_INFO
,

261 
	gMARIADB_CONNECTION_ERROR
,

262 
	gMARIADB_CONNECTION_ERROR_ID
,

263 
	gMARIADB_CONNECTION_HOST
,

264 
	gMARIADB_CONNECTION_INFO
,

265 
	gMARIADB_CONNECTION_PORT
,

266 
	gMARIADB_CONNECTION_PROTOCOL_VERSION_ID
,

267 
	gMARIADB_CONNECTION_PVIO_TYPE
,

268 
	gMARIADB_CONNECTION_SCHEMA
,

269 
	gMARIADB_CONNECTION_SERVER_TYPE
,

270 
	gMARIADB_CONNECTION_SERVER_VERSION
,

271 
	gMARIADB_CONNECTION_SERVER_VERSION_ID
,

272 
	gMARIADB_CONNECTION_SOCKET
,

273 
	gMARIADB_CONNECTION_SQLSTATE
,

274 
	gMARIADB_CONNECTION_SSL_CIPHER
,

275 
	gMARIADB_TLS_LIBRARY
,

276 
	gMARIADB_CONNECTION_TLS_VERSION
,

277 
	gMARIADB_CONNECTION_TLS_VERSION_ID
,

278 
	gMARIADB_CONNECTION_TYPE
,

279 
	gMARIADB_CONNECTION_UNIX_SOCKET
,

280 
	gMARIADB_CONNECTION_USER
,

281 
	gMARIADB_MAX_ALLOWED_PACKET
,

282 
	gMARIADB_NET_BUFFER_LENGTH
,

283 
	gMARIADB_CONNECTION_SERVER_STATUS
,

284 
	gMARIADB_CONNECTION_SERVER_CAPABILITIES
,

285 
	gMARIADB_CONNECTION_EXTENDED_SERVER_CAPABILITIES
,

286 
	gMARIADB_CONNECTION_CLIENT_CAPABILITIES


289 
	emysql_¡©us
 { 
	gMYSQL_STATUS_READY
,

290 
	gMYSQL_STATUS_GET_RESULT
,

291 
	gMYSQL_STATUS_USE_RESULT
,

292 
	gMYSQL_STATUS_QUERY_SENT
,

293 
	gMYSQL_STATUS_SENDING_LOAD_DATA
,

294 
	gMYSQL_STATUS_FETCHING_DATA
,

295 
	gMYSQL_STATUS_NEXT_RESULT_PENDING
,

296 
	gMYSQL_STATUS_QUIT_SENT
,

297 
	gMYSQL_STATUS_STMT_RESULT


300 
	emysql_´ÙocÞ_ty³


302 
	gMYSQL_PROTOCOL_DEFAULT
, 
	gMYSQL_PROTOCOL_TCP
, 
	gMYSQL_PROTOCOL_SOCKET
,

303 
	gMYSQL_PROTOCOL_PIPE
, 
	gMYSQL_PROTOCOL_MEMORY


306 
	s¡_mysql_ÝtiÚs
 {

307 
	gcÚÃù_timeout
, 
	g»ad_timeout
, 
	gwr™e_timeout
;

308 
	gpÜt
, 
	g´ÙocÞ
;

309 
	gþ›Á_æag
;

310 *
	gho¡
,*
	gu£r
,*
	g·sswÜd
,*
	gunix_sock‘
,*
	gdb
;

311 
¡_dyÇmic_¬¿y
 *
	gš™_commªd
;

312 *
	gmy_úf_fže
,*
	gmy_úf_group
, *
	gch¬£t_dœ
, *
	gch¬£t_Çme
;

313 *
	gs¦_key
;

314 *
	gs¦_û¹
;

315 *
	gs¦_ÿ
;

316 *
	gs¦_ÿ·th
;

317 *
	gs¦_ch”
;

318 *
	gsh¬ed_memÜy_ba£_Çme
;

319 
	gmax_®lowed_·ck‘
;

320 
my_boÞ
 
	gu£_s¦
;

321 
my_boÞ
 
	gcom´ess
,
	gÇmed_pe
;

322 
my_boÞ
 
	g»cÚÃù
, 
	gunu£d_1
, 
	gunu£d_2
, 
	gunu£d_3
;

323 
mysql_ÝtiÚ
 
	gm‘hods_to_u£
;

324 *
	gbšd_add»ss
;

325 
my_boÞ
 
	g£cu»_auth
;

326 
my_boÞ
 
	g»pÜt_d©a_ŒunÿtiÚ
;

328 (*
	gloÿl_šfže_š™
)(**, const *, *);

329 (*
	gloÿl_šfže_»ad
)(*, *, );

330 (*
	gloÿl_šfže_’d
)(*);

331 (*
	gloÿl_šfže_”rÜ
)(*, *, );

332 *
	gloÿl_šfže_u£rd©a
;

333 
¡_mysql_ÝtiÚs_ex‹nsiÚ
 *
	gex‹nsiÚ
;

336 
	s¡_mysql
 {

337 
NET
 
	gÃt
;

338 *
	gunu£d_0
;

339 *
	gho¡
,*
	gu£r
,*
	g·sswd
,*
	gunix_sock‘
,*
	g£rv”_v”siÚ
,*
	gho¡_šfo
;

340 *
	gšfo
,*
	gdb
;

341 cÚ¡ 
ma_ch¬£t_šfo_¡
 *
	gch¬£t
;

342 
MYSQL_FIELD
 *
	gf›lds
;

343 
MA_MEM_ROOT
 
	gf›ld_®loc
;

344 
	gafãùed_rows
;

345 
	gš£¹_id
;

346 
	gexŒa_šfo
;

347 
	gth»ad_id
;

348 
my_boÞ
 
	gÜaþe_mode
;

349 
	g·ck‘_Ëngth
;

350 
	gpÜt
;

351 
	gþ›Á_æag
;

352 
	g£rv”_ÿ·bž™›s
;

353 
	g´ÙocÞ_v”siÚ
;

354 
	gf›ld_couÁ
;

355 
	g£rv”_¡©us
;

356 
	g£rv”_Ïnguage
;

357 
	gw¬nšg_couÁ
;

358 
¡_mysql_ÝtiÚs
 
	gÝtiÚs
;

359 
mysql_¡©us
 
	g¡©us
;

360 
my_boÞ
 
	gä“_me
;

361 
my_boÞ
 
	gunu£d_1
;

362 
	gsüambË_buff
[20+ 1];

364 
my_boÞ
 
	gunu£d_2
;

365 *
	gunu£d_3
, *
	gunu£d_4
, *
	gunu£d_5
, *
	gunu£d_6
;

366 
LIST
 *
	g¡mts
;

367 cÚ¡ 
¡_m¬Ÿdb_m‘hods
 *
	gm‘hods
;

368 *
	gthd
;

369 
my_boÞ
 *
	gunbufã»d_ãtch_owÃr
;

370 *
	gšfo_bufãr
;

371 
¡_m¬Ÿdb_ex‹nsiÚ
 *
	gex‹nsiÚ
;

372 } 
	tMYSQL
;

374 
	s¡_mysql_»s
 {

375 
	grow_couÁ
;

376 
	gf›ld_couÁ
, 
	gcu¼’t_f›ld
;

377 
MYSQL_FIELD
 *
	gf›lds
;

378 
MYSQL_DATA
 *
	gd©a
;

379 
MYSQL_ROWS
 *
	gd©a_cursÜ
;

380 
MA_MEM_ROOT
 
	gf›ld_®loc
;

381 
MYSQL_ROW
 
	grow
;

382 
MYSQL_ROW
 
	gcu¼’t_row
;

383 *
	gËngths
;

384 
MYSQL
 *
	ghªdË
;

385 
my_boÞ
 
	geof
;

386 
my_boÞ
 
	gis_ps
;

387 } 
	tMYSQL_RES
;

391 *
	gp_max_®lowed_·ck‘
;

392 *
	gp_Ãt_bufãr_Ëngth
;

393 *
	gex‹nsiÚ
;

394 } 
	tMYSQL_PARAMETERS
;

397 
	em¬Ÿdb_f›ld_©Œ_t


399 
	gMARIADB_FIELD_ATTR_DATA_TYPE_NAME
= 0,

400 
	gMARIADB_FIELD_ATTR_FORMAT_NAME
= 1

403 
	#MARIADB_FIELD_ATTR_LAST
 
MARIADB_FIELD_ATTR_FORMAT_NAME


	)

406 
STDCALL
 
m¬Ÿdb_f›ld_©Œ
(
MARIADB_CONST_STRING
 *
©Œ
,

407 cÚ¡ 
MYSQL_FIELD
 *
f›ld
,

408 
m¬Ÿdb_f›ld_©Œ_t
 
ty³
);

410 #iâdeà
_mysql_time_h_


411 
	e’um_mysql_time¡amp_ty³


413 
	gMYSQL_TIMESTAMP_NONE
ð-2, 
	gMYSQL_TIMESTAMP_ERROR
= -1,

414 
	gMYSQL_TIMESTAMP_DATE
ð0, 
	gMYSQL_TIMESTAMP_DATETIME
ð1, 
	gMYSQL_TIMESTAMP_TIME
= 2

417 
	s¡_mysql_time


419 
	gy—r
, 
	gmÚth
, 
	gday
, 
	ghour
, 
	gmšu‹
, 
	g£cÚd
;

420 
	g£cÚd_·¹
;

421 
my_boÞ
 
	gÃg
;

422 
’um_mysql_time¡amp_ty³
 
	gtime_ty³
;

423 } 
	tMYSQL_TIME
;

425 
	s¡_Üaþe_time


427 
	gûÁury
, 
	gy—r
;

428 
	gmÚth
, 
	gday
, 
	ghour
, 
	gmšu‹
, 
	g£cÚd
;

429 
	g£cÚd_·¹
;

430 
	gsÿË
;

431 
	goff£t_hour
, 
	goff£t_mšu‹
;

432 *
	gtz_Çme
, *
	gtz_abbr
;

433 } 
	tORACLE_TIME
;

434 
	#AUTO_SEC_PART_DIGITS
 39

	)

437 
	#SEC_PART_DIGITS
 6

	)

438 
	#MARIADB_INVALID_SOCKET
 -1

	)

441 
	#MYSQL_WAIT_READ
 1

	)

442 
	#MYSQL_WAIT_WRITE
 2

	)

443 
	#MYSQL_WAIT_EXCEPT
 4

	)

444 
	#MYSQL_WAIT_TIMEOUT
 8

	)

446 
	sch¬aù”_£t


448 
	gnumb”
;

449 
	g¡©e
;

450 cÚ¡ *
	gc¢ame
;

451 cÚ¡ *
	gÇme
;

452 cÚ¡ *
	gcomm’t
;

453 cÚ¡ *
	gdœ
;

454 
	gmbmšËn
;

455 
	gmbmaxËn
;

456 } 
	tMY_CHARSET_INFO
;

459 
	#LOCAL_INFILE_ERROR_LEN
 512

	)

461 
	~"m¬Ÿdb_¡mt.h
"

463 #iâdeà
MYSQL_CLIENT_PLUGIN_HEADER


464 
	#MYSQL_CLIENT_PLUGIN_HEADER
 \

465 
ty³
; \

466 
š‹rçû_v”siÚ
; \

467 cÚ¡ *
Çme
; \

468 cÚ¡ *
authÜ
; \

469 cÚ¡ *
desc
; \

470 
v”siÚ
[3]; \

471 cÚ¡ *
liûn£
; \

472 *
mysql_­i
; \

473 (*
š™
)(*, 
size_t
, , 
va_li¡
); \

474 (*
deš™
)(); \

475 (*
ÝtiÚs
)(cÚ¡ *
ÝtiÚ
, cÚ¡ *);

	)

476 
	s¡_mysql_þ›Á_¶ugš


478 
	gMYSQL_CLIENT_PLUGIN_HEADER


481 
¡_mysql_þ›Á_¶ugš
 *

482 
mysql_lßd_¶ugš
(
¡_mysql
 *
mysql
, cÚ¡ *
Çme
, 
ty³
,

483 
¬gc
, ...);

484 
¡_mysql_þ›Á_¶ugš
 * 
STDCALL


485 
mysql_lßd_¶ugš_v
(
¡_mysql
 *
mysql
, cÚ¡ *
Çme
, 
ty³
,

486 
¬gc
, 
va_li¡
 
¬gs
);

487 
¡_mysql_þ›Á_¶ugš
 * 
STDCALL


488 
mysql_þ›Á_fšd_¶ugš
(
¡_mysql
 *
mysql
, cÚ¡ *
Çme
, 
ty³
);

489 
¡_mysql_þ›Á_¶ugš
 * 
STDCALL


490 
mysql_þ›Á_»gi¡”_¶ugš
(
¡_mysql
 *
mysql
,

491 
¡_mysql_þ›Á_¶ugš
 *
¶ugš
);

495 
STDCALL
 
mysql_£t_loÿl_šfže_hªdËr
(
MYSQL
 *
mysql
,

496 (*
loÿl_šfže_š™
)(**, const *, *),

497 (*
loÿl_šfže_»ad
)(*, *, ),

498 (*
loÿl_šfže_’d
)(*),

499 (*
loÿl_šfže_”rÜ
)(*, *, ),

502 
mysql_£t_loÿl_šfže_deçuÉ
(
MYSQL
 *
mysql
);

504 
my_£t_”rÜ
(
MYSQL
 *
mysql
, 
”rÜ_Ä
,

505 cÚ¡ *
sql¡©e
, cÚ¡ *
fÜm©
, ...);

509 
my_ulÚglÚg
 
STDCALL
 
mysql_num_rows
(
MYSQL_RES
 *
»s
);

510 
STDCALL
 
mysql_num_f›lds
(
MYSQL_RES
 *
»s
);

511 
my_boÞ
 
STDCALL
 
mysql_eof
(
MYSQL_RES
 *
»s
);

512 
MYSQL_FIELD
 *
STDCALL
 
mysql_ãtch_f›ld_dœeù
(
MYSQL_RES
 *
»s
,

513 
f›ldÄ
);

514 
MYSQL_FIELD
 * 
STDCALL
 
mysql_ãtch_f›lds
(
MYSQL_RES
 *
»s
);

515 
MYSQL_ROWS
 * 
STDCALL
 
mysql_row_‹Î
(
MYSQL_RES
 *
»s
);

516 
STDCALL
 
mysql_f›ld_‹Î
(
MYSQL_RES
 *
»s
);

518 
STDCALL
 
mysql_f›ld_couÁ
(
MYSQL
 *
mysql
);

519 
my_boÞ
 
STDCALL
 
mysql_mÜe_»suÉs
(
MYSQL
 *
mysql
);

520 
STDCALL
 
mysql_Ãxt_»suÉ
(
MYSQL
 *
mysql
);

521 
my_ulÚglÚg
 
STDCALL
 
mysql_afãùed_rows
(
MYSQL
 *
mysql
);

522 
my_boÞ
 
STDCALL
 
mysql_autocomm™
(
MYSQL
 *
mysql
, my_boÞ 
mode
);

523 
my_boÞ
 
STDCALL
 
mysql_comm™
(
MYSQL
 *
mysql
);

524 
my_boÞ
 
STDCALL
 
mysql_rÞlback
(
MYSQL
 *
mysql
);

525 
my_ulÚglÚg
 
STDCALL
 
mysql_š£¹_id
(
MYSQL
 *
mysql
);

526 
STDCALL
 
mysql_”ºo
(
MYSQL
 *
mysql
);

527 cÚ¡ * 
STDCALL
 
mysql_”rÜ
(
MYSQL
 *
mysql
);

528 cÚ¡ * 
STDCALL
 
mysql_šfo
(
MYSQL
 *
mysql
);

529 
STDCALL
 
mysql_th»ad_id
(
MYSQL
 *
mysql
);

530 cÚ¡ * 
STDCALL
 
mysql_ch¬aù”_£t_Çme
(
MYSQL
 *
mysql
);

531 
STDCALL
 
mysql_g‘_ch¬aù”_£t_šfo
(
MYSQL
 *
mysql
, 
MY_CHARSET_INFO
 *
cs
);

532 
STDCALL
 
mysql_£t_ch¬aù”_£t
(
MYSQL
 *
mysql
, cÚ¡ *
c¢ame
);

534 
sk_·¿m_com¶ex
(
MYSQL_COMPLEX_BIND_HEADER
 **
·¿m
);

535 
cÚv”t_ty³_to_com¶ex
(
’um_f›ld_ty³s
 
ty³
);

537 
my_boÞ
 
m¬Ÿdb_g‘_šfov
(
MYSQL
 *
mysql
, 
m¬Ÿdb_v®ue
 
v®ue
, *
¬g
, ...);

538 
my_boÞ
 
STDCALL
 
m¬Ÿdb_g‘_šfo
(
MYSQL
 *
mysql
, 
m¬Ÿdb_v®ue
 
v®ue
, *
¬g
);

539 
MYSQL
 * 
STDCALL
 
mysql_š™
(MYSQL *
mysql
);

540 
STDCALL
 
mysql_s¦_£t
(
MYSQL
 *
mysql
, cÚ¡ *
key
,

541 cÚ¡ *
û¹
, cÚ¡ *
ÿ
,

542 cÚ¡ *
ÿ·th
, cÚ¡ *
ch”
);

543 cÚ¡ * 
STDCALL
 
mysql_g‘_s¦_ch”
(
MYSQL
 *
mysql
);

544 
my_boÞ
 
STDCALL
 
mysql_chªge_u£r
(
MYSQL
 *
mysql
, cÚ¡ *
u£r
,

545 cÚ¡ *
·sswd
, cÚ¡ *
db
);

546 
MYSQL
 * 
STDCALL
 
mysql_»®_cÚÃù
(MYSQL *
mysql
, cÚ¡ *
ho¡
,

547 cÚ¡ *
u£r
,

548 cÚ¡ *
·sswd
,

549 cÚ¡ *
db
,

550 
pÜt
,

551 cÚ¡ *
unix_sock‘
,

552 
þ›Áæag
);

553 
STDCALL
 
mysql_þo£
(
MYSQL
 *
sock
);

554 
STDCALL
 
mysql_£Ëù_db
(
MYSQL
 *
mysql
, cÚ¡ *
db
);

555 
STDCALL
 
mysql_qu”y
(
MYSQL
 *
mysql
, cÚ¡ *
q
);

556 
STDCALL
 
mysql_£nd_qu”y
(
MYSQL
 *
mysql
, cÚ¡ *
q
,

557 
Ëngth
);

558 
my_boÞ
 
STDCALL
 
mysql_»ad_qu”y_»suÉ
(
MYSQL
 *
mysql
);

559 
STDCALL
 
mysql_»®_qu”y
(
MYSQL
 *
mysql
, cÚ¡ *
q
,

560 
Ëngth
);

561 
STDCALL
 
mysql_shutdown
(
MYSQL
 *
mysql
, 
mysql_’um_shutdown_Ëv–
 
shutdown_Ëv–
);

562 
STDCALL
 
mysql_dump_debug_šfo
(
MYSQL
 *
mysql
);

563 
STDCALL
 
mysql_»äesh
(
MYSQL
 *
mysql
,

564 
»äesh_ÝtiÚs
);

565 
STDCALL
 
mysql_kžl
(
MYSQL
 *
mysql
,
pid
);

566 
STDCALL
 
mysql_pšg
(
MYSQL
 *
mysql
);

567 * 
STDCALL
 
mysql_¡©
(
MYSQL
 *
mysql
);

568 * 
STDCALL
 
mysql_g‘_£rv”_šfo
(
MYSQL
 *
mysql
);

569 
STDCALL
 
mysql_g‘_£rv”_v”siÚ
(
MYSQL
 *
mysql
);

570 * 
STDCALL
 
mysql_g‘_ho¡_šfo
(
MYSQL
 *
mysql
);

571 
STDCALL
 
mysql_g‘_´Ùo_šfo
(
MYSQL
 *
mysql
);

572 
MYSQL_RES
 * 
STDCALL
 
mysql_li¡_dbs
(
MYSQL
 *
mysql
,cÚ¡ *
wžd
);

573 
MYSQL_RES
 * 
STDCALL
 
mysql_li¡_bËs
(
MYSQL
 *
mysql
,cÚ¡ *
wžd
);

574 
MYSQL_RES
 * 
STDCALL
 
mysql_li¡_f›lds
(
MYSQL
 *
mysql
, cÚ¡ *
bË
,

575 cÚ¡ *
wžd
);

576 
MYSQL_RES
 * 
STDCALL
 
mysql_li¡_´oûs£s
(
MYSQL
 *
mysql
);

577 
MYSQL_RES
 * 
STDCALL
 
mysql_¡Üe_»suÉ
(
MYSQL
 *
mysql
);

578 
MYSQL_RES
 * 
STDCALL
 
mysql_u£_»suÉ
(
MYSQL
 *
mysql
);

579 
STDCALL
 
mysql_ÝtiÚs
(
MYSQL
 *
mysql
,
mysql_ÝtiÚ
 
ÝtiÚ
,

580 cÚ¡ *
¬g
);

581 
STDCALL
 
mysql_ÝtiÚs4
(
MYSQL
 *
mysql
,
mysql_ÝtiÚ
 
ÝtiÚ
,

582 cÚ¡ *
¬g1
, cÚ¡ *
¬g2
);

583 
STDCALL
 
mysql_ä“_»suÉ
(
MYSQL_RES
 *
»suÉ
);

584 
STDCALL
 
mysql_d©a_£ek
(
MYSQL_RES
 *
»suÉ
,

585 
off£t
);

586 
MYSQL_ROW_OFFSET
 
STDCALL
 
mysql_row_£ek
(
MYSQL_RES
 *
»suÉ
, MYSQL_ROW_OFFSET);

587 
MYSQL_FIELD_OFFSET
 
STDCALL
 
mysql_f›ld_£ek
(
MYSQL_RES
 *
»suÉ
,

588 
MYSQL_FIELD_OFFSET
 
off£t
);

589 
MYSQL_ROW
 
STDCALL
 
mysql_ãtch_row
(
MYSQL_RES
 *
»suÉ
);

590 * 
STDCALL
 
mysql_ãtch_Ëngths
(
MYSQL_RES
 *
»suÉ
);

591 
MYSQL_FIELD
 * 
STDCALL
 
mysql_ãtch_f›ld
(
MYSQL_RES
 *
»suÉ
);

592 
STDCALL
 
mysql_esÿ³_¡ršg
(*
to
,cÚ¡ *
äom
,

593 
äom_Ëngth
);

594 
STDCALL
 
mysql_»®_esÿ³_¡ršg
(
MYSQL
 *
mysql
,

595 *
to
,cÚ¡ *
äom
,

596 
Ëngth
);

597 
STDCALL
 
mysql_th»ad_§ã
();

598 
STDCALL
 
mysql_w¬nšg_couÁ
(
MYSQL
 *
mysql
);

599 cÚ¡ * 
STDCALL
 
mysql_sql¡©e
(
MYSQL
 *
mysql
);

600 
STDCALL
 
mysql_£rv”_š™
(
¬gc
, **
¬gv
, **
groups
);

601 
STDCALL
 
mysql_£rv”_’d
();

602 
STDCALL
 
mysql_th»ad_’d
();

603 
my_boÞ
 
STDCALL
 
mysql_th»ad_š™
();

604 
STDCALL
 
mysql_£t_£rv”_ÝtiÚ
(
MYSQL
 *
mysql
,

605 
’um_mysql_£t_ÝtiÚ
 
ÝtiÚ
);

606 cÚ¡ * 
STDCALL
 
mysql_g‘_þ›Á_šfo
();

607 
STDCALL
 
mysql_g‘_þ›Á_v”siÚ
();

608 
my_boÞ
 
STDCALL
 
m¬Ÿdb_cÚÃùiÚ
(
MYSQL
 *
mysql
);

609 cÚ¡ * 
STDCALL
 
mysql_g‘_£rv”_Çme
(
MYSQL
 *
mysql
);

610 
MARIADB_CHARSET_INFO
 * 
STDCALL
 
m¬Ÿdb_g‘_ch¬£t_by_Çme
(cÚ¡ *
c¢ame
);

611 
MARIADB_CHARSET_INFO
 * 
STDCALL
 
m¬Ÿdb_g‘_ch¬£t_by_Ä
(
c¢r
);

612 
size_t
 
STDCALL
 
m¬Ÿdb_cÚv”t_¡ršg
(cÚ¡ *
äom
, size_ˆ*
äom_Ën
, 
MARIADB_CHARSET_INFO
 *
äom_cs
,

613 *
to
, 
size_t
 *
to_Ën
, 
MARIADB_CHARSET_INFO
 *
to_cs
, *
”rÜcode
);

614 
mysql_ÝtiÚsv
(
MYSQL
 *
mysql
,
mysql_ÝtiÚ
 
ÝtiÚ
, ...);

615 
mysql_g‘_ÝtiÚv
(
MYSQL
 *
mysql
, 
mysql_ÝtiÚ
 
ÝtiÚ
, *
¬g
, ...);

616 
STDCALL
 
mysql_g‘_ÝtiÚ
(
MYSQL
 *
mysql
, 
mysql_ÝtiÚ
 
ÝtiÚ
, *
¬g
);

617 
STDCALL
 
mysql_hex_¡ršg
(*
to
, cÚ¡ *
äom
, 
Ën
);

618 
my_sock‘
 
STDCALL
 
mysql_g‘_sock‘
(
MYSQL
 *
mysql
);

619 
STDCALL
 
mysql_g‘_timeout_v®ue
(cÚ¡ 
MYSQL
 *
mysql
);

620 
STDCALL
 
mysql_g‘_timeout_v®ue_ms
(cÚ¡ 
MYSQL
 *
mysql
);

621 
my_boÞ
 
STDCALL
 
m¬Ÿdb_»cÚÃù
(
MYSQL
 *
mysql
);

622 
STDCALL
 
m¬Ÿdb_ÿnûl
(
MYSQL
 *
mysql
);

623 
STDCALL
 
mysql_debug
(cÚ¡ *
debug
);

624 
STDCALL
 
mysql_Ãt_»ad_·ck‘
(
MYSQL
 *
mysql
);

625 
STDCALL
 
mysql_Ãt_f›ld_Ëngth
(**
·ck‘
);

626 
my_boÞ
 
STDCALL
 
mysql_embedded
();

627 
MYSQL_PARAMETERS
 *
STDCALL
 
mysql_g‘_·¿m‘”s
();

630 
STDCALL
 
mysql_þo£_¡¬t
(
MYSQL
 *
sock
);

631 
STDCALL
 
mysql_þo£_cÚt
(
MYSQL
 *
sock
, 
¡©us
);

632 
STDCALL
 
mysql_comm™_¡¬t
(
my_boÞ
 *
»t
, 
MYSQL
 * 
mysql
);

633 
STDCALL
 
mysql_comm™_cÚt
(
my_boÞ
 *
»t
, 
MYSQL
 * 
mysql
, 
¡©us
);

634 
STDCALL
 
mysql_dump_debug_šfo_cÚt
(*
»t
, 
MYSQL
 *
mysql
, 
»ady_¡©us
);

635 
STDCALL
 
mysql_dump_debug_šfo_¡¬t
(*
»t
, 
MYSQL
 *
mysql
);

636 
STDCALL
 
mysql_rÞlback_¡¬t
(
my_boÞ
 *
»t
, 
MYSQL
 * 
mysql
);

637 
STDCALL
 
mysql_rÞlback_cÚt
(
my_boÞ
 *
»t
, 
MYSQL
 * 
mysql
, 
¡©us
);

638 
STDCALL
 
mysql_autocomm™_¡¬t
(
my_boÞ
 *
»t
, 
MYSQL
 * 
mysql
,

639 
my_boÞ
 
auto_mode
);

640 
STDCALL
 
mysql_li¡_f›lds_cÚt
(
MYSQL_RES
 **
»t
, 
MYSQL
 *
mysql
, 
»ady_¡©us
);

641 
STDCALL
 
mysql_li¡_f›lds_¡¬t
(
MYSQL_RES
 **
»t
, 
MYSQL
 *
mysql
, cÚ¡ *
bË
,

642 cÚ¡ *
wžd
);

643 
STDCALL
 
mysql_autocomm™_cÚt
(
my_boÞ
 *
»t
, 
MYSQL
 * 
mysql
, 
¡©us
);

644 
STDCALL
 
mysql_Ãxt_»suÉ_¡¬t
(*
»t
, 
MYSQL
 *
mysql
);

645 
STDCALL
 
mysql_Ãxt_»suÉ_cÚt
(*
»t
, 
MYSQL
 *
mysql
, 
¡©us
);

646 
STDCALL
 
mysql_£Ëù_db_¡¬t
(*
»t
, 
MYSQL
 *
mysql
, cÚ¡ *
db
);

647 
STDCALL
 
mysql_£Ëù_db_cÚt
(*
»t
, 
MYSQL
 *
mysql
, 
»ady_¡©us
);

648 
STDCALL
 
mysql_¡mt_w¬nšg_couÁ
(
MYSQL_STMT
 *
¡mt
);

649 
STDCALL
 
mysql_¡mt_Ãxt_»suÉ_¡¬t
(*
»t
, 
MYSQL_STMT
 *
¡mt
);

650 
STDCALL
 
mysql_¡mt_Ãxt_»suÉ_cÚt
(*
»t
, 
MYSQL_STMT
 *
¡mt
, 
¡©us
);

652 
STDCALL
 
mysql_£t_ch¬aù”_£t_¡¬t
(*
»t
, 
MYSQL
 *
mysql
,

653 cÚ¡ *
c¢ame
);

654 
STDCALL
 
mysql_£t_ch¬aù”_£t_cÚt
(*
»t
, 
MYSQL
 *
mysql
,

655 
¡©us
);

656 
STDCALL
 
mysql_chªge_u£r_¡¬t
(
my_boÞ
 *
»t
, 
MYSQL
 *
mysql
,

657 cÚ¡ *
u£r
,

658 cÚ¡ *
·sswd
,

659 cÚ¡ *
db
);

660 
STDCALL
 
mysql_chªge_u£r_cÚt
(
my_boÞ
 *
»t
, 
MYSQL
 *
mysql
,

661 
¡©us
);

662 
STDCALL
 
mysql_»®_cÚÃù_¡¬t
(
MYSQL
 **
»t
, MYSQL *
mysql
,

663 cÚ¡ *
ho¡
,

664 cÚ¡ *
u£r
,

665 cÚ¡ *
·sswd
,

666 cÚ¡ *
db
,

667 
pÜt
,

668 cÚ¡ *
unix_sock‘
,

669 
þ›Áæag
);

670 
STDCALL
 
mysql_»®_cÚÃù_cÚt
(
MYSQL
 **
»t
, MYSQL *
mysql
,

671 
¡©us
);

672 
STDCALL
 
mysql_qu”y_¡¬t
(*
»t
, 
MYSQL
 *
mysql
,

673 cÚ¡ *
q
);

674 
STDCALL
 
mysql_qu”y_cÚt
(*
»t
, 
MYSQL
 *
mysql
,

675 
¡©us
);

676 
STDCALL
 
mysql_£nd_qu”y_¡¬t
(*
»t
, 
MYSQL
 *
mysql
,

677 cÚ¡ *
q
,

678 
Ëngth
);

679 
STDCALL
 
mysql_£nd_qu”y_cÚt
(*
»t
, 
MYSQL
 *
mysql
, 
¡©us
);

680 
STDCALL
 
mysql_»®_qu”y_¡¬t
(*
»t
, 
MYSQL
 *
mysql
,

681 cÚ¡ *
q
,

682 
Ëngth
);

683 
STDCALL
 
mysql_»®_qu”y_cÚt
(*
»t
, 
MYSQL
 *
mysql
,

684 
¡©us
);

685 
STDCALL
 
mysql_¡Üe_»suÉ_¡¬t
(
MYSQL_RES
 **
»t
, 
MYSQL
 *
mysql
);

686 
STDCALL
 
mysql_¡Üe_»suÉ_cÚt
(
MYSQL_RES
 **
»t
, 
MYSQL
 *
mysql
,

687 
¡©us
);

688 
STDCALL
 
mysql_shutdown_¡¬t
(*
»t
, 
MYSQL
 *
mysql
,

689 
mysql_’um_shutdown_Ëv–


690 
shutdown_Ëv–
);

691 
STDCALL
 
mysql_shutdown_cÚt
(*
»t
, 
MYSQL
 *
mysql
,

692 
¡©us
);

693 
STDCALL
 
mysql_»äesh_¡¬t
(*
»t
, 
MYSQL
 *
mysql
,

694 
»äesh_ÝtiÚs
);

695 
STDCALL
 
mysql_»äesh_cÚt
(*
»t
, 
MYSQL
 *
mysql
, 
¡©us
);

696 
STDCALL
 
mysql_kžl_¡¬t
(*
»t
, 
MYSQL
 *
mysql
,

697 
pid
);

698 
STDCALL
 
mysql_kžl_cÚt
(*
»t
, 
MYSQL
 *
mysql
, 
¡©us
);

699 
STDCALL
 
mysql_£t_£rv”_ÝtiÚ_¡¬t
(*
»t
, 
MYSQL
 *
mysql
,

700 
’um_mysql_£t_ÝtiÚ


701 
ÝtiÚ
);

702 
STDCALL
 
mysql_£t_£rv”_ÝtiÚ_cÚt
(*
»t
, 
MYSQL
 *
mysql
,

703 
¡©us
);

704 
STDCALL
 
mysql_pšg_¡¬t
(*
»t
, 
MYSQL
 *
mysql
);

705 
STDCALL
 
mysql_pšg_cÚt
(*
»t
, 
MYSQL
 *
mysql
, 
¡©us
);

706 
STDCALL
 
mysql_¡©_¡¬t
(cÚ¡ **
»t
, 
MYSQL
 *
mysql
);

707 
STDCALL
 
mysql_¡©_cÚt
(cÚ¡ **
»t
, 
MYSQL
 *
mysql
,

708 
¡©us
);

709 
STDCALL
 
mysql_ä“_»suÉ_¡¬t
(
MYSQL_RES
 *
»suÉ
);

710 
STDCALL
 
mysql_ä“_»suÉ_cÚt
(
MYSQL_RES
 *
»suÉ
, 
¡©us
);

711 
STDCALL
 
mysql_ãtch_row_¡¬t
(
MYSQL_ROW
 *
»t
,

712 
MYSQL_RES
 *
»suÉ
);

713 
STDCALL
 
mysql_ãtch_row_cÚt
(
MYSQL_ROW
 *
»t
, 
MYSQL_RES
 *
»suÉ
,

714 
¡©us
);

715 
STDCALL
 
mysql_»ad_qu”y_»suÉ_¡¬t
(
my_boÞ
 *
»t
,

716 
MYSQL
 *
mysql
);

717 
STDCALL
 
mysql_»ad_qu”y_»suÉ_cÚt
(
my_boÞ
 *
»t
,

718 
MYSQL
 *
mysql
, 
¡©us
);

719 
STDCALL
 
mysql_»£t_cÚÃùiÚ_¡¬t
(*
»t
, 
MYSQL
 *
mysql
);

720 
STDCALL
 
mysql_»£t_cÚÃùiÚ_cÚt
(*
»t
, 
MYSQL
 *
mysql
, 
¡©us
);

721 
STDCALL
 
mysql_£ssiÚ_Œack_g‘_Ãxt
(
MYSQL
 *
mysql
, 
’um_£ssiÚ_¡©e_ty³
 
ty³
, cÚ¡ **
d©a
, 
size_t
 *
Ëngth
);

722 
STDCALL
 
mysql_£ssiÚ_Œack_g‘_fœ¡
(
MYSQL
 *
mysql
, 
’um_£ssiÚ_¡©e_ty³
 
ty³
, cÚ¡ **
d©a
, 
size_t
 *
Ëngth
);

723 
STDCALL
 
mysql_¡mt_´•¬e_¡¬t
(*
»t
, 
MYSQL_STMT
 *
¡mt
,cÚ¡ *
qu”y
, 
Ëngth
);

724 
STDCALL
 
mysql_¡mt_´•¬e_cÚt
(*
»t
, 
MYSQL_STMT
 *
¡mt
, 
¡©us
);

725 
STDCALL
 
mysql_¡mt_execu‹_¡¬t
(*
»t
, 
MYSQL_STMT
 *
¡mt
);

726 
STDCALL
 
mysql_¡mt_execu‹_cÚt
(*
»t
, 
MYSQL_STMT
 *
¡mt
, 
¡©us
);

727 
STDCALL
 
mysql_¡mt_ãtch_¡¬t
(*
»t
, 
MYSQL_STMT
 *
¡mt
);

728 
STDCALL
 
mysql_¡mt_ãtch_cÚt
(*
»t
, 
MYSQL_STMT
 *
¡mt
, 
¡©us
);

729 
STDCALL
 
mysql_¡mt_¡Üe_»suÉ_¡¬t
(*
»t
, 
MYSQL_STMT
 *
¡mt
);

730 
STDCALL
 
mysql_¡mt_¡Üe_»suÉ_cÚt
(*
»t
, 
MYSQL_STMT
 *
¡mt
,
¡©us
);

731 
STDCALL
 
mysql_¡mt_þo£_¡¬t
(
my_boÞ
 *
»t
, 
MYSQL_STMT
 *
¡mt
);

732 
STDCALL
 
mysql_¡mt_þo£_cÚt
(
my_boÞ
 *
»t
, 
MYSQL_STMT
 * 
¡mt
, 
¡©us
);

733 
STDCALL
 
mysql_¡mt_»£t_¡¬t
(
my_boÞ
 *
»t
, 
MYSQL_STMT
 * 
¡mt
);

734 
STDCALL
 
mysql_¡mt_»£t_cÚt
(
my_boÞ
 *
»t
, 
MYSQL_STMT
 *
¡mt
, 
¡©us
);

735 
STDCALL
 
mysql_¡mt_ä“_»suÉ_¡¬t
(
my_boÞ
 *
»t
, 
MYSQL_STMT
 *
¡mt
);

736 
STDCALL
 
mysql_¡mt_ä“_»suÉ_cÚt
(
my_boÞ
 *
»t
, 
MYSQL_STMT
 *
¡mt
,

737 
¡©us
);

738 
STDCALL
 
mysql_¡mt_£nd_lÚg_d©a_¡¬t
(
my_boÞ
 *
»t
, 
MYSQL_STMT
 *
¡mt
,

739 
·¿m_numb”
,

740 cÚ¡ *
d©a
,

741 
Ën
);

742 
STDCALL
 
mysql_¡mt_£nd_lÚg_d©a_cÚt
(
my_boÞ
 *
»t
, 
MYSQL_STMT
 *
¡mt
,

743 
¡©us
);

744 
STDCALL
 
mysql_»£t_cÚÃùiÚ
(
MYSQL
 *
mysql
);

747 
	s¡_m¬Ÿdb_­i
 {

748 (
STDCALL
 *
	gmysql_num_rows
)(
MYSQL_RES
 *
	g»s
);

749 (
STDCALL
 *
	gmysql_num_f›lds
)(
MYSQL_RES
 *
	g»s
);

750 
my_boÞ
 (
STDCALL
 *
mysql_eof
)(
MYSQL_RES
 *
	g»s
);

751 
	gMYSQL_FIELD
 *(
STDCALL
 *
	gmysql_ãtch_f›ld_dœeù
)(
MYSQL_RES
 *
	g»s
, 
	gf›ldÄ
);

752 
	gMYSQL_FIELD
 * (
STDCALL
 *
	gmysql_ãtch_f›lds
)(
MYSQL_RES
 *
	g»s
);

753 
	gMYSQL_ROWS
 * (
STDCALL
 *
	gmysql_row_‹Î
)(
MYSQL_RES
 *
	g»s
);

754 (
STDCALL
 *
	gmysql_f›ld_‹Î
)(
MYSQL_RES
 *
	g»s
);

755 (
STDCALL
 *
	gmysql_f›ld_couÁ
)(
MYSQL
 *
	gmysql
);

756 
my_boÞ
 (
STDCALL
 *
mysql_mÜe_»suÉs
)(
MYSQL
 *
	gmysql
);

757 (
STDCALL
 *
	gmysql_Ãxt_»suÉ
)(
MYSQL
 *
	gmysql
);

758 (
STDCALL
 *
	gmysql_afãùed_rows
)(
MYSQL
 *
	gmysql
);

759 
my_boÞ
 (
STDCALL
 *
mysql_autocomm™
)(
MYSQL
 *
	gmysql
, my_boÞ 
	gmode
);

760 
my_boÞ
 (
STDCALL
 *
mysql_comm™
)(
MYSQL
 *
	gmysql
);

761 
my_boÞ
 (
STDCALL
 *
mysql_rÞlback
)(
MYSQL
 *
	gmysql
);

762 (
STDCALL
 *
	gmysql_š£¹_id
)(
MYSQL
 *
	gmysql
);

763 (
STDCALL
 *
	gmysql_”ºo
)(
MYSQL
 *
	gmysql
);

764 cÚ¡ * (
STDCALL
 *
	gmysql_”rÜ
)(
MYSQL
 *
	gmysql
);

765 cÚ¡ * (
STDCALL
 *
	gmysql_šfo
)(
MYSQL
 *
	gmysql
);

766 (
STDCALL
 *
	gmysql_th»ad_id
)(
MYSQL
 *
	gmysql
);

767 cÚ¡ * (
STDCALL
 *
	gmysql_ch¬aù”_£t_Çme
)(
MYSQL
 *
	gmysql
);

768 (
STDCALL
 *
	gmysql_g‘_ch¬aù”_£t_šfo
)(
MYSQL
 *
	gmysql
, 
MY_CHARSET_INFO
 *
	gcs
);

769 (
STDCALL
 *
	gmysql_£t_ch¬aù”_£t
)(
MYSQL
 *
	gmysql
, cÚ¡ *
	gc¢ame
);

770 
my_boÞ
 (*
m¬Ÿdb_g‘_šfov
)(
MYSQL
 *
	gmysql
, 
m¬Ÿdb_v®ue
 
	gv®ue
, *
	g¬g
, ...);

771 
my_boÞ
 (
STDCALL
 *
m¬Ÿdb_g‘_šfo
)(
MYSQL
 *
	gmysql
, 
m¬Ÿdb_v®ue
 
	gv®ue
, *
	g¬g
);

772 
	gMYSQL
 * (
STDCALL
 *
	gmysql_š™
)(
MYSQL
 *
	gmysql
);

773 (
STDCALL
 *
	gmysql_s¦_£t
)(
MYSQL
 *
	gmysql
, cÚ¡ *
	gkey
, cÚ¡ *
	gû¹
, cÚ¡ *
	gÿ
, cÚ¡ *
	gÿ·th
, cÚ¡ *
	gch”
);

774 cÚ¡ * (
STDCALL
 *
	gmysql_g‘_s¦_ch”
)(
MYSQL
 *
	gmysql
);

775 
my_boÞ
 (
STDCALL
 *
mysql_chªge_u£r
)(
MYSQL
 *
	gmysql
, cÚ¡ *
	gu£r
, cÚ¡ *
	g·sswd
, cÚ¡ *
	gdb
);

776 
	gMYSQL
 * (
STDCALL
 *
	gmysql_»®_cÚÃù
)(
MYSQL
 *
	gmysql
, cÚ¡ *
	gho¡
, cÚ¡ *
	gu£r
, cÚ¡ *
	g·sswd
, cÚ¡ *
	gdb
, 
	gpÜt
, cÚ¡ *
	gunix_sock‘
, 
	gþ›Áæag
);

777 (
STDCALL
 *
	gmysql_þo£
)(
MYSQL
 *
	gsock
);

778 (
STDCALL
 *
	gmysql_£Ëù_db
)(
MYSQL
 *
	gmysql
, cÚ¡ *
	gdb
);

779 (
STDCALL
 *
	gmysql_qu”y
)(
MYSQL
 *
	gmysql
, cÚ¡ *
	gq
);

780 (
STDCALL
 *
	gmysql_£nd_qu”y
)(
MYSQL
 *
	gmysql
, cÚ¡ *
	gq
, 
	gËngth
);

781 
my_boÞ
 (
STDCALL
 *
mysql_»ad_qu”y_»suÉ
)(
MYSQL
 *
	gmysql
);

782 (
STDCALL
 *
	gmysql_»®_qu”y
)(
MYSQL
 *
	gmysql
, cÚ¡ *
	gq
, 
	gËngth
);

783 (
STDCALL
 *
	gmysql_shutdown
)(
MYSQL
 *
	gmysql
, 
mysql_’um_shutdown_Ëv–
 
	gshutdown_Ëv–
);

784 (
STDCALL
 *
	gmysql_dump_debug_šfo
)(
MYSQL
 *
	gmysql
);

785 (
STDCALL
 *
	gmysql_»äesh
)(
MYSQL
 *
	gmysql
, 
	g»äesh_ÝtiÚs
);

786 (
STDCALL
 *
	gmysql_kžl
)(
MYSQL
 *
	gmysql
,
	gpid
);

787 (
STDCALL
 *
	gmysql_pšg
)(
MYSQL
 *
	gmysql
);

788 * (
STDCALL
 *
	gmysql_¡©
)(
MYSQL
 *
	gmysql
);

789 * (
STDCALL
 *
	gmysql_g‘_£rv”_šfo
)(
MYSQL
 *
	gmysql
);

790 (
STDCALL
 *
	gmysql_g‘_£rv”_v”siÚ
)(
MYSQL
 *
	gmysql
);

791 * (
STDCALL
 *
	gmysql_g‘_ho¡_šfo
)(
MYSQL
 *
	gmysql
);

792 (
STDCALL
 *
	gmysql_g‘_´Ùo_šfo
)(
MYSQL
 *
	gmysql
);

793 
	gMYSQL_RES
 * (
STDCALL
 *
	gmysql_li¡_dbs
)(
MYSQL
 *
	gmysql
,cÚ¡ *
	gwžd
);

794 
	gMYSQL_RES
 * (
STDCALL
 *
	gmysql_li¡_bËs
)(
MYSQL
 *
	gmysql
,cÚ¡ *
	gwžd
);

795 
	gMYSQL_RES
 * (
STDCALL
 *
	gmysql_li¡_f›lds
)(
MYSQL
 *
	gmysql
, cÚ¡ *
	gbË
, cÚ¡ *
	gwžd
);

796 
	gMYSQL_RES
 * (
STDCALL
 *
	gmysql_li¡_´oûs£s
)(
MYSQL
 *
	gmysql
);

797 
	gMYSQL_RES
 * (
STDCALL
 *
	gmysql_¡Üe_»suÉ
)(
MYSQL
 *
	gmysql
);

798 
	gMYSQL_RES
 * (
STDCALL
 *
	gmysql_u£_»suÉ
)(
MYSQL
 *
	gmysql
);

799 (
STDCALL
 *
	gmysql_ÝtiÚs
)(
MYSQL
 *
	gmysql
,
mysql_ÝtiÚ
 
	gÝtiÚ
, cÚ¡ *
	g¬g
);

800 (
STDCALL
 *
	gmysql_ä“_»suÉ
)(
MYSQL_RES
 *
	g»suÉ
);

801 (
STDCALL
 *
	gmysql_d©a_£ek
)(
MYSQL_RES
 *
	g»suÉ
, 
	goff£t
);

802 
MYSQL_ROW_OFFSET
 (
STDCALL
 *
mysql_row_£ek
)(
MYSQL_RES
 *
	g»suÉ
, 
	gMYSQL_ROW_OFFSET
);

803 
MYSQL_FIELD_OFFSET
 (
STDCALL
 *
mysql_f›ld_£ek
)(
MYSQL_RES
 *
	g»suÉ
, MYSQL_FIELD_OFFSET 
	goff£t
);

804 
MYSQL_ROW
 (
STDCALL
 *
mysql_ãtch_row
)(
MYSQL_RES
 *
	g»suÉ
);

805 * (
STDCALL
 *
	gmysql_ãtch_Ëngths
)(
MYSQL_RES
 *
	g»suÉ
);

806 
	gMYSQL_FIELD
 * (
STDCALL
 *
	gmysql_ãtch_f›ld
)(
MYSQL_RES
 *
	g»suÉ
);

807 (
STDCALL
 *
	gmysql_esÿ³_¡ršg
)(*
	gto
,cÚ¡ *
	gäom
, 
	gäom_Ëngth
);

808 (
STDCALL
 *
	gmysql_»®_esÿ³_¡ršg
)(
MYSQL
 *
	gmysql
, *
	gto
,cÚ¡ *
	gäom
, 
	gËngth
);

809 (
STDCALL
 *
	gmysql_th»ad_§ã
)();

810 (
STDCALL
 *
	gmysql_w¬nšg_couÁ
)(
MYSQL
 *
	gmysql
);

811 cÚ¡ * (
STDCALL
 *
	gmysql_sql¡©e
)(
MYSQL
 *
	gmysql
);

812 (
STDCALL
 *
	gmysql_£rv”_š™
)(
	g¬gc
, **
	g¬gv
, **
	ggroups
);

813 (
STDCALL
 *
	gmysql_£rv”_’d
)();

814 (
STDCALL
 *
	gmysql_th»ad_’d
)();

815 
my_boÞ
 (
STDCALL
 *
mysql_th»ad_š™
)();

816 (
STDCALL
 *
	gmysql_£t_£rv”_ÝtiÚ
)(
MYSQL
 *
	gmysql
, 
’um_mysql_£t_ÝtiÚ
 
	gÝtiÚ
);

817 cÚ¡ * (
STDCALL
 *
	gmysql_g‘_þ›Á_šfo
)();

818 (
STDCALL
 *
	gmysql_g‘_þ›Á_v”siÚ
)();

819 
my_boÞ
 (
STDCALL
 *
m¬Ÿdb_cÚÃùiÚ
)(
MYSQL
 *
	gmysql
);

820 cÚ¡ * (
STDCALL
 *
	gmysql_g‘_£rv”_Çme
)(
MYSQL
 *
	gmysql
);

821 
	gMARIADB_CHARSET_INFO
 * (
STDCALL
 *
	gm¬Ÿdb_g‘_ch¬£t_by_Çme
)(cÚ¡ *
	gc¢ame
);

822 
	gMARIADB_CHARSET_INFO
 * (
STDCALL
 *
	gm¬Ÿdb_g‘_ch¬£t_by_Ä
)(
	gc¢r
);

823 
size_t
 (
STDCALL
 *
m¬Ÿdb_cÚv”t_¡ršg
)(cÚ¡ *
	gäom
, size_ˆ*
	gäom_Ën
, 
MARIADB_CHARSET_INFO
 *
	gäom_cs
, *
	gto
, size_ˆ*
	gto_Ën
, MARIADB_CHARSET_INFO *
	gto_cs
, *
	g”rÜcode
);

824 (*
	gmysql_ÝtiÚsv
)(
MYSQL
 *
	gmysql
,
mysql_ÝtiÚ
 
	gÝtiÚ
, ...);

825 (*
	gmysql_g‘_ÝtiÚv
)(
MYSQL
 *
	gmysql
, 
mysql_ÝtiÚ
 
	gÝtiÚ
, *
	g¬g
, ...);

826 (
STDCALL
 *
	gmysql_g‘_ÝtiÚ
)(
MYSQL
 *
	gmysql
, 
mysql_ÝtiÚ
 
	gÝtiÚ
, *
	g¬g
);

827 (
STDCALL
 *
	gmysql_hex_¡ršg
)(*
	gto
, cÚ¡ *
	gäom
, 
	gËn
);

828 
my_sock‘
 (
STDCALL
 *
mysql_g‘_sock‘
)(
MYSQL
 *
	gmysql
);

829 (
STDCALL
 *
	gmysql_g‘_timeout_v®ue
)(cÚ¡ 
MYSQL
 *
	gmysql
);

830 (
STDCALL
 *
	gmysql_g‘_timeout_v®ue_ms
)(cÚ¡ 
MYSQL
 *
	gmysql
);

831 
my_boÞ
 (
STDCALL
 *
m¬Ÿdb_»cÚÃù
)(
MYSQL
 *
	gmysql
);

832 
	gMYSQL_STMT
 * (
STDCALL
 *
	gmysql_¡mt_š™
)(
MYSQL
 *
	gmysql
);

833 (
STDCALL
 *
	gmysql_¡mt_´•¬e
)(
MYSQL_STMT
 *
	g¡mt
, cÚ¡ *
	gqu”y
, 
	gËngth
);

834 (
STDCALL
 *
	gmysql_¡mt_execu‹
)(
MYSQL_STMT
 *
	g¡mt
);

835 (
STDCALL
 *
	gmysql_¡mt_ãtch
)(
MYSQL_STMT
 *
	g¡mt
);

836 (
STDCALL
 *
	gmysql_¡mt_ãtch_cÞumn
)(
MYSQL_STMT
 *
	g¡mt
, 
MYSQL_BIND
 *
	gbšd_¬g
, 
	gcÞumn
, 
	goff£t
);

837 (
STDCALL
 *
	gmysql_¡mt_¡Üe_»suÉ
)(
MYSQL_STMT
 *
	g¡mt
);

838 (
STDCALL
 *
	gmysql_¡mt_·¿m_couÁ
)(
MYSQL_STMT
 * 
	g¡mt
);

839 
my_boÞ
 (
STDCALL
 *
mysql_¡mt_©Œ_£t
)(
MYSQL_STMT
 *
	g¡mt
, 
’um_¡mt_©Œ_ty³
 
	g©Œ_ty³
, cÚ¡ *
	g©Œ
);

840 
my_boÞ
 (
STDCALL
 *
mysql_¡mt_©Œ_g‘
)(
MYSQL_STMT
 *
	g¡mt
, 
’um_¡mt_©Œ_ty³
 
	g©Œ_ty³
, *
	g©Œ
);

841 
my_boÞ
 (
STDCALL
 *
mysql_¡mt_bšd_·¿m
)(
MYSQL_STMT
 * 
	g¡mt
, 
MYSQL_BIND
 * 
	gbnd
);

842 
my_boÞ
 (
STDCALL
 *
mysql_¡mt_bšd_»suÉ
)(
MYSQL_STMT
 * 
	g¡mt
, 
MYSQL_BIND
 * 
	gbnd
);

843 
my_boÞ
 (
STDCALL
 *
mysql_¡mt_þo£
)(
MYSQL_STMT
 * 
	g¡mt
);

844 
my_boÞ
 (
STDCALL
 *
mysql_¡mt_»£t
)(
MYSQL_STMT
 * 
	g¡mt
);

845 
my_boÞ
 (
STDCALL
 *
mysql_¡mt_ä“_»suÉ
)(
MYSQL_STMT
 *
	g¡mt
);

846 
my_boÞ
 (
STDCALL
 *
mysql_¡mt_£nd_lÚg_d©a
)(
MYSQL_STMT
 *
	g¡mt
, 
	g·¿m_numb”
, cÚ¡ *
	gd©a
, 
	gËngth
);

847 
	gMYSQL_RES
 *(
STDCALL
 *
	gmysql_¡mt_»suÉ_m‘ad©a
)(
MYSQL_STMT
 *
	g¡mt
);

848 
	gMYSQL_RES
 *(
STDCALL
 *
	gmysql_¡mt_·¿m_m‘ad©a
)(
MYSQL_STMT
 *
	g¡mt
);

849 (
STDCALL
 *
	gmysql_¡mt_”ºo
)(
MYSQL_STMT
 * 
	g¡mt
);

850 cÚ¡ *(
STDCALL
 *
	gmysql_¡mt_”rÜ
)(
MYSQL_STMT
 * 
	g¡mt
);

851 cÚ¡ *(
STDCALL
 *
	gmysql_¡mt_sql¡©e
)(
MYSQL_STMT
 * 
	g¡mt
);

852 
MYSQL_ROW_OFFSET
 (
STDCALL
 *
mysql_¡mt_row_£ek
)(
MYSQL_STMT
 *
	g¡mt
, MYSQL_ROW_OFFSET 
	goff£t
);

853 
MYSQL_ROW_OFFSET
 (
STDCALL
 *
mysql_¡mt_row_‹Î
)(
MYSQL_STMT
 *
	g¡mt
);

854 (
STDCALL
 *
	gmysql_¡mt_d©a_£ek
)(
MYSQL_STMT
 *
	g¡mt
, 
	goff£t
);

855 (
STDCALL
 *
	gmysql_¡mt_num_rows
)(
MYSQL_STMT
 *
	g¡mt
);

856 (
STDCALL
 *
	gmysql_¡mt_afãùed_rows
)(
MYSQL_STMT
 *
	g¡mt
);

857 (
STDCALL
 *
	gmysql_¡mt_š£¹_id
)(
MYSQL_STMT
 *
	g¡mt
);

858 (
STDCALL
 *
	gmysql_¡mt_f›ld_couÁ
)(
MYSQL_STMT
 *
	g¡mt
);

859 (
STDCALL
 *
	gmysql_¡mt_Ãxt_»suÉ
)(
MYSQL_STMT
 *
	g¡mt
);

860 
my_boÞ
 (
STDCALL
 *
mysql_¡mt_mÜe_»suÉs
)(
MYSQL_STMT
 *
	g¡mt
);

861 (
STDCALL
 *
	gm¬Ÿdb_¡mt_execu‹_dœeù
)(
MYSQL_STMT
 *
	g¡mt
, cÚ¡ *
	g¡mt¡r
, 
size_t
 
	gËngth
);

862 (
STDCALL
 *
	gmysql_»£t_cÚÃùiÚ
)(
MYSQL
 *
	gmysql
);

866 
	s¡_m¬Ÿdb_m‘hods
 {

867 
	gMYSQL
 *(*
	gdb_cÚÃù
)(
MYSQL
 *
	gmysql
, cÚ¡ *
	gho¡
, cÚ¡ *
	gu£r
, cÚ¡ *
	g·sswd
,

868 cÚ¡ *
	gdb
, 
	gpÜt
, cÚ¡ *
	gunix_sock‘
, 
	gþ›Áæag
);

869 (*
	gdb_þo£
)(
MYSQL
 *
	gmysql
);

870 (*
	gdb_commªd
)(
MYSQL
 *
	gmysql
,
’um_£rv”_commªd
 
	gcommªd
, cÚ¡ *
	g¬g
,

871 
size_t
 
	gËngth
, 
my_boÞ
 
	gskp_check
, *
	gÝt_¬g
);

872 (*
	gdb_sk_»suÉ
)(
MYSQL
 *
	gmysql
);

873 (*
	gdb_»ad_qu”y_»suÉ
)(
MYSQL
 *
	gmysql
);

874 
	gMYSQL_DATA
 *(*
	gdb_»ad_rows
)(
MYSQL
 *
	gmysql
,
MYSQL_FIELD
 *
	gf›lds
, 
	gf›ld_couÁ
);

875 (*
	gdb_»ad_Úe_row
)(
MYSQL
 *
	gmysql
,
	gf›lds
,
MYSQL_ROW
 
	grow
, *
	gËngths
);

877 
my_boÞ
 (*
db_suµÜ‹d_bufãr_ty³
)(
’um_f›ld_ty³s
 
	gty³
);

878 
my_boÞ
 (*
db_»ad_´•¬e_»¥Ú£
)(
MYSQL_STMT
 *
	g¡mt
);

879 (*
	gdb_»ad_¡mt_»suÉ
)(
MYSQL
 *
	gmysql
);

880 
my_boÞ
 (*
db_¡mt_g‘_»suÉ_m‘ad©a
)(
MYSQL_STMT
 *
	g¡mt
);

881 
my_boÞ
 (*
db_¡mt_g‘_·¿m_m‘ad©a
)(
MYSQL_STMT
 *
	g¡mt
);

882 (*
	gdb_¡mt_»ad_®l_rows
)(
MYSQL_STMT
 *
	g¡mt
);

883 (*
	gdb_¡mt_ãtch
)(
MYSQL_STMT
 *
	g¡mt
, **
	grow
);

884 (*
	gdb_¡mt_ãtch_to_bšd
)(
MYSQL_STMT
 *
	g¡mt
, *
	grow
);

885 (*
	gdb_¡mt_æush_unbufã»d
)(
MYSQL_STMT
 *
	g¡mt
);

886 (*
	g£t_”rÜ
)(
MYSQL
 *
	gmysql
, 
	g”rÜ_Ä
, cÚ¡ *
	gsql¡©e
, cÚ¡ *
	gfÜm©
, ...);

887 (*
	gšv®id©e_¡mts
)(
MYSQL
 *
	gmysql
, cÚ¡ *
	gfunùiÚ_Çme
);

888 
¡_m¬Ÿdb_­i
 *
	g­i
;

892 
	#mysql_»lßd
(
mysql
è
	`mysql_»äesh
((mysql),
REFRESH_GRANT
)

	)

893 
	#mysql_lib¿ry_š™
 
mysql_£rv”_š™


	)

894 
	#mysql_lib¿ry_’d
 
mysql_£rv”_’d


	)

898 
	#HAVE_MYSQL_REAL_CONNECT


	)

901 #ifdef 
__ýlu¥lus


	@include/mysql/client_plugin.h

26 #iâdeà
MYSQL_CLIENT_PLUGIN_INCLUDED


27 
	#MYSQL_CLIENT_PLUGIN_INCLUDED


	)

29 #iâdeà
MYSQL_ABI_CHECK


30 
	~<¡d¬g.h
>

31 
	~<¡dlib.h
>

35 #iâdeà
PLUGINDIR


36 
	#PLUGINDIR
 "lib/¶ugš"

	)

39 
	#¶ugš_deþ¬©iÚs_sym
 "_mysql_þ›Á_¶ugš_deþ¬©iÚ_"

	)

42 
	#MYSQL_CLIENT_PLUGIN_RESERVED
 0

	)

43 
	#MYSQL_CLIENT_PLUGIN_RESERVED2
 1

	)

44 
	#MYSQL_CLIENT_AUTHENTICATION_PLUGIN
 2

	)

46 
	#MYSQL_CLIENT_AUTHENTICATION_PLUGIN_INTERFACE_VERSION
 0x0100

	)

47 
	#MYSQL_CLIENT_MAX_PLUGINS
 3

	)

50 
	#MARIADB_CLIENT_REMOTEIO_PLUGIN
 100

	)

51 
	#MARIADB_CLIENT_PVIO_PLUGIN
 101

	)

52 
	#MARIADB_CLIENT_TRACE_PLUGIN
 102

	)

53 
	#MARIADB_CLIENT_CONNECTION_PLUGIN
 103

	)

55 
	#MARIADB_CLIENT_REMOTEIO_PLUGIN_INTERFACE_VERSION
 0x0100

	)

56 
	#MARIADB_CLIENT_PVIO_PLUGIN_INTERFACE_VERSION
 0x0100

	)

57 
	#MARIADB_CLIENT_TRACE_PLUGIN_INTERFACE_VERSION
 0x0100

	)

58 
	#MARIADB_CLIENT_CONNECTION_PLUGIN_INTERFACE_VERSION
 0x0100

	)

60 
	#MARIADB_CLIENT_MAX_PLUGINS
 4

	)

62 
	#mysql_deþ¬e_þ›Á_¶ugš
(
X
) \

63 
¡_mysql_þ›Á_¶ugš_
 ## 
X
 \

64 
_mysql_þ›Á_¶ugš_deþ¬©iÚ_
 = { \

65 
MYSQL_CLIENT_
 ## 
X
 ## 
_PLUGIN
, \

66 
MYSQL_CLIENT_
 ## 
X
 ## 
_PLUGIN_INTERFACE_VERSION
,

	)

67 
	#mysql_’d_þ›Á_¶ugš
 }

	)

70 #iâdeà
MYSQL_CLIENT_PLUGIN_HEADER


71 
	#MYSQL_CLIENT_PLUGIN_HEADER
 \

72 
ty³
; \

73 
š‹rçû_v”siÚ
; \

74 cÚ¡ *
Çme
; \

75 cÚ¡ *
authÜ
; \

76 cÚ¡ *
desc
; \

77 
v”siÚ
[3]; \

78 cÚ¡ *
liûn£
; \

79 *
mysql_­i
; \

80 (*
š™
)(*, 
size_t
, , 
va_li¡
); \

81 (*
deš™
)(); \

82 (*
ÝtiÚs
)(cÚ¡ *
ÝtiÚ
, cÚ¡ *);

	)

83 
	s¡_mysql_þ›Á_¶ugš


85 
	mMYSQL_CLIENT_PLUGIN_HEADER


89 
	g¡_mysql
;

93 
	s¡_ma_cÚÃùiÚ_¶ugš


95 
MYSQL_CLIENT_PLUGIN_HEADER


97 
	mMYSQL
 *(*
	mcÚÃù
)(
MYSQL
 *
	mmysql
, cÚ¡ *
	mho¡
,

98 cÚ¡ *
	mu£r
, cÚ¡ *
	m·sswd
,

99 cÚ¡ *
	mdb
, 
	mpÜt
,

100 cÚ¡ *
	munix_sock‘
, 
	mþ›Áæag
);

101 (*
	mþo£
)(
MYSQL
 *
	mmysql
);

102 (*
	m£t_ÝtiÚsv
)(
MYSQL
 *
	mmysql
, 
	mÝtiÚ
, ...);

103 (*
	m£t_cÚÃùiÚ
)(
MYSQL
 *
	mmysql
,
’um_£rv”_commªd
 
	mcommªd
,

104 cÚ¡ *
	m¬g
,

105 
size_t
 
	mËngth
, 
my_boÞ
 
	mskp_check
, *
	mÝt_¬g
);

106 
my_boÞ
 (*
»cÚÃù
)(
MYSQL
 *
	mmysql
);

107 (*
	m»£t
)(
MYSQL
 *
	mmysql
);

108 } 
	tMARIADB_CONNECTION_PLUGIN
;

110 
	#MARIADB_DB_DRIVER
(
a
è(×)->
ext_db
)

	)

113 
	~<ma_pvio.h
>

115 
	s¡_m¬Ÿdb_þ›Á_¶ugš_PVIO


117 
MYSQL_CLIENT_PLUGIN_HEADER


118 
¡_ma_pvio_m‘hods
 *
	mm‘hods
;

119 } 
	tMARIADB_PVIO_PLUGIN
;

122 
	~<mysql/¶ugš_auth_commÚ.h
>

124 
	s¡_mysql_þ›Á_¶ugš_AUTHENTICATION


126 
MYSQL_CLIENT_PLUGIN_HEADER


127 (*
	mauth’tiÿ‹_u£r
)(
MYSQL_PLUGIN_VIO
 *
	mvio
, 
¡_mysql
 *
	mmysql
);

131 
	s¡_mysql_þ›Á_¶ugš_TRACE


133 
	mMYSQL_CLIENT_PLUGIN_HEADER


152 *(*
	tmysql_auth’tiÿtiÚ_dŸlog_ask_t
)(
	t¡_mysql
 *
	tmysql
,

153 
	tty³
, cÚ¡ *
	t´om±
, *
	tbuf
, 
	tbuf_Ën
);

156 #ifdeà
HAVE_REMOTEIO


157 
	~<m¬Ÿdb/ma_io.h
>

160 
	s¡_mysql_þ›Á_¶ugš_REMOTEIO


162 
MYSQL_CLIENT_PLUGIN_HEADER


163 
¡_rio_m‘hods
 *
	mm‘hods
;

164 } 
	tMARIADB_REMOTEIO_PLUGIN
;

183 
¡_mysql_þ›Á_¶ugš
 *

184 
mysql_lßd_¶ugš
(
¡_mysql
 *
mysql
, cÚ¡ *
Çme
, 
ty³
,

185 
¬gc
, ...);

204 
¡_mysql_þ›Á_¶ugš
 * 
STDCALL


205 
mysql_lßd_¶ugš_v
(
¡_mysql
 *
mysql
, cÚ¡ *
Çme
, 
ty³
,

206 
¬gc
, 
va_li¡
 
¬gs
);

219 
¡_mysql_þ›Á_¶ugš
 * 
STDCALL


220 
mysql_þ›Á_fšd_¶ugš
(
¡_mysql
 *
mysql
, cÚ¡ *
Çme
, 
ty³
);

236 
¡_mysql_þ›Á_¶ugš
 * 
STDCALL


237 
mysql_þ›Á_»gi¡”_¶ugš
(
¡_mysql
 *
mysql
,

238 
¡_mysql_þ›Á_¶ugš
 *
¶ugš
);

240 
¡_mysql_þ›Á_¶ugš
 *
mysql_þ›Á_bužtšs
[];

	@include/mysql/plugin_auth.h

1 #iâdeà
MYSQL_PLUGIN_AUTH_COMMON_INCLUDED


25 
	#MYSQL_PLUGIN_AUTH_COMMON_INCLUDED


	)

28 
	#MYSQL_USERNAME_LENGTH
 512

	)

44 
	#CR_ERROR
 0

	)

52 
	#CR_OK
 -1

	)

65 
	#CR_OK_HANDSHAKE_COMPLETE
 -2

	)

67 
	s¡_¶ugš_vio_šfo


69 ’um { 
	mMYSQL_VIO_INVALID
, 
	mMYSQL_VIO_TCP
, 
	mMYSQL_VIO_SOCKET
,

70 
	mMYSQL_VIO_PIPE
, 
	mMYSQL_VIO_MEMORY
 } 
	m´ÙocÞ
;

71 
	msock‘
;

72 #ifdeà
_WIN32


73 
HANDLE
 
	mhªdË
;

75 } 
	tMYSQL_PLUGIN_VIO_INFO
;

80 
	s¡_¶ugš_vio


87 (*
	m»ad_·ck‘
)(
¡_¶ugš_vio
 *
	mvio
,

88 **
	mbuf
);

94 (*
	mwr™e_·ck‘
)(
¡_¶ugš_vio
 *
	mvio
,

95 cÚ¡ *
	m·ck‘
,

96 
	m·ck‘_Ën
);

102 (*
	mšfo
)(
¡_¶ugš_vio
 *
	mvio
, 
¡_¶ugš_vio_šfo
 *info);

104 } 
	tMYSQL_PLUGIN_VIO
;

	@include/mysql/plugin_auth_common.h

19 #iâdeà
MYSQL_PLUGIN_AUTH_COMMON_INCLUDED


26 
	#MYSQL_PLUGIN_AUTH_COMMON_INCLUDED


	)

29 
	#MYSQL_USERNAME_LENGTH
 512

	)

45 
	#CR_ERROR
 0

	)

53 
	#CR_OK
 -1

	)

66 
	#CR_OK_HANDSHAKE_COMPLETE
 -2

	)

68 
	s¡_¶ugš_vio_šfo


70 ’um { 
	mMYSQL_VIO_INVALID
, 
	mMYSQL_VIO_TCP
, 
	mMYSQL_VIO_SOCKET
,

71 
	mMYSQL_VIO_PIPE
, 
	mMYSQL_VIO_MEMORY
 } 
	m´ÙocÞ
;

72 #iâdeà
_WIN32


73 
	msock‘
;

75 
SOCKET
 
	msock‘
;

76 
HANDLE
 
	mhªdË
;

78 } 
	tMYSQL_PLUGIN_VIO_INFO
;

83 
	s¡_¶ugš_vio


90 (*
	m»ad_·ck‘
)(
¡_¶ugš_vio
 *
	mvio
,

91 **
	mbuf
);

97 (*
	mwr™e_·ck‘
)(
¡_¶ugš_vio
 *
	mvio
,

98 cÚ¡ *
	m·ck‘
,

99 
	m·ck‘_Ën
);

105 (*
	mšfo
)(
¡_¶ugš_vio
 *
	mvio
, 
¡_¶ugš_vio_šfo
 *info);

107 } 
	tMYSQL_PLUGIN_VIO
;

	@include/mysqld_error.h

6 
	#ER_ERROR_FIRST
 1000

	)

7 
	#ER_HASHCHK
 1000

	)

8 
	#ER_NISAMCHK
 1001

	)

9 
	#ER_NO
 1002

	)

10 
	#ER_YES
 1003

	)

11 
	#ER_CANT_CREATE_FILE
 1004

	)

12 
	#ER_CANT_CREATE_TABLE
 1005

	)

13 
	#ER_CANT_CREATE_DB
 1006

	)

14 
	#ER_DB_CREATE_EXISTS
 1007

	)

15 
	#ER_DB_DROP_EXISTS
 1008

	)

16 
	#ER_DB_DROP_DELETE
 1009

	)

17 
	#ER_DB_DROP_RMDIR
 1010

	)

18 
	#ER_CANT_DELETE_FILE
 1011

	)

19 
	#ER_CANT_FIND_SYSTEM_REC
 1012

	)

20 
	#ER_CANT_GET_STAT
 1013

	)

21 
	#ER_CANT_GET_WD
 1014

	)

22 
	#ER_CANT_LOCK
 1015

	)

23 
	#ER_CANT_OPEN_FILE
 1016

	)

24 
	#ER_FILE_NOT_FOUND
 1017

	)

25 
	#ER_CANT_READ_DIR
 1018

	)

26 
	#ER_CANT_SET_WD
 1019

	)

27 
	#ER_CHECKREAD
 1020

	)

28 
	#ER_DISK_FULL
 1021

	)

29 
	#ER_DUP_KEY
 1022

	)

30 
	#ER_ERROR_ON_CLOSE
 1023

	)

31 
	#ER_ERROR_ON_READ
 1024

	)

32 
	#ER_ERROR_ON_RENAME
 1025

	)

33 
	#ER_ERROR_ON_WRITE
 1026

	)

34 
	#ER_FILE_USED
 1027

	)

35 
	#ER_FILSORT_ABORT
 1028

	)

36 
	#ER_FORM_NOT_FOUND
 1029

	)

37 
	#ER_GET_ERRNO
 1030

	)

38 
	#ER_ILLEGAL_HA
 1031

	)

39 
	#ER_KEY_NOT_FOUND
 1032

	)

40 
	#ER_NOT_FORM_FILE
 1033

	)

41 
	#ER_NOT_KEYFILE
 1034

	)

42 
	#ER_OLD_KEYFILE
 1035

	)

43 
	#ER_OPEN_AS_READONLY
 1036

	)

44 
	#ER_OUTOFMEMORY
 1037

	)

45 
	#ER_OUT_OF_SORTMEMORY
 1038

	)

46 
	#ER_UNEXPECTED_EOF
 1039

	)

47 
	#ER_CON_COUNT_ERROR
 1040

	)

48 
	#ER_OUT_OF_RESOURCES
 1041

	)

49 
	#ER_BAD_HOST_ERROR
 1042

	)

50 
	#ER_HANDSHAKE_ERROR
 1043

	)

51 
	#ER_DBACCESS_DENIED_ERROR
 1044

	)

52 
	#ER_ACCESS_DENIED_ERROR
 1045

	)

53 
	#ER_NO_DB_ERROR
 1046

	)

54 
	#ER_UNKNOWN_COM_ERROR
 1047

	)

55 
	#ER_BAD_NULL_ERROR
 1048

	)

56 
	#ER_BAD_DB_ERROR
 1049

	)

57 
	#ER_TABLE_EXISTS_ERROR
 1050

	)

58 
	#ER_BAD_TABLE_ERROR
 1051

	)

59 
	#ER_NON_UNIQ_ERROR
 1052

	)

60 
	#ER_SERVER_SHUTDOWN
 1053

	)

61 
	#ER_BAD_FIELD_ERROR
 1054

	)

62 
	#ER_WRONG_FIELD_WITH_GROUP
 1055

	)

63 
	#ER_WRONG_GROUP_FIELD
 1056

	)

64 
	#ER_WRONG_SUM_SELECT
 1057

	)

65 
	#ER_WRONG_VALUE_COUNT
 1058

	)

66 
	#ER_TOO_LONG_IDENT
 1059

	)

67 
	#ER_DUP_FIELDNAME
 1060

	)

68 
	#ER_DUP_KEYNAME
 1061

	)

69 
	#ER_DUP_ENTRY
 1062

	)

70 
	#ER_WRONG_FIELD_SPEC
 1063

	)

71 
	#ER_PARSE_ERROR
 1064

	)

72 
	#ER_EMPTY_QUERY
 1065

	)

73 
	#ER_NONUNIQ_TABLE
 1066

	)

74 
	#ER_INVALID_DEFAULT
 1067

	)

75 
	#ER_MULTIPLE_PRI_KEY
 1068

	)

76 
	#ER_TOO_MANY_KEYS
 1069

	)

77 
	#ER_TOO_MANY_KEY_PARTS
 1070

	)

78 
	#ER_TOO_LONG_KEY
 1071

	)

79 
	#ER_KEY_COLUMN_DOES_NOT_EXITS
 1072

	)

80 
	#ER_BLOB_USED_AS_KEY
 1073

	)

81 
	#ER_TOO_BIG_FIELDLENGTH
 1074

	)

82 
	#ER_WRONG_AUTO_KEY
 1075

	)

83 
	#ER_UNUSED_9
 1076

	)

84 
	#ER_NORMAL_SHUTDOWN
 1077

	)

85 
	#ER_GOT_SIGNAL
 1078

	)

86 
	#ER_SHUTDOWN_COMPLETE
 1079

	)

87 
	#ER_FORCING_CLOSE
 1080

	)

88 
	#ER_IPSOCK_ERROR
 1081

	)

89 
	#ER_NO_SUCH_INDEX
 1082

	)

90 
	#ER_WRONG_FIELD_TERMINATORS
 1083

	)

91 
	#ER_BLOBS_AND_NO_TERMINATED
 1084

	)

92 
	#ER_TEXTFILE_NOT_READABLE
 1085

	)

93 
	#ER_FILE_EXISTS_ERROR
 1086

	)

94 
	#ER_LOAD_INFO
 1087

	)

95 
	#ER_ALTER_INFO
 1088

	)

96 
	#ER_WRONG_SUB_KEY
 1089

	)

97 
	#ER_CANT_REMOVE_ALL_FIELDS
 1090

	)

98 
	#ER_CANT_DROP_FIELD_OR_KEY
 1091

	)

99 
	#ER_INSERT_INFO
 1092

	)

100 
	#ER_UPDATE_TABLE_USED
 1093

	)

101 
	#ER_NO_SUCH_THREAD
 1094

	)

102 
	#ER_KILL_DENIED_ERROR
 1095

	)

103 
	#ER_NO_TABLES_USED
 1096

	)

104 
	#ER_TOO_BIG_SET
 1097

	)

105 
	#ER_NO_UNIQUE_LOGFILE
 1098

	)

106 
	#ER_TABLE_NOT_LOCKED_FOR_WRITE
 1099

	)

107 
	#ER_TABLE_NOT_LOCKED
 1100

	)

108 
	#ER_BLOB_CANT_HAVE_DEFAULT
 1101

	)

109 
	#ER_WRONG_DB_NAME
 1102

	)

110 
	#ER_WRONG_TABLE_NAME
 1103

	)

111 
	#ER_TOO_BIG_SELECT
 1104

	)

112 
	#ER_UNKNOWN_ERROR
 1105

	)

113 
	#ER_UNKNOWN_PROCEDURE
 1106

	)

114 
	#ER_WRONG_PARAMCOUNT_TO_PROCEDURE
 1107

	)

115 
	#ER_WRONG_PARAMETERS_TO_PROCEDURE
 1108

	)

116 
	#ER_UNKNOWN_TABLE
 1109

	)

117 
	#ER_FIELD_SPECIFIED_TWICE
 1110

	)

118 
	#ER_INVALID_GROUP_FUNC_USE
 1111

	)

119 
	#ER_UNSUPPORTED_EXTENSION
 1112

	)

120 
	#ER_TABLE_MUST_HAVE_COLUMNS
 1113

	)

121 
	#ER_RECORD_FILE_FULL
 1114

	)

122 
	#ER_UNKNOWN_CHARACTER_SET
 1115

	)

123 
	#ER_TOO_MANY_TABLES
 1116

	)

124 
	#ER_TOO_MANY_FIELDS
 1117

	)

125 
	#ER_TOO_BIG_ROWSIZE
 1118

	)

126 
	#ER_STACK_OVERRUN
 1119

	)

127 
	#ER_WRONG_OUTER_JOIN
 1120

	)

128 
	#ER_NULL_COLUMN_IN_INDEX
 1121

	)

129 
	#ER_CANT_FIND_UDF
 1122

	)

130 
	#ER_CANT_INITIALIZE_UDF
 1123

	)

131 
	#ER_UDF_NO_PATHS
 1124

	)

132 
	#ER_UDF_EXISTS
 1125

	)

133 
	#ER_CANT_OPEN_LIBRARY
 1126

	)

134 
	#ER_CANT_FIND_DL_ENTRY
 1127

	)

135 
	#ER_FUNCTION_NOT_DEFINED
 1128

	)

136 
	#ER_HOST_IS_BLOCKED
 1129

	)

137 
	#ER_HOST_NOT_PRIVILEGED
 1130

	)

138 
	#ER_PASSWORD_ANONYMOUS_USER
 1131

	)

139 
	#ER_PASSWORD_NOT_ALLOWED
 1132

	)

140 
	#ER_PASSWORD_NO_MATCH
 1133

	)

141 
	#ER_UPDATE_INFO
 1134

	)

142 
	#ER_CANT_CREATE_THREAD
 1135

	)

143 
	#ER_WRONG_VALUE_COUNT_ON_ROW
 1136

	)

144 
	#ER_CANT_REOPEN_TABLE
 1137

	)

145 
	#ER_INVALID_USE_OF_NULL
 1138

	)

146 
	#ER_REGEXP_ERROR
 1139

	)

147 
	#ER_MIX_OF_GROUP_FUNC_AND_FIELDS
 1140

	)

148 
	#ER_NONEXISTING_GRANT
 1141

	)

149 
	#ER_TABLEACCESS_DENIED_ERROR
 1142

	)

150 
	#ER_COLUMNACCESS_DENIED_ERROR
 1143

	)

151 
	#ER_ILLEGAL_GRANT_FOR_TABLE
 1144

	)

152 
	#ER_GRANT_WRONG_HOST_OR_USER
 1145

	)

153 
	#ER_NO_SUCH_TABLE
 1146

	)

154 
	#ER_NONEXISTING_TABLE_GRANT
 1147

	)

155 
	#ER_NOT_ALLOWED_COMMAND
 1148

	)

156 
	#ER_SYNTAX_ERROR
 1149

	)

157 
	#ER_DELAYED_CANT_CHANGE_LOCK
 1150

	)

158 
	#ER_TOO_MANY_DELAYED_THREADS
 1151

	)

159 
	#ER_ABORTING_CONNECTION
 1152

	)

160 
	#ER_NET_PACKET_TOO_LARGE
 1153

	)

161 
	#ER_NET_READ_ERROR_FROM_PIPE
 1154

	)

162 
	#ER_NET_FCNTL_ERROR
 1155

	)

163 
	#ER_NET_PACKETS_OUT_OF_ORDER
 1156

	)

164 
	#ER_NET_UNCOMPRESS_ERROR
 1157

	)

165 
	#ER_NET_READ_ERROR
 1158

	)

166 
	#ER_NET_READ_INTERRUPTED
 1159

	)

167 
	#ER_NET_ERROR_ON_WRITE
 1160

	)

168 
	#ER_NET_WRITE_INTERRUPTED
 1161

	)

169 
	#ER_TOO_LONG_STRING
 1162

	)

170 
	#ER_TABLE_CANT_HANDLE_BLOB
 1163

	)

171 
	#ER_TABLE_CANT_HANDLE_AUTO_INCREMENT
 1164

	)

172 
	#ER_DELAYED_INSERT_TABLE_LOCKED
 1165

	)

173 
	#ER_WRONG_COLUMN_NAME
 1166

	)

174 
	#ER_WRONG_KEY_COLUMN
 1167

	)

175 
	#ER_WRONG_MRG_TABLE
 1168

	)

176 
	#ER_DUP_UNIQUE
 1169

	)

177 
	#ER_BLOB_KEY_WITHOUT_LENGTH
 1170

	)

178 
	#ER_PRIMARY_CANT_HAVE_NULL
 1171

	)

179 
	#ER_TOO_MANY_ROWS
 1172

	)

180 
	#ER_REQUIRES_PRIMARY_KEY
 1173

	)

181 
	#ER_NO_RAID_COMPILED
 1174

	)

182 
	#ER_UPDATE_WITHOUT_KEY_IN_SAFE_MODE
 1175

	)

183 
	#ER_KEY_DOES_NOT_EXISTS
 1176

	)

184 
	#ER_CHECK_NO_SUCH_TABLE
 1177

	)

185 
	#ER_CHECK_NOT_IMPLEMENTED
 1178

	)

186 
	#ER_CANT_DO_THIS_DURING_AN_TRANSACTION
 1179

	)

187 
	#ER_ERROR_DURING_COMMIT
 1180

	)

188 
	#ER_ERROR_DURING_ROLLBACK
 1181

	)

189 
	#ER_ERROR_DURING_FLUSH_LOGS
 1182

	)

190 
	#ER_ERROR_DURING_CHECKPOINT
 1183

	)

191 
	#ER_NEW_ABORTING_CONNECTION
 1184

	)

192 
	#ER_UNUSED_10
 1185

	)

193 
	#ER_FLUSH_MASTER_BINLOG_CLOSED
 1186

	)

194 
	#ER_INDEX_REBUILD
 1187

	)

195 
	#ER_MASTER
 1188

	)

196 
	#ER_MASTER_NET_READ
 1189

	)

197 
	#ER_MASTER_NET_WRITE
 1190

	)

198 
	#ER_FT_MATCHING_KEY_NOT_FOUND
 1191

	)

199 
	#ER_LOCK_OR_ACTIVE_TRANSACTION
 1192

	)

200 
	#ER_UNKNOWN_SYSTEM_VARIABLE
 1193

	)

201 
	#ER_CRASHED_ON_USAGE
 1194

	)

202 
	#ER_CRASHED_ON_REPAIR
 1195

	)

203 
	#ER_WARNING_NOT_COMPLETE_ROLLBACK
 1196

	)

204 
	#ER_TRANS_CACHE_FULL
 1197

	)

205 
	#ER_SLAVE_MUST_STOP
 1198

	)

206 
	#ER_SLAVE_NOT_RUNNING
 1199

	)

207 
	#ER_BAD_SLAVE
 1200

	)

208 
	#ER_MASTER_INFO
 1201

	)

209 
	#ER_SLAVE_THREAD
 1202

	)

210 
	#ER_TOO_MANY_USER_CONNECTIONS
 1203

	)

211 
	#ER_SET_CONSTANTS_ONLY
 1204

	)

212 
	#ER_LOCK_WAIT_TIMEOUT
 1205

	)

213 
	#ER_LOCK_TABLE_FULL
 1206

	)

214 
	#ER_READ_ONLY_TRANSACTION
 1207

	)

215 
	#ER_DROP_DB_WITH_READ_LOCK
 1208

	)

216 
	#ER_CREATE_DB_WITH_READ_LOCK
 1209

	)

217 
	#ER_WRONG_ARGUMENTS
 1210

	)

218 
	#ER_NO_PERMISSION_TO_CREATE_USER
 1211

	)

219 
	#ER_UNION_TABLES_IN_DIFFERENT_DIR
 1212

	)

220 
	#ER_LOCK_DEADLOCK
 1213

	)

221 
	#ER_TABLE_CANT_HANDLE_FT
 1214

	)

222 
	#ER_CANNOT_ADD_FOREIGN
 1215

	)

223 
	#ER_NO_REFERENCED_ROW
 1216

	)

224 
	#ER_ROW_IS_REFERENCED
 1217

	)

225 
	#ER_CONNECT_TO_MASTER
 1218

	)

226 
	#ER_QUERY_ON_MASTER
 1219

	)

227 
	#ER_ERROR_WHEN_EXECUTING_COMMAND
 1220

	)

228 
	#ER_WRONG_USAGE
 1221

	)

229 
	#ER_WRONG_NUMBER_OF_COLUMNS_IN_SELECT
 1222

	)

230 
	#ER_CANT_UPDATE_WITH_READLOCK
 1223

	)

231 
	#ER_MIXING_NOT_ALLOWED
 1224

	)

232 
	#ER_DUP_ARGUMENT
 1225

	)

233 
	#ER_USER_LIMIT_REACHED
 1226

	)

234 
	#ER_SPECIFIC_ACCESS_DENIED_ERROR
 1227

	)

235 
	#ER_LOCAL_VARIABLE
 1228

	)

236 
	#ER_GLOBAL_VARIABLE
 1229

	)

237 
	#ER_NO_DEFAULT
 1230

	)

238 
	#ER_WRONG_VALUE_FOR_VAR
 1231

	)

239 
	#ER_WRONG_TYPE_FOR_VAR
 1232

	)

240 
	#ER_VAR_CANT_BE_READ
 1233

	)

241 
	#ER_CANT_USE_OPTION_HERE
 1234

	)

242 
	#ER_NOT_SUPPORTED_YET
 1235

	)

243 
	#ER_MASTER_FATAL_ERROR_READING_BINLOG
 1236

	)

244 
	#ER_SLAVE_IGNORED_TABLE
 1237

	)

245 
	#ER_INCORRECT_GLOBAL_LOCAL_VAR
 1238

	)

246 
	#ER_WRONG_FK_DEF
 1239

	)

247 
	#ER_KEY_REF_DO_NOT_MATCH_TABLE_REF
 1240

	)

248 
	#ER_OPERAND_COLUMNS
 1241

	)

249 
	#ER_SUBQUERY_NO_1_ROW
 1242

	)

250 
	#ER_UNKNOWN_STMT_HANDLER
 1243

	)

251 
	#ER_CORRUPT_HELP_DB
 1244

	)

252 
	#ER_CYCLIC_REFERENCE
 1245

	)

253 
	#ER_AUTO_CONVERT
 1246

	)

254 
	#ER_ILLEGAL_REFERENCE
 1247

	)

255 
	#ER_DERIVED_MUST_HAVE_ALIAS
 1248

	)

256 
	#ER_SELECT_REDUCED
 1249

	)

257 
	#ER_TABLENAME_NOT_ALLOWED_HERE
 1250

	)

258 
	#ER_NOT_SUPPORTED_AUTH_MODE
 1251

	)

259 
	#ER_SPATIAL_CANT_HAVE_NULL
 1252

	)

260 
	#ER_COLLATION_CHARSET_MISMATCH
 1253

	)

261 
	#ER_SLAVE_WAS_RUNNING
 1254

	)

262 
	#ER_SLAVE_WAS_NOT_RUNNING
 1255

	)

263 
	#ER_TOO_BIG_FOR_UNCOMPRESS
 1256

	)

264 
	#ER_ZLIB_Z_MEM_ERROR
 1257

	)

265 
	#ER_ZLIB_Z_BUF_ERROR
 1258

	)

266 
	#ER_ZLIB_Z_DATA_ERROR
 1259

	)

267 
	#ER_CUT_VALUE_GROUP_CONCAT
 1260

	)

268 
	#ER_WARN_TOO_FEW_RECORDS
 1261

	)

269 
	#ER_WARN_TOO_MANY_RECORDS
 1262

	)

270 
	#ER_WARN_NULL_TO_NOTNULL
 1263

	)

271 
	#ER_WARN_DATA_OUT_OF_RANGE
 1264

	)

272 
	#WARN_DATA_TRUNCATED
 1265

	)

273 
	#ER_WARN_USING_OTHER_HANDLER
 1266

	)

274 
	#ER_CANT_AGGREGATE_2COLLATIONS
 1267

	)

275 
	#ER_DROP_USER
 1268

	)

276 
	#ER_REVOKE_GRANTS
 1269

	)

277 
	#ER_CANT_AGGREGATE_3COLLATIONS
 1270

	)

278 
	#ER_CANT_AGGREGATE_NCOLLATIONS
 1271

	)

279 
	#ER_VARIABLE_IS_NOT_STRUCT
 1272

	)

280 
	#ER_UNKNOWN_COLLATION
 1273

	)

281 
	#ER_SLAVE_IGNORED_SSL_PARAMS
 1274

	)

282 
	#ER_SERVER_IS_IN_SECURE_AUTH_MODE
 1275

	)

283 
	#ER_WARN_FIELD_RESOLVED
 1276

	)

284 
	#ER_BAD_SLAVE_UNTIL_COND
 1277

	)

285 
	#ER_MISSING_SKIP_SLAVE
 1278

	)

286 
	#ER_UNTIL_COND_IGNORED
 1279

	)

287 
	#ER_WRONG_NAME_FOR_INDEX
 1280

	)

288 
	#ER_WRONG_NAME_FOR_CATALOG
 1281

	)

289 
	#ER_WARN_QC_RESIZE
 1282

	)

290 
	#ER_BAD_FT_COLUMN
 1283

	)

291 
	#ER_UNKNOWN_KEY_CACHE
 1284

	)

292 
	#ER_WARN_HOSTNAME_WONT_WORK
 1285

	)

293 
	#ER_UNKNOWN_STORAGE_ENGINE
 1286

	)

294 
	#ER_WARN_DEPRECATED_SYNTAX
 1287

	)

295 
	#ER_NON_UPDATABLE_TABLE
 1288

	)

296 
	#ER_FEATURE_DISABLED
 1289

	)

297 
	#ER_OPTION_PREVENTS_STATEMENT
 1290

	)

298 
	#ER_DUPLICATED_VALUE_IN_TYPE
 1291

	)

299 
	#ER_TRUNCATED_WRONG_VALUE
 1292

	)

300 
	#ER_TOO_MUCH_AUTO_TIMESTAMP_COLS
 1293

	)

301 
	#ER_INVALID_ON_UPDATE
 1294

	)

302 
	#ER_UNSUPPORTED_PS
 1295

	)

303 
	#ER_GET_ERRMSG
 1296

	)

304 
	#ER_GET_TEMPORARY_ERRMSG
 1297

	)

305 
	#ER_UNKNOWN_TIME_ZONE
 1298

	)

306 
	#ER_WARN_INVALID_TIMESTAMP
 1299

	)

307 
	#ER_INVALID_CHARACTER_STRING
 1300

	)

308 
	#ER_WARN_ALLOWED_PACKET_OVERFLOWED
 1301

	)

309 
	#ER_CONFLICTING_DECLARATIONS
 1302

	)

310 
	#ER_SP_NO_RECURSIVE_CREATE
 1303

	)

311 
	#ER_SP_ALREADY_EXISTS
 1304

	)

312 
	#ER_SP_DOES_NOT_EXIST
 1305

	)

313 
	#ER_SP_DROP_FAILED
 1306

	)

314 
	#ER_SP_STORE_FAILED
 1307

	)

315 
	#ER_SP_LILABEL_MISMATCH
 1308

	)

316 
	#ER_SP_LABEL_REDEFINE
 1309

	)

317 
	#ER_SP_LABEL_MISMATCH
 1310

	)

318 
	#ER_SP_UNINIT_VAR
 1311

	)

319 
	#ER_SP_BADSELECT
 1312

	)

320 
	#ER_SP_BADRETURN
 1313

	)

321 
	#ER_SP_BADSTATEMENT
 1314

	)

322 
	#ER_UPDATE_LOG_DEPRECATED_IGNORED
 1315

	)

323 
	#ER_UPDATE_LOG_DEPRECATED_TRANSLATED
 1316

	)

324 
	#ER_QUERY_INTERRUPTED
 1317

	)

325 
	#ER_SP_WRONG_NO_OF_ARGS
 1318

	)

326 
	#ER_SP_COND_MISMATCH
 1319

	)

327 
	#ER_SP_NORETURN
 1320

	)

328 
	#ER_SP_NORETURNEND
 1321

	)

329 
	#ER_SP_BAD_CURSOR_QUERY
 1322

	)

330 
	#ER_SP_BAD_CURSOR_SELECT
 1323

	)

331 
	#ER_SP_CURSOR_MISMATCH
 1324

	)

332 
	#ER_SP_CURSOR_ALREADY_OPEN
 1325

	)

333 
	#ER_SP_CURSOR_NOT_OPEN
 1326

	)

334 
	#ER_SP_UNDECLARED_VAR
 1327

	)

335 
	#ER_SP_WRONG_NO_OF_FETCH_ARGS
 1328

	)

336 
	#ER_SP_FETCH_NO_DATA
 1329

	)

337 
	#ER_SP_DUP_PARAM
 1330

	)

338 
	#ER_SP_DUP_VAR
 1331

	)

339 
	#ER_SP_DUP_COND
 1332

	)

340 
	#ER_SP_DUP_CURS
 1333

	)

341 
	#ER_SP_CANT_ALTER
 1334

	)

342 
	#ER_SP_SUBSELECT_NYI
 1335

	)

343 
	#ER_STMT_NOT_ALLOWED_IN_SF_OR_TRG
 1336

	)

344 
	#ER_SP_VARCOND_AFTER_CURSHNDLR
 1337

	)

345 
	#ER_SP_CURSOR_AFTER_HANDLER
 1338

	)

346 
	#ER_SP_CASE_NOT_FOUND
 1339

	)

347 
	#ER_FPARSER_TOO_BIG_FILE
 1340

	)

348 
	#ER_FPARSER_BAD_HEADER
 1341

	)

349 
	#ER_FPARSER_EOF_IN_COMMENT
 1342

	)

350 
	#ER_FPARSER_ERROR_IN_PARAMETER
 1343

	)

351 
	#ER_FPARSER_EOF_IN_UNKNOWN_PARAMETER
 1344

	)

352 
	#ER_VIEW_NO_EXPLAIN
 1345

	)

353 
	#ER_FRM_UNKNOWN_TYPE
 1346

	)

354 
	#ER_WRONG_OBJECT
 1347

	)

355 
	#ER_NONUPDATEABLE_COLUMN
 1348

	)

356 
	#ER_VIEW_SELECT_DERIVED
 1349

	)

357 
	#ER_VIEW_SELECT_CLAUSE
 1350

	)

358 
	#ER_VIEW_SELECT_VARIABLE
 1351

	)

359 
	#ER_VIEW_SELECT_TMPTABLE
 1352

	)

360 
	#ER_VIEW_WRONG_LIST
 1353

	)

361 
	#ER_WARN_VIEW_MERGE
 1354

	)

362 
	#ER_WARN_VIEW_WITHOUT_KEY
 1355

	)

363 
	#ER_VIEW_INVALID
 1356

	)

364 
	#ER_SP_NO_DROP_SP
 1357

	)

365 
	#ER_SP_GOTO_IN_HNDLR
 1358

	)

366 
	#ER_TRG_ALREADY_EXISTS
 1359

	)

367 
	#ER_TRG_DOES_NOT_EXIST
 1360

	)

368 
	#ER_TRG_ON_VIEW_OR_TEMP_TABLE
 1361

	)

369 
	#ER_TRG_CANT_CHANGE_ROW
 1362

	)

370 
	#ER_TRG_NO_SUCH_ROW_IN_TRG
 1363

	)

371 
	#ER_NO_DEFAULT_FOR_FIELD
 1364

	)

372 
	#ER_DIVISION_BY_ZERO
 1365

	)

373 
	#ER_TRUNCATED_WRONG_VALUE_FOR_FIELD
 1366

	)

374 
	#ER_ILLEGAL_VALUE_FOR_TYPE
 1367

	)

375 
	#ER_VIEW_NONUPD_CHECK
 1368

	)

376 
	#ER_VIEW_CHECK_FAILED
 1369

	)

377 
	#ER_PROCACCESS_DENIED_ERROR
 1370

	)

378 
	#ER_RELAY_LOG_FAIL
 1371

	)

379 
	#ER_PASSWD_LENGTH
 1372

	)

380 
	#ER_UNKNOWN_TARGET_BINLOG
 1373

	)

381 
	#ER_IO_ERR_LOG_INDEX_READ
 1374

	)

382 
	#ER_BINLOG_PURGE_PROHIBITED
 1375

	)

383 
	#ER_FSEEK_FAIL
 1376

	)

384 
	#ER_BINLOG_PURGE_FATAL_ERR
 1377

	)

385 
	#ER_LOG_IN_USE
 1378

	)

386 
	#ER_LOG_PURGE_UNKNOWN_ERR
 1379

	)

387 
	#ER_RELAY_LOG_INIT
 1380

	)

388 
	#ER_NO_BINARY_LOGGING
 1381

	)

389 
	#ER_RESERVED_SYNTAX
 1382

	)

390 
	#ER_WSAS_FAILED
 1383

	)

391 
	#ER_DIFF_GROUPS_PROC
 1384

	)

392 
	#ER_NO_GROUP_FOR_PROC
 1385

	)

393 
	#ER_ORDER_WITH_PROC
 1386

	)

394 
	#ER_LOGGING_PROHIBIT_CHANGING_OF
 1387

	)

395 
	#ER_NO_FILE_MAPPING
 1388

	)

396 
	#ER_WRONG_MAGIC
 1389

	)

397 
	#ER_PS_MANY_PARAM
 1390

	)

398 
	#ER_KEY_PART_0
 1391

	)

399 
	#ER_VIEW_CHECKSUM
 1392

	)

400 
	#ER_VIEW_MULTIUPDATE
 1393

	)

401 
	#ER_VIEW_NO_INSERT_FIELD_LIST
 1394

	)

402 
	#ER_VIEW_DELETE_MERGE_VIEW
 1395

	)

403 
	#ER_CANNOT_USER
 1396

	)

404 
	#ER_XAER_NOTA
 1397

	)

405 
	#ER_XAER_INVAL
 1398

	)

406 
	#ER_XAER_RMFAIL
 1399

	)

407 
	#ER_XAER_OUTSIDE
 1400

	)

408 
	#ER_XAER_RMERR
 1401

	)

409 
	#ER_XA_RBROLLBACK
 1402

	)

410 
	#ER_NONEXISTING_PROC_GRANT
 1403

	)

411 
	#ER_PROC_AUTO_GRANT_FAIL
 1404

	)

412 
	#ER_PROC_AUTO_REVOKE_FAIL
 1405

	)

413 
	#ER_DATA_TOO_LONG
 1406

	)

414 
	#ER_SP_BAD_SQLSTATE
 1407

	)

415 
	#ER_STARTUP
 1408

	)

416 
	#ER_LOAD_FROM_FIXED_SIZE_ROWS_TO_VAR
 1409

	)

417 
	#ER_CANT_CREATE_USER_WITH_GRANT
 1410

	)

418 
	#ER_WRONG_VALUE_FOR_TYPE
 1411

	)

419 
	#ER_TABLE_DEF_CHANGED
 1412

	)

420 
	#ER_SP_DUP_HANDLER
 1413

	)

421 
	#ER_SP_NOT_VAR_ARG
 1414

	)

422 
	#ER_SP_NO_RETSET
 1415

	)

423 
	#ER_CANT_CREATE_GEOMETRY_OBJECT
 1416

	)

424 
	#ER_FAILED_ROUTINE_BREAK_BINLOG
 1417

	)

425 
	#ER_BINLOG_UNSAFE_ROUTINE
 1418

	)

426 
	#ER_BINLOG_CREATE_ROUTINE_NEED_SUPER
 1419

	)

427 
	#ER_EXEC_STMT_WITH_OPEN_CURSOR
 1420

	)

428 
	#ER_STMT_HAS_NO_OPEN_CURSOR
 1421

	)

429 
	#ER_COMMIT_NOT_ALLOWED_IN_SF_OR_TRG
 1422

	)

430 
	#ER_NO_DEFAULT_FOR_VIEW_FIELD
 1423

	)

431 
	#ER_SP_NO_RECURSION
 1424

	)

432 
	#ER_TOO_BIG_SCALE
 1425

	)

433 
	#ER_TOO_BIG_PRECISION
 1426

	)

434 
	#ER_M_BIGGER_THAN_D
 1427

	)

435 
	#ER_WRONG_LOCK_OF_SYSTEM_TABLE
 1428

	)

436 
	#ER_CONNECT_TO_FOREIGN_DATA_SOURCE
 1429

	)

437 
	#ER_QUERY_ON_FOREIGN_DATA_SOURCE
 1430

	)

438 
	#ER_FOREIGN_DATA_SOURCE_DOESNT_EXIST
 1431

	)

439 
	#ER_FOREIGN_DATA_STRING_INVALID_CANT_CREATE
 1432

	)

440 
	#ER_FOREIGN_DATA_STRING_INVALID
 1433

	)

441 
	#ER_CANT_CREATE_FEDERATED_TABLE
 1434

	)

442 
	#ER_TRG_IN_WRONG_SCHEMA
 1435

	)

443 
	#ER_STACK_OVERRUN_NEED_MORE
 1436

	)

444 
	#ER_TOO_LONG_BODY
 1437

	)

445 
	#ER_WARN_CANT_DROP_DEFAULT_KEYCACHE
 1438

	)

446 
	#ER_TOO_BIG_DISPLAYWIDTH
 1439

	)

447 
	#ER_XAER_DUPID
 1440

	)

448 
	#ER_DATETIME_FUNCTION_OVERFLOW
 1441

	)

449 
	#ER_CANT_UPDATE_USED_TABLE_IN_SF_OR_TRG
 1442

	)

450 
	#ER_VIEW_PREVENT_UPDATE
 1443

	)

451 
	#ER_PS_NO_RECURSION
 1444

	)

452 
	#ER_SP_CANT_SET_AUTOCOMMIT
 1445

	)

453 
	#ER_MALFORMED_DEFINER
 1446

	)

454 
	#ER_VIEW_FRM_NO_USER
 1447

	)

455 
	#ER_VIEW_OTHER_USER
 1448

	)

456 
	#ER_NO_SUCH_USER
 1449

	)

457 
	#ER_FORBID_SCHEMA_CHANGE
 1450

	)

458 
	#ER_ROW_IS_REFERENCED_2
 1451

	)

459 
	#ER_NO_REFERENCED_ROW_2
 1452

	)

460 
	#ER_SP_BAD_VAR_SHADOW
 1453

	)

461 
	#ER_TRG_NO_DEFINER
 1454

	)

462 
	#ER_OLD_FILE_FORMAT
 1455

	)

463 
	#ER_SP_RECURSION_LIMIT
 1456

	)

464 
	#ER_SP_PROC_TABLE_CORRUPT
 1457

	)

465 
	#ER_SP_WRONG_NAME
 1458

	)

466 
	#ER_TABLE_NEEDS_UPGRADE
 1459

	)

467 
	#ER_SP_NO_AGGREGATE
 1460

	)

468 
	#ER_MAX_PREPARED_STMT_COUNT_REACHED
 1461

	)

469 
	#ER_VIEW_RECURSIVE
 1462

	)

470 
	#ER_NON_GROUPING_FIELD_USED
 1463

	)

471 
	#ER_TABLE_CANT_HANDLE_SPKEYS
 1464

	)

472 
	#ER_NO_TRIGGERS_ON_SYSTEM_SCHEMA
 1465

	)

473 
	#ER_REMOVED_SPACES
 1466

	)

474 
	#ER_AUTOINC_READ_FAILED
 1467

	)

475 
	#ER_USERNAME
 1468

	)

476 
	#ER_HOSTNAME
 1469

	)

477 
	#ER_WRONG_STRING_LENGTH
 1470

	)

478 
	#ER_NON_INSERTABLE_TABLE
 1471

	)

479 
	#ER_ADMIN_WRONG_MRG_TABLE
 1472

	)

480 
	#ER_TOO_HIGH_LEVEL_OF_NESTING_FOR_SELECT
 1473

	)

481 
	#ER_NAME_BECOMES_EMPTY
 1474

	)

482 
	#ER_AMBIGUOUS_FIELD_TERM
 1475

	)

483 
	#ER_FOREIGN_SERVER_EXISTS
 1476

	)

484 
	#ER_FOREIGN_SERVER_DOESNT_EXIST
 1477

	)

485 
	#ER_ILLEGAL_HA_CREATE_OPTION
 1478

	)

486 
	#ER_PARTITION_REQUIRES_VALUES_ERROR
 1479

	)

487 
	#ER_PARTITION_WRONG_VALUES_ERROR
 1480

	)

488 
	#ER_PARTITION_MAXVALUE_ERROR
 1481

	)

489 
	#ER_PARTITION_SUBPARTITION_ERROR
 1482

	)

490 
	#ER_PARTITION_SUBPART_MIX_ERROR
 1483

	)

491 
	#ER_PARTITION_WRONG_NO_PART_ERROR
 1484

	)

492 
	#ER_PARTITION_WRONG_NO_SUBPART_ERROR
 1485

	)

493 
	#ER_WRONG_EXPR_IN_PARTITION_FUNC_ERROR
 1486

	)

494 
	#ER_NO_CONST_EXPR_IN_RANGE_OR_LIST_ERROR
 1487

	)

495 
	#ER_FIELD_NOT_FOUND_PART_ERROR
 1488

	)

496 
	#ER_LIST_OF_FIELDS_ONLY_IN_HASH_ERROR
 1489

	)

497 
	#ER_INCONSISTENT_PARTITION_INFO_ERROR
 1490

	)

498 
	#ER_PARTITION_FUNC_NOT_ALLOWED_ERROR
 1491

	)

499 
	#ER_PARTITIONS_MUST_BE_DEFINED_ERROR
 1492

	)

500 
	#ER_RANGE_NOT_INCREASING_ERROR
 1493

	)

501 
	#ER_INCONSISTENT_TYPE_OF_FUNCTIONS_ERROR
 1494

	)

502 
	#ER_MULTIPLE_DEF_CONST_IN_LIST_PART_ERROR
 1495

	)

503 
	#ER_PARTITION_ENTRY_ERROR
 1496

	)

504 
	#ER_MIX_HANDLER_ERROR
 1497

	)

505 
	#ER_PARTITION_NOT_DEFINED_ERROR
 1498

	)

506 
	#ER_TOO_MANY_PARTITIONS_ERROR
 1499

	)

507 
	#ER_SUBPARTITION_ERROR
 1500

	)

508 
	#ER_CANT_CREATE_HANDLER_FILE
 1501

	)

509 
	#ER_BLOB_FIELD_IN_PART_FUNC_ERROR
 1502

	)

510 
	#ER_UNIQUE_KEY_NEED_ALL_FIELDS_IN_PF
 1503

	)

511 
	#ER_NO_PARTS_ERROR
 1504

	)

512 
	#ER_PARTITION_MGMT_ON_NONPARTITIONED
 1505

	)

513 
	#ER_FOREIGN_KEY_ON_PARTITIONED
 1506

	)

514 
	#ER_DROP_PARTITION_NON_EXISTENT
 1507

	)

515 
	#ER_DROP_LAST_PARTITION
 1508

	)

516 
	#ER_COALESCE_ONLY_ON_HASH_PARTITION
 1509

	)

517 
	#ER_REORG_HASH_ONLY_ON_SAME_NO
 1510

	)

518 
	#ER_REORG_NO_PARAM_ERROR
 1511

	)

519 
	#ER_ONLY_ON_RANGE_LIST_PARTITION
 1512

	)

520 
	#ER_ADD_PARTITION_SUBPART_ERROR
 1513

	)

521 
	#ER_ADD_PARTITION_NO_NEW_PARTITION
 1514

	)

522 
	#ER_COALESCE_PARTITION_NO_PARTITION
 1515

	)

523 
	#ER_REORG_PARTITION_NOT_EXIST
 1516

	)

524 
	#ER_SAME_NAME_PARTITION
 1517

	)

525 
	#ER_NO_BINLOG_ERROR
 1518

	)

526 
	#ER_CONSECUTIVE_REORG_PARTITIONS
 1519

	)

527 
	#ER_REORG_OUTSIDE_RANGE
 1520

	)

528 
	#ER_PARTITION_FUNCTION_FAILURE
 1521

	)

529 
	#ER_PART_STATE_ERROR
 1522

	)

530 
	#ER_LIMITED_PART_RANGE
 1523

	)

531 
	#ER_PLUGIN_IS_NOT_LOADED
 1524

	)

532 
	#ER_WRONG_VALUE
 1525

	)

533 
	#ER_NO_PARTITION_FOR_GIVEN_VALUE
 1526

	)

534 
	#ER_FILEGROUP_OPTION_ONLY_ONCE
 1527

	)

535 
	#ER_CREATE_FILEGROUP_FAILED
 1528

	)

536 
	#ER_DROP_FILEGROUP_FAILED
 1529

	)

537 
	#ER_TABLESPACE_AUTO_EXTEND_ERROR
 1530

	)

538 
	#ER_WRONG_SIZE_NUMBER
 1531

	)

539 
	#ER_SIZE_OVERFLOW_ERROR
 1532

	)

540 
	#ER_ALTER_FILEGROUP_FAILED
 1533

	)

541 
	#ER_BINLOG_ROW_LOGGING_FAILED
 1534

	)

542 
	#ER_BINLOG_ROW_WRONG_TABLE_DEF
 1535

	)

543 
	#ER_BINLOG_ROW_RBR_TO_SBR
 1536

	)

544 
	#ER_EVENT_ALREADY_EXISTS
 1537

	)

545 
	#ER_EVENT_STORE_FAILED
 1538

	)

546 
	#ER_EVENT_DOES_NOT_EXIST
 1539

	)

547 
	#ER_EVENT_CANT_ALTER
 1540

	)

548 
	#ER_EVENT_DROP_FAILED
 1541

	)

549 
	#ER_EVENT_INTERVAL_NOT_POSITIVE_OR_TOO_BIG
 1542

	)

550 
	#ER_EVENT_ENDS_BEFORE_STARTS
 1543

	)

551 
	#ER_EVENT_EXEC_TIME_IN_THE_PAST
 1544

	)

552 
	#ER_EVENT_OPEN_TABLE_FAILED
 1545

	)

553 
	#ER_EVENT_NEITHER_M_EXPR_NOR_M_AT
 1546

	)

554 
	#ER_UNUSED_2
 1547

	)

555 
	#ER_UNUSED_3
 1548

	)

556 
	#ER_EVENT_CANNOT_DELETE
 1549

	)

557 
	#ER_EVENT_COMPILE_ERROR
 1550

	)

558 
	#ER_EVENT_SAME_NAME
 1551

	)

559 
	#ER_EVENT_DATA_TOO_LONG
 1552

	)

560 
	#ER_DROP_INDEX_FK
 1553

	)

561 
	#ER_WARN_DEPRECATED_SYNTAX_WITH_VER
 1554

	)

562 
	#ER_CANT_WRITE_LOCK_LOG_TABLE
 1555

	)

563 
	#ER_CANT_LOCK_LOG_TABLE
 1556

	)

564 
	#ER_UNUSED_4
 1557

	)

565 
	#ER_COL_COUNT_DOESNT_MATCH_PLEASE_UPDATE
 1558

	)

566 
	#ER_TEMP_TABLE_PREVENTS_SWITCH_OUT_OF_RBR
 1559

	)

567 
	#ER_STORED_FUNCTION_PREVENTS_SWITCH_BINLOG_FORMAT
 1560

	)

568 
	#ER_UNUSED_13
 1561

	)

569 
	#ER_PARTITION_NO_TEMPORARY
 1562

	)

570 
	#ER_PARTITION_CONST_DOMAIN_ERROR
 1563

	)

571 
	#ER_PARTITION_FUNCTION_IS_NOT_ALLOWED
 1564

	)

572 
	#ER_DDL_LOG_ERROR
 1565

	)

573 
	#ER_NULL_IN_VALUES_LESS_THAN
 1566

	)

574 
	#ER_WRONG_PARTITION_NAME
 1567

	)

575 
	#ER_CANT_CHANGE_TX_CHARACTERISTICS
 1568

	)

576 
	#ER_DUP_ENTRY_AUTOINCREMENT_CASE
 1569

	)

577 
	#ER_EVENT_MODIFY_QUEUE_ERROR
 1570

	)

578 
	#ER_EVENT_SET_VAR_ERROR
 1571

	)

579 
	#ER_PARTITION_MERGE_ERROR
 1572

	)

580 
	#ER_CANT_ACTIVATE_LOG
 1573

	)

581 
	#ER_RBR_NOT_AVAILABLE
 1574

	)

582 
	#ER_BASE64_DECODE_ERROR
 1575

	)

583 
	#ER_EVENT_RECURSION_FORBIDDEN
 1576

	)

584 
	#ER_EVENTS_DB_ERROR
 1577

	)

585 
	#ER_ONLY_INTEGERS_ALLOWED
 1578

	)

586 
	#ER_UNSUPORTED_LOG_ENGINE
 1579

	)

587 
	#ER_BAD_LOG_STATEMENT
 1580

	)

588 
	#ER_CANT_RENAME_LOG_TABLE
 1581

	)

589 
	#ER_WRONG_PARAMCOUNT_TO_NATIVE_FCT
 1582

	)

590 
	#ER_WRONG_PARAMETERS_TO_NATIVE_FCT
 1583

	)

591 
	#ER_WRONG_PARAMETERS_TO_STORED_FCT
 1584

	)

592 
	#ER_NATIVE_FCT_NAME_COLLISION
 1585

	)

593 
	#ER_DUP_ENTRY_WITH_KEY_NAME
 1586

	)

594 
	#ER_BINLOG_PURGE_EMFILE
 1587

	)

595 
	#ER_EVENT_CANNOT_CREATE_IN_THE_PAST
 1588

	)

596 
	#ER_EVENT_CANNOT_ALTER_IN_THE_PAST
 1589

	)

597 
	#ER_SLAVE_INCIDENT
 1590

	)

598 
	#ER_NO_PARTITION_FOR_GIVEN_VALUE_SILENT
 1591

	)

599 
	#ER_BINLOG_UNSAFE_STATEMENT
 1592

	)

600 
	#ER_SLAVE_FATAL_ERROR
 1593

	)

601 
	#ER_SLAVE_RELAY_LOG_READ_FAILURE
 1594

	)

602 
	#ER_SLAVE_RELAY_LOG_WRITE_FAILURE
 1595

	)

603 
	#ER_SLAVE_CREATE_EVENT_FAILURE
 1596

	)

604 
	#ER_SLAVE_MASTER_COM_FAILURE
 1597

	)

605 
	#ER_BINLOG_LOGGING_IMPOSSIBLE
 1598

	)

606 
	#ER_VIEW_NO_CREATION_CTX
 1599

	)

607 
	#ER_VIEW_INVALID_CREATION_CTX
 1600

	)

608 
	#ER_SR_INVALID_CREATION_CTX
 1601

	)

609 
	#ER_TRG_CORRUPTED_FILE
 1602

	)

610 
	#ER_TRG_NO_CREATION_CTX
 1603

	)

611 
	#ER_TRG_INVALID_CREATION_CTX
 1604

	)

612 
	#ER_EVENT_INVALID_CREATION_CTX
 1605

	)

613 
	#ER_TRG_CANT_OPEN_TABLE
 1606

	)

614 
	#ER_CANT_CREATE_SROUTINE
 1607

	)

615 
	#ER_UNUSED_11
 1608

	)

616 
	#ER_NO_FORMAT_DESCRIPTION_EVENT_BEFORE_BINLOG_STATEMENT
 1609

	)

617 
	#ER_SLAVE_CORRUPT_EVENT
 1610

	)

618 
	#ER_LOAD_DATA_INVALID_COLUMN
 1611

	)

619 
	#ER_LOG_PURGE_NO_FILE
 1612

	)

620 
	#ER_XA_RBTIMEOUT
 1613

	)

621 
	#ER_XA_RBDEADLOCK
 1614

	)

622 
	#ER_NEED_REPREPARE
 1615

	)

623 
	#ER_DELAYED_NOT_SUPPORTED
 1616

	)

624 
	#WARN_NO_MASTER_INFO
 1617

	)

625 
	#WARN_OPTION_IGNORED
 1618

	)

626 
	#ER_PLUGIN_DELETE_BUILTIN
 1619

	)

627 
	#WARN_PLUGIN_BUSY
 1620

	)

628 
	#ER_VARIABLE_IS_READONLY
 1621

	)

629 
	#ER_WARN_ENGINE_TRANSACTION_ROLLBACK
 1622

	)

630 
	#ER_SLAVE_HEARTBEAT_FAILURE
 1623

	)

631 
	#ER_SLAVE_HEARTBEAT_VALUE_OUT_OF_RANGE
 1624

	)

632 
	#ER_UNUSED_14
 1625

	)

633 
	#ER_CONFLICT_FN_PARSE_ERROR
 1626

	)

634 
	#ER_EXCEPTIONS_WRITE_ERROR
 1627

	)

635 
	#ER_TOO_LONG_TABLE_COMMENT
 1628

	)

636 
	#ER_TOO_LONG_FIELD_COMMENT
 1629

	)

637 
	#ER_FUNC_INEXISTENT_NAME_COLLISION
 1630

	)

638 
	#ER_DATABASE_NAME
 1631

	)

639 
	#ER_TABLE_NAME
 1632

	)

640 
	#ER_PARTITION_NAME
 1633

	)

641 
	#ER_SUBPARTITION_NAME
 1634

	)

642 
	#ER_TEMPORARY_NAME
 1635

	)

643 
	#ER_RENAMED_NAME
 1636

	)

644 
	#ER_TOO_MANY_CONCURRENT_TRXS
 1637

	)

645 
	#WARN_NON_ASCII_SEPARATOR_NOT_IMPLEMENTED
 1638

	)

646 
	#ER_DEBUG_SYNC_TIMEOUT
 1639

	)

647 
	#ER_DEBUG_SYNC_HIT_LIMIT
 1640

	)

648 
	#ER_DUP_SIGNAL_SET
 1641

	)

649 
	#ER_SIGNAL_WARN
 1642

	)

650 
	#ER_SIGNAL_NOT_FOUND
 1643

	)

651 
	#ER_SIGNAL_EXCEPTION
 1644

	)

652 
	#ER_RESIGNAL_WITHOUT_ACTIVE_HANDLER
 1645

	)

653 
	#ER_SIGNAL_BAD_CONDITION_TYPE
 1646

	)

654 
	#WARN_COND_ITEM_TRUNCATED
 1647

	)

655 
	#ER_COND_ITEM_TOO_LONG
 1648

	)

656 
	#ER_UNKNOWN_LOCALE
 1649

	)

657 
	#ER_SLAVE_IGNORE_SERVER_IDS
 1650

	)

658 
	#ER_QUERY_CACHE_DISABLED
 1651

	)

659 
	#ER_SAME_NAME_PARTITION_FIELD
 1652

	)

660 
	#ER_PARTITION_COLUMN_LIST_ERROR
 1653

	)

661 
	#ER_WRONG_TYPE_COLUMN_VALUE_ERROR
 1654

	)

662 
	#ER_TOO_MANY_PARTITION_FUNC_FIELDS_ERROR
 1655

	)

663 
	#ER_MAXVALUE_IN_VALUES_IN
 1656

	)

664 
	#ER_TOO_MANY_VALUES_ERROR
 1657

	)

665 
	#ER_ROW_SINGLE_PARTITION_FIELD_ERROR
 1658

	)

666 
	#ER_FIELD_TYPE_NOT_ALLOWED_AS_PARTITION_FIELD
 1659

	)

667 
	#ER_PARTITION_FIELDS_TOO_LONG
 1660

	)

668 
	#ER_BINLOG_ROW_ENGINE_AND_STMT_ENGINE
 1661

	)

669 
	#ER_BINLOG_ROW_MODE_AND_STMT_ENGINE
 1662

	)

670 
	#ER_BINLOG_UNSAFE_AND_STMT_ENGINE
 1663

	)

671 
	#ER_BINLOG_ROW_INJECTION_AND_STMT_ENGINE
 1664

	)

672 
	#ER_BINLOG_STMT_MODE_AND_ROW_ENGINE
 1665

	)

673 
	#ER_BINLOG_ROW_INJECTION_AND_STMT_MODE
 1666

	)

674 
	#ER_BINLOG_MULTIPLE_ENGINES_AND_SELF_LOGGING_ENGINE
 1667

	)

675 
	#ER_BINLOG_UNSAFE_LIMIT
 1668

	)

676 
	#ER_BINLOG_UNSAFE_INSERT_DELAYED
 1669

	)

677 
	#ER_BINLOG_UNSAFE_SYSTEM_TABLE
 1670

	)

678 
	#ER_BINLOG_UNSAFE_AUTOINC_COLUMNS
 1671

	)

679 
	#ER_BINLOG_UNSAFE_UDF
 1672

	)

680 
	#ER_BINLOG_UNSAFE_SYSTEM_VARIABLE
 1673

	)

681 
	#ER_BINLOG_UNSAFE_SYSTEM_FUNCTION
 1674

	)

682 
	#ER_BINLOG_UNSAFE_NONTRANS_AFTER_TRANS
 1675

	)

683 
	#ER_MESSAGE_AND_STATEMENT
 1676

	)

684 
	#ER_SLAVE_CONVERSION_FAILED
 1677

	)

685 
	#ER_SLAVE_CANT_CREATE_CONVERSION
 1678

	)

686 
	#ER_INSIDE_TRANSACTION_PREVENTS_SWITCH_BINLOG_FORMAT
 1679

	)

687 
	#ER_PATH_LENGTH
 1680

	)

688 
	#ER_WARN_DEPRECATED_SYNTAX_NO_REPLACEMENT
 1681

	)

689 
	#ER_WRONG_NATIVE_TABLE_STRUCTURE
 1682

	)

690 
	#ER_WRONG_PERFSCHEMA_USAGE
 1683

	)

691 
	#ER_WARN_I_S_SKIPPED_TABLE
 1684

	)

692 
	#ER_INSIDE_TRANSACTION_PREVENTS_SWITCH_BINLOG_DIRECT
 1685

	)

693 
	#ER_STORED_FUNCTION_PREVENTS_SWITCH_BINLOG_DIRECT
 1686

	)

694 
	#ER_SPATIAL_MUST_HAVE_GEOM_COL
 1687

	)

695 
	#ER_TOO_LONG_INDEX_COMMENT
 1688

	)

696 
	#ER_LOCK_ABORTED
 1689

	)

697 
	#ER_DATA_OUT_OF_RANGE
 1690

	)

698 
	#ER_WRONG_SPVAR_TYPE_IN_LIMIT
 1691

	)

699 
	#ER_BINLOG_UNSAFE_MULTIPLE_ENGINES_AND_SELF_LOGGING_ENGINE
 1692

	)

700 
	#ER_BINLOG_UNSAFE_MIXED_STATEMENT
 1693

	)

701 
	#ER_INSIDE_TRANSACTION_PREVENTS_SWITCH_SQL_LOG_BIN
 1694

	)

702 
	#ER_STORED_FUNCTION_PREVENTS_SWITCH_SQL_LOG_BIN
 1695

	)

703 
	#ER_FAILED_READ_FROM_PAR_FILE
 1696

	)

704 
	#ER_VALUES_IS_NOT_INT_TYPE_ERROR
 1697

	)

705 
	#ER_ACCESS_DENIED_NO_PASSWORD_ERROR
 1698

	)

706 
	#ER_SET_PASSWORD_AUTH_PLUGIN
 1699

	)

707 
	#ER_GRANT_PLUGIN_USER_EXISTS
 1700

	)

708 
	#ER_TRUNCATE_ILLEGAL_FK
 1701

	)

709 
	#ER_PLUGIN_IS_PERMANENT
 1702

	)

710 
	#ER_SLAVE_HEARTBEAT_VALUE_OUT_OF_RANGE_MIN
 1703

	)

711 
	#ER_SLAVE_HEARTBEAT_VALUE_OUT_OF_RANGE_MAX
 1704

	)

712 
	#ER_STMT_CACHE_FULL
 1705

	)

713 
	#ER_MULTI_UPDATE_KEY_CONFLICT
 1706

	)

714 
	#ER_TABLE_NEEDS_REBUILD
 1707

	)

715 
	#WARN_OPTION_BELOW_LIMIT
 1708

	)

716 
	#ER_INDEX_COLUMN_TOO_LONG
 1709

	)

717 
	#ER_ERROR_IN_TRIGGER_BODY
 1710

	)

718 
	#ER_ERROR_IN_UNKNOWN_TRIGGER_BODY
 1711

	)

719 
	#ER_INDEX_CORRUPT
 1712

	)

720 
	#ER_UNDO_RECORD_TOO_BIG
 1713

	)

721 
	#ER_BINLOG_UNSAFE_INSERT_IGNORE_SELECT
 1714

	)

722 
	#ER_BINLOG_UNSAFE_INSERT_SELECT_UPDATE
 1715

	)

723 
	#ER_BINLOG_UNSAFE_REPLACE_SELECT
 1716

	)

724 
	#ER_BINLOG_UNSAFE_CREATE_IGNORE_SELECT
 1717

	)

725 
	#ER_BINLOG_UNSAFE_CREATE_REPLACE_SELECT
 1718

	)

726 
	#ER_BINLOG_UNSAFE_UPDATE_IGNORE
 1719

	)

727 
	#ER_UNUSED_15
 1720

	)

728 
	#ER_UNUSED_16
 1721

	)

729 
	#ER_BINLOG_UNSAFE_WRITE_AUTOINC_SELECT
 1722

	)

730 
	#ER_BINLOG_UNSAFE_CREATE_SELECT_AUTOINC
 1723

	)

731 
	#ER_BINLOG_UNSAFE_INSERT_TWO_KEYS
 1724

	)

732 
	#ER_TABLE_IN_FK_CHECK
 1725

	)

733 
	#ER_UNUSED_1
 1726

	)

734 
	#ER_BINLOG_UNSAFE_AUTOINC_NOT_FIRST
 1727

	)

735 
	#ER_CANNOT_LOAD_FROM_TABLE_V2
 1728

	)

736 
	#ER_MASTER_DELAY_VALUE_OUT_OF_RANGE
 1729

	)

737 
	#ER_ONLY_FD_AND_RBR_EVENTS_ALLOWED_IN_BINLOG_STATEMENT
 1730

	)

738 
	#ER_PARTITION_EXCHANGE_DIFFERENT_OPTION
 1731

	)

739 
	#ER_PARTITION_EXCHANGE_PART_TABLE
 1732

	)

740 
	#ER_PARTITION_EXCHANGE_TEMP_TABLE
 1733

	)

741 
	#ER_PARTITION_INSTEAD_OF_SUBPARTITION
 1734

	)

742 
	#ER_UNKNOWN_PARTITION
 1735

	)

743 
	#ER_TABLES_DIFFERENT_METADATA
 1736

	)

744 
	#ER_ROW_DOES_NOT_MATCH_PARTITION
 1737

	)

745 
	#ER_BINLOG_CACHE_SIZE_GREATER_THAN_MAX
 1738

	)

746 
	#ER_WARN_INDEX_NOT_APPLICABLE
 1739

	)

747 
	#ER_PARTITION_EXCHANGE_FOREIGN_KEY
 1740

	)

748 
	#ER_NO_SUCH_KEY_VALUE
 1741

	)

749 
	#ER_VALUE_TOO_LONG
 1742

	)

750 
	#ER_NETWORK_READ_EVENT_CHECKSUM_FAILURE
 1743

	)

751 
	#ER_BINLOG_READ_EVENT_CHECKSUM_FAILURE
 1744

	)

752 
	#ER_BINLOG_STMT_CACHE_SIZE_GREATER_THAN_MAX
 1745

	)

753 
	#ER_CANT_UPDATE_TABLE_IN_CREATE_TABLE_SELECT
 1746

	)

754 
	#ER_PARTITION_CLAUSE_ON_NONPARTITIONED
 1747

	)

755 
	#ER_ROW_DOES_NOT_MATCH_GIVEN_PARTITION_SET
 1748

	)

756 
	#ER_UNUSED_5
 1749

	)

757 
	#ER_CHANGE_RPL_INFO_REPOSITORY_FAILURE
 1750

	)

758 
	#ER_WARNING_NOT_COMPLETE_ROLLBACK_WITH_CREATED_TEMP_TABLE
 1751

	)

759 
	#ER_WARNING_NOT_COMPLETE_ROLLBACK_WITH_DROPPED_TEMP_TABLE
 1752

	)

760 
	#ER_MTS_FEATURE_IS_NOT_SUPPORTED
 1753

	)

761 
	#ER_MTS_UPDATED_DBS_GREATER_MAX
 1754

	)

762 
	#ER_MTS_CANT_PARALLEL
 1755

	)

763 
	#ER_MTS_INCONSISTENT_DATA
 1756

	)

764 
	#ER_FULLTEXT_NOT_SUPPORTED_WITH_PARTITIONING
 1757

	)

765 
	#ER_DA_INVALID_CONDITION_NUMBER
 1758

	)

766 
	#ER_INSECURE_PLAIN_TEXT
 1759

	)

767 
	#ER_INSECURE_CHANGE_MASTER
 1760

	)

768 
	#ER_FOREIGN_DUPLICATE_KEY_WITH_CHILD_INFO
 1761

	)

769 
	#ER_FOREIGN_DUPLICATE_KEY_WITHOUT_CHILD_INFO
 1762

	)

770 
	#ER_SQLTHREAD_WITH_SECURE_SLAVE
 1763

	)

771 
	#ER_TABLE_HAS_NO_FT
 1764

	)

772 
	#ER_VARIABLE_NOT_SETTABLE_IN_SF_OR_TRIGGER
 1765

	)

773 
	#ER_VARIABLE_NOT_SETTABLE_IN_TRANSACTION
 1766

	)

774 
	#ER_GTID_NEXT_IS_NOT_IN_GTID_NEXT_LIST
 1767

	)

775 
	#ER_CANT_CHANGE_GTID_NEXT_IN_TRANSACTION_WHEN_GTID_NEXT_LIST_IS_NULL
 1768

	)

776 
	#ER_SET_STATEMENT_CANNOT_INVOKE_FUNCTION
 1769

	)

777 
	#ER_GTID_NEXT_CANT_BE_AUTOMATIC_IF_GTID_NEXT_LIST_IS_NON_NULL
 1770

	)

778 
	#ER_SKIPPING_LOGGED_TRANSACTION
 1771

	)

779 
	#ER_MALFORMED_GTID_SET_SPECIFICATION
 1772

	)

780 
	#ER_MALFORMED_GTID_SET_ENCODING
 1773

	)

781 
	#ER_MALFORMED_GTID_SPECIFICATION
 1774

	)

782 
	#ER_GNO_EXHAUSTED
 1775

	)

783 
	#ER_BAD_SLAVE_AUTO_POSITION
 1776

	)

784 
	#ER_AUTO_POSITION_REQUIRES_GTID_MODE_ON
 1777

	)

785 
	#ER_CANT_DO_IMPLICIT_COMMIT_IN_TRX_WHEN_GTID_NEXT_IS_SET
 1778

	)

786 
	#ER_GTID_MODE_2_OR_3_REQUIRES_ENFORCE_GTID_CONSISTENCY_ON
 1779

	)

787 
	#ER_GTID_MODE_REQUIRES_BINLOG
 1780

	)

788 
	#ER_CANT_SET_GTID_NEXT_TO_GTID_WHEN_GTID_MODE_IS_OFF
 1781

	)

789 
	#ER_CANT_SET_GTID_NEXT_TO_ANONYMOUS_WHEN_GTID_MODE_IS_ON
 1782

	)

790 
	#ER_CANT_SET_GTID_NEXT_LIST_TO_NON_NULL_WHEN_GTID_MODE_IS_OFF
 1783

	)

791 
	#ER_FOUND_GTID_EVENT_WHEN_GTID_MODE_IS_OFF
 1784

	)

792 
	#ER_GTID_UNSAFE_NON_TRANSACTIONAL_TABLE
 1785

	)

793 
	#ER_GTID_UNSAFE_CREATE_SELECT
 1786

	)

794 
	#ER_GTID_UNSAFE_CREATE_DROP_TEMPORARY_TABLE_IN_TRANSACTION
 1787

	)

795 
	#ER_GTID_MODE_CAN_ONLY_CHANGE_ONE_STEP_AT_A_TIME
 1788

	)

796 
	#ER_MASTER_HAS_PURGED_REQUIRED_GTIDS
 1789

	)

797 
	#ER_CANT_SET_GTID_NEXT_WHEN_OWNING_GTID
 1790

	)

798 
	#ER_UNKNOWN_EXPLAIN_FORMAT
 1791

	)

799 
	#ER_CANT_EXECUTE_IN_READ_ONLY_TRANSACTION
 1792

	)

800 
	#ER_TOO_LONG_TABLE_PARTITION_COMMENT
 1793

	)

801 
	#ER_SLAVE_CONFIGURATION
 1794

	)

802 
	#ER_INNODB_FT_LIMIT
 1795

	)

803 
	#ER_INNODB_NO_FT_TEMP_TABLE
 1796

	)

804 
	#ER_INNODB_FT_WRONG_DOCID_COLUMN
 1797

	)

805 
	#ER_INNODB_FT_WRONG_DOCID_INDEX
 1798

	)

806 
	#ER_INNODB_ONLINE_LOG_TOO_BIG
 1799

	)

807 
	#ER_UNKNOWN_ALTER_ALGORITHM
 1800

	)

808 
	#ER_UNKNOWN_ALTER_LOCK
 1801

	)

809 
	#ER_MTS_CHANGE_MASTER_CANT_RUN_WITH_GAPS
 1802

	)

810 
	#ER_MTS_RECOVERY_FAILURE
 1803

	)

811 
	#ER_MTS_RESET_WORKERS
 1804

	)

812 
	#ER_COL_COUNT_DOESNT_MATCH_CORRUPTED_V2
 1805

	)

813 
	#ER_SLAVE_SILENT_RETRY_TRANSACTION
 1806

	)

814 
	#ER_DISCARD_FK_CHECKS_RUNNING
 1807

	)

815 
	#ER_TABLE_SCHEMA_MISMATCH
 1808

	)

816 
	#ER_TABLE_IN_SYSTEM_TABLESPACE
 1809

	)

817 
	#ER_IO_READ_ERROR
 1810

	)

818 
	#ER_IO_WRITE_ERROR
 1811

	)

819 
	#ER_TABLESPACE_MISSING
 1812

	)

820 
	#ER_TABLESPACE_EXISTS
 1813

	)

821 
	#ER_TABLESPACE_DISCARDED
 1814

	)

822 
	#ER_INTERNAL_ERROR
 1815

	)

823 
	#ER_INNODB_IMPORT_ERROR
 1816

	)

824 
	#ER_INNODB_INDEX_CORRUPT
 1817

	)

825 
	#ER_INVALID_YEAR_COLUMN_LENGTH
 1818

	)

826 
	#ER_NOT_VALID_PASSWORD
 1819

	)

827 
	#ER_MUST_CHANGE_PASSWORD
 1820

	)

828 
	#ER_FK_NO_INDEX_CHILD
 1821

	)

829 
	#ER_FK_NO_INDEX_PARENT
 1822

	)

830 
	#ER_FK_FAIL_ADD_SYSTEM
 1823

	)

831 
	#ER_FK_CANNOT_OPEN_PARENT
 1824

	)

832 
	#ER_FK_INCORRECT_OPTION
 1825

	)

833 
	#ER_DUP_CONSTRAINT_NAME
 1826

	)

834 
	#ER_PASSWORD_FORMAT
 1827

	)

835 
	#ER_FK_COLUMN_CANNOT_DROP
 1828

	)

836 
	#ER_FK_COLUMN_CANNOT_DROP_CHILD
 1829

	)

837 
	#ER_FK_COLUMN_NOT_NULL
 1830

	)

838 
	#ER_DUP_INDEX
 1831

	)

839 
	#ER_FK_COLUMN_CANNOT_CHANGE
 1832

	)

840 
	#ER_FK_COLUMN_CANNOT_CHANGE_CHILD
 1833

	)

841 
	#ER_FK_CANNOT_DELETE_PARENT
 1834

	)

842 
	#ER_MALFORMED_PACKET
 1835

	)

843 
	#ER_READ_ONLY_MODE
 1836

	)

844 
	#ER_GTID_NEXT_TYPE_UNDEFINED_GROUP
 1837

	)

845 
	#ER_VARIABLE_NOT_SETTABLE_IN_SP
 1838

	)

846 
	#ER_CANT_SET_GTID_PURGED_WHEN_GTID_MODE_IS_OFF
 1839

	)

847 
	#ER_CANT_SET_GTID_PURGED_WHEN_GTID_EXECUTED_IS_NOT_EMPTY
 1840

	)

848 
	#ER_CANT_SET_GTID_PURGED_WHEN_OWNED_GTIDS_IS_NOT_EMPTY
 1841

	)

849 
	#ER_GTID_PURGED_WAS_CHANGED
 1842

	)

850 
	#ER_GTID_EXECUTED_WAS_CHANGED
 1843

	)

851 
	#ER_BINLOG_STMT_MODE_AND_NO_REPL_TABLES
 1844

	)

852 
	#ER_ALTER_OPERATION_NOT_SUPPORTED
 1845

	)

853 
	#ER_ALTER_OPERATION_NOT_SUPPORTED_REASON
 1846

	)

854 
	#ER_ALTER_OPERATION_NOT_SUPPORTED_REASON_COPY
 1847

	)

855 
	#ER_ALTER_OPERATION_NOT_SUPPORTED_REASON_PARTITION
 1848

	)

856 
	#ER_ALTER_OPERATION_NOT_SUPPORTED_REASON_FK_RENAME
 1849

	)

857 
	#ER_ALTER_OPERATION_NOT_SUPPORTED_REASON_COLUMN_TYPE
 1850

	)

858 
	#ER_ALTER_OPERATION_NOT_SUPPORTED_REASON_FK_CHECK
 1851

	)

859 
	#ER_ALTER_OPERATION_NOT_SUPPORTED_REASON_IGNORE
 1852

	)

860 
	#ER_ALTER_OPERATION_NOT_SUPPORTED_REASON_NOPK
 1853

	)

861 
	#ER_ALTER_OPERATION_NOT_SUPPORTED_REASON_AUTOINC
 1854

	)

862 
	#ER_ALTER_OPERATION_NOT_SUPPORTED_REASON_HIDDEN_FTS
 1855

	)

863 
	#ER_ALTER_OPERATION_NOT_SUPPORTED_REASON_CHANGE_FTS
 1856

	)

864 
	#ER_ALTER_OPERATION_NOT_SUPPORTED_REASON_FTS
 1857

	)

865 
	#ER_SQL_SLAVE_SKIP_COUNTER_NOT_SETTABLE_IN_GTID_MODE
 1858

	)

866 
	#ER_DUP_UNKNOWN_IN_INDEX
 1859

	)

867 
	#ER_IDENT_CAUSES_TOO_LONG_PATH
 1860

	)

868 
	#ER_ALTER_OPERATION_NOT_SUPPORTED_REASON_NOT_NULL
 1861

	)

869 
	#ER_MUST_CHANGE_PASSWORD_LOGIN
 1862

	)

870 
	#ER_ROW_IN_WRONG_PARTITION
 1863

	)

871 
	#ER_MTS_EVENT_BIGGER_PENDING_JOBS_SIZE_MAX
 1864

	)

872 
	#ER_INNODB_NO_FT_USES_PARSER
 1865

	)

873 
	#ER_BINLOG_LOGICAL_CORRUPTION
 1866

	)

874 
	#ER_WARN_PURGE_LOG_IN_USE
 1867

	)

875 
	#ER_WARN_PURGE_LOG_IS_ACTIVE
 1868

	)

876 
	#ER_AUTO_INCREMENT_CONFLICT
 1869

	)

877 
	#WARN_ON_BLOCKHOLE_IN_RBR
 1870

	)

878 
	#ER_SLAVE_MI_INIT_REPOSITORY
 1871

	)

879 
	#ER_SLAVE_RLI_INIT_REPOSITORY
 1872

	)

880 
	#ER_ACCESS_DENIED_CHANGE_USER_ERROR
 1873

	)

881 
	#ER_INNODB_READ_ONLY
 1874

	)

882 
	#ER_STOP_SLAVE_SQL_THREAD_TIMEOUT
 1875

	)

883 
	#ER_STOP_SLAVE_IO_THREAD_TIMEOUT
 1876

	)

884 
	#ER_TABLE_CORRUPT
 1877

	)

885 
	#ER_TEMP_FILE_WRITE_FAILURE
 1878

	)

886 
	#ER_INNODB_FT_AUX_NOT_HEX_ID
 1879

	)

887 
	#ER_LAST_MYSQL_ERROR_MESSAGE
 1880

	)

888 
	#ER_ERROR_LAST_SECTION_1
 1880

	)

892 
	#ER_ERROR_FIRST_SECTION_2
 1900

	)

893 
	#ER_UNUSED_18
 1900

	)

894 
	#ER_GENERATED_COLUMN_FUNCTION_IS_NOT_ALLOWED
 1901

	)

895 
	#ER_UNUSED_19
 1902

	)

896 
	#ER_PRIMARY_KEY_BASED_ON_GENERATED_COLUMN
 1903

	)

897 
	#ER_KEY_BASED_ON_GENERATED_VIRTUAL_COLUMN
 1904

	)

898 
	#ER_WRONG_FK_OPTION_FOR_GENERATED_COLUMN
 1905

	)

899 
	#ER_WARNING_NON_DEFAULT_VALUE_FOR_GENERATED_COLUMN
 1906

	)

900 
	#ER_UNSUPPORTED_ACTION_ON_GENERATED_COLUMN
 1907

	)

901 
	#ER_UNUSED_20
 1908

	)

902 
	#ER_UNUSED_21
 1909

	)

903 
	#ER_UNSUPPORTED_ENGINE_FOR_GENERATED_COLUMNS
 1910

	)

904 
	#ER_UNKNOWN_OPTION
 1911

	)

905 
	#ER_BAD_OPTION_VALUE
 1912

	)

906 
	#ER_UNUSED_6
 1913

	)

907 
	#ER_UNUSED_7
 1914

	)

908 
	#ER_UNUSED_8
 1915

	)

909 
	#ER_DATA_OVERFLOW
 1916

	)

910 
	#ER_DATA_TRUNCATED
 1917

	)

911 
	#ER_BAD_DATA
 1918

	)

912 
	#ER_DYN_COL_WRONG_FORMAT
 1919

	)

913 
	#ER_DYN_COL_IMPLEMENTATION_LIMIT
 1920

	)

914 
	#ER_DYN_COL_DATA
 1921

	)

915 
	#ER_DYN_COL_WRONG_CHARSET
 1922

	)

916 
	#ER_ILLEGAL_SUBQUERY_OPTIMIZER_SWITCHES
 1923

	)

917 
	#ER_QUERY_CACHE_IS_DISABLED
 1924

	)

918 
	#ER_QUERY_CACHE_IS_GLOBALY_DISABLED
 1925

	)

919 
	#ER_VIEW_ORDERBY_IGNORED
 1926

	)

920 
	#ER_CONNECTION_KILLED
 1927

	)

921 
	#ER_UNUSED_12
 1928

	)

922 
	#ER_INSIDE_TRANSACTION_PREVENTS_SWITCH_SKIP_REPLICATION
 1929

	)

923 
	#ER_STORED_FUNCTION_PREVENTS_SWITCH_SKIP_REPLICATION
 1930

	)

924 
	#ER_QUERY_EXCEEDED_ROWS_EXAMINED_LIMIT
 1931

	)

925 
	#ER_NO_SUCH_TABLE_IN_ENGINE
 1932

	)

926 
	#ER_TARGET_NOT_EXPLAINABLE
 1933

	)

927 
	#ER_CONNECTION_ALREADY_EXISTS
 1934

	)

928 
	#ER_MASTER_LOG_PREFIX
 1935

	)

929 
	#ER_CANT_START_STOP_SLAVE
 1936

	)

930 
	#ER_SLAVE_STARTED
 1937

	)

931 
	#ER_SLAVE_STOPPED
 1938

	)

932 
	#ER_SQL_DISCOVER_ERROR
 1939

	)

933 
	#ER_FAILED_GTID_STATE_INIT
 1940

	)

934 
	#ER_INCORRECT_GTID_STATE
 1941

	)

935 
	#ER_CANNOT_UPDATE_GTID_STATE
 1942

	)

936 
	#ER_DUPLICATE_GTID_DOMAIN
 1943

	)

937 
	#ER_GTID_OPEN_TABLE_FAILED
 1944

	)

938 
	#ER_GTID_POSITION_NOT_FOUND_IN_BINLOG
 1945

	)

939 
	#ER_CANNOT_LOAD_SLAVE_GTID_STATE
 1946

	)

940 
	#ER_MASTER_GTID_POS_CONFLICTS_WITH_BINLOG
 1947

	)

941 
	#ER_MASTER_GTID_POS_MISSING_DOMAIN
 1948

	)

942 
	#ER_UNTIL_REQUIRES_USING_GTID
 1949

	)

943 
	#ER_GTID_STRICT_OUT_OF_ORDER
 1950

	)

944 
	#ER_GTID_START_FROM_BINLOG_HOLE
 1951

	)

945 
	#ER_SLAVE_UNEXPECTED_MASTER_SWITCH
 1952

	)

946 
	#ER_INSIDE_TRANSACTION_PREVENTS_SWITCH_GTID_DOMAIN_ID_SEQ_NO
 1953

	)

947 
	#ER_STORED_FUNCTION_PREVENTS_SWITCH_GTID_DOMAIN_ID_SEQ_NO
 1954

	)

948 
	#ER_GTID_POSITION_NOT_FOUND_IN_BINLOG2
 1955

	)

949 
	#ER_BINLOG_MUST_BE_EMPTY
 1956

	)

950 
	#ER_NO_SUCH_QUERY
 1957

	)

951 
	#ER_BAD_BASE64_DATA
 1958

	)

952 
	#ER_INVALID_ROLE
 1959

	)

953 
	#ER_INVALID_CURRENT_USER
 1960

	)

954 
	#ER_CANNOT_GRANT_ROLE
 1961

	)

955 
	#ER_CANNOT_REVOKE_ROLE
 1962

	)

956 
	#ER_CHANGE_SLAVE_PARALLEL_THREADS_ACTIVE
 1963

	)

957 
	#ER_PRIOR_COMMIT_FAILED
 1964

	)

958 
	#ER_IT_IS_A_VIEW
 1965

	)

959 
	#ER_SLAVE_SKIP_NOT_IN_GTID
 1966

	)

960 
	#ER_TABLE_DEFINITION_TOO_BIG
 1967

	)

961 
	#ER_PLUGIN_INSTALLED
 1968

	)

962 
	#ER_STATEMENT_TIMEOUT
 1969

	)

963 
	#ER_SUBQUERIES_NOT_SUPPORTED
 1970

	)

964 
	#ER_SET_STATEMENT_NOT_SUPPORTED
 1971

	)

965 
	#ER_UNUSED_17
 1972

	)

966 
	#ER_USER_CREATE_EXISTS
 1973

	)

967 
	#ER_USER_DROP_EXISTS
 1974

	)

968 
	#ER_ROLE_CREATE_EXISTS
 1975

	)

969 
	#ER_ROLE_DROP_EXISTS
 1976

	)

970 
	#ER_CANNOT_CONVERT_CHARACTER
 1977

	)

971 
	#ER_INVALID_DEFAULT_VALUE_FOR_FIELD
 1978

	)

972 
	#ER_KILL_QUERY_DENIED_ERROR
 1979

	)

973 
	#ER_NO_EIS_FOR_FIELD
 1980

	)

974 
	#ER_WARN_AGGFUNC_DEPENDENCE
 1981

	)

975 
	#ER_ERROR_LAST_SECTION_2
 1981

	)

979 
	#ER_ERROR_FIRST_SECTION_3
 2000

	)

980 
	#ER_ERROR_LAST_SECTION_3
 2000

	)

984 
	#ER_ERROR_FIRST_SECTION_4
 3000

	)

985 
	#ER_FILE_CORRUPT
 3000

	)

986 
	#ER_ERROR_ON_MASTER
 3001

	)

987 
	#ER_INCONSISTENT_ERROR
 3002

	)

988 
	#ER_STORAGE_ENGINE_NOT_LOADED
 3003

	)

989 
	#ER_GET_STACKED_DA_WITHOUT_ACTIVE_HANDLER
 3004

	)

990 
	#ER_WARN_LEGACY_SYNTAX_CONVERTED
 3005

	)

991 
	#ER_BINLOG_UNSAFE_FULLTEXT_PLUGIN
 3006

	)

992 
	#ER_CANNOT_DISCARD_TEMPORARY_TABLE
 3007

	)

993 
	#ER_FK_DEPTH_EXCEEDED
 3008

	)

994 
	#ER_COL_COUNT_DOESNT_MATCH_PLEASE_UPDATE_V2
 3009

	)

995 
	#ER_WARN_TRIGGER_DOESNT_HAVE_CREATED
 3010

	)

996 
	#ER_REFERENCED_TRG_DOES_NOT_EXIST_MYSQL
 3011

	)

997 
	#ER_EXPLAIN_NOT_SUPPORTED
 3012

	)

998 
	#ER_INVALID_FIELD_SIZE
 3013

	)

999 
	#ER_MISSING_HA_CREATE_OPTION
 3014

	)

1000 
	#ER_ENGINE_OUT_OF_MEMORY
 3015

	)

1001 
	#ER_PASSWORD_EXPIRE_ANONYMOUS_USER
 3016

	)

1002 
	#ER_SLAVE_SQL_THREAD_MUST_STOP
 3017

	)

1003 
	#ER_NO_FT_MATERIALIZED_SUBQUERY
 3018

	)

1004 
	#ER_INNODB_UNDO_LOG_FULL
 3019

	)

1005 
	#ER_INVALID_ARGUMENT_FOR_LOGARITHM
 3020

	)

1006 
	#ER_SLAVE_CHANNEL_IO_THREAD_MUST_STOP
 3021

	)

1007 
	#ER_WARN_OPEN_TEMP_TABLES_MUST_BE_ZERO
 3022

	)

1008 
	#ER_WARN_ONLY_MASTER_LOG_FILE_NO_POS
 3023

	)

1009 
	#ER_QUERY_TIMEOUT
 3024

	)

1010 
	#ER_NON_RO_SELECT_DISABLE_TIMER
 3025

	)

1011 
	#ER_DUP_LIST_ENTRY
 3026

	)

1012 
	#ER_SQL_MODE_NO_EFFECT
 3027

	)

1013 
	#ER_AGGREGATE_ORDER_FOR_UNION
 3028

	)

1014 
	#ER_AGGREGATE_ORDER_NON_AGG_QUERY
 3029

	)

1015 
	#ER_SLAVE_WORKER_STOPPED_PREVIOUS_THD_ERROR
 3030

	)

1016 
	#ER_DONT_SUPPORT_SLAVE_PRESERVE_COMMIT_ORDER
 3031

	)

1017 
	#ER_SERVER_OFFLINE_MODE
 3032

	)

1018 
	#ER_GIS_DIFFERENT_SRIDS
 3033

	)

1019 
	#ER_GIS_UNSUPPORTED_ARGUMENT
 3034

	)

1020 
	#ER_GIS_UNKNOWN_ERROR
 3035

	)

1021 
	#ER_GIS_UNKNOWN_EXCEPTION
 3036

	)

1022 
	#ER_GIS_INVALID_DATA
 3037

	)

1023 
	#ER_BOOST_GEOMETRY_EMPTY_INPUT_EXCEPTION
 3038

	)

1024 
	#ER_BOOST_GEOMETRY_CENTROID_EXCEPTION
 3039

	)

1025 
	#ER_BOOST_GEOMETRY_OVERLAY_INVALID_INPUT_EXCEPTION
 3040

	)

1026 
	#ER_BOOST_GEOMETRY_TURN_INFO_EXCEPTION
 3041

	)

1027 
	#ER_BOOST_GEOMETRY_SELF_INTERSECTION_POINT_EXCEPTION
 3042

	)

1028 
	#ER_BOOST_GEOMETRY_UNKNOWN_EXCEPTION
 3043

	)

1029 
	#ER_STD_BAD_ALLOC_ERROR
 3044

	)

1030 
	#ER_STD_DOMAIN_ERROR
 3045

	)

1031 
	#ER_STD_LENGTH_ERROR
 3046

	)

1032 
	#ER_STD_INVALID_ARGUMENT
 3047

	)

1033 
	#ER_STD_OUT_OF_RANGE_ERROR
 3048

	)

1034 
	#ER_STD_OVERFLOW_ERROR
 3049

	)

1035 
	#ER_STD_RANGE_ERROR
 3050

	)

1036 
	#ER_STD_UNDERFLOW_ERROR
 3051

	)

1037 
	#ER_STD_LOGIC_ERROR
 3052

	)

1038 
	#ER_STD_RUNTIME_ERROR
 3053

	)

1039 
	#ER_STD_UNKNOWN_EXCEPTION
 3054

	)

1040 
	#ER_GIS_DATA_WRONG_ENDIANESS
 3055

	)

1041 
	#ER_CHANGE_MASTER_PASSWORD_LENGTH
 3056

	)

1042 
	#ER_USER_LOCK_WRONG_NAME
 3057

	)

1043 
	#ER_USER_LOCK_DEADLOCK
 3058

	)

1044 
	#ER_REPLACE_INACCESSIBLE_ROWS
 3059

	)

1045 
	#ER_ALTER_OPERATION_NOT_SUPPORTED_REASON_GIS
 3060

	)

1046 
	#ER_ERROR_LAST_SECTION_4
 3060

	)

1050 
	#ER_ERROR_FIRST_SECTION_5
 4000

	)

1051 
	#ER_COMMULTI_BADCONTEXT
 4000

	)

1052 
	#ER_BAD_COMMAND_IN_MULTI
 4001

	)

1053 
	#ER_WITH_COL_WRONG_LIST
 4002

	)

1054 
	#ER_TOO_MANY_DEFINITIONS_IN_WITH_CLAUSE
 4003

	)

1055 
	#ER_DUP_QUERY_NAME
 4004

	)

1056 
	#ER_RECURSIVE_WITHOUT_ANCHORS
 4005

	)

1057 
	#ER_UNACCEPTABLE_MUTUAL_RECURSION
 4006

	)

1058 
	#ER_REF_TO_RECURSIVE_WITH_TABLE_IN_DERIVED
 4007

	)

1059 
	#ER_NOT_STANDARD_COMPLIANT_RECURSIVE
 4008

	)

1060 
	#ER_WRONG_WINDOW_SPEC_NAME
 4009

	)

1061 
	#ER_DUP_WINDOW_NAME
 4010

	)

1062 
	#ER_PARTITION_LIST_IN_REFERENCING_WINDOW_SPEC
 4011

	)

1063 
	#ER_ORDER_LIST_IN_REFERENCING_WINDOW_SPEC
 4012

	)

1064 
	#ER_WINDOW_FRAME_IN_REFERENCED_WINDOW_SPEC
 4013

	)

1065 
	#ER_BAD_COMBINATION_OF_WINDOW_FRAME_BOUND_SPECS
 4014

	)

1066 
	#ER_WRONG_PLACEMENT_OF_WINDOW_FUNCTION
 4015

	)

1067 
	#ER_WINDOW_FUNCTION_IN_WINDOW_SPEC
 4016

	)

1068 
	#ER_NOT_ALLOWED_WINDOW_FRAME
 4017

	)

1069 
	#ER_NO_ORDER_LIST_IN_WINDOW_SPEC
 4018

	)

1070 
	#ER_RANGE_FRAME_NEEDS_SIMPLE_ORDERBY
 4019

	)

1071 
	#ER_WRONG_TYPE_FOR_ROWS_FRAME
 4020

	)

1072 
	#ER_WRONG_TYPE_FOR_RANGE_FRAME
 4021

	)

1073 
	#ER_FRAME_EXCLUSION_NOT_SUPPORTED
 4022

	)

1074 
	#ER_WINDOW_FUNCTION_DONT_HAVE_FRAME
 4023

	)

1075 
	#ER_INVALID_NTILE_ARGUMENT
 4024

	)

1076 
	#ER_CONSTRAINT_FAILED
 4025

	)

1077 
	#ER_EXPRESSION_IS_TOO_BIG
 4026

	)

1078 
	#ER_ERROR_EVALUATING_EXPRESSION
 4027

	)

1079 
	#ER_CALCULATING_DEFAULT_VALUE
 4028

	)

1080 
	#ER_EXPRESSION_REFERS_TO_UNINIT_FIELD
 4029

	)

1081 
	#ER_PARTITION_DEFAULT_ERROR
 4030

	)

1082 
	#ER_REFERENCED_TRG_DOES_NOT_EXIST
 4031

	)

1083 
	#ER_INVALID_DEFAULT_PARAM
 4032

	)

1084 
	#ER_BINLOG_NON_SUPPORTED_BULK
 4033

	)

1085 
	#ER_BINLOG_UNCOMPRESS_ERROR
 4034

	)

1086 
	#ER_JSON_BAD_CHR
 4035

	)

1087 
	#ER_JSON_NOT_JSON_CHR
 4036

	)

1088 
	#ER_JSON_EOS
 4037

	)

1089 
	#ER_JSON_SYNTAX
 4038

	)

1090 
	#ER_JSON_ESCAPING
 4039

	)

1091 
	#ER_JSON_DEPTH
 4040

	)

1092 
	#ER_JSON_PATH_EOS
 4041

	)

1093 
	#ER_JSON_PATH_SYNTAX
 4042

	)

1094 
	#ER_JSON_PATH_DEPTH
 4043

	)

1095 
	#ER_JSON_PATH_NO_WILDCARD
 4044

	)

1096 
	#ER_JSON_PATH_ARRAY
 4045

	)

1097 
	#ER_JSON_ONE_OR_ALL
 4046

	)

1098 
	#ER_UNSUPPORT_COMPRESSED_TEMPORARY_TABLE
 4047

	)

1099 
	#ER_GEOJSON_INCORRECT
 4048

	)

1100 
	#ER_GEOJSON_TOO_FEW_POINTS
 4049

	)

1101 
	#ER_GEOJSON_NOT_CLOSED
 4050

	)

1102 
	#ER_JSON_PATH_EMPTY
 4051

	)

1103 
	#ER_SLAVE_SAME_ID
 4052

	)

1104 
	#ER_FLASHBACK_NOT_SUPPORTED
 4053

	)

1105 
	#ER_KEYS_OUT_OF_ORDER
 4054

	)

1106 
	#ER_OVERLAPPING_KEYS
 4055

	)

1107 
	#ER_REQUIRE_ROW_BINLOG_FORMAT
 4056

	)

1108 
	#ER_ISOLATION_MODE_NOT_SUPPORTED
 4057

	)

1109 
	#ER_ON_DUPLICATE_DISABLED
 4058

	)

1110 
	#ER_UPDATES_WITH_CONSISTENT_SNAPSHOT
 4059

	)

1111 
	#ER_ROLLBACK_ONLY
 4060

	)

1112 
	#ER_ROLLBACK_TO_SAVEPOINT
 4061

	)

1113 
	#ER_ISOLATION_LEVEL_WITH_CONSISTENT_SNAPSHOT
 4062

	)

1114 
	#ER_UNSUPPORTED_COLLATION
 4063

	)

1115 
	#ER_METADATA_INCONSISTENCY
 4064

	)

1116 
	#ER_KEY_CREATE_DURING_ALTER
 4065

	)

1117 
	#ER_SK_POPULATE_DURING_ALTER
 4066

	)

1118 
	#ER_CF_DIFFERENT
 4067

	)

1119 
	#ER_RDB_STATUS_GENERAL
 4068

	)

1120 
	#ER_RDB_STATUS_MSG
 4069

	)

1121 
	#ER_NET_OK_PACKET_TOO_LARGE
 4070

	)

1122 
	#ER_RDB_TTL_UNSUPPORTED
 4071

	)

1123 
	#ER_RDB_TTL_COL_FORMAT
 4072

	)

1124 
	#ER_RDB_TTL_DURATION_FORMAT
 4073

	)

1125 
	#ER_PER_INDEX_CF_DEPRECATED
 4074

	)

1126 
	#ER_ERROR_LAST
 4074

	)

	@libmariadb/bmove_upp.c

27 
	~<ma_glob®.h
>

28 
	~"ma_¡ršg.h
"

30 
	$ma_bmove_uµ
(*
d¡
, cÚ¡ *
¤c
, 
size_t
 
Ën
)

32 
Ën
-- !ð0è*--
d¡
 = *--
¤c
;

33 
	}
}

	@libmariadb/get_password.c

19 
	~<ma_glob®.h
>

20 
	~<ma_sys.h
>

21 
	~"mysql.h
"

22 
	~<ma_¡ršg.h
>

23 
	~<m¬Ÿdb_ùy³.h
>

24 
	~<¡dio.h
>

25 
	~<memÜy.h
>

27 #iâdeà
_WIN32


28 
	~<‹rmios.h
>

30 
	~<cÚio.h
>

46 #ifdeà
_WIN32


47 *
	$g‘_·sswÜd
(
HANDLE
 
Hdl
, *
bufãr
, 
DWORD
 
Ëngth
)

49 *
	$g‘_·sswÜd
(
FILE
 *
fže
, *
bufãr
, 
Ëngth
)

52 
šCh¬
;

53 
Ch¬sProûs£d
= 1;

54 #ifdeà
_WIN32


55 
DWORD
 
Off£t
= 0;

57 
Off£t
= 0;

59 
	`mem£t
(
bufãr
, 0, 
Ëngth
);

63 #ifdeà
_WIN32


64 ià(!
	`R—dCÚsÞe
(
Hdl
, &
šCh¬
, 1, (
DWORD
 *)&
Ch¬sProûs£d
, 
NULL
) ||

65 !
Ch¬sProûs£d
)

68 
šCh¬
ð()
	`fg‘c
(
fže
);

71 
šCh¬
) {

73 ià(
Off£t
)

76 
Off£t
--;

77 
bufãr
[
Off£t
]= 0;

78 #ifdeà
_WIN32


79 
	`_ýuts
("\b \b");

87 
bufãr
[
Off£t
]ð
šCh¬
;

88 ià(
Off£t
 < 
Ëngth
 - 2)

89 
Off£t
++;

90 #ifdeà
_WIN32


91 
	`_ýuts
("*");

95 } 
Ch¬sProûs£d
 && 
šCh¬
 != '\n' && inChar != '\r');

96  
bufãr
;

97 
	}
}

116 * 
	$g‘_‰y_·sswÜd
(*
´om±
, *
bufãr
, 
Ëngth
)

118 #ifdeà
_WIN32


119 
DWORD
 
SaveS‹
;

120 
HANDLE
 
Hdl
;

122 ià(
´om±
)

123 
	`årštf
(
¡d”r
, "%s", 
´om±
);

125 ià(!(
Hdl
ð
	`C»©eFže
("CONIN$",

126 
GENERIC_READ
 | 
GENERIC_WRITE
,

127 
FILE_SHARE_READ
,

128 
NULL
,

129 
OPEN_EXISTING
, 0, 
NULL
)))

132  
bufãr
;

136 
	`G‘CÚsÞeMode
(
Hdl
, &
SaveS‹
);

137 
	`S‘CÚsÞeMode
(
Hdl
, 
ENABLE_PROCESSED_INPUT
);

139 
bufãr
ð
	`g‘_·sswÜd
(
Hdl
, bufãr, 
Ëngth
);

140 
	`S‘CÚsÞeMode
(
Hdl
, 
SaveS‹
);

141 
	`Clo£HªdË
(
Hdl
);

142  
bufãr
;

144 
‹rmios
 
‹rm_Þd
,

145 
‹rm_Ãw
;

146 
FILE
 *
»adäom
;

148 ià(
´om±
 && 
	`i§‰y
(
	`fž’o
(
¡d”r
)))

149 
	`åuts
(
´om±
, 
¡d”r
);

151 ià(!(
»adäom
ð
	`fÝ’
("/dev/tty", "r")))

152 
»adäom
ð
¡dš
;

155 
	`tcg‘©Œ
(
	`fž’o
(
»adäom
), &
‹rm_Þd
);

156 
‹rm_Ãw
ð
‹rm_Þd
;

157 
‹rm_Ãw
.
c_cc
[
VMIN
] = 1;

158 
‹rm_Ãw
.
c_cc
[
VTIME
]= 0;

159 
‹rm_Ãw
.
c_læag
&ð~(
ECHO
 | 
ISIG
 | 
ICANON
 | 
ECHONL
);

160 
	`tc£‰r
(
	`fž’o
(
»adäom
), 
TCSADRAIN
, &
‹rm_Ãw
);

162 
bufãr
ð
	`g‘_·sswÜd
(
»adäom
, bufãr, 
Ëngth
);

164 ià(
	`i§‰y
(
	`fž’o
(
»adäom
)))

165 
	`tc£‰r
(
	`fž’o
(
»adäom
), 
TCSADRAIN
, &
‹rm_Þd
);

167 
	`fþo£
(
»adäom
);

169  
bufãr
;

171 
	}
}

	@libmariadb/ma_alloc.c

20 
	~<ma_glob®.h
>

21 
	~<ma_sys.h
>

22 
	~<ma_¡ršg.h
>

24 
	$ma_š™_®loc_roÙ
(
MA_MEM_ROOT
 *
mem_roÙ
, 
size_t
 
block_size
, size_ˆ
´e_®loc_size
)

26 
mem_roÙ
->
ä“
ðmem_roÙ->
u£d
ðmem_roÙ->
´e_®loc
= 0;

27 
mem_roÙ
->
mš_m®loc
=32;

28 
mem_roÙ
->
block_size
ð(block_size-
MALLOC_OVERHEAD
-(
MA_USED_MEM
)+8);

29 
mem_roÙ
->
”rÜ_hªdËr
=0;

30 
mem_roÙ
->
block_num
= 4;

31 
mem_roÙ
->
fœ¡_block_u§ge
= 0;

32 #ià!(
	`defšed
(
HAVE_purify
è&& defšed(
EXTRA_DEBUG
))

33 ià(
´e_®loc_size
)

35 ià((
mem_roÙ
->
ä“
 = mem_roÙ->
´e_®loc
=

36 (
MA_USED_MEM
*è
	`m®loc
(
´e_®loc_size
+ 
	`ALIGN_SIZE
((MA_USED_MEM)))))

38 
mem_roÙ
->
ä“
->
size
=
´e_®loc_size
+
	`ALIGN_SIZE
((
MA_USED_MEM
));

39 
mem_roÙ
->
ä“
->
Ëá
=
´e_®loc_size
;

40 
mem_roÙ
->
ä“
->
Ãxt
=0;

44 
	}
}

46 * 
	$ma_®loc_roÙ
(
MA_MEM_ROOT
 *
mem_roÙ
, 
size_t
 
Size
)

48 #ià
	`defšed
(
HAVE_purify
è&& defšed(
EXTRA_DEBUG
)

49 
»g1
 
MA_USED_MEM
 *
Ãxt
;

50 
Size
+=
	`ALIGN_SIZE
((
MA_USED_MEM
));

52 ià(!(
Ãxt
 = (
MA_USED_MEM
*è
	`m®loc
(
Size
)))

54 ià(
mem_roÙ
->
”rÜ_hªdËr
)

55 (*
mem_roÙ
->
”rÜ_hªdËr
)();

58 
Ãxt
->Ãxt=
mem_roÙ
->
u£d
;

59 
mem_roÙ
->
u£d
=
Ãxt
;

60  (*è(((*è
Ãxt
)+
	`ALIGN_SIZE
((
MA_USED_MEM
)));

62 
size_t
 
g‘_size
;

63 * 
pošt
;

64 
»g1
 
MA_USED_MEM
 *
Ãxt
= 0;

65 
»g2
 
MA_USED_MEM
 **
´ev
;

67 
Size
ð
	`ALIGN_SIZE
(Size);

69 ià((*(
´ev
ð&
mem_roÙ
->
ä“
)))

71 ià((*
´ev
)->
Ëá
 < 
Size
 &&

72 
mem_roÙ
->
fœ¡_block_u§ge
++ >= 16 &&

73 (*
´ev
)->
Ëá
 < 4096)

75 
Ãxt
ð*
´ev
;

76 *
´ev
ð
Ãxt
->next;

77 
Ãxt
->Ãxtð
mem_roÙ
->
u£d
;

78 
mem_roÙ
->
u£d
ð
Ãxt
;

79 
mem_roÙ
->
fœ¡_block_u§ge
= 0;

81 
Ãxt
ð*
´ev
;‚exˆ&&‚ext->
Ëá
 < 
Size
;‚ext=‚ext->next)

82 
´ev
ð&
Ãxt
->next;

85 ià(! 
Ãxt
)

87 
g‘_size
ð
	`MAX
(
Size
+
	`ALIGN_SIZE
((
MA_USED_MEM
)),

88 (
mem_roÙ
->
block_size
 & ~1è* (mem_roÙ->
block_num
 >> 2));

90 ià(!(
Ãxt
 = (
MA_USED_MEM
*è
	`m®loc
(
g‘_size
)))

92 ià(
mem_roÙ
->
”rÜ_hªdËr
)

93 (*
mem_roÙ
->
”rÜ_hªdËr
)();

96 
mem_roÙ
->
block_num
++;

97 
Ãxt
->Ãxtð*
´ev
;

98 
Ãxt
->
size
ð
g‘_size
;

99 
Ãxt
->
Ëá
ð
g‘_size
-
	`ALIGN_SIZE
((
MA_USED_MEM
));

100 *
´ev
=
Ãxt
;

102 
pošt
ð(*è((*è
Ãxt
+ (Ãxt->
size
-Ãxt->
Ëá
));

103 ià((
Ãxt
->
Ëá
-ð
Size
è< 
mem_roÙ
->
mš_m®loc
)

105 *
´ev
=
Ãxt
->next;

106 
Ãxt
->Ãxt=
mem_roÙ
->
u£d
;

107 
mem_roÙ
->
u£d
=
Ãxt
;

108 
mem_roÙ
->
fœ¡_block_u§ge
= 0;

110 (
pošt
);

112 
	}
}

116 
	$ma_ä“_roÙ
(
MA_MEM_ROOT
 *
roÙ
, 
myf
 
MyFÏgs
)

118 
»g1
 
MA_USED_MEM
 *
Ãxt
,*
Þd
;

120 ià(!
roÙ
)

122 ià(!(
MyFÏgs
 & 
MY_KEEP_PREALLOC
))

123 
roÙ
->
´e_®loc
=0;

125  
Ãxt
=
roÙ
->
u£d
;‚ext ;)

127 
Þd
=
Ãxt
;‚ext=‚ext->next ;

128 ià(
Þd
 !ð
roÙ
->
´e_®loc
)

129 
	`ä“
(
Þd
);

131 
Ãxt
ð
roÙ
->
ä“
 ;‚ext ; )

133 
Þd
=
Ãxt
;‚ext=‚ext->next ;

134 ià(
Þd
 !ð
roÙ
->
´e_®loc
)

135 
	`ä“
(
Þd
);

137 
roÙ
->
u£d
ôoÙ->
ä“
=0;

138 ià(
roÙ
->
´e_®loc
)

140 
roÙ
->
ä“
ôoÙ->
´e_®loc
;

141 
roÙ
->
ä“
->
Ëá
ôoÙ->
´e_®loc
->
size
-
	`ALIGN_SIZE
((
MA_USED_MEM
));

142 
roÙ
->
ä“
->
Ãxt
=0;

144 
	}
}

147 *
	$ma_¡rdup_roÙ
(
MA_MEM_ROOT
 *
roÙ
,cÚ¡ *
¡r
)

149 
size_t
 
Ën
ð
	`¡¾’
(
¡r
)+1;

150 *
pos
;

151 ià((
pos
=
	`ma_®loc_roÙ
(
roÙ
,
Ën
)))

152 
	`memýy
(
pos
,
¡r
,
Ën
);

153  
pos
;

154 
	}
}

157 *
	$ma_memdup_roÙ
(
MA_MEM_ROOT
 *
roÙ
, cÚ¡ *
¡r
, 
size_t
 
Ën
)

159 *
pos
;

160 ià((
pos
ð
	`ma_®loc_roÙ
(
roÙ
,
Ën
)))

161 
	`memýy
(
pos
,
¡r
,
Ën
);

162  
pos
;

163 
	}
}

165 *
	$ma_muÉi_m®loc
(
myf
 
myFÏgs
, ...)

167 
va_li¡
 
¬gs
;

168 **
±r
,*
¡¬t
,*
»s
;

169 
size_t
 
tÙ_Ëngth
,
Ëngth
;

171 
	`va_¡¬t
(
¬gs
,
myFÏgs
);

172 
tÙ_Ëngth
=0;

173 (
±r
=
	`va_¬g
(
¬gs
, **)))

175 
Ëngth
=
	`va_¬g
(
¬gs
, 
size_t
);

176 
tÙ_Ëngth
+=
	`ALIGN_SIZE
(
Ëngth
);

178 
	`va_’d
(
¬gs
);

180 ià(!(
¡¬t
=(*)
	`m®loc
(
tÙ_Ëngth
)))

183 
	`va_¡¬t
(
¬gs
,
myFÏgs
);

184 
»s
=
¡¬t
;

185 (
±r
=
	`va_¬g
(
¬gs
, **)))

187 *
±r
=
»s
;

188 
Ëngth
=
	`va_¬g
(
¬gs
,
size_t
);

189 
»s
+=
	`ALIGN_SIZE
(
Ëngth
);

191 
	`va_’d
(
¬gs
);

192  
¡¬t
;

193 
	}
}

	@libmariadb/ma_array.c

21 #undeà
SAFEMALLOC


23 
	~<ma_glob®.h
>

24 
	~<ma_sys.h
>

25 
	~"ma_¡ršg.h
"

26 
	~<memÜy.h
>

33 
my_boÞ
 
	$ma_š™_dyÇmic_¬¿y
(
DYNAMIC_ARRAY
 *
¬¿y
, 
ušt
 
–em’t_size
,

34 
ušt
 
š™_®loc
, ušˆ
®loc_šüem’t
 
CALLER_INFO_PROTO
)

36 ià(!
®loc_šüem’t
)

38 
®loc_šüem’t
=
	`max
((8192-
MALLOC_OVERHEAD
)/
–em’t_size
,16);

39 ià(
š™_®loc
 > 8 && 
®loc_šüem’t
 > init_alloc * 2)

40 
®loc_šüem’t
=
š™_®loc
*2;

43 ià(!
š™_®loc
)

44 
š™_®loc
=
®loc_šüem’t
;

45 
¬¿y
->
–em’ts
=0;

46 
¬¿y
->
max_–em’t
=
š™_®loc
;

47 
¬¿y
->
®loc_šüem’t
=alloc_increment;

48 
¬¿y
->
size_of_–em’t
=
–em’t_size
;

49 ià(!(
¬¿y
->
bufãr
=(*è
	`m®loc
(
–em’t_size
*
š™_®loc
)))

51 
¬¿y
->
max_–em’t
=0;

52 (
TRUE
);

54 (
FALSE
);

55 
	}
}

58 
my_boÞ
 
	$ma_š£¹_dyÇmic
(
DYNAMIC_ARRAY
 *
¬¿y
, *
–em’t
)

60 *
bufãr
;

61 ià(
¬¿y
->
–em’ts
 =ð¬¿y->
max_–em’t
)

63 ià(!(
bufãr
=
	`ma_®loc_dyÇmic
(
¬¿y
)))

64  
TRUE
;

68 
bufãr
=
¬¿y
->bufãr+×¼ay->
–em’ts
 *‡¼ay->
size_of_–em’t
);

69 
¬¿y
->
–em’ts
++;

71 
	`memýy
(
bufãr
,
–em’t
,(
size_t
è
¬¿y
->
size_of_–em’t
);

72  
FALSE
;

73 
	}
}

78 *
	$ma_®loc_dyÇmic
(
DYNAMIC_ARRAY
 *
¬¿y
)

80 ià(
¬¿y
->
–em’ts
 =ð¬¿y->
max_–em’t
)

82 *
Ãw_±r
;

83 ià(!(
Ãw_±r
=(*è
	`»®loc
(
¬¿y
->
bufãr
,×¼ay->
max_–em’t
+

84 
¬¿y
->
®loc_šüem’t
)*

85 
¬¿y
->
size_of_–em’t
)))

87 
¬¿y
->
bufãr
=
Ãw_±r
;

88 
¬¿y
->
max_–em’t
+÷¼ay->
®loc_šüem’t
;

90  (*)
¬¿y
->
bufãr
+×¼ay->
–em’ts
++ *‡¼ay->
size_of_–em’t
);

91 
	}
}

96 *
	$ma_pÝ_dyÇmic
(
DYNAMIC_ARRAY
 *
¬¿y
)

98 ià(
¬¿y
->
–em’ts
)

99  (*)
¬¿y
->
bufãr
+(--¬¿y->
–em’ts
 *‡¼ay->
size_of_–em’t
);

101 
	}
}

104 
my_boÞ
 
	$ma_£t_dyÇmic
(
DYNAMIC_ARRAY
 *
¬¿y
, * 
–em’t
, 
ušt
 
idx
)

106 ià(
idx
 >ð
¬¿y
->
–em’ts
)

108 ià(
idx
 >ð
¬¿y
->
max_–em’t
)

110 
ušt
 
size
;

111 *
Ãw_±r
;

112 
size
=(
idx
+
¬¿y
->
®loc_šüem’t
)/array->alloc_increment;

113 
size
*ð
¬¿y
->
®loc_šüem’t
;

114 ià(!(
Ãw_±r
=(*è
	`»®loc
(
¬¿y
->
bufãr
,
size
*

115 
¬¿y
->
size_of_–em’t
)))

116  
TRUE
;

117 
¬¿y
->
bufãr
=
Ãw_±r
;

118 
¬¿y
->
max_–em’t
=
size
;

120 
	`mem£t
((
¬¿y
->
bufãr
+¬¿y->
–em’ts
*¬¿y->
size_of_–em’t
), 0,

121 (
idx
 - 
¬¿y
->
–em’ts
)*¬¿y->
size_of_–em’t
);

122 
¬¿y
->
–em’ts
=
idx
+1;

124 
	`memýy
(
¬¿y
->
bufãr
+(
idx
 *‡¼ay->
size_of_–em’t
),
–em’t
,

125 (
size_t
è
¬¿y
->
size_of_–em’t
);

126  
FALSE
;

127 
	}
}

130 
	$ma_g‘_dyÇmic
(
DYNAMIC_ARRAY
 *
¬¿y
, * 
–em’t
, 
ušt
 
idx
)

132 ià(
idx
 >ð
¬¿y
->
–em’ts
)

134 
	`mem£t
(
–em’t
, 0, 
¬¿y
->
size_of_–em’t
);

137 
	`memýy
(
–em’t
,
¬¿y
->
bufãr
+
idx
*¬¿y->
size_of_–em’t
,

138 (
size_t
è
¬¿y
->
size_of_–em’t
);

139 
	}
}

142 
	$ma_d–‘e_dyÇmic
(
DYNAMIC_ARRAY
 *
¬¿y
)

144 ià(
¬¿y
->
bufãr
)

146 
	`ä“
(
¬¿y
->
bufãr
);

147 
¬¿y
->
bufãr
=0;

148 
¬¿y
->
–em’ts
÷¼ay->
max_–em’t
=0;

150 
	}
}

153 
	$ma_d–‘e_dyÇmic_–em’t
(
DYNAMIC_ARRAY
 *
¬¿y
, 
ušt
 
idx
)

155 *
±r
=
¬¿y
->
bufãr
+¬¿y->
size_of_–em’t
*
idx
;

156 
¬¿y
->
–em’ts
--;

157 
	`memmove
(
±r
,±r+
¬¿y
->
size_of_–em’t
,

158 (
¬¿y
->
–em’ts
-
idx
)*¬¿y->
size_of_–em’t
);

159 
	}
}

162 
	$ma_ä“ze_size
(
DYNAMIC_ARRAY
 *
¬¿y
)

164 
ušt
 
–em’ts
=
	`max
(
¬¿y
->elements,1);

166 ià(
¬¿y
->
bufãr
 &&‡¼ay->
max_–em’t
 !ð
–em’ts
)

168 
¬¿y
->
bufãr
=(*è
	`»®loc
(array->buffer,

169 
–em’ts
*
¬¿y
->
size_of_–em’t
);

170 
¬¿y
->
max_–em’t
=
–em’ts
;

172 
	}
}

	@libmariadb/ma_charset.c

46 #iâdeà
_WIN32


47 
	~<¡ršgs.h
>

48 
	~<¡ršg.h
>

50 
	~<¡ršg.h
>

52 
	~<ma_glob®.h
>

53 
	~<m¬Ÿdb_ùy³.h
>

54 
	~<ma_¡ršg.h
>

56 #ifdeà
HAVE_ICONV


57 #ifdeà
_WIN32


58 
	~"../wš-icÚv/icÚv.h
"

60 
	~<icÚv.h
>

65 #ià
defšed
(
HAVE_NL_LANGINFO
è&& defšed(
HAVE_SETLOCALE
)

66 
	~<loÿË.h
>

67 
	~<Ïngšfo.h
>

91 
	$check_mb_utf8mb3_£qu’û
(cÚ¡ *
¡¬t
, cÚ¡ *
’d
)

93 
uch¬
 
c
;

95 ià(
¡¬t
 >ð
’d
) {

99 
c
 = (
uch¬
è
¡¬t
[0];

101 ià(
c
 < 0x80) {

104 ià(
c
 < 0xC2) {

107 ià(
c
 < 0xE0) {

108 ià(
¡¬t
 + 2 > 
’d
) {

111 ià(!(((
uch¬
)
¡¬t
[1] ^ 0x80) < 0x40)) {

116 ià(
c
 < 0xF0) {

117 ià(
¡¬t
 + 3 > 
’d
) {

120 ià(!(((
uch¬
)
¡¬t
[1] ^ 0x80) < 0x40 && ((uchar)start[2] ^ 0x80) < 0x40 &&

121 (
c
 >ð0xE1 || (
uch¬
)
¡¬t
[1] >= 0xA0))) {

127 
	}
}

130 
	$check_mb_utf8_£qu’û
(cÚ¡ *
¡¬t
, cÚ¡ *
’d
)

132 
uch¬
 
c
;

134 ià(
¡¬t
 >ð
’d
) {

138 
c
 = (
uch¬
è
¡¬t
[0];

140 ià(
c
 < 0x80) {

143 ià(
c
 < 0xC2) {

146 ià(
c
 < 0xE0) {

147 ià(
¡¬t
 + 2 > 
’d
) {

150 ià(!(((
uch¬
)
¡¬t
[1] ^ 0x80) < 0x40)) {

155 ià(
c
 < 0xF0) {

156 ià(
¡¬t
 + 3 > 
’d
) {

159 ià(!(((
uch¬
)
¡¬t
[1] ^ 0x80) < 0x40 && ((uchar)start[2] ^ 0x80) < 0x40 &&

160 (
c
 >ð0xE1 || (
uch¬
)
¡¬t
[1] >= 0xA0))) {

165 ià(
c
 < 0xF5) {

166 ià(
¡¬t
 + 4 > 
’d
) {

189 ià(!(((
uch¬
)
¡¬t
[1] ^ 0x80) < 0x40 &&

190 ((
uch¬
)
¡¬t
[2] ^ 0x80) < 0x40 &&

191 ((
uch¬
)
¡¬t
[3] ^ 0x80) < 0x40 &&

192 (
c
 >ð0xf1 || (
uch¬
)
¡¬t
[1] >= 0x90) &&

193 (
c
 <ð0xf3 || (
uch¬
)
¡¬t
[1] <= 0x8F)))

200 
	}
}

202 
	$check_mb_utf8mb3_v®id
(cÚ¡ *
¡¬t
, cÚ¡ *
’d
)

204 
Ën
 = 
	`check_mb_utf8mb3_£qu’û
(
¡¬t
, 
’d
);

205  (
Ën
 > 1)?†en:0;

206 
	}
}

208 
	$check_mb_utf8_v®id
(cÚ¡ *
¡¬t
, cÚ¡ *
’d
)

210 
Ën
 = 
	`check_mb_utf8_£qu’û
(
¡¬t
, 
’d
);

211  (
Ën
 > 1)?†en:0;

212 
	}
}

215 
	$mysql_mbch¬Ën_utf8mb3
(
utf8
)

217 ià(
utf8
 < 0x80) {

220 ià(
utf8
 < 0xC2) {

223 ià(
utf8
 < 0xE0) {

226 ià(
utf8
 < 0xF0) {

230 
	}
}

233 
	$mysql_mbch¬Ën_utf8
(
utf8
)

235 ià(
utf8
 < 0x80) {

238 ià(
utf8
 < 0xC2) {

241 ià(
utf8
 < 0xE0) {

244 ià(
utf8
 < 0xF0) {

247 ià(
utf8
 < 0xF8) {

251 
	}
}

256 
	#v®id_big5h—d
(
c
è(0xA1 <ð()(cè&& ()(cè<ð0xF9)

	)

257 
	#v®id_big5ž
(
c
) ((0x40 <= ()(c) && ()(c) <= 0x7E) || \

258 (0xA1 <ð()(
c
è&& ()(cè<ð0xFE))

	)

260 
	#isbig5code
(
c
,
d
è(
	`isbig5h—d
(cè&& 
	`isbig5ž
(d))

	)

262 
	$check_mb_big5
(cÚ¡ *
¡¬t
, cÚ¡ *
’d
)

264  (
	`v®id_big5h—d
(*((cÚ¡ 
uch¬
*è
¡¬t
)è&& (
’d
 - s¹è> 1 && 
	`v®id_big5ž
(*((const uchar*) start + 1)) ? 2 : 0);

265 
	}
}

268 
	$mysql_mbch¬Ën_big5
(
big5
)

270  (
	`v®id_big5h—d
(
big5
)) ? 2 : 1;

271 
	}
}

276 
	#v®id_ý932h—d
(
c
è((0x81 <ð(cè&& (cè<ð0x9Fè|| (0xE0 <ð(cè&& c <ð0xFC))

	)

277 
	#v®id_ý932ž
(
c
è((0x40 <ð(cè&& (cè<ð0x7Eè|| (0x80 <ð(cè&& c <ð0xFC))

	)

280 
	$check_mb_ý932
(cÚ¡ *
¡¬t
, cÚ¡ *
’d
)

282  (
	`v®id_ý932h—d
((
uch¬
)
¡¬t
[0]è&& (
’d
 - start > 1) &&

283 
	`v®id_ý932ž
((
uch¬
)
¡¬t
[1])) ? 2 : 0;

284 
	}
}

287 
	$mysql_mbch¬Ën_ý932
(
ý932
)

289  (
	`v®id_ý932h—d
((
uch¬
)
ý932
)) ? 2 : 1;

290 
	}
}

295 
	#v®id_euckr
(
c
è((0xA1 <ð(
uch¬
)(cè&& (uch¬)(cè<ð0xFE))

	)

297 
	$check_mb_euckr
(cÚ¡ *
¡¬t
, cÚ¡ *
’d
)

299 ià(
’d
 - 
¡¬t
 <= 1) {

302 ià(*(
uch¬
 *)
¡¬t
 < 0x80) {

305 ià(
	`v®id_euckr
(
¡¬t
[1])) {

309 
	}
}

312 
	$mysql_mbch¬Ën_euckr
(
kr
)

314  (
	`v®id_euckr
(
kr
)) ? 2 : 1;

315 
	}
}

320 
	#v®id_eucjpms
(
c
è(((cè& 0xFFè>ð0xA1 && ((cè& 0xFFè<ð0xFE)

	)

321 
	#v®id_eucjpms_k©a
(
c
è(((cè& 0xFFè>ð0xA1 && ((cè& 0xFFè<ð0xDF)

	)

322 
	#v®id_eucjpms_ss2
(
c
è(((cè& 0xFFè=ð0x8E)

	)

323 
	#v®id_eucjpms_ss3
(
c
è(((cè& 0xFFè=ð0x8F)

	)

325 
	$check_mb_eucjpms
(cÚ¡ *
¡¬t
, cÚ¡ *
’d
)

327 ià(*((
uch¬
 *)
¡¬t
) < 0x80) {

330 ià(
	`v®id_eucjpms
(
¡¬t
[0]è&& (
’d
 - start) > 1 && valid_eucjpms(start[1])) {

333 ià(
	`v®id_eucjpms_ss2
(
¡¬t
[0]è&& (
’d
 - s¹è> 1 && 
	`v®id_eucjpms_k©a
(start[1])) {

336 ià(
	`v®id_eucjpms_ss3
(
¡¬t
[0]è&& (
’d
 - s¹è> 2 && 
	`v®id_eucjpms
(start[1]) &&

337 
	`v®id_eucjpms
(
¡¬t
[2])) {

341 
	}
}

344 
	$mysql_mbch¬Ën_eucjpms
(
jpms
)

346 ià(
	`v®id_eucjpms
(
jpms
è|| 
	`v®id_eucjpms_ss2
(jpms)) {

349 ià(
	`v®id_eucjpms_ss3
(
jpms
)) {

353 
	}
}

358 
	#v®id_gb2312_h—d
(
c
è(0xA1 <ð(
uch¬
)(cè&& (uch¬)(cè<ð0xF7)

	)

359 
	#v®id_gb2312_ž
(
c
è(0xA1 <ð(
uch¬
)(cè&& (uch¬)(cè<ð0xFE)

	)

362 
	$check_mb_gb2312
(cÚ¡ *
¡¬t
, cÚ¡ *
’d
)

364  (
	`v®id_gb2312_h—d
(()
¡¬t
[0]è&& 
’d
 - start > 1 &&

365 
	`v®id_gb2312_ž
(()
¡¬t
[1])) ? 2 : 0;

366 
	}
}

369 
	$mysql_mbch¬Ën_gb2312
(
gb
)

371  (
	`v®id_gb2312_h—d
(
gb
)) ? 2 : 1;

372 
	}
}

377 
	#v®id_gbk_h—d
(
c
è(0x81<=(
uch¬
)(cè&& (uch¬)(c)<=0xFE)

	)

378 
	#v®id_gbk_ž
(
c
è((0x40<=(
uch¬
)(cè&& (uch¬)(c)<=0x7Eè|| (0x80<=(uch¬)(cè&& (uch¬)(c)<=0xFE))

	)

380 
	$check_mb_gbk
(cÚ¡ *
¡¬t
, cÚ¡ *
’d
)

382  (
	`v®id_gbk_h—d
(
¡¬t
[0]è&& (
’d
è- (¡¬tè> 1 && 
	`v®id_gbk_ž
(start[1])) ? 2 : 0;

383 
	}
}

385 
	$mysql_mbch¬Ën_gbk
(
gbk
)

387  (
	`v®id_gbk_h—d
(
gbk
) ? 2 : 1);

388 
	}
}

393 
	#v®id_sjis_h—d
(
c
è((0x81 <ð(cè&& (cè<ð0x9Fè|| (0xE0 <ð(cè&& (cè<ð0xFC))

	)

394 
	#v®id_sjis_ž
(
c
è((0x40 <ð(cè&& (cè<ð0x7Eè|| (0x80 <ð(cè&& (cè<ð0xFC))

	)

397 
	$check_mb_sjis
(cÚ¡ *
¡¬t
, cÚ¡ *
’d
)

399  (
	`v®id_sjis_h—d
((
uch¬
)
¡¬t
[0]è&& (
’d
 - s¹è> 1 && 
	`v®id_sjis_ž
((uchar)start[1])) ? 2 : 0;

400 
	}
}

403 
	$mysql_mbch¬Ën_sjis
(
sjis
)

405  (
	`v®id_sjis_h—d
((
uch¬
)
sjis
)) ? 2 : 1;

406 
	}
}

411 
check_mb_ucs2
(cÚ¡ *
¡¬t
 
__©Œibu‹
((
unu£d
)), cÚ¡ *
’d
 __attribute((unused)))

416 
mysql_mbch¬Ën_ucs2
(
ucs2
 
__©Œibu‹
((
unu£d
)))

424 
	#v®id_ujis
(
c
è((0xA1 <ð((c)&0xFFè&& ((c)&0xFFè<ð0xFE))

	)

425 
	#v®id_ujis_k©a
(
c
è((0xA1 <ð((c)&0xFFè&& ((c)&0xFFè<ð0xDF))

	)

426 
	#v®id_ujis_ss2
(
c
è(((c)&0xFFè=ð0x8E)

	)

427 
	#v®id_ujis_ss3
(
c
è(((c)&0xFFè=ð0x8F)

	)

429 
	$check_mb_ujis
(cÚ¡ *
¡¬t
, cÚ¡ *
’d
)

431 ià(*(
uch¬
*)
¡¬t
 < 0x80) {

434 ià(
	`v®id_ujis
(*(
¡¬t
)) && valid_ujis(*((start)+1))) {

437 ià(
	`v®id_ujis_ss2
(*(
¡¬t
)è&& 
	`v®id_ujis_k©a
(*((start)+1))) {

440 ià(
	`v®id_ujis_ss3
(*(
¡¬t
)è&& (
’d
-¡¬tè> 2 && 
	`v®id_ujis
(*((start)+1)) && valid_ujis(*((start)+2))) {

444 
	}
}

447 
	$mysql_mbch¬Ën_ujis
(
ujis
)

449  (
	`v®id_ujis
(
ujis
)? 2: 
	`v®id_ujis_ss2
(ujis)? 2: 
	`v®id_ujis_ss3
(ujis)? 3: 1);

450 
	}
}

456 
	#UTF16_HIGH_HEAD
(
x
è((((
uch¬
è(x)è& 0xFCè=ð0xD8)

	)

457 
	#UTF16_LOW_HEAD
(
x
è((((
uch¬
è(x)è& 0xFCè=ð0xDC)

	)

459 
	$check_mb_utf16
(cÚ¡ *
¡¬t
, cÚ¡ *
’d
)

461 ià(
¡¬t
 + 2 > 
’d
) {

465 ià(
	`UTF16_HIGH_HEAD
(*
¡¬t
)) {

466  (
¡¬t
 + 4 <ð
’d
è&& 
	`UTF16_LOW_HEAD
(start[2]) ? 4 : 0;

469 ià(
	`UTF16_LOW_HEAD
(*
¡¬t
)) {

473 
	}
}

476 
ušt
 
	$mysql_mbch¬Ën_utf16
(
utf16
)

478  
	`UTF16_HIGH_HEAD
(
utf16
) ? 4 : 2;

479 
	}
}

484 
ušt


485 
check_mb_utf32
(cÚ¡ *
¡¬t
 
__©Œibu‹
((
unu£d
)), cÚ¡ *
’d
 __attribute((unused)))

491 
ušt


492 
mysql_mbch¬Ën_utf32
(
utf32
 
__©Œibu‹
((
unu£d
)))

499 
	#is_gb18030_odd
(
c
è(0x81 <ð(è(cè&& (è(cè<ð0xFE)

	)

500 
	#is_gb18030_ev’_2
(
c
è((0x40 <ð(è(cè&& (è(cè<ð0x7Eè|| (0x80 <ð(è(cè&& (è(cè<ð0xFE))

	)

501 
	#is_gb18030_ev’_4
(
c
è(0x30 <ð(è(cè&& (è(cè<ð0x39)

	)

504 
	$mysql_mbch¬Ën_gb18030
(
c
)

506 ià(
c
 <= 0xFF) {

507  !
	`is_gb18030_odd
(
c
);

509 ià(
c
 > 0xFFFF || !
	`is_gb18030_odd
((c >> 8) & 0xFF)) {

512 ià(
	`is_gb18030_ev’_2
((
c
 & 0xFF))) {

515 ià(
	`is_gb18030_ev’_4
((
c
 & 0xFF))) {

520 
	}
}

522 
	$check_mb_gb18030_v®id
(cÚ¡ * 
¡¬t
, cÚ¡ * 
’d
)

524 ià(
’d
 - 
¡¬t
 <ð1 || !
	`is_gb18030_odd
(start[0])) {

528 ià(
	`is_gb18030_ev’_2
(
¡¬t
[1])) {

530 } ià(
’d
 - 
¡¬t
 > 3 && 
	`is_gb18030_ev’_4
(¡¬t[1]è&& 
	`is_gb18030_odd
(start[2]) && is_gb18030_even_4(start[3])) {

535 
	}
}

544 
	#UTF8_MB4
 "utf8mb4"

	)

545 
	#UTF8_MB3
 "utf8"

	)

548 cÚ¡ 
MARIADB_CHARSET_INFO
 
	gm¬Ÿdb_compžed_ch¬£ts
[] =

550 { 1, 1, "big5","big5_chše£_ci", "", 950, "BIG5", 1, 2, 
mysql_mbch¬Ën_big5
, 
check_mb_big5
},

551 { 3, 1, "dec8", "dec8_swedish_ci", "", 0, "DEC", 1, 1, 
NULL
, NULL},

552 { 4, 1, "ý850", "ý850_g’”®_ci", "", 850, "CP850", 1, 1, 
NULL
, NULL},

553 { 6, 1, "hp8", "hp8_’glish_ci", "", 0, "HP-ROMAN8", 1, 1, 
NULL
, NULL},

554 { 7, 1, "koi8r", "koi8r_g’”®_ci", "", 20866, "KOI8R", 1, 1, 
NULL
, NULL},

555 { 8, 1, "Ïtš1", "Ïtš1_swedish_ci", "", 1252, "LATIN1", 1, 1, 
NULL
, NULL},

556 { 9, 1, "Ïtš2", "Ïtš2_g’”®_ci", "", 852, "LATIN2", 1, 1, 
NULL
, NULL},

557 { 10, 1, "swe7", "swe7_swedish_ci", "", 20107, "", 1, 1, 
NULL
, NULL},

558 { 11, 1, "ascii", "ascii_g’”®_ci", "", 1252, "ASCII", 1, 1, 
NULL
, NULL},

559 { 12, 1, "ujis", "ujis_j­ªe£_ci", "", 20932, "UJIS", 1, 3, 
mysql_mbch¬Ën_ujis
, 
check_mb_ujis
},

560 { 13, 1, "sjis", "sjis_j­ªe£_ci", "", 932, "SJIS", 1, 2, 
mysql_mbch¬Ën_sjis
, 
check_mb_sjis
},

561 { 16, 1, "heb»w", "heb»w_g’”®_ci", "", 1255, "HEBREW", 1, 1, 
NULL
, NULL},

562 { 18, 1, "tis620", "tis620_thai_ci", "", 874, "TIS620", 1, 1, 
NULL
, NULL},

563 { 19, 1, "euckr", "euckr_kÜ—n_ci", "", 51949, "EUCKR", 1, 2, 
mysql_mbch¬Ën_euckr
, 
check_mb_euckr
},

564 { 22, 1, "koi8u", "koi8u_g’”®_ci", "", 21866, "KOI8U", 1, 1, 
NULL
, NULL},

565 { 24, 1, "gb2312", "gb2312_chše£_ci", "", 936, "GB2312", 1, 2, 
mysql_mbch¬Ën_gb2312
, 
check_mb_gb2312
},

566 { 25, 1, "g»ek", "g»ek_g’”®_ci", "", 28597, "GREEK", 1, 1, 
NULL
, NULL},

567 { 26, 1, "ý1250", "ý1250_g’”®_ci", "", 1250, "CP1250", 1, 1, 
NULL
, NULL},

568 { 28, 1, "gbk", "gbk_chše£_ci", "", 936, "GBK", 1, 2, 
mysql_mbch¬Ën_gbk
, 
check_mb_gbk
},

569 { 30, 1, "Ïtš5", "Ïtš5_turkish_ci", "", 1254, "LATIN5", 1, 1, 
NULL
, NULL},

570 { 32, 1, "¬mscii8", "¬mscii8_g’”®_ci", "", 0, "ARMSCII-8", 1, 1, 
NULL
, NULL},

571 { 33, 1, 
UTF8_MB3
, UTF8_MB3"_g’”®_ci", "", 65001, "UTF-8", 1, 3, 
mysql_mbch¬Ën_utf8mb3
, 
check_mb_utf8mb3_v®id
},

572 { 35, 1, "ucs2", "ucs2_g’”®_ci", "", 1200, "UCS-2BE", 2, 2, 
mysql_mbch¬Ën_ucs2
, 
check_mb_ucs2
},

573 { 36, 1, "ý866", "ý866_g’”®_ci", "", 866, "CP866", 1, 1, 
NULL
, NULL},

574 { 37, 1, "keybcs2", "keybcs2_g’”®_ci", "", 0, "", 1, 1, 
NULL
, NULL},

575 { 38, 1, "macû", "macû_g’”®_ci", "", 10029, "CP1282", 1, 1, 
NULL
, NULL},

576 { 39, 1, "maüomª", "maüomª_g’”®_ci", "", 10000, "MACINTOSH", 1, 1, 
NULL
, NULL},

577 { 40, 1, "ý852", "ý852_g’”®_ci", "", 852, "CP852", 1, 1, 
NULL
, NULL},

578 { 41, 1, "Ïtš7", "Ïtš7_g’”®_ci", "", 28603, "LATIN7", 1, 1, 
NULL
, NULL},

579 { 51, 1, "ý1251", "ý1251_g’”®_ci", "", 1251, "CP1251", 1, 1, 
NULL
, NULL},

580 { 57, 1, "ý1256", "ý1256_g’”®_ci", "", 1256, "CP1256", 1, 1, 
NULL
, NULL},

581 { 59, 1, "ý1257", "ý1257_g’”®_ci", "", 1257, "CP1257", 1, 1, 
NULL
, NULL},

582 { 63, 1, "bš¬y", "bš¬y", "", 0, "ASCII", 1, 1, 
NULL
, NULL},

583 { 64, 1, "¬mscii8", "¬mscii8_bš", "", 0, "ARMSCII-8", 1, 1, 
NULL
, NULL},

584 { 92, 1, "geo¡d8", "geo¡d8_g’”®_ci", "", 0, "GEORGIAN-PS", 1, 1, 
NULL
, NULL},

585 { 95, 1, "ý932", "ý932_j­ªe£_ci", "", 932, "CP932", 1, 2, 
mysql_mbch¬Ën_ý932
, 
check_mb_ý932
},

586 { 97, 1, "eucjpms", "eucjpms_j­ªe£_ci", "", 932, "EUC-JP-MS", 1, 3, 
mysql_mbch¬Ën_eucjpms
, 
check_mb_eucjpms
},

587 { 2, 1, "Ïtš2", "Ïtš2_czech_cs", "", 852, "LATIN2", 1, 1, 
NULL
, NULL},

588 { 5, 1, "Ïtš1", "Ïtš1_g”mª1_ci", "", 1252, "LATIN1", 1, 1, 
NULL
, NULL},

589 { 14, 1, "ý1251", "ý1251_bulg¬Ÿn_ci", "", 1251, "CP1251", 1, 1, 
NULL
, NULL},

590 { 15, 1, "Ïtš1", "Ïtš1_dªish_ci", "", 1252, "LATIN1", 1, 1, 
NULL
, NULL},

591 { 17, 1, "fž’ame", "fž’ame", "", 0, "", 1, 5, 
NULL
, NULL},

592 { 20, 1, "Ïtš7", "Ïtš7_e¡ÚŸn_cs", "", 28603, "LATIN7", 1, 1, 
NULL
, NULL},

593 { 21, 1, "Ïtš2", "Ïtš2_hung¬Ÿn_ci", "", 852, "LATIN2", 1, 1, 
NULL
, NULL},

594 { 23, 1, "ý1251", "ý1251_uk¿šŸn_ci", "", 1251, "CP1251", 1, 1, 
NULL
, NULL},

595 { 27, 1, "Ïtš2", "Ïtš2_üßtŸn_ci", "", 852, "LATIN2", 1, 1, 
NULL
, NULL},

596 { 29, 1, "ý1257", "ý1257_l™huªŸn_ci", "", 1257, "CP1257", 1, 1, 
NULL
, NULL},

597 { 31, 1, "Ïtš1", "Ïtš1_g”mª2_ci", "", 1252, "LATIN1", 1, 1, 
NULL
, NULL},

598 { 34, 1, "ý1250", "ý1250_czech_cs", "", 1250, "CP1250", 1, 1, 
NULL
, NULL},

599 { 42, 1, "Ïtš7", "Ïtš7_g’”®_cs", "", 28603, "LATIN7", 1, 1, 
NULL
, NULL},

600 { 43, 1, "macû", "macû_bš", "", 10029, "CP1282", 1, 1, 
NULL
, NULL},

601 { 44, 1, "ý1250", "ý1250_üßtŸn_ci", "", 1250, "CP1250", 1, 1, 
NULL
, NULL},

602 { 45, 1, 
UTF8_MB4
, UTF8_MB4"_g’”®_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

603 { 46, 1, 
UTF8_MB4
, UTF8_MB4"_bš", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

604 { 47, 1, "Ïtš1", "Ïtš1_bš", "", 1250, "LATIN1", 1, 1, 
NULL
, NULL},

605 { 48, 1, "Ïtš1", "Ïtš1_g’”®_ci", "", 1250, "LATIN1", 1, 1, 
NULL
, NULL},

606 { 49, 1, "Ïtš1", "Ïtš1_g’”®_cs", "", 1250, "LATIN1", 1, 1, 
NULL
, NULL},

607 { 50, 1, "ý1251", "ý1251_bš", "", 1251, "CP1251", 1, 1, 
NULL
, NULL},

608 { 52, 1, "ý1251", "ý1251_g’”®_cs", "", 1251, "CP1251", 1, 1, 
NULL
, NULL},

609 { 53, 1, "maüomª", "maüomª_bš", "", 10000, "MACINTOSH", 1, 1, 
NULL
, NULL},

610 { 54, 1, "utf16", "utf16_g’”®_ci", "", 0, "UTF16", 2, 4, 
mysql_mbch¬Ën_utf16
, 
check_mb_utf16
},

611 { 55, 1, "utf16", "utf16_bš", "", 0, "UTF16", 2, 4, 
mysql_mbch¬Ën_utf16
, 
check_mb_utf16
},

612 { 56, 1, "utf16Ë", "utf16_g’”®_ci", "", 1200, "UTF16LE", 2, 4, 
mysql_mbch¬Ën_utf16
, 
check_mb_utf16
},

613 { 58, 1, "ý1257", "ý1257_bš", "", 1257, "CP1257", 1, 1, 
NULL
, NULL},

614 #ifdeà
USED_TO_BE_SO_BEFORE_MYSQL_5_5


615 { 60, 1, "¬mascii8", "¬mascii8_bš", "", 0, "ARMSCII-8", 1, 1, 
NULL
, NULL},

617 { 60, 1, "utf32", "utf32_g’”®_ci", "", 0, "UTF32", 4, 4, 
mysql_mbch¬Ën_utf32
, 
check_mb_utf32
},

618 { 61, 1, "utf32", "utf32_bš", "", 0, "UTF32", 4, 4, 
mysql_mbch¬Ën_utf32
, 
check_mb_utf32
},

619 { 62, 1, "utf16Ë", "utf16_bš", "", 1200, "UTF16LE", 2, 4, 
mysql_mbch¬Ën_utf16
, 
check_mb_utf16
},

620 { 65, 1, "ascii", "ascii_bš", "", 1252, "ASCII", 1, 1, 
NULL
, NULL},

621 { 66, 1, "ý1250", "ý1250_bš", "", 1250, "CP1250", 1, 1, 
NULL
, NULL},

622 { 67, 1, "ý1256", "ý1256_bš", "", 1256, "CP1256", 1, 1, 
NULL
, NULL},

623 { 68, 1, "ý866", "ý866_bš", "", 866, "CP866", 1, 1, 
NULL
, NULL},

624 { 69, 1, "dec8", "dec8_bš", "", 0, "DEC", 1, 1, 
NULL
, NULL},

625 { 70, 1, "g»ek", "g»ek_bš", "", 28597, "GREEK", 1, 1, 
NULL
, NULL},

626 { 71, 1, "heb»w", "heb»w_bš", "", 1255, "heb»w", 1, 1, 
NULL
, NULL},

627 { 72, 1, "hp8", "hp8_bš", "", 0, "HPROMAN-8", 1, 1, 
NULL
, NULL},

628 { 73, 1, "keybcs2", "keybcs2_bš", "", 0, "", 1, 1, 
NULL
, NULL},

629 { 74, 1, "koi8r", "koi8r_bš", "", 20866, "KOI8R", 1, 1, 
NULL
, NULL},

630 { 75, 1, "koi8u", "koi8u_bš", "", 21866, "KOI8U", 1, 1, 
NULL
, NULL},

631 { 76, 1, 
UTF8_MB3
, UTF8_MB3"_tÞow”_ci", "", 65001, "UTF-8", 1, 3, 
mysql_mbch¬Ën_utf8mb3
, 
check_mb_utf8mb3_v®id
},

632 { 77, 1, "Ïtš2", "Ïtš2_bš", "", 28592, "LATIN2", 1, 1, 
NULL
, NULL},

633 { 78, 1, "Ïtš5", "Ïtš5_bš", "", 1254, "LATIN5", 1, 1, 
NULL
, NULL},

634 { 79, 1, "Ïtš7", "Ïtš7_bš", "", 28603, "LATIN7", 1, 1, 
NULL
, NULL},

635 { 80, 1, "ý850", "ý850_bš", "", 850, "CP850", 1, 1, 
NULL
, NULL},

636 { 81, 1, "ý852", "ý852_bš", "", 852, "CP852", 1, 1, 
NULL
, NULL},

637 { 82, 1, "swe7", "swe7_bš", "", 0, "", 1, 1, 
NULL
, NULL},

638 { 93, 1, "geo¡d8", "geo¡d8_bš", "", 0, "GEORGIAN-PS", 1, 1, 
NULL
, NULL},

639 { 83, 1, 
UTF8_MB3
, UTF8_MB3"_bš", "", 65001, "UTF-8", 1, 3, 
mysql_mbch¬Ën_utf8mb3
, 
check_mb_utf8mb3_v®id
},

640 { 84, 1, "big5", "big5_bš", "", 65000, "BIG5", 1, 2, 
mysql_mbch¬Ën_big5
, 
check_mb_big5
},

641 { 85, 1, "euckr", "euckr_bš", "", 51949, "EUCKR", 1, 2, 
mysql_mbch¬Ën_euckr
, 
check_mb_euckr
},

642 { 86, 1, "gb2312", "gb2312_bš", "", 936, "GB2312", 1, 2, 
mysql_mbch¬Ën_gb2312
, 
check_mb_gb2312
},

643 { 87, 1, "gbk", "gbk_bš", "", 936, "GBK", 1, 2, 
mysql_mbch¬Ën_gbk
, 
check_mb_gbk
},

644 { 88, 1, "sjis", "sjis_bš", "", 932, "SJIS", 1, 2, 
mysql_mbch¬Ën_sjis
, 
check_mb_sjis
},

645 { 89, 1, "tis620", "tis620_bš", "", 874, "TIS620", 1, 1, 
NULL
, NULL},

646 { 90, 1, "ucs2", "ucs2_bš", "", 1200, "UCS-2BE", 2, 2, 
mysql_mbch¬Ën_ucs2
, 
check_mb_ucs2
},

647 { 91, 1, "ujis", "ujis_bš", "", 20932, "UJIS", 1, 3, 
mysql_mbch¬Ën_ujis
, 
check_mb_ujis
},

648 { 94, 1, "Ïtš1", "Ïtš1_¥ªish_ci", "", 1252, "LATIN1", 1, 1, 
NULL
, NULL},

649 { 96, 1, "ý932", "ý932_bš", "", 932, "CP932", 1, 2, 
mysql_mbch¬Ën_ý932
, 
check_mb_ý932
},

650 { 99, 1, "ý1250", "ý1250_pÞish_ci", "", 1250, "CP1250", 1, 1, 
NULL
, NULL},

651 { 98, 1, "eucjpms", "eucjpms_bš", "", 932, "EUCJP-MS", 1, 3, 
mysql_mbch¬Ën_eucjpms
, 
check_mb_eucjpms
},

652 { 101, 1, "utf16", "utf16_unicode_ci", "", 0, "UTF16", 2, 4, 
mysql_mbch¬Ën_utf16
, 
check_mb_utf16
},

653 { 102, 1, "utf16", "utf16_iûÏndic_ci", "", 0, "UTF16", 2, 4, 
mysql_mbch¬Ën_utf16
, 
check_mb_utf16
},

654 { 103, 1, "utf16", "utf16_ÏtvŸn_ci", "", 0, "UTF16", 2, 4, 
mysql_mbch¬Ën_utf16
, 
check_mb_utf16
},

655 { 104, 1, "utf16", "utf16_romªŸn_ci", "", 0, "UTF16", 2, 4, 
mysql_mbch¬Ën_utf16
, 
check_mb_utf16
},

656 { 105, 1, "utf16", "utf16_¦ov’Ÿn_ci", "", 0, "UTF16", 2, 4, 
mysql_mbch¬Ën_utf16
, 
check_mb_utf16
},

657 { 106, 1, "utf16", "utf16_pÞish_ci", "", 0, "UTF16", 2, 4, 
mysql_mbch¬Ën_utf16
, 
check_mb_utf16
},

658 { 107, 1, "utf16", "utf16_e¡ÚŸn_ci", "", 0, "UTF16", 2, 4, 
mysql_mbch¬Ën_utf16
, 
check_mb_utf16
},

659 { 108, 1, "utf16", "utf16_¥ªish_ci", "", 0, "UTF16", 2, 4, 
mysql_mbch¬Ën_utf16
, 
check_mb_utf16
},

660 { 109, 1, "utf16", "utf16_swedish_ci", "", 0, "UTF16", 2, 4, 
mysql_mbch¬Ën_utf16
, 
check_mb_utf16
},

661 { 110, 1, "utf16", "utf16_turkish_ci", "", 0, "UTF16", 2, 4, 
mysql_mbch¬Ën_utf16
, 
check_mb_utf16
},

662 { 111, 1, "utf16", "utf16_czech_ci", "", 0, "UTF16", 2, 4, 
mysql_mbch¬Ën_utf16
, 
check_mb_utf16
},

663 { 112, 1, "utf16", "utf16_dªish_ci", "", 0, "UTF16", 2, 4, 
mysql_mbch¬Ën_utf16
, 
check_mb_utf16
},

664 { 113, 1, "utf16", "utf16_l™hunŸn_ci", "", 0, "UTF16", 2, 4, 
mysql_mbch¬Ën_utf16
, 
check_mb_utf16
},

665 { 114, 1, "utf16", "utf16_¦ovak_ci", "", 0, "UTF16", 2, 4, 
mysql_mbch¬Ën_utf16
, 
check_mb_utf16
},

666 { 115, 1, "utf16", "utf16_¥ªish2_ci", "", 0, "UTF16", 2, 4, 
mysql_mbch¬Ën_utf16
, 
check_mb_utf16
},

667 { 116, 1, "utf16", "utf16_romª_ci", "", 0, "UTF16", 2, 4, 
mysql_mbch¬Ën_utf16
, 
check_mb_utf16
},

668 { 117, 1, "utf16", "utf16_³rsŸn_ci", "", 0, "UTF16", 2, 4, 
mysql_mbch¬Ën_utf16
, 
check_mb_utf16
},

669 { 118, 1, "utf16", "utf16_e¥”ªto_ci", "", 0, "UTF16", 2, 4, 
mysql_mbch¬Ën_utf16
, 
check_mb_utf16
},

670 { 120, 1, "utf16", "utf16_sšh®a_ci", "", 0, "UTF16", 2, 4, 
mysql_mbch¬Ën_utf16
, 
check_mb_utf16
},

671 { 121, 1, "utf16", "utf16_g”mª2_ci", "", 0, "UTF16", 2, 4, 
mysql_mbch¬Ën_utf16
, 
check_mb_utf16
},

672 { 122, 1, "utf16", "utf16_üßtŸn_mysql561_ci", "", 0, "UTF16", 2, 4, 
mysql_mbch¬Ën_utf16
, 
check_mb_utf16
},

673 { 123, 1, "utf16", "utf16_unicode_520_ci", "", 0, "UTF16", 2, 4, 
mysql_mbch¬Ën_utf16
, 
check_mb_utf16
},

674 { 124, 1, "utf16", "utf16_v›Šame£_ci", "", 0, "UTF16", 2, 4, 
mysql_mbch¬Ën_utf16
, 
check_mb_utf16
},

675 { 128, 1, "ucs2", "ucs2_unicode_ci", "", 1200, "UCS-2BE", 2, 2, 
mysql_mbch¬Ën_ucs2
, 
check_mb_ucs2
},

676 { 129, 1, "ucs2", "ucs2_iûÏndic_ci", "", 1200, "UCS-2BE", 2, 2, 
mysql_mbch¬Ën_ucs2
, 
check_mb_ucs2
},

677 { 130, 1, "ucs2", "ucs2_ÏtvŸn_ci", "", 1200, "UCS-2BE", 2, 2, 
mysql_mbch¬Ën_ucs2
, 
check_mb_ucs2
},

678 { 131, 1, "ucs2", "ucs2_romªŸn_ci", "", 1200, "UCS2-BE", 2, 2, 
mysql_mbch¬Ën_ucs2
, 
check_mb_ucs2
},

679 { 132, 1, "ucs2", "ucs2_¦ov’Ÿn_ci", "", 1200, "UCS2-BE", 2, 2, 
mysql_mbch¬Ën_ucs2
, 
check_mb_ucs2
},

680 { 133, 1, "ucs2", "ucs2_pÞish_ci", "", 1200, "UCS2-BE", 2, 2, 
mysql_mbch¬Ën_ucs2
, 
check_mb_ucs2
},

681 { 134, 1, "ucs2", "ucs2_e¡ÚŸn_ci", "", 1200, "UCS2-BE", 2, 2, 
mysql_mbch¬Ën_ucs2
, 
check_mb_ucs2
},

682 { 135, 1, "ucs2", "ucs2_¥ªish_ci", "", 1200, "UCS2-BE", 2, 2, 
mysql_mbch¬Ën_ucs2
, 
check_mb_ucs2
},

683 { 136, 1, "ucs2", "ucs2_swedish_ci", "", 1200, "UCS2-BE", 2, 2, 
mysql_mbch¬Ën_ucs2
, 
check_mb_ucs2
},

684 { 137, 1, "ucs2", "ucs2_turkish_ci", "", 1200, "UCS2-BE", 2, 2, 
mysql_mbch¬Ën_ucs2
, 
check_mb_ucs2
},

685 { 138, 1, "ucs2", "ucs2_czech_ci", "", 1200, "UCS2-BE", 2, 2, 
mysql_mbch¬Ën_ucs2
, 
check_mb_ucs2
},

686 { 139, 1, "ucs2", "ucs2_dªish_ci", "", 1200, "UCS2-BE", 2, 2, 
mysql_mbch¬Ën_ucs2
, 
check_mb_ucs2
},

687 { 140, 1, "ucs2", "ucs2_l™huªŸn_ci", "", 1200, "UCS2-BE", 2, 2, 
mysql_mbch¬Ën_ucs2
, 
check_mb_ucs2
},

688 { 141, 1, "ucs2", "ucs2_¦ovak_ci", "", 1200, "UCS2-BE", 2, 2, 
mysql_mbch¬Ën_ucs2
, 
check_mb_ucs2
},

689 { 142, 1, "ucs2", "ucs2_¥ªish2_ci", "", 1200, "UCS2-BE", 2, 2, 
mysql_mbch¬Ën_ucs2
, 
check_mb_ucs2
},

690 { 143, 1, "ucs2", "ucs2_romª_ci", "", 1200, "UCS2-BE", 2, 2, 
mysql_mbch¬Ën_ucs2
, 
check_mb_ucs2
},

691 { 144, 1, "ucs2", "ucs2_³rsŸn_ci", "", 1200, "UCS2-BE", 2, 2, 
mysql_mbch¬Ën_ucs2
, 
check_mb_ucs2
},

692 { 145, 1, "ucs2", "ucs2_e¥”ªto_ci", "", 1200, "UCS2-BE", 2, 2, 
mysql_mbch¬Ën_ucs2
, 
check_mb_ucs2
},

693 { 146, 1, "ucs2", "ucs2_hung¬Ÿn_ci", "", 1200, "UCS2-BE", 2, 2, 
mysql_mbch¬Ën_ucs2
, 
check_mb_ucs2
},

694 { 147, 1, "ucs2", "ucs2_sšh®a_ci", "", 1200, "UCS2-BE", 2, 2, 
mysql_mbch¬Ën_ucs2
, 
check_mb_ucs2
},

695 { 148, 1, "ucs2", "ucs2_g”mª2_ci", "", 1200, "UCS2-BE", 2, 2, 
mysql_mbch¬Ën_ucs2
, 
check_mb_ucs2
},

696 { 149, 1, "ucs2", "ucs2_üßtŸn_ci", "", 1200, "UCS2-BE", 2, 2, 
mysql_mbch¬Ën_ucs2
, 
check_mb_ucs2
},

697 { 150, 1, "ucs2", "ucs2_unicode_520_ci", "", 1200, "UCS2-BE", 2, 2, 
mysql_mbch¬Ën_ucs2
, 
check_mb_ucs2
},

698 { 151, 1, "ucs2", "ucs2_v›Šame£_ci", "", 1200, "UCS2-BE", 2, 2, 
mysql_mbch¬Ën_ucs2
, 
check_mb_ucs2
},

699 { 159, 1, "ucs2", "ucs2_g’”®_mysql500_ci", "", 1200, "UCS2-BE", 2, 2, 
mysql_mbch¬Ën_ucs2
, 
check_mb_ucs2
},

700 { 160, 1, "utf32", "utf32_unicode_ci", "", 0, "UTF32", 4, 4, 
mysql_mbch¬Ën_utf32
, 
check_mb_utf32
},

701 { 161, 1, "utf32", "utf32_iûÏndic_ci", "", 0, "UTF32", 4, 4, 
mysql_mbch¬Ën_utf32
, 
check_mb_utf32
},

702 { 162, 1, "utf32", "utf32_ÏtvŸn_ci", "", 0, "UTF32", 4, 4, 
mysql_mbch¬Ën_utf32
, 
check_mb_utf32
},

703 { 163, 1, "utf32", "utf32_romªŸn_ci", "", 0, "UTF32", 4, 4, 
mysql_mbch¬Ën_utf32
, 
check_mb_utf32
},

704 { 164, 1, "utf32", "utf32_¦ov’Ÿn_ci", "", 0, "UTF32", 4, 4, 
mysql_mbch¬Ën_utf32
, 
check_mb_utf32
},

705 { 165, 1, "utf32", "utf32_pÞish_ci", "", 0, "UTF32", 4, 4, 
mysql_mbch¬Ën_utf32
, 
check_mb_utf32
},

706 { 166, 1, "utf32", "utf32_e¡ÚŸn_ci", "", 0, "UTF32", 4, 4, 
mysql_mbch¬Ën_utf32
, 
check_mb_utf32
},

707 { 167, 1, "utf32", "utf32_¥ªish_ci", "", 0, "UTF32", 4, 4, 
mysql_mbch¬Ën_utf32
, 
check_mb_utf32
},

708 { 168, 1, "utf32", "utf32_swedish_ci", "", 0, "UTF32", 4, 4, 
mysql_mbch¬Ën_utf32
, 
check_mb_utf32
},

709 { 169, 1, "utf32", "utf32_turkish_ci", "", 0, "UTF32", 4, 4, 
mysql_mbch¬Ën_utf32
, 
check_mb_utf32
},

710 { 170, 1, "utf32", "utf32_czech_ci", "", 0, "UTF32", 4, 4, 
mysql_mbch¬Ën_utf32
, 
check_mb_utf32
},

711 { 171, 1, "utf32", "utf32_dªish_ci", "", 0, "UTF32", 4, 4, 
mysql_mbch¬Ën_utf32
, 
check_mb_utf32
},

712 { 172, 1, "utf32", "utf32_l™huªŸn_ci", "", 0, "UTF32", 4, 4, 
mysql_mbch¬Ën_utf32
, 
check_mb_utf32
},

713 { 173, 1, "utf32", "utf32_¦ovak_ci", "", 0, "UTF32", 4, 4, 
mysql_mbch¬Ën_utf32
, 
check_mb_utf32
},

714 { 174, 1, "utf32", "utf32_¥ªish_ci", "", 0, "UTF32", 4, 4, 
mysql_mbch¬Ën_utf32
, 
check_mb_utf32
},

715 { 175, 1, "utf32", "utf32_romª_ci", "", 0, "UTF32", 4, 4, 
mysql_mbch¬Ën_utf32
, 
check_mb_utf32
},

716 { 176, 1, "utf32", "utf32_³rsŸn_ci", "", 0, "UTF32", 4, 4, 
mysql_mbch¬Ën_utf32
, 
check_mb_utf32
},

717 { 177, 1, "utf32", "utf32_e¥”ªto_ci", "", 0, "UTF32", 4, 4, 
mysql_mbch¬Ën_utf32
, 
check_mb_utf32
},

718 { 178, 1, "utf32", "utf32_hung¬Ÿn_ci", "", 0, "UTF32", 4, 4, 
mysql_mbch¬Ën_utf32
, 
check_mb_utf32
},

719 { 179, 1, "utf32", "utf32_sšh®a_ci", "", 0, "UTF32", 4, 4, 
mysql_mbch¬Ën_utf32
, 
check_mb_utf32
},

720 { 180, 1, "utf32", "utf32_g”mª2_ci", "", 0, "UTF32", 4, 4, 
mysql_mbch¬Ën_utf32
, 
check_mb_utf32
},

721 { 181, 1, "utf32", "utf32_üßtŸn_mysql561_ci", "", 0, "UTF32", 4, 4, 
mysql_mbch¬Ën_utf32
, 
check_mb_utf32
},

722 { 182, 1, "utf32", "utf32_unicode_520_ci", "", 0, "UTF32", 4, 4, 
mysql_mbch¬Ën_utf32
, 
check_mb_utf32
},

723 { 183, 1, "utf32", "utf32_v›Šame£_ci", "", 0, "UTF32", 4, 4, 
mysql_mbch¬Ën_utf32
, 
check_mb_utf32
},

725 { 192, 1, 
UTF8_MB3
, UTF8_MB3"_g’”®_ci", "", 65001, "UTF-8", 1, 3, 
mysql_mbch¬Ën_utf8mb3
, 
check_mb_utf8mb3_v®id
},

726 { 193, 1, 
UTF8_MB3
, UTF8_MB3"_iûÏndic_ci", "", 65001, "UTF-8", 1, 3, 
mysql_mbch¬Ën_utf8mb3
, 
check_mb_utf8mb3_v®id
},

727 { 194, 1, 
UTF8_MB3
, UTF8_MB3"_ÏtvŸn_ci", "", 65001, "UTF-8", 1, 3, 
mysql_mbch¬Ën_utf8mb3
, 
check_mb_utf8mb3_v®id
},

728 { 195, 1, 
UTF8_MB3
, UTF8_MB3"_romªŸn_ci", "", 65001, "UTF-8", 1, 3, 
mysql_mbch¬Ën_utf8mb3
, 
check_mb_utf8mb3_v®id
},

729 { 196, 1, 
UTF8_MB3
, UTF8_MB3"_¦ov’Ÿn_ci", "", 65001, "UTF-8", 1, 3, 
mysql_mbch¬Ën_utf8mb3
, 
check_mb_utf8mb3_v®id
},

730 { 197, 1, 
UTF8_MB3
, UTF8_MB3"_pÞish_ci", "", 65001, "UTF-8", 1, 3, 
mysql_mbch¬Ën_utf8mb3
, 
check_mb_utf8mb3_v®id
},

731 { 198, 1, 
UTF8_MB3
, UTF8_MB3"_e¡ÚŸn_ci", "", 65001, "UTF-8", 1, 3, 
mysql_mbch¬Ën_utf8mb3
, 
check_mb_utf8mb3_v®id
},

732 { 199, 1, 
UTF8_MB3
, UTF8_MB3"_¥ªish_ci", "", 65001, "UTF-8", 1, 3, 
mysql_mbch¬Ën_utf8mb3
, 
check_mb_utf8mb3_v®id
},

733 { 119, 1, 
UTF8_MB3
, UTF8_MB3"_¥ªish_ci", "", 65001, "UTF-8", 1, 3, 
mysql_mbch¬Ën_utf8mb3
, 
check_mb_utf8mb3_v®id
},

734 { 200, 1, 
UTF8_MB3
, UTF8_MB3"_swedish_ci", "", 65001, "UTF-8", 1, 3, 
mysql_mbch¬Ën_utf8mb3
, 
check_mb_utf8mb3_v®id
},

735 { 201, 1, 
UTF8_MB3
, UTF8_MB3"_turkish_ci", "", 65001, "UTF-8", 1, 3, 
mysql_mbch¬Ën_utf8mb3
, 
check_mb_utf8mb3_v®id
},

736 { 202, 1, 
UTF8_MB3
, UTF8_MB3"_czech_ci", "", 65001, "UTF-8", 1, 3, 
mysql_mbch¬Ën_utf8mb3
, 
check_mb_utf8mb3_v®id
},

737 { 203, 1, 
UTF8_MB3
, UTF8_MB3"_dªish_ci", "", 65001, "UTF-8", 1, 3, 
mysql_mbch¬Ën_utf8mb3
, 
check_mb_utf8mb3_v®id
 },

738 { 204, 1, 
UTF8_MB3
, UTF8_MB3"_l™huªŸn_ci", "", 65001, "UTF-8", 1, 3, 
mysql_mbch¬Ën_utf8mb3
, 
check_mb_utf8mb3_v®id
 },

739 { 205, 1, 
UTF8_MB3
, UTF8_MB3"_¦ovak_ci", "", 65001, "UTF-8", 1, 3, 
mysql_mbch¬Ën_utf8mb3
, 
check_mb_utf8mb3_v®id
},

740 { 206, 1, 
UTF8_MB3
, UTF8_MB3"_¥ªish2_ci", "", 65001, "UTF-8", 1, 3, 
mysql_mbch¬Ën_utf8mb3
, 
check_mb_utf8mb3_v®id
},

741 { 207, 1, 
UTF8_MB3
, UTF8_MB3"_romª_ci", "", 65001, "UTF-8", 1, 3, 
mysql_mbch¬Ën_utf8mb3
, 
check_mb_utf8mb3_v®id
},

742 { 208, 1, 
UTF8_MB3
, UTF8_MB3"_³rsŸn_ci", "", 65001, "UTF-8", 1, 3, 
mysql_mbch¬Ën_utf8mb3
, 
check_mb_utf8mb3_v®id
},

743 { 209, 1, 
UTF8_MB3
, UTF8_MB3"_e¥”ªto_ci", "", 65001, "UTF-8", 1, 3, 
mysql_mbch¬Ën_utf8mb3
, 
check_mb_utf8mb3_v®id
},

744 { 210, 1, 
UTF8_MB3
, UTF8_MB3"_hung¬Ÿn_ci", "", 65001, "UTF-8", 1, 3, 
mysql_mbch¬Ën_utf8mb3
, 
check_mb_utf8mb3_v®id
},

745 { 211, 1, 
UTF8_MB3
, UTF8_MB3"_sšh®a_ci", "", 65001, "UTF-8", 1, 3, 
mysql_mbch¬Ën_utf8mb3
, 
check_mb_utf8mb3_v®id
},

746 { 212, 1, 
UTF8_MB3
, UTF8_MB3"_g”mª2_ci", "", 65001, "UTF-8", 1, 3, 
mysql_mbch¬Ën_utf8mb3
, 
check_mb_utf8mb3_v®id
},

747 { 214, 1, 
UTF8_MB3
, UTF8_MB3"_unicode_520_ci", "", 65001, "UTF-8", 1, 3, 
mysql_mbch¬Ën_utf8mb3
, 
check_mb_utf8mb3_v®id
},

748 { 215, 1, 
UTF8_MB3
, UTF8_MB3"_v›Šame£_ci", "", 65001, "UTF-8", 1, 3, 
mysql_mbch¬Ën_utf8mb3
, 
check_mb_utf8mb3_v®id
},

749 { 213, 1, 
UTF8_MB3
, UTF8_MB3"_üßtŸn_ci", "", 65001, "UTF-8", 1, 3, 
mysql_mbch¬Ën_utf8mb3
, 
check_mb_utf8mb3_v®id
},

750 { 223, 1, 
UTF8_MB3
, UTF8_MB3"_g’”®_mysql500_ci", "", 65001, "UTF-8", 1, 3, 
mysql_mbch¬Ën_utf8mb3
, 
check_mb_utf8mb3_v®id
},

752 { 224, 1, 
UTF8_MB4
, UTF8_MB4"_unicode_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

753 { 225, 1, 
UTF8_MB4
, UTF8_MB4"_iûÏndic_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

754 { 226, 1, 
UTF8_MB4
, UTF8_MB4"_ÏtvŸn_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

755 { 227, 1, 
UTF8_MB4
, UTF8_MB4"_romªŸn_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

756 { 228, 1, 
UTF8_MB4
, UTF8_MB4"_¦ov’Ÿn_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

757 { 229, 1, 
UTF8_MB4
, UTF8_MB4"_pÞish_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

758 { 230, 1, 
UTF8_MB4
, UTF8_MB4"_e¡ÚŸn_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

759 { 231, 1, 
UTF8_MB4
, UTF8_MB4"_¥ªish_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

760 { 232, 1, 
UTF8_MB4
, UTF8_MB4"_swedish_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

761 { 233, 1, 
UTF8_MB4
, UTF8_MB4"_turkish_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

762 { 234, 1, 
UTF8_MB4
, UTF8_MB4"_czech_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

763 { 235, 1, 
UTF8_MB4
, UTF8_MB4"_dªish_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

764 { 236, 1, 
UTF8_MB4
, UTF8_MB4"_l™huªŸn_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

765 { 237, 1, 
UTF8_MB4
, UTF8_MB4"_¦ovak_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

766 { 238, 1, 
UTF8_MB4
, UTF8_MB4"_¥ªish2_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

767 { 239, 1, 
UTF8_MB4
, UTF8_MB4"_romª_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

768 { 240, 1, 
UTF8_MB4
, UTF8_MB4"_³rsŸn_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

769 { 241, 1, 
UTF8_MB4
, UTF8_MB4"_e¥”ªto_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

770 { 242, 1, 
UTF8_MB4
, UTF8_MB4"_hung¬Ÿn_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

771 { 243, 1, 
UTF8_MB4
, UTF8_MB4"_sšh®a_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

772 { 244, 1, 
UTF8_MB4
, UTF8_MB4"_g”mª2_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

773 { 245, 1, 
UTF8_MB4
, UTF8_MB4"_üßtŸn_mysql561_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

774 { 246, 1, 
UTF8_MB4
, UTF8_MB4"_unicode_520_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

775 { 247, 1, 
UTF8_MB4
, UTF8_MB4"_v›Šame£_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

776 { 248, 1, "gb18030", "gb18030_chše£_ci", "", 54936, "GB18030", 1, 4, 
mysql_mbch¬Ën_gb18030
, 
check_mb_gb18030_v®id
},

777 { 249, 1, "gb18030", "gb18030_bš", "", 54936, "GB18030", 1, 4, 
mysql_mbch¬Ën_gb18030
, 
check_mb_gb18030_v®id
},

778 { 250, 1, "gb18030", "gb18030_unicode_520_ci", "", 54936, "GB18030", 1, 4, 
mysql_mbch¬Ën_gb18030
, 
check_mb_gb18030_v®id
},

781 { 254, 1, 
UTF8_MB3
, UTF8_MB3"_g’”®_cs", "", 65001, "UTF-8", 1, 3, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

783 { 255, 1, 
UTF8_MB4
, UTF8_MB4"_0900_ai_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

784 { 256, 1, 
UTF8_MB4
, UTF8_MB4"_de_pb_0900_ai_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

785 { 257, 1, 
UTF8_MB4
, UTF8_MB4"_is_0900_ai_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

786 { 258, 1, 
UTF8_MB4
, UTF8_MB4"_lv_0900_ai_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

787 { 259, 1, 
UTF8_MB4
, UTF8_MB4"_ro_0900_ai_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

788 { 260, 1, 
UTF8_MB4
, UTF8_MB4"_¦_0900_ai_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

789 { 261, 1, 
UTF8_MB4
, UTF8_MB4"_¶_0900_ai_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

790 { 262, 1, 
UTF8_MB4
, UTF8_MB4"_‘_0900_ai_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

791 { 263, 1, 
UTF8_MB4
, UTF8_MB4"_es_0900_ai_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

792 { 264, 1, 
UTF8_MB4
, UTF8_MB4"_sv_0900_ai_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

793 { 265, 1, 
UTF8_MB4
, UTF8_MB4"_Œ_0900_ai_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

794 { 266, 1, 
UTF8_MB4
, UTF8_MB4"_cs_0900_ai_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

795 { 267, 1, 
UTF8_MB4
, UTF8_MB4"_da_0900_ai_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

796 { 268, 1, 
UTF8_MB4
, UTF8_MB4"_É_0900_ai_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

797 { 269, 1, 
UTF8_MB4
, UTF8_MB4"_sk_0900_ai_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

798 { 270, 1, 
UTF8_MB4
, UTF8_MB4"_es_Œad_0900_ai_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

799 { 271, 1, 
UTF8_MB4
, UTF8_MB4"_Ï_0900_ai_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

800 { 273, 1, 
UTF8_MB4
, UTF8_MB4"_eo_0900_ai_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

801 { 274, 1, 
UTF8_MB4
, UTF8_MB4"_hu_0900_ai_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

802 { 275, 1, 
UTF8_MB4
, UTF8_MB4"_hr_0900_ai_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

803 { 277, 1, 
UTF8_MB4
, UTF8_MB4"_vi_0900_ai_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

804 { 278, 1, 
UTF8_MB4
, UTF8_MB4"_0900_as_cs", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

805 { 279, 1, 
UTF8_MB4
, UTF8_MB4"_de_pb__0900_as_cs", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

806 { 280, 1, 
UTF8_MB4
, UTF8_MB4"_is_0900_as_cs", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

807 { 281, 1, 
UTF8_MB4
, UTF8_MB4"_lv_0900_as_cs", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

808 { 282, 1, 
UTF8_MB4
, UTF8_MB4"_ro_0900_as_cs", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

809 { 283, 1, 
UTF8_MB4
, UTF8_MB4"_¦_0900_as_cs", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

810 { 284, 1, 
UTF8_MB4
, UTF8_MB4"_¶_0900_as_cs", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

811 { 285, 1, 
UTF8_MB4
, UTF8_MB4"_‘_0900_as_cs", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

812 { 286, 1, 
UTF8_MB4
, UTF8_MB4"_es_0900_as_cs", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

813 { 287, 1, 
UTF8_MB4
, UTF8_MB4"_sv_0900_as_cs", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

814 { 288, 1, 
UTF8_MB4
, UTF8_MB4"_Œ_0900_as_cs", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

815 { 289, 1, 
UTF8_MB4
, UTF8_MB4"_cs_0900_as_cs", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

816 { 290, 1, 
UTF8_MB4
, UTF8_MB4"_da_0900_as_cs", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

817 { 291, 1, 
UTF8_MB4
, UTF8_MB4"_É_0900_as_cs", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

818 { 292, 1, 
UTF8_MB4
, UTF8_MB4"_sk_0900_as_cs", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

819 { 293, 1, 
UTF8_MB4
, UTF8_MB4"_es_Œad_0900_as_cs", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

820 { 294, 1, 
UTF8_MB4
, UTF8_MB4"_Ï_0900_as_cs", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

821 { 296, 1, 
UTF8_MB4
, UTF8_MB4"_eo_0900_as_cs", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

822 { 297, 1, 
UTF8_MB4
, UTF8_MB4"_hu_0900_as_cs", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

823 { 298, 1, 
UTF8_MB4
, UTF8_MB4"_hr_0900_as_cs", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

824 { 300, 1, 
UTF8_MB4
, UTF8_MB4"_vi_0900_as_cs", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

825 { 303, 1, 
UTF8_MB4
, UTF8_MB4"_ja_0900_as_cs", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

826 { 304, 1, 
UTF8_MB4
, UTF8_MB4"_ja_0900_as_cs_ks", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

827 { 305, 1, 
UTF8_MB4
, UTF8_MB4"_0900_as_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

828 { 306, 1, 
UTF8_MB4
, UTF8_MB4"_ru_0900_as_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

829 { 307, 1, 
UTF8_MB4
, UTF8_MB4"_ru_0900_as_cs", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

830 { 576, 1, 
UTF8_MB3
, UTF8_MB3"_üßtŸn_ci", "", 65001, "UTF-8", 1, 3, 
mysql_mbch¬Ën_utf8mb3
, 
check_mb_utf8mb3_v®id
},

831 { 577, 1, 
UTF8_MB3
, UTF8_MB3"_myªm¬_ci", "", 65001, "UTF-8", 1, 3, 
mysql_mbch¬Ën_utf8mb3
, 
check_mb_utf8mb3_v®id
},

832 { 578, 1, 
UTF8_MB3
, UTF8_MB3"_thai_520_w2", "", 65001, "UTF-8", 1, 3, 
mysql_mbch¬Ën_utf8mb3
, 
check_mb_utf8mb3_v®id
},

833 { 608, 1, 
UTF8_MB4
, UTF8_MB4"_üßtŸn_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

834 { 609, 1, 
UTF8_MB4
, UTF8_MB4"_myªm¬_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

835 { 610, 1, 
UTF8_MB4
, UTF8_MB4"_thai_520_w2", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

836 { 640, 1, "ucs2", "ucs2_üßtŸn_ci", "", 1200, "UCS2-BE", 2, 2, 
mysql_mbch¬Ën_ucs2
, 
check_mb_ucs2
},

837 { 641, 1, "ucs2", "ucs2_myªm¬_ci", "", 1200, "UCS2-BE", 2, 2, 
mysql_mbch¬Ën_ucs2
, 
check_mb_ucs2
},

838 { 642, 1, "ucs2", "ucs2_thai_520_w2", "", 1200, "UCS2-BE", 2, 2, 
mysql_mbch¬Ën_ucs2
, 
check_mb_ucs2
},

839 { 672, 1, "utf16", "utf16_üßtŸn_ci", "", 0, "UTF16", 2, 4, 
mysql_mbch¬Ën_utf16
, 
check_mb_utf16
},

840 { 673, 1, "utf16", "utf16_myªm¬_ci", "", 0, "UTF16", 2, 4, 
mysql_mbch¬Ën_utf16
, 
check_mb_utf16
},

841 { 674, 1, "utf16", "utf16_thai_520_w2", "", 0, "UTF16", 2, 4, 
mysql_mbch¬Ën_utf16
, 
check_mb_utf16
},

842 { 736, 1, "utf32", "utf32_üßtŸn_ci", "", 0, "UTF32", 4, 4, 
mysql_mbch¬Ën_utf32
, 
check_mb_utf32
},

843 { 737, 1, "utf32", "utf32_myªm¬_ci", "", 0, "UTF32", 4, 4, 
mysql_mbch¬Ën_utf32
, 
check_mb_utf32
},

844 { 738, 1, "utf32", "utf32_thai_520_w2", "", 0, "UTF32", 4, 4, 
mysql_mbch¬Ën_utf32
, 
check_mb_utf32
},

845 {1025, 1, "big5","big5_chše£_nÝad_ci", "", 950, "BIG5", 1, 2, 
mysql_mbch¬Ën_big5
, 
check_mb_big5
},

846 {1027, 1, "dec8", "dec8_swedisch_nÝad_ci", "", 0, "DEC", 1, 1, 
NULL
, NULL},

847 {1028, 1, "ý850", "ý850_g’”®_nÝad_ci", "", 850, "CP850", 1, 1, 
NULL
, NULL},

848 {1030, 1, "hp8", "hp8_’glish_nÝad_ci", "", 0, "HP-ROMAN8", 1, 1, 
NULL
, NULL},

849 {1031, 1, "koi8r", "koi8r_g’”®_nÝad_ci", "", 878, "KOI8R", 1, 1, 
NULL
, NULL},

850 {1032, 1, "Ïtš1", "Ïtš1_swedish_nÝad_ci", "", 850, "LATIN1", 1, 1, 
NULL
, NULL},

851 {1033, 1, "Ïtš2", "Ïtš2_g’”®_nÝad_ci", "", 852, "LATIN2", 1, 1, 
NULL
, NULL},

852 {1034, 1, "swe7", "swe7_swedish_nÝad_ci", "", 20107, "", 1, 1, 
NULL
, NULL},

853 {1035, 1, "ascii", "ascii_g’”®_nÝad_ci", "", 1252, "ASCII", 1, 1, 
NULL
, NULL},

854 {1036, 1, "ujis", "ujis_j­ªe£_nÝad_ci", "", 20932, "UJIS", 1, 3, 
mysql_mbch¬Ën_ujis
, 
check_mb_ujis
},

855 {1037, 1, "sjis", "sjis_j­ªe£_nÝad_ci", "", 932, "SJIS", 1, 2, 
mysql_mbch¬Ën_sjis
, 
check_mb_sjis
},

856 {1040, 1, "heb»w", "heb»w_g’”®_nÝad_ci", "", 1255, "HEBREW", 1, 1, 
NULL
, NULL},

857 {1042, 1, "tis620", "tis620_thai_nÝad_ci", "", 874, "TIS620", 1, 1, 
NULL
, NULL},

858 {1043, 1, "euckr", "euckr_kÜ—n_nÝad_ci", "", 51949, "EUCKR", 1, 2, 
mysql_mbch¬Ën_euckr
, 
check_mb_euckr
},

859 {1046, 1, "koi8u", "koi8u_g’”®_nÝad_ci", "", 20866, "KOI8U", 1, 1, 
NULL
, NULL},

860 {1048, 1, "gb2312", "gb2312_chše£_nÝad_ci", "", 936, "GB2312", 1, 2, 
mysql_mbch¬Ën_gb2312
, 
check_mb_gb2312
},

861 {1049, 1, "g»ek", "g»ek_g’”®_nÝad_ci", "", 28597, "GREEK", 1, 1, 
NULL
, NULL},

862 {1050, 1, "ý1250", "ý1250_g’”®_nÝad_ci", "", 1250, "CP1250", 1, 1, 
NULL
, NULL},

863 {1052, 1, "gbk", "gbk_chše£_nÝad_ci", "", 936, "GBK", 1, 2, 
mysql_mbch¬Ën_gbk
, 
check_mb_gbk
},

864 {1054, 1, "Ïtš5", "Ïtš5_turkish_nÝad_ci", "", 1254, "LATIN5", 1, 1, 
NULL
, NULL},

865 {1056, 1, "¬mscii8", "¬mscii8_g’”®_nÝad_ci", "", 0, "ARMSCII-8", 1, 1, 
NULL
, NULL},

866 {1057, 1, 
UTF8_MB3
, UTF8_MB3"_g’”®_nÝad_ci", "", 65001, "UTF-8", 1, 3, 
mysql_mbch¬Ën_utf8mb3
, 
check_mb_utf8mb3_v®id
},

867 {1059, 1, "ucs2", "ucs2_g’”®_nÝad_ci", "", 1200, "UCS-2BE", 2, 2, 
mysql_mbch¬Ën_ucs2
, 
check_mb_ucs2
},

868 {1060, 1, "ý866", "ý866_g’”®_nÝad_ci", "", 866, "CP866", 1, 1, 
NULL
, NULL},

869 {1061, 1, "keybcs2", "keybcs2_g’”®_nÝad_ci", "", 0, "", 1, 1, 
NULL
, NULL},

870 {1062, 1, "macû", "macû_g’”®_nÝad_ci", "", 10029, "CP1282", 1, 1, 
NULL
, NULL},

871 {1063, 1, "maüomª", "maüomª_g’”®_nÝad_ci", "", 10000, "MACINTOSH", 1, 1, 
NULL
, NULL},

872 {1064, 1, "ý852", "ý852_g’”®_nÝad_ci", "", 852, "CP852", 1, 1, 
NULL
, NULL},

873 {1065, 1, "Ïtš7", "Ïtš7_g’”®_nÝad_ci", "", 28603, "LATIN7", 1, 1, 
NULL
, NULL},

874 {1067, 1, "macû", "macû_nÝad_bš", "", 10029, "CP1282", 1, 1, 
NULL
, NULL},

875 {1069, 1, 
UTF8_MB4
, UTF8_MB4"_g’”®_nÝad_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

876 {1070, 1, 
UTF8_MB4
, UTF8_MB4"_g’”®_nÝad_bš", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

877 {1071, 1, "Ïtš1", "Ïtš1_nÝad_bš", "", 850, "LATIN1", 1, 1, 
NULL
, NULL},

878 {1074, 1, "ý1251", "ý1251_nÝad_bš", "", 1251, "CP1251", 1, 1, 
NULL
, NULL},

879 {1075, 1, "ý1251", "ý1251_g’”®_nÝad_ci", "", 1251, "CP1251", 1, 1, 
NULL
, NULL},

880 {1077, 1, "maüomª", "maüomª_nÝad_bš", "", 10000, "MACINTOSH", 1, 1, 
NULL
, NULL},

881 {1078, 1, "utf16", "utf16_g’”®_nÝad_ci", "", 0, "UTF16", 2, 4, 
mysql_mbch¬Ën_utf16
, 
check_mb_utf16
},

882 {1079, 1, "utf16", "utf16_nÝad_bš", "", 0, "UTF16", 2, 4, 
mysql_mbch¬Ën_utf16
, 
check_mb_utf16
},

883 {1080, 1, "utf16Ë", "utf16Ë_g’”®_nÝad_ci", "", 1200, "UTF16LE", 2, 4, 
mysql_mbch¬Ën_utf16
, 
check_mb_utf16
},

884 {1081, 1, "ý1256", "ý1256_g’”®_nÝad_ci", "", 1256, "CP1256", 1, 1, 
NULL
, NULL},

885 {1082, 1, "ý1257", "ý1257_nÝad_bš", "", 1257, "CP1257", 1, 1, 
NULL
, NULL},

886 {1083, 1, "ý1257", "ý1257_g’”®_nÝad_ci", "", 1257, "CP1257", 1, 1, 
NULL
, NULL},

887 {1084, 1, "utf32", "utf32_g’”®_nÝad_ci", "", 0, "UTF32", 4, 4, 
mysql_mbch¬Ën_utf32
, 
check_mb_utf32
},

888 {1085, 1, "utf32", "utf32_nÝad_bš", "", 0, "UTF32", 4, 4, 
mysql_mbch¬Ën_utf32
, 
check_mb_utf32
},

889 {1086, 1, "utf16Ë", "utf16Ë_nÝad_bš", "", 1200, "UTF16LE", 2, 4, 
mysql_mbch¬Ën_utf16
, 
check_mb_utf16
},

890 {1088, 1, "¬mscii8", "¬mscii8_nÝad_bš", "", 0, "ARMSCII-8", 1, 1, 
NULL
, NULL},

891 {1089, 1, "ascii", "ascii_nÝad_bš", "", 1252, "ASCII", 1, 1, 
NULL
, NULL},

892 {1090, 1, "ý1250", "ý1250_nÝad_bš", "", 1250, "CP1250", 1, 1, 
NULL
, NULL},

893 {1091, 1, "ý1256", "ý1256_nÝad_bš", "", 1256, "CP1256", 1, 1, 
NULL
, NULL},

894 {1092, 1, "ý866", "ý866_nÝad_bš", "", 866, "CP866", 1, 1, 
NULL
, NULL},

895 {1093, 1, "dec8", "dec8_nÝad_bš", "", 0, "DEC", 1, 1, 
NULL
, NULL},

896 {1094, 1, "g»ek", "g»ek_nÝad_bš", "", 28597, "GREEK", 1, 1, 
NULL
, NULL},

897 {1095, 1, "heb»w", "heb»w_nÝad_bš", "", 1255, "HEBREW", 1, 1, 
NULL
, NULL},

898 {1096, 1, "hp8", "hp8_nÝad_bš", "", 0, "HP-ROMAN8", 1, 1, 
NULL
, NULL},

899 {1097, 1, "keybcs2", "keybcs2_nÝad_bš", "", 0, "", 1, 1, 
NULL
, NULL},

900 {1098, 1, "koi8r", "koi8r_nÝad_bš", "", 878, "KOI8R", 1, 1, 
NULL
, NULL},

901 {1099, 1, "koi8u", "koi8u_nÝad_bš", "", 20866, "KOI8U", 1, 1, 
NULL
, NULL},

902 {1101, 1, "Ïtš2", "Ïtš2_nÝad_bš", "", 852, "LATIN2", 1, 1, 
NULL
, NULL},

903 {1102, 1, "Ïtš5", "Ïtš5_nÝad_bš", "", 1254, "LATIN5", 1, 1, 
NULL
, NULL},

904 {1103, 1, "Ïtš7", "Ïtš7_nÝad_bš", "", 28603, "LATIN7", 1, 1, 
NULL
, NULL},

905 {1104, 1, "ý850", "ý850_nÝad_bš", "", 850, "CP850", 1, 1, 
NULL
, NULL},

906 {1105, 1, "ý852", "ý852_nÝad_bš", "", 852, "CP852", 1, 1, 
NULL
, NULL},

907 {1106, 1, "swe7", "swe7_nÝad_bš", "", 20107, "", 1, 1, 
NULL
, NULL},

908 {1107, 1, 
UTF8_MB3
, UTF8_MB3"_nÝad_bš", "", 65001, "UTF-8", 1, 3, 
mysql_mbch¬Ën_utf8mb3
, 
check_mb_utf8mb3_v®id
},

909 {1108, 1, "big5","big5_nÝad_bš", "", 950, "BIG5", 1, 2, 
mysql_mbch¬Ën_big5
, 
check_mb_big5
},

910 {1109, 1, "euckr", "euckr_nÝad_bš", "", 51949, "EUCKR", 1, 2, 
mysql_mbch¬Ën_euckr
, 
check_mb_euckr
},

911 {1110, 1, "gb2312", "gb2312_nÝad_bš", "", 936, "GB2312", 1, 2, 
mysql_mbch¬Ën_gb2312
, 
check_mb_gb2312
},

912 {1111, 1, "gbk", "gbk_nÝad_bš", "", 936, "GBK", 1, 2, 
mysql_mbch¬Ën_gbk
, 
check_mb_gbk
},

913 {1112, 1, "sjis", "sjis_nÝad_bš", "", 932, "SJIS", 1, 2, 
mysql_mbch¬Ën_sjis
, 
check_mb_sjis
},

914 {1113, 1, "tis620", "tis620_nÝad_bš", "", 874, "TIS620", 1, 1, 
NULL
, NULL},

915 {1114, 1, "ucs2", "ucs2_nÝad_bš", "", 1200, "UCS-2BE", 2, 2, 
mysql_mbch¬Ën_ucs2
, 
check_mb_ucs2
},

916 {1115, 1, "ujis", "ujis_nÝad_bš", "", 20932, "UJIS", 1, 3, 
mysql_mbch¬Ën_ujis
, 
check_mb_ujis
},

917 {1116, 1, "geo¡d8", "geo¡d8_g’”®_nÝad_ci", "", 0, "GEORGIAN-PS", 1, 1, 
NULL
, NULL},

918 {1117, 1, "geo¡d8", "geo¡d8_nÝad_bš", "", 0, "GEORGIAN-PS", 1, 1, 
NULL
, NULL},

919 {1119, 1, "ý932", "ý932_j­ªe£_nÝad_ci", "", 932, "CP932", 1, 2, 
mysql_mbch¬Ën_ý932
, 
check_mb_ý932
},

920 {1120, 1, "ý932", "ý932_nÝad_bš", "", 932, "CP932", 1, 2, 
mysql_mbch¬Ën_ý932
, 
check_mb_ý932
},

921 {1121, 1, "eucjpms", "eucjpms_j­ªe£_nÝad_ci", "", 932, "EUCJP-MS", 1, 3, 
mysql_mbch¬Ën_eucjpms
, 
check_mb_eucjpms
},

922 {1122, 1, "eucjpms", "eucjpms_nÝad_bš", "", 932, "EUCJP-MS", 1, 3, 
mysql_mbch¬Ën_eucjpms
, 
check_mb_eucjpms
},

923 {1125, 1, "utf16", "utf16_unicode_nÝad_ci", "", 1200, "UTF16", 2, 4, 
mysql_mbch¬Ën_utf16
, 
check_mb_utf16
},

924 {1147, 1, "utf16", "utf16_unicode_520_nÝad_ci", "", 1200, "UTF16", 2, 4, 
mysql_mbch¬Ën_utf16
, 
check_mb_utf16
},

925 {1152, 1, "ucs2", "ucs2_unicode_nÝad_ci", "", 1200, "UCS-2BE", 2, 2, 
mysql_mbch¬Ën_ucs2
, 
check_mb_ucs2
},

926 {1174, 1, "ucs2", "ucs2_unicode_520_nÝad_ci", "", 1200, "UCS-2BE", 2, 2, 
mysql_mbch¬Ën_ucs2
, 
check_mb_ucs2
},

927 {1184, 1, "utf32", "utf32_unicode_nÝad_ci", "", 0, "UTF32", 4, 4, 
mysql_mbch¬Ën_utf32
, 
check_mb_utf32
},

928 {1206, 1, "utf32", "utf32_unicode_520_nÝad_ci", "", 0, "UTF32", 4, 4, 
mysql_mbch¬Ën_utf32
, 
check_mb_utf32
},

929 {1216, 1, 
UTF8_MB3
, UTF8_MB3"_unicode_nÝad_ci", "", 65001, "UTF-8", 1, 3, 
mysql_mbch¬Ën_utf8mb3
, 
check_mb_utf8mb3_v®id
},

930 {1238, 1, 
UTF8_MB3
, UTF8_MB3"_unicode_520_nÝad_ci", "", 65001, "UTF-8", 1, 3, 
mysql_mbch¬Ën_utf8mb3
, 
check_mb_utf8mb3_v®id
},

931 {1248, 1, 
UTF8_MB4
, UTF8_MB4"_unicode_nÝad_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

932 {1270, 1, 
UTF8_MB4
, UTF8_MB4"_unicode_520_nÝad_ci", "", 65001, "UTF-8", 1, 4, 
mysql_mbch¬Ën_utf8
, 
check_mb_utf8_v®id
},

933 { 0, 0, 
NULL
, NULL, NULL, 0, NULL, 0, 0, NULL, NULL}

939 cÚ¡ 
MARIADB_CHARSET_INFO
 * 
	$mysql_fšd_ch¬£t_Ä
(
ch¬£Šr
)

941 cÚ¡ 
MARIADB_CHARSET_INFO
 * 
c
 = 
m¬Ÿdb_compžed_ch¬£ts
;

944 ià(
c
->
Ä
 =ð
ch¬£Šr
) {

945 (
c
);

947 ++
c
;

948 } 
c
[0].
Ä
 != 0);

949 (
NULL
);

950 
	}
}

955 
MARIADB_CHARSET_INFO
 * 
	$mysql_fšd_ch¬£t_Çme
(cÚ¡ *
Çme
)

957 
MARIADB_CHARSET_INFO
 *
c
 = (MARIADB_CHARSET_INFO *)
m¬Ÿdb_compžed_ch¬£ts
;

958 cÚ¡ *
c¢ame
;

960 ià(!
	`¡rÿ£cmp
(
Çme
, 
MADB_AUTODETECT_CHARSET_NAME
))

961 
c¢ame
ð
	`madb_g‘_os_ch¬aù”_£t
();

963 
c¢ame
ð(*)
Çme
;

966 ià(!
	`¡rÿ£cmp
(
c
->
c¢ame
, csname)) {

967 (
c
);

969 ++
c
;

970 } 
c
[0].
Ä
 != 0);

971 (
NULL
);

972 
	}
}

977 
size_t
 
	$mysql_c£t_esÿ³_quÙes
(cÚ¡ 
MARIADB_CHARSET_INFO
 *
c£t
, *
Ãw¡r
,

978 cÚ¡ * 
esÿ³¡r
, 
size_t
 
esÿ³¡r_Ën
 )

980 cÚ¡ *
Ãw¡r_s
 = 
Ãw¡r
;

981 cÚ¡ *
Ãw¡r_e
 = 
Ãw¡r
 + 2 * 
esÿ³¡r_Ën
;

982 cÚ¡ *
’d
 = 
esÿ³¡r
 + 
esÿ³¡r_Ën
;

983 
my_boÞ
 
esÿ³_ov”æow
 = 
FALSE
;

985 ;
esÿ³¡r
 < 
’d
;ƒscapestr++) {

986 
Ën
 = 0;

989 ià(
c£t
->
ch¬_maxËn
 > 1 && (
Ën
 = c£t->
	`mb_v®id
(
esÿ³¡r
, 
’d
))) {

992 ià((
Ãw¡r
 + 
Ën
è> 
Ãw¡r_e
) {

993 
esÿ³_ov”æow
 = 
TRUE
;

997 
Ën
--) {

998 *
Ãw¡r
++ = *
esÿ³¡r
++;

1000 
esÿ³¡r
--;

1003 ià(*
esÿ³¡r
 == '\'') {

1004 ià(
Ãw¡r
 + 2 > 
Ãw¡r_e
) {

1005 
esÿ³_ov”æow
 = 
TRUE
;

1008 *
Ãw¡r
++ = '\'';

1009 *
Ãw¡r
++ = '\'';

1011 ià(
Ãw¡r
 + 1 > 
Ãw¡r_e
) {

1012 
esÿ³_ov”æow
 = 
TRUE
;

1015 *
Ãw¡r
++ = *
esÿ³¡r
;

1018 *
Ãw¡r
 = '\0';

1020 ià(
esÿ³_ov”æow
) {

1021 ((
size_t
)~0);

1023 ((
size_t
)(
Ãw¡r
 - 
Ãw¡r_s
));

1024 
	}
}

1029 
size_t
 
	$mysql_c£t_esÿ³_¦ashes
(cÚ¡ 
MARIADB_CHARSET_INFO
 * 
c£t
, *
Ãw¡r
,

1030 cÚ¡ * 
esÿ³¡r
, 
size_t
 
esÿ³¡r_Ën
 )

1032 cÚ¡ *
Ãw¡r_s
 = 
Ãw¡r
;

1033 cÚ¡ *
Ãw¡r_e
 = 
Ãw¡r
 + 2 * 
esÿ³¡r_Ën
;

1034 cÚ¡ *
’d
 = 
esÿ³¡r
 + 
esÿ³¡r_Ën
;

1035 
my_boÞ
 
esÿ³_ov”æow
 = 
FALSE
;

1037 ;
esÿ³¡r
 < 
’d
;ƒscapestr++) {

1038 
esc
 = '\0';

1039 
Ën
 = 0;

1042 ià(
c£t
->
ch¬_maxËn
 > 1 && (
Ën
 = c£t->
	`mb_v®id
(
esÿ³¡r
, 
’d
))) {

1044 ià((
Ãw¡r
 + 
Ën
è> 
Ãw¡r_e
) {

1045 
esÿ³_ov”æow
 = 
TRUE
;

1049 
Ën
--) {

1050 *
Ãw¡r
++ = *
esÿ³¡r
++;

1052 
esÿ³¡r
--;

1055 ià(
c£t
->
ch¬_maxËn
 > 1 && c£t->
	`mb_ch¬Ën
(*
esÿ³¡r
) > 1) {

1056 
esc
 = *
esÿ³¡r
;

1058 *
esÿ³¡r
) {

1060 
esc
 = '0';

1063 
esc
 = 'n';

1066 
esc
 = 'r';

1071 
esc
 = *
esÿ³¡r
;

1074 
esc
 = 'Z';

1078 ià(
esc
) {

1079 ià(
Ãw¡r
 + 2 > 
Ãw¡r_e
) {

1080 
esÿ³_ov”æow
 = 
TRUE
;

1084 *
Ãw¡r
++ = '\\';

1085 *
Ãw¡r
++ = 
esc
;

1087 ià(
Ãw¡r
 + 1 > 
Ãw¡r_e
) {

1088 
esÿ³_ov”æow
 = 
TRUE
;

1092 *
Ãw¡r
++ = *
esÿ³¡r
;

1095 *
Ãw¡r
 = '\0';

1097 ià(
esÿ³_ov”æow
) {

1098 ((
size_t
)~0);

1100 ((
size_t
)(
Ãw¡r
 - 
Ãw¡r_s
));

1101 
	}
}

1105 
	s¡_madb_os_ch¬£t
 {

1106 cÚ¡ *
	mid’tif›r
;

1107 cÚ¡ *
	mdesütiÚ
;

1108 cÚ¡ *
	mch¬£t
;

1109 cÚ¡ *
	micÚv_cs
;

1110 
	msuµÜ‹d
;

1113 
	#MADB_CS_UNSUPPORTED
 0

	)

1114 
	#MADB_CS_APPROX
 1

	)

1115 
	#MADB_CS_EXACT
 2

	)

1118 
¡_madb_os_ch¬£t
 
	gMADB_OS_CHARSET
[]=

1120 #ifdeà
_WIN32


1122 {"037", "IBM EBCDIC US-Cªada", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1123 {"437", "OEM Un™ed S‹s", "ý850", 
NULL
, 
MADB_CS_APPROX
},

1124 {"500", "IBM EBCDIC IÁ”ÇtiÚ®", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1125 {"708", "A¿biø(ASMO 708)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1126 {"709", "A¿biø(ASMO-449+, BCON V4)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1127 {"710", "T¿n¥¬’ˆA¿bic", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1128 {"720", "A¿biø(DOS)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1129 {"737", "G»ek (DOS)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1130 {"775", "B®tiø(DOS)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1131 {"850", "We¡”ÀEurÝ—À(DOS)", "ý850", 
NULL
, 
MADB_CS_EXACT
},

1132 {"852", "C’Œ® EurÝ—À(DOS)", "ý852", 
NULL
, 
MADB_CS_EXACT
},

1133 {"855", "CyržliøÕrim¬žy RussŸn)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1134 {"857", "Turkish (DOS)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1135 {"858", "OEM MuÉžšgu® L©š 1 + EurØsymbÞ", "ý850", 
NULL
, 
MADB_CS_EXACT
},

1136 {"860", "PÜtugue£ (DOS)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1137 {"861", "IûÏndiø(DOS)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1138 {"862", "Heb»w (DOS)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1139 {"863", "F»nch CªadŸÀ(DOS)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1140 {"864", "A¿biø(864)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1141 {"865", "NÜdiø(DOS)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1142 {"866", "Cyržliø(DOS)", "ý866", 
NULL
, 
MADB_CS_EXACT
},

1143 {"869", "G»ek, Mod”À(DOS)", "g»ek", 
NULL
, 
MADB_CS_EXACT
},

1144 {"870", "IBM EBCDIC MuÉžšgu® L©š 2", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1145 {"874", "Tha˜(Wšdows)", "tis620", 
NULL
, 
MADB_CS_UNSUPPORTED
},

1146 {"875", "G»ek Mod”n", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1147 {"932", "J­ªe£ (Shiá-JIS)", "ý932", 
NULL
, 
MADB_CS_EXACT
},

1148 {"936", "Chše£ Sim¶if›d (GB2312)", "gbk", 
NULL
, 
MADB_CS_EXACT
},

1149 {"949", "ANSI/OEM KÜ—À(Unif›d HªguÈCode)", "euckr", 
NULL
, 
MADB_CS_EXACT
},

1150 {"950", "Chše£ T¿d™iÚ® (Big5)", "big5", 
NULL
, 
MADB_CS_EXACT
},

1151 {"1026", "EBCDIC Turkish (L©š 5)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1152 {"1047", "EBCDIC L©š 1/O³ÀSy¡em", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1153 {"1140", "IBM EBCDIC (US-Cªada-Euro)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1154 {"1141", "IBM EBCDIC (G”mªy-Euro)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1155 {"1142", "IBM EBCDIC (D’m¬k-NÜway-Euro)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1156 {"1143", "IBM EBCDIC (FšÏnd-Swed’-Euro)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1157 {"1144", "IBM EBCDIC (Ily-Euro)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1158 {"1145", "IBM EBCDIC (S·š-Euro)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1159 {"1146", "IBM EBCDIC (UK-Euro)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1160 {"1147", "IBM EBCDIC (F¿nû-Euro)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1161 {"1148", "IBM EBCDIC (IÁ”ÇtiÚ®-Euro)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1162 {"1149", "IBM EBCDIC (IûÏndic-Euro)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1163 {"1200", "UTF-16,†™Ž’dŸÀby‹ ord”", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1164 {"1201", "UTF-16, bigƒndŸÀby‹ ord”", "utf16", 
NULL
, 
MADB_CS_UNSUPPORTED
},

1165 {"1250", "C’Œ® EurÝ—À(Wšdows)", "ý1250", 
NULL
, 
MADB_CS_EXACT
},

1166 {"1251", "Cyržliø(Wšdows)", "ý1251", 
NULL
, 
MADB_CS_EXACT
},

1167 {"1252", "We¡”ÀEurÝ—À(Wšdows)", "Ïtš1", 
NULL
, 
MADB_CS_EXACT
},

1168 {"1253", "G»ek (Wšdows)", "g»ek", 
NULL
, 
MADB_CS_EXACT
},

1169 {"1254", "Turkish (Wšdows)", "Ïtš5", 
NULL
, 
MADB_CS_EXACT
},

1170 {"1255", "Heb»w (Wšdows)", "hewb»w", 
NULL
, 
MADB_CS_EXACT
},

1171 {"1256", "A¿biø(Wšdows)", "ý1256", 
NULL
, 
MADB_CS_EXACT
},

1172 {"1257", "B®tiø(Wšdows)","ý1257", 
NULL
, 
MADB_CS_EXACT
},

1173 {"1258", "V›Šame£ (Wšdows)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1174 {"1361", "KÜ—À(Johab)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1175 {"10000", "We¡”ÀEurÝ—À(Mac)", "maüomª", 
NULL
, 
MADB_CS_EXACT
},

1176 {"10001", "J­ªe£ (Mac)", "sjis", 
NULL
, 
MADB_CS_EXACT
},

1177 {"10002", "Chše£ T¿d™iÚ® (Mac)", "big5", 
NULL
, 
MADB_CS_EXACT
},

1178 {"10003", "KÜ—À(Mac)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1179 {"10004", "A¿biø(Mac)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1180 {"10005", "Heb»w (Mac)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1181 {"10006", "G»ek (Mac)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1182 {"10007", "Cyržliø(Mac)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1183 {"10008", "Chše£ Sim¶if›d (Mac)", "gb2312", 
NULL
, 
MADB_CS_EXACT
},

1184 {"10010", "RomªŸÀ(Mac)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1185 {"10017", "Uk¿šŸÀ(Mac)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1186 {"10021", "Tha˜(Mac)", "tis620", 
NULL
, 
MADB_CS_EXACT
},

1187 {"10029", "C’Œ® EurÝ—À(Mac)", "macû", 
NULL
, 
MADB_CS_EXACT
},

1188 {"10079", "IûÏndiø(Mac)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1189 {"10081", "Turkish (Mac)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1190 {"10082", "CrßtŸÀ(Mac)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1191 {"12000", "UnicodUTF-32,†™Ž’dŸÀby‹ ord”", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1192 {"12001", "UnicodUTF-32, bigƒndŸÀby‹ ord”", "utf32", 
NULL
, 
MADB_CS_UNSUPPORTED
},

1193 {"20000", "Chše£ T¿d™iÚ® (CNS)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1194 {"20001", "TCA Taiwª", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1195 {"20002", "Chše£ T¿d™iÚ® (E‹n)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1196 {"20003", "IBM5550 Taiwª", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1197 {"20004", "T–eTexˆTaiwª", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1198 {"20005", "Wªg Taiwª", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1199 {"20105", "We¡”ÀEurÝ—À(IA5)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1200 {"20106", "IA5 G”mª (7-b™)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1201 {"20107", "Swedish (7-b™)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1202 {"20108", "NÜwegŸÀ(7-b™)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1203 {"20127", "US-ASCII (7-b™)", "ascii", 
NULL
, 
MADB_CS_EXACT
},

1204 {"20261", "T.61", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1205 {"20269", "NÚ-S·cšg AcûÁ", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1206 {"20273", "EBCDIC G”mªy", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1207 {"20277", "EBCDIC D’m¬k-NÜway", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1208 {"20278", "EBCDIC FšÏnd-Swed’", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1209 {"20280", "EBCDIC Ily", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1210 {"20284", "EBCDIC L©š Am”iÿ-S·š", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1211 {"20285", "EBCDIC Un™ed Kšgdom", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1212 {"20290", "EBCDIC J­ªe£ K©akª¨Ex‹nded", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1213 {"20297", "EBCDIC F¿nû", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1214 {"20420", "EBCDIC A¿bic", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1215 {"20423", "EBCDIC G»ek", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1216 {"20424", "EBCDIC Heb»w", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1217 {"20833", "EBCDIC KÜ—ÀEx‹nded", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1218 {"20838", "EBCDIC Thai", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1219 {"20866", "Cyržliø(KOI8-R)", "koi8r", 
NULL
, 
MADB_CS_EXACT
},

1220 {"20871", "EBCDIC IûÏndic", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1221 {"20880", "EBCDIC CyržliøRussŸn", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1222 {"20905", "EBCDIC Turkish", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1223 {"20924", "EBCDIC L©š 1/O³ÀSy¡em (1047 + EurØsymbÞ)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1224 {"20932", "J­ªe£ (JIS 0208-1990‡nd 0121-1990)", "ujis", 
NULL
, 
MADB_CS_EXACT
},

1225 {"20936", "Chše£ Sim¶if›d (GB2312-80)", "gb2312", 
NULL
, 
MADB_CS_APPROX
},

1226 {"20949", "KÜ—ÀWªsung", "euckr", 
NULL
, 
MADB_CS_APPROX
},

1227 {"21025", "EBCDIC CyržliøS”bŸn-Bulg¬Ÿn", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1228 {"21866", "Cyržliø(KOI8-U)", "koi8u", 
NULL
, 
MADB_CS_EXACT
},

1229 {"28591", "We¡”ÀEurÝ—À(ISO)", "Ïtš1", 
NULL
, 
MADB_CS_APPROX
},

1230 {"28592", "C’Œ® EurÝ—À(ISO)", "Ïtš2", 
NULL
, 
MADB_CS_EXACT
},

1231 {"28593", "L©š 3", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1232 {"28594", "B®tic", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1233 {"28595", "ISO 8859-5 Cyržlic", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1234 {"28596", "ISO 8859-6 A¿bic", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1235 {"28597", "ISO 8859-7 G»ek", "g»ek", 
NULL
, 
MADB_CS_EXACT
},

1236 {"28598", "Heb»w (ISO-Visu®)", "heb»w", 
NULL
, 
MADB_CS_EXACT
},

1237 {"28599", "ISO 8859-9 Turkish", "Ïtš5", 
NULL
, 
MADB_CS_EXACT
},

1238 {"28603", "ISO 8859-13 E¡ÚŸn", "Ïtš7", 
NULL
, 
MADB_CS_EXACT
},

1239 {"28605", "8859-15 L©š 9", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1240 {"29001", "EurÝ¨3", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1241 {"38598", "ISO 8859-8 Heb»w; Heb»w (ISO-Logiÿl)", "heb»w", 
NULL
, 
MADB_CS_EXACT
},

1242 {"50220", "ISO 2022 J­ªe£ w™h‚Øh®fwidth K©akªa", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1243 {"50221", "ISO 2022 J­ªe£ w™h h®fwidth K©akªa", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1244 {"50222", "ISO 2022 J­ªe£ JIS X 0201-1989", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1245 {"50225", "ISO 2022 KÜ—n", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1246 {"50227", "ISO 2022 Sim¶if›d Chše£", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1247 {"50229", "ISO 2022 T¿d™iÚ® Chše£", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1248 {"50930", "EBCDIC J­ªe£ (K©akªaèEx‹nded", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1249 {"50931", "EBCDIC US-Cªad¨ªd J­ªe£", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1250 {"50933", "EBCDIC KÜ—ÀEx‹nded‡nd KÜ—n", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1251 {"50935", "EBCDIC Sim¶if›d Chše£ Ex‹nded‡nd Sim¶if›d Chše£", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1252 {"50936", "EBCDIC Sim¶if›d Chše£", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1253 {"50937", "EBCDIC US-Cªad¨ªd T¿d™iÚ® Chše£", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1254 {"50939", "EBCDIC J­ªe£ (L©šèEx‹nded‡nd J­ªe£", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1255 {"51932", "EUC J­ªe£", "ujis", 
NULL
, 
MADB_CS_EXACT
},

1256 {"51936", "EUC Sim¶if›d Chše£; Chše£ Sim¶if›d (EUC)", "gb2312", 
NULL
, 
MADB_CS_EXACT
},

1257 {"51949", "EUC KÜ—n", "euckr", 
NULL
, 
MADB_CS_EXACT
},

1258 {"51950", "EUC T¿d™iÚ® Chše£", "big5", 
NULL
, 
MADB_CS_EXACT
},

1259 {"52936", "Chše£ Sim¶if›d (HZ)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1260 {"54936", "Chše£ Sim¶if›d (GB18030)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1261 {"57002", "ISCII Devªag¬i", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1262 {"57003", "ISCII B’g®i", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1263 {"57004", "ISCII Tamž", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1264 {"57005", "ISCII T–ugu", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1265 {"57006", "ISCII As§me£", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1266 {"57007", "ISCII Oriya", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1267 {"57008", "ISCII KªÇda", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1268 {"57009", "ISCII M®ay®am", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1269 {"57010", "ISCII Guj¬©i", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1270 {"57011", "ISCII Punjabi", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1271 {"65000", "utf-7 Unicod(UTF-7)", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1272 {"65001", "utf-8 Unicod(UTF-8)", "utf8", 
NULL
, 
MADB_CS_EXACT
},

1276 {"ASCII", "US-ASCII", "ascii", "ASCII", 
MADB_CS_APPROX
},

1277 {"US-ASCII", "US-ASCII", "ascii", "ASCII", 
MADB_CS_APPROX
},

1278 {"Big5", "Chše£ fÜ Taiwª MuÉi-by‹ s‘", "big5", "BIG5", 
MADB_CS_EXACT
},

1279 {"CP866", "IBM 866", "ý866", "CP866", 
MADB_CS_EXACT
},

1280 {"IBM-1252", "C©®ª S·š", "ý1252", "CP1252", 
MADB_CS_EXACT
},

1281 {"ISCII-DEV", "Hšdi", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1282 {"ISO-8859-1", "ISO-8859-1", "Ïtš1", "ISO_8859-1", 
MADB_CS_APPROX
},

1283 {"ISO8859-1", "ISO-8859-1", "Ïtš1", "ISO_8859-1", 
MADB_CS_APPROX
},

1284 {"ISO_8859-1", "ISO-8859-1", "Ïtš1", "ISO_8859-1", 
MADB_CS_APPROX
},

1285 {"ISO88591", "ISO-8859-1", "Ïtš1", "ISO_8859-1", 
MADB_CS_APPROX
},

1286 {"ISO-8859-13", "ISO-8859-13", "Ïtš7", "ISO_8859-13", 
MADB_CS_EXACT
},

1287 {"ISO8859-13", "ISO-8859-13", "Ïtš7", "ISO_8859-13", 
MADB_CS_EXACT
},

1288 {"ISO_8859-13", "ISO-8859-13", "Ïtš7", "ISO_8859-13", 
MADB_CS_EXACT
},

1289 {"ISO885913", "ISO-8859-13", "Ïtš7", "ISO_8859-13", 
MADB_CS_EXACT
},

1290 {"ISO-8859-15", "ISO-8859-15", "Ïtš9", "ISO_8859-15", 
MADB_CS_UNSUPPORTED
},

1291 {"ISO8859-15", "ISO-8859-15", "Ïtš9", "ISO_8859-15", 
MADB_CS_UNSUPPORTED
},

1292 {"ISO_8859-15", "ISO-8859-15", "Ïtš9", "ISO_8859-15", 
MADB_CS_UNSUPPORTED
},

1293 {"ISO885915", "ISO-8859-15", "Ïtš9", "ISO_8859-15", 
MADB_CS_UNSUPPORTED
},

1294 {"ISO-8859-2", "ISO-8859-2", "Ïtš2", "ISO_8859-2", 
MADB_CS_EXACT
},

1295 {"ISO8859-2", "ISO-8859-2", "Ïtš2", "ISO_8859-2", 
MADB_CS_EXACT
},

1296 {"ISO_8859-2", "ISO-8859-2", "Ïtš2", "ISO_8859-2", 
MADB_CS_EXACT
},

1297 {"ISO88592", "ISO-8859-2", "Ïtš2", "ISO_8859-2", 
MADB_CS_EXACT
},

1298 {"ISO-8859-7", "ISO-8859-7", "g»ek", "ISO_8859-7", 
MADB_CS_EXACT
},

1299 {"ISO8859-7", "ISO-8859-7", "g»ek", "ISO_8859-7", 
MADB_CS_EXACT
},

1300 {"ISO_8859-7", "ISO-8859-7", "g»ek", "ISO_8859-7", 
MADB_CS_EXACT
},

1301 {"ISO88597", "ISO-8859-7", "g»ek", "ISO_8859-7", 
MADB_CS_EXACT
},

1302 {"ISO-8859-8", "ISO-8859-8", "heb»w", "ISO_8859-8", 
MADB_CS_EXACT
},

1303 {"ISO8859-8", "ISO-8859-8", "heb»w", "ISO_8859-8", 
MADB_CS_EXACT
},

1304 {"ISO_8859-8", "ISO-8859-8", "heb»w", "ISO_8859-8", 
MADB_CS_EXACT
},

1305 {"ISO88598", "ISO-8859-8", "heb»w", "ISO_8859-8", 
MADB_CS_EXACT
},

1306 {"ISO-8859-9", "ISO-8859-9", "Ïtš5", "ISO_8859-9", 
MADB_CS_EXACT
},

1307 {"ISO8859-9", "ISO-8859-9", "Ïtš5", "ISO_8859-9", 
MADB_CS_EXACT
},

1308 {"ISO_8859-9", "ISO-8859-9", "Ïtš5", "ISO_8859-9", 
MADB_CS_EXACT
},

1309 {"ISO88599", "ISO-8859-9", "Ïtš5", "ISO_8859-9", 
MADB_CS_EXACT
},

1310 {"ISO-8859-4", "ISO-8859-4", 
NULL
, "ISO_8859-4", 
MADB_CS_UNSUPPORTED
},

1311 {"ISO8859-4", "ISO-8859-4", 
NULL
, "ISO_8859-4", 
MADB_CS_UNSUPPORTED
},

1312 {"ISO_8859-4", "ISO-8859-4", 
NULL
, "ISO_8859-4", 
MADB_CS_UNSUPPORTED
},

1313 {"ISO88594", "ISO-8859-4", 
NULL
, "ISO_8859-4", 
MADB_CS_UNSUPPORTED
},

1314 {"ISO-8859-5", "ISO-8859-5", 
NULL
, "ISO_8859-5", 
MADB_CS_UNSUPPORTED
},

1315 {"ISO8859-5", "ISO-8859-5", 
NULL
, "ISO_8859-5", 
MADB_CS_UNSUPPORTED
},

1316 {"ISO_8859-5", "ISO-8859-5", 
NULL
, "ISO_8859-5", 
MADB_CS_UNSUPPORTED
},

1317 {"ISO88595", "ISO-8859-5", 
NULL
, "ISO_8859-5", 
MADB_CS_UNSUPPORTED
},

1318 {"KOI8-R", "KOI8-R", "koi8r", "KOI8R", 
MADB_CS_EXACT
},

1319 {"koi8r", "KOI8-R", "koi8r", "KOI8R", 
MADB_CS_EXACT
},

1320 {"KOI8-U", "KOI8-U", "koi8u", "KOI8U", 
MADB_CS_EXACT
},

1321 {"koi8u", "KOI8-U", "koi8u", "KOI8U", 
MADB_CS_EXACT
},

1322 {"koi8t", "KOI8-T", 
NULL
, "KOI8-T", 
MADB_CS_UNSUPPORTED
},

1323 {"KOI8-T", "KOI8-T", 
NULL
, "KOI8-T", 
MADB_CS_UNSUPPORTED
},

1324 {"SJIS", "SHIFT_JIS", "sjis", "SJIS", 
MADB_CS_EXACT
},

1325 {"Shiá-JIS", "SHIFT_JIS", "sjis", "SJIS", 
MADB_CS_EXACT
},

1326 {"ªsi1251", "Cyržlic", "ý1251", "CP1251", 
MADB_CS_EXACT
},

1327 {"ý1251", "Cyržlic", "ý1251", "CP1251", 
MADB_CS_EXACT
},

1328 {"¬mscii8", "Arm’Ÿn", "¬mscii8", "ASMSCII-8", 
MADB_CS_EXACT
},

1329 {"¬mscii-8", "Arm’Ÿn", "¬mscii8", "ASMSCII-8", 
MADB_CS_EXACT
},

1330 {"big5hkscs", "Big5-HKSCS", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1331 {"ý1255", "Heb»w", "ý1255", "CP1255", 
MADB_CS_EXACT
},

1332 {"eucCN", "GB-2312", "gb2312", "GB2312", 
MADB_CS_EXACT
},

1333 {"eucJP", "UJIS", "ujis", "UJIS", 
MADB_CS_EXACT
},

1334 {"eucKR", "EUC-KR", "euckr", "EUCKR", 
MADB_CS_EXACT
},

1335 {"euùw", "EUC-TW", 
NULL
, NULL, 
MADB_CS_UNSUPPORTED
},

1336 {"gb18030", "GB 18030-2000", "gb18030", "GB18030", 
MADB_CS_UNSUPPORTED
},

1337 {"gb2312", "GB2312", "gb2312", "GB2312", 
MADB_CS_EXACT
},

1338 {"gbk", "GBK", "gbk", "GBK", 
MADB_CS_EXACT
},

1339 {"geÜgŸÅs", "GeÜgŸn", "geo¡d8", "GEORGIAN-PS", 
MADB_CS_EXACT
},

1340 {"utf8", "UTF8", "utf8", "UTF-8", 
MADB_CS_EXACT
},

1341 {"utf-8", "UTF8", "utf8", "UTF-8", 
MADB_CS_EXACT
},

1343 {
NULL
, NULL, NULL, NULL, 0}

1348 cÚ¡ *
	$madb_g‘_os_ch¬aù”_£t
()

1350 
i
= 0;

1351 *
p
ð
NULL
;

1352 #ifdeà
_WIN32


1353 
cod•age
[
FN_REFLEN
];

1354 
	`¢´štf
(
cod•age
, 
FN_REFLEN
, "%u", 
	`G‘CÚsÞeCP
(è? G‘CÚsÞeCP(è: 
	`G‘ACP
());

1355 
p
ð
cod•age
;

1356 #–ià
	`defšed
(
HAVE_NL_LANGINFO
è&& defšed(
HAVE_SETLOCALE
)

1357 ià(
	`£ŽoÿË
(
LC_CTYPE
, ""))

1358 
p
ð
	`Æ_Ïngšfo
(
CODESET
);

1360 ià(!
p
)

1361  
MADB_DEFAULT_CHARSET_NAME
;

1362 
MADB_OS_CHARSET
[
i
].
id’tif›r
)

1364 ià(
MADB_OS_CHARSET
[
i
].
suµÜ‹d
 > 
MADB_CS_UNSUPPORTED
 &&

1365 
	`¡rÿ£cmp
(
MADB_OS_CHARSET
[
i
].
id’tif›r
, 
p
) == 0)

1366  
MADB_OS_CHARSET
[
i
].
ch¬£t
;

1367 
i
++;

1369  
MADB_DEFAULT_CHARSET_NAME
;

1370 
	}
}

1374 #ifdeà
_WIN32


1375 
	$madb_g‘_wšdows_ý
(cÚ¡ *
ch¬£t
)

1377 
i
= 0;

1378 
MADB_OS_CHARSET
[
i
].
id’tif›r
)

1380 ià(
MADB_OS_CHARSET
[
i
].
suµÜ‹d
 > 
MADB_CS_UNSUPPORTED
 &&

1381 
	`¡rcmp
(
MADB_OS_CHARSET
[
i
].
ch¬£t
, charset) == 0)

1382  
	`©oi
(
MADB_OS_CHARSET
[
i
].
id’tif›r
);

1383 
i
++;

1386 
	}
}

1390 #ifdeà
HAVE_ICONV


1396 
	$m­_ch¬£t_Çme
(cÚ¡ *
cs_Çme
, 
my_boÞ
 
rg‘_cs
, *
bufãr
, 
size_t
 
buff_Ën
)

1398 
dig™s
[3], 
’dŸÂess
[3]= "BE";

1400 ià(
	`ssÿnf
(
cs_Çme
, "UTF%2[0-9]%2[LBE]", 
dig™s
, 
’dŸÂess
))

1403 
	`¢´štf
(
bufãr
, 
buff_Ën
, "UTF-%s%s", 
dig™s
, 
’dŸÂess
);

1408 
	`¡ºýy
(
bufãr
, 
cs_Çme
, 
buff_Ën
 - 1);

1409 
bufãr
[
buff_Ën
 - 1]= '\0';

1412 ià(
rg‘_cs
)

1414 
	`¡ºÿt
(
bufãr
, "//TRANSLIT", 
buff_Ën
 - 
	`¡¾’
(buffer));

1416 
	}
}

1432 
size_t
 
STDCALL
 
m¬Ÿdb_cÚv”t_¡ršg
(cÚ¡ *
äom
 
__©Œibu‹__
((
unu£d
)),

1433 
size_t
 *
äom_Ën
 
__©Œibu‹__
((
unu£d
)),

1434 
MARIADB_CHARSET_INFO
 *
äom_cs
 
__©Œibu‹__
((
unu£d
)),

1435 *
to
 
__©Œibu‹__
((
unu£d
)),

1436 
size_t
 *
to_Ën
 
__©Œibu‹__
((
unu£d
)),

1437 
MARIADB_CHARSET_INFO
 *
to_cs
 
__©Œibu‹__
((
unu£d
)), *
”rÜcode
)

1439 #iâdeà
HAVE_ICONV


1440 *
	g”rÜcode
ð
ENOTSUP
;

1443 
icÚv_t
 
	gcÚv
= 0;

1444 
size_t
 
	grc
= -1;

1445 
size_t
 
	g§ve_Ën
ð*
to_Ën
;

1446 
	gto_’codšg
[128], 
	gäom_’codšg
[128];

1448 *
	g”rÜcode
= 0;

1451 ià(!
	gäom_cs
 || !äom_cs->
	g’codšg
 || !from_cs->encoding[0] ||

1452 !
	gto_cs
 || !to_cs->
	g’codšg
 || !to_cs->encoding[0])

1454 *
	g”rÜcode
ð
EINVAL
;

1455  
	grc
;

1458 
m­_ch¬£t_Çme
(
to_cs
->
’codšg
, 1, 
to_’codšg
, (to_encoding));

1459 
m­_ch¬£t_Çme
(
äom_cs
->
’codšg
, 0, 
äom_’codšg
, (from_encoding));

1461 ià((
	gcÚv
ð
icÚv_Ý’
(
to_’codšg
, 
äom_’codšg
)è=ð(
icÚv_t
)-1)

1463 *
”rÜcode
ð
”ºo
;

1464 
	g”rÜ
;

1466 ià((
	grc
ð
icÚv
(
cÚv
, 
IF_WIN
(,
IF_SOLARIS
(,(**)))&
äom
, 
äom_Ën
, &
to
, 
to_Ën
)è=ð(
size_t
)-1)

1468 *
”rÜcode
ð
”ºo
;

1469 
	g”rÜ
;

1471 
	grc
ð
§ve_Ën
 - *
to_Ën
;

1472 
	g”rÜ
:

1473 ià(
cÚv
 !ð(
icÚv_t
)-1)

1474 
icÚv_þo£
(
cÚv
);

1475  
	grc
;

	@libmariadb/ma_compress.c

21 
	~<ma_glob®.h
>

22 #ifdeà
HAVE_COMPRESS


23 
	~<ma_sys.h
>

24 
	~<ma_¡ršg.h
>

25 
	~<zlib.h
>

33 
my_boÞ
 
	$_m¬Ÿdb_com´ess
(*
·ck‘
, 
size_t
 *
Ën
, size_ˆ*
com¶’
)

35 ià(*
Ën
 < 
MIN_COMPRESS_LENGTH
)

36 *
com¶’
=0;

39 *
compbuf
=
	`_m¬Ÿdb_com´ess_®loc
(
·ck‘
,
Ën
,
com¶’
);

40 ià(!
compbuf
)

41  *
com¶’
 ? 0 : 1;

42 
	`memýy
(
·ck‘
,
compbuf
,*
Ën
);

43 
	`ä“
(
compbuf
);

46 
	}
}

49 *
	$_m¬Ÿdb_com´ess_®loc
(cÚ¡ *
·ck‘
, 
size_t
 *
Ën
, size_ˆ*
com¶’
)

51 *
compbuf
;

52 *
com¶’
 = *
Ën
 * 120 / 100 + 12;

53 ià(!(
compbuf
 = (*è
	`m®loc
(*
com¶’
)))

55 ià(
	`com´ess
((
By‹f
*è
compbuf
,(
ulÚg
 *è
com¶’
, (By‹f*è
·ck‘
,

56 (
uLÚg
è*
Ën
 ) !ð
Z_OK
)

58 
	`ä“
(
compbuf
);

61 ià(*
com¶’
 >ð*
Ën
)

63 *
com¶’
=0;

64 
	`ä“
(
compbuf
);

67 
	`sw­
(
size_t
,*
Ën
,*
com¶’
);

68  
compbuf
;

69 
	}
}

71 
my_boÞ
 
	$_m¬Ÿdb_uncom´ess
 (*
·ck‘
, 
size_t
 *
Ën
, size_ˆ*
com¶’
)

73 ià(*
com¶’
)

75 *
compbuf
 = (*è
	`m®loc
 (*
com¶’
);

76 ià(!
compbuf
)

78 ià(
	`uncom´ess
((
By‹f
*è
compbuf
, (
uLÚgf
 *)
com¶’
, (By‹f*è
·ck‘
, (uLÚgf)*
Ën
è!ð
Z_OK
)

80 
	`ä“
(
compbuf
);

83 *
Ën
 = *
com¶’
;

84 
	`memýy
(
·ck‘
,
compbuf
,*
Ën
);

85 
	`ä“
(
compbuf
);

87 *
com¶’
ð*
Ën
;

89 
	}
}

	@libmariadb/ma_context.c

24 
	~"ma_glob®.h
"

25 
	~"ma_¡ršg.h
"

26 
	~"ma_cÚ‹xt.h
"

28 #ifdeà
HAVE_VALGRIND


29 
	~<v®gršd/v®gršd.h
>

32 #ifdeà
MY_CONTEXT_USE_UCONTEXT


39 
	u·ss_void_±r_as_2_št
 {

40 
	ma
[2];

41 *
	mp
;

50 
	$my_cÚ‹xt_¥awn_š‹º®
(
i0
, 
i1
)

51 
i0
, 
i1
;

53 
”r
;

54 
my_cÚ‹xt
 *
c
;

55 
·ss_void_±r_as_2_št
 
u
;

57 
u
.
a
[0]ð
i0
;

58 
u
.
a
[1]ð
i1
;

59 
c
ð(
my_cÚ‹xt
 *)
u
.
p
;

61 (*
c
->
u£r_func
)(c->
u£r_d©a
);

62 
c
->
aùive
= 0;

63 
”r
ð
	`£tcÚ‹xt
(&
c
->
ba£_cÚ‹xt
);

64 
	`årštf
(
¡d”r
, "A››, s‘cÚ‹xt(èçžed: %d (”ºo=%d)\n", 
”r
, 
”ºo
);

65 
	}
}

69 
	$my_cÚ‹xt_cÚtšue
(
my_cÚ‹xt
 *
c
)

71 
”r
;

73 ià(!
c
->
aùive
)

76 
”r
ð
	`sw­cÚ‹xt
(&
c
->
ba£_cÚ‹xt
, &c->
¥awÃd_cÚ‹xt
);

77 ià(
”r
)

79 
	`årštf
(
¡d”r
, "Aieie, swapcontext() failed: %d (errno=%d)\n",

80 
”r
, 
”ºo
);

84  
c
->
aùive
;

85 
	}
}

89 
my_cÚ‹xt_¥awn
(
my_cÚ‹xt
 *
c
, (*
f
)(*), *
d
)

91 
”r
;

92 
·ss_void_±r_as_2_št
 
u
;

94 
”r
ð
	`g‘cÚ‹xt
(&
c
->
¥awÃd_cÚ‹xt
);

95 ià(
”r
)

97 
c
->
¥awÃd_cÚ‹xt
.
uc_¡ack
.
ss_¥
ðc->
¡ack
;

98 
c
->
¥awÃd_cÚ‹xt
.
uc_¡ack
.
ss_size
ðc->
¡ack_size
;

99 
c
->
¥awÃd_cÚ‹xt
.
uc_lšk
ð
NULL
;

100 
c
->
u£r_func
ð
f
;

101 
c
->
u£r_d©a
ð
d
;

102 
c
->
aùive
= 1;

103 
u
.
p
ð
c
;

104 
	`makecÚ‹xt
(&
c
->
¥awÃd_cÚ‹xt
, 
my_cÚ‹xt_¥awn_š‹º®
, 2,

105 
u
.
a
[0], u.a[1]);

107  
	`my_cÚ‹xt_cÚtšue
(
c
);

108 
	}
}

112 
	$my_cÚ‹xt_y›ld
(
my_cÚ‹xt
 *
c
)

114 
”r
;

116 ià(!
c
->
aùive
)

119 
”r
ð
	`sw­cÚ‹xt
(&
c
->
¥awÃd_cÚ‹xt
, &c->
ba£_cÚ‹xt
);

120 ià(
”r
)

123 
	}
}

126 
	$my_cÚ‹xt_š™
(
my_cÚ‹xt
 *
c
, 
size_t
 
¡ack_size
)

128 #ià
SIZEOF_CHARP
 > 
SIZEOF_INT
*2

129 #”rÜ 
E¼Ü
: 
UÇbË
 
to
 
¡Üe
 
poš‹r
 
š
 2 
šts
 
Ú
 
this
 
¬ch™eùu»


132 
	`mem£t
(
c
, 0, (*c));

133 ià(!(
c
->
¡ack
ð
	`m®loc
(
¡ack_size
)))

135 
c
->
¡ack_size
= stack_size;

136 #ifdeà
HAVE_VALGRIND


137 
c
->
v®gršd_¡ack_id
=

138 
	`VALGRIND_STACK_REGISTER
(
c
->
¡ack
, ((*)(c->¡ack))+
¡ack_size
);

141 
	}
}

144 
	$my_cÚ‹xt_de¡roy
(
my_cÚ‹xt
 *
c
)

146 ià(
c
->
¡ack
)

148 #ifdeà
HAVE_VALGRIND


149 
	`VALGRIND_STACK_DEREGISTER
(
c
->
v®gršd_¡ack_id
);

151 
	`ä“
(
c
->
¡ack
);

153 
	}
}

158 #ifdeà
MY_CONTEXT_USE_X86_64_GCC_ASM


168 
	~<¡dšt.h
>

169 
	~<¡dlib.h
>

188 
my_cÚ‹xt_¥awn
(
my_cÚ‹xt
 *
c
, (*
f
)(*), *
d
)

190 
»t
;

201 
__asm__
 
__vÞ©že__


205 #ià
__GNUC__
 >ð4 && 
__GNUC_MINOR__
 >ð4 && !
	`defšed
(
__INTEL_COMPILER
)

243 : [
»t
] "=a" (ret),

244 [
f
] "+S" (f),

246 [
d
] "+D" (d)

247 : [
¡ack
] "a" (
c
->
¡ack_tÝ
),

249 [
§ve
] "b" (&
c
->save[0])

253  
»t
;

254 
	}
}

257 
	$my_cÚ‹xt_cÚtšue
(
my_cÚ‹xt
 *
c
)

259 
»t
;

261 
__asm__
 
__vÞ©že__


312 : [
»t
] "=a" (ret)

314 [
§ve
] "b" (&
c
->save[0])

318  
»t
;

319 
	}
}

322 
	$my_cÚ‹xt_y›ld
(
my_cÚ‹xt
 *
c
)

324 
ušt64_t
 *
§ve
ð&
c
->save[0];

325 
__asm__
 
__vÞ©že__


355 : [
§ve
] "+D" (save)

360 
	}
}

363 
	$my_cÚ‹xt_š™
(
my_cÚ‹xt
 *
c
, 
size_t
 
¡ack_size
)

365 
	`mem£t
(
c
, 0, (*c));

367 ià(!(
c
->
¡ack_bÙ
ð
	`m®loc
(
¡ack_size
)))

373 
c
->
¡ack_tÝ
= (*)

374 (Ð((
šŒ
)
c
->
¡ack_bÙ
 + 
¡ack_size
) & ~(intptr)0xf) - 16);

375 
	`mem£t
(
c
->
¡ack_tÝ
, 0, 16);

377 #ifdeà
HAVE_VALGRIND


378 
c
->
v®gršd_¡ack_id
=

379 
	`VALGRIND_STACK_REGISTER
(
c
->
¡ack_bÙ
, c->
¡ack_tÝ
);

382 
	}
}

385 
	$my_cÚ‹xt_de¡roy
(
my_cÚ‹xt
 *
c
)

387 ià(
c
->
¡ack_bÙ
)

389 
	`ä“
(
c
->
¡ack_bÙ
);

390 #ifdeà
HAVE_VALGRIND


391 
	`VALGRIND_STACK_DEREGISTER
(
c
->
v®gršd_¡ack_id
);

394 
	}
}

399 #ifdeà
MY_CONTEXT_USE_I386_GCC_ASM


409 
	~<¡dšt.h
>

410 
	~<¡dlib.h
>

427 
my_cÚ‹xt_¥awn
(
my_cÚ‹xt
 *
c
, (*
f
)(*), *
d
)

429 
»t
;

440 
__asm__
 
__vÞ©že__


444 #ià
__GNUC__
 >ð4 && 
__GNUC_MINOR__
 >ð4 && !
	`defšed
(
__INTEL_COMPILER
)

482 : [
»t
] "=a" (ret),

483 [
f
] "+c" (f),

484 [
d
] "+d" (d)

485 : [
¡ack
] "a" (
c
->
¡ack_tÝ
),

487 [
§ve
] "D" (&
c
->save[0])

491  
»t
;

492 
	}
}

495 
	$my_cÚ‹xt_cÚtšue
(
my_cÚ‹xt
 *
c
)

497 
»t
;

499 
__asm__
 
__vÞ©že__


546 : [
»t
] "=a" (ret)

548 [
§ve
] "D" (&
c
->save[0])

552  
»t
;

553 
	}
}

556 
	$my_cÚ‹xt_y›ld
(
my_cÚ‹xt
 *
c
)

558 
ušt64_t
 *
§ve
ð&
c
->save[0];

559 
__asm__
 
__vÞ©že__


587 : [
§ve
] "+d" (save)

592 
	}
}

595 
	$my_cÚ‹xt_š™
(
my_cÚ‹xt
 *
c
, 
size_t
 
¡ack_size
)

597 
	`mem£t
(
c
, 0, (*c));

598 ià(!(
c
->
¡ack_bÙ
ð
	`m®loc
(
¡ack_size
)))

600 
c
->
¡ack_tÝ
= (*)

601 (Ð((
šŒ
)
c
->
¡ack_bÙ
 + 
¡ack_size
) & ~(intptr)0xf) - 16);

602 
	`mem£t
(
c
->
¡ack_tÝ
, 0, 16);

604 #ifdeà
HAVE_VALGRIND


605 
c
->
v®gršd_¡ack_id
=

606 
	`VALGRIND_STACK_REGISTER
(
c
->
¡ack_bÙ
, c->
¡ack_tÝ
);

609 
	}
}

612 
	$my_cÚ‹xt_de¡roy
(
my_cÚ‹xt
 *
c
)

614 ià(
c
->
¡ack_bÙ
)

616 
	`ä“
(
c
->
¡ack_bÙ
);

617 #ifdeà
HAVE_VALGRIND


618 
	`VALGRIND_STACK_DEREGISTER
(
c
->
v®gršd_¡ack_id
);

621 
	}
}

626 #ifdeà
MY_CONTEXT_USE_WIN32_FIBERS


628 
	$my_cÚ‹xt_y›ld
(
my_cÚ‹xt
 *
c
)

630 
c
->
»tuº_v®ue
= 1;

631 
	`Sw™chToFib”
(
c
->
­p_fib”
);

633 
	}
}

636 
WINAPI


637 
	$my_cÚ‹xt_ŒampÞše
(*
p
)

639 
my_cÚ‹xt
 *
c
ð(my_cÚ‹xˆ*)
p
;

649 (*(
c
->
u£r_func
))(c->
u£r_¬g
);

650 
c
->
»tuº_v®ue
= 0;

651 
	`Sw™chToFib”
(
c
->
­p_fib”
);

653 
	}
}

656 
	$my_cÚ‹xt_š™
(
my_cÚ‹xt
 *
c
, 
size_t
 
¡ack_size
)

658 
	`mem£t
(
c
, 0, (*c));

659 
c
->
lib_fib”
ð
	`C»©eFib”
(
¡ack_size
, 
my_cÚ‹xt_ŒampÞše
, c);

660 ià(
c
->
lib_fib”
)

663 
	}
}

666 
	$my_cÚ‹xt_de¡roy
(
my_cÚ‹xt
 *
c
)

668 ià(
c
->
lib_fib”
)

670 
	`D–‘eFib”
(
c
->
lib_fib”
);

671 
c
->
lib_fib”
ð
NULL
;

673 
	}
}

676 
my_cÚ‹xt_¥awn
(
my_cÚ‹xt
 *
c
, (*
f
)(*), *
d
)

678 
c
->
u£r_func
ð
f
;

679 
c
->
u£r_¬g
ð
d
;

680  
	`my_cÚ‹xt_cÚtšue
(
c
);

681 
	}
}

684 
	$my_cÚ‹xt_cÚtšue
(
my_cÚ‹xt
 *
c
)

686 *
cu¼’t_fib”
ð
	`IsTh»adAFib”
(è? 
	`G‘Cu¼’tFib”
(è: 
	`CÚv”tTh»adToFib”
(
c
);

687 
c
->
­p_fib”
ð
cu¼’t_fib”
;

688 
	`Sw™chToFib”
(
c
->
lib_fib”
);

689  
c
->
»tuº_v®ue
;

690 
	}
}

694 #ifdeà
MY_CONTEXT_DISABLE


696 
	$my_cÚ‹xt_cÚtšue
(
my_cÚ‹xt
 *
c
)

699 
	}
}

703 
my_cÚ‹xt_¥awn
(
my_cÚ‹xt
 *
c
, (*
f
)(*), *
d
)

706 
	}
}

710 
	$my_cÚ‹xt_y›ld
(
my_cÚ‹xt
 *
c
)

713 
	}
}

716 
	$my_cÚ‹xt_š™
(
my_cÚ‹xt
 *
c
, 
size_t
 
¡ack_size
)

719 
	}
}

722 
	$my_cÚ‹xt_de¡roy
(
my_cÚ‹xt
 *
c
)

724 
	}
}

	@libmariadb/ma_default.c

19 
	~<ma_glob®.h
>

20 
	~<ma_sys.h
>

21 
	~"ma_¡ršg.h
"

22 
	~<ùy³.h
>

23 
	~"m¬Ÿdb_ùy³.h
"

24 
	~<mysql.h
>

25 
	~<ma_commÚ.h
>

26 
	~<m¬Ÿdb/ma_io.h
>

28 #ifdeà
_WIN32


29 
	~<io.h
>

30 
	~"shlw­i.h
"

32 cÚ¡ *
	gši_exts
[]= {"ini", "cnf", 0};

33 
	#R_OK
 4

	)

35 
	~<uni¡d.h
>

36 cÚ¡ *
	gši_exts
[]= {"cnf", 0};

39 **
	gcÚfigu¿tiÚ_dœs
ð
NULL
;

40 
	#MAX_CONFIG_DIRS
 6

	)

42 
my_boÞ
 
_m¬Ÿdb_»ad_ÝtiÚs
(
MYSQL
 *
mysql
,

43 cÚ¡ *
cÚfig_dœ
,

44 cÚ¡ *
cÚfig_fže
,

45 cÚ¡ *
group
,

46 
»cursiÚ
);

48 
	$add_cfg_dœ
(**
cfg_dœs
, cÚ¡ *
dœeùÜy
)

50 
i
;

52 
i
 = 0; i < 
MAX_CONFIG_DIRS
 && 
cfg_dœs
[i]; i++)

53 ià(!
	`¡rcmp
(
cfg_dœs
[
i
], 
dœeùÜy
))

56 ià(
i
 < 
MAX_CONFIG_DIRS
) {

57 
cfg_dœs
[
i
]ð
	`¡rdup
(
dœeùÜy
);

61 
	}
}

63 
	$»Ëa£_cÚfigu¿tiÚ_dœs
()

65 ià(
cÚfigu¿tiÚ_dœs
)

67 
i
= 0;

68 
cÚfigu¿tiÚ_dœs
[
i
])

69 
	`ä“
(
cÚfigu¿tiÚ_dœs
[
i
++]);

70 
	`ä“
(
cÚfigu¿tiÚ_dœs
);

72 
	}
}

74 **
	$g‘_deçuÉ_cÚfigu¿tiÚ_dœs
()

76 #ifdeà
_WIN32


77 
dœÇme
[
FN_REFLEN
];

79 *
’v
;

81 
cÚfigu¿tiÚ_dœs
ð(**)
	`ÿÎoc
(1, (
MAX_CONFIG_DIRS
 + 1) * (*));

82 ià(!
cÚfigu¿tiÚ_dœs
)

83 
’d
;

85 #ifdeà
_WIN32


93 ià(!
	`G‘Sy¡emWšdowsDœeùÜy
(
dœÇme
, 
FN_REFLEN
) ||

94 
	`add_cfg_dœ
(
cÚfigu¿tiÚ_dœs
, 
dœÇme
))

95 
”rÜ
;

97 ià(!
	`G‘WšdowsDœeùÜy
(
dœÇme
, 
FN_REFLEN
) ||

98 
	`add_cfg_dœ
(
cÚfigu¿tiÚ_dœs
, 
dœÇme
))

99 
”rÜ
;

101 ià(
	`add_cfg_dœ
(
cÚfigu¿tiÚ_dœs
, "C:"))

102 
”rÜ
;

104 ià(
	`G‘ModuËFžeName
(
NULL
, 
dœÇme
, 
FN_REFLEN
))

106 
	`P©hRemoveFžeS³c
(
dœÇme
);

107 ià(
	`add_cfg_dœ
(
cÚfigu¿tiÚ_dœs
, 
dœÇme
))

108 
”rÜ
;

117 #ifdeà
DEFAULT_SYSCONFDIR


118 ià(
	`add_cfg_dœ
(
cÚfigu¿tiÚ_dœs
, 
DEFAULT_SYSCONFDIR
))

119 
”rÜ
;

121 ià(
	`add_cfg_dœ
(
cÚfigu¿tiÚ_dœs
, "/etc"))

122 
”rÜ
;

123 ià(
	`add_cfg_dœ
(
cÚfigu¿tiÚ_dœs
, "/etc/mysql"))

124 
”rÜ
;

128 ià((
’v
ð
	`g‘’v
("MYSQL_HOME")) &&

129 
	`add_cfg_dœ
(
cÚfigu¿tiÚ_dœs
, 
’v
))

130 
”rÜ
;

132 ià((
’v
ð
	`g‘’v
("MARIADB_HOME")) &&

133 
	`add_cfg_dœ
(
cÚfigu¿tiÚ_dœs
, 
’v
))

134 
”rÜ
;

135 
’d
:

136  
cÚfigu¿tiÚ_dœs
;

137 
”rÜ
:

138  
NULL
;

139 
	}
}

141 
my_boÞ
 
_m¬Ÿdb_£t_cÚf_ÝtiÚ
(
MYSQL
 *
mysql
, cÚ¡ *
cÚfig_ÝtiÚ
, cÚ¡ *
cÚfig_v®ue
);

143 
my_boÞ
 
	$is_group
(*
±r
, cÚ¡ **
groups
)

145 *
groups
)

147 ià(!
	`¡rcmp
(
±r
, *
groups
))

149 
groups
++;

152 
	}
}

154 
my_boÞ
 
	$_m¬Ÿdb_»ad_ÝtiÚs_äom_fže
(
MYSQL
 *
mysql
,

155 cÚ¡ *
cÚfig_fže
,

156 cÚ¡ *
group
,

157 
»cursiÚ
)

159 
ušt
 
lše
=0;

160 
my_boÞ
 
»ad_v®ues
ð0, 
found_group
ð0, 
is_esÿ³d
ð0, 
is_quÙed
= 0;

161 
buff
[4096],*
±r
,*
’d
,*
v®ue
, *
key
ð0, *
Ýtv®
;

162 
MA_FILE
 *
fže
ð
NULL
;

163 
my_boÞ
 
rc
= 1;

164 cÚ¡ *
groups
[5]= {"client",

167 
group
,

168 
NULL
};

169 
	`my_boÞ
 (*
£t_ÝtiÚ
)(
MYSQL
 *
mysql
, cÚ¡ *
cÚfig_ÝtiÚ
, cÚ¡ *
cÚfig_v®ue
);

174 ià(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
 && mysql->ÝtiÚs.ex‹nsiÚ->
£t_ÝtiÚ
)

175 
£t_ÝtiÚ
ð
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->set_option;

177 
£t_ÝtiÚ
ð
_m¬Ÿdb_£t_cÚf_ÝtiÚ
;

179 ià(!(
fže
 = 
	`ma_Ý’
(
cÚfig_fže
, "r", 
NULL
)))

180 
”r
;

182 
	`ma_g‘s
(
buff
,(buff)-1,
fže
))

184 
lše
++;

185 
key
= 0;

187 
±r
=
buff
 ; 
	`is¥aû
(*ptr) ;…tr++ );

188 ià(!
is_esÿ³d
 && (*
±r
 == '\"' || *ptr== '\''))

190 
is_quÙed
= !is_quoted;

194 ià(*
±r
 == '!')

196 *
v®
;

197 
±r
++;

198 ià(!(
v®
ð
	`¡rchr
(
±r
, ' ')))

200 *
v®
++= 0;

201 
’d
ð
	`¡rchr
(
v®
, 0);

202  ; 
	`is¥aû
(
’d
[-1]) ;ƒnd--) ;

203 *
’d
= 0;

204 ià(!
	`¡rcmp
(
±r
, "includedir"))

205 
	`_m¬Ÿdb_»ad_ÝtiÚs
(
mysql
, (cÚ¡ *)
v®
, 
NULL
, 
group
, 
»cursiÚ
 + 1);

206 ià(!
	`¡rcmp
(
±r
, "include"))

207 
	`_m¬Ÿdb_»ad_ÝtiÚs
(
mysql
, 
NULL
, (cÚ¡ *)
v®
, 
group
, 
»cursiÚ
 + 1);

210 ià(*
±r
 == '#' || *ptr == ';' || !*ptr)

212 
is_esÿ³d
ð(*
±r
 == '\\');

213 ià(*
±r
 == '[')

215 
found_group
=1;

216 ià(!(
’d
=(*è
	`¡rchr
(++
±r
,']')))

219 
”r
;

221  ; 
	`is¥aû
(
’d
[-1]) ;ƒnd--) ;

222 
’d
[0]=0;

223 
»ad_v®ues
ð
	`is_group
(
±r
, 
groups
);

226 ià(!
found_group
)

229 
”r
;

231 ià(!
»ad_v®ues
)

233 ià(!(
’d
=
v®ue
=
	`¡rchr
(
±r
,'=')))

235 
’d
=
	`¡rchr
(
±r
, '\0');

236 
	`£t_ÝtiÚ
(
mysql
, 
±r
, 
NULL
);

238 ià(!
key
)

239 
key
ð
±r
;

240  ; 
	`is¥aû
(
’d
[-1]) ;ƒnd--) ;

241 *
’d
= 0;

242 ià(
v®ue
)

245 *
v®ue_’d
;

246 *
v®ue
= 0;

247 
v®ue
++;

248 
±r
ð
v®ue
;

249  ; 
	`is¥aû
(*
v®ue
); value++) ;

250 
v®ue_’d
=
	`¡rchr
(
v®ue
, '\0');

251 *
v®ue_’d
= 0;

252 
Ýtv®
ð
±r
;

253  ; 
	`is¥aû
(
v®ue_’d
[-1]) ; value_end--) ;

255 ià(*
v®ue
 == '\'' || *value == '\"')

257 
v®ue
++;

258 ià(
v®ue_’d
[-1] == '\'' || value_end[-1] == '\"')

259 
v®ue_’d
--;

261 ià(
v®ue_’d
 < 
v®ue
)

262 
v®ue_’d
=
v®ue
;

263  ; 
v®ue
 !ð
v®ue_’d
; value++)

265 ià(*
v®ue
 =ð'\\' && v®u!ð
v®ue_’d
-1)

267 *++
v®ue
) {

269 *
±r
++='\n';

272 *
±r
++= '\t';

275 *
±r
++ = '\r';

278 *
±r
++ = '\b';

281 *
±r
++= ' ';

284 *
±r
++= '\"';

287 *
±r
++= '\'';

290 *
±r
++= '\\';

293 *
±r
++= '\\';

294 *
±r
++ð*
v®ue
;

299 *
±r
++ð*
v®ue
;

301 *
±r
=0;

302 
	`£t_ÝtiÚ
(
mysql
, 
key
, 
Ýtv®
);

303 
key
ð
Ýtv®
= 0;

306 
rc
= 0;

308 
”r
:

309 ià(
fže
)

310 
	`ma_þo£
(
fže
);

311  
rc
;

312 
	}
}

315 
my_boÞ
 
	$_m¬Ÿdb_»ad_ÝtiÚs
(
MYSQL
 *
mysql
,

316 cÚ¡ *
cÚfig_dœ
,

317 cÚ¡ *
cÚfig_fže
,

318 cÚ¡ *
group
,

319 
»cursiÚ
)

321 
i
= 0,

322 
exts
,

323 
”rÜs
= 0;

324 
fž’ame
[
FN_REFLEN
 + 1];

325 
»cursiÚ_¡Ý
= 64;

326 #iâdeà
_WIN32


327 *
’v
;

330 ià(
»cursiÚ
 >ð
»cursiÚ_¡Ý
)

333 ià(
cÚfig_fže
 && config_file[0])

334  
	`_m¬Ÿdb_»ad_ÝtiÚs_äom_fže
(
mysql
, 
cÚfig_fže
, 
group
, 
»cursiÚ
);

336 ià(
cÚfig_dœ
 && config_dir[0])

338 
exts
ð0; 
ši_exts
[exts];ƒxts++)

340 
	`¢´štf
(
fž’ame
, 
FN_REFLEN
,

341 "%s%cmy.%s", 
cÚfig_dœ
, 
FN_LIBCHAR
, 
ši_exts
[
exts
]);

342 ià(!
	`acûss
(
fž’ame
, 
R_OK
))

343 
”rÜs
+ð
	`_m¬Ÿdb_»ad_ÝtiÚs_äom_fže
(
mysql
, 
fž’ame
, 
group
, 
»cursiÚ
);

345  
”rÜs
;

348 
i
=0; i < 
MAX_CONFIG_DIRS
 && 
cÚfigu¿tiÚ_dœs
[i]; i++)

350 
exts
ð0; 
ši_exts
[exts];ƒxts++)

352 
	`¢´štf
(
fž’ame
, 
FN_REFLEN
,

353 "%s%cmy.%s", 
cÚfigu¿tiÚ_dœs
[
i
], 
FN_LIBCHAR
, 
ši_exts
[
exts
]);

354 ià(!
	`acûss
(
fž’ame
, 
R_OK
))

355 
”rÜs
+ð
	`_m¬Ÿdb_»ad_ÝtiÚs_äom_fže
(
mysql
, 
fž’ame
, 
group
, 
»cursiÚ
);

358 #iâdeà
_WIN32


360 ià((
’v
ð
	`g‘’v
("HOME")))

362 
exts
ð0; 
ši_exts
[exts];ƒxts++)

364 
	`¢´štf
(
fž’ame
, 
FN_REFLEN
,

365 "%s%c.my.%s", 
’v
, 
FN_LIBCHAR
, 
ši_exts
[
exts
]);

366 ià(!
	`acûss
(
fž’ame
, 
R_OK
))

367 
”rÜs
+ð
	`_m¬Ÿdb_»ad_ÝtiÚs_äom_fže
(
mysql
, 
fž’ame
, 
group
, 
»cursiÚ
);

371  
”rÜs
;

372 
	}
}

	@libmariadb/ma_dtoa.c

42 
	~<ma_glob®.h
>

43 
	~<memÜy.h
>

44 
	~"ma_¡ršg.h
"

52 
	#DTOA_BUFF_SIZE
 (460 * (*))

	)

55 
	#DTOA_OVERFLOW
 9999

	)

57 *
dtß
(, , , *, *, **, *, 
size_t
);

58 
dtß_ä“
(*, *, 
size_t
);

91 
size_t
 
	$ma_fcvt
(
x
, 
´ecisiÚ
, *
to
, 
my_boÞ
 *
”rÜ
)

93 
deýt
, 
sign
, 
Ën
, 
i
;

94 *
»s
, *
¤c
, *
’d
, *
d¡
ð
to
;

95 
buf
[
DTOA_BUFF_SIZE
];

96 
	`DBUG_ASSERT
(
´ecisiÚ
 >ð0 &&…»cisiÚ < 
NOT_FIXED_DEC
 && 
to
 !ð
NULL
);

98 
»s
ð
	`dtß
(
x
, 5, 
´ecisiÚ
, &
deýt
, &
sign
, &
’d
, 
buf
, (buf));

100 ià(
deýt
 =ð
DTOA_OVERFLOW
)

102 
	`dtß_ä“
(
»s
, 
buf
, (buf));

103 *
to
++= '0';

104 *
to
= '\0';

105 ià(
”rÜ
 !ð
NULL
)

106 *
”rÜ
ð
TRUE
;

110 
¤c
ð
»s
;

111 
Ën
ð()(
’d
 - 
¤c
);

113 ià(
sign
)

114 *
d¡
++= '-';

116 ià(
deýt
 <= 0)

118 *
d¡
++= '0';

119 *
d¡
++= '.';

120 
i
ð
deýt
; i < 0; i++)

121 *
d¡
++= '0';

124 
i
ð1; i <ð
Ën
; i++)

126 *
d¡
++ð*
¤c
++;

127 ià(
i
 =ð
deýt
 && i < 
Ën
)

128 *
d¡
++= '.';

130 
i
++ <ð
deýt
)

131 *
d¡
++= '0';

133 ià(
´ecisiÚ
 > 0)

135 ià(
Ën
 <ð
deýt
)

136 *
d¡
++= '.';

138 
i
ð
´ecisiÚ
 - 
	`MAX
(0, (
Ën
 - 
deýt
)); i > 0; i--)

139 *
d¡
++= '0';

142 *
d¡
= '\0';

143 ià(
”rÜ
 !ð
NULL
)

144 *
”rÜ
ð
FALSE
;

146 
	`dtß_ä“
(
»s
, 
buf
, (buf));

148  
d¡
 - 
to
;

149 
	}
}

214 
size_t
 
	$ma_gcvt
(
x
, 
my_gcvt_¬g_ty³
 
ty³
, 
width
, *
to
,

215 
my_boÞ
 *
”rÜ
)

217 
deýt
, 
sign
, 
Ën
, 
exp_Ën
;

218 *
»s
, *
¤c
, *
’d
, *
d¡
ð
to
, *
d’d
ðd¡ + 
width
;

219 
buf
[
DTOA_BUFF_SIZE
];

220 
my_boÞ
 
have_¥aû
, 
fÜû_e_fÜm©
;

221 
	`DBUG_ASSERT
(
width
 > 0 && 
to
 !ð
NULL
);

224 ià(
x
 < 0.)

225 
width
--;

227 
»s
ð
	`dtß
(
x
, 4, 
ty³
 =ð
MY_GCVT_ARG_DOUBLE
 ? 
width
 : 
	`MIN
(width, 
FLT_DIG
),

228 &
deýt
, &
sign
, &
’d
, 
buf
, (buf));

229 ià(
deýt
 =ð
DTOA_OVERFLOW
)

231 
	`dtß_ä“
(
»s
, 
buf
, (buf));

232 *
to
++= '0';

233 *
to
= '\0';

234 ià(
”rÜ
 !ð
NULL
)

235 *
”rÜ
ð
TRUE
;

239 ià(
”rÜ
 !ð
NULL
)

240 *
”rÜ
ð
FALSE
;

242 
¤c
ð
»s
;

243 
Ën
ð()(
’d
 - 
»s
);

250 
exp_Ën
ð1 + (
deýt
 >= 101 || decpt <= -99) + (decpt >= 11 || decpt <= -9);

261 
have_¥aû
ð(
deýt
 <ð0 ? 
Ën
 - decpt + 2 :

262 
deýt
 > 0 && deýˆ< 
Ën
 ?†en + 1 :

263 
deýt
è<ð
width
;

269 
fÜû_e_fÜm©
ð(
deýt
 <ð0 && 
width
 <ð2 - deýˆ&& width >ð3 + 
exp_Ën
);

296 ià((
have_¥aû
 ||

301 ((
deýt
 <ð
width
 && (decpt >= -1 || (decpt == -2 &&

302 (
Ën
 > 1 || !
fÜû_e_fÜm©
)))) &&

303 !
fÜû_e_fÜm©
)) &&

309 (!
have_¥aû
 || (
deýt
 >ð-
DBL_DIG
 + 1 &&

310 (
deýt
 <ð
DBL_DIG
 || 
Ën
 > decpt))))

313 
i
;

315 
width
-ð(
deýt
 < 
Ën
) + (decpt <= 0 ? 1 - decpt : 0);

318 ià(
width
 < 
Ën
)

320 ià(
width
 < 
deýt
)

322 ià(
”rÜ
 !ð
NULL
)

323 *
”rÜ
ð
TRUE
;

324 
width
ð
deýt
;

332 
	`dtß_ä“
(
»s
, 
buf
, (buf));

333 
»s
ð
	`dtß
(
x
, 5, 
width
 - 
deýt
, &deýt, &
sign
, &
’d
, 
buf
, (buf));

334 
¤c
ð
»s
;

335 
Ën
ð()(
’d
 - 
»s
);

338 ià(
Ën
 == 0)

341 *
d¡
++= '0';

342 
’d
;

349 ià(
sign
 && 
d¡
 < 
d’d
)

350 *
d¡
++= '-';

351 ià(
deýt
 <= 0)

353 ià(
d¡
 < 
d’d
)

354 *
d¡
++= '0';

355 ià(
Ën
 > 0 && 
d¡
 < 
d’d
)

356 *
d¡
++= '.';

357 ; 
deýt
 < 0 && 
d¡
 < 
d’d
; decpt++)

358 *
d¡
++= '0';

361 
i
ð1; i <ð
Ën
 && 
d¡
 < 
d’d
; i++)

363 *
d¡
++ð*
¤c
++;

364 ià(
i
 =ð
deýt
 && i < 
Ën
 && 
d¡
 < 
d’d
)

365 *
d¡
++= '.';

367 
i
++ <ð
deýt
 && 
d¡
 < 
d’d
)

368 *
d¡
++= '0';

373 
deýt_sign
= 0;

375 ià(--
deýt
 < 0)

377 
deýt
= -decpt;

378 
width
--;

379 
deýt_sign
= 1;

381 
width
-ð1 + 
exp_Ën
;

383 ià(
Ën
 > 1)

384 
width
--;

386 ià(
width
 <= 0)

389 ià(
”rÜ
 !ð
NULL
)

390 *
”rÜ
ð
TRUE
;

391 
width
= 0;

395 ià(
width
 < 
Ën
)

398 
	`dtß_ä“
(
»s
, 
buf
, (buf));

399 
»s
ð
	`dtß
(
x
, 4, 
width
, &
deýt
, &
sign
, &
’d
, 
buf
, (buf));

400 
¤c
ð
»s
;

401 
Ën
ð()(
’d
 - 
»s
);

402 ià(--
deýt
 < 0)

403 
deýt
= -decpt;

409 ià(
sign
 && 
d¡
 < 
d’d
)

410 *
d¡
++= '-';

411 ià(
d¡
 < 
d’d
)

412 *
d¡
++ð*
¤c
++;

413 ià(
Ën
 > 1 && 
d¡
 < 
d’d
)

415 *
d¡
++= '.';

416 
¤c
 < 
’d
 && 
d¡
 < 
d’d
)

417 *
d¡
++ð*
¤c
++;

419 ià(
d¡
 < 
d’d
)

420 *
d¡
++= 'e';

421 ià(
deýt_sign
 && 
d¡
 < 
d’d
)

422 *
d¡
++= '-';

424 ià(
deýt
 >ð100 && 
d¡
 < 
d’d
)

426 *
d¡
++ð
deýt
 / 100 + '0';

427 
deýt
%= 100;

428 ià(
d¡
 < 
d’d
)

429 *
d¡
++ð
deýt
 / 10 + '0';

431 ià(
deýt
 >ð10 && 
d¡
 < 
d’d
)

432 *
d¡
++ð
deýt
 / 10 + '0';

433 ià(
d¡
 < 
d’d
)

434 *
d¡
++ð
deýt
 % 10 + '0';

438 
’d
:

439 
	`dtß_ä“
(
»s
, 
buf
, (buf));

440 *
d¡
= '\0';

442  
d¡
 - 
to
;

443 
	}
}

508 
št32
 
	tLÚg
;

509 
ušt32
 
	tULÚg
;

510 
št64
 
	tLLÚg
;

511 
ušt64
 
	tULLÚg
;

513 uniÚ { 
	md
; 
ULÚg
 
	mL
[2]; } 
	tU
;

515 #ià
defšed
(
HAVE_BIGENDIAN
è|| defšed(
WORDS_BIGENDIAN
) || \

516 (
defšed
(
__FLOAT_WORD_ORDER
è&& (
	g__FLOAT_WORD_ORDER
 =ð
__BIG_ENDIAN
))

517 
	#wÜd0
(
x
è((x)->
L
[0])

	)

518 
	#wÜd1
(
x
è((x)->
L
[1])

	)

520 
	#wÜd0
(
x
è((x)->
L
[1])

	)

521 
	#wÜd1
(
x
è((x)->
L
[0])

	)

524 
	#dv®
(
x
è((x)->
d
)

	)

532 
	#Exp_shiá
 20

	)

533 
	#Exp_shiá1
 20

	)

534 
	#Exp_msk1
 0x100000

	)

535 
	#Exp_mask
 0x7ff00000

	)

536 
	#P
 53

	)

537 
	#BŸs
 1023

	)

538 
	#Emš
 (-1022)

	)

539 
	#Exp_1
 0x3ff00000

	)

540 
	#Exp_11
 0x3ff00000

	)

541 
	#Eb™s
 11

	)

542 
	#F¿c_mask
 0xfffff

	)

543 
	#F¿c_mask1
 0xfffff

	)

544 
	#T’_pmax
 22

	)

545 
	#BËtch
 0x10

	)

546 
	#Bndry_mask
 0xfffff

	)

547 
	#Bndry_mask1
 0xfffff

	)

548 
	#LSB
 1

	)

549 
	#Sign_b™
 0x80000000

	)

550 
	#Log2P
 1

	)

551 
	#Tšy1
 1

	)

552 
	#Quick_max
 14

	)

553 
	#IÁ_max
 14

	)

555 #iâdeà
FÉ_Rounds


556 #ifdeà
FLT_ROUNDS


557 
	#FÉ_Rounds
 
FLT_ROUNDS


	)

559 
	#FÉ_Rounds
 1

	)

563 #ifdeà
HÚÜ_FLT_ROUNDS


564 
	#Roundšg
 
roundšg


	)

565 #undeà
Check_FLT_ROUNDS


566 
	#Check_FLT_ROUNDS


	)

568 
	#Roundšg
 
FÉ_Rounds


	)

571 
	#rounded_´oduù
(
a
,
b
è(×)*ð(b))

	)

572 
	#rounded_quÙ›Á
(
a
,
b
è(×)/ð(b))

	)

574 
	#Big0
 (
F¿c_mask1
 | 
Exp_msk1
*(
DBL_MAX_EXP
+
BŸs
-1))

	)

575 
	#Big1
 0xffffffff

	)

576 
	#FFFFFFFF
 0xffffffffUL

	)

580 
	#Kmax
 15

	)

582 
	#BcÝy
(
x
,
y
è
	`memýy
((*)&(x)->
sign
, (*)&(y)->sign, \

583 2*(è+ (
y
)->
wds
*(
ULÚg
))

	)

587 
	sBigšt


590 
ULÚg
 *
	mx
;

591 
Bigšt
 *
	mÃxt
;

592 } 
	mp
;

593 
	mk
;

594 
	mmaxwds
;

595 
	msign
;

596 
	mwds
;

597 } 
	tBigšt
;

602 
	sSck_®loc


604 *
	mbegš
;

605 *
	mä“
;

606 *
	m’d
;

611 
Bigšt
 *
	mä“li¡
[
Kmax
+1];

612 } 
	tSck_®loc
;

622 
Bigšt
 *
	$B®loc
(
k
, 
Sck_®loc
 *
®loc
)

624 
Bigšt
 *
rv
;

625 
	`DBUG_ASSERT
(
k
 <ð
Kmax
);

626 ià(
k
 <ð
Kmax
 && 
®loc
->
ä“li¡
[k])

628 
rv
ð
®loc
->
ä“li¡
[
k
];

629 
®loc
->
ä“li¡
[
k
]ð
rv
->
p
.
Ãxt
;

633 
x
, 
Ën
;

635 
x
ð1 << 
k
;

636 
Ën
ð
	`MY_ALIGN
((
Bigšt
è+ 
x
 * (
ULÚg
), 
SIZEOF_CHARP
);

638 ià(
®loc
->
ä“
 + 
Ën
 <ð®loc->
’d
)

640 
rv
ð(
Bigšt
*è
®loc
->
ä“
;

641 
®loc
->
ä“
+ð
Ën
;

644 
rv
ð(
Bigšt
*è
	`m®loc
(
Ën
);

646 
rv
->
k
= k;

647 
rv
->
maxwds
ð
x
;

649 
rv
->
sign
ðrv->
wds
= 0;

650 
rv
->
p
.
x
ð(
ULÚg
*) (rv + 1);

651  
rv
;

652 
	}
}

660 
	$Bä“
(
Bigšt
 *
v
, 
Sck_®loc
 *
®loc
)

662 *
g±r
ð(*è
v
;

663 ià(
g±r
 < 
®loc
->
begš
 || g±¸>ð®loc->
’d
)

664 
	`ä“
(
g±r
);

665 ià(
v
->
k
 <ð
Kmax
)

672 
v
->
p
.
Ãxt
ð
®loc
->
ä“li¡
[v->
k
];

673 
®loc
->
ä“li¡
[
v
->
k
]= v;

675 
	}
}

685 *
	$dtß_®loc
(
i
, 
Sck_®loc
 *
®loc
)

687 *
rv
;

688 
®igÃd_size
ð
	`MY_ALIGN
(
i
, 
SIZEOF_CHARP
);

689 ià(
®loc
->
ä“
 + 
®igÃd_size
 <ð®loc->
’d
)

691 
rv
ð
®loc
->
ä“
;

692 
®loc
->
ä“
+ð
®igÃd_size
;

695 
rv
ð
	`m®loc
(
i
);

696  
rv
;

697 
	}
}

705 
	$dtß_ä“
(*
g±r
, *
buf
, 
size_t
 
buf_size
)

707 ià(
g±r
 < 
buf
 || g±¸>ðbuà+ 
buf_size
)

708 
	`ä“
(
g±r
);

709 
	}
}

716 
Bigšt
 *
	$muÉadd
(
Bigšt
 *
b
, 
m
, 
a
, 
Sck_®loc
 *
®loc
)

718 
i
, 
wds
;

719 
ULÚg
 *
x
;

720 
ULLÚg
 
ÿ¼y
, 
y
;

721 
Bigšt
 *
b1
;

723 
wds
ð
b
->wds;

724 
x
ð
b
->
p
.x;

725 
i
= 0;

726 
ÿ¼y
ð
a
;

729 
y
ð*
x
 * (
ULLÚg
)
m
 + 
ÿ¼y
;

730 
ÿ¼y
ð
y
 >> 32;

731 *
x
++ð(
ULÚg
)(
y
 & 
FFFFFFFF
);

733 ++
i
 < 
wds
);

734 ià(
ÿ¼y
)

736 ià(
wds
 >ð
b
->
maxwds
)

738 
b1
ð
	`B®loc
(
b
->
k
+1, 
®loc
);

739 
	`BcÝy
(
b1
, 
b
);

740 
	`Bä“
(
b
, 
®loc
);

741 
b
ð
b1
;

743 
b
->
p
.
x
[
wds
++]ð(
ULÚg
è
ÿ¼y
;

744 
b
->
wds
= wds;

746  
b
;

747 
	}
}

750 
	$hi0b™s
(
ULÚg
 
x
)

752 
k
= 0;

754 ià(!(
x
 & 0xffff0000))

756 
k
= 16;

757 
x
<<= 16;

759 ià(!(
x
 & 0xff000000))

761 
k
+= 8;

762 
x
<<= 8;

764 ià(!(
x
 & 0xf0000000))

766 
k
+= 4;

767 
x
<<= 4;

769 ià(!(
x
 & 0xc0000000))

771 
k
+= 2;

772 
x
<<= 2;

774 ià(!(
x
 & 0x80000000))

776 
k
++;

777 ià(!(
x
 & 0x40000000))

780  
k
;

781 
	}
}

784 
	$lo0b™s
(
ULÚg
 *
y
)

786 
k
;

787 
ULÚg
 
x
ð*
y
;

789 ià(
x
 & 7)

791 ià(
x
 & 1)

793 ià(
x
 & 2)

795 *
y
ð
x
 >> 1;

798 *
y
ð
x
 >> 2;

801 
k
= 0;

802 ià(!(
x
 & 0xffff))

804 
k
= 16;

805 
x
>>= 16;

807 ià(!(
x
 & 0xff))

809 
k
+= 8;

810 
x
>>= 8;

812 ià(!(
x
 & 0xf))

814 
k
+= 4;

815 
x
>>= 4;

817 ià(!(
x
 & 0x3))

819 
k
+= 2;

820 
x
>>= 2;

822 ià(!(
x
 & 1))

824 
k
++;

825 
x
>>= 1;

826 ià(!
x
)

829 *
y
ð
x
;

830  
k
;

831 
	}
}

836 
Bigšt
 *
	$i2b
(
i
, 
Sck_®loc
 *
®loc
)

838 
Bigšt
 *
b
;

840 
b
ð
	`B®loc
(1, 
®loc
);

841 
b
->
p
.
x
[0]ð
i
;

842 
b
->
wds
= 1;

843  
b
;

844 
	}
}

849 
Bigšt
 *
	$muÉ
(
Bigšt
 *
a
, Bigšˆ*
b
, 
Sck_®loc
 *
®loc
)

851 
Bigšt
 *
c
;

852 
k
, 
wa
, 
wb
, 
wc
;

853 
ULÚg
 *
x
, *
xa
, *
x«
, *
xb
, *
xbe
, *
xc
, *
xc0
;

854 
ULÚg
 
y
;

855 
ULLÚg
 
ÿ¼y
, 
z
;

857 ià(
a
->
wds
 < 
b
->wds)

859 
c
ð
a
;

860 
a
ð
b
;

861 
b
ð
c
;

863 
k
ð
a
->k;

864 
wa
ð
a
->
wds
;

865 
wb
ð
b
->
wds
;

866 
wc
ð
wa
 + 
wb
;

867 ià(
wc
 > 
a
->
maxwds
)

868 
k
++;

869 
c
ð
	`B®loc
(
k
, 
®loc
);

870 
x
ð
c
->
p
.x, 
xa
ðx + 
wc
; x < xa; x++)

871 *
x
= 0;

872 
xa
ð
a
->
p
.
x
;

873 
x«
ð
xa
 + 
wa
;

874 
xb
ð
b
->
p
.
x
;

875 
xbe
ð
xb
 + 
wb
;

876 
xc0
ð
c
->
p
.
x
;

877 ; 
xb
 < 
xbe
; 
xc0
++)

879 ià((
y
ð*
xb
++))

881 
x
ð
xa
;

882 
xc
ð
xc0
;

883 
ÿ¼y
= 0;

886 
z
ð*
x
++ * (
ULLÚg
)
y
 + *
xc
 + 
ÿ¼y
;

887 
ÿ¼y
ð
z
 >> 32;

888 *
xc
++ð(
ULÚg
è(
z
 & 
FFFFFFFF
);

890 
x
 < 
x«
);

891 *
xc
ð(
ULÚg
è
ÿ¼y
;

894 
xc0
ð
c
->
p
.
x
, 
xc
ðxc0 + 
wc
; wc > 0 && !*--xc; --wc) ;

895 
c
->
wds
ð
wc
;

896  
c
;

897 
	}
}

905 
ULÚg
 
	gpow”s5
[]=

927 
Bigšt
 
	gp5_a
[]=

930 { { 
pow”s5
 }, 1, 1, 0, 1 },

931 { { 
pow”s5
 + 1 }, 1, 1, 0, 1 },

932 { { 
pow”s5
 + 2 }, 1, 2, 0, 2 },

933 { { 
pow”s5
 + 4 }, 2, 3, 0, 3 },

934 { { 
pow”s5
 + 7 }, 3, 5, 0, 5 },

935 { { 
pow”s5
 + 12 }, 4, 10, 0, 10 },

936 { { 
pow”s5
 + 22 }, 5, 19, 0, 19 }

939 
	#P5A_MAX
 ((
p5_a
)/(*p5_aè- 1)

	)

941 
Bigšt
 *
	$pow5muÉ
(
Bigšt
 *
b
, 
k
, 
Sck_®loc
 *
®loc
)

943 
Bigšt
 *
b1
, *
p5
, *
p51
=
NULL
;

944 
i
;

945 
p05
[3]= { 5, 25, 125 };

946 
my_boÞ
 
ov”æow
ð
FALSE
;

948 ià((
i
ð
k
 & 3))

949 
b
ð
	`muÉadd
(b, 
p05
[
i
-1], 0, 
®loc
);

951 ià(!(
k
>>= 2))

952  
b
;

953 
p5
ð
p5_a
;

956 ià(
k
 & 1)

958 
b1
ð
	`muÉ
(
b
, 
p5
, 
®loc
);

959 
	`Bä“
(
b
, 
®loc
);

960 
b
ð
b1
;

962 ià(!(
k
>>= 1))

965 ià(
ov”æow
)

967 
p51
ð
	`muÉ
(
p5
,…5, 
®loc
);

968 
	`Bä“
(
p5
, 
®loc
);

969 
p5
ð
p51
;

971 ià(
p5
 < 
p5_a
 + 
P5A_MAX
)

972 ++
p5
;

973 ià(
p5
 =ð
p5_a
 + 
P5A_MAX
)

975 
p5
ð
	`muÉ
Õ5,…5, 
®loc
);

976 
ov”æow
ð
TRUE
;

979 ià(
p51
)

980 
	`Bä“
(
p51
, 
®loc
);

981  
b
;

982 
	}
}

985 
Bigšt
 *
	$lshiá
(
Bigšt
 *
b
, 
k
, 
Sck_®loc
 *
®loc
)

987 
i
, 
k1
, 
n
, 
n1
;

988 
Bigšt
 *
b1
;

989 
ULÚg
 *
x
, *
x1
, *
xe
, 
z
;

991 
n
ð
k
 >> 5;

992 
k1
ð
b
->
k
;

993 
n1
ð
n
 + 
b
->
wds
 + 1;

994 
i
ð
b
->
maxwds
; 
n1
 > i; i<<= 1)

995 
k1
++;

996 
b1
ð
	`B®loc
(
k1
, 
®loc
);

997 
x1
ð
b1
->
p
.
x
;

998 
i
ð0; i < 
n
; i++)

999 *
x1
++= 0;

1000 
x
ð
b
->
p
.x;

1001 
xe
ð
x
 + 
b
->
wds
;

1002 ià(
k
&= 0x1f)

1004 
k1
ð32 - 
k
;

1005 
z
= 0;

1008 *
x1
++ð*
x
 << 
k
 | 
z
;

1009 
z
ð*
x
++ >> 
k1
;

1011 
x
 < 
xe
);

1012 ià((*
x1
ð
z
))

1013 ++
n1
;

1017 *
x1
++ð*
x
++;

1018 
x
 < 
xe
);

1019 
b1
->
wds
ð
n1
 - 1;

1020 
	`Bä“
(
b
, 
®loc
);

1021  
b1
;

1022 
	}
}

1025 
	$cmp
(
Bigšt
 *
a
, Bigšˆ*
b
)

1027 
ULÚg
 *
xa
, *
xa0
, *
xb
, *
xb0
;

1028 
i
, 
j
;

1030 
i
ð
a
->
wds
;

1031 
j
ð
b
->
wds
;

1032 ià(
i
-ð
j
)

1033  
i
;

1034 
xa0
ð
a
->
p
.
x
;

1035 
xa
ð
xa0
 + 
j
;

1036 
xb0
ð
b
->
p
.
x
;

1037 
xb
ð
xb0
 + 
j
;

1040 ià(*--
xa
 !ð*--
xb
)

1041  *
xa
 < *
xb
 ? -1 : 1;

1042 ià(
xa
 <ð
xa0
)

1046 
	}
}

1049 
Bigšt
 *
	$diff
(
Bigšt
 *
a
, Bigšˆ*
b
, 
Sck_®loc
 *
®loc
)

1051 
Bigšt
 *
c
;

1052 
i
, 
wa
, 
wb
;

1053 
ULÚg
 *
xa
, *
x«
, *
xb
, *
xbe
, *
xc
;

1054 
ULLÚg
 
bÜrow
, 
y
;

1056 
i
ð
	`cmp
(
a
,
b
);

1057 ià(!
i
)

1059 
c
ð
	`B®loc
(0, 
®loc
);

1060 
c
->
wds
= 1;

1061 
c
->
p
.
x
[0]= 0;

1062  
c
;

1064 ià(
i
 < 0)

1066 
c
ð
a
;

1067 
a
ð
b
;

1068 
b
ð
c
;

1069 
i
= 1;

1072 
i
= 0;

1073 
c
ð
	`B®loc
(
a
->
k
, 
®loc
);

1074 
c
->
sign
ð
i
;

1075 
wa
ð
a
->
wds
;

1076 
xa
ð
a
->
p
.
x
;

1077 
x«
ð
xa
 + 
wa
;

1078 
wb
ð
b
->
wds
;

1079 
xb
ð
b
->
p
.
x
;

1080 
xbe
ð
xb
 + 
wb
;

1081 
xc
ð
c
->
p
.
x
;

1082 
bÜrow
= 0;

1085 
y
ð(
ULLÚg
)*
xa
++ - *
xb
++ - 
bÜrow
;

1086 
bÜrow
ð
y
 >> 32 & (
ULÚg
)1;

1087 *
xc
++ð(
ULÚg
è(
y
 & 
FFFFFFFF
);

1089 
xb
 < 
xbe
);

1090 
xa
 < 
x«
)

1092 
y
ð*
xa
++ - 
bÜrow
;

1093 
bÜrow
ð
y
 >> 32 & (
ULÚg
)1;

1094 *
xc
++ð(
ULÚg
è(
y
 & 
FFFFFFFF
);

1096 !*--
xc
)

1097 
wa
--;

1098 
c
->
wds
ð
wa
;

1099  
c
;

1100 
	}
}

1103 
Bigšt
 *
	$d2b
(
U
 *
d
, *
e
, *
b™s
, 
Sck_®loc
 *
®loc
)

1105 
Bigšt
 *
b
;

1106 
de
, 
k
;

1107 
ULÚg
 *
x
, 
y
, 
z
;

1108 
i
;

1109 
	#d0
 
	`wÜd0
(
d
)

	)

1110 
	#d1
 
	`wÜd1
(
d
)

	)

1112 
b
ð
	`B®loc
(1, 
®loc
);

1113 
x
ð
b
->
p
.x;

1115 
z
ð
d0
 & 
F¿c_mask
;

1116 
d0
 &= 0x7fffffff;

1117 ià((
de
ð()(
d0
 >> 
Exp_shiá
)))

1118 
z
|ð
Exp_msk1
;

1119 ià((
y
ð
d1
))

1121 ià((
k
ð
	`lo0b™s
(&
y
)))

1123 
x
[0]ð
y
 | 
z
 << (32 - 
k
);

1124 
z
>>ð(
k
 == 32) ? (--k) : k;

1127 
x
[0]ð
y
;

1128 
i
ð
b
->
wds
ð(
x
[1]ð
z
) ? 2 : 1;

1132 
k
ð
	`lo0b™s
(&
z
);

1133 
x
[0]ð
z
;

1134 
i
ð
b
->
wds
= 1;

1135 
k
+= 32;

1137 ià(
de
)

1139 *
e
ð
de
 - 
BŸs
 - (
P
-1è+ 
k
;

1140 *
b™s
ð
P
 - 
k
;

1144 *
e
ð
de
 - 
BŸs
 - (
P
-1è+ 1 + 
k
;

1145 *
b™s
ð32*
i
 - 
	`hi0b™s
(
x
[i-1]);

1147  
b
;

1148 #undeà
d0


1149 #undeà
d1


1150 
	}
}

1153 cÚ¡ 
	g‹ns
[] =

1160 cÚ¡ 
	gbig‹ns
[]= { 1e16, 1e32, 1e64, 1e128, 1e256 };

1165 
	#SÿË_B™
 0x10

	)

1166 
	#n_big‹ns
 5

	)

1169 
	$quÜem
(
Bigšt
 *
b
, Bigšˆ*
S
)

1171 
n
;

1172 
ULÚg
 *
bx
, *
bxe
, 
q
, *
sx
, *
sxe
;

1173 
ULLÚg
 
bÜrow
, 
ÿ¼y
, 
y
, 
ys
;

1175 
n
ð
S
->
wds
;

1176 ià(
b
->
wds
 < 
n
)

1178 
sx
ð
S
->
p
.
x
;

1179 
sxe
ð
sx
 + --
n
;

1180 
bx
ð
b
->
p
.
x
;

1181 
bxe
ð
bx
 + 
n
;

1182 
q
ð*
bxe
 / (*
sxe
 + 1);

1183 ià(
q
)

1185 
bÜrow
= 0;

1186 
ÿ¼y
= 0;

1189 
ys
ð*
sx
++ * (
ULLÚg
)
q
 + 
ÿ¼y
;

1190 
ÿ¼y
ð
ys
 >> 32;

1191 
y
ð*
bx
 - (
ys
 & 
FFFFFFFF
è- 
bÜrow
;

1192 
bÜrow
ð
y
 >> 32 & (
ULÚg
)1;

1193 *
bx
++ð(
ULÚg
è(
y
 & 
FFFFFFFF
);

1195 
sx
 <ð
sxe
);

1196 ià(!*
bxe
)

1198 
bx
ð
b
->
p
.
x
;

1199 --
bxe
 > 
bx
 && !*bxe)

1200 --
n
;

1201 
b
->
wds
ð
n
;

1204 ià(
	`cmp
(
b
, 
S
) >= 0)

1206 
q
++;

1207 
bÜrow
= 0;

1208 
ÿ¼y
= 0;

1209 
bx
ð
b
->
p
.
x
;

1210 
sx
ð
S
->
p
.
x
;

1213 
ys
ð*
sx
++ + 
ÿ¼y
;

1214 
ÿ¼y
ð
ys
 >> 32;

1215 
y
ð*
bx
 - (
ys
 & 
FFFFFFFF
è- 
bÜrow
;

1216 
bÜrow
ð
y
 >> 32 & (
ULÚg
)1;

1217 *
bx
++ð(
ULÚg
è(
y
 & 
FFFFFFFF
);

1219 
sx
 <ð
sxe
);

1220 
bx
ð
b
->
p
.
x
;

1221 
bxe
ð
bx
 + 
n
;

1222 ià(!*
bxe
)

1224 --
bxe
 > 
bx
 && !*bxe)

1225 --
n
;

1226 
b
->
wds
ð
n
;

1229  
q
;

1230 
	}
}

1268 *
	$dtß
(
dd
, 
mode
, 
ndig™s
, *
deýt
, *
sign
,

1269 **
rve
, *
buf
, 
size_t
 
buf_size
)

1306 
bb™s
, 
b2
, 
b5
, 
be
, 
dig
, 
i
, 
›ps
, 
	`UNINIT_VAR
(
žim
), 
žim0
,

1307 
	`UNINIT_VAR
(
žim1
), 
j
, 
j1
, 
k
, 
k0
, 
k_check
, 
Ëáright
, 
m2
, 
m5
, 
s2
, 
s5
,

1308 
¥ec_ÿ£
, 
Œy_quick
;

1309 
LÚg
 
L
;

1310 
d’Üm
;

1311 
ULÚg
 
x
;

1312 
Bigšt
 *
b
, *
b1
, *
d–
, *
mlo
, *
mhi
, *
S
;

1313 
U
 
d2
, 
•s
, 
u
;

1314 
ds
;

1315 *
s
, *
s0
;

1316 #ifdeà
HÚÜ_FLT_ROUNDS


1317 
roundšg
;

1319 
Sck_®loc
 
®loc
;

1321 
®loc
.
begš
ð®loc.
ä“
ð
buf
;

1322 
®loc
.
’d
ð
buf
 + 
buf_size
;

1323 
	`mem£t
(
®loc
.
ä“li¡
, 0, (alloc.freelist));

1325 
u
.
d
ð
dd
;

1326 ià(
	`wÜd0
(&
u
è& 
Sign_b™
)

1329 *
sign
= 1;

1330 
	`wÜd0
(&
u
è&ð~
Sign_b™
;

1333 *
sign
= 0;

1337 ià(((
	`wÜd0
(&
u
è& 
Exp_mask
è=ðExp_mask && (*
deýt
ð
DTOA_OVERFLOW
)) ||

1339 (!
	`dv®
(&
u
è&& (*
deýt
= 1)))

1342 *
»s
ð(*è
	`dtß_®loc
(2, &
®loc
);

1343 
»s
[0]= '0';

1344 
»s
[1]= '\0';

1345 ià(
rve
)

1346 *
rve
ð
»s
 + 1;

1347  
»s
;

1350 #ifdeà
HÚÜ_FLT_ROUNDS


1351 ià((
roundšg
ð
FÉ_Rounds
) >= 2)

1353 ià(*
sign
)

1354 
roundšg
=„ounding == 2 ? 0 : 2;

1356 ià(
roundšg
 != 2)

1357 
roundšg
= 0;

1361 
b
ð
	`d2b
(&
u
, &
be
, &
bb™s
, &
®loc
);

1362 ià((
i
ð()(
	`wÜd0
(&
u
è>> 
Exp_shiá1
 & (
Exp_mask
>>Exp_shift1))))

1364 
	`dv®
(&
d2
)ðdv®(&
u
);

1365 
	`wÜd0
(&
d2
è&ð
F¿c_mask1
;

1366 
	`wÜd0
(&
d2
è|ð
Exp_11
;

1391 
i
-ð
BŸs
;

1392 
d’Üm
= 0;

1398 
i
ð
bb™s
 + 
be
 + (
BŸs
 + (
P
-1) - 1);

1399 
x
ð
i
 > 32 ? 
	`wÜd0
(&
u
è<< (64 - iè| 
	`wÜd1
(&u) >> (i - 32)

1400 : 
	`wÜd1
(&
u
è<< (32 - 
i
);

1401 
	`dv®
(&
d2
)ð
x
;

1402 
	`wÜd0
(&
d2
)-ð31*
Exp_msk1
;

1403 
i
-ð(
BŸs
 + (
P
-1) - 1) + 1;

1404 
d’Üm
= 1;

1406 
ds
ð(
	`dv®
(&
d2
)-1.5)*0.289529654602168 + 0.1760912590558 + 
i
*0.301029995663981;

1407 
k
ð()
ds
;

1408 ià(
ds
 < 0. && d !ð
k
)

1409 
k
--;

1410 
k_check
= 1;

1411 ià(
k
 >ð0 && k <ð
T’_pmax
)

1413 ià(
	`dv®
(&
u
è< 
‹ns
[
k
])

1414 
k
--;

1415 
k_check
= 0;

1417 
j
ð
bb™s
 - 
i
 - 1;

1418 ià(
j
 >= 0)

1420 
b2
= 0;

1421 
s2
ð
j
;

1425 
b2
ð-
j
;

1426 
s2
= 0;

1428 ià(
k
 >= 0)

1430 
b5
= 0;

1431 
s5
ð
k
;

1432 
s2
+ð
k
;

1436 
b2
-ð
k
;

1437 
b5
ð-
k
;

1438 
s5
= 0;

1440 ià(
mode
 < 0 || mode > 9)

1441 
mode
= 0;

1443 #ifdeà
Check_FLT_ROUNDS


1444 
Œy_quick
ð
Roundšg
 == 1;

1446 
Œy_quick
= 1;

1449 ià(
mode
 > 5)

1451 
mode
-= 4;

1452 
Œy_quick
= 0;

1454 
Ëáright
= 1;

1455 
mode
) {

1458 
žim
ð
žim1
= -1;

1459 
i
= 18;

1460 
ndig™s
= 0;

1463 
Ëáright
= 0;

1466 ià(
ndig™s
 <= 0)

1467 
ndig™s
= 1;

1468 
žim
ð
žim1
ð
i
ð
ndig™s
;

1471 
Ëáright
= 0;

1474 
i
ð
ndig™s
 + 
k
 + 1;

1475 
žim
ð
i
;

1476 
žim1
ð
i
 - 1;

1477 ià(
i
 <= 0)

1478 
i
= 1;

1480 
s
ð
s0
ð
	`dtß_®loc
(
i
, &
®loc
);

1482 #ifdeà
HÚÜ_FLT_ROUNDS


1483 ià(
mode
 > 1 && 
roundšg
 != 1)

1484 
Ëáright
= 0;

1487 ià(
žim
 >ð0 && ilim <ð
Quick_max
 && 
Œy_quick
)

1490 
i
= 0;

1491 
	`dv®
(&
d2
)ðdv®(&
u
);

1492 
k0
ð
k
;

1493 
žim0
ð
žim
;

1494 
›ps
= 2;

1495 ià(
k
 > 0)

1497 
ds
ð
‹ns
[
k
&0xf];

1498 
j
ð
k
 >> 4;

1499 ià(
j
 & 
BËtch
)

1502 
j
&ð
BËtch
 - 1;

1503 
	`dv®
(&
u
)/ð
big‹ns
[
n_big‹ns
-1];

1504 
›ps
++;

1506 ; 
j
; j>>ð1, 
i
++)

1508 ià(
j
 & 1)

1510 
›ps
++;

1511 
ds
*ð
big‹ns
[
i
];

1514 
	`dv®
(&
u
)/ð
ds
;

1516 ià((
j1
ð-
k
))

1518 
	`dv®
(&
u
)*ð
‹ns
[
j1
 & 0xf];

1519 
j
ð
j1
 >> 4; j; j>>ð1, 
i
++)

1521 ià(
j
 & 1)

1523 
›ps
++;

1524 
	`dv®
(&
u
)*ð
big‹ns
[
i
];

1528 ià(
k_check
 && 
	`dv®
(&
u
è< 1. && 
žim
 > 0)

1530 ià(
žim1
 <= 0)

1531 
ç¡_çžed
;

1532 
žim
ð
žim1
;

1533 
k
--;

1534 
	`dv®
(&
u
)*= 10.;

1535 
›ps
++;

1537 
	`dv®
(&
•s
)ð
›ps
*dv®(&
u
) + 7.;

1538 
	`wÜd0
(&
•s
)-ð(
P
-1)*
Exp_msk1
;

1539 ià(
žim
 == 0)

1541 
S
ð
mhi
= 0;

1542 
	`dv®
(&
u
)-= 5.;

1543 ià(
	`dv®
(&
u
è> dv®(&
•s
))

1544 
Úe_dig™
;

1545 ià(
	`dv®
(&
u
è< -dv®(&
•s
))

1546 
no_dig™s
;

1547 
ç¡_çžed
;

1549 ià(
Ëáright
)

1552 
	`dv®
(&
•s
)ð0.5/
‹ns
[
žim
-1] - dval(&eps);

1553 
i
= 0;;)

1555 
L
ð(
LÚg
è
	`dv®
(&
u
);

1556 
	`dv®
(&
u
)-ð
L
;

1557 *
s
++ð'0' + ()
L
;

1558 ià(
	`dv®
(&
u
è< dv®(&
•s
))

1559 
»t1
;

1560 ià(1. - 
	`dv®
(&
u
è< dv®(&
•s
))

1561 
bump_up
;

1562 ià(++
i
 >ð
žim
)

1564 
	`dv®
(&
•s
)*= 10.;

1565 
	`dv®
(&
u
)*= 10.;

1571 
	`dv®
(&
•s
)*ð
‹ns
[
žim
-1];

1572 
i
ð1;; i++, 
	`dv®
(&
u
)*= 10.)

1574 
L
ð(
LÚg
)(
	`dv®
(&
u
));

1575 ià(!(
	`dv®
(&
u
)-ð
L
))

1576 
žim
ð
i
;

1577 *
s
++ð'0' + ()
L
;

1578 ià(
i
 =ð
žim
)

1580 ià(
	`dv®
(&
u
è> 0.5 + dv®(&
•s
))

1581 
bump_up
;

1582 ià(
	`dv®
(&
u
è< 0.5 - dv®(&
•s
))

1584 *--
s
 == '0');

1585 
s
++;

1586 
»t1
;

1592 
ç¡_çžed
:

1593 
s
ð
s0
;

1594 
	`dv®
(&
u
)ðdv®(&
d2
);

1595 
k
ð
k0
;

1596 
žim
ð
žim0
;

1601 ià(
be
 >ð0 && 
k
 <ð
IÁ_max
)

1604 
ds
ð
‹ns
[
k
];

1605 ià(
ndig™s
 < 0 && 
žim
 <= 0)

1607 
S
ð
mhi
= 0;

1608 ià(
žim
 < 0 || 
	`dv®
(&
u
è<ð5*
ds
)

1609 
no_dig™s
;

1610 
Úe_dig™
;

1612 
i
ð1;; i++, 
	`dv®
(&
u
)*= 10.)

1614 
L
ð(
LÚg
)(
	`dv®
(&
u
è/ 
ds
);

1615 
	`dv®
(&
u
)-ð
L
*
ds
;

1616 #ifdeà
Check_FLT_ROUNDS


1618 ià(
	`dv®
(&
u
) < 0)

1620 
L
--;

1621 
	`dv®
(&
u
)+ð
ds
;

1624 *
s
++ð'0' + ()
L
;

1625 ià(!
	`dv®
(&
u
))

1629 ià(
i
 =ð
žim
)

1631 #ifdeà
HÚÜ_FLT_ROUNDS


1632 ià(
mode
 > 1)

1634 
roundšg
) {

1635 0: 
»t1
;

1636 2: 
bump_up
;

1640 
	`dv®
(&
u
)+= dval(&u);

1641 ià(
	`dv®
(&
u
è> 
ds
 || (dv®(&uè=ðd && 
L
 & 1))

1643 
bump_up
:

1644 *--
s
 == '9')

1645 ià(
s
 =ð
s0
)

1647 
k
++;

1648 *
s
= '0';

1651 ++*
s
++;

1656 
»t1
;

1659 
m2
ð
b2
;

1660 
m5
ð
b5
;

1661 
mhi
ð
mlo
= 0;

1662 ià(
Ëáright
)

1664 
i
 = 
d’Üm
 ? 
be
 + (
BŸs
 + (
P
-1è- 1 + 1è: 1 + P - 
bb™s
;

1665 
b2
+ð
i
;

1666 
s2
+ð
i
;

1667 
mhi
ð
	`i2b
(1, &
®loc
);

1669 ià(
m2
 > 0 && 
s2
 > 0)

1671 
i
ð
m2
 < 
s2
 ? m2 : s2;

1672 
b2
-ð
i
;

1673 
m2
-ð
i
;

1674 
s2
-ð
i
;

1676 ià(
b5
 > 0)

1678 ià(
Ëáright
)

1680 ià(
m5
 > 0)

1682 
mhi
ð
	`pow5muÉ
(mhi, 
m5
, &
®loc
);

1683 
b1
ð
	`muÉ
(
mhi
, 
b
, &
®loc
);

1684 
	`Bä“
(
b
, &
®loc
);

1685 
b
ð
b1
;

1687 ià((
j
ð
b5
 - 
m5
))

1688 
b
ð
	`pow5muÉ
(b, 
j
, &
®loc
);

1691 
b
ð
	`pow5muÉ
(b, 
b5
, &
®loc
);

1693 
S
ð
	`i2b
(1, &
®loc
);

1694 ià(
s5
 > 0)

1695 
S
ð
	`pow5muÉ
(S, 
s5
, &
®loc
);

1699 
¥ec_ÿ£
= 0;

1700 ià((
mode
 < 2 || 
Ëáright
)

1701 #ifdeà
HÚÜ_FLT_ROUNDS


1702 && 
roundšg
 == 1

1706 ià(!
	`wÜd1
(&
u
è&& !(
	`wÜd0
(&uè& 
Bndry_mask
) &&

1707 
	`wÜd0
(&
u
è& (
Exp_mask
 & ~
Exp_msk1
)

1711 
b2
+ð
Log2P
;

1712 
s2
+ð
Log2P
;

1713 
¥ec_ÿ£
= 1;

1725 ià((
i
ð((
s5
 ? 32 - 
	`hi0b™s
(
S
->
p
.
x
[S->
wds
-1]è: 1è+ 
s2
) & 0x1f))

1726 
i
= 32 - i;

1727 ià(
i
 > 4)

1729 
i
-= 4;

1730 
b2
+ð
i
;

1731 
m2
+ð
i
;

1732 
s2
+ð
i
;

1734 ià(
i
 < 4)

1736 
i
+= 28;

1737 
b2
+ð
i
;

1738 
m2
+ð
i
;

1739 
s2
+ð
i
;

1741 ià(
b2
 > 0)

1742 
b
ð
	`lshiá
(b, 
b2
, &
®loc
);

1743 ià(
s2
 > 0)

1744 
S
ð
	`lshiá
(S, 
s2
, &
®loc
);

1745 ià(
k_check
)

1747 ià(
	`cmp
(
b
,
S
) < 0)

1749 
k
--;

1751 
b
ð
	`muÉadd
(b, 10, 0, &
®loc
);

1752 ià(
Ëáright
)

1753 
mhi
ð
	`muÉadd
(mhi, 10, 0, &
®loc
);

1754 
žim
ð
žim1
;

1757 ià(
žim
 <ð0 && (
mode
 == 3 || mode == 5))

1759 ià(
žim
 < 0 || 
	`cmp
(
b
,
S
ð
	`muÉadd
(S,5,0, &
®loc
)) <= 0)

1762 
no_dig™s
:

1763 
k
ð-1 - 
ndig™s
;

1764 
»t
;

1766 
Úe_dig™
:

1767 *
s
++= '1';

1768 
k
++;

1769 
»t
;

1771 ià(
Ëáright
)

1773 ià(
m2
 > 0)

1774 
mhi
ð
	`lshiá
(mhi, 
m2
, &
®loc
);

1780 
mlo
ð
mhi
;

1781 ià(
¥ec_ÿ£
)

1783 
mhi
ð
	`B®loc
(mhi->
k
, &
®loc
);

1784 
	`BcÝy
(
mhi
, 
mlo
);

1785 
mhi
ð
	`lshiá
(mhi, 
Log2P
, &
®loc
);

1788 
i
= 1;;i++)

1790 
dig
ð
	`quÜem
(
b
,
S
) + '0';

1792 
j
ð
	`cmp
(
b
, 
mlo
);

1793 
d–
ð
	`diff
(
S
, 
mhi
, &
®loc
);

1794 
j1
ð
d–
->
sign
 ? 1 : 
	`cmp
(
b
, delta);

1795 
	`Bä“
(
d–
, &
®loc
);

1796 ià(
j1
 =ð0 && 
mode
 !ð1 && !(
	`wÜd1
(&
u
) & 1)

1797 #ifdeà
HÚÜ_FLT_ROUNDS


1798 && 
roundšg
 >= 1

1802 ià(
dig
 == '9')

1803 
round_9_up
;

1804 ià(
j
 > 0)

1805 
dig
++;

1806 *
s
++ð
dig
;

1807 
»t
;

1809 ià(
j
 < 0 || (j =ð0 && 
mode
 !ð1 && !(
	`wÜd1
(&
u
) & 1)))

1811 ià(!
b
->
p
.
x
[0] && b->
wds
 <= 1)

1813 
acû±_dig
;

1815 #ifdeà
HÚÜ_FLT_ROUNDS


1816 ià(
mode
 > 1)

1817 
roundšg
) {

1818 0: 
acû±_dig
;

1819 2: 
k“p_dig
;

1822 ià(
j1
 > 0)

1824 
b
ð
	`lshiá
(b, 1, &
®loc
);

1825 
j1
ð
	`cmp
(
b
, 
S
);

1826 ià((
j1
 > 0 || (j1 =ð0 && 
dig
 & 1))

1827 && 
dig
++ == '9')

1828 
round_9_up
;

1830 
acû±_dig
:

1831 *
s
++ð
dig
;

1832 
»t
;

1834 ià(
j1
 > 0)

1836 #ifdeà
HÚÜ_FLT_ROUNDS


1837 ià(!
roundšg
)

1838 
acû±_dig
;

1840 ià(
dig
 == '9')

1842 
round_9_up
:

1843 *
s
++= '9';

1844 
roundoff
;

1846 *
s
++ð
dig
 + 1;

1847 
»t
;

1849 #ifdeà
HÚÜ_FLT_ROUNDS


1850 
k“p_dig
:

1852 *
s
++ð
dig
;

1853 ià(
i
 =ð
žim
)

1855 
b
ð
	`muÉadd
(b, 10, 0, &
®loc
);

1856 ià(
mlo
 =ð
mhi
)

1857 
mlo
ð
mhi
ð
	`muÉadd
(mhi, 10, 0, &
®loc
);

1860 
mlo
ð
	`muÉadd
(mlo, 10, 0, &
®loc
);

1861 
mhi
ð
	`muÉadd
(mhi, 10, 0, &
®loc
);

1866 
i
= 1;; i++)

1868 *
s
++ð
dig
ð
	`quÜem
(
b
,
S
) + '0';

1869 ià(!
b
->
p
.
x
[0] && b->
wds
 <= 1)

1871 
»t
;

1873 ià(
i
 >ð
žim
)

1875 
b
ð
	`muÉadd
(b, 10, 0, &
®loc
);

1880 #ifdeà
HÚÜ_FLT_ROUNDS


1881 
roundšg
) {

1882 0: 
Œimz”os
;

1883 2: 
roundoff
;

1886 
b
ð
	`lshiá
(b, 1, &
®loc
);

1887 
j
ð
	`cmp
(
b
, 
S
);

1888 ià(
j
 > 0 || (j =ð0 && 
dig
 & 1))

1890 
roundoff
:

1891 *--
s
 == '9')

1892 ià(
s
 =ð
s0
)

1894 
k
++;

1895 *
s
++= '1';

1896 
»t
;

1898 ++*
s
++;

1902 #ifdeà
HÚÜ_FLT_ROUNDS


1903 
Œimz”os
:

1905 *--
s
 == '0');

1906 
s
++;

1908 
»t
:

1909 ià(
S
 !ð
NULL
)

1910 
	`Bä“
(
S
, &
®loc
);

1911 ià(
mhi
)

1913 ià(
mlo
 && mlØ!ð
mhi
)

1914 
	`Bä“
(
mlo
, &
®loc
);

1915 
	`Bä“
(
mhi
, &
®loc
);

1917 
»t1
:

1918 
	`Bä“
(
b
, &
®loc
);

1919 *
s
= 0;

1920 *
deýt
ð
k
 + 1;

1921 ià(
rve
)

1922 *
rve
ð
s
;

1923  
s0
;

1924 
	}
}

	@libmariadb/ma_errmsg.c

21 
	~<ma_glob®.h
>

22 
	~<ma_sys.h
>

23 
	~"”rmsg.h
"

24 
	~<¡d¬g.h
>

26 cÚ¡ *
	gSQLSTATE_UNKNOWN
= "HY000";

28 #ifdeà
GERMAN


29 cÚ¡ *
	gþ›Á_”rÜs
[]=

56 #–ià
defšed
 
PORTUGUESE


57 cÚ¡ *
	gþ›Á_”rÜs
[]=

83 cÚ¡ *
	gþ›Á_”rÜs
[]=

151 cÚ¡ *
	gm¬Ÿdb_þ›Á_”rÜs
[] =

165 cÚ¡ ** 
NEAR
 
	gmy_”rmsg
[
MAXMAPS
]={0,0,0,0};

166 
NEAR
 
	g”rbuff
[
NRERRBUFFS
][
ERRMSGSIZE
];

168 
	$š™_þ›Á_”rs
()

170 
my_”rmsg
[
CLIENT_ERRMAP
] = &
þ›Á_”rÜs
[0];

171 
	}
}

	@libmariadb/ma_hash.c

28 
	~<ma_glob®.h
>

29 
	~<ma_sys.h
>

30 
	~<ma_¡ršg.h
>

31 
	~<m¬Ÿdb_ùy³.h
>

32 
	~"ma_hash.h
"

34 
	#NO_RECORD
 ((
ušt
è-1)

	)

35 
	#LOWFIND
 1

	)

36 
	#LOWUSED
 2

	)

37 
	#HIGHFIND
 4

	)

38 
	#HIGHUSED
 8

	)

40 
ušt
 
hash_mask
(ušˆ
hashÄ
,ušˆ
buffmax
,ušˆ
maxËngth
);

41 
mov–šk
(
HASH_LINK
 *
¬¿y
,
ušt
 
pos
,ušˆ
Ãxt_lšk
,ušˆ
Ãwlšk
);

42 
ušt
 
ÿlc_hashÄ
(cÚ¡ 
uch¬
 *
key
,ušˆ
Ëngth
);

43 
ušt
 
ÿlc_hashÄ_ÿ£up
(cÚ¡ 
uch¬
 *
key
,ušˆ
Ëngth
);

44 
hashcmp
(
HASH
 *
hash
,
HASH_LINK
 *
pos
,cÚ¡ 
uch¬
 *
key
,
ušt
 
Ëngth
);

47 
my_boÞ
 
_hash_š™
(
HASH
 *
hash
,
ušt
 
size
,ušˆ
key_off£t
,ušˆ
key_Ëngth
,

48 
hash_g‘_key
 
g‘_key
,

49 (*
ä“_–em’t
)(*),
ušt
 
æags
 
CALLER_INFO_PROTO
)

51 
hash
->
»cÜds
=0;

52 ià(
	`ma_š™_dyÇmic_¬¿y_ci
(&
hash
->
¬¿y
,(
HASH_LINK
),
size
,0))

54 
hash
->
ä“
=0;

55 (
TRUE
);

57 
hash
->
key_off£t
=key_offset;

58 
hash
->
key_Ëngth
=key_length;

59 
hash
->
bËngth
=1;

60 
hash
->
cu¼’t_»cÜd
ð
NO_RECORD
;

61 
hash
->
g‘_key
=get_key;

62 
hash
->
ä“
=
ä“_–em’t
;

63 
hash
->
æags
=flags;

64 ià(
æags
 & 
HASH_CASE_INSENSITIVE
)

65 
hash
->
ÿlc_hashÄ
=
ÿlc_hashÄ_ÿ£up
;

67 
hash
->
ÿlc_hashÄ
=calc_hashnr;

69 
	}
}

72 
	$hash_ä“
(
HASH
 *
hash
)

74 ià(
hash
->
ä“
)

76 
ušt
 
i
,
»cÜds
;

77 
HASH_LINK
 *
d©a
=
	`dyÇmic_–em’t
(&
hash
->
¬¿y
,0,HASH_LINK*);

78 
i
=0,
»cÜds
=
hash
->records ; i <„ecords ; i++)

79 (*
hash
->
ä“
)(
d©a
[
i
].data);

80 
hash
->
ä“
=0;

82 
	`ma_d–‘e_dyÇmic
(&
hash
->
¬¿y
);

83 
hash
->
»cÜds
=0;

85 
	}
}

94 
šlše
 *

95 
	$hash_key
(
HASH
 *
hash
,cÚ¡ 
uch¬
 *
»cÜd
,
ušt
 *
Ëngth
,
my_boÞ
 
fœ¡
)

97 ià(
hash
->
g‘_key
)

98  (*)(*
hash
->
g‘_key
)(
»cÜd
,(
ušt
 *)
Ëngth
,
fœ¡
);

99 *
Ëngth
=
hash
->
key_Ëngth
;

100  (*è
»cÜd
+
hash
->
key_off£t
;

101 
	}
}

105 
ušt
 
	$hash_mask
(
ušt
 
hashÄ
,ušˆ
buffmax
,ušˆ
maxËngth
)

107 ià((
hashÄ
 & (
buffmax
-1)è< 
maxËngth
)  (hashnr & (buffmax-1));

108  (
hashÄ
 & ((
buffmax
 >> 1) -1));

109 
	}
}

111 
ušt
 
	$hash_»c_mask
(
HASH
 *
hash
,
HASH_LINK
 *
pos
,
ušt
 
buffmax
,

112 
ušt
 
maxËngth
)

114 
ušt
 
Ëngth
;

115 
uch¬
 *
key
ð(uch¬*è
	`hash_key
(
hash
,
pos
->
d©a
,&
Ëngth
,0);

116  
	`hash_mask
((*
hash
->
ÿlc_hashÄ
)(
key
,
Ëngth
),
buffmax
,
maxËngth
);

117 
	}
}

119 #iâdeà
NEW_HASH_FUNCTION


123 
ušt
 
	$ÿlc_hashÄ
(cÚ¡ 
uch¬
 *
key
,
ušt
 
Ëngth
)

125 
ušt
 
Ä
=1, 
Ä2
=4;

126 
Ëngth
--)

128 
Ä
^ð((Ò¸& 63)+
Ä2
)*((
ušt
è(
uch¬
è*
key
++))+ (nr << 8);

129 
Ä2
+=3;

131 ((
ušt
è
Ä
);

132 
	}
}

136 
ušt
 
	$ÿlc_hashÄ_ÿ£up
(cÚ¡ 
uch¬
 *
key
,
ušt
 
Ëngth
)

138 
ušt
 
Ä
=1, 
Ä2
=4;

139 
Ëngth
--)

141 
Ä
^ð((Ò¸& 63)+
Ä2
)*((
ušt
è(
uch¬
è
	`touµ”
(*
key
++)))+ (nr << 8);

142 
Ä2
+=3;

144 ((
ušt
è
Ä
);

145 
	}
}

164 
ušt
 
	$ÿlc_hashÄ
(cÚ¡ 
uch¬
 *
key
, 
ušt
 
Ën
)

166 cÚ¡ 
uch¬
 *
’d
=
key
+
Ën
;

167 
ušt
 
hash
;

168 
hash
 = 0; 
key
 < 
’d
; key++)

170 
hash
 *= 16777619;

171 
hash
 ^ð(
ušt
è*(
uch¬
*è
key
;

173  (
hash
);

174 
	}
}

176 
ušt
 
	$ÿlc_hashÄ_ÿ£up
(cÚ¡ 
uch¬
 *
key
, 
ušt
 
Ën
)

178 cÚ¡ 
uch¬
 *
’d
=
key
+
Ën
;

179 
ušt
 
hash
;

180 
hash
 = 0; 
key
 < 
’d
; key++)

182 
hash
 *= 16777619;

183 
hash
 ^ð(
ušt
è(
uch¬
è
	`touµ”
(*
key
);

185  (
hash
);

186 
	}
}

191 #iâdeà
__SUNPRO_C


192 
	gšlše


194 
	$»c_hashÄ
(
HASH
 *
hash
,cÚ¡ 
uch¬
 *
»cÜd
)

196 
ušt
 
Ëngth
;

197 
uch¬
 *
key
ð(uch¬*è
	`hash_key
(
hash
,
»cÜd
,&
Ëngth
,0);

198  (*
hash
->
ÿlc_hashÄ
)(
key
,
Ëngth
);

199 
	}
}

205 * 
	$hash_£¬ch
(
HASH
 *
hash
,cÚ¡ 
uch¬
 *
key
,
ušt
 
Ëngth
)

207 
HASH_LINK
 *
pos
;

208 
ušt
 
æag
,
idx
;

210 
æag
=1;

211 ià(
hash
->
»cÜds
)

213 
idx
=
	`hash_mask
((*
hash
->
ÿlc_hashÄ
)(
key
,
Ëngth
 ?†ength :

214 
hash
->
key_Ëngth
),

215 
hash
->
bËngth
,hash->
»cÜds
);

218 
pos
ð
	`dyÇmic_–em’t
(&
hash
->
¬¿y
,
idx
,
HASH_LINK
*);

219 ià(!
	`hashcmp
(
hash
,
pos
,
key
,
Ëngth
))

221 
hash
->
cu¼’t_»cÜd
ð
idx
;

222  (
pos
->
d©a
);

224 ià(
æag
)

226 
æag
=0;

227 ià(
	`hash_»c_mask
(
hash
,
pos
,hash->
bËngth
,hash->
»cÜds
è!ð
idx
)

231 (
idx
=
pos
->
Ãxt
è!ð
NO_RECORD
);

233 
hash
->
cu¼’t_»cÜd
ð
NO_RECORD
;

235 
	}
}

240 *
	$hash_Ãxt
(
HASH
 *
hash
,cÚ¡ 
uch¬
 *
key
,
ušt
 
Ëngth
)

242 
HASH_LINK
 *
pos
;

243 
ušt
 
idx
;

245 ià(
hash
->
cu¼’t_»cÜd
 !ð
NO_RECORD
)

247 
HASH_LINK
 *
d©a
=
	`dyÇmic_–em’t
(&
hash
->
¬¿y
,0,HASH_LINK*);

248 
idx
=
d©a
[
hash
->
cu¼’t_»cÜd
].
Ãxt
; idx !ð
NO_RECORD
 ; idx=
pos
->next)

250 
pos
=
d©a
+
idx
;

251 ià(!
	`hashcmp
(
hash
,
pos
,
key
,
Ëngth
))

253 
hash
->
cu¼’t_»cÜd
ð
idx
;

254  
pos
->
d©a
;

257 
hash
->
cu¼’t_»cÜd
=
NO_RECORD
;

260 
	}
}

265 
	$mov–šk
(
HASH_LINK
 *
¬¿y
,
ušt
 
fšd
,ušˆ
Ãxt_lšk
,ušˆ
Ãwlšk
)

267 
HASH_LINK
 *
Þd_lšk
;

270 
Þd_lšk
=
¬¿y
+
Ãxt_lšk
;

272 (
Ãxt_lšk
=
Þd_lšk
->
Ãxt
è!ð
fšd
);

273 
Þd_lšk
->
Ãxt
ð
Ãwlšk
;

275 
	}
}

279 
	$hashcmp
(
HASH
 *
hash
,
HASH_LINK
 *
pos
,cÚ¡ 
uch¬
 *
key
,
ušt
 
Ëngth
)

281 
ušt
 
»c_keyËngth
;

282 
uch¬
 *
»c_key
ð(uch¬*è
	`hash_key
(
hash
,
pos
->
d©a
,&
»c_keyËngth
,1);

283  (
Ëngth
 &&†’gth !ð
»c_keyËngth
) ||

284 
	`memcmp
(
»c_key
,
key
,
»c_keyËngth
);

285 
	}
}

290 
my_boÞ
 
	$hash_š£¹
(
HASH
 *
šfo
,cÚ¡ 
uch¬
 *
»cÜd
)

292 
æag
;

293 
ušt
 
h®fbuff
,
hash_Ä
,
fœ¡_šdex
,
idx
;

294 
uch¬
 *
±r_to_»c
ð
NULL
,*
±r_to_»c2
= NULL;

295 
HASH_LINK
 *
d©a
,*
em±y
,*
gpos
ð
NULL
,*
gpos2
 = NULL,*
pos
;

297 
	`LINT_INIT
(
gpos
); LINT_INIT(
gpos2
);

298 
	`LINT_INIT
(
±r_to_»c
); LINT_INIT(
±r_to_»c2
);

300 
æag
=0;

301 ià(!(
em±y
=(
HASH_LINK
*è
	`ma_®loc_dyÇmic
(&
šfo
->
¬¿y
)))

302 (
TRUE
);

304 
šfo
->
cu¼’t_»cÜd
ð
NO_RECORD
;

305 
d©a
=
	`dyÇmic_–em’t
(&
šfo
->
¬¿y
,0,
HASH_LINK
*);

306 
h®fbuff
ð
šfo
->
bËngth
 >> 1;

308 
idx
=
fœ¡_šdex
=
šfo
->
»cÜds
-
h®fbuff
;

309 ià(
idx
 !ð
šfo
->
»cÜds
)

313 
pos
=
d©a
+
idx
;

314 
hash_Ä
=
	`»c_hashÄ
(
šfo
,
pos
->
d©a
);

315 ià(
æag
 == 0)

316 ià(
	`hash_mask
(
hash_Ä
,
šfo
->
bËngth
,šfo->
»cÜds
è!ð
fœ¡_šdex
)

318 ià(!(
hash_Ä
 & 
h®fbuff
))

320 ià(!(
æag
 & 
LOWFIND
))

322 ià(
æag
 & 
HIGHFIND
)

324 
æag
=
LOWFIND
 | 
HIGHFIND
;

326 
gpos
=
em±y
;

327 
±r_to_»c
=
pos
->
d©a
;

328 
em±y
=
pos
;

332 
æag
=
LOWFIND
 | 
LOWUSED
;

333 
gpos
=
pos
;

334 
±r_to_»c
=
pos
->
d©a
;

339 ià(!(
æag
 & 
LOWUSED
))

342 
gpos
->
d©a
=
±r_to_»c
;

343 
gpos
->
Ãxt
=(
ušt
è(
pos
-
d©a
);

344 
æag
ð(æag & 
HIGHFIND
è| (
LOWFIND
 | 
LOWUSED
);

346 
gpos
=
pos
;

347 
±r_to_»c
=
pos
->
d©a
;

352 ià(!(
æag
 & 
HIGHFIND
))

354 
æag
ð(æag & 
LOWFIND
è| 
HIGHFIND
;

356 
gpos2
 = 
em±y
;ƒm±y=
pos
;

357 
±r_to_»c2
=
pos
->
d©a
;

361 ià(!(
æag
 & 
HIGHUSED
))

364 
gpos2
->
d©a
=
±r_to_»c2
;

365 
gpos2
->
Ãxt
=(
ušt
è(
pos
-
d©a
);

366 
æag
ð(æag & 
LOWFIND
è| (
HIGHFIND
 | 
HIGHUSED
);

368 
gpos2
=
pos
;

369 
±r_to_»c2
=
pos
->
d©a
;

373 (
idx
=
pos
->
Ãxt
è!ð
NO_RECORD
);

375 ià((
æag
 & (
LOWFIND
 | 
LOWUSED
)) == LOWFIND)

377 
gpos
->
d©a
=
±r_to_»c
;

378 
gpos
->
Ãxt
=
NO_RECORD
;

380 ià((
æag
 & (
HIGHFIND
 | 
HIGHUSED
)) == HIGHFIND)

382 
gpos2
->
d©a
=
±r_to_»c2
;

383 
gpos2
->
Ãxt
=
NO_RECORD
;

388 
idx
=
	`hash_mask
(
	`»c_hashÄ
(
šfo
,
»cÜd
),šfo->
bËngth
,šfo->
»cÜds
+1);

389 
pos
=
d©a
+
idx
;

390 ià(
pos
 =ð
em±y
)

392 
pos
->
d©a
=(
uch¬
*è
»cÜd
;

393 
pos
->
Ãxt
=
NO_RECORD
;

398 
em±y
[0]=
pos
[0];

399 
gpos
=
d©a
+
	`hash_»c_mask
(
šfo
,
pos
,šfo->
bËngth
,šfo->
»cÜds
+1);

400 ià(
pos
 =ð
gpos
)

402 
pos
->
d©a
=(
uch¬
*è
»cÜd
;

403 
pos
->
Ãxt
=(
ušt
è(
em±y
 - 
d©a
);

407 
pos
->
d©a
=(
uch¬
*è
»cÜd
;

408 
pos
->
Ãxt
=
NO_RECORD
;

409 
	`mov–šk
(
d©a
,(
ušt
è(
pos
-d©a),(uštè(
gpos
-d©a),(uštè(
em±y
-data));

412 ià(++
šfo
->
»cÜds
 =ðšfo->
bËngth
)

413 
šfo
->
bËngth
+= info->blength;

415 
	}
}

424 
my_boÞ
 
	$hash_d–‘e
(
HASH
 *
hash
,
uch¬
 *
»cÜd
)

426 
ušt
 
bËngth
,
pos2
,
pos_hashÄ
,
Ï¡pos_hashÄ
,
idx
,
em±y_šdex
;

427 
HASH_LINK
 *
d©a
,*
Ï¡pos
,*
gpos
,*
pos
,*
pos3
,*
em±y
;

428 ià(!
hash
->
»cÜds
)

431 
bËngth
=
hash
->blength;

432 
d©a
=
	`dyÇmic_–em’t
(&
hash
->
¬¿y
,0,
HASH_LINK
*);

434 
pos
=
d©a
+ 
	`hash_mask
(
	`»c_hashÄ
(
hash
,
»cÜd
),
bËngth
,hash->
»cÜds
);

435 
gpos
 = 0;

437 
pos
->
d©a
 !ð
»cÜd
)

439 
gpos
=
pos
;

440 ià(
pos
->
Ãxt
 =ð
NO_RECORD
)

442 
pos
=
d©a
+pos->
Ãxt
;

445 iàÐ--(
hash
->
»cÜds
è< hash->
bËngth
 >> 1) hash->blength>>=1;

446 
hash
->
cu¼’t_»cÜd
ð
NO_RECORD
;

447 
Ï¡pos
=
d©a
+
hash
->
»cÜds
;

450 
em±y
=
pos
; 
em±y_šdex
=(
ušt
èÓm±y-
d©a
);

451 ià(
gpos
)

452 
gpos
->
Ãxt
=
pos
->next;

453 ià(
pos
->
Ãxt
 !ð
NO_RECORD
)

455 
em±y
=
d©a
+(
em±y_šdex
=
pos
->
Ãxt
);

456 
pos
->
d©a
=
em±y
->data;

457 
pos
->
Ãxt
=
em±y
->next;

460 ià(
em±y
 =ð
Ï¡pos
)

461 
ex™
;

464 
Ï¡pos_hashÄ
=
	`»c_hashÄ
(
hash
,
Ï¡pos
->
d©a
);

466 
pos
=
d©a
+
	`hash_mask
(
Ï¡pos_hashÄ
,
hash
->
bËngth
,hash->
»cÜds
);

467 ià(
pos
 =ð
em±y
)

469 
em±y
[0]=
Ï¡pos
[0];

470 
ex™
;

472 
pos_hashÄ
=
	`»c_hashÄ
(
hash
,
pos
->
d©a
);

474 
pos3
ð
d©a
+
	`hash_mask
(
pos_hashÄ
,
hash
->
bËngth
,hash->
»cÜds
);

475 ià(
pos
 !ð
pos3
)

477 
em±y
[0]=
pos
[0];

478 
pos
[0]=
Ï¡pos
[0];

479 
	`mov–šk
(
d©a
,(
ušt
è(
pos
-d©a),(uštè(
pos3
-d©a),
em±y_šdex
);

480 
ex™
;

482 
pos2
ð
	`hash_mask
(
Ï¡pos_hashÄ
,
bËngth
,
hash
->
»cÜds
+1);

483 ià(
pos2
 =ð
	`hash_mask
(
pos_hashÄ
,
bËngth
,
hash
->
»cÜds
+1))

485 ià(
pos2
 !ð
hash
->
»cÜds
)

487 
em±y
[0]=
Ï¡pos
[0];

488 
	`mov–šk
(
d©a
,(
ušt
è(
Ï¡pos
-d©a),(uštè(
pos
-d©a),
em±y_šdex
);

489 
ex™
;

491 
idx
ð(
ušt
è(
pos
-
d©a
);

493 
idx
ð
NO_RECORD
;

495 
em±y
[0]=
Ï¡pos
[0];

496 
	`mov–šk
(
d©a
,
idx
,
em±y_šdex
,
pos
->
Ãxt
);

497 
pos
->
Ãxt
=
em±y_šdex
;

499 
ex™
:

500 
	`ma_pÝ_dyÇmic
(&
hash
->
¬¿y
);

501 ià(
hash
->
ä“
)

502 (*
hash
->
ä“
)((
uch¬
*è
»cÜd
);

504 
	}
}

511 
my_boÞ
 
	$hash_upd©e
(
HASH
 *
hash
,
uch¬
 *
»cÜd
,uch¬ *
Þd_key
,
ušt
 
Þd_key_Ëngth
)

513 
ušt
 
idx
,
Ãw_šdex
,
Ãw_pos_šdex
,
bËngth
,
»cÜds
,
em±y
;

514 
HASH_LINK
 
Üg_lšk
,*
d©a
,*
´evious
,*
pos
;

516 
d©a
=
	`dyÇmic_–em’t
(&
hash
->
¬¿y
,0,
HASH_LINK
*);

517 
bËngth
=
hash
->bËngth; 
»cÜds
=hash->records;

521 
idx
=
	`hash_mask
((*
hash
->
ÿlc_hashÄ
)(
Þd_key
,(
Þd_key_Ëngth
 ?

522 
Þd_key_Ëngth
 :

523 
hash
->
key_Ëngth
)),

524 
bËngth
,
»cÜds
);

525 
Ãw_šdex
=
	`hash_mask
(
	`»c_hashÄ
(
hash
,
»cÜd
),
bËngth
,
»cÜds
);

526 ià(
idx
 =ð
Ãw_šdex
)

528 
´evious
=0;

532 ià((
pos
ð
d©a
+
idx
)->d©¨=ð
»cÜd
)

534 
´evious
=
pos
;

535 ià((
idx
=
pos
->
Ãxt
è=ð
NO_RECORD
)

538 
hash
->
cu¼’t_»cÜd
ð
NO_RECORD
;

539 
Üg_lšk
ð*
pos
;

540 
em±y
=
idx
;

544 ià(!
´evious
)

546 ià(
pos
->
Ãxt
 !ð
NO_RECORD
)

548 
em±y
=
pos
->
Ãxt
;

549 *
pos
ð
d©a
[pos->
Ãxt
];

553 
´evious
->
Ãxt
=
pos
->next;

556 
pos
=
d©a
+
Ãw_šdex
;

557 
Ãw_pos_šdex
=
	`hash_»c_mask
(
hash
,
pos
,
bËngth
,
»cÜds
);

558 ià(
Ãw_šdex
 !ð
Ãw_pos_šdex
)

560 
d©a
[
em±y
] = *
pos
;

561 
	`mov–šk
(
d©a
,
Ãw_šdex
,
Ãw_pos_šdex
,
em±y
);

562 
Üg_lšk
.
Ãxt
=
NO_RECORD
;

563 
d©a
[
Ãw_šdex
]ð
Üg_lšk
;

567 
Üg_lšk
.
Ãxt
=
d©a
[
Ãw_šdex
].next;

568 
d©a
[
em±y
]=
Üg_lšk
;

569 
d©a
[
Ãw_šdex
].
Ãxt
=
em±y
;

572 
	}
}

575 
uch¬
 *
	$hash_–em’t
(
HASH
 *
hash
,
ušt
 
idx
)

577 ià(
idx
 < 
hash
->
»cÜds
)

578  
	`dyÇmic_–em’t
(&
hash
->
¬¿y
,
idx
,
HASH_LINK
*)->
d©a
;

580 
	}
}

	@libmariadb/ma_init.c

19 
	~<ma_glob®.h
>

20 
	~<ma_sys.h
>

21 
	~"m¬Ÿdb_ùy³.h
"

22 
	~<ma_¡ršg.h
>

23 
	~<m¬Ÿdb_ùy³.h
>

24 
	~<sigÇl.h
>

25 #ifdeà
_WIN32


26 #ifdeà
_MSC_VER


27 
	~<loÿË.h
>

28 
	~<ütdbg.h
>

30 
my_boÞ
 
my_wš_š™
();

32 
	#my_wš_š™
()

	)

35 
my_boÞ
 
	gma_š™_dÚe
=0;

41 
	$ma_š™
()

43 ià(
ma_š™_dÚe
)

45 
ma_š™_dÚe
=1;

47 #ifdeà
_WIN32


48 
	`my_wš_š™
();

52 
	}
}

56 
ma_’d
(
šfoæag
 
__©Œibu‹__
((
unu£d
)))

58 #ifdeà
_WIN32


59 
WSACËªup
( );

61 
	gma_š™_dÚe
=0;

64 #ifdeà
_WIN32


65 
my_boÞ
 
	$my_wš_š™
()

67 
WORD
 
V”siÚReque¡ed
;

68 
”r
;

69 
WSADATA
 
W§D©a
;

70 cÚ¡ 
MajÜV”siÚ
=2,

71 
MšÜV”siÚ
=2;

72 
V”siÚReque¡ed
ð
	`MAKEWORD
(
MajÜV”siÚ
, 
MšÜV”siÚ
);

74 ià((
”r
ð
	`WSAS¹up
(
V”siÚReque¡ed
, &
W§D©a
)))

79 ià((
	`LOBYTE
(
W§D©a
.
wV”siÚ
è* 10 + 
	`HIBYTE
(WsaData.wVersion)) < 22)

81 
	`WSACËªup
();

85 
	}
}

	@libmariadb/ma_io.c

20 
	~<ma_glob®.h
>

21 
	~<ma_sys.h
>

22 
	~<”rmsg.h
>

23 
	~<mysql.h
>

24 
	~<mysql/þ›Á_¶ugš.h
>

25 
	~<m¬Ÿdb/ma_io.h
>

26 
	~<¡dio.h
>

27 
	~<¡ršg.h
>

29 #ifdeà
HAVE_REMOTEIO


30 
¡_mysql_þ›Á_¶ugš_REMOTEIO
 *
	grio_¶ugš
ð
NULL
;

34 
MA_FILE
 *
	$ma_Ý’
(cÚ¡ *
loÿtiÚ
, cÚ¡ *
mode
, 
MYSQL
 *
mysql
)

36 
CodePage
= -1;

37 
FILE
 *
å
ð
NULL
;

38 
MA_FILE
 *
ma_fže
ð
NULL
;

40 ià(!
loÿtiÚ
 || !location[0])

41  
NULL
;

42 #ifdeà
HAVE_REMOTEIO


43 ià(
	`¡r¡r
(
loÿtiÚ
, "://"))

44 
»mÙe
;

47 #ifdeà
_WIN32


48 ià(
mysql
 && mysql->
ch¬£t
)

49 
CodePage
ð
	`madb_g‘_wšdows_ý
(
mysql
->
ch¬£t
->
c¢ame
);

51 ià(
CodePage
 == -1)

53 ià(!(
å
ð
	`fÝ’
(
loÿtiÚ
, 
mode
)))

55  
NULL
;

58 #ifdeà
_WIN32


63 
wch¬_t
 *
w_fž’ame
ð
NULL
;

64 
wch¬_t
 *
w_mode
ð
NULL
;

65 
Ën
;

66 
DWORD
 
L’gth
;

68 
Ën
ð
	`MuÉiBy‹ToWideCh¬
(
CodePage
, 0, 
loÿtiÚ
, ()
	`¡¾’
ÖoÿtiÚ), 
NULL
, 0);

69 ià(!
Ën
)

70  
NULL
;

71 ià(!(
w_fž’ame
ð(
wch¬_t
 *)
	`ÿÎoc
(1, (
Ën
 + 1) * (wchar_t))))

73 
	`my_£t_”rÜ
(
mysql
, 
CR_OUT_OF_MEMORY
, 
SQLSTATE_UNKNOWN
, 0);

74  
NULL
;

76 
L’gth
ð
Ën
;

77 
Ën
ð
	`MuÉiBy‹ToWideCh¬
(
CodePage
, 0, 
loÿtiÚ
, ()
	`¡¾’
ÖoÿtiÚ), 
w_fž’ame
, ()
L’gth
);

78 ià(!
Ën
)

81 
	`ä“
(
w_fž’ame
);

82  
NULL
;

84 
Ën
ð()
	`¡¾’
(
mode
);

85 ià(!(
w_mode
ð(
wch¬_t
 *)
	`ÿÎoc
(1, (
Ën
 + 1) * (wchar_t))))

87 
	`my_£t_”rÜ
(
mysql
, 
CR_OUT_OF_MEMORY
, 
SQLSTATE_UNKNOWN
, 0);

88 
	`ä“
(
w_fž’ame
);

89  
NULL
;

91 
L’gth
ð
Ën
;

92 
Ën
ð
	`MuÉiBy‹ToWideCh¬
(
CodePage
, 0, 
mode
, ()
	`¡¾’
(mode), 
w_mode
, ()
L’gth
);

93 ià(!
Ën
)

96 
	`ä“
(
w_fž’ame
);

97 
	`ä“
(
w_mode
);

98  
NULL
;

100 
å
ð
	`_wfÝ’
(
w_fž’ame
, 
w_mode
);

101 
	`ä“
(
w_fž’ame
);

102 
	`ä“
(
w_mode
);

106 ià(
å
)

108 
ma_fže
ð(
MA_FILE
 *)
	`m®loc
((MA_FILE));

109 ià(!
ma_fže
)

111 
	`fþo£
(
å
);

112 
	`my_£t_”rÜ
(
mysql
, 
CR_OUT_OF_MEMORY
, 
SQLSTATE_UNKNOWN
, 0);

113  
NULL
;

115 
ma_fže
->
ty³
ð
MA_FILE_LOCAL
;

116 
ma_fže
->
±r
ð(*)
å
;

118  
ma_fže
;

119 #ifdeà
HAVE_REMOTEIO


120 
»mÙe
:

124 
MYSQL
 
mysql
;

125 ià(
rio_¶ugš
 ||Ôio_¶ugšð(
¡_mysql_þ›Á_¶ugš_REMOTEIO
 *)

126 
	`mysql_þ›Á_fšd_¶ugš
(&
mysql
, 
NULL
, 
MARIADB_CLIENT_REMOTEIO_PLUGIN
)))

127  
rio_¶ugš
->
m‘hods
->
	`mÝ’
(
loÿtiÚ
, 
mode
);

128  
NULL
;

131 
	}
}

135 
	$ma_þo£
(
MA_FILE
 *
fže
)

137 
rc
;

138 ià(!
fže
)

141 
fže
->
ty³
) {

142 
MA_FILE_LOCAL
:

143 
rc
ð
	`fþo£
((
FILE
 *)
fže
->
±r
);

144 
	`ä“
(
fže
);

146 #ifdeà
HAVE_REMOTEIO


147 
MA_FILE_REMOTE
:

148 
rc
ð
rio_¶ugš
->
m‘hods
->
	`mþo£
(
fže
);

154  
rc
;

155 
	}
}

160 
	$ma_ãof
(
MA_FILE
 *
fže
)

162 ià(!
fže
)

165 
fže
->
ty³
) {

166 
MA_FILE_LOCAL
:

167  
	`ãof
((
FILE
 *)
fže
->
±r
);

169 #ifdeà
HAVE_REMOTEIO


170 
MA_FILE_REMOTE
:

171  
rio_¶ugš
->
m‘hods
->
	`mãof
(
fže
);

177 
	}
}

181 
size_t
 
	$ma_»ad
(*
±r
, 
size_t
 
size
, size_ˆ
nmemb
, 
MA_FILE
 *
fže
)

183 
size_t
 
s
= 0;

184 ià(!
fže
)

187 
fže
->
ty³
) {

188 
MA_FILE_LOCAL
:

189 
s
ð
	`ä—d
(
±r
, 
size
, 
nmemb
, (
FILE
 *)
fže
->ptr);

190  
s
;

192 #ifdeà
HAVE_REMOTEIO


193 
MA_FILE_REMOTE
:

194  
rio_¶ugš
->
m‘hods
->
	`m»ad
(
±r
, 
size
, 
nmemb
, 
fže
);

200 
	}
}

204 *
	$ma_g‘s
(*
±r
, 
size_t
 
size
, 
MA_FILE
 *
fže
)

206 ià(!
fže
)

207  
NULL
;

209 
fže
->
ty³
) {

210 
MA_FILE_LOCAL
:

211  
	`fg‘s
(
±r
, ()
size
, (
FILE
 *)
fže
->ptr);

213 #ifdeà
HAVE_REMOTEIO


214 
MA_FILE_REMOTE
:

215  
rio_¶ugš
->
m‘hods
->
	`mg‘s
(
±r
, 
size
, 
fže
);

219  
NULL
;

221 
	}
}

	@libmariadb/ma_list.c

23 
	~<ma_glob®.h
>

24 
	~<ma_sys.h
>

25 
	~<ma_li¡.h
>

29 
LIST
 *
	$li¡_add
(
LIST
 *
roÙ
, LIST *
–em’t
)

31 ià(
roÙ
)

33 ià(
roÙ
->
´ev
)

34 
roÙ
->
´ev
->
Ãxt
ð
–em’t
;

35 
–em’t
->
´ev
=
roÙ
->prev;

36 
roÙ
->
´ev
=
–em’t
;

39 
–em’t
->
´ev
=0;

40 
–em’t
->
Ãxt
=
roÙ
;

41 (
–em’t
);

42 
	}
}

45 
LIST
 *
	$li¡_d–‘e
(
LIST
 *
roÙ
, LIST *
–em’t
)

47 ià(
–em’t
->
´ev
)

48 
–em’t
->
´ev
->
Ãxt
=element->next;

50 
roÙ
=
–em’t
->
Ãxt
;

51 ià(
–em’t
->
Ãxt
)

52 
–em’t
->
Ãxt
->
´ev
=element->prev;

53  
roÙ
;

54 
	}
}

57 
	$li¡_ä“
(
LIST
 *
roÙ
, 
ä“_d©a
)

59 
LIST
 *
Ãxt
;

60 
roÙ
)

62 
Ãxt
=
roÙ
->next;

63 ià(
ä“_d©a
)

64 
	`ä“
(
roÙ
->
d©a
);

65 
	`ä“
(
roÙ
);

66 
roÙ
=
Ãxt
;

68 
	}
}

71 
LIST
 *
	$li¡_cÚs
(*
d©a
, 
LIST
 *
li¡
)

73 
LIST
 *
Ãw_ch¬£t
=(LIST*è
	`m®loc
((LIST));

74 ià(!
Ãw_ch¬£t
)

76 
Ãw_ch¬£t
->
d©a
=data;

77  
	`li¡_add
(
li¡
,
Ãw_ch¬£t
);

78 
	}
}

81 
LIST
 *
	$li¡_»v”£
(
LIST
 *
roÙ
)

83 
LIST
 *
Ï¡
;

85 
Ï¡
=
roÙ
;

86 
roÙ
)

88 
Ï¡
=
roÙ
;

89 
roÙ
ôoÙ->
Ãxt
;

90 
Ï¡
->
Ãxt
öa¡->
´ev
;

91 
Ï¡
->
´ev
=
roÙ
;

93  
Ï¡
;

94 
	}
}

96 
ušt
 
	$li¡_Ëngth
(
LIST
 *
li¡
)

98 
ušt
 
couÁ
;

99 
couÁ
=0 ; 
li¡
 ;†i¡öi¡->
Ãxt
, count++) ;

100  
couÁ
;

101 
	}
}

104 
	$li¡_w®k
(
LIST
 *
li¡
, 
li¡_w®k_aùiÚ
 
aùiÚ
, 
g±r
 
¬gum’t
)

106 
”rÜ
=0;

107 
li¡
)

109 ià((
”rÜ
 = (*
aùiÚ
)(
li¡
->
d©a
,
¬gum’t
)))

110  
”rÜ
;

111 
li¡
ð
	`li¡_»¡
(list);

114 
	}
}

	@libmariadb/ma_ll2str.c

19 
	~<ma_glob®.h
>

20 
	~"ma_¡ršg.h
"

21 
	~<ùy³.h
>

23 
NEAR
 
	g_dig_vec
[] =

26 *
	$ma_Î2¡r
(
v®
,*
d¡
,
¿dix
)

28 
bufãr
[65];

29 *
p
;

30 
lÚg_v®
;

32 ià(
¿dix
 < 0)

34 ià(
¿dix
 < -36 ||„adix > -2)  (*) 0;

35 ià(
v®
 < 0) {

36 *
d¡
++ = '-';

37 
v®
 = 0ULL - val;

39 
¿dix
 = -radix;

43 ià(
¿dix
 > 36 ||„adix < 2)  (*) 0;

45 ià(
v®
 == 0)

47 *
d¡
++='0';

48 *
d¡
='\0';

49  
d¡
;

51 
p
 = &
bufãr
[(buffer)-1];

52 *
p
 = '\0';

54 (
ulÚglÚg
è
v®
 > (ulÚglÚgè
LONG_MAX
)

56 
ulÚglÚg
 
quo
=(ulÚglÚgè
v®
/(
ušt
è
¿dix
;

57 
ušt
 
»m
ð(uštè(
v®
- 
quo
* (uštè
¿dix
);

58 *--
p
 = 
_dig_vec
[
»m
];

59 
v®
ð
quo
;

61 
lÚg_v®
ð(è
v®
;

62 
lÚg_v®
 != 0)

64 
quo
ð
lÚg_v®
/
¿dix
;

65 *--
p
 = 
_dig_vec
[(
uch¬
è(
lÚg_v®
 - 
quo
*
¿dix
)];

66 
lÚg_v®
ð
quo
;

68 (*
d¡
++ = *
p
++) != 0) ;

69  
d¡
-1;

70 
	}
}

	@libmariadb/ma_loaddata.c

43 
	~"ma_glob®.h
"

44 
	~<ma_sys.h
>

45 
	~<ma_¡ršg.h
>

46 
	~"”rmsg.h
"

47 
	~"mysql.h
"

48 
	~<m¬Ÿdb/ma_io.h
>

49 
	~<¡ršg.h
>

50 #ifdeà
_WIN32


51 
	~<sh¬e.h
>

53 
	~<ma_commÚ.h
>

55 
	s¡_mysql_šfže_šfo


57 
MA_FILE
 *
	må
;

58 
	m”rÜ_no
;

59 
	m”rÜ_msg
[
MYSQL_ERRMSG_SIZE
 + 1];

60 cÚ¡ *
	mfž’ame
;

61 } 
	tMYSQL_INFILE_INFO
;

65 
	$mysql_loÿl_šfže_š™
(**
±r
, cÚ¡ *
fž’ame
, *
u£rd©a
)

67 
MYSQL_INFILE_INFO
 *
šfo
;

68 
MYSQL
 *
mysql
ð(MYSQL *)
u£rd©a
;

70 
šfo
 = (
MYSQL_INFILE_INFO
 *)
	`m®loc
((MYSQL_INFILE_INFO));

71 ià(!
šfo
) {

74 
	`mem£t
(
šfo
, 0, (
MYSQL_INFILE_INFO
));

75 *
±r
 = 
šfo
;

77 
šfo
->
fž’ame
 = filename;

79 
šfo
->
å
ð
	`ma_Ý’
(
fž’ame
, "rb", 
mysql
);

81 ià(!
šfo
->
å
)

85 ià(
	`mysql_”ºo
(
mysql
è&& !
šfo
->
”rÜ_no
)

87 
šfo
->
”rÜ_no
ð
	`mysql_”ºo
(
mysql
);

88 
	`ma_¡rmake
(
šfo
->
”rÜ_msg
, 
	`mysql_”rÜ
(
mysql
), 
MYSQL_ERRMSG_SIZE
);

92 
šfo
->
”rÜ_no
 = 
”ºo
;

93 
	`¢´štf
((*)
šfo
->
”rÜ_msg
, (info->error_msg),

94 
	`CER
(
CR_FILE_NOT_FOUND
), 
fž’ame
, 
šfo
->
”rÜ_no
);

100 
	}
}

106 
	$mysql_loÿl_šfže_»ad
(*
±r
, * 
buf
, 
buf_Ën
)

108 
MYSQL_INFILE_INFO
 *
šfo
 = (MYSQL_INFILE_INFO *)
±r
;

109 
size_t
 
couÁ
;

111 
couÁ
ð
	`ma_»ad
((*)
buf
, 1, (
size_t
)
buf_Ën
, 
šfo
->
å
);

113 ià(
couÁ
 =ð(
size_t
)-1)

115 
šfo
->
”rÜ_no
 = 
”ºo
;

116 
	`¢´štf
((*)
šfo
->
”rÜ_msg
, (info->error_msg),

117 
	`CER
(
CR_FILE_READ
), 
šfo
->
fž’ame
, info->
”rÜ_no
);

119 (()
couÁ
);

120 
	}
}

126 
	$mysql_loÿl_šfže_”rÜ
(*
±r
, *
”rÜ_buf
, 
”rÜ_buf_Ën
)

128 
MYSQL_INFILE_INFO
 *
šfo
 = (MYSQL_INFILE_INFO *)
±r
;

130 ià(
šfo
) {

131 
	`ma_¡rmake
(
”rÜ_buf
, 
šfo
->
”rÜ_msg
, 
”rÜ_buf_Ën
);

132 (
šfo
->
”rÜ_no
);

135 
	`ma_¡rmake
(
”rÜ_buf
, "UnknowÀ”rÜ", 
”rÜ_buf_Ën
);

136 (
CR_UNKNOWN_ERROR
);

137 
	}
}

143 
	$mysql_loÿl_šfže_’d
(*
±r
)

145 
MYSQL_INFILE_INFO
 *
šfo
 = (MYSQL_INFILE_INFO *)
±r
;

147 ià(
šfo
)

149 ià(
šfo
->
å
)

150 
	`ma_þo£
(
šfo
->
å
);

151 
	`ä“
(
±r
);

154 
	}
}

159 
	$mysql_£t_loÿl_šfže_deçuÉ
(
MYSQL
 *
cÚn
)

161 
cÚn
->
ÝtiÚs
.
loÿl_šfže_š™
 = 
mysql_loÿl_šfže_š™
;

162 
cÚn
->
ÝtiÚs
.
loÿl_šfže_»ad
 = 
mysql_loÿl_šfže_»ad
;

163 
cÚn
->
ÝtiÚs
.
loÿl_šfže_”rÜ
 = 
mysql_loÿl_šfže_”rÜ
;

164 
cÚn
->
ÝtiÚs
.
loÿl_šfže_’d
 = 
mysql_loÿl_šfže_’d
;

166 
	}
}

170 
STDCALL
 
mysql_£t_loÿl_šfže_hªdËr
(
MYSQL
 *
cÚn
,

171 (*
loÿl_šfže_š™
)(**, const *, *),

172 (*
loÿl_šfže_»ad
)(*, *, 
ušt
),

173 (*
loÿl_šfže_’d
)(*),

174 (*
loÿl_šfže_”rÜ
)(*, *, 
ušt
),

175 *
u£rd©a
)

177 
cÚn
->
ÝtiÚs
.
loÿl_šfže_š™
=†ocal_infile_init;

178 
cÚn
->
ÝtiÚs
.
loÿl_šfže_»ad
=†ocal_infile_read;

179 
cÚn
->
ÝtiÚs
.
loÿl_šfže_’d
=†ocal_infile_end;

180 
cÚn
->
ÝtiÚs
.
loÿl_šfže_”rÜ
=†ocal_infile_error;

181 
cÚn
->
ÝtiÚs
.
loÿl_šfže_u£rd©a
 = 
u£rd©a
;

183 
	}
}

187 
my_boÞ
 
	$mysql_hªdË_loÿl_šfže
(
MYSQL
 *
cÚn
, cÚ¡ *
fž’ame
, 
my_boÞ
 
ÿn_loÿl_šfže
)

189 
buæ’
= 4096;

190 
buä—d
;

191 *
buf
ð
NULL
;

192 *
šfo
ð
NULL
;

193 
my_boÞ
 
»suÉ
= 1;

196 ià(!
cÚn
->
ÝtiÚs
.
loÿl_šfže_š™
 || !cÚn->ÝtiÚs.
loÿl_šfže_’d
 ||

197 !
cÚn
->
ÝtiÚs
.
loÿl_šfže_»ad
 || !cÚn->ÝtiÚs.
loÿl_šfže_”rÜ
)

199 
cÚn
->
ÝtiÚs
.
loÿl_šfže_u£rd©a
= conn;

200 
	`mysql_£t_loÿl_šfže_deçuÉ
(
cÚn
);

203 ià(!(
cÚn
->
ÝtiÚs
.
þ›Á_æag
 & 
CLIENT_LOCAL_FILES
) ||

204 !
ÿn_loÿl_šfže
)

206 
	`my_£t_”rÜ
(
cÚn
, 
CR_UNKNOWN_ERROR
, 
SQLSTATE_UNKNOWN
, "Load data†ocal infile forbidden");

208 
	`ma_Ãt_wr™e
(&
cÚn
->
Ãt
, (*)"", 0);

209 
	`ma_Ãt_æush
(&
cÚn
->
Ãt
);

210 
šfže_”rÜ
;

214 
buf
 = (
uch¬
 *)
	`m®loc
(
buæ’
);

217 ià(
cÚn
->
ÝtiÚs
.
	`loÿl_šfže_š™
(&
šfo
, 
fž’ame
,

218 
cÚn
->
ÝtiÚs
.
loÿl_šfže_u£rd©a
))

220 
tmp_buf
[
MYSQL_ERRMSG_SIZE
];

221 
tmp_”ºo
;

223 
tmp_”ºo
ð
cÚn
->
ÝtiÚs
.
	`loÿl_šfže_”rÜ
(
šfo
, 
tmp_buf
, (tmp_buf));

224 
	`my_£t_”rÜ
(
cÚn
, 
tmp_”ºo
, 
SQLSTATE_UNKNOWN
, 
tmp_buf
);

225 
	`ma_Ãt_wr™e
(&
cÚn
->
Ãt
, (*)"", 0);

226 
	`ma_Ãt_æush
(&
cÚn
->
Ãt
);

227 
šfže_”rÜ
;

231 (
buä—d
ð
cÚn
->
ÝtiÚs
.
	`loÿl_šfže_»ad
(
šfo
, (*)
buf
, 
buæ’
)) > 0)

233 ià(
	`ma_Ãt_wr™e
(&
cÚn
->
Ãt
, (*)
buf
, 
buä—d
))

235 
	`my_£t_”rÜ
(
cÚn
, 
CR_SERVER_LOST
, 
SQLSTATE_UNKNOWN
, 
NULL
);

236 
šfže_”rÜ
;

241 ià(
	`ma_Ãt_wr™e
(&
cÚn
->
Ãt
, (*)"", 0) ||

242 
	`ma_Ãt_æush
(&
cÚn
->
Ãt
))

244 
	`my_£t_”rÜ
(
cÚn
, 
CR_SERVER_LOST
, 
SQLSTATE_UNKNOWN
, 
NULL
);

245 
šfže_”rÜ
;

249 ià(
buä—d
 < 0)

251 
tmp_buf
[
MYSQL_ERRMSG_SIZE
];

252 
tmp_”ºo
ð
cÚn
->
ÝtiÚs
.
	`loÿl_šfže_”rÜ
(
šfo
, 
tmp_buf
, (tmp_buf));

253 
	`my_£t_”rÜ
(
cÚn
, 
tmp_”ºo
, 
SQLSTATE_UNKNOWN
, 
tmp_buf
);

254 
šfže_”rÜ
;

257 
»suÉ
 = 0;

259 
šfže_”rÜ
:

260 
cÚn
->
ÝtiÚs
.
	`loÿl_šfže_’d
(
šfo
);

261 
	`ä“
(
buf
);

262 (
»suÉ
);

263 
	}
}

	@libmariadb/ma_net.c

26 
	~<ma_glob®.h
>

27 
	~<mysql.h
>

28 
	~<ma_pvio.h
>

29 
	~<ma_sys.h
>

30 
	~<ma_¡ršg.h
>

31 
	~"mysql.h
"

32 
	~"ma_£rv”_”rÜ.h
"

33 
	~<sigÇl.h
>

34 
	~<”ºo.h
>

35 
	~<sys/ty³s.h
>

36 
	~<ma_pvio.h
>

37 
	~<ma_commÚ.h
>

38 #iâdeà
_WIN32


39 
	~<pÞl.h
>

42 
	#MAX_PACKET_LENGTH
 (256L*256L*256L-1)

	)

47 #undeà
Ãt_bufãr_Ëngth


49 #undeà
max_®lowed_·ck‘


50 
ulÚg
 
	gmax_®lowed_·ck‘
=1024L * 1024L * 1024L;

51 
ulÚg
 
	gÃt_»ad_timeout
ð
NET_READ_TIMEOUT
;

52 
ulÚg
 
	gÃt_wr™e_timeout
ð
NET_WRITE_TIMEOUT
;

53 
ulÚg
 
	gÃt_bufãr_Ëngth
= 8192;

55 #ià!
defšed
(
_WIN32
)

56 
	~<sys/sock‘.h
>

58 #undeà
MYSQL_SERVER


60 #ià!
defšed
(
_WIN32
è&& !defšed(
HAVE_BROKEN_NETINET_INCLUDES
è&& !defšed(
__BEOS__
)

61 
	~<Ãtš‘/š_sy¡m.h
>

62 
	~<Ãtš‘/š.h
>

63 
	~<Ãtš‘/.h
>

64 #ià!
defšed
(
®pha_lšux_pÜt
)

65 
	~<Ãtš‘/tý.h
>

76 
ma_Ãt_wr™e_buff
(
NET
 *
Ãt
,cÚ¡ *
·ck‘
, 
size_t
 
Ën
);

81 
	$ma_Ãt_š™
(
NET
 *
Ãt
, 
MARIADB_PVIO
* 
pvio
)

83 ià(!(
Ãt
->
buff
=(
uch¬
*è
	`m®loc
(
Ãt_bufãr_Ëngth
)))

85 ià(!
Ãt
->
ex‹nsiÚ
)

88 
	`mem£t
(
Ãt
->
buff
, 0, 
Ãt_bufãr_Ëngth
);

90 
Ãt
->
max_·ck‘_size
ð
	`MAX
(
Ãt_bufãr_Ëngth
, 
max_®lowed_·ck‘
);

91 
Ãt
->
buff_’d
ò‘->
buff
+Ò‘->
max_·ck‘
=
Ãt_bufãr_Ëngth
);

92 
Ãt
->
pvio
 =…vio;

93 
Ãt
->
”rÜ
=0;‚‘->
»tuº_¡©us
=0;

94 
Ãt
->
»ad_timeout
=(
ušt
è
Ãt_»ad_timeout
;

95 
Ãt
->
com´ess_pkt_Ä
ðÃt->
pkt_Ä
= 0;

96 
Ãt
->
wr™e_pos
ò‘->
»ad_pos
 =‚‘->
buff
;

97 
Ãt
->
Ï¡_”rÜ
[0]ðÃt->
sql¡©e
[0] =0;

99 
Ãt
->
com´ess
=0;‚‘->
»adšg_Ü_wr™šg
=0;

100 
Ãt
->
wh”e_b
 =‚‘->
»maš_š_buf
=0;

101 
Ãt
->
Ï¡_”ºo
=0;

103 ià(
pvio
 != 0)

105 
	`ma_pvio_g‘_hªdË
(
pvio
, &
Ãt
->
fd
);

106 
	`ma_pvio_blockšg
(
pvio
, 1, 0);

107 
	`ma_pvio_ç¡_£nd
(
pvio
);

110 
	}
}

112 
	$ma_Ãt_’d
(
NET
 *
Ãt
)

114 
	`ä“
(
Ãt
->
buff
);

115 
Ãt
->
buff
=0;

116 
	}
}

120 
my_boÞ
 
	$Ãt_»®loc
(
NET
 *
Ãt
, 
size_t
 
Ëngth
)

122 
uch¬
 *
buff
;

123 
size_t
 
pkt_Ëngth
;

125 ià(
Ëngth
 >ð
Ãt
->
max_·ck‘_size
)

127 
Ãt
->
”rÜ
=1;

128 
Ãt
->
Ï¡_”ºo
=
ER_NET_PACKET_TOO_LARGE
;

131 
pkt_Ëngth
 = (
Ëngth
+
IO_SIZE
-1) & ~(IO_SIZE-1);

134 ià(!(
buff
=(
uch¬
*è
	`»®loc
(
Ãt
->buff,

135 
pkt_Ëngth
 + 
NET_HEADER_SIZE
 + 
COMP_HEADER_SIZE
)))

137 
Ãt
->
”rÜ
=1;

140 
Ãt
->
buff
ò‘->
wr™e_pos
=buff;

141 
Ãt
->
buff_’d
=
buff
+Ò‘->
max_·ck‘
=()
pkt_Ëngth
);

143 
	}
}

146 
	$ma_Ãt_þ—r
(
NET
 *
Ãt
)

148 ià(
Ãt
->
ex‹nsiÚ
->
muÉi_¡©us
 > 
COM_MULTI_OFF
)

150 
Ãt
->
com´ess_pkt_Ä
ðÃt->
pkt_Ä
=0;

151 
Ãt
->
wr™e_pos
ò‘->
buff
;

153 
	}
}

156 
	$ma_Ãt_æush
(
NET
 *
Ãt
)

158 
”rÜ
=0;

161 ià(
Ãt
->
ex‹nsiÚ
->
muÉi_¡©us
 > 
COM_MULTI_OFF
)

164 ià(
Ãt
->
buff
 !ðÃt->
wr™e_pos
)

166 
”rÜ
=
	`ma_Ãt_»®_wr™e
(
Ãt
,(*èÃt->
buff
,

167 (
size_t
è(
Ãt
->
wr™e_pos
 -‚‘->
buff
));

168 
Ãt
->
wr™e_pos
ò‘->
buff
;

170 ià(
Ãt
->
com´ess
)

171 
Ãt
->
pkt_Ä
ðÃt->
com´ess_pkt_Ä
;

172 (
”rÜ
);

173 
	}
}

186 
	$ma_Ãt_wr™e
(
NET
 *
Ãt
, cÚ¡ 
uch¬
 *
·ck‘
, 
size_t
 
Ën
)

188 
uch¬
 
buff
[
NET_HEADER_SIZE
];

189 
Ën
 >ð
MAX_PACKET_LENGTH
)

191 cÚ¡ 
ulÚg
 
max_Ën
ð
MAX_PACKET_LENGTH
;

192 
	`št3¡Üe
(
buff
,
max_Ën
);

193 
buff
[3]ð(
uch¬
)
Ãt
->
pkt_Ä
++;

194 ià(
	`ma_Ãt_wr™e_buff
(
Ãt
,(*è
buff
,
NET_HEADER_SIZE
) ||

195 
	`ma_Ãt_wr™e_buff
(
Ãt
, (*)
·ck‘
, 
max_Ën
))

197 
·ck‘
+ð
max_Ën
;

198 
Ën
-ð
max_Ën
;

201 
	`št3¡Üe
(
buff
, 
Ën
);

202 
buff
[3]ð(
uch¬
)
Ãt
->
pkt_Ä
++;

203 ià(
	`ma_Ãt_wr™e_buff
(
Ãt
,(*è
buff
,
NET_HEADER_SIZE
) ||

204 
	`ma_Ãt_wr™e_buff
(
Ãt
, (*)
·ck‘
, 
Ën
))

207 
	}
}

209 
	$ma_Ãt_wr™e_commªd
(
NET
 *
Ãt
, 
uch¬
 
commªd
,

210 cÚ¡ *
·ck‘
, 
size_t
 
Ën
,

211 
my_boÞ
 
di§bË_æush
)

213 
uch¬
 
buff
[
NET_HEADER_SIZE
+1];

214 
size_t
 
buff_size
ð
NET_HEADER_SIZE
 + 1;

215 
size_t
 
Ëngth
ð1 + 
Ën
;

216 
rc
;

218 
buff
[
NET_HEADER_SIZE
]= 0;

219 
buff
[4]=
commªd
;

221 ià(
Ëngth
 >ð
MAX_PACKET_LENGTH
)

223 
Ën
ð
MAX_PACKET_LENGTH
 - 1;

226 
	`št3¡Üe
(
buff
, 
MAX_PACKET_LENGTH
);

227 
buff
[3]ð(
Ãt
->
com´ess
è? 0 : (
uch¬
èÒ‘->
pkt_Ä
++);

229 ià(
	`ma_Ãt_wr™e_buff
(
Ãt
, (*)
buff
, 
buff_size
) ||

230 
	`ma_Ãt_wr™e_buff
(
Ãt
, 
·ck‘
, 
Ën
))

232 
·ck‘
+ð
Ën
;

233 
Ëngth
-ð
MAX_PACKET_LENGTH
;

234 
Ën
ð
MAX_PACKET_LENGTH
;

235 
buff_size
ð
NET_HEADER_SIZE
;

236 } 
Ëngth
 >ð
MAX_PACKET_LENGTH
);

237 
Ën
ð
Ëngth
;

239 
	`št3¡Üe
(
buff
,
Ëngth
);

240 
buff
[3]ð(
Ãt
->
com´ess
è? 0 :(
uch¬
èÒ‘->
pkt_Ä
++);

241 
rc
ð
	`‹¡
 (
	`ma_Ãt_wr™e_buff
(
Ãt
,(*)
buff
, 
buff_size
) ||

242 
	`ma_Ãt_wr™e_buff
(
Ãt
,
·ck‘
,
Ën
));

243 ià(!
rc
 && !
di§bË_æush
)

244  
	`‹¡
(
	`ma_Ãt_æush
(
Ãt
));

245  
rc
;

246 
	}
}

249 
	$ma_Ãt_wr™e_buff
(
NET
 *
Ãt
,cÚ¡ *
·ck‘
, 
size_t
 
Ën
)

251 
size_t
 
Ëá_Ëngth
;

253 ià(!
Ën
)

256 ià(
Ãt
->
max_·ck‘
 > 
MAX_PACKET_LENGTH
 &&

257 
Ãt
->
com´ess
)

258 
Ëá_Ëngth
ð(
size_t
)(
MAX_PACKET_LENGTH
 - (
Ãt
->
wr™e_pos
 -‚‘->
buff
));

260 
Ëá_Ëngth
=(
size_t
è(
Ãt
->
buff_’d
 -‚‘->
wr™e_pos
);

262 ià(
Ën
 > 
Ëá_Ëngth
)

264 ià(
Ãt
->
wr™e_pos
 !ðÃt->
buff
)

266 
	`memýy
((*è
Ãt
->
wr™e_pos
,
·ck‘
,
Ëá_Ëngth
);

267 ià(
	`ma_Ãt_»®_wr™e
(
Ãt
,(*èÃt->
buff
,

268 (
size_t
)(
Ãt
->
wr™e_pos
 -‚‘->
buff
è+ 
Ëá_Ëngth
))

270 
·ck‘
+=
Ëá_Ëngth
;

271 
Ën
-=
Ëá_Ëngth
;

272 
Ãt
->
wr™e_pos
ðÃt->
buff
;

274 ià(
Ãt
->
com´ess
)

278 
Ëá_Ëngth
ð
MAX_PACKET_LENGTH
;

279 
Ën
 > 
Ëá_Ëngth
)

281 ià(
	`ma_Ãt_»®_wr™e
(
Ãt
, 
·ck‘
, 
Ëá_Ëngth
))

283 
·ck‘
+ð
Ëá_Ëngth
;

284 
Ën
-ð
Ëá_Ëngth
;

287 ià(
Ën
 > 
Ãt
->
max_·ck‘
)

288 (
	`‹¡
(
	`ma_Ãt_»®_wr™e
(
Ãt
, 
·ck‘
, 
Ën
)));

290 
	`memýy
((*è
Ãt
->
wr™e_pos
,
·ck‘
,
Ën
);

291 
Ãt
->
wr™e_pos
+=
Ën
;

293 
	}
}

295 *
mysql_Ãt_¡Üe_Ëngth
(*
·ck‘
, 
size_t
 
Ëngth
);

299 
	$ma_Ãt_»®_wr™e
(
NET
 *
Ãt
, cÚ¡ *
·ck‘
, 
size_t
 
Ën
)

301 
ssize_t
 
Ëngth
;

302 *
pos
,*
’d
;

304 ià(
Ãt
->
”rÜ
 == 2)

307 
Ãt
->
»adšg_Ü_wr™šg
=2;

308 #ifdeà
HAVE_COMPRESS


309 ià(
Ãt
->
com´ess
)

311 
size_t
 
com¶’
;

312 
uch¬
 *
b
;

313 
ušt
 
h—d”_Ëngth
=
NET_HEADER_SIZE
+
COMP_HEADER_SIZE
;

314 ià(!(
b
=(
uch¬
*è
	`m®loc
(
Ën
 + 
NET_HEADER_SIZE
 + 
COMP_HEADER_SIZE
 + 1)))

316 
Ãt
->
Ï¡_”ºo
=
ER_OUT_OF_RESOURCES
;

317 
Ãt
->
”rÜ
=2;

318 
Ãt
->
»adšg_Ü_wr™šg
=0;

321 
	`memýy
(
b
+
h—d”_Ëngth
,
·ck‘
,
Ën
);

323 ià(
	`_m¬Ÿdb_com´ess
((*è
b
+
h—d”_Ëngth
,&
Ën
,&
com¶’
))

325 
com¶’
=0;

327 
	`št3¡Üe
(&
b
[
NET_HEADER_SIZE
],
com¶’
);

328 
	`št3¡Üe
(
b
,
Ën
);

329 
b
[3]=(
uch¬
è(
Ãt
->
com´ess_pkt_Ä
++);

330 
Ën
+ð
h—d”_Ëngth
;

331 
·ck‘
ð(*è
b
;

335 
pos
=(*è
·ck‘
; 
’d
õos+
Ën
;

336 
pos
 !ð
’d
)

338 ià((
Ëngth
=
	`ma_pvio_wr™e
(
Ãt
->
pvio
,(
uch¬
 *)
pos
,(
size_t
è(
’d
-pos))) <= 0)

340 
Ãt
->
”rÜ
=2;

341 
Ãt
->
Ï¡_”ºo
ð
ER_NET_ERROR_ON_WRITE
;

342 
Ãt
->
»adšg_Ü_wr™šg
=0;

343 #ifdeà
HAVE_COMPRESS


344 ià(
Ãt
->
com´ess
)

345 
	`ä“
((*è
·ck‘
);

349 
pos
+=
Ëngth
;

351 #ifdeà
HAVE_COMPRESS


352 ià(
Ãt
->
com´ess
)

353 
	`ä“
((*è
·ck‘
);

355 
Ãt
->
»adšg_Ü_wr™šg
=0;

356 (((è(
pos
 !ð
’d
)));

357 
	}
}

362 
ulÚg
 
	$ma_»®_»ad
(
NET
 *
Ãt
, 
size_t
 *
com¶’
)

364 
uch¬
 *
pos
;

365 
ssize_t
 
Ëngth
;

366 
ušt
 
i
;

367 
ulÚg
 
Ën
=
·ck‘_”rÜ
;

368 
size_t
 
»maš
ð(
Ãt
->
com´ess
 ? 
NET_HEADER_SIZE
+
COMP_HEADER_SIZE
 :

369 
NET_HEADER_SIZE
);

370 *
com¶’
 = 0;

372 
Ãt
->
»adšg_Ü_wr™šg
=1;

374 
pos
 = 
Ãt
->
buff
 +‚‘->
wh”e_b
;

375 
i
=0 ; i < 2 ; i++)

377 
»maš
 > 0)

380 ià((
Ëngth
=
	`ma_pvio_ÿche_»ad
(
Ãt
->
pvio
, 
pos
,
»maš
)) <= 0L)

382 
Ën
ð
·ck‘_”rÜ
;

383 
Ãt
->
”rÜ
=2;

384 
’d
;

386 
»maš
 -ð(
ulÚg
è
Ëngth
;

387 
pos
+ð(
ulÚg
è
Ëngth
;

390 ià(
i
 == 0)

392 
ulÚg
 
h–pšg
;

393 
Ãt
->
pkt_Ä
ðÃt->
buff
[Ãt->
wh”e_b
 + 3];

394 
Ãt
->
com´ess_pkt_Ä
ð++Ãt->
pkt_Ä
;

395 #ifdeà
HAVE_COMPRESS


396 ià(
Ãt
->
com´ess
)

399 *
com¶’
=
	`ušt3kÜr
(&(
Ãt
->
buff
[Ãt->
wh”e_b
 + 
NET_HEADER_SIZE
]));

403 
Ën
=
	`ušt3kÜr
(
Ãt
->
buff
+Ãt->
wh”e_b
);

404 ià(!
Ën
)

405 
’d
;

406 
h–pšg
 = 
	`max
(
Ën
,(
ulÚg
)*
com¶’
è+ 
Ãt
->
wh”e_b
;

408 ià(
h–pšg
 >ð
Ãt
->
max_·ck‘
)

410 ià(
	`Ãt_»®loc
(
Ãt
, 
h–pšg
))

412 
Ën
ð
·ck‘_”rÜ
;

413 
’d
;

416 
pos
=
Ãt
->
buff
 +‚‘->
wh”e_b
;

417 
»maš
 = 
Ën
;

421 
’d
:

422 
Ãt
->
»adšg_Ü_wr™šg
=0;

423 (
Ën
);

424 
	}
}

426 
ulÚg
 
	$ma_Ãt_»ad
(
NET
 *
Ãt
)

428 
size_t
 
Ën
,
com¶’
;

430 #ifdeà
HAVE_COMPRESS


431 ià(!
Ãt
->
com´ess
)

434 
Ën
 = 
	`ma_»®_»ad
 (
Ãt
,(
size_t
 *)&
com¶’
);

435 ià(
Ën
 =ð
MAX_PACKET_LENGTH
)

438 
size_t
 
Ëngth
= 0;

439 
ulÚg
 
Ï¡_pos
ð
Ãt
->
wh”e_b
;

443 
Ëngth
+ð
Ën
;

444 
Ãt
->
wh”e_b
+ð()
Ën
;

445 
Ën
ð
	`ma_»®_»ad
(
Ãt
, &
com¶’
);

446 } 
Ën
 =ð
MAX_PACKET_LENGTH
);

447 
Ãt
->
wh”e_b
ð
Ï¡_pos
;

448 ià(
Ën
 !ð
·ck‘_”rÜ
)

449 
Ën
+ð
Ëngth
;

451 
Ãt
->
»ad_pos
 =‚‘->
buff
 +‚‘->
wh”e_b
;

452 ià(
Ën
 !ð
·ck‘_”rÜ
)

453 
Ãt
->
»ad_pos
[
Ën
]=0;

454  (
ulÚg
)
Ën
;

455 #ifdeà
HAVE_COMPRESS


478 
size_t
 
·ck‘_Ëngth
,

479 
bufãr_Ëngth
;

480 
size_t
 
cu¼’t
ð0, 
¡¬t
= 0;

481 
my_boÞ
 
is_muÉi_·ck‘
= 0;

484 ià(!
Ãt
->
»maš_š_buf
)

486 
bufãr_Ëngth
= 0;

491 
bufãr_Ëngth
ð
Ãt
->
buf_Ëngth
;

492 
cu¼’t
ð
Ãt
->
buf_Ëngth
 -‚‘->
»maš_š_buf
;

493 
¡¬t
ð
cu¼’t
;

494 
Ãt
->
buff
[Ãt->
buf_Ëngth
 -‚‘->
»maš_š_buf
]ò‘->
§ve_ch¬
;

498 ià(
bufãr_Ëngth
 - 
cu¼’t
 >= 4)

500 
uch¬
 *
pos
ð
Ãt
->
buff
 + 
cu¼’t
;

501 
·ck‘_Ëngth
ð
	`ušt3kÜr
(
pos
);

504 ià(!
·ck‘_Ëngth
)

506 
cu¼’t
+= 4;

510 ià(
·ck‘_Ëngth
 + 4 <ð
bufãr_Ëngth
 - 
cu¼’t
)

512 ià(!
is_muÉi_·ck‘
)

514 
cu¼’t
ðcu¼’ˆ+ 
·ck‘_Ëngth
 + 4;

519 
	`memmove
(
Ãt
->
buff
 + 
cu¼’t
,

520 
Ãt
->
buff
 + 
cu¼’t
 + 4,

521 
bufãr_Ëngth
 - 
cu¼’t
);

522 
bufãr_Ëngth
-= 4;

523 
cu¼’t
+ð
·ck‘_Ëngth
;

526 ià(
·ck‘_Ëngth
 !ð
MAX_PACKET_LENGTH
)

528 
is_muÉi_·ck‘
= 0;

532 
is_muÉi_·ck‘
= 1;

533 ià(
¡¬t
)

535 
	`memmove
(
Ãt
->
buff
,‚‘->bufà+ 
¡¬t
,

536 
bufãr_Ëngth
 - 
¡¬t
);

538 
bufãr_Ëngth
-ð
¡¬t
;

539 
¡¬t
= 0;

544 ià(
¡¬t
)

546 
	`memmove
(
Ãt
->
buff
,‚‘->bufà+ 
¡¬t
, 
bufãr_Ëngth
 - start);

548 
cu¼’t
 -ð
¡¬t
;

549 
bufãr_Ëngth
-ð
¡¬t
;

550 
¡¬t
= 0;

553 
Ãt
->
wh”e_b
=()
bufãr_Ëngth
;

555 ià((
·ck‘_Ëngth
 = 
	`ma_»®_»ad
(
Ãt
,(
size_t
 *)&
com¶’
)è=ð
·ck‘_”rÜ
)

556  
·ck‘_”rÜ
;

557 ià(
	`_m¬Ÿdb_uncom´ess
((*è
Ãt
->
buff
 +‚‘->
wh”e_b
, &
·ck‘_Ëngth
, &
com¶’
))

559 
Ãt
->
”rÜ
=2;

560 
Ãt
->
Ï¡_”ºo
=
ER_NET_UNCOMPRESS_ERROR
;

562  
·ck‘_”rÜ
;

564 
bufãr_Ëngth
+ð
com¶’
;

567 
Ãt
->
buf_Ëngth
ð()
bufãr_Ëngth
;

568 
Ãt
->
»maš_š_buf
ð()(
bufãr_Ëngth
 - 
cu¼’t
);

569 
Ãt
->
»ad_pos
ðÃt->
buff
 + 
¡¬t
 + 4;

570 
Ën
ð
cu¼’t
 - 
¡¬t
 - 4;

571 ià(
is_muÉi_·ck‘
)

572 
Ën
-= 4;

573 
Ãt
->
§ve_ch¬
ðÃt->
»ad_pos
[
Ën
];

574 
Ãt
->
»ad_pos
[
Ën
]=0;

577  (
ulÚg
)
Ën
;

578 
	}
}

580 
	$Ãt_add_muÉi_commªd
(
NET
 *
Ãt
, 
uch¬
 
commªd
, cÚ¡ uch¬ *
·ck‘
,

581 
size_t
 
Ëngth
)

583 ià(
Ãt
->
ex‹nsiÚ
->
muÉi_¡©us
 =ð
COM_MULTI_OFF
)

588 
Ãt
->
com´ess_pkt_Ä
ðÃt->
pkt_Ä
= 0;

589  
	`ma_Ãt_wr™e_commªd
(
Ãt
, 
commªd
, (cÚ¡ *)
·ck‘
, 
Ëngth
, 1);

590 
	}
}

	@libmariadb/ma_password.c

39 
	~<ma_glob®.h
>

40 
	~<ma_sys.h
>

41 
	~<ma_¡ršg.h
>

42 
	~<ma_sha1.h
>

43 
	~"mysql.h
"

46 
	$ma_¿ndomš™
(
¿nd_¡ruù
 *
¿nd_¡
,
ulÚg
 
£ed1
, ulÚg 
£ed2
)

48 #ifdeà
HAVE_purify


49 
	`mem£t
((*è
¿nd_¡
, 0
m
 (*rand_st));

51 
¿nd_¡
->
max_v®ue
= 0x3FFFFFFFL;

52 
¿nd_¡
->
max_v®ue_dbl
=(è¿nd_¡->
max_v®ue
;

53 
¿nd_¡
->
£ed1
=£ed1%¿nd_¡->
max_v®ue
 ;

54 
¿nd_¡
->
£ed2
=£ed2%¿nd_¡->
max_v®ue
;

55 
	}
}

57 
	$ºd
(
¿nd_¡ruù
 *
¿nd_¡
)

59 
¿nd_¡
->
£ed1
=Ôªd_¡->£ed1*3+¿nd_¡->
£ed2
è%„ªd_¡->
max_v®ue
;

60 
¿nd_¡
->
£ed2
=Ôªd_¡->
£ed1
+¿nd_¡->£ed2+33è%„ªd_¡->
max_v®ue
;

61  (((è
¿nd_¡
->
£ed1
)/¿nd_¡->
max_v®ue_dbl
);

62 
	}
}

64 
	$ma_hash_·sswÜd
(
ulÚg
 *
»suÉ
, cÚ¡ *
·sswÜd
, 
size_t
 
Ën
)

66 
ulÚg
 
Ä
=1345345333L, 
add
=7, 
Ä2
=0x12345671L;

67 
ulÚg
 
tmp
;

68 cÚ¡ *
·sswÜd_’d
ð
·sswÜd
 + 
Ën
;

69 ; 
·sswÜd
 < 
·sswÜd_’d
;…assword++)

71 ià(*
·sswÜd
 == ' ' || *password == '\t')

73 
tmp
ð(
ulÚg
è(
uch¬
è*
·sswÜd
;

74 
Ä
^ð((Ò¸& 63)+
add
)*
tmp
)+ (nr << 8);

75 
Ä2
+=Òr2 << 8è^ 
Ä
;

76 
add
+=
tmp
;

78 
»suÉ
[0]=
Ä
 & (((
ulÚg
) 1L << 31) -1L); ;

79 
»suÉ
[1]=
Ä2
 & (((
ulÚg
) 1L << 31) -1L);

81 
	}
}

93 
	$my_üy±
(*
bufãr
, cÚ¡ *
s1
, cÚ¡ *
s2
, 
size_t
 
Ën
)

95 cÚ¡ *
s1_’d
ð
s1
 + 
Ën
;

96 
s1
 < 
s1_’d
) {

97 *
bufãr
++ð*
s1
++ ^ *
s2
++;

99 
	}
}

101 
	$ma_süambË_41
(cÚ¡ *
bufãr
, cÚ¡ *
süambË
, cÚ¡ *
·sswÜd
)

103 
_MA_SHA1_CTX
 
cÚ‹xt
;

104 
sha1
[
SHA1_MAX_LENGTH
];

105 
sha2
[
SHA1_MAX_LENGTH
];

109 
	`ma_SHA1In™
(&
cÚ‹xt
);

110 
	`ma_SHA1Upd©e
(&
cÚ‹xt
, (*)
·sswÜd
, 
	`¡¾’
((*)password));

111 
	`ma_SHA1Fš®
(
sha1
, &
cÚ‹xt
);

114 
	`ma_SHA1In™
(&
cÚ‹xt
);

115 
	`ma_SHA1Upd©e
(&
cÚ‹xt
, (*)
sha1
, 
SHA1_MAX_LENGTH
);

116 
	`ma_SHA1Fš®
(
sha2
, &
cÚ‹xt
);

119 
	`ma_SHA1In™
(&
cÚ‹xt
);

120 
	`ma_SHA1Upd©e
(&
cÚ‹xt
, (*)
süambË
, 
SCRAMBLE_LENGTH
);

121 
	`ma_SHA1Upd©e
(&
cÚ‹xt
, (*)
sha2
, 
SHA1_MAX_LENGTH
);

122 
	`ma_SHA1Fš®
((*)
bufãr
, &
cÚ‹xt
);

125 
	`my_üy±
((
uch¬
 *)
bufãr
, (cÚ¡ *)bufãr, (cÚ¡ *)
sha1
, 
SHA1_MAX_LENGTH
);

126 
	}
}

129 
	$ma_make_süambËd_·sswÜd
(*
to
,cÚ¡ *
·sswÜd
)

131 
ulÚg
 
hash_»s
[2];

132 
	`ma_hash_·sswÜd
(
hash_»s
,
·sswÜd
, 
	`¡¾’
(password));

133 
	`¥rštf
(
to
,"%08lx%08lx",
hash_»s
[0],hash_res[1]);

134 
	}
}

140 *
	$ma_süambË_323
(*
to
, cÚ¡ *
mes§ge
, cÚ¡ *
·sswÜd
)

142 
¿nd_¡ruù
 
¿nd_¡
;

143 
ulÚg
 
hash_·ss
[2], 
hash_mes§ge
[2];

145 ià(
·sswÜd
 &&…assword[0])

147 
exŒa
, *
to_¡¬t
=
to
;

148 cÚ¡ *
’d_süambË323
ð
mes§ge
 + 
SCRAMBLE_LENGTH_323
;

149 
	`ma_hash_·sswÜd
(
hash_·ss
,
·sswÜd
, (
ušt
è
	`¡¾’
(password));

151 
	`ma_hash_·sswÜd
(
hash_mes§ge
, 
mes§ge
, 
SCRAMBLE_LENGTH_323
);

152 
	`ma_¿ndomš™
(&
¿nd_¡
, 
hash_·ss
[0] ^ 
hash_mes§ge
[0],

153 
hash_·ss
[1] ^ 
hash_mes§ge
[1]);

154 ; 
mes§ge
 < 
’d_süambË323
; message++)

155 *
to
++ð(è(
	`æoÜ
(
	`ºd
(&
¿nd_¡
) * 31) + 64);

156 
exŒa
=(è(
	`æoÜ
(
	`ºd
(&
¿nd_¡
) * 31));

157 
to_¡¬t
 !ð
to
)

158 *(
to_¡¬t
++)^ð
exŒa
;

160 *
to
= 0;

161  
to
;

162 
	}
}

	@libmariadb/ma_pvio.c

46 
	~<ma_glob®.h
>

47 
	~<ma_sys.h
>

48 
	~<mysql.h
>

49 
	~<”rmsg.h
>

50 
	~<mysql/þ›Á_¶ugš.h
>

51 
	~<¡ršg.h
>

52 
	~<ma_commÚ.h
>

53 
	~<ma_pvio.h
>

54 
	~<m¬Ÿdb_async.h
>

55 
	~<ma_cÚ‹xt.h
>

58 
LIST
 *
	gpvio_ÿÎback
ð
NULL
;

60 
	#IS_BLOCKING_ERROR
() \

61 
	`IF_WIN
(
	`WSAG‘La¡E¼Ü
(è!ð
WSAEWOULDBLOCK
, \

62 (
”ºo
 !ð
EAGAIN
 &&ƒ¼nØ!ð
EINTR
))

	)

65 
MARIADB_PVIO
 *
	$ma_pvio_š™
(
MA_PVIO_CINFO
 *
cšfo
)

73 cÚ¡ *
pvio_¶ugšs
[] = {"pvio_socket", "pvio_npipe", "pvio_shmem"};

74 
ty³
;

75 
MARIADB_PVIO_PLUGIN
 *
pvio_¶ugš
;

76 
MARIADB_PVIO
 *
pvio
ð
NULL
;

78 
cšfo
->
ty³
)

80 
PVIO_TYPE_UNIXSOCKET
:

81 
PVIO_TYPE_SOCKET
:

82 
ty³
= 0;

84 #ifdeà
_WIN32


85 
PVIO_TYPE_NAMEDPIPE
:

86 
ty³
= 1;

88 
PVIO_TYPE_SHAREDMEM
:

89 
ty³
= 2;

93  
NULL
;

96 ià(!(
pvio_¶ugš
ð(
MARIADB_PVIO_PLUGIN
 *)

97 
	`mysql_þ›Á_fšd_¶ugš
(
cšfo
->
mysql
,

98 
pvio_¶ugšs
[
ty³
],

99 
MARIADB_CLIENT_PVIO_PLUGIN
)))

102  
NULL
;

106 ià(!(
pvio
ð(
MARIADB_PVIO
 *)
	`ÿÎoc
(1, (MARIADB_PVIO))))

108 
	`my_£t_”rÜ
(
cšfo
->
mysql
, 
CR_OUT_OF_MEMORY
, 
unknown_sql¡©e
, 0);

109  
NULL
;

113 
pvio
->
m‘hods
ð
pvio_¶ugš
->methods;

114 
pvio
->
£t_”rÜ
ð
my_£t_”rÜ
;

115 
pvio
->
ty³
ð
cšfo
->type;

119 ià(
pvio
->
m‘hods
->
£t_timeout
)

121 
pvio
->
m‘hods
->
	`£t_timeout
Õvio, 
PVIO_CONNECT_TIMEOUT
, 
cšfo
->
mysql
->
ÝtiÚs
.
cÚÃù_timeout
);

122 
pvio
->
m‘hods
->
	`£t_timeout
Õvio, 
PVIO_READ_TIMEOUT
, 
cšfo
->
mysql
->
ÝtiÚs
.
cÚÃù_timeout
);

123 
pvio
->
m‘hods
->
	`£t_timeout
Õvio, 
PVIO_WRITE_TIMEOUT
, 
cšfo
->
mysql
->
ÝtiÚs
.
cÚÃù_timeout
);

126 ià(!(
pvio
->
ÿche
ð
	`ÿÎoc
(1, 
PVIO_READ_AHEAD_CACHE_SIZE
)))

128 
	`PVIO_SET_ERROR
(
cšfo
->
mysql
, 
CR_OUT_OF_MEMORY
, 
unknown_sql¡©e
, 0);

129 
	`ä“
(
pvio
);

130  
NULL
;

132 
pvio
->
ÿche_size
= 0;

133 
pvio
->
ÿche_pos
ðpvio->
ÿche
;

135  
pvio
;

136 
	}
}

140 
my_boÞ
 
	$ma_pvio_is_®ive
(
MARIADB_PVIO
 *
pvio
)

142 ià(!
pvio
)

143  
FALSE
;

144 ià(
pvio
->
m‘hods
->
is_®ive
)

145  
pvio
->
m‘hods
->
	`is_®ive
(pvio);

146  
TRUE
;

147 
	}
}

151 
	$ma_pvio_ç¡_£nd
(
MARIADB_PVIO
 *
pvio
)

153 ià(!
pvio
 || !pvio->
m‘hods
->
ç¡_£nd
)

155  
pvio
->
m‘hods
->
	`ç¡_£nd
(pvio);

156 
	}
}

160 
	$ma_pvio_k“·live
(
MARIADB_PVIO
 *
pvio
)

162 ià(!
pvio
 || !pvio->
m‘hods
->
k“·live
)

164  
pvio
->
m‘hods
->
	`k“·live
(pvio);

165 
	}
}

169 
my_boÞ
 
	$ma_pvio_£t_timeout
(
MARIADB_PVIO
 *
pvio
,

170 
’um_pvio_timeout
 
ty³
,

171 
timeout
)

173 ià(!
pvio
)

176 ià(
pvio
->
m‘hods
->
£t_timeout
)

177  
pvio
->
m‘hods
->
	`£t_timeout
Õvio, 
ty³
, 
timeout
);

179 
	}
}

183 
size_t
 
	$ma_pvio_»ad_async
(
MARIADB_PVIO
 *
pvio
, 
uch¬
 *
bufãr
, 
size_t
 
Ëngth
)

185 
ssize_t
 
»s
= 0;

186 
mysql_async_cÚ‹xt
 *
b
ð
pvio
->
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
async_cÚ‹xt
;

187 
timeout
ð
pvio
->timeout[
PVIO_READ_TIMEOUT
];

189 ià(!
pvio
->
m‘hods
->
async_»ad
)

191 
	`PVIO_SET_ERROR
(
pvio
->
mysql
, 
CR_ASYNC_NOT_SUPPORTED
, 
unknown_sql¡©e
, 0);

197 ià(
pvio
->
m‘hods
->
async_»ad
)

198 
»s
ð
pvio
->
m‘hods
->
	`async_»ad
Õvio, 
bufãr
, 
Ëngth
);

199 ià(
»s
 >ð0 || 
	`IS_BLOCKING_ERROR
())

200  
»s
;

201 
b
->
ev’ts_to_wa™_fÜ
ð
MYSQL_WAIT_READ
;

202 ià(
timeout
 >= 0)

204 
b
->
ev’ts_to_wa™_fÜ
|ð
MYSQL_WAIT_TIMEOUT
;

205 
b
->
timeout_v®ue
ð
timeout
;

207 ià(
b
->
su¥’d_»sume_hook
)

208 (*
b
->
su¥’d_»sume_hook
)(
TRUE
, b->
su¥’d_»sume_hook_u£r_d©a
);

209 
	`my_cÚ‹xt_y›ld
(&
b
->
async_cÚ‹xt
);

210 ià(
b
->
su¥’d_»sume_hook
)

211 (*
b
->
su¥’d_»sume_hook
)(
FALSE
, b->
su¥’d_»sume_hook_u£r_d©a
);

212 ià(
b
->
ev’ts_occu»d
 & 
MYSQL_WAIT_TIMEOUT
)

215 
	}
}

219 
ssize_t
 
	$ma_pvio_»ad
(
MARIADB_PVIO
 *
pvio
, 
uch¬
 *
bufãr
, 
size_t
 
Ëngth
)

221 
ssize_t
 
r
= -1;

222 ià(!
pvio
)

224 ià(
	`IS_PVIO_ASYNC_ACTIVE
(
pvio
))

226 
r
=

227 #ià
	`defšed
(
HAVE_TLS
è&& !defšed(
HAVE_SCHANNEL
)

228 (
pvio
->
ùls
è? 
	`ma_Žs_»ad_async
Õvio, 
bufãr
, 
Ëngth
) :

230 (
ssize_t
)
	`ma_pvio_»ad_async
(
pvio
, 
bufãr
, 
Ëngth
);

231 
’d
;

235 ià(
	`IS_PVIO_ASYNC
(
pvio
))

241 
my_boÞ
 
Þd_mode
;

242 
	`ma_pvio_blockšg
(
pvio
, 
TRUE
, &
Þd_mode
);

247 #ifdeà
HAVE_TLS


248 ià(
pvio
->
ùls
)

250 
r
ð
	`ma_pvio_Žs_»ad
(
pvio
->
ùls
, 
bufãr
, 
Ëngth
);

251 
’d
;

254 ià(
pvio
->
m‘hods
->
»ad
)

255 
r
ð
pvio
->
m‘hods
->
	`»ad
Õvio, 
bufãr
, 
Ëngth
);

256 
’d
:

257 ià(
pvio_ÿÎback
)

259 (*
ÿÎback
)(
mode
, 
MYSQL
 *
mysql
, cÚ¡ 
uch¬
 *
bufãr
, 
size_t
 
Ëngth
);

260 
LIST
 *
p
ð
pvio_ÿÎback
;

261 
p
)

263 
ÿÎback
ð
p
->
d©a
;

264 
	`ÿÎback
(0, 
pvio
->
mysql
, 
bufãr
, 
r
);

265 
p
ðp->
Ãxt
;

268  
r
;

269 
	}
}

273 
ssize_t
 
	$ma_pvio_ÿche_»ad
(
MARIADB_PVIO
 *
pvio
, 
uch¬
 *
bufãr
, 
size_t
 
Ëngth
)

275 
ssize_t
 
r
;

277 ià(!
pvio
)

280 ià(!
pvio
->
ÿche
)

281  
	`ma_pvio_»ad
(
pvio
, 
bufãr
, 
Ëngth
);

283 ià(
pvio
->
ÿche
 +…vio->
ÿche_size
 >…vio->
ÿche_pos
)

285 
ssize_t
 
»maššg
 = 
pvio
->
ÿche
 +…vio->
ÿche_size
 -…vio->
ÿche_pos
;

286 
	`as£¹
(
»maššg
 > 0);

287 
r
ð
	`MIN
((
ssize_t
)
Ëngth
, 
»maššg
);

288 
	`memýy
(
bufãr
, 
pvio
->
ÿche_pos
, 
r
);

289 
pvio
->
ÿche_pos
+ð
r
;

291 ià(
Ëngth
 >ð
PVIO_READ_AHEAD_CACHE_MIN_SIZE
)

293 
r
ð
	`ma_pvio_»ad
(
pvio
, 
bufãr
, 
Ëngth
);

297 
r
ð
	`ma_pvio_»ad
(
pvio
,…vio->
ÿche
, 
PVIO_READ_AHEAD_CACHE_SIZE
);

298 ià(
r
 > 0)

300 ià(
Ëngth
 < (
size_t
)
r
)

302 
pvio
->
ÿche_size
ð
r
;

303 
pvio
->
ÿche_pos
ðpvio->
ÿche
 + 
Ëngth
;

304 
r
ð
Ëngth
;

306 
	`memýy
(
bufãr
, 
pvio
->
ÿche
, 
r
);

309  
r
;

310 
	}
}

314 
ssize_t
 
	$ma_pvio_wr™e_async
(
MARIADB_PVIO
 *
pvio
, cÚ¡ 
uch¬
 *
bufãr
, 
size_t
 
Ëngth
)

316 
ssize_t
 
»s
;

317 
mysql_async_cÚ‹xt
 *
b
ð
pvio
->
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
async_cÚ‹xt
;

318 
timeout
ð
pvio
->timeout[
PVIO_WRITE_TIMEOUT
];

322 
»s
ð
pvio
->
m‘hods
->
	`async_wr™e
Õvio, 
bufãr
, 
Ëngth
);

323 ià(
»s
 >ð0 || 
	`IS_BLOCKING_ERROR
())

324  
»s
;

325 
b
->
ev’ts_to_wa™_fÜ
ð
MYSQL_WAIT_WRITE
;

326 ià(
timeout
 >= 0)

328 
b
->
ev’ts_to_wa™_fÜ
|ð
MYSQL_WAIT_TIMEOUT
;

329 
b
->
timeout_v®ue
ð
timeout
;

331 ià(
b
->
su¥’d_»sume_hook
)

332 (*
b
->
su¥’d_»sume_hook
)(
TRUE
, b->
su¥’d_»sume_hook_u£r_d©a
);

333 
	`my_cÚ‹xt_y›ld
(&
b
->
async_cÚ‹xt
);

334 ià(
b
->
su¥’d_»sume_hook
)

335 (*
b
->
su¥’d_»sume_hook
)(
FALSE
, b->
su¥’d_»sume_hook_u£r_d©a
);

336 ià(
b
->
ev’ts_occu»d
 & 
MYSQL_WAIT_TIMEOUT
)

339 
	}
}

343 
ssize_t
 
	$ma_pvio_wr™e
(
MARIADB_PVIO
 *
pvio
, cÚ¡ 
uch¬
 *
bufãr
, 
size_t
 
Ëngth
)

345 
ssize_t
 
r
= 0;

347 ià(!
pvio
)

350 ià(
	`IS_PVIO_ASYNC_ACTIVE
(
pvio
))

352 
r
=

353 #ià
	`defšed
(
HAVE_TLS
è&& !defšed(
HAVE_SCHANNEL
)

354 (
pvio
->
ùls
è? 
	`ma_Žs_wr™e_async
Õvio, 
bufãr
, 
Ëngth
) :

356 
	`ma_pvio_wr™e_async
(
pvio
, 
bufãr
, 
Ëngth
);

357 
’d
;

361 ià(
	`IS_PVIO_ASYNC
(
pvio
))

367 
my_boÞ
 
Þd_mode
;

368 
	`ma_pvio_blockšg
(
pvio
, 
TRUE
, &
Þd_mode
);

372 #ifdeà
HAVE_TLS


373 ià(
pvio
->
ùls
)

375 
r
ð
	`ma_pvio_Žs_wr™e
(
pvio
->
ùls
, 
bufãr
, 
Ëngth
);

376 
’d
;

380 ià(
pvio
->
m‘hods
->
wr™e
)

381 
r
ð
pvio
->
m‘hods
->
	`wr™e
Õvio, 
bufãr
, 
Ëngth
);

382 
’d
:

383 ià(
pvio_ÿÎback
)

385 (*
ÿÎback
)(
mode
, 
MYSQL
 *
mysql
, cÚ¡ 
uch¬
 *
bufãr
, 
size_t
 
Ëngth
);

386 
LIST
 *
p
ð
pvio_ÿÎback
;

387 
p
)

389 
ÿÎback
ð
p
->
d©a
;

390 
	`ÿÎback
(1, 
pvio
->
mysql
, 
bufãr
, 
r
);

391 
p
ðp->
Ãxt
;

394  
r
;

395 
	}
}

399 
	$ma_pvio_þo£
(
MARIADB_PVIO
 *
pvio
)

402 ià(
pvio
)

404 #ifdeà
HAVE_TLS


405 ià(
pvio
->
ùls
)

407 
	`ma_pvio_Žs_þo£
(
pvio
->
ùls
);

408 
	`ä“
(
pvio
->
ùls
);

411 ià(
pvio
 &&…vio->
m‘hods
->
þo£
)

412 
pvio
->
m‘hods
->
	`þo£
(pvio);

414 ià(
pvio
->
ÿche
)

415 
	`ä“
(
pvio
->
ÿche
);

417 
	`ä“
(
pvio
);

419 
	}
}

423 
my_boÞ
 
	$ma_pvio_g‘_hªdË
(
MARIADB_PVIO
 *
pvio
, *
hªdË
)

425 ià(
pvio
 &&…vio->
m‘hods
->
g‘_hªdË
)

426  
pvio
->
m‘hods
->
	`g‘_hªdË
Õvio, 
hªdË
);

428 
	}
}

432 
my_boÞ


433 
	$ma_pvio_wa™_async
(
mysql_async_cÚ‹xt
 *
b
, 
’um_pvio_io_ev’t
 
ev’t
,

434 
timeout
)

436 
ev’t
)

438 
VIO_IO_EVENT_READ
:

439 
b
->
ev’ts_to_wa™_fÜ
 = 
MYSQL_WAIT_READ
;

441 
VIO_IO_EVENT_WRITE
:

442 
b
->
ev’ts_to_wa™_fÜ
 = 
MYSQL_WAIT_WRITE
;

444 
VIO_IO_EVENT_CONNECT
:

445 
b
->
ev’ts_to_wa™_fÜ
 = 
MYSQL_WAIT_WRITE
 | 
	`IF_WIN
(0, 
MYSQL_WAIT_EXCEPT
);

449 ià(
timeout
 >= 0)

451 
b
->
ev’ts_to_wa™_fÜ
 |ð
MYSQL_WAIT_TIMEOUT
;

452 
b
->
timeout_v®ue
ð
timeout
;

454 ià(
b
->
su¥’d_»sume_hook
)

455 (*
b
->
su¥’d_»sume_hook
)(
TRUE
, b->
su¥’d_»sume_hook_u£r_d©a
);

456 
	`my_cÚ‹xt_y›ld
(&
b
->
async_cÚ‹xt
);

457 ià(
b
->
su¥’d_»sume_hook
)

458 (*
b
->
su¥’d_»sume_hook
)(
FALSE
, b->
su¥’d_»sume_hook_u£r_d©a
);

459  (
b
->
ev’ts_occu»d
 & 
MYSQL_WAIT_TIMEOUT
) ? 0 : 1;

460 
	}
}

464 
	$ma_pvio_wa™_io_Ü_timeout
(
MARIADB_PVIO
 *
pvio
, 
my_boÞ
 
is_»ad
, 
timeout
)

466 ià(
pvio
)

468 ià(
	`IS_PVIO_ASYNC_ACTIVE
(
pvio
))

469  
	`ma_pvio_wa™_async
(
pvio
->
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
async_cÚ‹xt
,

470 (
is_»ad
è? 
VIO_IO_EVENT_READ
 : 
VIO_IO_EVENT_WRITE
,

471 
timeout
);

473 ià(
pvio
 &&…vio->
m‘hods
->
wa™_io_Ü_timeout
)

474  
pvio
->
m‘hods
->
	`wa™_io_Ü_timeout
Õvio, 
is_»ad
, 
timeout
);

477 
	}
}

481 
my_boÞ
 
	$ma_pvio_cÚÃù
(
MARIADB_PVIO
 *
pvio
, 
MA_PVIO_CINFO
 *
cšfo
)

483 ià(
pvio
 &&…vio->
m‘hods
->
cÚÃù
)

484  
pvio
->
m‘hods
->
	`cÚÃù
Õvio, 
cšfo
);

486 
	}
}

490 
my_boÞ
 
	$ma_pvio_blockšg
(
MARIADB_PVIO
 *
pvio
, 
my_boÞ
 
block
, my_boÞ *
´evious_mode
)

492 ià(
pvio
 &&…vio->
m‘hods
->
blockšg
)

493  
pvio
->
m‘hods
->
	`blockšg
Õvio, 
block
, 
´evious_mode
) != 0;

495 
	}
}

499 
my_boÞ
 
	$ma_pvio_is_blockšg
(
MARIADB_PVIO
 *
pvio
)

501 ià(
pvio
 &&…vio->
m‘hods
->
is_blockšg
)

502  
pvio
->
m‘hods
->
	`is_blockšg
(pvio);

504 
	}
}

508 
my_boÞ
 
	$ma_pvio_has_d©a
(
MARIADB_PVIO
 *
pvio
, 
ssize_t
 *
d©a_Ën
)

511 ià(
pvio
 &&…vio->
ÿche
)

512 ià(
pvio
->
ÿche_pos
 >…vio->
ÿche
)

513  
	`‹¡
(
pvio
->
ÿche_pos
 -…vio->
ÿche
);

514 ià(
pvio
 &&…vio->
m‘hods
->
has_d©a
)

515  
pvio
->
m‘hods
->
	`has_d©a
Õvio, 
d©a_Ën
);

517 
	}
}

520 #ifdeà
HAVE_TLS


522 
my_boÞ
 
	$ma_pvio_¡¬t_s¦
(
MARIADB_PVIO
 *
pvio
)

524 ià(!
pvio
 || !pvio->
mysql
)

526 
	`CLEAR_CLIENT_ERROR
(
pvio
->
mysql
);

527 ià(!(
pvio
->
ùls
ð
	`ma_pvio_Žs_š™
Õvio->
mysql
)))

531 ià(
	`ma_pvio_Žs_cÚÃù
(
pvio
->
ùls
))

533 
	`ä“
(
pvio
->
ùls
);

534 
pvio
->
ùls
ð
NULL
;

543 ià((
pvio
->
mysql
->
þ›Á_æag
 & 
CLIENT_SSL_VERIFY_SERVER_CERT
) &&

544 
	`ma_pvio_Žs_v”ify_£rv”_û¹
(
pvio
->
ùls
))

547 ià(
pvio
->
mysql
->
ÝtiÚs
.
ex‹nsiÚ
 &&

548 ((
pvio
->
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
Žs_å
 &&…vio->mysql->options.extension->tls_fp[0]) ||

549 (
pvio
->
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
Žs_å_li¡
 &&…vio->mysql->options.extension->tls_fp_list[0])))

551 ià(
	`ma_pvio_Žs_check_å
(
pvio
->
ùls
,

552 
pvio
->
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
Žs_å
,

553 
pvio
->
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
Žs_å_li¡
))

558 
	}
}

563 
ma_pvio_»gi¡”_ÿÎback
(
my_boÞ
 
»gi¡”_ÿÎback
,

564 (*
ÿÎback_funùiÚ
)(
mode
, 
MYSQL
 *
mysql
, cÚ¡ 
uch¬
 *
bufãr
, 
size_t
 
Ëngth
))

566 
LIST
 *
li¡
;

568 ià(!
ÿÎback_funùiÚ
)

572 ià(
»gi¡”_ÿÎback
)

574 
li¡
ð(
LIST
 *)
	`m®loc
((LIST));

576 
li¡
->
d©a
ð(*)
ÿÎback_funùiÚ
;

577 
pvio_ÿÎback
ð
	`li¡_add
Õvio_ÿÎback, 
li¡
);

581 
LIST
 *
p
ð
pvio_ÿÎback
;

582 
p
)

584 ià(
p
->
d©a
 =ð
ÿÎback_funùiÚ
)

586 
	`li¡_d–‘e
(
pvio_ÿÎback
, 
p
);

589 
p
ðp->
Ãxt
;

593 
	}
}

	@libmariadb/ma_sha1.c

25 
	~"ma_glob®.h
"

26 
	~"¡ršg.h
"

30 
	~"ma_sha1.h
"

33 
ma_SHA1T¿nsfÜm
(
ušt32
[5], const [64]);

34 
ma_SHA1Encode
(*, 
ušt32
 *, );

35 
ma_SHA1Decode
(
ušt32
 *, const *, );

37 
	gPADDING
[64] =

46 
	#F
(
x
, 
y
, 
z
è((zè^ ((xè& ((yè^ (z))))

	)

47 
	#G
(
x
, 
y
, 
z
è((xè^ (yè^ (z))

	)

48 
	#H
(
x
, 
y
, 
z
è(((xè& (y)è| ((zè& ((xè| (y))))

	)

49 
	#I
(
x
, 
y
, 
z
è((xè^ (yè^ (z))

	)

53 
	#ROTATE_LEFT
(
x
, 
n
è(((xè<< (n)è| ((xè>> (32-Ò))))

	)

57 
	#W
(
i
èÐ
tmp
=
x
[(i-3)&15]^x[(i-8)&15]^x[(i-14)&15]^x[i&15], \

58 (
x
[
i
&15]=
	`ROTATE_LEFT
(
tmp
, 1)è)

	)

62 
	#FF
(
a
, 
b
, 
c
, 
d
, 
e
, 
w
) { \

63 (
e
è+ð
	`F
 ((
b
), (
c
), (
d
)è+ (
w
è+ (
ušt32
)(0x5A827999); \

64 (
e
è+ð
	`ROTATE_LEFT
 ((
a
), 5); \

65 (
b
èð
	`ROTATE_LEFT
((b), 30); \

66 }

	)

67 
	#GG
(
a
, 
b
, 
c
, 
d
, 
e
, 
w
) { \

68 (
e
è+ð
	`G
 ((
b
), (
c
), (
d
)è+ (
w
è+ (
ušt32
)(0x6ED9EBA1); \

69 (
e
è+ð
	`ROTATE_LEFT
 ((
a
), 5); \

70 (
b
èð
	`ROTATE_LEFT
((b), 30); \

71 }

	)

72 
	#HH
(
a
, 
b
, 
c
, 
d
, 
e
, 
w
) { \

73 (
e
è+ð
	`H
 ((
b
), (
c
), (
d
)è+ (
w
è+ (
ušt32
)(0x8F1BBCDC); \

74 (
e
è+ð
	`ROTATE_LEFT
 ((
a
), 5); \

75 (
b
èð
	`ROTATE_LEFT
((b), 30); \

76 }

	)

77 
	#II
(
a
, 
b
, 
c
, 
d
, 
e
, 
w
) { \

78 (
e
è+ð
	`I
 ((
b
), (
c
), (
d
)è+ (
w
è+ (
ušt32
)(0xCA62C1D6); \

79 (
e
è+ð
	`ROTATE_LEFT
 ((
a
), 5); \

80 (
b
èð
	`ROTATE_LEFT
((b), 30); \

81 }

	)

87 
	$ma_SHA1In™
(
_MA_SHA1_CTX
 * 
cÚ‹xt
)

89 
cÚ‹xt
->
couÁ
[0] = context->count[1] = 0;

92 
cÚ‹xt
->
¡©e
[0] = 0x67452301;

93 
cÚ‹xt
->
¡©e
[1] = 0xefcdab89;

94 
cÚ‹xt
->
¡©e
[2] = 0x98badcfe;

95 
cÚ‹xt
->
¡©e
[3] = 0x10325476;

96 
cÚ‹xt
->
¡©e
[4] = 0xc3d2e1f0;

97 
	}
}

105 
	$ma_SHA1Upd©e
(
_MA_SHA1_CTX
 * 
cÚ‹xt
, cÚ¡ *
šput
,

106 
size_t
 
šputL’
)

108 
i
, 
šdex
, 
·¹L’
;

111 
šdex
 = (è((
cÚ‹xt
->
couÁ
[0] >> 3) & 0x3F);

114 ià((
cÚ‹xt
->
couÁ
[0] +ð((
ušt32
è
šputL’
 << 3))

115 < ((
ušt32
è
šputL’
 << 3))

116 
cÚ‹xt
->
couÁ
[1]++;

117 
cÚ‹xt
->
couÁ
[1] +ð((
ušt32
è
šputL’
 >> 29);

119 
·¹L’
 = 64 - 
šdex
;

123 ià(
šputL’
 >ð
·¹L’
) {

124 
memýy


125 ((*è& 
cÚ‹xt
->
bufãr
[
šdex
], (*è
šput
, 
·¹L’
);

126 
	`ma_SHA1T¿nsfÜm
(
cÚ‹xt
->
¡©e
, cÚ‹xt->
bufãr
);

128 
i
 = 
·¹L’
; i + 63 < 
šputL’
; i += 64)

129 
	`ma_SHA1T¿nsfÜm
(
cÚ‹xt
->
¡©e
, &
šput
[
i
]);

131 
šdex
 = 0;

133 
i
 = 0;

136 
memýy


137 ((*è& 
cÚ‹xt
->
bufãr
[
šdex
], (*è& 
šput
[
i
],

138 
šputL’
 - 
i
);

139 
	}
}

146 
	$ma_SHA1Fš®
(
dige¡
[20], 
_MA_SHA1_CTX
 * 
cÚ‹xt
)

148 
b™s
[8];

149 
šdex
, 
·dL’
;

152 
b™s
[7] = 
cÚ‹xt
->
couÁ
[0] & 0xFF;

153 
b™s
[6] = (
cÚ‹xt
->
couÁ
[0] >> 8) & 0xFF;

154 
b™s
[5] = (
cÚ‹xt
->
couÁ
[0] >> 16) & 0xFF;

155 
b™s
[4] = (
cÚ‹xt
->
couÁ
[0] >> 24) & 0xFF;

156 
b™s
[3] = 
cÚ‹xt
->
couÁ
[1] & 0xFF;

157 
b™s
[2] = (
cÚ‹xt
->
couÁ
[1] >> 8) & 0xFF;

158 
b™s
[1] = (
cÚ‹xt
->
couÁ
[1] >> 16) & 0xFF;

159 
b™s
[0] = (
cÚ‹xt
->
couÁ
[1] >> 24) & 0xFF;

163 
šdex
 = (è((
cÚ‹xt
->
couÁ
[0] >> 3) & 0x3f);

164 
·dL’
 = (
šdex
 < 56) ? (56 - index) : (120 - index);

165 
	`ma_SHA1Upd©e
(
cÚ‹xt
, 
PADDING
, 
·dL’
);

168 
	`ma_SHA1Upd©e
(
cÚ‹xt
, 
b™s
, 8);

171 
	`ma_SHA1Encode
(
dige¡
, 
cÚ‹xt
->
¡©e
, 20);

175 
	`mem£t
((*è
cÚ‹xt
, 0, (*context));

176 
	}
}

182 
	$ma_SHA1T¿nsfÜm
(
ušt32
 
¡©e
[5], cÚ¡ 
block
[64])

184 
ušt32
 
a
 = 
¡©e
[0], 
b
 = s‹[1], 
c
 = state[2];

185 
ušt32
 
d
 = 
¡©e
[3], 
e
 = s‹[4], 
x
[16], 
tmp
;

187 
	`ma_SHA1Decode
(
x
, 
block
, 64);

190 
	`FF
(
a
, 
b
, 
c
, 
d
, 
e
, 
x
[0]);

191 
	`FF
(
e
, 
a
, 
b
, 
c
, 
d
, 
x
[1]);

192 
	`FF
(
d
, 
e
, 
a
, 
b
, 
c
, 
x
[2]);

193 
	`FF
(
c
, 
d
, 
e
, 
a
, 
b
, 
x
[3]);

194 
	`FF
(
b
, 
c
, 
d
, 
e
, 
a
, 
x
[4]);

195 
	`FF
(
a
, 
b
, 
c
, 
d
, 
e
, 
x
[5]);

196 
	`FF
(
e
, 
a
, 
b
, 
c
, 
d
, 
x
[6]);

197 
	`FF
(
d
, 
e
, 
a
, 
b
, 
c
, 
x
[7]);

198 
	`FF
(
c
, 
d
, 
e
, 
a
, 
b
, 
x
[8]);

199 
	`FF
(
b
, 
c
, 
d
, 
e
, 
a
, 
x
[9]);

200 
	`FF
(
a
, 
b
, 
c
, 
d
, 
e
, 
x
[10]);

201 
	`FF
(
e
, 
a
, 
b
, 
c
, 
d
, 
x
[11]);

202 
	`FF
(
d
, 
e
, 
a
, 
b
, 
c
, 
x
[12]);

203 
	`FF
(
c
, 
d
, 
e
, 
a
, 
b
, 
x
[13]);

204 
	`FF
(
b
, 
c
, 
d
, 
e
, 
a
, 
x
[14]);

205 
	`FF
(
a
, 
b
, 
c
, 
d
, 
e
, 
x
[15]);

206 
	`FF
(
e
, 
a
, 
b
, 
c
, 
d
, 
	`W
(16));

207 
	`FF
(
d
, 
e
, 
a
, 
b
, 
c
, 
	`W
(17));

208 
	`FF
(
c
, 
d
, 
e
, 
a
, 
b
, 
	`W
(18));

209 
	`FF
(
b
, 
c
, 
d
, 
e
, 
a
, 
	`W
(19));

212 
	`GG
(
a
, 
b
, 
c
, 
d
, 
e
, 
	`W
(20));

213 
	`GG
(
e
, 
a
, 
b
, 
c
, 
d
, 
	`W
(21));

214 
	`GG
(
d
, 
e
, 
a
, 
b
, 
c
, 
	`W
(22));

215 
	`GG
(
c
, 
d
, 
e
, 
a
, 
b
, 
	`W
(23));

216 
	`GG
(
b
, 
c
, 
d
, 
e
, 
a
, 
	`W
(24));

217 
	`GG
(
a
, 
b
, 
c
, 
d
, 
e
, 
	`W
(25));

218 
	`GG
(
e
, 
a
, 
b
, 
c
, 
d
, 
	`W
(26));

219 
	`GG
(
d
, 
e
, 
a
, 
b
, 
c
, 
	`W
(27));

220 
	`GG
(
c
, 
d
, 
e
, 
a
, 
b
, 
	`W
(28));

221 
	`GG
(
b
, 
c
, 
d
, 
e
, 
a
, 
	`W
(29));

222 
	`GG
(
a
, 
b
, 
c
, 
d
, 
e
, 
	`W
(30));

223 
	`GG
(
e
, 
a
, 
b
, 
c
, 
d
, 
	`W
(31));

224 
	`GG
(
d
, 
e
, 
a
, 
b
, 
c
, 
	`W
(32));

225 
	`GG
(
c
, 
d
, 
e
, 
a
, 
b
, 
	`W
(33));

226 
	`GG
(
b
, 
c
, 
d
, 
e
, 
a
, 
	`W
(34));

227 
	`GG
(
a
, 
b
, 
c
, 
d
, 
e
, 
	`W
(35));

228 
	`GG
(
e
, 
a
, 
b
, 
c
, 
d
, 
	`W
(36));

229 
	`GG
(
d
, 
e
, 
a
, 
b
, 
c
, 
	`W
(37));

230 
	`GG
(
c
, 
d
, 
e
, 
a
, 
b
, 
	`W
(38));

231 
	`GG
(
b
, 
c
, 
d
, 
e
, 
a
, 
	`W
(39));

234 
	`HH
(
a
, 
b
, 
c
, 
d
, 
e
, 
	`W
(40));

235 
	`HH
(
e
, 
a
, 
b
, 
c
, 
d
, 
	`W
(41));

236 
	`HH
(
d
, 
e
, 
a
, 
b
, 
c
, 
	`W
(42));

237 
	`HH
(
c
, 
d
, 
e
, 
a
, 
b
, 
	`W
(43));

238 
	`HH
(
b
, 
c
, 
d
, 
e
, 
a
, 
	`W
(44));

239 
	`HH
(
a
, 
b
, 
c
, 
d
, 
e
, 
	`W
(45));

240 
	`HH
(
e
, 
a
, 
b
, 
c
, 
d
, 
	`W
(46));

241 
	`HH
(
d
, 
e
, 
a
, 
b
, 
c
, 
	`W
(47));

242 
	`HH
(
c
, 
d
, 
e
, 
a
, 
b
, 
	`W
(48));

243 
	`HH
(
b
, 
c
, 
d
, 
e
, 
a
, 
	`W
(49));

244 
	`HH
(
a
, 
b
, 
c
, 
d
, 
e
, 
	`W
(50));

245 
	`HH
(
e
, 
a
, 
b
, 
c
, 
d
, 
	`W
(51));

246 
	`HH
(
d
, 
e
, 
a
, 
b
, 
c
, 
	`W
(52));

247 
	`HH
(
c
, 
d
, 
e
, 
a
, 
b
, 
	`W
(53));

248 
	`HH
(
b
, 
c
, 
d
, 
e
, 
a
, 
	`W
(54));

249 
	`HH
(
a
, 
b
, 
c
, 
d
, 
e
, 
	`W
(55));

250 
	`HH
(
e
, 
a
, 
b
, 
c
, 
d
, 
	`W
(56));

251 
	`HH
(
d
, 
e
, 
a
, 
b
, 
c
, 
	`W
(57));

252 
	`HH
(
c
, 
d
, 
e
, 
a
, 
b
, 
	`W
(58));

253 
	`HH
(
b
, 
c
, 
d
, 
e
, 
a
, 
	`W
(59));

256 
	`II
(
a
, 
b
, 
c
, 
d
, 
e
, 
	`W
(60));

257 
	`II
(
e
, 
a
, 
b
, 
c
, 
d
, 
	`W
(61));

258 
	`II
(
d
, 
e
, 
a
, 
b
, 
c
, 
	`W
(62));

259 
	`II
(
c
, 
d
, 
e
, 
a
, 
b
, 
	`W
(63));

260 
	`II
(
b
, 
c
, 
d
, 
e
, 
a
, 
	`W
(64));

261 
	`II
(
a
, 
b
, 
c
, 
d
, 
e
, 
	`W
(65));

262 
	`II
(
e
, 
a
, 
b
, 
c
, 
d
, 
	`W
(66));

263 
	`II
(
d
, 
e
, 
a
, 
b
, 
c
, 
	`W
(67));

264 
	`II
(
c
, 
d
, 
e
, 
a
, 
b
, 
	`W
(68));

265 
	`II
(
b
, 
c
, 
d
, 
e
, 
a
, 
	`W
(69));

266 
	`II
(
a
, 
b
, 
c
, 
d
, 
e
, 
	`W
(70));

267 
	`II
(
e
, 
a
, 
b
, 
c
, 
d
, 
	`W
(71));

268 
	`II
(
d
, 
e
, 
a
, 
b
, 
c
, 
	`W
(72));

269 
	`II
(
c
, 
d
, 
e
, 
a
, 
b
, 
	`W
(73));

270 
	`II
(
b
, 
c
, 
d
, 
e
, 
a
, 
	`W
(74));

271 
	`II
(
a
, 
b
, 
c
, 
d
, 
e
, 
	`W
(75));

272 
	`II
(
e
, 
a
, 
b
, 
c
, 
d
, 
	`W
(76));

273 
	`II
(
d
, 
e
, 
a
, 
b
, 
c
, 
	`W
(77));

274 
	`II
(
c
, 
d
, 
e
, 
a
, 
b
, 
	`W
(78));

275 
	`II
(
b
, 
c
, 
d
, 
e
, 
a
, 
	`W
(79));

277 
¡©e
[0] +ð
a
;

278 
¡©e
[1] +ð
b
;

279 
¡©e
[2] +ð
c
;

280 
¡©e
[3] +ð
d
;

281 
¡©e
[4] +ð
e
;

284 
	`mem£t
((*è
x
, 0, (x));

285 
	}
}

292 
	$ma_SHA1Encode
(*
ouut
, 
ušt32
 *
šput
, 
Ën
)

294 
i
, 
j
;

296 
i
 = 0, 
j
 = 0; j < 
Ën
; i++, j += 4) {

297 
ouut
[
j
] = (è((
šput
[
i
] >> 24) & 0xff);

298 
ouut
[
j
 + 1] = (è((
šput
[
i
] >> 16) & 0xff);

299 
ouut
[
j
 + 2] = (è((
šput
[
i
] >> 8) & 0xff);

300 
ouut
[
j
 + 3] = (è(
šput
[
i
] & 0xff);

302 
	}
}

309 
	$ma_SHA1Decode
(
ušt32
 *
ouut
, cÚ¡ * 
šput
, 
Ën
)

311 
i
, 
j
;

313 
i
 = 0, 
j
 = 0; j < 
Ën
; i++, j += 4)

314 
ouut
[
i
] = ((
ušt32
è
šput
[
j
 + 3]) | (((uint32) input[j + 2]) << 8) |

315 (((
ušt32
è
šput
[
j
 + 1]) << 16) | (((uint32) input[j]) << 24);

316 
	}
}

	@libmariadb/ma_stmt_codec.c

46 
	~"ma_glob®.h
"

47 
	~<ma_sys.h
>

48 
	~<ma_¡ršg.h
>

49 
	~<m¬Ÿdb_ùy³.h
>

50 
	~"mysql.h
"

51 
	~<m©h.h
>

52 
	~<lim™s.h
>

54 #ifdeà
WIN32


55 
	~<m®loc.h
>

58 
	#MYSQL_SILENT


	)

61 
	#UINT_MAX32
 0xFFFFFFFFL

	)

62 
	#UINT_MAX24
 0x00FFFFFF

	)

63 
	#UINT_MAX16
 0xFFFF

	)

64 #iâdeà
INT_MIN8


65 
	#INT_MIN8
 (~0x7F)

	)

66 
	#INT_MAX8
 0x7F

	)

68 
	#UINT_MAX8
 0xFF

	)

70 
	#MAX_DOUBLE_STRING_REP_LENGTH
 300

	)

71 #ià
defšed
(
HAVE_LONG_LONG
è&& !defšed(
LONGLONG_MIN
)

72 
	#LONGLONG_MIN
 ((è0x8000000000000000LL)

	)

73 
	#LONGLONG_MAX
 ((è0x7FFFFFFFFFFFFFFFLL)

	)

76 
	#MAX_DBL_STR
 (3 + 
DBL_MANT_DIG
 - 
DBL_MIN_EXP
)

	)

78 #ià
defšed
(
HAVE_LONG_LONG
è&& !defšed(
ULONGLONG_MAX
)

80 #ifdeà
ULLONG_MAX


81 
	#ULONGLONG_MAX
 
ULLONG_MAX


	)

83 
	#ULONGLONG_MAX
 (()(~0ULL))

	)

87 
	#YY_PART_YEAR
 70

	)

89 
MYSQL_PS_CONVERSION
 
	gmysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_GEOMETRY
 + 1];

90 
my_boÞ
 
	gmysql_ps_subsy¡em_š™Ÿlized
= 0;

93 
	#NUMERIC_TRUNCATION
(
v®
,
mš_¿nge
, 
max_¿nge
)\

94 ((((
v®
è> (
max_¿nge
)è|| ((v®è< (
mš_¿nge
)è? 1 : 0))

	)

97 
	$ma_bmove_uµ
(*
d¡
, cÚ¡ *
¤c
, 
size_t
 
Ën
)

99 
Ën
-- !ð0è*--
d¡
 = *--
¤c
;

100 
	}
}

103 
	$ps_ãtch_äom_1_to_8_by‹s
(
MYSQL_BIND
 *
r_·¿m
, cÚ¡ 
MYSQL_FIELD
 * cÚ¡ 
f›ld
,

104 **
row
, 
by‹_couÁ
)

106 
my_boÞ
 
is_unsigÃd
ð
	`‹¡
(
f›ld
->
æags
 & 
UNSIGNED_FLAG
);

107 
r_·¿m
->
bufãr_Ëngth
ð
by‹_couÁ
;

108 
by‹_couÁ
) {

110 *(
uch¬
 *)
r_·¿m
->
bufãr
ð**
row
;

111 *
r_·¿m
->
”rÜ
ð
is_unsigÃd
 !ðr_·¿m->is_unsigÃd && *(
uch¬
 *ì_·¿m->
bufãr
 > 
INT_MAX8
;

114 
	`shÜt¡Üe
(
r_·¿m
->
bufãr
, ((
ushÜt
è
	`sšt2kÜr
(*
row
)));

115 *
r_·¿m
->
”rÜ
ð
is_unsigÃd
 !ðr_·¿m->is_unsigÃd && *(
ushÜt
 *ì_·¿m->
bufãr
 > 
INT_MAX16
;

119 
	`lÚg¡Üe
(
r_·¿m
->
bufãr
, ((
ušt32
)
	`sšt4kÜr
(*
row
)));

120 *
r_·¿m
->
”rÜ
ð
is_unsigÃd
 !ðr_·¿m->is_unsigÃd && *(
ušt32
 *ì_·¿m->
bufãr
 > 
INT_MAX32
;

125 
ulÚglÚg
 
v®
ð(ulÚglÚg)
	`sšt8kÜr
(*
row
);

126 
	`lÚglÚg¡Üe
(
r_·¿m
->
bufãr
, 
v®
);

127 *
r_·¿m
->
”rÜ
ð
is_unsigÃd
 !ðr_·¿m->is_unsigÃd && 
v®
 > 
LONGLONG_MAX
 ;

131 
r_·¿m
->
bufãr_Ëngth
= 0;

134 (*
row
)+ð
by‹_couÁ
;

135 
	}
}

138 
	$my_¡¹ouÎ
(cÚ¡ *
¡r
, 
size_t
 
Ën
, cÚ¡ **
’d
, *
”r
)

140 
v®
 = 0;

141 cÚ¡ *
p
 = 
¡r
;

142 cÚ¡ *
’d_¡r
 = 
p
 + 
Ën
;

144 ; 
p
 < 
’d_¡r
;…++)

146 ià(*
p
 < '0' || *p > '9')

149 ià(
v®
 > 
ULONGLONG_MAX
 /10 || v®*10 > ULONGLONG_MAX - (*
p
 - '0'))

151 *
”r
 = 
ERANGE
;

154 
v®
 = v® * 10 + *
p
 -'0';

157 ià(
p
 =ð
¡r
)

159 *
”r
 = 
ERANGE
;

161 *
’d
 = 
p
;

162  
v®
;

163 
	}
}

165 
	$my_¡¹Þl
(cÚ¡ *
¡r
, 
size_t
 
Ën
, cÚ¡ **
’d
, *
”r
)

167 
uv®
 = 0;

168 cÚ¡ *
p
 = 
¡r
;

169 cÚ¡ *
’d_¡r
 = 
p
 + 
Ën
;

170 
Ãg
;

172 
p
 < 
’d_¡r
 && 
	`is¥aû
(*p))

173 
p
++;

175 ià(
p
 =ð
’d_¡r
)

177 *
’d
 = 
p
;

178 *
”r
 = 
ERANGE
;

182 
Ãg
 = *
p
 == '-';

183 ià(
Ãg
)

184 
p
++;

186 
uv®
 = 
	`my_¡¹ouÎ
(
p
, (
’d_¡r
 -…), &p, 
”r
);

187 *
’d
 = 
p
;

188 ià(*
”r
)

189  
uv®
;

191 ià(!
Ãg
)

194 ià(
uv®
 > 
LONGLONG_MAX
)

196 *
’d
 = 
p
 - 1;

197 
uv®
 = 
LONGLONG_MAX
;

198 *
”r
 = 
ERANGE
;

200  
uv®
;

203 ià(
uv®
 =ð(è
LONGLONG_MIN
)

204  
LONGLONG_MIN
;

206 ià(
uv®
 > 
LONGLONG_MAX
)

208 *
’d
 = 
p
 - 1;

209 
uv®
 = 
LONGLONG_MIN
;

210 *
”r
 = 
ERANGE
;

213  -1LL * 
uv®
;

214 
	}
}

217 
	$my_©Þl
(cÚ¡ *
¡r
, cÚ¡ *
’d_¡r
, *
”rÜ
)

219 cÚ¡ *
p
=
¡r
;

220 cÚ¡ *
’d
;

221 
»t
;

222 
p
 < 
’d_¡r
 && 
	`is¥aû
(*p))

223 
p
++;

225 
»t
 = 
	`my_¡¹Þl
(
p
, 
’d_¡r
 -…, &
’d
, 
”rÜ
);

227 
’d
 < 
’d_¡r
 && 
	`is¥aû
(*end))

228 
’d
++;

230 if(
’d
 !ð
’d_¡r
)

231 *
”rÜ
= 1;

233  
»t
;

234 
	}
}

237 
	$my_©ouÎ
(cÚ¡ *
¡r
, cÚ¡ *
’d_¡r
, *
”rÜ
)

239 cÚ¡ *
p
 = 
¡r
;

240 cÚ¡ *
’d
;

241 
»t
;

243 
p
 < 
’d_¡r
 && 
	`is¥aû
(*p))

244 
p
++;

246 
»t
 = 
	`my_¡¹ouÎ
(
p
, 
’d_¡r
 -…, &
’d
, 
”rÜ
);

248 
’d
 < 
’d_¡r
 && 
	`is¥aû
(*end))

249 
’d
++;

251 if(
’d
 !ð
’d_¡r
)

252 *
”rÜ
= 1;

254  
»t
;

255 
	}
}

257 
	$my_©od
(cÚ¡ *
numb”
, cÚ¡ *
’d
, *
”rÜ
)

259 
v®
= 0.0;

260 
bufãr
[
MAX_DBL_STR
 + 1];

261 
Ën
ð()(
’d
 - 
numb”
);

263 *
”rÜ
ð
”ºo
= 0;

265 ià(
Ën
 > 
MAX_DBL_STR
)

267 *
”rÜ
= 1;

268 
Ën
ð
MAX_DBL_STR
;

271 
	`memýy
(
bufãr
, 
numb”
, 
Ën
);

272 
bufãr
[
Ën
]= '\0';

274 
v®
ð
	`¡¹od
(
bufãr
, 
NULL
);

276 ià(
”ºo
)

277 *
”rÜ
ð
”ºo
;

279  
v®
;

280 
	}
}

286 
	$my_¡¹oui
(cÚ¡ *
¡r
, 
size_t
 
Ën
, cÚ¡ **
’d
, *
”r
)

288 
uÎ
 = 
	`my_¡¹ouÎ
(
¡r
, 
Ën
, 
’d
, 
”r
);

289 ià(
uÎ
 > 
UINT_MAX
)

290 *
”r
 = 
ERANGE
;

291  ()
uÎ
;

292 
	}
}

304 cÚ¡ 
	gäac_mul
[] = { 1000000,100000,10000,1000,100,10 };

306 
	$·r£_time
(cÚ¡ *
¡r
, 
size_t
 
Ëngth
, cÚ¡ **
’d_±r
, 
MYSQL_TIME
 *
tm
)

308 
”r
= 0;

309 cÚ¡ *
p
 = 
¡r
;

310 cÚ¡ *
’d
 = 
¡r
 + 
Ëngth
;

311 
size_t
 
äac_Ën
;

312 
»t
=1;

314 
tm
->
hour
 = 
	`my_¡¹oui
(
p
, 
’d
-p, &p, &
”r
);

315 ià(
”r
 || 
tm
->
hour
 > 838 || 
p
 =ð
’d
 || *p != ':' )

316 
’d
;

318 
p
++;

319 
tm
->
mšu‹
 = 
	`my_¡¹oui
(
p
, 
’d
-p, &p, &
”r
);

320 ià(
”r
 || 
tm
->
mšu‹
 > 59 || 
p
 =ð
’d
 || *p != ':')

321 
’d
;

323 
p
++;

324 
tm
->
£cÚd
 = 
	`my_¡¹oui
(
p
, 
’d
-p, &p, &
”r
);

325 ià(
”r
 || 
tm
->
£cÚd
 > 59)

326 
’d
;

328 
»t
 = 0;

329 
tm
->
£cÚd_·¹
 = 0;

331 ià(
p
 =ð
’d
)

332 
’d
;

335 ià(*
p
 != '.')

336 
’d
;

338 
p
++;

339 
äac_Ën
 = 
	`MIN
(6,
’d
-
p
);

341 
tm
->
£cÚd_·¹
 = 
	`my_¡¹oui
(
p
, 
äac_Ën
, &p, &
”r
);

342 ià(
”r
)

343 
’d
;

345 ià(
äac_Ën
 < 6)

346 
tm
->
£cÚd_·¹
 *ð
äac_mul
[
äac_Ën
];

348 
»t
 = 0;

351 
p
 +ð
äac_Ën
;

352 
p
 < *
’d_±r
)

354 ià(*
p
 < '0' || *p > '9')

356 
p
++;

358 
’d
:

359 *
’d_±r
 = 
p
;

360  
»t
;

361 
	}
}

379 
	$·r£_d©e
(cÚ¡ *
¡r
, 
size_t
 
Ëngth
, cÚ¡ **
’d_±r
, 
MYSQL_TIME
 *
tm
)

381 
”r
 = 0;

382 cÚ¡ *
p
 = 
¡r
;

383 cÚ¡ *
’d
 = 
¡r
 + 
Ëngth
;

384 
»t
 = 1;

386 
tm
->
y—r
 = 
	`my_¡¹oui
(
p
, 
’d
 -…, &p, &
”r
);

387 ià(
”r
 || 
tm
->
y—r
 > 9999 || 
p
 =ð
’d
 || *p != '-')

388 
’d
;

390 ià(
p
 - 
¡r
 == 2)

391 
tm
->
y—r
 += (tm->year >= 70) ? 1900 : 2000;

393 
p
++;

394 
tm
->
mÚth
 = 
	`my_¡¹oui
(
p
,
’d
 -p, &p, &
”r
);

395 ià(
”r
 || 
tm
->
mÚth
 > 12 || 
p
 =ð
’d
 || *p != '-')

396 
’d
;

398 
p
++;

399 
tm
->
day
 = 
	`my_¡¹oui
(
p
, 
’d
 -°, &p, &
”r
);

400 ià(
”r
 || 
tm
->
day
 > 31)

401 
’d
;

403 
»t
 = 0;

405 
’d
:

406 *
’d_±r
 = 
p
;

407  
»t
;

408 
	}
}

429 
	$¡r_to_TIME
(cÚ¡ *
¡r
, 
size_t
 
Ëngth
, 
MYSQL_TIME
 *
tm
)

431 cÚ¡ *
p
 = 
¡r
;

432 cÚ¡ *
’d
 = 
¡r
 + 
Ëngth
;

433 
is_time
 = 0;

435 ià(!
p
)

436 
”rÜ
;

438 
p
 < 
’d
 && 
	`is¥aû
(*p))

439 
p
++;

440 
p
 < 
’d
 && 
	`is¥aû
(end[-1]))

441 
’d
--;

443 ià(
’d
 -
p
 < 5)

444 
”rÜ
;

446 ià(*
p
 == '-')

448 
tm
->
Ãg
 = 1;

450 
is_time
 = 1;

451 
p
++;

455 
i
;

456 
tm
->
Ãg
 = 0;

461 
i
 = 1; 
p
 + i < 
’d
; i++)

463 if(
p
[
i
] == '-' ||… [i] == ':')

465 
is_time
 = 
p
[
i
] == ':';

471 ià(
is_time
)

473 ià(
	`·r£_time
(
p
, 
’d
 -…, &p, 
tm
))

474 
”rÜ
;

476 
tm
->
y—r
 =m->
mÚth
 =m->
day
 = 0;

477 
tm
->
time_ty³
 = 
MYSQL_TIMESTAMP_TIME
;

481 ià(
	`·r£_d©e
(
p
, 
’d
 -…, &p, 
tm
))

482 
”rÜ
;

484 ià(
p
 =ð
’d
 ||…[0] != ' ')

486 
tm
->
hour
 =m->
mšu‹
 =m->
£cÚd
 =m->
£cÚd_·¹
 = 0;

487 
tm
->
time_ty³
 = 
MYSQL_TIMESTAMP_DATE
;

492 
p
++;

493 ià(
	`·r£_time
(
p
, 
’d
 -…, &p, 
tm
))

494 
”rÜ
;

497 ià(
tm
->
hour
 > 23)

498 
”rÜ
;

500 
tm
->
time_ty³
 = 
MYSQL_TIMESTAMP_DATETIME
;

503 
”rÜ
:

504 
	`mem£t
(
tm
, 0, (*tm));

505 
tm
->
time_ty³
 = 
MYSQL_TIMESTAMP_ERROR
;

507 
	}
}

510 
	$cÚv”t_äoma_¡ršg
(
MYSQL_BIND
 *
r_·¿m
, *
bufãr
, 
size_t
 
Ën
)

512 
”rÜ
= 0;

513 
r_·¿m
->
bufãr_ty³
)

515 
MYSQL_TYPE_TINY
:

517 
lÚglÚg
 
v®
ð
	`my_©Þl
(
bufãr
, bufã¸+ 
Ën
, &
”rÜ
);

518 *
r_·¿m
->
”rÜ
ð”rÜ ? 1 :„_·¿m->
is_unsigÃd
 ? 
	`NUMERIC_TRUNCATION
(
v®
, 0, 
UINT_MAX8
è: NUMERIC_TRUNCATION(v®, 
INT_MIN8
, 
INT_MAX8
) ||ƒrror > 0;

519 
	`št1¡Üe
(
r_·¿m
->
bufãr
, (
uch¬
è
v®
);

520 
r_·¿m
->
bufãr_Ëngth
ð(
uch¬
);

523 
MYSQL_TYPE_YEAR
:

524 
MYSQL_TYPE_SHORT
:

526 
lÚglÚg
 
v®
ð
	`my_©Þl
(
bufãr
, bufã¸+ 
Ën
, &
”rÜ
);

527 *
r_·¿m
->
”rÜ
ð”rÜ ? 1 :„_·¿m->
is_unsigÃd
 ? 
	`NUMERIC_TRUNCATION
(
v®
, 0, 
UINT_MAX16
è: NUMERIC_TRUNCATION(v®, 
INT_MIN16
, 
INT_MAX16
) ||ƒrror > 0;

528 
	`shÜt¡Üe
(
r_·¿m
->
bufãr
, ()
v®
);

529 
r_·¿m
->
bufãr_Ëngth
= ();

532 
MYSQL_TYPE_LONG
:

534 
lÚglÚg
 
v®
ð
	`my_©Þl
(
bufãr
, bufã¸+ 
Ën
, &
”rÜ
);

535 *
r_·¿m
->
”rÜ
ó¼Ü ? 1 :„_·¿m->
is_unsigÃd
 ? 
	`NUMERIC_TRUNCATION
(
v®
, 0, 
UINT_MAX32
è: NUMERIC_TRUNCATION(v®, 
INT_MIN32
, 
INT_MAX32
) ||ƒrror > 0;

536 
	`lÚg¡Üe
(
r_·¿m
->
bufãr
, (
št32
)
v®
);

537 
r_·¿m
->
bufãr_Ëngth
ð(
ušt32
);

540 
MYSQL_TYPE_LONGLONG
:

542 
lÚglÚg
 
v®
ð
r_·¿m
->
is_unsigÃd
 ? (lÚglÚg)
	`my_©ouÎ
(
bufãr
, bufã¸+ 
Ën
, &
”rÜ
è: 
	`my_©Þl
(buffer, buffer +†en, &error);

543 *
r_·¿m
->
”rÜ
=ƒrror > 0;

544 
	`lÚglÚg¡Üe
(
r_·¿m
->
bufãr
, 
v®
);

545 
r_·¿m
->
bufãr_Ëngth
ð(
lÚglÚg
);

548 
MYSQL_TYPE_DOUBLE
:

550 
v®
ð
	`my_©od
(
bufãr
, bufã¸+ 
Ën
, &
”rÜ
);

551 *
r_·¿m
->
”rÜ
=ƒrror > 0;

552 
	`doubË¡Üe
((
uch¬
 *)
r_·¿m
->
bufãr
, 
v®
);

553 
r_·¿m
->
bufãr_Ëngth
= ();

556 
MYSQL_TYPE_FLOAT
:

558 
v®
ð()
	`my_©od
(
bufãr
, bufã¸+ 
Ën
, &
”rÜ
);

559 *
r_·¿m
->
”rÜ
=ƒrror > 0;

560 
	`æßt¡Üe
((
uch¬
 *)
r_·¿m
->
bufãr
, 
v®
);

561 
r_·¿m
->
bufãr_Ëngth
= ();

564 
MYSQL_TYPE_TIME
:

565 
MYSQL_TYPE_DATE
:

566 
MYSQL_TYPE_DATETIME
:

567 
MYSQL_TYPE_TIMESTAMP
:

569 
MYSQL_TIME
 *
tm
ð(MYSQL_TIME *)
r_·¿m
->
bufãr
;

570 
	`¡r_to_TIME
(
bufãr
, 
Ën
, 
tm
);

574 
MYSQL_TYPE_TINY_BLOB
:

575 
MYSQL_TYPE_MEDIUM_BLOB
:

576 
MYSQL_TYPE_LONG_BLOB
:

577 
MYSQL_TYPE_BLOB
:

578 
MYSQL_TYPE_DECIMAL
:

579 
MYSQL_TYPE_NEWDECIMAL
:

582 ià(
Ën
 >ð
r_·¿m
->
off£t
)

584 *
¡¬t
ð
bufãr
 + 
r_·¿m
->
off£t
;

585 *
’d
ð
bufãr
 + 
Ën
;

586 
size_t
 
cÝyËn
= 0;

588 ià(
¡¬t
 < 
’d
)

590 
cÝyËn
ð
’d
 - 
¡¬t
;

591 ià(
r_·¿m
->
bufãr_Ëngth
)

592 
	`memýy
(
r_·¿m
->
bufãr
, 
¡¬t
, 
	`MIN
(
cÝyËn
,„_·¿m->
bufãr_Ëngth
));

594 ià(
cÝyËn
 < 
r_·¿m
->
bufãr_Ëngth
)

595 ((*)
r_·¿m
->
bufãr
)[
cÝyËn
]= 0;

596 *
r_·¿m
->
”rÜ
ð(
cÝyËn
 >„_·¿m->
bufãr_Ëngth
);

599 *
r_·¿m
->
Ëngth
ð(
ulÚg
)
Ën
;

603 
	}
}

605 
	$cÚv”t_äom_lÚg
(
MYSQL_BIND
 *
r_·¿m
, cÚ¡ 
MYSQL_FIELD
 *
f›ld
, 
lÚglÚg
 
v®
, 
my_boÞ
 
is_unsigÃd
)

607 
r_·¿m
->
bufãr_ty³
) {

608 
MYSQL_TYPE_TINY
:

609 *(
uch¬
 *)
r_·¿m
->
bufãr
ð(uch¬)
v®
;

610 *
r_·¿m
->
”rÜ
ðr_·¿m->
is_unsigÃd
 ? 
	`NUMERIC_TRUNCATION
(
v®
, 0, 
UINT_MAX8
è: NUMERIC_TRUNCATION(v®, 
INT_MIN8
, 
INT_MAX8
);

611 
r_·¿m
->
bufãr_Ëngth
= 1;

613 
MYSQL_TYPE_SHORT
:

614 
MYSQL_TYPE_YEAR
:

615 
	`shÜt¡Üe
(
r_·¿m
->
bufãr
, ()
v®
);

616 *
r_·¿m
->
”rÜ
ðr_·¿m->
is_unsigÃd
 ? 
	`NUMERIC_TRUNCATION
(
v®
, 0, 
UINT_MAX16
è: NUMERIC_TRUNCATION(v®, 
INT_MIN16
, 
INT_MAX16
);

617 
r_·¿m
->
bufãr_Ëngth
= 2;

619 
MYSQL_TYPE_LONG
:

620 
	`lÚg¡Üe
(
r_·¿m
->
bufãr
, (
št32
)
v®
);

621 *
r_·¿m
->
”rÜ
ðr_·¿m->
is_unsigÃd
 ? 
	`NUMERIC_TRUNCATION
(
v®
, 0, 
UINT_MAX32
è: NUMERIC_TRUNCATION(v®, 
INT_MIN32
, 
INT_MAX32
);

622 
r_·¿m
->
bufãr_Ëngth
= 4;

624 
MYSQL_TYPE_LONGLONG
:

625 *
r_·¿m
->
”rÜ
ð(
v®
 < 0 &&„_·¿m->
is_unsigÃd
 != is_unsigned);

626 
	`lÚglÚg¡Üe
(
r_·¿m
->
bufãr
, 
v®
);

627 
r_·¿m
->
bufãr_Ëngth
= 8;

629 
MYSQL_TYPE_DOUBLE
:

631 vÞ©ž
dbl
;

633 
dbl
ð(
is_unsigÃd
è? 
	`ulÚglÚg2doubË
((
ulÚglÚg
)
v®
) : ()val;

634 
	`doubË¡Üe
(
r_·¿m
->
bufãr
, 
dbl
);

636 *
r_·¿m
->
”rÜ
 = (
dbl
 !ð
	`ûž
(dbl)) ||

637 (
is_unsigÃd
 ? (
ulÚglÚg
 )
dbl
 !ð(ulÚglÚg)
v®
 :

638 (
lÚglÚg
)
dbl
 !ðÖÚglÚg)
v®
);

640 
r_·¿m
->
bufãr_Ëngth
= 8;

643 
MYSQL_TYPE_FLOAT
:

645 vÞ©ž
fv®
;

646 
fv®
ð
is_unsigÃd
 ? ()(
ulÚglÚg
)(
v®
) : ()val;

647 
	`æßt¡Üe
((
uch¬
 *)
r_·¿m
->
bufãr
, 
fv®
);

648 *
r_·¿m
->
”rÜ
ð(
fv®
 !ð
	`ûžf
(fval)) ||

649 (
is_unsigÃd
 ? (
ulÚglÚg
)
fv®
 !ð(ulÚglÚg)
v®
 :

650 (
lÚglÚg
)
fv®
 !ð
v®
);

651 
r_·¿m
->
bufãr_Ëngth
= 4;

656 *
bufãr
;

657 *
’d±r
;

658 
ušt
 
Ën
;

659 
my_boÞ
 
zf_Œunÿ‹d
= 0;

661 
bufãr
ð
	`®loÿ
(
	`MAX
(
f›ld
->
Ëngth
, 22));

662 
’d±r
ð
	`ma_Î2¡r
(
v®
, 
bufãr
, 
is_unsigÃd
 ? 10 : -10);

663 
Ën
ð(
ušt
)(
’d±r
 - 
bufãr
);

666 ià(
f›ld
->
æags
 & 
ZEROFILL_FLAG
)

668 
ušt
 
di¥Ïy_width
ð
	`MAX
(
f›ld
->
Ëngth
, 
Ën
);

669 ià(
di¥Ïy_width
 < 
r_·¿m
->
bufãr_Ëngth
)

671 
	`ma_bmove_uµ
(
bufãr
 + 
di¥Ïy_width
, bufã¸+ 
Ën
,†en);

673 
	`mem£t
((*è
bufãr
, (è'0', 
di¥Ïy_width
 - 
Ën
);

674 
Ën
ð
di¥Ïy_width
;

677 
zf_Œunÿ‹d
= 1;

679 
	`cÚv”t_äoma_¡ršg
(
r_·¿m
, 
bufãr
, 
Ën
);

680 *
r_·¿m
->
”rÜ
+ð
zf_Œunÿ‹d
;

684 
	}
}

689 
ps_ãtch_nuÎ
(
MYSQL_BIND
 *
r_·¿m
 
__©Œibu‹__
((
unu£d
)),

690 cÚ¡ 
MYSQL_FIELD
 * 
f›ld
 
__©Œibu‹__
((
unu£d
)),

691 **
row
 
__©Œibu‹__
((
unu£d
)))

697 
	#GET_LVALUE_FROM_ROW
(
is_unsigÃd
, 
d©a
, 
uÿ¡
, 
sÿ¡
)\

698 (
is_unsigÃd
è? (
lÚglÚg
)(
uÿ¡
è*ÖÚglÚg *)(
d©a
è: (lÚglÚg)(
sÿ¡
è*ÖÚglÚg *)(d©a)

	)

701 
	$ps_ãtch_št8
(
MYSQL_BIND
 *
r_·¿m
, cÚ¡ 
MYSQL_FIELD
 * cÚ¡ 
f›ld
,

702 **
row
)

704 
r_·¿m
->
bufãr_ty³
) {

705 
MYSQL_TYPE_TINY
:

706 
	`ps_ãtch_äom_1_to_8_by‹s
(
r_·¿m
, 
f›ld
, 
row
, 1);

710 
uch¬
 
v®
ð**
row
;

711 
lÚglÚg
 
lv®
ð
f›ld
->
æags
 & 
UNSIGNED_FLAG
 ? (lÚglÚgè
v®
 : (longlong)(signed )val;

712 
	`cÚv”t_äom_lÚg
(
r_·¿m
, 
f›ld
, 
lv®
, f›ld->
æags
 & 
UNSIGNED_FLAG
);

713 (*
row
) += 1;

717 
	}
}

723 
	$ps_ãtch_št16
(
MYSQL_BIND
 *
r_·¿m
, cÚ¡ 
MYSQL_FIELD
 * cÚ¡ 
f›ld
,

724 **
row
)

726 
r_·¿m
->
bufãr_ty³
) {

727 
MYSQL_TYPE_YEAR
:

728 
MYSQL_TYPE_SHORT
:

729 
	`ps_ãtch_äom_1_to_8_by‹s
(
r_·¿m
, 
f›ld
, 
row
, 2);

733 
sv®
ð
	`sšt2kÜr
(*
row
);

734 
lÚglÚg
 
lv®
ð
f›ld
->
æags
 & 
UNSIGNED_FLAG
 ? (lÚglÚg)(
ushÜt
è
sv®
 : (longlong)sval;

735 
	`cÚv”t_äom_lÚg
(
r_·¿m
, 
f›ld
, 
lv®
, f›ld->
æags
 & 
UNSIGNED_FLAG
);

736 (*
row
) += 2;

740 
	}
}

746 
	$ps_ãtch_št32
(
MYSQL_BIND
 *
r_·¿m
, cÚ¡ 
MYSQL_FIELD
 * cÚ¡ 
f›ld
,

747 **
row
)

749 
r_·¿m
->
bufãr_ty³
) {

757 
MYSQL_TYPE_INT24
:

758 
MYSQL_TYPE_LONG
:

759 
	`ps_ãtch_äom_1_to_8_by‹s
(
r_·¿m
, 
f›ld
, 
row
, 4);

763 
št32
 
sv®
ð
	`sšt4kÜr
(*
row
);

764 
lÚglÚg
 
lv®
ð
f›ld
->
æags
 & 
UNSIGNED_FLAG
 ? (lÚglÚg)(
ušt32
è
sv®
 : (longlong)sval;

765 
	`cÚv”t_äom_lÚg
(
r_·¿m
, 
f›ld
, 
lv®
, f›ld->
æags
 & 
UNSIGNED_FLAG
);

766 (*
row
) += 4;

770 
	}
}

776 
	$ps_ãtch_št64
(
MYSQL_BIND
 *
r_·¿m
, cÚ¡ 
MYSQL_FIELD
 * cÚ¡ 
f›ld
,

777 **
row
)

779 
r_·¿m
->
bufãr_ty³
)

792 
MYSQL_TYPE_LONGLONG
:

793 
	`ps_ãtch_äom_1_to_8_by‹s
(
r_·¿m
, 
f›ld
, 
row
, 8);

797 
lÚglÚg
 
sv®
ðÖÚglÚg)
	`sšt8kÜr
(*
row
);

798 
lÚglÚg
 
lv®
ð
f›ld
->
æags
 & 
UNSIGNED_FLAG
 ? (lÚglÚg)(
ulÚglÚg
è
sv®
 : (longlong)sval;

799 
	`cÚv”t_äom_lÚg
(
r_·¿m
, 
f›ld
, 
lv®
, f›ld->
æags
 & 
UNSIGNED_FLAG
);

800 (*
row
) += 8;

804 
	}
}

807 
cÚv”t_äom_æßt
(
MYSQL_BIND
 *
r_·¿m
, cÚ¡ 
MYSQL_FIELD
 *
f›ld
, 
v®
, 
size
 
__©Œibu‹__
((
unu£d
)))

809 
	gcheck_Œunc_v®
ð(
v®
 > 0è? 
æoÜ
(val) : -floor(-val);

810 *
	gbuf
ð(*)
r_·¿m
->
bufãr
;

811 
	gr_·¿m
->
	gbufãr_ty³
)

813 
	gMYSQL_TYPE_TINY
:

814 *
buf
ð(
r_·¿m
->
is_unsigÃd
è? (
ušt8
)
v®
 : (
št8
)val;

815 *
	gr_·¿m
->
	g”rÜ
ð
check_Œunc_v®
 !ð(
r_·¿m
->
is_unsigÃd
 ? ()((
ušt8
)*
buf
) :

816 ()((
št8
)*
buf
));

817 
	gr_·¿m
->
	gbufãr_Ëngth
= 1;

819 
	gMYSQL_TYPE_SHORT
:

820 
MYSQL_TYPE_YEAR
:

822 ià(
r_·¿m
->
is_unsigÃd
)

824 
ushÜt
 
sv®
ð(ushÜt)
v®
;

825 
shÜt¡Üe
(
buf
, 
sv®
);

826 *
	gr_·¿m
->
	g”rÜ
ð
check_Œunc_v®
 !ð()
sv®
;

828 
	gsv®
ð()
v®
;

829 
shÜt¡Üe
(
buf
, 
sv®
);

830 *
	gr_·¿m
->
	g”rÜ
ð
check_Œunc_v®
 !ð()
sv®
;

832 
	gr_·¿m
->
	gbufãr_Ëngth
= 2;

835 
	gMYSQL_TYPE_LONG
:

837 ià(
r_·¿m
->
is_unsigÃd
)

839 
ušt32
 
lv®
ð(ušt32)
v®
;

840 
lÚg¡Üe
(
buf
, 
lv®
);

841 *
	gr_·¿m
->
	g”rÜ
ð(
check_Œunc_v®
 !ð()
lv®
);

843 
št32
 
	glv®
ð(št32)
v®
;

844 
lÚg¡Üe
(
buf
, 
lv®
);

845 *
	gr_·¿m
->
	g”rÜ
ð(
check_Œunc_v®
 !ð()
lv®
);

847 
	gr_·¿m
->
	gbufãr_Ëngth
= 4;

850 
	gMYSQL_TYPE_LONGLONG
:

852 ià(
r_·¿m
->
is_unsigÃd
)

854 
ulÚglÚg
 
Îv®
ð(ulÚglÚg)
v®
;

855 
lÚglÚg¡Üe
(
buf
, 
Îv®
);

856 *
	gr_·¿m
->
	g”rÜ
ð(
check_Œunc_v®
 !ð()
Îv®
);

858 
lÚglÚg
 
	gÎv®
ðÖÚglÚg)
v®
;

859 
lÚglÚg¡Üe
(
buf
, 
Îv®
);

860 *
	gr_·¿m
->
	g”rÜ
ð(
check_Œunc_v®
 !ð()
Îv®
);

862 
	gr_·¿m
->
	gbufãr_Ëngth
= 8;

865 
	gMYSQL_TYPE_DOUBLE
:

867 
dv®
ð()
v®
;

868 
memýy
(
buf
, &
dv®
, ());

869 
	gr_·¿m
->
	gbufãr_Ëngth
= 8;

874 
buff
[
MAX_DOUBLE_STRING_REP_LENGTH
];

875 
size_t
 
	gËngth
;

877 
	gËngth
ð
MIN
(
MAX_DOUBLE_STRING_REP_LENGTH
 - 1, 
r_·¿m
->
bufãr_Ëngth
);

879 ià(
	gf›ld
->
	gdecim®s
 >ð
NOT_FIXED_DEC
)

881 
Ëngth
ð
ma_gcvt
(
v®
, 
MY_GCVT_ARG_FLOAT
, (î’gth, 
buff
, 
NULL
);

885 
	gËngth
ð
ma_fcvt
(
v®
, 
f›ld
->
decim®s
, 
buff
, 
NULL
);

889 ià(
	gf›ld
->
	gæags
 & 
	gZEROFILL_FLAG
)

892 ià(
	gf›ld
->
	gËngth
 <†’gth || f›ld->Ëngth > 
	gMAX_DOUBLE_STRING_REP_LENGTH
 - 1)

894 
ma_bmove_uµ
(
buff
 + 
f›ld
->
Ëngth
, buff +†ength,†ength);

896 
mem£t
((*è
buff
, (è'0', 
f›ld
->
Ëngth
 -†ength);

897 
	gËngth
ð
f›ld
->
Ëngth
;

900 
cÚv”t_äoma_¡ršg
(
r_·¿m
, 
buff
, 
Ëngth
);

906 
cÚv”t_äom_doubË
(
MYSQL_BIND
 *
r_·¿m
, cÚ¡ 
MYSQL_FIELD
 *
f›ld
, 
v®
, 
size
 
__©Œibu‹__
((
unu£d
)))

908 
	gcheck_Œunc_v®
ð(
v®
 > 0è? 
æoÜ
(val) : -floor(-val);

909 *
	gbuf
ð(*)
r_·¿m
->
bufãr
;

910 
	gr_·¿m
->
	gbufãr_ty³
)

912 
	gMYSQL_TYPE_TINY
:

913 *
buf
ð(
r_·¿m
->
is_unsigÃd
è? (
ušt8
)
v®
 : (
št8
)val;

914 *
	gr_·¿m
->
	g”rÜ
ð
check_Œunc_v®
 !ð(
r_·¿m
->
is_unsigÃd
 ? ()((
ušt8
)*
buf
) :

915 ()((
št8
)*
buf
));

916 
	gr_·¿m
->
	gbufãr_Ëngth
= 1;

918 
	gMYSQL_TYPE_SHORT
:

919 
MYSQL_TYPE_YEAR
:

921 ià(
r_·¿m
->
is_unsigÃd
)

923 
ushÜt
 
sv®
ð(ushÜt)
v®
;

924 
shÜt¡Üe
(
buf
, 
sv®
);

925 *
	gr_·¿m
->
	g”rÜ
ð
check_Œunc_v®
 !ð()
sv®
;

927 
	gsv®
ð()
v®
;

928 
shÜt¡Üe
(
buf
, 
sv®
);

929 *
	gr_·¿m
->
	g”rÜ
ð
check_Œunc_v®
 !ð()
sv®
;

931 
	gr_·¿m
->
	gbufãr_Ëngth
= 2;

934 
	gMYSQL_TYPE_LONG
:

936 ià(
r_·¿m
->
is_unsigÃd
)

938 
ušt32
 
lv®
ð(ušt32)
v®
;

939 
lÚg¡Üe
(
buf
, 
lv®
);

940 *
	gr_·¿m
->
	g”rÜ
ð(
check_Œunc_v®
 !ð()
lv®
);

942 
št32
 
	glv®
ð(št32)
v®
;

943 
lÚg¡Üe
(
buf
, 
lv®
);

944 *
	gr_·¿m
->
	g”rÜ
ð(
check_Œunc_v®
 !ð()
lv®
);

946 
	gr_·¿m
->
	gbufãr_Ëngth
= 4;

949 
	gMYSQL_TYPE_LONGLONG
:

951 ià(
r_·¿m
->
is_unsigÃd
)

953 
ulÚglÚg
 
Îv®
ð(ulÚglÚg)
v®
;

954 
lÚglÚg¡Üe
(
buf
, 
Îv®
);

955 *
	gr_·¿m
->
	g”rÜ
ð(
check_Œunc_v®
 !ð()
Îv®
);

957 
lÚglÚg
 
	gÎv®
ðÖÚglÚg)
v®
;

958 
lÚglÚg¡Üe
(
buf
, 
Îv®
);

959 *
	gr_·¿m
->
	g”rÜ
ð(
check_Œunc_v®
 !ð()
Îv®
);

961 
	gr_·¿m
->
	gbufãr_Ëngth
= 8;

964 
	gMYSQL_TYPE_FLOAT
:

966 
fv®
ð()
v®
;

967 
memýy
(
buf
, &
fv®
, ());

968 *
	gr_·¿m
->
	g”rÜ
ð(*(*)
buf
 !ð
fv®
);

969 
	gr_·¿m
->
	gbufãr_Ëngth
= 4;

974 
buff
[
MAX_DOUBLE_STRING_REP_LENGTH
];

975 
size_t
 
	gËngth
;

977 
	gËngth
ð
MIN
(
MAX_DOUBLE_STRING_REP_LENGTH
 - 1, 
r_·¿m
->
bufãr_Ëngth
);

979 ià(
	gf›ld
->
	gdecim®s
 >ð
NOT_FIXED_DEC
)

981 
Ëngth
ð
ma_gcvt
(
v®
, 
MY_GCVT_ARG_DOUBLE
, (î’gth, 
buff
, 
NULL
);

985 
	gËngth
ð
ma_fcvt
(
v®
, 
f›ld
->
decim®s
, 
buff
, 
NULL
);

989 ià(
	gf›ld
->
	gæags
 & 
	gZEROFILL_FLAG
)

992 ià(
	gf›ld
->
	gËngth
 <†’gth || f›ld->Ëngth > 
	gMAX_DOUBLE_STRING_REP_LENGTH
 - 1)

994 
ma_bmove_uµ
(
buff
 + 
f›ld
->
Ëngth
, buff +†ength,†ength);

996 
mem£t
((*è
buff
, (è'0', 
f›ld
->
Ëngth
 -†ength);

997 
	gËngth
ð
f›ld
->
Ëngth
;

999 
cÚv”t_äoma_¡ršg
(
r_·¿m
, 
buff
, 
Ëngth
);

1008 
	$ps_ãtch_doubË
(
MYSQL_BIND
 *
r_·¿m
, cÚ¡ 
MYSQL_FIELD
 * 
f›ld
 , **
row
)

1010 
r_·¿m
->
bufãr_ty³
)

1012 
MYSQL_TYPE_DOUBLE
:

1014 *
v®ue
ð(*)
r_·¿m
->
bufãr
;

1015 
	`æßt8g‘
(*
v®ue
, *
row
);

1016 
r_·¿m
->
bufãr_Ëngth
= 8;

1021 
v®ue
;

1022 
	`æßt8g‘
(
v®ue
, *
row
);

1023 
	`cÚv”t_äom_doubË
(
r_·¿m
, 
f›ld
, 
v®ue
, ());

1027 (*
row
)+= 8;

1028 
	}
}

1033 
	$ps_ãtch_æßt
(
MYSQL_BIND
 *
r_·¿m
, cÚ¡ 
MYSQL_FIELD
 * 
f›ld
, **
row
)

1035 
r_·¿m
->
bufãr_ty³
)

1037 
MYSQL_TYPE_FLOAT
:

1039 *
v®ue
ð(*)
r_·¿m
->
bufãr
;

1040 
	`æßt4g‘
(*
v®ue
, *
row
);

1041 
r_·¿m
->
bufãr_Ëngth
= 4;

1042 *
r_·¿m
->
”rÜ
= 0;

1047 
v®ue
;

1048 
	`memýy
(&
v®ue
, *
row
, ());

1049 
	`æßt4g‘
(
v®ue
, (*)*
row
);

1050 
	`cÚv”t_äom_æßt
(
r_·¿m
, 
f›ld
, 
v®ue
, ());

1054 (*
row
)+= 4;

1055 
	}
}

1058 
	$cÚv”t_to_d©‘ime
(
MYSQL_TIME
 *
t
, **
row
, 
ušt
 
Ën
, 
’um_f›ld_ty³s
 
ty³
)

1060 
	`mem£t
(
t
, 0, (
MYSQL_TIME
));

1067 ià(
Ën
)

1069 *
to
ð*
row
;

1070 
has_d©e
= 0;

1071 
ušt
 
off£t
= 7;

1073 ià(
ty³
 =ð
MYSQL_TYPE_TIME
)

1075 
t
->
Ãg
ð
to
[0];

1076 
t
->
day
ð(
ulÚg
è
	`sšt4kÜr
(
to
 + 1);

1077 
t
->
time_ty³
ð
MYSQL_TIMESTAMP_TIME
;

1078 
off£t
= 8;

1079 
to
++;

1082 
t
->
y—r
ð(
ušt
è
	`sšt2kÜr
(
to
);

1083 
t
->
mÚth
ð(
ušt
è
to
[2];

1084 
t
->
day
ð(
ušt
è
to
[3];

1085 
t
->
time_ty³
ð
MYSQL_TIMESTAMP_DATE
;

1086 ià(
ty³
 =ð
MYSQL_TYPE_DATE
)

1088 
has_d©e
= 1;

1091 ià(
Ën
 > 4)

1093 
t
->
hour
ð(
ušt
è
to
[4];

1094 ià(
ty³
 =ð
MYSQL_TYPE_TIME
)

1095 
t
->
hour
+ðt->
day
 * 24;

1096 
t
->
mšu‹
ð(
ušt
è
to
[5];

1097 
t
->
£cÚd
ð(
ušt
è
to
[6];

1098 ià(
has_d©e
)

1099 
t
->
time_ty³
ð
MYSQL_TIMESTAMP_DATETIME
;

1101 ià(
Ën
 > 
off£t
)

1103 
t
->
£cÚd_·¹
ð(
ulÚg
)
	`sšt4kÜr
(
to
+7);

1106 
	}
}

1112 
	$ps_ãtch_Üaþe_time¡amp
(
MYSQL_BIND
 *
·¿m
,

1113 cÚ¡ 
MYSQL_FIELD
 *
f›ld
,

1114 
uch¬
 **
row
)

1116 
ušt
 
bufãr_Ëngth
 = 0;

1117 
ušt
 
Ëngth
 = 
	`Ãt_f›ld_Ëngth
(
row
);

1119 ià(
Ëngth
 > 16) {

1121 
bufãr_Ëngth
 = 
Ëngth
 - 16 + (
ORACLE_TIME
) + 2;

1123 
bufãr_Ëngth
 = (
ORACLE_TIME
);

1126 ià(
·¿m
->
bufãr_Ëngth
 < buffer_length) {

1127 *
·¿m
->
Ëngth
ð
bufãr_Ëngth
;

1128 *
·¿m
->
”rÜ
= 1;

1129 *
row
 +ð
Ëngth
;

1131 
ORACLE_TIME
 *
tm
ð(ORACLE_TIME *)
·¿m
->
bufãr
;

1132 
ušt
 
tz_Ëngth
 = 0;

1133 
ušt
 
bufãr_off£t
 = 0;

1134 
uch¬
 *
to
ð*
row
;

1136 
	`mem£t
(
tm
, 0, (
ORACLE_TIME
));

1137 
tm
->
ûÁury
ð(è(*(*)
to
++);

1138 
tm
->
y—r
ð(è(*(*)
to
++);

1139 
tm
->
mÚth
ð(
ušt
è(*
to
++);

1140 
tm
->
day
ð(
ušt
è(*
to
++);

1141 
tm
->
hour
ð(
ušt
è(*
to
++);

1142 
tm
->
mšu‹
ð(
ušt
è(*
to
++);

1143 
tm
->
£cÚd
ð(
ušt
è(*
to
++);

1145 
tm
->
£cÚd_·¹
ð(
ulÚg
è
	`sšt4kÜr
(
to
);

1146 
to
 += 4;

1147 
tm
->
sÿË
 = (
ušt
è(*
to
++);

1149 
bufãr_Ëngth
 = 
bufãr_off£t
 = (
ORACLE_TIME
);

1150 ià(
Ëngth
 > 12) {

1151 
tm
->
off£t_hour
 = (è(*(*)
to
++);

1152 
tm
->
off£t_mšu‹
 = (è(*(*)
to
++);

1154 
tz_Ëngth
 = (
ušt
è(*
to
++);

1156 
bufãr_Ëngth
 +ð(
tz_Ëngth
 + 1);

1157 ià(
tz_Ëngth
 > 0 && 
bufãr_off£t
 +z_Ëngth + 1 < 
·¿m
->
bufãr_Ëngth
) {

1158 
	`memýy
((*)
·¿m
->
bufãr
 + 
bufãr_off£t
, 
to
, 
tz_Ëngth
);

1159 
tm
->
tz_Çme
 = (*)
·¿m
->
bufãr
 + 
bufãr_off£t
;

1160 
bufãr_off£t
 +ð
tz_Ëngth
;

1161 *((*)
·¿m
->
bufãr
 + 
bufãr_off£t
) = '\0';

1162 
bufãr_off£t
++;

1164 
to
 +ð
tz_Ëngth
;

1166 
tz_Ëngth
 = (
ušt
è(*
to
++);

1167 
bufãr_Ëngth
 +ð(
tz_Ëngth
 + 1);

1168 ià(
tz_Ëngth
 > 0 && 
bufãr_off£t
 +z_Ëngth + 1 < 
·¿m
->
bufãr_Ëngth
) {

1169 
	`memýy
((*)
·¿m
->
bufãr
 + 
bufãr_off£t
, 
to
, 
tz_Ëngth
);

1170 
tm
->
tz_abbr
 = (*)
·¿m
->
bufãr
 + 
bufãr_off£t
;

1171 
bufãr_off£t
 +ð
tz_Ëngth
;

1172 *((*)
·¿m
->
bufãr
 + 
bufãr_off£t
) = '\0';

1173 
bufãr_off£t
++;

1175 
to
 +ð
tz_Ëngth
;

1177 *
·¿m
->
Ëngth
ð
bufãr_Ëngth
;

1178 *
·¿m
->
”rÜ
ð·¿m->
bufãr_Ëngth
 < buffer_length;

1179 *
row
 = 
to
;

1181 
	}
}

1186 
	$ps_ãtch_d©‘ime
(
MYSQL_BIND
 *
r_·¿m
, cÚ¡ 
MYSQL_FIELD
 * 
f›ld
,

1187 **
row
)

1189 
MYSQL_TIME
 *
t
ð(MYSQL_TIME *)
r_·¿m
->
bufãr
;

1190 
Ën
ð
	`Ãt_f›ld_Ëngth
(
row
);

1192 
r_·¿m
->
bufãr_ty³
) {

1193 
MYSQL_TYPE_DATETIME
:

1194 
MYSQL_TYPE_TIMESTAMP
:

1195 
	`cÚv”t_to_d©‘ime
(
t
, 
row
, 
Ën
, 
f›ld
->
ty³
);

1197 
MYSQL_TYPE_DATE
:

1198 
	`cÚv”t_to_d©‘ime
(
t
, 
row
, 
Ën
, 
f›ld
->
ty³
);

1200 
MYSQL_TYPE_TIME
:

1201 
	`cÚv”t_to_d©‘ime
(
t
, 
row
, 
Ën
, 
f›ld
->
ty³
);

1202 
t
->
y—r
ðt->
day
ðt->
mÚth
= 0;

1204 
MYSQL_TYPE_YEAR
:

1206 
MYSQL_TIME
 
tm
;

1207 
	`cÚv”t_to_d©‘ime
(&
tm
, 
row
, 
Ën
, 
f›ld
->
ty³
);

1208 
	`shÜt¡Üe
(
r_·¿m
->
bufãr
, 
tm
.
y—r
);

1213 
dtbufãr
[60];

1214 
MYSQL_TIME
 
tm
;

1215 
size_t
 
Ëngth
;

1216 
	`cÚv”t_to_d©‘ime
(&
tm
, 
row
, 
Ën
, 
f›ld
->
ty³
);

1218 
f›ld
->
ty³
) {

1219 
MYSQL_TYPE_DATE
:

1220 
Ëngth
ð
	`¥rštf
(
dtbufãr
, "%04u-%02u-%02u", 
tm
.
y—r
,m.
mÚth
,m.
day
);

1222 
MYSQL_TYPE_TIME
:

1223 
Ëngth
ð
	`¥rštf
(
dtbufãr
, "%s%02u:%02u:%02u", (
tm
.
Ãg
 ? "-" : ""),m.
hour
,m.
mšu‹
,m.
£cÚd
);

1224 ià(
f›ld
->
decim®s
 && field->decimals <= 6)

1226 
ms
[8];

1227 
	`¥rštf
(
ms
, ".%06lu", 
tm
.
£cÚd_·¹
);

1228 ià(
f›ld
->
decim®s
 < 6)

1229 
ms
[
f›ld
->
decim®s
 + 1]= 0;

1230 
Ëngth
+ð
	`¡¾’
(
ms
);

1231 
	`¡rÿt
(
dtbufãr
, 
ms
);

1234 
MYSQL_TYPE_DATETIME
:

1235 
MYSQL_TYPE_TIMESTAMP
:

1236 
Ëngth
ð
	`¥rštf
(
dtbufãr
, "%04u-%02u-%02u %02u:%02u:%02u", 
tm
.
y—r
,m.
mÚth
,m.
day
,m.
hour
,m.
mšu‹
,m.
£cÚd
);

1237 ià(
f›ld
->
decim®s
 && field->decimals <= 6)

1239 
ms
[8];

1240 
	`¥rštf
(
ms
, ".%06lu", 
tm
.
£cÚd_·¹
);

1241 ià(
f›ld
->
decim®s
 < 6)

1242 
ms
[
f›ld
->
decim®s
 + 1]= 0;

1243 
Ëngth
+ð
	`¡¾’
(
ms
);

1244 
	`¡rÿt
(
dtbufãr
, 
ms
);

1248 
dtbufãr
[0]= 0;

1249 
Ëngth
= 0;

1252 
	`cÚv”t_äoma_¡ršg
(
r_·¿m
, 
dtbufãr
, 
Ëngth
);

1256 (*
row
è+ð
Ën
;

1257 
	}
}

1262 
ps_ãtch_¡ršg
(
MYSQL_BIND
 *
r_·¿m
,

1263 cÚ¡ 
MYSQL_FIELD
 *
f›ld
 
__©Œibu‹__
((
unu£d
)),

1264 **
row
)

1270 
ulÚg
 
	gf›ld_Ëngth
ð
Ãt_f›ld_Ëngth
(
row
);

1272 
cÚv”t_äoma_¡ršg
(
r_·¿m
, (*)*
row
, 
f›ld_Ëngth
);

1273 (*
	grow
è+ð
f›ld_Ëngth
;

1279 
	$ps_ãtch_bš
(
MYSQL_BIND
 *
r_·¿m
,

1280 cÚ¡ 
MYSQL_FIELD
 *
f›ld
,

1281 **
row
)

1283 ià(
f›ld
->
ch¬£Šr
 == 63)

1285 
ulÚg
 
f›ld_Ëngth
ð*
r_·¿m
->
Ëngth
ð
	`Ãt_f›ld_Ëngth
(
row
);

1286 
uch¬
 *
cu¼’t_pos
ð(*
row
è+ 
r_·¿m
->
off£t
,

1287 *
’d
ð(*
row
è+ 
f›ld_Ëngth
;

1288 
size_t
 
cÝyËn
= 0;

1290 ià(
cu¼’t_pos
 < 
’d
)

1292 
cÝyËn
ð
’d
 - 
cu¼’t_pos
;

1293 ià(
r_·¿m
->
bufãr_Ëngth
)

1294 
	`memýy
(
r_·¿m
->
bufãr
, 
cu¼’t_pos
, 
	`MIN
(
cÝyËn
,„_·¿m->
bufãr_Ëngth
));

1296 ià(
cÝyËn
 < 
r_·¿m
->
bufãr_Ëngth
 &&

1297 (
r_·¿m
->
bufãr_ty³
 =ð
MYSQL_TYPE_STRING
 ||

1298 
r_·¿m
->
bufãr_ty³
 =ð
MYSQL_TYPE_JSON
))

1299 ((*)
r_·¿m
->
bufãr
)[
cÝyËn
]= 0;

1300 *
r_·¿m
->
”rÜ
ð
cÝyËn
 >„_·¿m->
bufãr_Ëngth
;

1301 (*
row
)+ð
f›ld_Ëngth
;

1304 
	`ps_ãtch_¡ršg
(
r_·¿m
, 
f›ld
, 
row
);

1305 
	}
}

1309 
	$mysql_š™_ps_subsy¡em
()

1311 
	`mem£t
(
mysql_ps_ãtch_funùiÚs
, 0, (mysql_ps_fetch_functions));

1312 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_NULL
].
func
ð
ps_ãtch_nuÎ
;

1313 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_NULL
].
·ck_Ën
 = 0;

1314 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_NULL
].
max_Ën
 = 0;

1316 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_TINY
].
func
 = 
ps_ãtch_št8
;

1317 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_TINY
].
·ck_Ën
 = 1;

1318 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_TINY
].
max_Ën
 = 4;

1320 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_SHORT
].
func
 = 
ps_ãtch_št16
;

1321 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_SHORT
].
·ck_Ën
 = 2;

1322 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_SHORT
].
max_Ën
 = 6;

1324 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_YEAR
].
func
 = 
ps_ãtch_št16
;

1325 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_YEAR
].
·ck_Ën
 = 2;

1326 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_YEAR
].
max_Ën
 = 6;

1328 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_INT24
].
func
 = 
ps_ãtch_št32
;

1329 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_INT24
].
·ck_Ën
 = 4;

1330 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_INT24
].
max_Ën
 = 9;

1332 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_LONG
].
func
 = 
ps_ãtch_št32
;

1333 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_LONG
].
·ck_Ën
 = 4;

1334 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_LONG
].
max_Ën
 = 11;

1336 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_LONGLONG
].
func
 = 
ps_ãtch_št64
;

1337 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_LONGLONG
].
·ck_Ën
= 8;

1338 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_LONGLONG
].
max_Ën
 = 21;

1340 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_FLOAT
].
func
 = 
ps_ãtch_æßt
;

1341 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_FLOAT
].
·ck_Ën
 = 4;

1342 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_FLOAT
].
max_Ën
 = 
MAX_DOUBLE_STRING_REP_LENGTH
;

1344 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_DOUBLE
].
func
 = 
ps_ãtch_doubË
;

1345 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_DOUBLE
].
·ck_Ën
 = 8;

1346 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_DOUBLE
].
max_Ën
 = 
MAX_DOUBLE_STRING_REP_LENGTH
;

1348 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_TIME
].
func
 = 
ps_ãtch_d©‘ime
;

1349 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_TIME
].
·ck_Ën
 = 
MYSQL_PS_SKIP_RESULT_W_LEN
;

1350 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_TIME
].
max_Ën
 = 17;

1352 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_DATE
].
func
 = 
ps_ãtch_d©‘ime
;

1353 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_DATE
].
·ck_Ën
 = 
MYSQL_PS_SKIP_RESULT_W_LEN
;

1354 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_DATE
].
max_Ën
 = 10;

1356 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_OB_TIMESTAMP_NANO
].
func
 = 
ps_ãtch_Üaþe_time¡amp
;

1357 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_OB_TIMESTAMP_NANO
].
·ck_Ën
 = 
MYSQL_PS_SKIP_RESULT_W_LEN
;

1358 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_OB_TIMESTAMP_NANO
].
max_Ën
 = -1;

1360 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_OB_TIMESTAMP_WITH_LOCAL_TIME_ZONE
].
func
 = 
ps_ãtch_Üaþe_time¡amp
;

1361 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_OB_TIMESTAMP_WITH_LOCAL_TIME_ZONE
].
·ck_Ën
 = 
MYSQL_PS_SKIP_RESULT_W_LEN
;

1362 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_OB_TIMESTAMP_WITH_LOCAL_TIME_ZONE
].
max_Ën
 = -1;

1364 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_OB_TIMESTAMP_WITH_TIME_ZONE
].
func
 = 
ps_ãtch_Üaþe_time¡amp
;

1365 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_OB_TIMESTAMP_WITH_TIME_ZONE
].
·ck_Ën
 = 
MYSQL_PS_SKIP_RESULT_W_LEN
;

1366 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_OB_TIMESTAMP_WITH_TIME_ZONE
].
max_Ën
 = -1;

1369 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_NEWDATE
].
func
 = 
ps_ãtch_¡ršg
;

1370 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_NEWDATE
].
·ck_Ën
 = 
MYSQL_PS_SKIP_RESULT_W_LEN
;

1371 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_NEWDATE
].
max_Ën
 = -1;

1373 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_DATETIME
].
func
 = 
ps_ãtch_d©‘ime
;

1374 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_DATETIME
].
·ck_Ën
ð
MYSQL_PS_SKIP_RESULT_W_LEN
;

1375 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_DATETIME
].
max_Ën
 = 30;

1377 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_TIMESTAMP
].
func
 = 
ps_ãtch_d©‘ime
;

1378 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_TIMESTAMP
].
·ck_Ën
ð
MYSQL_PS_SKIP_RESULT_W_LEN
;

1379 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_TIMESTAMP
].
max_Ën
 = 30;

1381 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_TINY_BLOB
].
func
 = 
ps_ãtch_bš
;

1382 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_TINY_BLOB
].
·ck_Ën
ð
MYSQL_PS_SKIP_RESULT_STR
;

1383 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_TINY_BLOB
].
max_Ën
 = -1;

1385 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_BLOB
].
func
 = 
ps_ãtch_bš
;

1386 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_BLOB
].
·ck_Ën
 = 
MYSQL_PS_SKIP_RESULT_STR
;

1387 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_BLOB
].
max_Ën
 = -1;

1389 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_MEDIUM_BLOB
].
func
 = 
ps_ãtch_bš
;

1390 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_MEDIUM_BLOB
].
·ck_Ën
ð
MYSQL_PS_SKIP_RESULT_STR
;

1391 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_MEDIUM_BLOB
].
max_Ën
 = -1;

1393 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_LONG_BLOB
].
func
 = 
ps_ãtch_bš
;

1394 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_LONG_BLOB
].
·ck_Ën
 = 
MYSQL_PS_SKIP_RESULT_STR
;

1395 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_LONG_BLOB
].
max_Ën
 = -1;

1397 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_BIT
].
func
 = 
ps_ãtch_bš
;

1398 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_BIT
].
·ck_Ën
 = 
MYSQL_PS_SKIP_RESULT_STR
;

1399 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_BIT
].
max_Ën
 = -1;

1401 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_VAR_STRING
].
func
 = 
ps_ãtch_¡ršg
;

1402 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_VAR_STRING
].
·ck_Ën
 = 
MYSQL_PS_SKIP_RESULT_STR
;

1403 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_VAR_STRING
].
max_Ën
 = -1;

1405 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_VARCHAR
].
func
 = 
ps_ãtch_¡ršg
;

1406 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_VARCHAR
].
·ck_Ën
 = 
MYSQL_PS_SKIP_RESULT_STR
;

1407 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_VARCHAR
].
max_Ën
 = -1;

1409 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_STRING
].
func
 = 
ps_ãtch_¡ršg
;

1410 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_STRING
].
·ck_Ën
 = 
MYSQL_PS_SKIP_RESULT_STR
;

1411 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_STRING
].
max_Ën
 = -1;

1413 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_JSON
].
func
 = 
ps_ãtch_¡ršg
;

1414 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_JSON
].
·ck_Ën
 = 
MYSQL_PS_SKIP_RESULT_STR
;

1415 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_JSON
].
max_Ën
 = -1;

1417 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_DECIMAL
].
func
 = 
ps_ãtch_¡ršg
;

1418 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_DECIMAL
].
·ck_Ën
 = 
MYSQL_PS_SKIP_RESULT_STR
;

1419 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_DECIMAL
].
max_Ën
 = -1;

1421 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_NEWDECIMAL
].
func
 = 
ps_ãtch_¡ršg
;

1422 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_NEWDECIMAL
].
·ck_Ën
 = 
MYSQL_PS_SKIP_RESULT_STR
;

1423 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_NEWDECIMAL
].
max_Ën
 = -1;

1425 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_ENUM
].
func
 = 
ps_ãtch_¡ršg
;

1426 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_ENUM
].
·ck_Ën
 = 
MYSQL_PS_SKIP_RESULT_STR
;

1427 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_ENUM
].
max_Ën
 = -1;

1429 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_SET
].
func
 = 
ps_ãtch_¡ršg
;

1430 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_SET
].
·ck_Ën
 = 
MYSQL_PS_SKIP_RESULT_STR
;

1431 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_SET
].
max_Ën
 = -1;

1433 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_GEOMETRY
].
func
 = 
ps_ãtch_¡ršg
;

1434 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_GEOMETRY
].
·ck_Ën
ð
MYSQL_PS_SKIP_RESULT_STR
;

1435 
mysql_ps_ãtch_funùiÚs
[
MYSQL_TYPE_GEOMETRY
].
max_Ën
 = -1;

1437 
mysql_ps_subsy¡em_š™Ÿlized
= 1;

1438 
	}
}

	@libmariadb/ma_string.c

25 
	~<ma_glob®.h
>

26 
	~<ma_sys.h
>

27 
	~<ma_¡ršg.h
>

29 
my_boÞ
 
	$ma_š™_dyÇmic_¡ršg
(
DYNAMIC_STRING
 *
¡r
, cÚ¡ *
š™_¡r
,

30 
size_t
 
š™_®loc
, size_ˆ
®loc_šüem’t
)

32 
ušt
 
Ëngth
;

34 ià(!
®loc_šüem’t
)

35 
®loc_šüem’t
=128;

36 
Ëngth
=1;

37 ià(
š™_¡r
 && (
Ëngth
ð(
ušt
è
	`¡¾’
(š™_¡r)+1è< 
š™_®loc
)

38 
š™_®loc
=((
Ëngth
+
®loc_šüem’t
-1)/alloc_increment)*alloc_increment;

39 ià(!
š™_®loc
)

40 
š™_®loc
=
®loc_šüem’t
;

42 ià(!(
¡r
->¡r=(*è
	`m®loc
(
š™_®loc
)))

43 (
TRUE
);

44 
¡r
->
Ëngth
=length-1;

45 ià(
š™_¡r
)

46 
	`memýy
(
¡r
->¡r,
š™_¡r
,
Ëngth
);

47 
¡r
->
max_Ëngth
=
š™_®loc
;

48 
¡r
->
®loc_šüem’t
=alloc_increment;

49 (
FALSE
);

50 
	}
}

52 
my_boÞ
 
	$ma_dyn¡r_£t
(
DYNAMIC_STRING
 *
¡r
, cÚ¡ *
š™_¡r
)

54 
ušt
 
Ëngth
;

56 ià(
š™_¡r
 && (
Ëngth
ð(
ušt
è
	`¡¾’
(š™_¡r)+1è> 
¡r
->
max_Ëngth
)

58 
¡r
->
max_Ëngth
=((
Ëngth
+¡r->
®loc_šüem’t
-1)/str->alloc_increment)*

59 
¡r
->
®loc_šüem’t
;

60 ià(!
¡r
->
max_Ëngth
)

61 
¡r
->
max_Ëngth
=¡r->
®loc_šüem’t
;

62 ià(!(
¡r
->¡r=(*è
	`»®loc
(¡r->¡r,¡r->
max_Ëngth
)))

63 (
TRUE
);

65 ià(
š™_¡r
)

67 
¡r
->
Ëngth
=length-1;

68 
	`memýy
(
¡r
->¡r,
š™_¡r
,
Ëngth
);

71 
¡r
->
Ëngth
=0;

72 (
FALSE
);

73 
	}
}

76 
my_boÞ
 
	$ma_dyn¡r_»®loc
(
DYNAMIC_STRING
 *
¡r
, 
size_t
 
add™iÚ®_size
)

78 ià(!
add™iÚ®_size
è(
FALSE
);

79 ià(
¡r
->
Ëngth
 + 
add™iÚ®_size
 > sŒ->
max_Ëngth
)

81 
¡r
->
max_Ëngth
=((¡r->
Ëngth
 + 
add™iÚ®_size
+¡r->
®loc_šüem’t
-1)/

82 
¡r
->
®loc_šüem’t
)*str->alloc_increment;

83 ià(!(
¡r
->¡r=(*è
	`»®loc
(¡r->¡r,¡r->
max_Ëngth
)))

84 (
TRUE
);

86 (
FALSE
);

87 
	}
}

90 
my_boÞ
 
	$ma_dyn¡r_­³nd
(
DYNAMIC_STRING
 *
¡r
, cÚ¡ *
­³nd
)

92  
	`ma_dyn¡r_­³nd_mem
(
¡r
,
­³nd
,
	`¡¾’
(append));

93 
	}
}

95 
my_boÞ
 
	$ma_dyn¡r_­³nd_quÙed
(
DYNAMIC_STRING
 *
¡r
,

96 cÚ¡ *
­³nd
, 
size_t
 
Ën
,

97 
quÙe
)

99 
size_t
 
add™iÚ®
ð
¡r
->
®loc_šüem’t
;

100 
size_t
 
lim
ð
add™iÚ®
;

101 
ušt
 
i
;

103 ià(
	`ma_dyn¡r_»®loc
(
¡r
, 
Ën
 + 
add™iÚ®
 + 2))

104  
TRUE
;

105 
¡r
->¡r[¡r->
Ëngth
++]ð
quÙe
;

106 
i
ð0; i < 
Ën
; i++)

108 
c
ð
­³nd
[
i
];

109 ià(
c
 =ð
quÙe
 || c == '\\')

111 ià(!
lim
)

113 ià(
	`ma_dyn¡r_»®loc
(
¡r
, 
add™iÚ®
))

114  
TRUE
;

115 
lim
ð
add™iÚ®
;

117 
lim
--;

118 
¡r
->¡r[¡r->
Ëngth
++]= '\\';

120 
¡r
->¡r[¡r->
Ëngth
++]ð
c
;

122 
¡r
->¡r[¡r->
Ëngth
++]ð
quÙe
;

123  
FALSE
;

124 
	}
}

126 
my_boÞ
 
	$ma_dyn¡r_­³nd_mem
(
DYNAMIC_STRING
 *
¡r
, cÚ¡ *
­³nd
,

127 
size_t
 
Ëngth
)

129 *
Ãw_±r
;

130 ià(
¡r
->
Ëngth
+Ëngth >ð¡r->
max_Ëngth
)

132 
size_t
 
Ãw_Ëngth
=(
¡r
->
Ëngth
+Ëngth+¡r->
®loc_šüem’t
)/

133 
¡r
->
®loc_šüem’t
;

134 
Ãw_Ëngth
*=
¡r
->
®loc_šüem’t
;

135 ià(!(
Ãw_±r
=(*è
	`»®loc
(
¡r
->¡r,
Ãw_Ëngth
)))

136  
TRUE
;

137 
¡r
->¡r=
Ãw_±r
;

138 
¡r
->
max_Ëngth
=
Ãw_Ëngth
;

140 
	`memýy
(
¡r
->¡¸+ sŒ->
Ëngth
,
­³nd
,length);

141 
¡r
->
Ëngth
+=length;

142 
¡r
->¡r[¡r->
Ëngth
]=0;

143  
FALSE
;

144 
	}
}

147 
	$ma_dyn¡r_ä“
(
DYNAMIC_STRING
 *
¡r
)

149 ià(
¡r
->str)

151 
	`ä“
(
¡r
->str);

152 
¡r
->str=0;

154 
	}
}

156 *
	$ma_¡rmake
(*
d¡
, cÚ¡ *
¤c
, 
size_t
 
Ëngth
)

158 
Ëngth
--)

159 ià(! (*
d¡
++ = *
¤c
++))

160  
d¡
-1;

161 *
d¡
=0;

162  
d¡
;

163 
	}
}

	@libmariadb/ma_time.c

23 
	~<ma_glob®.h
>

24 
	~<mysql.h
>

25 
	~<¡dio.h
>

28 
size_t
 
	$m¬Ÿdb_time_to_¡ršg
(cÚ¡ 
MYSQL_TIME
 *
tm
, *
time_¡r
, 
size_t
 
Ën
,

29 
dig™s
)

31 
size_t
 
Ëngth
;

33 ià(!
time_¡r
 || !
Ën
)

36 ià(
dig™s
 =ð
AUTO_SEC_PART_DIGITS
)

37 
dig™s
ð(
tm
->
£cÚd_·¹
è? 
SEC_PART_DIGITS
 : 0;

39 
tm
->
time_ty³
) {

40 
MYSQL_TIMESTAMP_DATE
:

41 
Ëngth
ð
	`¢´štf
(
time_¡r
, 
Ën
, "%04u-%02u-%02u", 
tm
->
y—r
,m->
mÚth
,m->
day
);

42 
dig™s
= 0;

44 
MYSQL_TIMESTAMP_DATETIME
:

45 
Ëngth
ð
	`¢´štf
(
time_¡r
, 
Ën
, "%04u-%02u-%02u %02u:%02u:%02u",

46 
tm
->
y—r
,m->
mÚth
,m->
day
,m->
hour
,m->
mšu‹
,m->
£cÚd
);

48 
MYSQL_TIMESTAMP_TIME
:

49 
Ëngth
ð
	`¢´štf
(
time_¡r
, 
Ën
, "%s%02u:%02u:%02u",

50 (
tm
->
Ãg
 ? "-" : ""),m->
hour
,m->
mšu‹
,m->
£cÚd
);

53 
time_¡r
[0]= '\0';

57 ià(
dig™s
 && (
Ën
 < 
Ëngth
))

59 
h–³r
[16];

60 
	`¢´štf
(
h–³r
, 16, ".%%0%du", 
dig™s
);

61 
Ëngth
+ð
	`¢´štf
(
time_¡r
 +†’gth, 
Ën
 -†’gth, 
h–³r
, 
dig™s
);

63  
Ëngth
;

64 
	}
}

	@libmariadb/ma_tls.c

33 #ifdeà
HAVE_TLS


35 
	~<ma_glob®.h
>

36 
	~<ma_sys.h
>

37 
	~<ma_commÚ.h
>

38 
	~<¡ršg.h
>

39 
	~<”rmsg.h
>

40 
	~<ma_pvio.h
>

41 
	~<ma_Žs.h
>

42 
	~<mysql/þ›Á_¶ugš.h
>

43 
	~<m¬Ÿdb/ma_io.h
>

45 #ifdeà
HAVE_NONBLOCK


46 
	~<m¬Ÿdb_async.h
>

47 
	~<ma_cÚ‹xt.h
>

51 
my_boÞ
 
	gma_Žs_š™Ÿlized
ð
FALSE
;

52 
	gm¬Ÿdb_deš™Ÿlize_s¦
= 1;

54 cÚ¡ *
	gŽs_´ÙocÞ_v”siÚ
[]=

57 
MARIADB_TLS
 *
	$ma_pvio_Žs_š™
(
MYSQL
 *
mysql
)

59 
MARIADB_TLS
 *
ùls
ð
NULL
;

61 ià(!
ma_Žs_š™Ÿlized
)

62 
	`ma_Žs_¡¬t
(
mysql
->
Ãt
.
Ï¡_”rÜ
, 
MYSQL_ERRMSG_SIZE
);

64 ià(!(
ùls
ð(
MARIADB_TLS
 *)
	`ÿÎoc
(1, (MARIADB_TLS))))

66  
NULL
;

70 
ùls
->
pvio
ð
mysql
->
Ãt
.pvio;

71 ià(!(
ùls
->
s¦
ð
	`ma_Žs_š™
(
mysql
)))

73 
	`ä“
(
ùls
);

74 
ùls
ð
NULL
;

76  
ùls
;

77 
	}
}

79 
my_boÞ
 
	$ma_pvio_Žs_cÚÃù
(
MARIADB_TLS
 *
ùls
)

81 
my_boÞ
 
rc
;

83 ià((
rc
ð
	`ma_Žs_cÚÃù
(
ùls
)))

84 
	`ma_Žs_þo£
(
ùls
);

85  
rc
;

86 
	}
}

88 
ssize_t
 
	$ma_pvio_Žs_»ad
(
MARIADB_TLS
 *
ùls
, cÚ¡ 
uch¬
* 
bufãr
, 
size_t
 
Ëngth
)

90  
	`ma_Žs_»ad
(
ùls
, 
bufãr
, 
Ëngth
);

91 
	}
}

93 
ssize_t
 
	$ma_pvio_Žs_wr™e
(
MARIADB_TLS
 *
ùls
, cÚ¡ 
uch¬
* 
bufãr
, 
size_t
 
Ëngth
)

95  
	`ma_Žs_wr™e
(
ùls
, 
bufãr
, 
Ëngth
);

96 
	}
}

98 
my_boÞ
 
	$ma_pvio_Žs_þo£
(
MARIADB_TLS
 *
ùls
)

100  
	`ma_Žs_þo£
(
ùls
);

101 
	}
}

103 
	$ma_pvio_Žs_v”ify_£rv”_û¹
(
MARIADB_TLS
 *
ùls
)

105  
	`ma_Žs_v”ify_£rv”_û¹
(
ùls
);

106 
	}
}

108 cÚ¡ *
	$ma_pvio_Žs_ch”
(
MARIADB_TLS
 *
ùls
)

110  
	`ma_Žs_g‘_ch”
(
ùls
);

111 
	}
}

113 
	$ma_pvio_Žs_’d
()

115 
	`ma_Žs_’d
();

116 
	}
}

118 
	$ma_pvio_Žs_g‘_´ÙocÞ_v”siÚ_id
(
MARIADB_TLS
 *
ùls
)

120  
	`ma_Žs_g‘_´ÙocÞ_v”siÚ
(
ùls
);

121 
	}
}

123 cÚ¡ *
	$ma_pvio_Žs_g‘_´ÙocÞ_v”siÚ
(
MARIADB_TLS
 *
ùls
)

125 
v”siÚ
;

127 
v”siÚ
ð
	`ma_Žs_g‘_´ÙocÞ_v”siÚ
(
ùls
);

128 ià(
v”siÚ
 < 0 || v”siÚ > 
PROTOCOL_MAX
)

129  
Žs_´ÙocÞ_v”siÚ
[
PROTOCOL_UNKNOWN
];

130  
Žs_´ÙocÞ_v”siÚ
[
v”siÚ
];

131 
	}
}

133 sigÃd 
	$ma_hex2št
(
c
)

135 ià(
c
 >= '0' && c <= '9')

136  
c
 - '0';

137 ià(
c
 >= 'A' && c <= 'F')

138  10 + 
c
 - 'A';

139 ià(
c
 >= 'a' && c <= 'f')

140  10 + 
c
 - 'a';

142 
	}
}

144 
my_boÞ
 
	$ma_pvio_Žs_com·»_å
(cÚ¡ *
û¹_å
,

145 
û¹_å_Ën
,

146 cÚ¡ *
å
, 
å_Ën
)

148 *
p
ð(*)
å
,

149 *
c
;

152 ià(
û¹_å_Ën
 != 20)

159 ià(
å_Ën
 !ð(
	`¡rchr
(
å
, ':') ? 59 : 40))

162 
c
ð(*)
û¹_å
; c < c”t_å + 
û¹_å_Ën
; c++)

164 sigÃd 
d1
, 
d2
;

165 ià(*
p
 == ':')

166 
p
++;

167 ià(
p
 - 
å
 > ()
å_Ën
 -1)

169 ià((
d1
 = 
	`ma_hex2št
(*
p
)) == - 1 ||

170 (
d2
 = 
	`ma_hex2št
(*(
p
+1))) == -1 ||

171 ()(
d1
 * 16 + 
d2
è!ð*
c
)

173 
p
+= 2;

176 
	}
}

178 
my_boÞ
 
	$ma_pvio_Žs_check_å
(
MARIADB_TLS
 *
ùls
, cÚ¡ *
å
, cÚ¡ *
å_li¡
)

180 
û¹_å_Ën
= 64;

181 *
û¹_å
ð
NULL
;

182 
my_boÞ
 
rc
=1;

183 
MYSQL
 *
mysql
ð
ùls
->
pvio
->mysql;

185 
û¹_å
ð(*)
	`m®loc
(
û¹_å_Ën
);

187 ià((
û¹_å_Ën
ð
	`ma_Žs_g‘_fšg”_´št
(
ùls
, 
û¹_å
, cert_fp_len)) < 1)

188 
’d
;

189 ià(
å
)

190 
rc
ð
	`ma_pvio_Žs_com·»_å
(
û¹_å
, 
û¹_å_Ën
, 
å
, ()
	`¡¾’
(fp));

191 ià(
å_li¡
)

193 
MA_FILE
 *
å
;

194 
buff
[255];

196 ià(!(
å
 = 
	`ma_Ý’
(
å_li¡
, "r", 
mysql
)))

197 
’d
;

199 
	`ma_g‘s
(
buff
, (buff)-1, 
å
))

202 *
pos
ð
	`¡rchr
(
buff
, '\r');

203 ià(!
pos
)

204 
pos
ð
	`¡rchr
(
buff
, '\n');

205 ià(
pos
)

206 *
pos
= '\0';

208 ià(!
	`ma_pvio_Žs_com·»_å
(
û¹_å
, 
û¹_å_Ën
, 
buff
, ()
	`¡¾’
(buff)))

211 
	`ma_þo£
(
å
);

212 
rc
= 0;

213 
’d
;

218 
	`ma_þo£
(
å
);

221 
’d
:

222 ià(
û¹_å
)

223 
	`ä“
(
û¹_å
);

224 ià(
rc
)

226 
	`my_£t_”rÜ
(
mysql
, 
CR_SSL_CONNECTION_ERROR
, 
SQLSTATE_UNKNOWN
,

227 
	`ER
(
CR_SSL_CONNECTION_ERROR
),

230  
rc
;

231 
	}
}

	@libmariadb/mariadb_async.c

23 
	~"ma_glob®.h
"

24 
	~"ma_sys.h
"

25 
	~"mysql.h
"

26 
	~"”rmsg.h
"

27 #iâdeà
LIBMARIADB


28 
	~"sql_commÚ.h
"

30 
	~"ma_commÚ.h
"

32 
	~"ma_cÚ‹xt.h
"

33 
	~"ma_pvio.h
"

34 
	~"m¬Ÿdb_async.h
"

35 
	~<¡ršg.h
>

38 #ifdeà
_WIN32


43 
	#WIN_SET_NONBLOCKING
(
mysql
) do { \

44 
my_boÞ
 
Þd_mode
; \

45 ià((
mysql
)->
Ãt
.
pvio
è
	`ma_pvio_blockšg
((mysql)->Ãt.pvio, 
FALSE
, &
Þd_mode
); \

46 } 0);

	)

48 
	#WIN_SET_NONBLOCKING
(
mysql
)

	)

51 
mysql_þo£_¦ow_·¹
(
MYSQL
 *
mysql
);

55 
my_cÚ‹xt_š¡®l_su¥’d_»sume_hook
(
mysql_async_cÚ‹xt
 *
b
,

56 (*
hook
)(
my_boÞ
, *),

57 *
u£r_d©a
)

59 
b
->
su¥’d_»sume_hook
ð
hook
;

60 
b
->
su¥’d_»sume_hook_u£r_d©a
ð
u£r_d©a
;

61 
	}
}

66 
	$my_cÚÃù_async
(
MARIADB_PVIO
 *
pvio
,

67 cÚ¡ 
sockaddr
 *
Çme
, 
ušt
 
Çm–’
, 
vio_timeout
)

69 
»s
;

70 
size_sock‘
 
s_”r_size
;

71 
mysql_async_cÚ‹xt
 *
b
ð
pvio
->
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
async_cÚ‹xt
;

72 
my_sock‘
 
sock
;

74 
	`ma_pvio_g‘_hªdË
(
pvio
, &
sock
);

77 
	`ma_pvio_blockšg
(
pvio
, 0, 0);

79 
b
->
ev’ts_to_wa™_fÜ
= 0;

86 
»s
ð
	`cÚÃù
(
sock
, 
Çme
, 
Çm–’
);

87 ià(
»s
 != 0)

89 #ifdeà
_WIN32


90 
w§_”r
ð
	`WSAG‘La¡E¼Ü
();

91 ià(
w§_”r
 !ð
WSAEWOULDBLOCK
)

92  
»s
;

93 
b
->
ev’ts_to_wa™_fÜ
|ð
MYSQL_WAIT_EXCEPT
;

95 
”r
ð
”ºo
;

96 ià(
”r
 !ð
EINPROGRESS
 &&ƒ¼ !ð
EALREADY
 &&ƒ¼ !ð
EAGAIN
)

97  
»s
;

99 
b
->
ev’ts_to_wa™_fÜ
|ð
MYSQL_WAIT_WRITE
;

100 ià(
vio_timeout
 >= 0)

102 
b
->
timeout_v®ue
ð
vio_timeout
;

103 
b
->
ev’ts_to_wa™_fÜ
|ð
MYSQL_WAIT_TIMEOUT
;

106 
b
->
timeout_v®ue
= 0;

107 ià(
b
->
su¥’d_»sume_hook
)

108 (*
b
->
su¥’d_»sume_hook
)(
TRUE
, b->
su¥’d_»sume_hook_u£r_d©a
);

109 
	`my_cÚ‹xt_y›ld
(&
b
->
async_cÚ‹xt
);

110 ià(
b
->
su¥’d_»sume_hook
)

111 (*
b
->
su¥’d_»sume_hook
)(
FALSE
, b->
su¥’d_»sume_hook_u£r_d©a
);

112 ià(
b
->
ev’ts_occu»d
 & 
MYSQL_WAIT_TIMEOUT
)

115 
s_”r_size
ð(
»s
);

116 ià(
	`g‘sockÝt
(
sock
, 
SOL_SOCKET
, 
SO_ERROR
, (*è&
»s
, &
s_”r_size
) != 0)

118 ià(
»s
)

120 
”ºo
ð
»s
;

124  
»s
;

125 
	}
}

127 
	#IS_BLOCKING_ERROR
() \

128 
	`IF_WIN
(
	`WSAG‘La¡E¼Ü
(è!ð
WSAEWOULDBLOCK
, \

129 (
”ºo
 !ð
EAGAIN
 &&ƒ¼nØ!ð
EINTR
))

	)

131 #ifdeà
_AIX


132 #iâdeà
MSG_DONTWAIT


133 
	#MSG_DONTWAIT
 0

	)

137 #ifdeà
HAVE_TLS_FIXME


138 
my_boÞ


139 
	$my_s¦_async_check_»suÉ
(
»s
, 
mysql_async_cÚ‹xt
 *
b
, 
MARIADB_SSL
 *
cs¦
)

141 
s¦_”r
;

142 
b
->
ev’ts_to_wa™_fÜ
= 0;

143 ià(
»s
 >= 0)

145 
s¦_”r
ð
	`SSL_g‘_”rÜ
(
s¦
, 
»s
);

146 ià(
s¦_”r
 =ð
SSL_ERROR_WANT_READ
)

147 
b
->
ev’ts_to_wa™_fÜ
|ð
MYSQL_WAIT_READ
;

148 ià(
s¦_”r
 =ð
SSL_ERROR_WANT_WRITE
)

149 
b
->
ev’ts_to_wa™_fÜ
|ð
MYSQL_WAIT_WRITE
;

152 ià(
b
->
su¥’d_»sume_hook
)

153 (*
b
->
su¥’d_»sume_hook
)(
TRUE
, b->
su¥’d_»sume_hook_u£r_d©a
);

154 
	`my_cÚ‹xt_y›ld
(&
b
->
async_cÚ‹xt
);

155 ià(
b
->
su¥’d_»sume_hook
)

156 (*
b
->
su¥’d_»sume_hook
)(
FALSE
, b->
su¥’d_»sume_hook_u£r_d©a
);

158 
	}
}

161 
	$my_s¦_»ad_async
(
mysql_async_cÚ‹xt
 *
b
, 
SSL
 *
s¦
,

162 *
buf
, 
size
)

164 
»s
;

168 
»s
ð
	`SSL_»ad
(
s¦
, 
buf
, 
size
);

169 ià(
	`my_s¦_async_check_»suÉ
(
»s
, 
b
, 
s¦
))

170  
»s
;

172 
	}
}

175 
	$my_s¦_wr™e_async
(
mysql_async_cÚ‹xt
 *
b
, 
SSL
 *
s¦
,

176 cÚ¡ *
buf
, 
size
)

178 
»s
;

182 
»s
ð
	`SSL_wr™e
(
s¦
, 
buf
, 
size
);

183 ià(
	`my_s¦_async_check_»suÉ
(
»s
, 
b
, 
s¦
))

184  
»s
;

186 
	}
}

202 
	#MK_ASYNC_INTERNAL_BODY
(
ÿÎ
, 
švoke_¬gs
, 
mysql_v®
, 
»t_ty³
, 
ok_v®
)\

203 
ÿÎ
 ## 
_·¿ms
 *
·rms
ð(ÿÎ ## _·¿m *)
d
; \

204 
»t_ty³
 
»t
; \

205 
mysql_async_cÚ‹xt
 *
b
= \

206 (
mysql_v®
)->
ÝtiÚs
.
ex‹nsiÚ
->
async_cÚ‹xt
; \

208 
»t
ð
ÿÎ
 
švoke_¬gs
; \

209 
b
->
»t_»suÉ
. 
ok_v®
 = 
»t
; \

210 
b
->
ev’ts_to_wa™_fÜ
ð0;

	)

212 
	#MK_ASYNC_START_BODY
(
ÿÎ
, 
mysql_v®
, 
·rms_assign
, 
”r_v®
, 
ok_v®
, 
exŒa1
) \

213 
»s
; \

214 
mysql_async_cÚ‹xt
 *
b
; \

215 
ÿÎ
 ## 
_·¿ms
 
·rms
; \

217 
exŒa1
 \

218 
b
ð
mysql_v®
->
ÝtiÚs
.
ex‹nsiÚ
->
async_cÚ‹xt
; \

219 
·rms_assign
 \

221 
b
->
aùive
= 1; \

222 
»s
ð
	`my_cÚ‹xt_¥awn
(&
b
->
async_cÚ‹xt
, 
ÿÎ
 ## 
_¡¬t_š‹º®
, &
·rms
); \

223 
b
->
aùive
ðb->
su¥’ded
= 0; \

224 ià(
»s
 > 0) \

227 
b
->
su¥’ded
= 1; \

228  
b
->
ev’ts_to_wa™_fÜ
; \

230 ià(
»s
 < 0) \

232 
	`£t_m¬Ÿdb_”rÜ
((
mysql_v®
), 
CR_OUT_OF_MEMORY
, 
unknown_sql¡©e
); \

233 *
»t
ð
”r_v®
; \

236 *
»t
ð
b
->
»t_»suÉ
. 
ok_v®
; \

237  0;

	)

239 
	#MK_ASYNC_CONT_BODY
(
mysql_v®
, 
”r_v®
, 
ok_v®
) \

240 
»s
; \

241 
mysql_async_cÚ‹xt
 *
b
= \

242 (
mysql_v®
)->
ÝtiÚs
.
ex‹nsiÚ
->
async_cÚ‹xt
; \

243 ià(!
b
->
su¥’ded
) \

245 
	`£t_m¬Ÿdb_”rÜ
((
mysql_v®
), 
CR_COMMANDS_OUT_OF_SYNC
, 
unknown_sql¡©e
); \

246 *
»t
ð
”r_v®
; \

250 
b
->
aùive
= 1; \

251 
b
->
ev’ts_occu»d
ð
»ady_¡©us
; \

252 
»s
ð
	`my_cÚ‹xt_cÚtšue
(&
b
->
async_cÚ‹xt
); \

253 
b
->
aùive
= 0; \

254 ià(
»s
 > 0) \

255  
b
->
ev’ts_to_wa™_fÜ
; \

256 
b
->
su¥’ded
= 0; \

257 ià(
»s
 < 0) \

259 
	`£t_m¬Ÿdb_”rÜ
((
mysql_v®
), 
CR_OUT_OF_MEMORY
, 
unknown_sql¡©e
); \

260 *
»t
ð
”r_v®
; \

263 *
»t
ð
b
->
»t_»suÉ
. 
ok_v®
; \

264  0;

	)

266 
	#MK_ASYNC_INTERNAL_BODY_VOID_RETURN
(
ÿÎ
, 
švoke_¬gs
, 
mysql_v®
) \

267 
ÿÎ
 ## 
_·¿ms
 *
·rms
ð(ÿÎ ## _·¿m *)
d
; \

268 
mysql_async_cÚ‹xt
 *
b
= \

269 (
mysql_v®
)->
ÝtiÚs
.
ex‹nsiÚ
->
async_cÚ‹xt
; \

271 
ÿÎ
 
švoke_¬gs
; \

272 
b
->
ev’ts_to_wa™_fÜ
ð0;

	)

274 
	#MK_ASYNC_START_BODY_VOID_RETURN
(
ÿÎ
, 
mysql_v®
, 
·rms_assign
, 
exŒa1
)\

275 
»s
; \

276 
mysql_async_cÚ‹xt
 *
b
; \

277 
ÿÎ
 ## 
_·¿ms
 
·rms
; \

279 
exŒa1
 \

280 
b
ð
mysql_v®
->
ÝtiÚs
.
ex‹nsiÚ
->
async_cÚ‹xt
; \

281 
·rms_assign
 \

283 
b
->
aùive
= 1; \

284 
»s
ð
	`my_cÚ‹xt_¥awn
(&
b
->
async_cÚ‹xt
, 
ÿÎ
 ## 
_¡¬t_š‹º®
, &
·rms
); \

285 
b
->
aùive
ðb->
su¥’ded
= 0; \

286 ià(
»s
 > 0) \

289 
b
->
su¥’ded
= 1; \

290  
b
->
ev’ts_to_wa™_fÜ
; \

292 ià(
»s
 < 0) \

293 
	`£t_m¬Ÿdb_”rÜ
((
mysql_v®
), 
CR_OUT_OF_MEMORY
, 
unknown_sql¡©e
); \

294  0;

	)

296 
	#MK_ASYNC_CONT_BODY_VOID_RETURN
(
mysql_v®
) \

297 
»s
; \

298 
mysql_async_cÚ‹xt
 *
b
= \

299 (
mysql_v®
)->
ÝtiÚs
.
ex‹nsiÚ
->
async_cÚ‹xt
; \

300 ià(!
b
->
su¥’ded
) \

302 
	`£t_m¬Ÿdb_”rÜ
((
mysql_v®
), 
CR_COMMANDS_OUT_OF_SYNC
, 
unknown_sql¡©e
); \

306 
b
->
aùive
= 1; \

307 
b
->
ev’ts_occu»d
ð
»ady_¡©us
; \

308 
»s
ð
	`my_cÚ‹xt_cÚtšue
(&
b
->
async_cÚ‹xt
); \

309 
b
->
aùive
= 0; \

310 ià(
»s
 > 0) \

311  
b
->
ev’ts_to_wa™_fÜ
; \

312 
b
->
su¥’ded
= 0; \

313 ià(
»s
 < 0) \

314 
	`£t_m¬Ÿdb_”rÜ
((
mysql_v®
), 
CR_OUT_OF_MEMORY
, 
unknown_sql¡©e
); \

315  0;

	)

319 
	smysql_»®_cÚÃù_·¿ms
 {

320 
MYSQL
 *
	mmysql
;

321 cÚ¡ *
	mho¡
;

322 cÚ¡ *
	mu£r
;

323 cÚ¡ *
	m·sswd
;

324 cÚ¡ *
	mdb
;

325 
	mpÜt
;

326 cÚ¡ *
	munix_sock‘
;

327 
	mþ›Á_æags
;

330 
	$mysql_»®_cÚÃù_¡¬t_š‹º®
(*
d
)

332 
	`MK_ASYNC_INTERNAL_BODY
(

333 
mysql_»®_cÚÃù
,

334 (
·rms
->
mysql
,…¬ms->
ho¡
,…¬ms->
u£r
,…¬ms->
·sswd
,…¬ms->
db
,

335 
·rms
->
pÜt
,…¬ms->
unix_sock‘
,…¬ms->
þ›Á_æags
),

336 
·rms
->
mysql
,

337 
MYSQL
 *,

338 
r_±r
)

339 
	}
}

340 
STDCALL


341 
	$mysql_»®_cÚÃù_¡¬t
(
MYSQL
 **
»t
, MYSQL *
mysql
, cÚ¡ *
ho¡
,

342 cÚ¡ *
u£r
, cÚ¡ *
·sswd
, cÚ¡ *
db
,

343 
pÜt
, cÚ¡ *
unix_sock‘
,

344 
þ›Á_æags
)

346 
	`MK_ASYNC_START_BODY
(

347 
mysql_»®_cÚÃù
,

348 
mysql
,

350 
·rms
.
mysql
= mysql;

351 
·rms
.
ho¡
= host;

352 
·rms
.
u£r
= user;

353 
·rms
.
·sswd
=…asswd;

354 
·rms
.
db
= db;

355 
·rms
.
pÜt
=…ort;

356 
·rms
.
unix_sock‘
= unix_socket;

357 
·rms
.
þ›Á_æags
ðþ›Á_æag | 
CLIENT_REMEMBER_OPTIONS
;

359 
NULL
,

360 
r_±r
,

362 
	}
}

363 
STDCALL


364 
	$mysql_»®_cÚÃù_cÚt
(
MYSQL
 **
»t
, MYSQL *
mysql
, 
»ady_¡©us
)

366 
	`MK_ASYNC_CONT_BODY
(

367 
mysql
,

368 
NULL
,

369 
r_±r
)

370 
	}
}

373 
	smysql_»®_qu”y_·¿ms
 {

374 
MYSQL
 *
	mmysql
;

375 cÚ¡ *
	m¡mt_¡r
;

376 
	mËngth
;

379 
	$mysql_»®_qu”y_¡¬t_š‹º®
(*
d
)

381 
	`MK_ASYNC_INTERNAL_BODY
(

382 
mysql_»®_qu”y
,

383 (
·rms
->
mysql
,…¬ms->
¡mt_¡r
,…¬ms->
Ëngth
),

384 
·rms
->
mysql
,

386 
r_št
)

387 
	}
}

388 
STDCALL


389 
	$mysql_»®_qu”y_¡¬t
(*
»t
, 
MYSQL
 *
mysql
, cÚ¡ *
¡mt_¡r
, 
Ëngth
)

391 
»s
;

392 
mysql_async_cÚ‹xt
 *
b
;

393 
mysql_»®_qu”y_·¿ms
 
·rms
;

395 
b
ð
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
async_cÚ‹xt
;

397 
	`WIN_SET_NONBLOCKING
(
mysql
)

398 
·rms
.
mysql
= mysql;

399 
·rms
.
¡mt_¡r
= stmt_str;

400 
·rms
.
Ëngth
=†ength;

403 
b
->
aùive
= 1;

404 
»s
ð
	`my_cÚ‹xt_¥awn
(&
b
->
async_cÚ‹xt
, 
mysql_»®_qu”y_¡¬t_š‹º®
, &
·rms
);

405 
b
->
aùive
ðb->
su¥’ded
= 0;

406 ià(
»s
 > 0)

409 
b
->
su¥’ded
= 1;

410  
b
->
ev’ts_to_wa™_fÜ
;

412 ià(
»s
 < 0)

414 
	`£t_m¬Ÿdb_”rÜ
((
mysql
), 
CR_OUT_OF_MEMORY
, 
unknown_sql¡©e
);

415 *
»t
= 1;

418 *
»t
ð
b
->
»t_»suÉ
.
r_št
;

421 
	}
}

422 
STDCALL


423 
	$mysql_»®_qu”y_cÚt
(*
»t
, 
MYSQL
 *
mysql
, 
»ady_¡©us
)

425 
	`MK_ASYNC_CONT_BODY
(

426 
mysql
,

428 
r_št
)

429 
	}
}

432 
	smysql_ãtch_row_·¿ms
 {

433 
MYSQL_RES
 *
	m»suÉ
;

436 
	$mysql_ãtch_row_¡¬t_š‹º®
(*
d
)

438 
	`MK_ASYNC_INTERNAL_BODY
(

439 
mysql_ãtch_row
,

440 (
·rms
->
»suÉ
),

441 
·rms
->
»suÉ
->
hªdË
,

442 
MYSQL_ROW
,

443 
r_±r
)

444 
	}
}

445 
STDCALL


446 
	$mysql_ãtch_row_¡¬t
(
MYSQL_ROW
 *
»t
, 
MYSQL_RES
 *
»suÉ
)

448 
	`MK_ASYNC_START_BODY
(

449 
mysql_ãtch_row
,

450 
»suÉ
->
hªdË
,

452 
	`WIN_SET_NONBLOCKING
(
»suÉ
->
hªdË
)

453 
·rms
.
»suÉ
=„esult;

455 
NULL
,

456 
r_±r
,

463 ià(!
»suÉ
->
hªdË
)

465 *
»t
ð
	`mysql_ãtch_row
(
»suÉ
);

468 
	}
}

469 
STDCALL


470 
	$mysql_ãtch_row_cÚt
(
MYSQL_ROW
 *
»t
, 
MYSQL_RES
 *
»suÉ
, 
»ady_¡©us
)

472 
	`MK_ASYNC_CONT_BODY
(

473 
»suÉ
->
hªdË
,

474 
NULL
,

475 
r_±r
)

476 
	}
}

479 
	smysql_£t_ch¬aù”_£t_·¿ms
 {

480 
MYSQL
 *
	mmysql
;

481 cÚ¡ *
	mc¢ame
;

484 
	$mysql_£t_ch¬aù”_£t_¡¬t_š‹º®
(*
d
)

486 
	`MK_ASYNC_INTERNAL_BODY
(

487 
mysql_£t_ch¬aù”_£t
,

488 (
·rms
->
mysql
,…¬ms->
c¢ame
),

489 
·rms
->
mysql
,

491 
r_št
)

492 
	}
}

493 
STDCALL


494 
	$mysql_£t_ch¬aù”_£t_¡¬t
(*
»t
, 
MYSQL
 *
mysql
, cÚ¡ *
c¢ame
)

496 
	`MK_ASYNC_START_BODY
(

497 
mysql_£t_ch¬aù”_£t
,

498 
mysql
,

500 
	`WIN_SET_NONBLOCKING
(
mysql
)

501 
·rms
.
mysql
= mysql;

502 
·rms
.
c¢ame
= csname;

505 
r_št
,

507 
	}
}

508 
STDCALL


509 
	$mysql_£t_ch¬aù”_£t_cÚt
(*
»t
, 
MYSQL
 *
mysql
, 
»ady_¡©us
)

511 
	`MK_ASYNC_CONT_BODY
(

512 
mysql
,

514 
r_št
)

515 
	}
}

518 
	smysql_£Ëù_db_·¿ms
 {

519 
MYSQL
 *
	mmysql
;

520 cÚ¡ *
	mdb
;

523 
	$mysql_£Ëù_db_¡¬t_š‹º®
(*
d
)

525 
	`MK_ASYNC_INTERNAL_BODY
(

526 
mysql_£Ëù_db
,

527 (
·rms
->
mysql
,…¬ms->
db
),

528 
·rms
->
mysql
,

530 
r_št
)

531 
	}
}

532 
STDCALL


533 
	$mysql_£Ëù_db_¡¬t
(*
»t
, 
MYSQL
 *
mysql
, cÚ¡ *
db
)

535 
	`MK_ASYNC_START_BODY
(

536 
mysql_£Ëù_db
,

537 
mysql
,

539 
	`WIN_SET_NONBLOCKING
(
mysql
)

540 
·rms
.
mysql
= mysql;

541 
·rms
.
db
= db;

544 
r_št
,

546 
	}
}

547 
STDCALL


548 
	$mysql_£Ëù_db_cÚt
(*
»t
, 
MYSQL
 *
mysql
, 
»ady_¡©us
)

550 
	`MK_ASYNC_CONT_BODY
(

551 
mysql
,

553 
r_št
)

554 
	}
}

557 
	smysql_£nd_qu”y_·¿ms
 {

558 
MYSQL
 *
	mmysql
;

559 cÚ¡ *
	mq
;

560 
	mËngth
;

563 
	$mysql_£nd_qu”y_¡¬t_š‹º®
(*
d
)

565 
	`MK_ASYNC_INTERNAL_BODY
(

566 
mysql_£nd_qu”y
,

567 (
·rms
->
mysql
,…¬ms->
q
,…¬ms->
Ëngth
),

568 
·rms
->
mysql
,

570 
r_št
)

571 
	}
}

572 
STDCALL


573 
	$mysql_£nd_qu”y_¡¬t
(*
»t
, 
MYSQL
 *
mysql
, cÚ¡ *
q
, 
Ëngth
)

575 
	`MK_ASYNC_START_BODY
(

576 
mysql_£nd_qu”y
,

577 
mysql
,

579 
	`WIN_SET_NONBLOCKING
(
mysql
)

580 
·rms
.
mysql
= mysql;

581 
·rms
.
q
= q;

582 
·rms
.
Ëngth
=†ength;

585 
r_št
,

587 
	}
}

588 
STDCALL


589 
	$mysql_£nd_qu”y_cÚt
(*
»t
, 
MYSQL
 *
mysql
, 
»ady_¡©us
)

591 
	`MK_ASYNC_CONT_BODY
(

592 
mysql
,

594 
r_št
)

595 
	}
}

598 
	smysql_¡Üe_»suÉ_·¿ms
 {

599 
MYSQL
 *
	mmysql
;

602 
	$mysql_¡Üe_»suÉ_¡¬t_š‹º®
(*
d
)

604 
	`MK_ASYNC_INTERNAL_BODY
(

605 
mysql_¡Üe_»suÉ
,

606 (
·rms
->
mysql
),

607 
·rms
->
mysql
,

608 
MYSQL_RES
 *,

609 
r_±r
)

610 
	}
}

611 
STDCALL


612 
	$mysql_¡Üe_»suÉ_¡¬t
(
MYSQL_RES
 **
»t
, 
MYSQL
 *
mysql
)

614 
	`MK_ASYNC_START_BODY
(

615 
mysql_¡Üe_»suÉ
,

616 
mysql
,

618 
	`WIN_SET_NONBLOCKING
(
mysql
)

619 
·rms
.
mysql
= mysql;

621 
NULL
,

622 
r_±r
,

624 
	}
}

625 
STDCALL


626 
	$mysql_¡Üe_»suÉ_cÚt
(
MYSQL_RES
 **
»t
, 
MYSQL
 *
mysql
, 
»ady_¡©us
)

628 
	`MK_ASYNC_CONT_BODY
(

629 
mysql
,

630 
NULL
,

631 
r_±r
)

632 
	}
}

635 
	smysql_ä“_»suÉ_·¿ms
 {

636 
MYSQL_RES
 *
	m»suÉ
;

639 
	$mysql_ä“_»suÉ_¡¬t_š‹º®
(*
d
)

641 
	`MK_ASYNC_INTERNAL_BODY_VOID_RETURN
(

642 
mysql_ä“_»suÉ
,

643 (
·rms
->
»suÉ
),

644 
·rms
->
»suÉ
->
hªdË
)

645 
	}
}

646 
STDCALL


647 
	$mysql_ä“_»suÉ_¡¬t
(
MYSQL_RES
 *
»suÉ
)

649 
	`MK_ASYNC_START_BODY_VOID_RETURN
(

650 
mysql_ä“_»suÉ
,

651 
»suÉ
->
hªdË
,

653 
	`WIN_SET_NONBLOCKING
(
»suÉ
->
hªdË
)

654 
·rms
.
»suÉ
=„esult;

663 ià(!
»suÉ
 || !»suÉ->
hªdË
)

665 
	`mysql_ä“_»suÉ
(
»suÉ
);

668 
	}
}

669 
STDCALL


670 
	$mysql_ä“_»suÉ_cÚt
(
MYSQL_RES
 *
»suÉ
, 
»ady_¡©us
)

672 
	`MK_ASYNC_CONT_BODY_VOID_RETURN
(
»suÉ
->
hªdË
)

673 
	}
}

676 
	smysql_þo£_¦ow_·¹_·¿ms
 {

677 
MYSQL
 *
	msock
;

687 
	$mysql_þo£_¦ow_·¹_¡¬t_š‹º®
(*
d
)

689 
	`MK_ASYNC_INTERNAL_BODY_VOID_RETURN
(

690 
mysql_þo£_¦ow_·¹
,

691 (
·rms
->
sock
),

692 
·rms
->
sock
)

693 
	}
}

695 
STDCALL


696 
	$mysql_þo£_¦ow_·¹_¡¬t
(
MYSQL
 *
sock
)

698 
	`MK_ASYNC_START_BODY_VOID_RETURN
(

699 
mysql_þo£_¦ow_·¹
,

700 
sock
,

702 
	`WIN_SET_NONBLOCKING
(
sock
)

703 
·rms
.
sock
= sock;

706 
	}
}

707 
STDCALL


708 
	$mysql_þo£_¦ow_·¹_cÚt
(
MYSQL
 *
sock
, 
»ady_¡©us
)

710 
	`MK_ASYNC_CONT_BODY_VOID_RETURN
(
sock
)

711 
	}
}

712 
STDCALL


713 
	$mysql_þo£_¡¬t
(
MYSQL
 *
sock
)

715 
»s
;

718 ià(
sock
 && sock->
Ãt
.
pvio
)

720 
»s
ð
	`mysql_þo£_¦ow_·¹_¡¬t
(
sock
);

722 ià(
»s
)

723  
»s
;

725 
	`mysql_þo£
(
sock
);

727 
	}
}

728 
STDCALL


729 
	$mysql_þo£_cÚt
(
MYSQL
 *
sock
, 
»ady_¡©us
)

731 
»s
;

733 
»s
ð
	`mysql_þo£_¦ow_·¹_cÚt
(
sock
, 
»ady_¡©us
);

734 ià(
»s
)

735  
»s
;

736 
	`mysql_þo£
(
sock
);

738 
	}
}

744 #iâdeà
MYSQL_SERVER


746 
	smysql_chªge_u£r_·¿ms
 {

747 
MYSQL
 *
	mmysql
;

748 cÚ¡ *
	mu£r
;

749 cÚ¡ *
	m·sswd
;

750 cÚ¡ *
	mdb
;

753 
	$mysql_chªge_u£r_¡¬t_š‹º®
(*
d
)

755 
	`MK_ASYNC_INTERNAL_BODY
(

756 
mysql_chªge_u£r
,

757 (
·rms
->
mysql
,…¬ms->
u£r
,…¬ms->
·sswd
,…¬ms->
db
),

758 
·rms
->
mysql
,

759 
my_boÞ
,

760 
r_my_boÞ
)

761 
	}
}

762 
STDCALL


763 
	$mysql_chªge_u£r_¡¬t
(
my_boÞ
 *
»t
, 
MYSQL
 *
mysql
, cÚ¡ *
u£r
, cÚ¡ *
·sswd
, cÚ¡ *
db
)

765 
	`MK_ASYNC_START_BODY
(

766 
mysql_chªge_u£r
,

767 
mysql
,

769 
	`WIN_SET_NONBLOCKING
(
mysql
)

770 
·rms
.
mysql
= mysql;

771 
·rms
.
u£r
= user;

772 
·rms
.
·sswd
=…asswd;

773 
·rms
.
db
= db;

775 
TRUE
,

776 
r_my_boÞ
,

778 
	}
}

779 
STDCALL


780 
	$mysql_chªge_u£r_cÚt
(
my_boÞ
 *
»t
, 
MYSQL
 *
mysql
, 
»ady_¡©us
)

782 
	`MK_ASYNC_CONT_BODY
(

783 
mysql
,

784 
TRUE
,

785 
r_my_boÞ
)

786 
	}
}

789 
	smysql_qu”y_·¿ms
 {

790 
MYSQL
 *
	mmysql
;

791 cÚ¡ *
	mq
;

794 
	$mysql_qu”y_¡¬t_š‹º®
(*
d
)

796 
	`MK_ASYNC_INTERNAL_BODY
(

797 
mysql_qu”y
,

798 (
·rms
->
mysql
,…¬ms->
q
),

799 
·rms
->
mysql
,

801 
r_št
)

802 
	}
}

803 
STDCALL


804 
	$mysql_qu”y_¡¬t
(*
»t
, 
MYSQL
 *
mysql
, cÚ¡ *
q
)

806 
	`MK_ASYNC_START_BODY
(

807 
mysql_qu”y
,

808 
mysql
,

810 
	`WIN_SET_NONBLOCKING
(
mysql
)

811 
·rms
.
mysql
= mysql;

812 
·rms
.
q
= q;

815 
r_št
,

817 
	}
}

818 
STDCALL


819 
	$mysql_qu”y_cÚt
(*
»t
, 
MYSQL
 *
mysql
, 
»ady_¡©us
)

821 
	`MK_ASYNC_CONT_BODY
(

822 
mysql
,

824 
r_št
)

825 
	}
}

828 
	smysql_shutdown_·¿ms
 {

829 
MYSQL
 *
	mmysql
;

830 
mysql_’um_shutdown_Ëv–
 
	mshutdown_Ëv–
;

833 
	$mysql_shutdown_¡¬t_š‹º®
(*
d
)

835 
	`MK_ASYNC_INTERNAL_BODY
(

836 
mysql_shutdown
,

837 (
·rms
->
mysql
,…¬ms->
shutdown_Ëv–
),

838 
·rms
->
mysql
,

840 
r_št
)

841 
	}
}

842 
STDCALL


843 
	$mysql_shutdown_¡¬t
(*
»t
, 
MYSQL
 *
mysql
, 
mysql_’um_shutdown_Ëv–
 
shutdown_Ëv–
)

845 
	`MK_ASYNC_START_BODY
(

846 
mysql_shutdown
,

847 
mysql
,

849 
	`WIN_SET_NONBLOCKING
(
mysql
)

850 
·rms
.
mysql
= mysql;

851 
·rms
.
shutdown_Ëv–
= shutdown_level;

854 
r_št
,

856 
	}
}

857 
STDCALL


858 
	$mysql_shutdown_cÚt
(*
»t
, 
MYSQL
 *
mysql
, 
»ady_¡©us
)

860 
	`MK_ASYNC_CONT_BODY
(

861 
mysql
,

863 
r_št
)

864 
	}
}

867 
	smysql_dump_debug_šfo_·¿ms
 {

868 
MYSQL
 *
	mmysql
;

871 
	$mysql_dump_debug_šfo_¡¬t_š‹º®
(*
d
)

873 
	`MK_ASYNC_INTERNAL_BODY
(

874 
mysql_dump_debug_šfo
,

875 (
·rms
->
mysql
),

876 
·rms
->
mysql
,

878 
r_št
)

879 
	}
}

880 
STDCALL


881 
	$mysql_dump_debug_šfo_¡¬t
(*
»t
, 
MYSQL
 *
mysql
)

883 
	`MK_ASYNC_START_BODY
(

884 
mysql_dump_debug_šfo
,

885 
mysql
,

887 
	`WIN_SET_NONBLOCKING
(
mysql
)

888 
·rms
.
mysql
= mysql;

891 
r_št
,

893 
	}
}

894 
STDCALL


895 
	$mysql_dump_debug_šfo_cÚt
(*
»t
, 
MYSQL
 *
mysql
, 
»ady_¡©us
)

897 
	`MK_ASYNC_CONT_BODY
(

898 
mysql
,

900 
r_št
)

901 
	}
}

904 
	smysql_»äesh_·¿ms
 {

905 
MYSQL
 *
	mmysql
;

906 
	m»äesh_ÝtiÚs
;

909 
	$mysql_»äesh_¡¬t_š‹º®
(*
d
)

911 
	`MK_ASYNC_INTERNAL_BODY
(

912 
mysql_»äesh
,

913 (
·rms
->
mysql
,…¬ms->
»äesh_ÝtiÚs
),

914 
·rms
->
mysql
,

916 
r_št
)

917 
	}
}

918 
STDCALL


919 
	$mysql_»äesh_¡¬t
(*
»t
, 
MYSQL
 *
mysql
, 
»äesh_ÝtiÚs
)

921 
	`MK_ASYNC_START_BODY
(

922 
mysql_»äesh
,

923 
mysql
,

925 
	`WIN_SET_NONBLOCKING
(
mysql
)

926 
·rms
.
mysql
= mysql;

927 
·rms
.
»äesh_ÝtiÚs
=„efresh_options;

930 
r_št
,

932 
	}
}

933 
STDCALL


934 
	$mysql_»äesh_cÚt
(*
»t
, 
MYSQL
 *
mysql
, 
»ady_¡©us
)

936 
	`MK_ASYNC_CONT_BODY
(

937 
mysql
,

939 
r_št
)

940 
	}
}

943 
	smysql_kžl_·¿ms
 {

944 
MYSQL
 *
	mmysql
;

945 
	mpid
;

948 
	$mysql_kžl_¡¬t_š‹º®
(*
d
)

950 
	`MK_ASYNC_INTERNAL_BODY
(

951 
mysql_kžl
,

952 (
·rms
->
mysql
,…¬ms->
pid
),

953 
·rms
->
mysql
,

955 
r_št
)

956 
	}
}

957 
STDCALL


958 
	$mysql_kžl_¡¬t
(*
»t
, 
MYSQL
 *
mysql
, 
pid
)

960 
	`MK_ASYNC_START_BODY
(

961 
mysql_kžl
,

962 
mysql
,

964 
	`WIN_SET_NONBLOCKING
(
mysql
)

965 
·rms
.
mysql
= mysql;

966 
·rms
.
pid
=…id;

969 
r_št
,

971 
	}
}

972 
STDCALL


973 
	$mysql_kžl_cÚt
(*
»t
, 
MYSQL
 *
mysql
, 
»ady_¡©us
)

975 
	`MK_ASYNC_CONT_BODY
(

976 
mysql
,

978 
r_št
)

979 
	}
}

982 
	smysql_£t_£rv”_ÝtiÚ_·¿ms
 {

983 
MYSQL
 *
	mmysql
;

984 
’um_mysql_£t_ÝtiÚ
 
	mÝtiÚ
;

987 
	$mysql_£t_£rv”_ÝtiÚ_¡¬t_š‹º®
(*
d
)

989 
	`MK_ASYNC_INTERNAL_BODY
(

990 
mysql_£t_£rv”_ÝtiÚ
,

991 (
·rms
->
mysql
,…¬ms->
ÝtiÚ
),

992 
·rms
->
mysql
,

994 
r_št
)

995 
	}
}

996 
STDCALL


997 
	$mysql_£t_£rv”_ÝtiÚ_¡¬t
(*
»t
, 
MYSQL
 *
mysql
,

998 
’um_mysql_£t_ÝtiÚ
 
ÝtiÚ
)

1000 
	`MK_ASYNC_START_BODY
(

1001 
mysql_£t_£rv”_ÝtiÚ
,

1002 
mysql
,

1004 
	`WIN_SET_NONBLOCKING
(
mysql
)

1005 
·rms
.
mysql
= mysql;

1006 
·rms
.
ÝtiÚ
= option;

1009 
r_št
,

1011 
	}
}

1012 
STDCALL


1013 
	$mysql_£t_£rv”_ÝtiÚ_cÚt
(*
»t
, 
MYSQL
 *
mysql
, 
»ady_¡©us
)

1015 
	`MK_ASYNC_CONT_BODY
(

1016 
mysql
,

1018 
r_št
)

1019 
	}
}

1022 
	smysql_pšg_·¿ms
 {

1023 
MYSQL
 *
	mmysql
;

1026 
	$mysql_pšg_¡¬t_š‹º®
(*
d
)

1028 
	`MK_ASYNC_INTERNAL_BODY
(

1029 
mysql_pšg
,

1030 (
·rms
->
mysql
),

1031 
·rms
->
mysql
,

1033 
r_št
)

1034 
	}
}

1035 
STDCALL


1036 
	$mysql_pšg_¡¬t
(*
»t
, 
MYSQL
 *
mysql
)

1038 
	`MK_ASYNC_START_BODY
(

1039 
mysql_pšg
,

1040 
mysql
,

1042 
	`WIN_SET_NONBLOCKING
(
mysql
)

1043 
·rms
.
mysql
= mysql;

1046 
r_št
,

1048 
	}
}

1049 
STDCALL


1050 
	$mysql_pšg_cÚt
(*
»t
, 
MYSQL
 *
mysql
, 
»ady_¡©us
)

1052 
	`MK_ASYNC_CONT_BODY
(

1053 
mysql
,

1055 
r_št
)

1056 
	}
}

1059 
	smysql_»£t_cÚÃùiÚ_·¿ms
 {

1060 
MYSQL
 *
	mmysql
;

1063 
	$mysql_»£t_cÚÃùiÚ_¡¬t_š‹º®
(*
d
)

1065 
	`MK_ASYNC_INTERNAL_BODY
(

1066 
mysql_»£t_cÚÃùiÚ
,

1067 (
·rms
->
mysql
),

1068 
·rms
->
mysql
,

1070 
r_št
)

1071 
	}
}

1072 
STDCALL


1073 
	$mysql_»£t_cÚÃùiÚ_¡¬t
(*
»t
, 
MYSQL
 *
mysql
)

1075 
	`MK_ASYNC_START_BODY
(

1076 
mysql_»£t_cÚÃùiÚ
,

1077 
mysql
,

1079 
	`WIN_SET_NONBLOCKING
(
mysql
)

1080 
·rms
.
mysql
= mysql;

1083 
r_št
,

1085 
	}
}

1086 
STDCALL


1087 
	$mysql_»£t_cÚÃùiÚ_cÚt
(*
»t
, 
MYSQL
 *
mysql
, 
»ady_¡©us
)

1089 
	`MK_ASYNC_CONT_BODY
(

1090 
mysql
,

1092 
r_št
)

1093 
	}
}

1096 
	smysql_¡©_·¿ms
 {

1097 
MYSQL
 *
	mmysql
;

1100 
	$mysql_¡©_¡¬t_š‹º®
(*
d
)

1102 
	`MK_ASYNC_INTERNAL_BODY
(

1103 
mysql_¡©
,

1104 (
·rms
->
mysql
),

1105 
·rms
->
mysql
,

1107 
r_cÚ¡_±r
)

1108 
	}
}

1109 
STDCALL


1110 
	$mysql_¡©_¡¬t
(cÚ¡ **
»t
, 
MYSQL
 *
mysql
)

1112 
	`MK_ASYNC_START_BODY
(

1113 
mysql_¡©
,

1114 
mysql
,

1116 
	`WIN_SET_NONBLOCKING
(
mysql
)

1117 
·rms
.
mysql
= mysql;

1119 
NULL
,

1120 
r_cÚ¡_±r
,

1122 
	}
}

1123 
STDCALL


1124 
	$mysql_¡©_cÚt
(cÚ¡ **
»t
, 
MYSQL
 *
mysql
, 
»ady_¡©us
)

1126 
	`MK_ASYNC_CONT_BODY
(

1127 
mysql
,

1128 
NULL
,

1129 
r_cÚ¡_±r
)

1130 
	}
}

1133 
	smysql_li¡_dbs_·¿ms
 {

1134 
MYSQL
 *
	mmysql
;

1135 cÚ¡ *
	mwžd
;

1138 
	$mysql_li¡_dbs_¡¬t_š‹º®
(*
d
)

1140 
	`MK_ASYNC_INTERNAL_BODY
(

1141 
mysql_li¡_dbs
,

1142 (
·rms
->
mysql
,…¬ms->
wžd
),

1143 
·rms
->
mysql
,

1144 
MYSQL_RES
 *,

1145 
r_±r
)

1146 
	}
}

1147 
STDCALL


1148 
	$mysql_li¡_dbs_¡¬t
(
MYSQL_RES
 **
»t
, 
MYSQL
 *
mysql
, cÚ¡ *
wžd
)

1150 
	`MK_ASYNC_START_BODY
(

1151 
mysql_li¡_dbs
,

1152 
mysql
,

1154 
	`WIN_SET_NONBLOCKING
(
mysql
)

1155 
·rms
.
mysql
= mysql;

1156 
·rms
.
wžd
= wild;

1158 
NULL
,

1159 
r_±r
,

1161 
	}
}

1162 
STDCALL


1163 
	$mysql_li¡_dbs_cÚt
(
MYSQL_RES
 **
»t
, 
MYSQL
 *
mysql
, 
»ady_¡©us
)

1165 
	`MK_ASYNC_CONT_BODY
(

1166 
mysql
,

1167 
NULL
,

1168 
r_±r
)

1169 
	}
}

1172 
	smysql_li¡_bËs_·¿ms
 {

1173 
MYSQL
 *
	mmysql
;

1174 cÚ¡ *
	mwžd
;

1177 
	$mysql_li¡_bËs_¡¬t_š‹º®
(*
d
)

1179 
	`MK_ASYNC_INTERNAL_BODY
(

1180 
mysql_li¡_bËs
,

1181 (
·rms
->
mysql
,…¬ms->
wžd
),

1182 
·rms
->
mysql
,

1183 
MYSQL_RES
 *,

1184 
r_±r
)

1185 
	}
}

1186 
STDCALL


1187 
	$mysql_li¡_bËs_¡¬t
(
MYSQL_RES
 **
»t
, 
MYSQL
 *
mysql
, cÚ¡ *
wžd
)

1189 
	`MK_ASYNC_START_BODY
(

1190 
mysql_li¡_bËs
,

1191 
mysql
,

1193 
	`WIN_SET_NONBLOCKING
(
mysql
)

1194 
·rms
.
mysql
= mysql;

1195 
·rms
.
wžd
= wild;

1197 
NULL
,

1198 
r_±r
,

1200 
	}
}

1201 
STDCALL


1202 
	$mysql_li¡_bËs_cÚt
(
MYSQL_RES
 **
»t
, 
MYSQL
 *
mysql
, 
»ady_¡©us
)

1204 
	`MK_ASYNC_CONT_BODY
(

1205 
mysql
,

1206 
NULL
,

1207 
r_±r
)

1208 
	}
}

1211 
	smysql_li¡_´oûs£s_·¿ms
 {

1212 
MYSQL
 *
	mmysql
;

1215 
	$mysql_li¡_´oûs£s_¡¬t_š‹º®
(*
d
)

1217 
	`MK_ASYNC_INTERNAL_BODY
(

1218 
mysql_li¡_´oûs£s
,

1219 (
·rms
->
mysql
),

1220 
·rms
->
mysql
,

1221 
MYSQL_RES
 *,

1222 
r_±r
)

1223 
	}
}

1224 
STDCALL


1225 
	$mysql_li¡_´oûs£s_¡¬t
(
MYSQL_RES
 **
»t
, 
MYSQL
 *
mysql
)

1227 
	`MK_ASYNC_START_BODY
(

1228 
mysql_li¡_´oûs£s
,

1229 
mysql
,

1231 
	`WIN_SET_NONBLOCKING
(
mysql
)

1232 
·rms
.
mysql
= mysql;

1234 
NULL
,

1235 
r_±r
,

1237 
	}
}

1238 
STDCALL


1239 
	$mysql_li¡_´oûs£s_cÚt
(
MYSQL_RES
 **
»t
, 
MYSQL
 *
mysql
, 
»ady_¡©us
)

1241 
	`MK_ASYNC_CONT_BODY
(

1242 
mysql
,

1243 
NULL
,

1244 
r_±r
)

1245 
	}
}

1248 
	smysql_li¡_f›lds_·¿ms
 {

1249 
MYSQL
 *
	mmysql
;

1250 cÚ¡ *
	mbË
;

1251 cÚ¡ *
	mwžd
;

1254 
	$mysql_li¡_f›lds_¡¬t_š‹º®
(*
d
)

1256 
	`MK_ASYNC_INTERNAL_BODY
(

1257 
mysql_li¡_f›lds
,

1258 (
·rms
->
mysql
,…¬ms->
bË
,…¬ms->
wžd
),

1259 
·rms
->
mysql
,

1260 
MYSQL_RES
 *,

1261 
r_±r
)

1262 
	}
}

1263 
STDCALL


1264 
	$mysql_li¡_f›lds_¡¬t
(
MYSQL_RES
 **
»t
, 
MYSQL
 *
mysql
, cÚ¡ *
bË
,

1265 cÚ¡ *
wžd
)

1267 
	`MK_ASYNC_START_BODY
(

1268 
mysql_li¡_f›lds
,

1269 
mysql
,

1271 
	`WIN_SET_NONBLOCKING
(
mysql
)

1272 
·rms
.
mysql
= mysql;

1273 
·rms
.
bË
=able;

1274 
·rms
.
wžd
= wild;

1276 
NULL
,

1277 
r_±r
,

1279 
	}
}

1280 
STDCALL


1281 
	$mysql_li¡_f›lds_cÚt
(
MYSQL_RES
 **
»t
, 
MYSQL
 *
mysql
, 
»ady_¡©us
)

1283 
	`MK_ASYNC_CONT_BODY
(

1284 
mysql
,

1285 
NULL
,

1286 
r_±r
)

1287 
	}
}

1290 
	smysql_»ad_qu”y_»suÉ_·¿ms
 {

1291 
MYSQL
 *
	mmysql
;

1294 
	$mysql_»ad_qu”y_»suÉ_¡¬t_š‹º®
(*
d
)

1296 
	`MK_ASYNC_INTERNAL_BODY
(

1297 
mysql_»ad_qu”y_»suÉ
,

1298 (
·rms
->
mysql
),

1299 
·rms
->
mysql
,

1300 
my_boÞ
,

1301 
r_my_boÞ
)

1302 
	}
}

1303 
STDCALL


1304 
	$mysql_»ad_qu”y_»suÉ_¡¬t
(
my_boÞ
 *
»t
, 
MYSQL
 *
mysql
)

1306 
	`MK_ASYNC_START_BODY
(

1307 
mysql_»ad_qu”y_»suÉ
,

1308 
mysql
,

1310 
	`WIN_SET_NONBLOCKING
(
mysql
)

1311 
·rms
.
mysql
= mysql;

1313 
TRUE
,

1314 
r_my_boÞ
,

1316 
	}
}

1317 
STDCALL


1318 
	$mysql_»ad_qu”y_»suÉ_cÚt
(
my_boÞ
 *
»t
, 
MYSQL
 *
mysql
, 
»ady_¡©us
)

1320 
	`MK_ASYNC_CONT_BODY
(

1321 
mysql
,

1322 
TRUE
,

1323 
r_my_boÞ
)

1324 
	}
}

1327 
	smysql_¡mt_´•¬e_·¿ms
 {

1328 
MYSQL_STMT
 *
	m¡mt
;

1329 cÚ¡ *
	mqu”y
;

1330 
	mËngth
;

1333 
	$mysql_¡mt_´•¬e_¡¬t_š‹º®
(*
d
)

1335 
	`MK_ASYNC_INTERNAL_BODY
(

1336 
mysql_¡mt_´•¬e
,

1337 (
·rms
->
¡mt
,…¬ms->
qu”y
,…¬ms->
Ëngth
),

1338 
·rms
->
¡mt
->
mysql
,

1340 
r_št
)

1341 
	}
}

1342 
STDCALL


1343 
	$mysql_¡mt_´•¬e_¡¬t
(*
»t
, 
MYSQL_STMT
 *
¡mt
, cÚ¡ *
qu”y
,

1344 
Ëngth
)

1346 
	`MK_ASYNC_START_BODY
(

1347 
mysql_¡mt_´•¬e
,

1348 
¡mt
->
mysql
,

1350 
	`WIN_SET_NONBLOCKING
(
¡mt
->
mysql
)

1351 
·rms
.
¡mt
= stmt;

1352 
·rms
.
qu”y
= query;

1353 
·rms
.
Ëngth
=†ength;

1356 
r_št
,

1358 ià(!
¡mt
->
mysql
)

1360 *
»t
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
qu”y
, 
Ëngth
);

1363 
	}
}

1364 
STDCALL


1365 
	$mysql_¡mt_´•¬e_cÚt
(*
»t
, 
MYSQL_STMT
 *
¡mt
, 
»ady_¡©us
)

1367 
	`MK_ASYNC_CONT_BODY
(

1368 
¡mt
->
mysql
,

1370 
r_št
)

1371 
	}
}

1374 
	smysql_¡mt_execu‹_·¿ms
 {

1375 
MYSQL_STMT
 *
	m¡mt
;

1378 
	$mysql_¡mt_execu‹_¡¬t_š‹º®
(*
d
)

1380 
	`MK_ASYNC_INTERNAL_BODY
(

1381 
mysql_¡mt_execu‹
,

1382 (
·rms
->
¡mt
),

1383 
·rms
->
¡mt
->
mysql
,

1385 
r_št
)

1386 
	}
}

1387 
STDCALL


1388 
	$mysql_¡mt_execu‹_¡¬t
(*
»t
, 
MYSQL_STMT
 *
¡mt
)

1390 
	`MK_ASYNC_START_BODY
(

1391 
mysql_¡mt_execu‹
,

1392 
¡mt
->
mysql
,

1394 
	`WIN_SET_NONBLOCKING
(
¡mt
->
mysql
)

1395 
·rms
.
¡mt
= stmt;

1398 
r_št
,

1403 ià(!
¡mt
->
mysql
)

1405 *
»t
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1408 
	}
}

1409 
STDCALL


1410 
	$mysql_¡mt_execu‹_cÚt
(*
»t
, 
MYSQL_STMT
 *
¡mt
, 
»ady_¡©us
)

1412 
	`MK_ASYNC_CONT_BODY
(

1413 
¡mt
->
mysql
,

1415 
r_št
)

1416 
	}
}

1419 
	smysql_¡mt_ãtch_·¿ms
 {

1420 
MYSQL_STMT
 *
	m¡mt
;

1423 
	$mysql_¡mt_ãtch_¡¬t_š‹º®
(*
d
)

1425 
	`MK_ASYNC_INTERNAL_BODY
(

1426 
mysql_¡mt_ãtch
,

1427 (
·rms
->
¡mt
),

1428 
·rms
->
¡mt
->
mysql
,

1430 
r_št
)

1431 
	}
}

1432 
STDCALL


1433 
	$mysql_¡mt_ãtch_¡¬t
(*
»t
, 
MYSQL_STMT
 *
¡mt
)

1435 
	`MK_ASYNC_START_BODY
(

1436 
mysql_¡mt_ãtch
,

1437 
¡mt
->
mysql
,

1439 
	`WIN_SET_NONBLOCKING
(
¡mt
->
mysql
)

1440 
·rms
.
¡mt
= stmt;

1443 
r_št
,

1445 ià(!
¡mt
->
mysql
)

1447 *
»t
ð
	`mysql_¡mt_ãtch
(
¡mt
);

1450 
	}
}

1451 
STDCALL


1452 
	$mysql_¡mt_ãtch_cÚt
(*
»t
, 
MYSQL_STMT
 *
¡mt
, 
»ady_¡©us
)

1454 
	`MK_ASYNC_CONT_BODY
(

1455 
¡mt
->
mysql
,

1457 
r_št
)

1458 
	}
}

1461 
	smysql_¡mt_¡Üe_»suÉ_·¿ms
 {

1462 
MYSQL_STMT
 *
	m¡mt
;

1465 
	$mysql_¡mt_¡Üe_»suÉ_¡¬t_š‹º®
(*
d
)

1467 
	`MK_ASYNC_INTERNAL_BODY
(

1468 
mysql_¡mt_¡Üe_»suÉ
,

1469 (
·rms
->
¡mt
),

1470 
·rms
->
¡mt
->
mysql
,

1472 
r_št
)

1473 
	}
}

1474 
STDCALL


1475 
	$mysql_¡mt_¡Üe_»suÉ_¡¬t
(*
»t
, 
MYSQL_STMT
 *
¡mt
)

1477 
	`MK_ASYNC_START_BODY
(

1478 
mysql_¡mt_¡Üe_»suÉ
,

1479 
¡mt
->
mysql
,

1481 
	`WIN_SET_NONBLOCKING
(
¡mt
->
mysql
)

1482 
·rms
.
¡mt
= stmt;

1485 
r_št
,

1487 ià(!
¡mt
->
mysql
)

1489 *
»t
ð
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

1492 
	}
}

1493 
STDCALL


1494 
	$mysql_¡mt_¡Üe_»suÉ_cÚt
(*
»t
, 
MYSQL_STMT
 *
¡mt
, 
»ady_¡©us
)

1496 
	`MK_ASYNC_CONT_BODY
(

1497 
¡mt
->
mysql
,

1499 
r_št
)

1500 
	}
}

1503 
	smysql_¡mt_þo£_·¿ms
 {

1504 
MYSQL_STMT
 *
	m¡mt
;

1507 
	$mysql_¡mt_þo£_¡¬t_š‹º®
(*
d
)

1509 
	`MK_ASYNC_INTERNAL_BODY
(

1510 
mysql_¡mt_þo£
,

1511 (
·rms
->
¡mt
),

1512 
·rms
->
¡mt
->
mysql
,

1513 
my_boÞ
,

1514 
r_my_boÞ
)

1515 
	}
}

1516 
STDCALL


1517 
	$mysql_¡mt_þo£_¡¬t
(
my_boÞ
 *
»t
, 
MYSQL_STMT
 *
¡mt
)

1519 
	`MK_ASYNC_START_BODY
(

1520 
mysql_¡mt_þo£
,

1521 
¡mt
->
mysql
,

1523 
	`WIN_SET_NONBLOCKING
(
¡mt
->
mysql
)

1524 
·rms
.
¡mt
= stmt;

1526 
TRUE
,

1527 
r_my_boÞ
,

1529 ià(!
¡mt
->
mysql
)

1531 *
»t
ð
	`mysql_¡mt_þo£
(
¡mt
);

1534 
	}
}

1535 
STDCALL


1536 
	$mysql_¡mt_þo£_cÚt
(
my_boÞ
 *
»t
, 
MYSQL_STMT
 *
¡mt
, 
»ady_¡©us
)

1538 
	`MK_ASYNC_CONT_BODY
(

1539 
¡mt
->
mysql
,

1540 
TRUE
,

1541 
r_my_boÞ
)

1542 
	}
}

1545 
	smysql_¡mt_»£t_·¿ms
 {

1546 
MYSQL_STMT
 *
	m¡mt
;

1549 
	$mysql_¡mt_»£t_¡¬t_š‹º®
(*
d
)

1551 
	`MK_ASYNC_INTERNAL_BODY
(

1552 
mysql_¡mt_»£t
,

1553 (
·rms
->
¡mt
),

1554 
·rms
->
¡mt
->
mysql
,

1555 
my_boÞ
,

1556 
r_my_boÞ
)

1557 
	}
}

1558 
STDCALL


1559 
	$mysql_¡mt_»£t_¡¬t
(
my_boÞ
 *
»t
, 
MYSQL_STMT
 *
¡mt
)

1561 
	`MK_ASYNC_START_BODY
(

1562 
mysql_¡mt_»£t
,

1563 
¡mt
->
mysql
,

1565 
	`WIN_SET_NONBLOCKING
(
¡mt
->
mysql
)

1566 
·rms
.
¡mt
= stmt;

1568 
TRUE
,

1569 
r_my_boÞ
,

1571 ià(!
¡mt
->
mysql
)

1573 *
»t
ð
	`mysql_¡mt_»£t
(
¡mt
);

1576 
	}
}

1577 
STDCALL


1578 
	$mysql_¡mt_»£t_cÚt
(
my_boÞ
 *
»t
, 
MYSQL_STMT
 *
¡mt
, 
»ady_¡©us
)

1580 
	`MK_ASYNC_CONT_BODY
(

1581 
¡mt
->
mysql
,

1582 
TRUE
,

1583 
r_my_boÞ
)

1584 
	}
}

1587 
	smysql_¡mt_ä“_»suÉ_·¿ms
 {

1588 
MYSQL_STMT
 *
	m¡mt
;

1591 
	$mysql_¡mt_ä“_»suÉ_¡¬t_š‹º®
(*
d
)

1593 
	`MK_ASYNC_INTERNAL_BODY
(

1594 
mysql_¡mt_ä“_»suÉ
,

1595 (
·rms
->
¡mt
),

1596 
·rms
->
¡mt
->
mysql
,

1597 
my_boÞ
,

1598 
r_my_boÞ
)

1599 
	}
}

1600 
STDCALL


1601 
	$mysql_¡mt_ä“_»suÉ_¡¬t
(
my_boÞ
 *
»t
, 
MYSQL_STMT
 *
¡mt
)

1603 
	`MK_ASYNC_START_BODY
(

1604 
mysql_¡mt_ä“_»suÉ
,

1605 
¡mt
->
mysql
,

1607 
	`WIN_SET_NONBLOCKING
(
¡mt
->
mysql
)

1608 
·rms
.
¡mt
= stmt;

1610 
TRUE
,

1611 
r_my_boÞ
,

1613 ià(!
¡mt
->
mysql
)

1615 *
»t
ð
	`mysql_¡mt_ä“_»suÉ
(
¡mt
);

1618 
	}
}

1619 
STDCALL


1620 
	$mysql_¡mt_ä“_»suÉ_cÚt
(
my_boÞ
 *
»t
, 
MYSQL_STMT
 *
¡mt
, 
»ady_¡©us
)

1622 
	`MK_ASYNC_CONT_BODY
(

1623 
¡mt
->
mysql
,

1624 
TRUE
,

1625 
r_my_boÞ
)

1626 
	}
}

1629 
	smysql_¡mt_£nd_lÚg_d©a_·¿ms
 {

1630 
MYSQL_STMT
 *
	m¡mt
;

1631 
	m·¿m_numb”
;

1632 cÚ¡ *
	md©a
;

1633 
	mËngth
;

1636 
	$mysql_¡mt_£nd_lÚg_d©a_¡¬t_š‹º®
(*
d
)

1638 
	`MK_ASYNC_INTERNAL_BODY
(

1639 
mysql_¡mt_£nd_lÚg_d©a
,

1640 (
·rms
->
¡mt
,…¬ms->
·¿m_numb”
,…¬ms->
d©a
,…¬ms->
Ëngth
),

1641 
·rms
->
¡mt
->
mysql
,

1642 
my_boÞ
,

1643 
r_my_boÞ
)

1644 
	}
}

1645 
STDCALL


1646 
	$mysql_¡mt_£nd_lÚg_d©a_¡¬t
(
my_boÞ
 *
»t
, 
MYSQL_STMT
 *
¡mt
,

1647 
·¿m_numb”
,

1648 cÚ¡ *
d©a
, 
Ëngth
)

1650 
	`MK_ASYNC_START_BODY
(

1651 
mysql_¡mt_£nd_lÚg_d©a
,

1652 
¡mt
->
mysql
,

1654 
	`WIN_SET_NONBLOCKING
(
¡mt
->
mysql
)

1655 
·rms
.
¡mt
= stmt;

1656 
·rms
.
·¿m_numb”
=…aram_number;

1657 
·rms
.
d©a
= data;

1658 
·rms
.
Ëngth
=†ength;

1660 
TRUE
,

1661 
r_my_boÞ
,

1663 ià(!
¡mt
->
mysql
)

1665 *
»t
ð
	`mysql_¡mt_£nd_lÚg_d©a
(
¡mt
, 
·¿m_numb”
, 
d©a
, 
Ëngth
);

1668 
	}
}

1669 
STDCALL


1670 
	$mysql_¡mt_£nd_lÚg_d©a_cÚt
(
my_boÞ
 *
»t
, 
MYSQL_STMT
 *
¡mt
, 
»ady_¡©us
)

1672 
	`MK_ASYNC_CONT_BODY
(

1673 
¡mt
->
mysql
,

1674 
TRUE
,

1675 
r_my_boÞ
)

1676 
	}
}

1679 
	smysql_comm™_·¿ms
 {

1680 
MYSQL
 *
	mmysql
;

1683 
	$mysql_comm™_¡¬t_š‹º®
(*
d
)

1685 
	`MK_ASYNC_INTERNAL_BODY
(

1686 
mysql_comm™
,

1687 (
·rms
->
mysql
),

1688 
·rms
->
mysql
,

1689 
my_boÞ
,

1690 
r_my_boÞ
)

1691 
	}
}

1692 
STDCALL


1693 
	$mysql_comm™_¡¬t
(
my_boÞ
 *
»t
, 
MYSQL
 *
mysql
)

1695 
	`MK_ASYNC_START_BODY
(

1696 
mysql_comm™
,

1697 
mysql
,

1699 
	`WIN_SET_NONBLOCKING
(
mysql
)

1700 
·rms
.
mysql
= mysql;

1702 
TRUE
,

1703 
r_my_boÞ
,

1705 
	}
}

1706 
STDCALL


1707 
	$mysql_comm™_cÚt
(
my_boÞ
 *
»t
, 
MYSQL
 *
mysql
, 
»ady_¡©us
)

1709 
	`MK_ASYNC_CONT_BODY
(

1710 
mysql
,

1711 
TRUE
,

1712 
r_my_boÞ
)

1713 
	}
}

1716 
	smysql_rÞlback_·¿ms
 {

1717 
MYSQL
 *
	mmysql
;

1720 
	$mysql_rÞlback_¡¬t_š‹º®
(*
d
)

1722 
	`MK_ASYNC_INTERNAL_BODY
(

1723 
mysql_rÞlback
,

1724 (
·rms
->
mysql
),

1725 
·rms
->
mysql
,

1726 
my_boÞ
,

1727 
r_my_boÞ
)

1728 
	}
}

1729 
STDCALL


1730 
	$mysql_rÞlback_¡¬t
(
my_boÞ
 *
»t
, 
MYSQL
 *
mysql
)

1732 
	`MK_ASYNC_START_BODY
(

1733 
mysql_rÞlback
,

1734 
mysql
,

1736 
	`WIN_SET_NONBLOCKING
(
mysql
)

1737 
·rms
.
mysql
= mysql;

1739 
TRUE
,

1740 
r_my_boÞ
,

1742 
	}
}

1743 
STDCALL


1744 
	$mysql_rÞlback_cÚt
(
my_boÞ
 *
»t
, 
MYSQL
 *
mysql
, 
»ady_¡©us
)

1746 
	`MK_ASYNC_CONT_BODY
(

1747 
mysql
,

1748 
TRUE
,

1749 
r_my_boÞ
)

1750 
	}
}

1753 
	smysql_autocomm™_·¿ms
 {

1754 
MYSQL
 *
	mmysql
;

1755 
my_boÞ
 
	mauto_mode
;

1758 
	$mysql_autocomm™_¡¬t_š‹º®
(*
d
)

1760 
	`MK_ASYNC_INTERNAL_BODY
(

1761 
mysql_autocomm™
,

1762 (
·rms
->
mysql
,…¬ms->
auto_mode
),

1763 
·rms
->
mysql
,

1764 
my_boÞ
,

1765 
r_my_boÞ
)

1766 
	}
}

1767 
STDCALL


1768 
	$mysql_autocomm™_¡¬t
(
my_boÞ
 *
»t
, 
MYSQL
 *
mysql
, my_boÞ 
auto_mode
)

1770 
	`MK_ASYNC_START_BODY
(

1771 
mysql_autocomm™
,

1772 
mysql
,

1774 
	`WIN_SET_NONBLOCKING
(
mysql
)

1775 
·rms
.
mysql
= mysql;

1776 
·rms
.
auto_mode
=‡uto_mode;

1778 
TRUE
,

1779 
r_my_boÞ
,

1781 
	}
}

1782 
STDCALL


1783 
	$mysql_autocomm™_cÚt
(
my_boÞ
 *
»t
, 
MYSQL
 *
mysql
, 
»ady_¡©us
)

1785 
	`MK_ASYNC_CONT_BODY
(

1786 
mysql
,

1787 
TRUE
,

1788 
r_my_boÞ
)

1789 
	}
}

1792 
	smysql_Ãxt_»suÉ_·¿ms
 {

1793 
MYSQL
 *
	mmysql
;

1796 
	$mysql_Ãxt_»suÉ_¡¬t_š‹º®
(*
d
)

1798 
	`MK_ASYNC_INTERNAL_BODY
(

1799 
mysql_Ãxt_»suÉ
,

1800 (
·rms
->
mysql
),

1801 
·rms
->
mysql
,

1803 
r_št
)

1804 
	}
}

1805 
STDCALL


1806 
	$mysql_Ãxt_»suÉ_¡¬t
(*
»t
, 
MYSQL
 *
mysql
)

1808 
	`MK_ASYNC_START_BODY
(

1809 
mysql_Ãxt_»suÉ
,

1810 
mysql
,

1812 
	`WIN_SET_NONBLOCKING
(
mysql
)

1813 
·rms
.
mysql
= mysql;

1816 
r_št
,

1818 
	}
}

1819 
STDCALL


1820 
	$mysql_Ãxt_»suÉ_cÚt
(*
»t
, 
MYSQL
 *
mysql
, 
»ady_¡©us
)

1822 
	`MK_ASYNC_CONT_BODY
(

1823 
mysql
,

1825 
r_št
)

1826 
	}
}

1829 
	smysql_¡mt_Ãxt_»suÉ_·¿ms
 {

1830 
MYSQL_STMT
 *
	m¡mt
;

1833 
	$mysql_¡mt_Ãxt_»suÉ_¡¬t_š‹º®
(*
d
)

1835 
	`MK_ASYNC_INTERNAL_BODY
(

1836 
mysql_¡mt_Ãxt_»suÉ
,

1837 (
·rms
->
¡mt
),

1838 
·rms
->
¡mt
->
mysql
,

1840 
r_št
)

1841 
	}
}

1842 
STDCALL


1843 
	$mysql_¡mt_Ãxt_»suÉ_¡¬t
(*
»t
, 
MYSQL_STMT
 *
¡mt
)

1845 
	`MK_ASYNC_START_BODY
(

1846 
mysql_¡mt_Ãxt_»suÉ
,

1847 
¡mt
->
mysql
,

1849 
	`WIN_SET_NONBLOCKING
(
¡mt
->
mysql
)

1850 
·rms
.
¡mt
= stmt;

1853 
r_št
,

1855 
	}
}

1856 
STDCALL


1857 
	$mysql_¡mt_Ãxt_»suÉ_cÚt
(*
»t
, 
MYSQL_STMT
 *
¡mt
, 
»ady_¡©us
)

1859 
	`MK_ASYNC_CONT_BODY
(

1860 
¡mt
->
mysql
,

1862 
r_št
)

1863 
	}
}

	@libmariadb/mariadb_charset.c

19 
	~<ma_glob®.h
>

20 
	~<ma_sys.h
>

22 
	~<m¬Ÿdb_ùy³.h
>

23 
	~<ma_¡ršg.h
>

25 
MARIADB_CHARSET_INFO
 *
	gma_deçuÉ_ch¬£t_šfo
;

26 
MARIADB_CHARSET_INFO
 *
	gma_ch¬£t_bš
ð(MARIADB_CHARSET_INFO *)&
m¬Ÿdb_compžed_ch¬£ts
[32];

27 
MARIADB_CHARSET_INFO
 *
	gma_ch¬£t_Ïtš1
ð(MARIADB_CHARSET_INFO *)&
m¬Ÿdb_compžed_ch¬£ts
[5];

28 
MARIADB_CHARSET_INFO
 *
	gma_ch¬£t_utf8_g’”®_ci
ð(MARIADB_CHARSET_INFO *)&
m¬Ÿdb_compžed_ch¬£ts
[21];

29 
MARIADB_CHARSET_INFO
 *
	gma_ch¬£t_utf16Ë_g’”®_ci
ð(MARIADB_CHARSET_INFO *)&
m¬Ÿdb_compžed_ch¬£ts
[68];

31 
MARIADB_CHARSET_INFO
 * 
STDCALL
 
	$mysql_g‘_ch¬£t_by_Ä
(
ušt
 
cs_numb”
)

33 
i
= 0;

35 
m¬Ÿdb_compžed_ch¬£ts
[
i
].
Ä
 && 
cs_numb”
 != mariadb_compiled_charsets[i].nr)

36 
i
++;

38  (
m¬Ÿdb_compžed_ch¬£ts
[
i
].
Ä
è? (
MARIADB_CHARSET_INFO
 *)&m¬Ÿdb_compžed_ch¬£ts[i] : 
NULL
;

39 
	}
}

41 
my_boÞ
 
£t_deçuÉ_ch¬£t
(
ušt
 
cs
, 
myf
 
æags
 
__©Œibu‹__
((
unu£d
)))

43 
MARIADB_CHARSET_INFO
 *
	gÃw_ch¬£t
;

44 
	gÃw_ch¬£t
 = 
mysql_g‘_ch¬£t_by_Ä
(
cs
);

45 ià(!
	gÃw_ch¬£t
)

47 (
	gTRUE
);

49 
	gma_deçuÉ_ch¬£t_šfo
 = 
Ãw_ch¬£t
;

50 (
	gFALSE
);

53 
MARIADB_CHARSET_INFO
 * 
STDCALL
 
	$mysql_g‘_ch¬£t_by_Çme
(cÚ¡ *
cs_Çme
)

55 
i
= 0;

57 
m¬Ÿdb_compžed_ch¬£ts
[
i
].
Ä
 && 
	`¡rcmp
(
cs_Çme
, m¬Ÿdb_compžed_ch¬£ts[i].
c¢ame
) != 0)

58 
i
++;

60  (
m¬Ÿdb_compžed_ch¬£ts
[
i
].
Ä
è? (
MARIADB_CHARSET_INFO
 *)&m¬Ÿdb_compžed_ch¬£ts[i] : 
NULL
;

61 
	}
}

63 
my_boÞ
 
£t_deçuÉ_ch¬£t_by_Çme
(cÚ¡ *
cs_Çme
, 
myf
 
æags
 
__©Œibu‹__
((
unu£d
)))

65 
MARIADB_CHARSET_INFO
 *
	gÃw_ch¬£t
;

66 
	gÃw_ch¬£t
 = 
mysql_g‘_ch¬£t_by_Çme
(
cs_Çme
);

67 ià(!
	gÃw_ch¬£t
)

69 (
	gTRUE
);

72 
	gma_deçuÉ_ch¬£t_šfo
 = 
Ãw_ch¬£t
;

73 (
	gFALSE
);

	@libmariadb/mariadb_dyncol.c

63 
	~<¡dio.h
>

64 
	~<ma_glob®.h
>

65 
	~<ma_sys.h
>

66 
	~<ma_¡ršg.h
>

67 
	~<ma_hash.h
>

68 
	~<m¬Ÿdb_dyncÞ.h
>

69 
	~<mysql.h
>

73 #iâdeà
LIBMARIADB


74 
ušt32
 
cÝy_ªd_cÚv”t
(*
to
, ušt32 
to_Ëngth
, 
MARIADB_CHARSET_INFO
 *
to_cs
,

75 cÚ¡ *
äom
, 
ušt32
 
äom_Ëngth
,

76 
MARIADB_CHARSET_INFO
 *
äom_cs
, 
ušt
 *
”rÜs
);

79 
size_t
 
m¬Ÿdb_time_to_¡ršg
(cÚ¡ 
MYSQL_TIME
 *
tm
, *
time_¡r
, size_ˆ
Ën
,

80 
dig™s
);

81 
size_t
 
STDCALL
 
m¬Ÿdb_cÚv”t_¡ršg
(cÚ¡ *
äom
, size_ˆ*
äom_Ën
, 
MARIADB_CHARSET_INFO
 *
äom_cs
,

82 *
to
, 
size_t
 *
to_Ën
, 
MARIADB_CHARSET_INFO
 *
to_cs
, *
”rÜcode
);

90 
	#DYNCOL_FLG_OFFSET
 (1|2)

	)

91 
	#DYNCOL_FLG_NAMES
 4

	)

92 
	#DYNCOL_FLG_NMOFFSET
 (8|16)

	)

98 
	#DYNCOL_FLG_KNOWN
 (1|2|4)

	)

101 
	e’um_dyncÞ_fÜm©


103 
	mdyncÞ_fmt_num
= 0,

104 
	mdyncÞ_fmt_¡r
= 1

108 
	#DYNCOL_SYZERESERVE
 80

	)

110 
	#DYNCOL_OFFSET_ERROR
 0xffffffff

	)

113 
	#FIXED_HEADER_SIZE
 3

	)

118 
	#FIXED_HEADER_SIZE_NM
 5

	)

120 
	#COLUMN_NUMBER_SIZE
 2

	)

122 
	#COLUMN_NAMEPTR_SIZE
 2

	)

124 
	#MAX_OFFSET_LENGTH
 4

	)

125 
	#MAX_OFFSET_LENGTH_NM
 5

	)

127 
	#DYNCOL_NUM_CHAR
 6

	)

129 
my_boÞ
 
	$m¬Ÿdb_dyncÞ_has_Çmes
(
DYNAMIC_COLUMN
 *
¡r
)

131 ià(
¡r
->
Ëngth
 < 1)

132  
FALSE
;

133  
	`‹¡
(
¡r
->¡r[0] & 
DYNCOL_FLG_NAMES
);

134 
	}
}

136 
’um_dyncÞ_func_»suÉ


137 
dyÇmic_cÞumn_time_¡Üe
(
DYNAMIC_COLUMN
 *
¡r
,

138 
MYSQL_TIME
 *
v®ue
, 
’um_dyncÞ_fÜm©
 
fÜm©
);

139 
’um_dyncÞ_func_»suÉ


140 
dyÇmic_cÞumn_d©e_¡Üe
(
DYNAMIC_COLUMN
 *
¡r
,

141 
MYSQL_TIME
 *
v®ue
);

142 
’um_dyncÞ_func_»suÉ


143 
dyÇmic_cÞumn_time_»ad_š‹º®
(
DYNAMIC_COLUMN_VALUE
 *
¡Üe_™_h”e
,

144 
uch¬
 *
d©a
, 
size_t
 
Ëngth
);

145 
’um_dyncÞ_func_»suÉ


146 
dyÇmic_cÞumn_d©e_»ad_š‹º®
(
DYNAMIC_COLUMN_VALUE
 *
¡Üe_™_h”e
,

147 
uch¬
 *
d©a
, 
size_t
 
Ëngth
);

148 
’um_dyncÞ_func_»suÉ


149 
dyÇmic_cÞumn_g‘_š‹º®
(
DYNAMIC_COLUMN
 *
¡r
,

150 
DYNAMIC_COLUMN_VALUE
 *
¡Üe_™_h”e
,

151 
ušt
 
num_key
, 
LEX_STRING
 *
¡r_key
);

152 
’um_dyncÞ_func_»suÉ


153 
dyÇmic_cÞumn_exi¡s_š‹º®
(
DYNAMIC_COLUMN
 *
¡r
, 
ušt
 
num_key
,

154 
LEX_STRING
 *
¡r_key
);

155 
’um_dyncÞ_func_»suÉ


156 
dyÇmic_cÞumn_upd©e_mªy_fmt
(
DYNAMIC_COLUMN
 *
¡r
,

157 
ušt
 
add_cÞumn_couÁ
,

158 *
cÞumn_keys
,

159 
DYNAMIC_COLUMN_VALUE
 *
v®ues
,

160 
my_boÞ
 
¡ršg_keys
);

161 
¶ª_sÜt_num
(cÚ¡ *
a
, cÚ¡ *
b
);

162 
¶ª_sÜt_Çmed
(cÚ¡ *
a
, cÚ¡ *
b
);

169 
	s¡_dyn_h—d”


171 
uch¬
 *
	mh—d”
, *
	mnmpoÞ
, *
	mdoÞ
, *
	md©a_’d
;

172 
size_t
 
	moff£t_size
;

173 
size_t
 
	m’Œy_size
;

174 
size_t
 
	mh—d”_size
;

175 
size_t
 
	mnmpoÞ_size
;

176 
size_t
 
	md©a_size
;

178 
’um_dyncÞ_fÜm©
 
	mfÜm©
;

179 
ušt
 
	mcÞumn_couÁ
;

181 
uch¬
 *
	m’Œy
, *
	md©a
, *
	mÇme
;

182 
size_t
 
	moff£t
;

183 
size_t
 
	mËngth
;

184 
’um_dyÇmic_cÞumn_ty³
 
	mty³
;

187 
¡_dyn_h—d”
 
	tDYN_HEADER
;

189 
šlše
 
my_boÞ
 
»ad_fixed_h—d”
(
DYN_HEADER
 *
hdr
,

190 
DYNAMIC_COLUMN
 *
¡r
);

191 
£t_fixed_h—d”
(
DYNAMIC_COLUMN
 *
¡r
,

192 
ušt
 
off£t_size
,

193 
ušt
 
cÞumn_couÁ
);

200 
	#ÿlc_·¿m
(
E
,
H
,
F
,
O
,
C
) do { \

201 (*(
E
))ð(
O
è+ 
F
; \

202 (*(
H
))ð(*(
E
)è* (
C
); \

203 }0);

	)

210 
size_t
 
Çme_size_num
(*
keys
 
__©Œibu‹__
((
unu£d
)),

211 
ušt
 
i
 
__©Œibu‹__
((
unu£d
)))

220 
size_t
 
	$Çme_size_Çmed
(*
keys
, 
ušt
 
i
)

222  ((
LEX_STRING
 *è
keys
)[
i
].
Ëngth
;

223 
	}
}

231 
	$cÞumn_sÜt_num
(cÚ¡ *
a
, cÚ¡ *
b
)

233  **((
ušt
 **)
a
è- **((ušˆ**)
b
);

234 
	}
}

241 
	$m¬Ÿdb_dyncÞ_cÞumn_cmp_Çmed
(cÚ¡ 
LEX_STRING
 *
s1
, cÚ¡ LEX_STRING *
s2
)

247 
rc
ð(
s1
->
Ëngth
 > 
s2
->length ? 1 :

248 (
s1
->
Ëngth
 < 
s2
->length ? -1 : 0));

249 ià(
rc
 == 0)

250 
rc
ð
	`memcmp
((*)
s1
->
¡r
, (*)
s2
->str,

251 (
size_t
è
s1
->
Ëngth
);

252  
rc
;

253 
	}
}

261 
	$cÞumn_sÜt_Çmed
(cÚ¡ *
a
, cÚ¡ *
b
)

263  
	`m¬Ÿdb_dyncÞ_cÞumn_cmp_Çmed
(*((
LEX_STRING
 **)
a
),

264 *((
LEX_STRING
 **)
b
));

265 
	}
}

272 
my_boÞ
 
	$check_lim™_num
(cÚ¡ *
v®
)

274  **((
ušt
 **)
v®
è> 
UINT_MAX16
;

275 
	}
}

282 
my_boÞ
 
	$check_lim™_Çmed
(cÚ¡ *
v®
)

284  (*((
LEX_STRING
 **)
v®
))->
Ëngth
 > 
MAX_NAME_LENGTH
;

285 
	}
}

292 
	$£t_fixed_h—d”_num
(
DYNAMIC_COLUMN
 *
¡r
, 
DYN_HEADER
 *
hdr
)

294 
	`£t_fixed_h—d”
(
¡r
, (
ušt
)
hdr
->
off£t_size
, hdr->
cÞumn_couÁ
);

295 
hdr
->
h—d”
ð(
uch¬
 *)
¡r
->¡¸+ 
FIXED_HEADER_SIZE
;

296 
hdr
->
nmpoÞ
ðhdr->
doÞ
ðhdr->
h—d”
 + hdr->
h—d”_size
;

297 
	}
}

304 
	$£t_fixed_h—d”_Çmed
(
DYNAMIC_COLUMN
 *
¡r
, 
DYN_HEADER
 *
hdr
)

306 
	`DBUG_ASSERT
(
hdr
->
cÞumn_couÁ
 <= 0xffff);

307 
	`DBUG_ASSERT
(
hdr
->
off£t_size
 <ð
MAX_OFFSET_LENGTH_NM
);

309 
¡r
->str[0]=

310 (è((
¡r
->¡r[0] & ~(
DYNCOL_FLG_OFFSET
 | 
DYNCOL_FLG_NMOFFSET
)) |

311 (
hdr
->
off£t_size
 - 2è| 
DYNCOL_FLG_NAMES
);

312 
	`št2¡Üe
(
¡r
->¡¸+ 1, 
hdr
->
cÞumn_couÁ
);

313 
	`št2¡Üe
(
¡r
->¡¸+ 3, 
hdr
->
nmpoÞ_size
);

314 
hdr
->
h—d”
ð(
uch¬
 *)
¡r
->¡¸+ 
FIXED_HEADER_SIZE_NM
;

315 
hdr
->
nmpoÞ
ðhdr->
h—d”
 + hdr->
h—d”_size
;

316 
hdr
->
doÞ
ðhdr->
nmpoÞ
 + hdr->
nmpoÞ_size
;

317 
	}
}

329 
my_boÞ
 
	$ty³_ªd_off£t_¡Üe_num
(
uch¬
 *
¶aû
, 
size_t
 
off£t_size
,

330 
DYNAMIC_COLUMN_TYPE
 
ty³
,

331 
size_t
 
off£t
)

333 
ulÚg
 
v®
 = (((ulÚgè
off£t
è<< 3è| (
ty³
 - 1);

334 
	`DBUG_ASSERT
(
ty³
 !ð
DYN_COL_NULL
);

335 
	`DBUG_ASSERT
(((
ty³
 - 1) & (~7)) == 0);

336 
	`DBUG_ASSERT
(
off£t_size
 >= 1 && offset_size <= 4);

339 
¶aû
+ð
COLUMN_NUMBER_SIZE
;

341 
off£t_size
) {

343 ià(
off£t
 >= 0x1f)

344  
TRUE
;

345 
¶aû
[0]ð(
uch¬
)
v®
;

348 ià(
off£t
 >= 0x1fff)

349  
TRUE
;

350 
	`št2¡Üe
(
¶aû
, 
v®
);

353 ià(
off£t
 >= 0x1fffff)

354  
TRUE
;

355 
	`št3¡Üe
(
¶aû
, 
v®
);

358 ià(
off£t
 >= 0x1fffffff)

359  
TRUE
;

360 
	`št4¡Üe
(
¶aû
, 
v®
);

363  
TRUE
;

365  
FALSE
;

366 
	}
}

369 
my_boÞ
 
	$ty³_ªd_off£t_¡Üe_Çmed
(
uch¬
 *
¶aû
, 
size_t
 
off£t_size
,

370 
DYNAMIC_COLUMN_TYPE
 
ty³
,

371 
size_t
 
off£t
)

373 
ulÚglÚg
 
v®
 = (((
ulÚg
è
off£t
è<< 4è| (
ty³
 - 1);

374 
	`DBUG_ASSERT
(
ty³
 !ð
DYN_COL_NULL
);

375 
	`DBUG_ASSERT
(((
ty³
 - 1) & (~0xf)) == 0);

376 
	`DBUG_ASSERT
(
off£t_size
 >= 2 && offset_size <= 5);

379 
¶aû
+ð
COLUMN_NAMEPTR_SIZE
;

380 
off£t_size
) {

382 ià(
off£t
 >= 0xfff)

383  
TRUE
;

384 
	`št2¡Üe
(
¶aû
, 
v®
);

387 ià(
off£t
 >= 0xfffff)

388  
TRUE
;

389 
	`št3¡Üe
(
¶aû
, 
v®
);

392 ià(
off£t
 >= 0xfffffff)

393  
TRUE
;

394 
	`št4¡Üe
(
¶aû
, 
v®
);

397 #ià
SIZEOF_SIZE_T
 > 4

398 ià(
off£t
 >= 0xfffffffffull)

399  
TRUE
;

401 
	`št5¡Üe
(
¶aû
, 
v®
);

405  
TRUE
;

407  
FALSE
;

408 
	}
}

421 
my_boÞ
 
	$put_h—d”_’Œy_num
(
DYN_HEADER
 *
hdr
,

422 *
cÞumn_key
,

423 
DYNAMIC_COLUMN_VALUE
 *
v®ue
,

424 
size_t
 
off£t
)

426 
ušt
 *
cÞumn_numb”
ð(ušˆ*)
cÞumn_key
;

427 
	`št2¡Üe
(
hdr
->
’Œy
, *
cÞumn_numb”
);

428 
	`DBUG_ASSERT
(
hdr
->
nmpoÞ_size
 == 0);

429 ià(
	`ty³_ªd_off£t_¡Üe_num
(
hdr
->
’Œy
, hdr->
off£t_size
,

430 
v®ue
->
ty³
,

431 
off£t
))

432  
TRUE
;

433 
hdr
->
’Œy
ðhdr->’Œy + hdr->
’Œy_size
;

434  
FALSE
;

435 
	}
}

450 
my_boÞ
 
	$put_h—d”_’Œy_Çmed
(
DYN_HEADER
 *
hdr
,

451 *
cÞumn_key
,

452 
DYNAMIC_COLUMN_VALUE
 *
v®ue
,

453 
size_t
 
off£t
)

455 
LEX_STRING
 *
cÞumn_Çme
ð(LEX_STRING *)
cÞumn_key
;

456 
	`DBUG_ASSERT
(
cÞumn_Çme
->
Ëngth
 <ð
MAX_NAME_LENGTH
);

457 
	`DBUG_ASSERT
(
hdr
->
Çme
 - hdr->
nmpoÞ
 < () 0x10000L);

458 
	`št2¡Üe
(
hdr
->
’Œy
, hdr->
Çme
 - hdr->
nmpoÞ
);

459 
	`memýy
(
hdr
->
Çme
, 
cÞumn_Çme
->
¡r
, cÞumn_Çme->
Ëngth
);

460 
	`DBUG_ASSERT
(
hdr
->
nmpoÞ_size
 !ð0 || 
cÞumn_Çme
->
Ëngth
 == 0);

461 ià(
	`ty³_ªd_off£t_¡Üe_Çmed
(
hdr
->
’Œy
, hdr->
off£t_size
,

462 
v®ue
->
ty³
,

463 
off£t
))

464  
TRUE
;

465 
hdr
->
’Œy
+ðhdr->
’Œy_size
;

466 
hdr
->
Çme
+ð
cÞumn_Çme
->
Ëngth
;

467  
FALSE
;

468 
	}
}

479 
size_t
 
	$dyÇmic_cÞumn_off£t_by‹s_num
(
size_t
 
d©a_Ëngth
)

481 ià(
d©a_Ëngth
 < 0x1f)

483 ià(
d©a_Ëngth
 < 0x1fff)

485 ià(
d©a_Ëngth
 < 0x1fffff)

487 ià(
d©a_Ëngth
 < 0x1fffffff)

489  
MAX_OFFSET_LENGTH
 + 1;

490 
	}
}

492 
size_t
 
	$dyÇmic_cÞumn_off£t_by‹s_Çmed
(
size_t
 
d©a_Ëngth
)

494 ià(
d©a_Ëngth
 < 0xfff)

496 ià(
d©a_Ëngth
 < 0xfffff)

498 ià(
d©a_Ëngth
 < 0xfffffff)

500 #ià
SIZEOF_SIZE_T
 > 4

501 ià(
d©a_Ëngth
 < 0xfffffffffull)

504  
MAX_OFFSET_LENGTH_NM
 + 1;

505 
	}
}

516 
my_boÞ
 
	$ty³_ªd_off£t_»ad_num
(
DYNAMIC_COLUMN_TYPE
 *
ty³
,

517 
size_t
 *
off£t
,

518 
uch¬
 *
¶aû
, 
size_t
 
off£t_size
)

520 
ulÚg
 
	`UNINIT_VAR
(
v®
);

521 
ulÚg
 
	`UNINIT_VAR
(
lim
);

523 
	`DBUG_ASSERT
(
off£t_size
 >= 1 && offset_size <= 4);

525 
off£t_size
) {

527 
v®
ð(
ulÚg
)
¶aû
[0];

528 
lim
= 0x1f;

531 
v®
ð
	`ušt2kÜr
(
¶aû
);

532 
lim
= 0x1fff;

535 
v®
ð
	`ušt3kÜr
(
¶aû
);

536 
lim
= 0x1fffff;

539 
v®
ð
	`ušt4kÜr
(
¶aû
);

540 
lim
= 0x1fffffff;

543 
	`DBUG_ASSERT
(0);

546 *
ty³
ð(
v®
 & 0x7) + 1;

547 *
off£t
ð
v®
 >> 3;

548  (*
off£t
 >ð
lim
);

549 
	}
}

551 
my_boÞ
 
	$ty³_ªd_off£t_»ad_Çmed
(
DYNAMIC_COLUMN_TYPE
 *
ty³
,

552 
size_t
 *
off£t
,

553 
uch¬
 *
¶aû
, 
size_t
 
off£t_size
)

555 
ulÚglÚg
 
	`UNINIT_VAR
(
v®
);

556 
ulÚglÚg
 
	`UNINIT_VAR
(
lim
);

557 
	`DBUG_ASSERT
(
off£t_size
 >= 2 && offset_size <= 5);

559 
off£t_size
) {

561 
v®
ð
	`ušt2kÜr
(
¶aû
);

562 
lim
= 0xfff;

565 
v®
ð
	`ušt3kÜr
(
¶aû
);

566 
lim
= 0xfffff;

569 
v®
ð
	`ušt4kÜr
(
¶aû
);

570 
lim
= 0xfffffff;

573 
v®
ð
	`ušt5kÜr
(
¶aû
);

574 
lim
= 0xfffffffffull;

578 
	`DBUG_ASSERT
(0);

581 *
ty³
ð(
v®
 & 0xf) + 1;

582 *
off£t
ð(
size_t
)(
v®
 >> 4);

583  (*
off£t
 >ð
lim
);

584 
	}
}

591 
	s¡_£rviû_funcs


594 
ušt
 
	mfixed_hdr
;

596 
ušt
 
	mfixed_hdr_’Œy
;

599 
ušt
 
	mkey_size_š_¬¿y
;

602 
size_t
 
	mmax_off£t_size
;

604 
size_t
 (*
Çme_size
)

605 (*, 
	mušt
);

606 (*
	mcÞumn_sÜt
)

607 (cÚ¡ *
	ma
, cÚ¡ *
	mb
);

608 
my_boÞ
 (*
check_lim™
)

609 (cÚ¡ *
	mv®
);

610 (*
	m£t_fixed_hdr
)

611 (
DYNAMIC_COLUMN
 *
	m¡r
, 
DYN_HEADER
 *
	mhdr
);

612 
my_boÞ
 (*
put_h—d”_’Œy
)(
DYN_HEADER
 *
	mhdr
,

613 *
	mcÞumn_key
,

614 
DYNAMIC_COLUMN_VALUE
 *
	mv®ue
,

615 
size_t
 
	moff£t
);

616 (*
	m¶ª_sÜt
)(cÚ¡ *
	ma
, cÚ¡ *
	mb
);

617 
size_t
 (*
dyÇmic_cÞumn_off£t_by‹s
)(size_ˆ
	md©a_Ëngth
);

618 
my_boÞ
 (*
ty³_ªd_off£t_»ad
)(
DYNAMIC_COLUMN_TYPE
 *
	mty³
,

619 
size_t
 *
	moff£t
,

620 
uch¬
 *
	m¶aû
, 
size_t
 
	moff£t_size
);

629 
¡_£rviû_funcs
 
	gfmt_d©a
[2]=

632 
FIXED_HEADER_SIZE
,

633 
COLUMN_NUMBER_SIZE
,

634 (
ušt
),

635 
MAX_OFFSET_LENGTH
,

636 &
Çme_size_num
,

637 &
cÞumn_sÜt_num
,

638 &
check_lim™_num
,

639 &
£t_fixed_h—d”_num
,

640 &
put_h—d”_’Œy_num
,

641 &
¶ª_sÜt_num
,

642 &
dyÇmic_cÞumn_off£t_by‹s_num
,

643 &
ty³_ªd_off£t_»ad_num


646 
FIXED_HEADER_SIZE_NM
,

647 
COLUMN_NAMEPTR_SIZE
,

648 (
LEX_STRING
),

649 
MAX_OFFSET_LENGTH_NM
,

650 &
Çme_size_Çmed
,

651 &
cÞumn_sÜt_Çmed
,

652 &
check_lim™_Çmed
,

653 &
£t_fixed_h—d”_Çmed
,

654 &
put_h—d”_’Œy_Çmed
,

655 &
¶ª_sÜt_Çmed
,

656 &
dyÇmic_cÞumn_off£t_by‹s_Çmed
,

657 &
ty³_ªd_off£t_»ad_Çmed


671 
’um_dyncÞ_func_»suÉ


672 
	$š™_»ad_hdr
(
DYN_HEADER
 *
hdr
, 
DYNAMIC_COLUMN
 *
¡r
)

674 ià(
	`»ad_fixed_h—d”
(
hdr
, 
¡r
))

675  
ER_DYNCOL_FORMAT
;

676 
hdr
->
h—d”
ð(
uch¬
*)
¡r
->¡¸+ 
fmt_d©a
[hdr->
fÜm©
].
fixed_hdr
;

677 
	`ÿlc_·¿m
(&
hdr
->
’Œy_size
, &hdr->
h—d”_size
,

678 
fmt_d©a
[
hdr
->
fÜm©
].
fixed_hdr_’Œy
, hdr->
off£t_size
,

679 
hdr
->
cÞumn_couÁ
);

680 
hdr
->
nmpoÞ
ðhdr->
h—d”
 + hdr->
h—d”_size
;

681 
hdr
->
doÞ
ðhdr->
nmpoÞ
 + hdr->
nmpoÞ_size
;

682 
hdr
->
d©a_size
ð
¡r
->
Ëngth
 - 
fmt_d©a
[hdr->
fÜm©
].
fixed_hdr
 -

683 
hdr
->
h—d”_size
 - hdr->
nmpoÞ_size
;

684 
hdr
->
d©a_’d
ð(
uch¬
*)
¡r
->¡¸+ sŒ->
Ëngth
;

685  
ER_DYNCOL_OK
;

686 
	}
}

699 
my_boÞ
 
	$dyÇmic_cÞumn_š™_Çmed
(
DYNAMIC_COLUMN
 *
¡r
, 
size_t
 
size
)

701 
	`DBUG_ASSERT
(
size
 != 0);

708 ià(
	`ma_š™_dyÇmic_¡ršg
(
¡r
, 
NULL
, 
size
, 
DYNCOL_SYZERESERVE
))

709  
TRUE
;

710  
FALSE
;

711 
	}
}

723 
size_t
 
	$dyÇmic_cÞumn_v¬_ušt_by‹s
(
ulÚglÚg
 
v®
)

725 
size_t
 
Ën
= 0;

728 
Ën
++;

729 
v®
>>= 7;

730 } 
v®
);

731  
Ën
;

732 
	}
}

749 
’um_dyncÞ_func_»suÉ


750 
	$dyÇmic_cÞumn_v¬_ušt_¡Üe
(
DYNAMIC_COLUMN
 *
¡r
, 
ulÚglÚg
 
v®
)

752 ià(
	`ma_dyn¡r_»®loc
(
¡r
, 10))

753  
ER_DYNCOL_RESOURCE
;

757 
ulÚglÚg
 
»¡
ð
v®
 >> 7;

758 
¡r
->¡r[¡r->
Ëngth
++]ð((
v®
 & 0x7fè| (
»¡
 ? 0x80 : 0x00));

759 
v®
ð
»¡
;

760 } 
v®
);

761  
ER_DYNCOL_OK
;

762 
	}
}

777 
ulÚglÚg


778 
	$dyÇmic_cÞumn_v¬_ušt_g‘
(
uch¬
 *
d©a
, 
size_t
 
d©a_Ëngth
,

779 
size_t
 *
Ën
)

781 
ulÚglÚg
 
v®
= 0;

782 
ušt
 
Ëngth
;

783 
uch¬
 *
’d
ð
d©a
 + 
d©a_Ëngth
;

785 
Ëngth
=0; 
d©a
 < 
’d
 ; data++)

787 
v®
+ð(((
ulÚglÚg
)((*
d©a
è& 0x7f)è<< (
Ëngth
 * 7));

788 
Ëngth
++;

789 ià(!((*
d©a
) & 0x80))

792 *
Ën
ð
Ëngth
;

793  
v®
;

797 *
Ën
= 0;

799 
	}
}

810 
size_t
 
	$dyÇmic_cÞumn_ušt_by‹s
(
ulÚglÚg
 
v®
)

812 
size_t
 
Ën
;

814 
Ën
ð0; 
v®
 ; val>>= 8,†en++)

816  
Ën
;

817 
	}
}

829 
’um_dyncÞ_func_»suÉ


830 
	$dyÇmic_cÞumn_ušt_¡Üe
(
DYNAMIC_COLUMN
 *
¡r
, 
ulÚglÚg
 
v®
)

832 ià(
	`ma_dyn¡r_»®loc
(
¡r
, 8))

833  
ER_DYNCOL_RESOURCE
;

835 ; 
v®
; val>>= 8)

836 
¡r
->¡r[¡r->
Ëngth
++]ð(è(
v®
 & 0xff);

837  
ER_DYNCOL_OK
;

838 
	}
}

851 
’um_dyncÞ_func_»suÉ


852 
	$dyÇmic_cÞumn_ušt_»ad
(
DYNAMIC_COLUMN_VALUE
 *
¡Üe_™_h”e
,

853 
uch¬
 *
d©a
, 
size_t
 
Ëngth
)

855 
ulÚglÚg
 
v®ue
= 0;

856 
size_t
 
i
;

858 
i
ð0; i < 
Ëngth
; i++)

859 
v®ue
+ð((
ulÚglÚg
)
d©a
[
i
]) << (i*8);

861 
¡Üe_™_h”e
->
x
.
ulÚg_v®ue
ð
v®ue
;

862  
ER_DYNCOL_OK
;

863 
	}
}

879 
size_t
 
	$dyÇmic_cÞumn_sšt_by‹s
(
lÚglÚg
 
v®
)

881  
	`dyÇmic_cÞumn_ušt_by‹s
((
v®
 << 1) ^

882 (
v®
 < 0 ? 0xffffffffffffffffull : 0));

883 
	}
}

895 
’um_dyncÞ_func_»suÉ


896 
	$dyÇmic_cÞumn_sšt_¡Üe
(
DYNAMIC_COLUMN
 *
¡r
, 
lÚglÚg
 
v®
)

898  
	`dyÇmic_cÞumn_ušt_¡Üe
(
¡r
,

899 (
v®
 << 1) ^

900 (
v®
 < 0 ? 0xffffffffffffffffULL : 0));

901 
	}
}

914 
’um_dyncÞ_func_»suÉ


915 
	$dyÇmic_cÞumn_sšt_»ad
(
DYNAMIC_COLUMN_VALUE
 *
¡Üe_™_h”e
,

916 
uch¬
 *
d©a
, 
size_t
 
Ëngth
)

918 
ulÚglÚg
 
v®
;

919 
	`dyÇmic_cÞumn_ušt_»ad
(
¡Üe_™_h”e
, 
d©a
, 
Ëngth
);

920 
v®
ð
¡Üe_™_h”e
->
x
.
ulÚg_v®ue
;

921 ià(
v®
 & 1)

922 
v®
= (val >> 1) ^ 0xffffffffffffffffULL;

924 
v®
>>= 1;

925 
¡Üe_™_h”e
->
x
.
lÚg_v®ue
ð(
lÚglÚg
è
v®
;

926  
ER_DYNCOL_OK
;

927 
	}
}

940 
size_t


941 
	$dyÇmic_cÞumn_v®ue_Ën
(
DYNAMIC_COLUMN_VALUE
 *
v®ue
,

942 
’um_dyncÞ_fÜm©
 
fÜm©
)

944 
v®ue
->
ty³
) {

945 
DYN_COL_NULL
:

947 
DYN_COL_INT
:

948  
	`dyÇmic_cÞumn_sšt_by‹s
(
v®ue
->
x
.
lÚg_v®ue
);

949 
DYN_COL_UINT
:

950  
	`dyÇmic_cÞumn_ušt_by‹s
(
v®ue
->
x
.
ulÚg_v®ue
);

951 
DYN_COL_DOUBLE
:

953 
DYN_COL_STRING
:

954 #ifdeà
LIBMARIADB


955  (
	`dyÇmic_cÞumn_v¬_ušt_by‹s
(
v®ue
->
x
.
¡ršg
.
ch¬£t
->
Ä
) +

956 
v®ue
->
x
.
¡ršg
.v®ue.
Ëngth
);

958  (
	`dyÇmic_cÞumn_v¬_ušt_by‹s
(
v®ue
->
x
.
¡ršg
.
ch¬£t
->
numb”
) +

959 
v®ue
->
x
.
¡ršg
.v®ue.
Ëngth
);

961 #iâdeà
LIBMARIADB


962 
DYN_COL_DECIMAL
:

964 
´ecisiÚ
ð
v®ue
->
x
.
decim®
.v®ue.
štg
 + v®ue->x.decim®.v®ue.
äac
;

965 
sÿË
ð
v®ue
->
x
.
decim®
.v®ue.
äac
;

967 ià(
´ecisiÚ
 =ð0 || 
	`decim®_is_z”o
(&
v®ue
->
x
.
decim®
.value))

970 
v®ue
->
x
.
decim®
.v®ue.
štg
ðv®ue->x.decim®.v®ue.
äac
= 0;

980 ià(
sÿË
 < 0 || 
´ecisiÚ
 <= 0)

982 
	`DBUG_ASSERT
(0);

983  (
size_t
) ~0;

985  (
	`dyÇmic_cÞumn_v¬_ušt_by‹s
(
v®ue
->
x
.
decim®
.v®ue.
štg
) +

986 
	`dyÇmic_cÞumn_v¬_ušt_by‹s
(
v®ue
->
x
.
decim®
.v®ue.
äac
) +

987 
	`decim®_bš_size
(
´ecisiÚ
, 
sÿË
));

990 
DYN_COL_DATETIME
:

991 ià(
fÜm©
 =ð
dyncÞ_fmt_num
 || 
v®ue
->
x
.
time_v®ue
.
£cÚd_·¹
)

996 
DYN_COL_DATE
:

999 
DYN_COL_TIME
:

1000 ià(
fÜm©
 =ð
dyncÞ_fmt_num
 || 
v®ue
->
x
.
time_v®ue
.
£cÚd_·¹
)

1005 
DYN_COL_DYNCOL
:

1006  
v®ue
->
x
.
¡ršg
.v®ue.
Ëngth
;

1010 
	`DBUG_ASSERT
(0);

1012 
	}
}

1024 
’um_dyncÞ_func_»suÉ


1025 
	$dyÇmic_cÞumn_doubË_¡Üe
(
DYNAMIC_COLUMN
 *
¡r
, 
v®
)

1027 ià(
	`ma_dyn¡r_»®loc
(
¡r
, 8))

1028  
ER_DYNCOL_RESOURCE
;

1029 
	`æßt8¡Üe
(
¡r
->¡¸+ sŒ->
Ëngth
, 
v®
);

1030 
¡r
->
Ëngth
+= 8;

1031  
ER_DYNCOL_OK
;

1032 
	}
}

1045 
’um_dyncÞ_func_»suÉ


1046 
	$dyÇmic_cÞumn_doubË_»ad
(
DYNAMIC_COLUMN_VALUE
 *
¡Üe_™_h”e
,

1047 
uch¬
 *
d©a
, 
size_t
 
Ëngth
)

1049 ià(
Ëngth
 != 8)

1050  
ER_DYNCOL_FORMAT
;

1051 
	`æßt8g‘
(
¡Üe_™_h”e
->
x
.
doubË_v®ue
, 
d©a
);

1052  
ER_DYNCOL_OK
;

1053 
	}
}

1065 
’um_dyncÞ_func_»suÉ


1066 
	$dyÇmic_cÞumn_¡ršg_¡Üe
(
DYNAMIC_COLUMN
 *
¡r
, 
LEX_STRING
 *
¡ršg
,

1067 
MARIADB_CHARSET_INFO
 *
ch¬£t
)

1069 
’um_dyncÞ_func_»suÉ
 
rc
;

1070 #ifdeà
LIBMARIADB


1071 ià((
rc
ð
	`dyÇmic_cÞumn_v¬_ušt_¡Üe
(
¡r
, 
ch¬£t
->
Ä
)))

1073 ià((
rc
ð
	`dyÇmic_cÞumn_v¬_ušt_¡Üe
(
¡r
, 
ch¬£t
->
numb”
)))

1075  
rc
;

1076 ià(
	`ma_dyn¡r_­³nd_mem
(
¡r
, 
¡ršg
->¡r, sŒšg->
Ëngth
))

1077  
ER_DYNCOL_RESOURCE
;

1078  
ER_DYNCOL_OK
;

1079 
	}
}

1090 
’um_dyncÞ_func_»suÉ


1091 
	$dyÇmic_cÞumn_dyncÞ_¡Üe
(
DYNAMIC_COLUMN
 *
¡r
, 
LEX_STRING
 *
¡ršg
)

1093 ià(
	`ma_dyn¡r_­³nd_mem
(
¡r
, 
¡ršg
->¡r, sŒšg->
Ëngth
))

1094  
ER_DYNCOL_RESOURCE
;

1095  
ER_DYNCOL_OK
;

1096 
	}
}

1108 
’um_dyncÞ_func_»suÉ


1109 
	$dyÇmic_cÞumn_¡ršg_»ad
(
DYNAMIC_COLUMN_VALUE
 *
¡Üe_™_h”e
,

1110 
uch¬
 *
d©a
, 
size_t
 
Ëngth
)

1112 
size_t
 
Ën
;

1113 
ušt
 
ch¬£t_Ä
ð(ušt)
	`dyÇmic_cÞumn_v¬_ušt_g‘
(
d©a
, 
Ëngth
, &
Ën
);

1114 ià(
Ën
 == 0)

1115  
ER_DYNCOL_FORMAT
;

1116 #iâdeà
LIBMARIADB


1117 
¡Üe_™_h”e
->
x
.
¡ršg
.
ch¬£t
ð
	`g‘_ch¬£t_by_Ä
(
ch¬£t_Ä
);

1119 
¡Üe_™_h”e
->
x
.
¡ršg
.
ch¬£t
ð
	`m¬Ÿdb_g‘_ch¬£t_by_Ä
(
ch¬£t_Ä
);

1121 ià(
¡Üe_™_h”e
->
x
.
¡ršg
.
ch¬£t
 =ð
NULL
)

1122  
ER_DYNCOL_UNKNOWN_CHARSET
;

1123 
d©a
+ð
Ën
;

1124 
¡Üe_™_h”e
->
x
.
¡ršg
.
v®ue
.
Ëngth
ðÖ’gth-ð
Ën
);

1125 
¡Üe_™_h”e
->
x
.
¡ršg
.
v®ue
.
¡r
ð(*è
d©a
;

1126  
ER_DYNCOL_OK
;

1127 
	}
}

1140 
’um_dyncÞ_func_»suÉ


1141 
	$dyÇmic_cÞumn_dyncÞ_»ad
(
DYNAMIC_COLUMN_VALUE
 *
¡Üe_™_h”e
,

1142 
uch¬
 *
d©a
, 
size_t
 
Ëngth
)

1144 
¡Üe_™_h”e
->
x
.
¡ršg
.
ch¬£t
ð
ma_ch¬£t_bš
;

1145 
¡Üe_™_h”e
->
x
.
¡ršg
.
v®ue
.
Ëngth
=†ength;

1146 
¡Üe_™_h”e
->
x
.
¡ršg
.
v®ue
.
¡r
ð(*è
d©a
;

1147  
ER_DYNCOL_OK
;

1148 
	}
}

1158 #iâdeà
LIBMARIADB


1159 
’um_dyncÞ_func_»suÉ


1160 
	$dyÇmic_cÞumn_decim®_¡Üe
(
DYNAMIC_COLUMN
 *
¡r
,

1161 
decim®_t
 *
v®ue
)

1163 
ušt
 
bš_size
;

1164 
´ecisiÚ
ð
v®ue
->
štg
 + v®ue->
äac
;

1167 ià(
´ecisiÚ
 == 0)

1168  
ER_DYNCOL_OK
;

1170 
bš_size
ð
	`decim®_bš_size
(
´ecisiÚ
, 
v®ue
->
äac
);

1171 ià(
	`ma_dyn¡r_»®loc
(
¡r
, 
bš_size
 + 20))

1172  
ER_DYNCOL_RESOURCE
;

1175 (è
	`dyÇmic_cÞumn_v¬_ušt_¡Üe
(
¡r
, 
v®ue
->
štg
);

1176 (è
	`dyÇmic_cÞumn_v¬_ušt_¡Üe
(
¡r
, 
v®ue
->
äac
);

1178 
	`decim®2bš
(
v®ue
, (
uch¬
 *è
¡r
->¡¸+ sŒ->
Ëngth
,

1179 
´ecisiÚ
, 
v®ue
->
äac
);

1180 
¡r
->
Ëngth
+ð
bš_size
;

1181  
ER_DYNCOL_OK
;

1182 
	}
}

1191 
	$m¬Ÿdb_dyncÞ_´•¬e_decim®
(
DYNAMIC_COLUMN_VALUE
 *
v®ue
)

1193 
v®ue
->
x
.
decim®
.v®ue.
buf
ðv®ue->x.decim®.
bufãr
;

1194 
v®ue
->
x
.
decim®
.v®ue.
Ën
ð
DECIMAL_BUFF_LENGTH
;

1196 
v®ue
->
ty³
ð
DYN_COL_DECIMAL
;

1197 
	`decim®_make_z”o
(&
v®ue
->
x
.
decim®
.value);

1198 
	}
}

1200 
	$dyÇmic_cÞumn_´•¬e_decim®
(
DYNAMIC_COLUMN_VALUE
 *
v®ue
)

1202 
	`m¬Ÿdb_dyncÞ_´•¬e_decim®
(
v®ue
);

1203 
	}
}

1217 
’um_dyncÞ_func_»suÉ


1218 
	$dyÇmic_cÞumn_decim®_»ad
(
DYNAMIC_COLUMN_VALUE
 *
¡Üe_™_h”e
,

1219 
uch¬
 *
d©a
, 
size_t
 
Ëngth
)

1221 
size_t
 
štg_Ën
, 
äac_Ën
;

1222 
štg
, 
äac
, 
´ecisiÚ
, 
sÿË
;

1224 
	`dyÇmic_cÞumn_´•¬e_decim®
(
¡Üe_™_h”e
);

1226 ià(
Ëngth
 == 0)

1227  
ER_DYNCOL_OK
;

1229 
štg
ð()
	`dyÇmic_cÞumn_v¬_ušt_g‘
(
d©a
, 
Ëngth
, &
štg_Ën
);

1230 
d©a
+ð
štg_Ën
;

1231 
äac
ð()
	`dyÇmic_cÞumn_v¬_ušt_g‘
(
d©a
, 
Ëngth
 - 
štg_Ën
, &
äac_Ën
);

1232 
d©a
+ð
äac_Ën
;

1235 
´ecisiÚ
ð
štg
 + 
äac
;

1236 
sÿË
ð
äac
;

1237 ià(
sÿË
 < 0 || 
´ecisiÚ
 <= 0 || scale >…recision ||

1238 (
Ëngth
 - 
štg_Ën
 - 
äac_Ën
) >

1239 (
size_t
è(
DECIMAL_BUFF_LENGTH
*(
decim®_dig™_t
)) ||

1240 
	`decim®_bš_size
(
štg
 + 
äac
, frac) !=

1241 (è(
Ëngth
 - 
štg_Ën
 - 
äac_Ën
))

1242  
ER_DYNCOL_FORMAT
;

1244 ià(
	`bš2decim®
(
d©a
, &
¡Üe_™_h”e
->
x
.
decim®
.
v®ue
, 
´ecisiÚ
, 
sÿË
) !=

1245 
E_DEC_OK
)

1246  
ER_DYNCOL_FORMAT
;

1247  
ER_DYNCOL_OK
;

1248 
	}
}

1260 
’um_dyncÞ_func_»suÉ


1261 
	$dyÇmic_cÞumn_d©e_time_¡Üe
(
DYNAMIC_COLUMN
 *
¡r
, 
MYSQL_TIME
 *
v®ue
,

1262 
’um_dyncÞ_fÜm©
 
fÜm©
)

1264 
’um_dyncÞ_func_»suÉ
 
rc
;

1270 ià((
rc
ð
	`dyÇmic_cÞumn_d©e_¡Üe
(
¡r
, 
v®ue
)) ||

1271 (
rc
ð
	`dyÇmic_cÞumn_time_¡Üe
(
¡r
, 
v®ue
, 
fÜm©
)))

1272  
rc
;

1273  
ER_DYNCOL_OK
;

1274 
	}
}

1287 
’um_dyncÞ_func_»suÉ


1288 
	$dyÇmic_cÞumn_d©e_time_»ad
(
DYNAMIC_COLUMN_VALUE
 *
¡Üe_™_h”e
,

1289 
uch¬
 *
d©a
, 
size_t
 
Ëngth
)

1291 
’um_dyncÞ_func_»suÉ
 
rc
ð
ER_DYNCOL_FORMAT
;

1297 ià(
Ëngth
 != 9 &&†ength != 6)

1298 
”r
;

1299 
¡Üe_™_h”e
->
x
.
time_v®ue
.
time_ty³
ð
MYSQL_TIMESTAMP_DATETIME
;

1300 ià((
rc
ð
	`dyÇmic_cÞumn_d©e_»ad_š‹º®
(
¡Üe_™_h”e
, 
d©a
, 3)) ||

1301 (
rc
ð
	`dyÇmic_cÞumn_time_»ad_š‹º®
(
¡Üe_™_h”e
, 
d©a
 + 3,

1302 
Ëngth
 - 3)))

1303 
”r
;

1304  
ER_DYNCOL_OK
;

1306 
”r
:

1307 
¡Üe_™_h”e
->
x
.
time_v®ue
.
time_ty³
ð
MYSQL_TIMESTAMP_ERROR
;

1308  
rc
;

1309 
	}
}

1321 
’um_dyncÞ_func_»suÉ


1322 
	$dyÇmic_cÞumn_time_¡Üe
(
DYNAMIC_COLUMN
 *
¡r
, 
MYSQL_TIME
 *
v®ue
,

1323 
’um_dyncÞ_fÜm©
 
fÜm©
)

1325 
uch¬
 *
buf
;

1326 ià(
	`ma_dyn¡r_»®loc
(
¡r
, 6))

1327  
ER_DYNCOL_RESOURCE
;

1329 
buf
ð((
uch¬
 *)
¡r
->¡rè+ sŒ->
Ëngth
;

1331 ià(
v®ue
->
time_ty³
 =ð
MYSQL_TIMESTAMP_NONE
 ||

1332 
v®ue
->
time_ty³
 =ð
MYSQL_TIMESTAMP_ERROR
 ||

1333 
v®ue
->
time_ty³
 =ð
MYSQL_TIMESTAMP_DATE
)

1335 
v®ue
->
Ãg
= 0;

1336 
v®ue
->
£cÚd_·¹
= 0;

1337 
v®ue
->
hour
= 0;

1338 
v®ue
->
mšu‹
= 0;

1339 
v®ue
->
£cÚd
= 0;

1341 
	`DBUG_ASSERT
(
v®ue
->
hour
 <= 838);

1342 
	`DBUG_ASSERT
(
v®ue
->
mšu‹
 <= 59);

1343 
	`DBUG_ASSERT
(
v®ue
->
£cÚd
 <= 59);

1344 
	`DBUG_ASSERT
(
v®ue
->
£cÚd_·¹
 <= 999999);

1345 ià(
fÜm©
 =ð
dyncÞ_fmt_num
 || 
v®ue
->
£cÚd_·¹
)

1352 
buf
[0]ð(
v®ue
->
£cÚd_·¹
 & 0xff);

1353 
buf
[1]ð((
v®ue
->
£cÚd_·¹
 & 0xff00) >> 8);

1354 
buf
[2]ð(
uch¬
)(((
v®ue
->
£cÚd
 & 0xf) << 4) |

1355 ((
v®ue
->
£cÚd_·¹
 & 0xf0000) >> 16));

1356 
buf
[3]ð((
v®ue
->
mšu‹
 << 2è| ((v®ue->
£cÚd
 & 0x30) >> 4));

1357 
buf
[4]ð(
v®ue
->
hour
 & 0xff);

1358 
buf
[5]ð((
v®ue
->
Ãg
 ? 0x4 : 0è| (v®ue->
hour
 >> 8));

1359 
¡r
->
Ëngth
+= 6;

1368 
buf
[0]ð(
v®ue
->
£cÚd
è| ((v®ue->
mšu‹
 & 0x3) << 6);

1369 
buf
[1]ð(
v®ue
->
mšu‹
 >> 2è| ((v®ue->
hour
 & 0xf) << 4);

1370 
buf
[2]ð(
v®ue
->
hour
 >> 4è| (v®ue->
Ãg
 ? 0x80 : 0);

1371 
¡r
->
Ëngth
+= 3;

1374  
ER_DYNCOL_OK
;

1375 
	}
}

1388 
’um_dyncÞ_func_»suÉ


1389 
	$dyÇmic_cÞumn_time_»ad
(
DYNAMIC_COLUMN_VALUE
 *
¡Üe_™_h”e
,

1390 
uch¬
 *
d©a
, 
size_t
 
Ëngth
)

1392 
¡Üe_™_h”e
->
x
.
time_v®ue
.
y—r
ð¡Üe_™_h”e->x.time_v®ue.
mÚth
=

1393 
¡Üe_™_h”e
->
x
.
time_v®ue
.
day
= 0;

1394 
¡Üe_™_h”e
->
x
.
time_v®ue
.
time_ty³
ð
MYSQL_TIMESTAMP_TIME
;

1395  
	`dyÇmic_cÞumn_time_»ad_š‹º®
(
¡Üe_™_h”e
, 
d©a
, 
Ëngth
);

1396 
	}
}

1408 
’um_dyncÞ_func_»suÉ


1409 
	$dyÇmic_cÞumn_time_»ad_š‹º®
(
DYNAMIC_COLUMN_VALUE
 *
¡Üe_™_h”e
,

1410 
uch¬
 *
d©a
, 
size_t
 
Ëngth
)

1412 ià(
Ëngth
 != 6 &&†ength != 3)

1413 
”r
;

1414 ià(
Ëngth
 == 6)

1421 
¡Üe_™_h”e
->
x
.
time_v®ue
.
£cÚd_·¹
ð(
d©a
[0] |

1422 (
d©a
[1] << 8) |

1423 ((
d©a
[2] & 0xf) << 16));

1424 
¡Üe_™_h”e
->
x
.
time_v®ue
.
£cÚd
ð((
d©a
[2] >> 4) |

1425 ((
d©a
[3] & 0x3) << 4));

1426 
¡Üe_™_h”e
->
x
.
time_v®ue
.
mšu‹
ð(
d©a
[3] >> 2);

1427 
¡Üe_™_h”e
->
x
.
time_v®ue
.
hour
ð(((((
ušt
)
d©a
[5]) & 0x3 ) << 8) | data[4]);

1428 
¡Üe_™_h”e
->
x
.
time_v®ue
.
Ãg
ð((
d©a
[5] & 0x4) ? 1 : 0);

1437 
¡Üe_™_h”e
->
x
.
time_v®ue
.
£cÚd_·¹
= 0;

1438 
¡Üe_™_h”e
->
x
.
time_v®ue
.
£cÚd
ð(
d©a
[0] & 0x3f);

1439 
¡Üe_™_h”e
->
x
.
time_v®ue
.
mšu‹
ð(
d©a
[0] >> 6) | ((data[1] & 0xf) << 2);

1440 
¡Üe_™_h”e
->
x
.
time_v®ue
.
hour
ð(
d©a
[1] >> 4) | ((data[2] & 0x3f) << 4);

1441 
¡Üe_™_h”e
->
x
.
time_v®ue
.
Ãg
ð((
d©a
[2] & 0x80) ? 1 : 0);

1443 ià(
¡Üe_™_h”e
->
x
.
time_v®ue
.
£cÚd
 > 59 ||

1444 
¡Üe_™_h”e
->
x
.
time_v®ue
.
mšu‹
 > 59 ||

1445 
¡Üe_™_h”e
->
x
.
time_v®ue
.
hour
 > 838 ||

1446 
¡Üe_™_h”e
->
x
.
time_v®ue
.
£cÚd_·¹
 > 999999)

1447 
”r
;

1448  
ER_DYNCOL_OK
;

1450 
”r
:

1451 
¡Üe_™_h”e
->
x
.
time_v®ue
.
time_ty³
ð
MYSQL_TIMESTAMP_ERROR
;

1452  
ER_DYNCOL_FORMAT
;

1453 
	}
}

1465 
’um_dyncÞ_func_»suÉ


1466 
	$dyÇmic_cÞumn_d©e_¡Üe
(
DYNAMIC_COLUMN
 *
¡r
, 
MYSQL_TIME
 *
v®ue
)

1468 
uch¬
 *
buf
;

1469 ià(
	`ma_dyn¡r_»®loc
(
¡r
, 3))

1470  
ER_DYNCOL_RESOURCE
;

1472 
buf
ð((
uch¬
 *)
¡r
->¡rè+ sŒ->
Ëngth
;

1473 ià(
v®ue
->
time_ty³
 =ð
MYSQL_TIMESTAMP_NONE
 ||

1474 
v®ue
->
time_ty³
 =ð
MYSQL_TIMESTAMP_ERROR
 ||

1475 
v®ue
->
time_ty³
 =ð
MYSQL_TIMESTAMP_TIME
)

1476 
v®ue
->
y—r
ðv®ue->
mÚth
ðv®ue->
day
 = 0;

1477 
	`DBUG_ASSERT
(
v®ue
->
y—r
 <= 9999);

1478 
	`DBUG_ASSERT
(
v®ue
->
mÚth
 <= 12);

1479 
	`DBUG_ASSERT
(
v®ue
->
day
 <= 31);

1485 
buf
[0]ð(
v®ue
->
day
 |

1486 ((
v®ue
->
mÚth
 & 0x7) << 5));

1487 
buf
[1]ð((
v®ue
->
mÚth
 >> 3è| ((v®ue->
y—r
 & 0x7F) << 1));

1488 
buf
[2]ð(
v®ue
->
y—r
 >> 7);

1489 
¡r
->
Ëngth
+= 3;

1490  
ER_DYNCOL_OK
;

1491 
	}
}

1505 
’um_dyncÞ_func_»suÉ


1506 
	$dyÇmic_cÞumn_d©e_»ad
(
DYNAMIC_COLUMN_VALUE
 *
¡Üe_™_h”e
,

1507 
uch¬
 *
d©a
, 
size_t
 
Ëngth
)

1509 
¡Üe_™_h”e
->
x
.
time_v®ue
.
Ãg
= 0;

1510 
¡Üe_™_h”e
->
x
.
time_v®ue
.
£cÚd_·¹
= 0;

1511 
¡Üe_™_h”e
->
x
.
time_v®ue
.
hour
= 0;

1512 
¡Üe_™_h”e
->
x
.
time_v®ue
.
mšu‹
= 0;

1513 
¡Üe_™_h”e
->
x
.
time_v®ue
.
£cÚd
= 0;

1514 
¡Üe_™_h”e
->
x
.
time_v®ue
.
time_ty³
ð
MYSQL_TIMESTAMP_DATE
;

1515  
	`dyÇmic_cÞumn_d©e_»ad_š‹º®
(
¡Üe_™_h”e
, 
d©a
, 
Ëngth
);

1516 
	}
}

1528 
’um_dyncÞ_func_»suÉ


1529 
	$dyÇmic_cÞumn_d©e_»ad_š‹º®
(
DYNAMIC_COLUMN_VALUE
 *
¡Üe_™_h”e
,

1530 
uch¬
 *
d©a
,

1531 
size_t
 
Ëngth
)

1533 ià(
Ëngth
 != 3)

1534 
”r
;

1540 
¡Üe_™_h”e
->
x
.
time_v®ue
.
day
ð(
d©a
[0] & 0x1f);

1541 
¡Üe_™_h”e
->
x
.
time_v®ue
.
mÚth
ð(((
d©a
[1] & 0x1) << 3) |

1542 (
d©a
[0] >> 5));

1543 
¡Üe_™_h”e
->
x
.
time_v®ue
.
y—r
ð((((
ušt
)
d©a
[2]) << 7) |

1544 (
d©a
[1] >> 1));

1545 ià(
¡Üe_™_h”e
->
x
.
time_v®ue
.
day
 > 31 ||

1546 
¡Üe_™_h”e
->
x
.
time_v®ue
.
mÚth
 > 12 ||

1547 
¡Üe_™_h”e
->
x
.
time_v®ue
.
y—r
 > 9999)

1548 
”r
;

1549  
ER_DYNCOL_OK
;

1551 
”r
:

1552 
¡Üe_™_h”e
->
x
.
time_v®ue
.
time_ty³
ð
MYSQL_TIMESTAMP_ERROR
;

1553  
ER_DYNCOL_FORMAT
;

1554 
	}
}

1566 
’um_dyncÞ_func_»suÉ


1567 
	$d©a_¡Üe
(
DYNAMIC_COLUMN
 *
¡r
, 
DYNAMIC_COLUMN_VALUE
 *
v®ue
,

1568 
’um_dyncÞ_fÜm©
 
fÜm©
)

1570 
v®ue
->
ty³
) {

1571 
DYN_COL_INT
:

1572  
	`dyÇmic_cÞumn_sšt_¡Üe
(
¡r
, 
v®ue
->
x
.
lÚg_v®ue
);

1573 
DYN_COL_UINT
:

1574  
	`dyÇmic_cÞumn_ušt_¡Üe
(
¡r
, 
v®ue
->
x
.
ulÚg_v®ue
);

1575 
DYN_COL_DOUBLE
:

1576  
	`dyÇmic_cÞumn_doubË_¡Üe
(
¡r
, 
v®ue
->
x
.
doubË_v®ue
);

1577 
DYN_COL_STRING
:

1578  
	`dyÇmic_cÞumn_¡ršg_¡Üe
(
¡r
, &
v®ue
->
x
.
¡ršg
.value,

1579 
v®ue
->
x
.
¡ršg
.
ch¬£t
);

1580 #iâdeà
LIBMARIADB


1581 
DYN_COL_DECIMAL
:

1582  
	`dyÇmic_cÞumn_decim®_¡Üe
(
¡r
, &
v®ue
->
x
.
decim®
.value);

1584 
DYN_COL_DATETIME
:

1586  
	`dyÇmic_cÞumn_d©e_time_¡Üe
(
¡r
, &
v®ue
->
x
.
time_v®ue
, 
fÜm©
);

1587 
DYN_COL_DATE
:

1589  
	`dyÇmic_cÞumn_d©e_¡Üe
(
¡r
, &
v®ue
->
x
.
time_v®ue
);

1590 
DYN_COL_TIME
:

1592  
	`dyÇmic_cÞumn_time_¡Üe
(
¡r
, &
v®ue
->
x
.
time_v®ue
, 
fÜm©
);

1593 
DYN_COL_DYNCOL
:

1594  
	`dyÇmic_cÞumn_dyncÞ_¡Üe
(
¡r
, &
v®ue
->
x
.
¡ršg
.value);

1595 
DYN_COL_NULL
:

1600 
	`DBUG_ASSERT
(0);

1601  
ER_DYNCOL_OK
;

1602 
	}
}

1613 
	$£t_fixed_h—d”
(
DYNAMIC_COLUMN
 *
¡r
,

1614 
ušt
 
off£t_size
,

1615 
ušt
 
cÞumn_couÁ
)

1617 
	`DBUG_ASSERT
(
cÞumn_couÁ
 <= 0xffff);

1618 
	`DBUG_ASSERT
(
off£t_size
 <ð
MAX_OFFSET_LENGTH
);

1619 
¡r
->¡r[0]ð((¡r->¡r[0] & ~
DYNCOL_FLG_OFFSET
) |

1620 (
off£t_size
 - 1));

1621 
	`št2¡Üe
(
¡r
->¡¸+ 1, 
cÞumn_couÁ
);

1622 
	`DBUG_ASSERT
((
¡r
->¡r[0] & (~
DYNCOL_FLG_KNOWN
)) == 0);

1623 
	}
}

1638 
’um_dyncÞ_func_»suÉ


1639 
	$dyÇmic_Ãw_cÞumn_¡Üe
(
DYNAMIC_COLUMN
 *
¡r
,

1640 
DYN_HEADER
 *
hdr
,

1641 
ušt
 
cÞumn_couÁ
,

1642 *
cÞumn_keys
,

1643 
DYNAMIC_COLUMN_VALUE
 *
v®ues
,

1644 
my_boÞ
 
Ãw_¡r
)

1646 
¡_£rviû_funcs
 *
fmt
ð
fmt_d©a
 + 
hdr
->
fÜm©
;

1647 **
cÞumns_Üd”
;

1648 
uch¬
 *
–em’t
;

1649 
ušt
 
i
;

1650 
’um_dyncÞ_func_»suÉ
 
rc
ð
ER_DYNCOL_RESOURCE
;

1651 
size_t
 
®l_h—d”s_size
;

1653 ià(!(
cÞumns_Üd”
ð
	`m®loc
((*)*
cÞumn_couÁ
)))

1654  
ER_DYNCOL_RESOURCE
;

1655 ià(
Ãw_¡r
 || 
¡r
->str == 0)

1657 ià(
cÞumn_couÁ
)

1659 ià(
	`dyÇmic_cÞumn_š™_Çmed
(
¡r
,

1660 
fmt
->
fixed_hdr
 +

1661 
hdr
->
h—d”_size
 +

1662 
hdr
->
nmpoÞ_size
 +

1663 
hdr
->
d©a_size
 +

1664 
DYNCOL_SYZERESERVE
))

1665 
”r
;

1669 
	`dyÇmic_cÞumn_š™Ÿlize
(
¡r
);

1674 
¡r
->
Ëngth
= 0;

1675 ià(
	`ma_dyn¡r_»®loc
(
¡r
,

1676 
fmt
->
fixed_hdr
 +

1677 
hdr
->
h—d”_size
 +

1678 
hdr
->
nmpoÞ_size
 +

1679 
hdr
->
d©a_size
 +

1680 
DYNCOL_SYZERESERVE
))

1681 
”r
;

1683 ià(!
cÞumn_couÁ
)

1685 
	`ä“
(
cÞumns_Üd”
);

1686  
ER_DYNCOL_OK
;

1689 
	`mem£t
(
¡r
->¡r, 0, 
fmt
->
fixed_hdr
);

1690 
¡r
->
Ëngth
ð
fmt
->
fixed_hdr
;

1693 
i
ð0, 
–em’t
ð(
uch¬
 *è
cÞumn_keys
;

1694 
i
 < 
cÞumn_couÁ
;

1695 
i
++, 
–em’t
+ð
fmt
->
key_size_š_¬¿y
)

1696 
cÞumns_Üd”
[
i
]ð(*)
–em’t
;

1697 
	`qsÜt
(
cÞumns_Üd”
, (
size_t
)
cÞumn_couÁ
, (*), 
fmt
->
cÞumn_sÜt
);

1704 
i
ð0; i < 
cÞumn_couÁ
 - 1; i++)

1706 ià((*
fmt
->
check_lim™
)(&
cÞumns_Üd”
[
i
]) ||

1707 (*
fmt
->
cÞumn_sÜt
)(&
cÞumns_Üd”
[
i
], &columns_order[i + 1]) == 0)

1709 
rc
ð
ER_DYNCOL_DATA
;

1710 
”r
;

1713 ià((*
fmt
->
check_lim™
)(&
cÞumns_Üd”
[
i
]))

1715 
rc
ð
ER_DYNCOL_DATA
;

1716 
”r
;

1719 (*
fmt
->
£t_fixed_hdr
)(
¡r
, 
hdr
);

1721 
¡r
->
Ëngth
+ð
hdr
->
h—d”_size
 + hdr->
nmpoÞ_size
;

1723 
hdr
->
’Œy
ðhdr->
h—d”
;

1724 
hdr
->
Çme
ðhdr->
nmpoÞ
;

1725 
®l_h—d”s_size
ð
fmt
->
fixed_hdr
 + 
hdr
->
h—d”_size
 + hdr->
nmpoÞ_size
;

1726 
i
ð0; i < 
cÞumn_couÁ
; i++)

1728 
ušt
 
Üd
ð(ušt)(((
uch¬
*)
cÞumns_Üd”
[
i
] - (uch¬*)
cÞumn_keys
) /

1729 
fmt
->
key_size_š_¬¿y
);

1730 ià(
v®ues
[
Üd
].
ty³
 !ð
DYN_COL_NULL
)

1733 ià((*
fmt
->
put_h—d”_’Œy
)(
hdr
, 
cÞumns_Üd”
[
i
], 
v®ues
 + 
Üd
,

1734 
¡r
->
Ëngth
 - 
®l_h—d”s_size
))

1736 
rc
ð
ER_DYNCOL_FORMAT
;

1737 
”r
;

1741 ià((
rc
ð
	`d©a_¡Üe
(
¡r
, 
v®ues
 + 
Üd
, 
hdr
->
fÜm©
)))

1742 
”r
;

1745 
rc
ð
ER_DYNCOL_OK
;

1746 
”r
:

1747 
	`ä“
(
cÞumns_Üd”
);

1748  
rc
;

1749 
	}
}

1763 
’um_dyncÞ_func_»suÉ


1764 
	$ÿlc_v¬_sizes
(
DYN_HEADER
 *
hdr
,

1765 
ušt
 
cÞumn_couÁ
,

1766 *
cÞumn_keys
,

1767 
DYNAMIC_COLUMN_VALUE
 *
v®ues
)

1769 
¡_£rviû_funcs
 *
fmt
ð
fmt_d©a
 + 
hdr
->
fÜm©
;

1770 
ušt
 
i
;

1771 
hdr
->
nmpoÞ_size
ðhdr->
d©a_size
= 0;

1772 
hdr
->
cÞumn_couÁ
= 0;

1773 
i
ð0; i < 
cÞumn_couÁ
; i++)

1775 ià(
v®ues
[
i
].
ty³
 !ð
DYN_COL_NULL
)

1777 
size_t
 
tmp
;

1778 
hdr
->
cÞumn_couÁ
++;

1779 
hdr
->
d©a_size
+ð(
tmp
ð
	`dyÇmic_cÞumn_v®ue_Ën
(
v®ues
 + 
i
,

1780 
hdr
->
fÜm©
));

1781 ià(
tmp
 =ð(
size_t
) ~0)

1782  
ER_DYNCOL_DATA
;

1783 
hdr
->
nmpoÞ_size
+ð(*
fmt
->
Çme_size
)(
cÞumn_keys
, 
i
);

1790 ià((
hdr
->
off£t_size
ð
fmt
->
	`dyÇmic_cÞumn_off£t_by‹s
(hdr->
d©a_size
)) >=

1791 
fmt
->
max_off£t_size
)

1792  
ER_DYNCOL_LIMIT
;

1795 
hdr
->
’Œy_size
ð
fmt
->
fixed_hdr_’Œy
 + hdr->
off£t_size
;

1796 
hdr
->
h—d”_size
ðhdr->
cÞumn_couÁ
 * hdr->
’Œy_size
;

1797  
ER_DYNCOL_OK
;

1798 
	}
}

1813 
’um_dyncÞ_func_»suÉ


1814 
	$dyÇmic_cÞumn_ü—‹_mªy_š‹º®_fmt
(
DYNAMIC_COLUMN
 *
¡r
,

1815 
ušt
 
cÞumn_couÁ
,

1816 *
cÞumn_keys
,

1817 
DYNAMIC_COLUMN_VALUE
 *
v®ues
,

1818 
my_boÞ
 
Ãw_¡r
,

1819 
my_boÞ
 
¡ršg_keys
)

1821 
DYN_HEADER
 
h—d”
;

1822 
’um_dyncÞ_func_»suÉ
 
rc
;

1823 
	`mem£t
(&
h—d”
, 0, (header));

1824 
h—d”
.
fÜm©
ð(
¡ršg_keys
 ? 1 : 0);

1826 ià(
Ãw_¡r
)

1829 
	`mem£t
(
¡r
, 0, (
DYNAMIC_COLUMN
));

1832 ià((
rc
ð
	`ÿlc_v¬_sizes
(&
h—d”
, 
cÞumn_couÁ
, 
cÞumn_keys
, 
v®ues
)) < 0)

1833  
rc
;

1835  
	`dyÇmic_Ãw_cÞumn_¡Üe
(
¡r
, &
h—d”
,

1836 
cÞumn_couÁ
,

1837 
cÞumn_keys
, 
v®ues
,

1838 
Ãw_¡r
);

1839 
	}
}

1853 
’um_dyncÞ_func_»suÉ


1854 
	$dyÇmic_cÞumn_ü—‹_mªy
(
DYNAMIC_COLUMN
 *
¡r
,

1855 
ušt
 
cÞumn_couÁ
,

1856 
ušt
 *
cÞumn_numb”s
,

1857 
DYNAMIC_COLUMN_VALUE
 *
v®ues
)

1859 (
	`dyÇmic_cÞumn_ü—‹_mªy_š‹º®_fmt
(
¡r
, 
cÞumn_couÁ
,

1860 
cÞumn_numb”s
, 
v®ues
,

1861 
TRUE
, 
FALSE
));

1862 
	}
}

1876 
’um_dyncÞ_func_»suÉ


1877 
	$m¬Ÿdb_dyncÞ_ü—‹_mªy_num
(
DYNAMIC_COLUMN
 *
¡r
,

1878 
ušt
 
cÞumn_couÁ
,

1879 
ušt
 *
cÞumn_numb”s
,

1880 
DYNAMIC_COLUMN_VALUE
 *
v®ues
,

1881 
my_boÞ
 
Ãw_¡ršg
)

1883 (
	`dyÇmic_cÞumn_ü—‹_mªy_š‹º®_fmt
(
¡r
, 
cÞumn_couÁ
,

1884 
cÞumn_numb”s
, 
v®ues
,

1885 
Ãw_¡ršg
, 
FALSE
));

1886 
	}
}

1900 
’um_dyncÞ_func_»suÉ


1901 
	$m¬Ÿdb_dyncÞ_ü—‹_mªy_Çmed
(
DYNAMIC_COLUMN
 *
¡r
,

1902 
ušt
 
cÞumn_couÁ
,

1903 
LEX_STRING
 *
cÞumn_keys
,

1904 
DYNAMIC_COLUMN_VALUE
 *
v®ues
,

1905 
my_boÞ
 
Ãw_¡ršg
)

1907 (
	`dyÇmic_cÞumn_ü—‹_mªy_š‹º®_fmt
(
¡r
, 
cÞumn_couÁ
,

1908 
cÞumn_keys
, 
v®ues
,

1909 
Ãw_¡ršg
, 
TRUE
));

1910 
	}
}

1922 
’um_dyncÞ_func_»suÉ


1923 
	$dyÇmic_cÞumn_ü—‹
(
DYNAMIC_COLUMN
 *
¡r
, 
ušt
 
cÞumn_Ä
,

1924 
DYNAMIC_COLUMN_VALUE
 *
v®ue
)

1926 (
	`dyÇmic_cÞumn_ü—‹_mªy
(
¡r
, 1, &
cÞumn_Ä
, 
v®ue
));

1927 
	}
}

1942 
size_t
 
	$g‘_Ëngth_š‹rv®
(
uch¬
 *
’Œy
, uch¬ *
’Œy_Ãxt
,

1943 
uch¬
 *
h—d”_’d
, 
size_t
 
off£t_size
,

1944 
size_t
 
Ï¡_off£t
)

1946 
size_t
 
off£t
, 
off£t_Ãxt
;

1947 
DYNAMIC_COLUMN_TYPE
 
ty³
, 
ty³_Ãxt
;

1948 
	`DBUG_ASSERT
(
’Œy
 < 
’Œy_Ãxt
);

1950 ià(
	`ty³_ªd_off£t_»ad_num
(&
ty³
, &
off£t
, 
’Œy
 + 
COLUMN_NUMBER_SIZE
,

1951 
off£t_size
))

1952  
DYNCOL_OFFSET_ERROR
;

1953 ià(
’Œy_Ãxt
 >ð
h—d”_’d
)

1954  (
Ï¡_off£t
 - 
off£t
);

1955 ià(
	`ty³_ªd_off£t_»ad_num
(&
ty³_Ãxt
, &
off£t_Ãxt
,

1956 
’Œy_Ãxt
 + 
COLUMN_NUMBER_SIZE
, 
off£t_size
))

1957  
DYNCOL_OFFSET_ERROR
;

1958  (
off£t_Ãxt
 - 
off£t
);

1959 
	}
}

1972 
size_t
 
	$hdr_š‹rv®_Ëngth
(
DYN_HEADER
 *
hdr
, 
uch¬
 *
Ãxt_’Œy
)

1974 
¡_£rviû_funcs
 *
fmt
ð
fmt_d©a
 + 
hdr
->
fÜm©
;

1975 
size_t
 
Ãxt_’Œy_off£t
;

1976 
DYNAMIC_COLUMN_TYPE
 
Ãxt_’Œy_ty³
;

1977 
	`DBUG_ASSERT
(
hdr
->
’Œy
 < 
Ãxt_’Œy
);

1978 
	`DBUG_ASSERT
(
hdr
->
’Œy
 >ðhdr->
h—d”
);

1979 
	`DBUG_ASSERT
(
Ãxt_’Œy
 <ð
hdr
->
h—d”
 + hdr->
h—d”_size
);

1981 ià((*
fmt
->
ty³_ªd_off£t_»ad
)(&
hdr
->
ty³
, &hdr->
off£t
,

1982 
hdr
->
’Œy
 + 
fmt
->
fixed_hdr_’Œy
,

1983 
hdr
->
off£t_size
))

1984  
DYNCOL_OFFSET_ERROR
;

1985 ià(
Ãxt_’Œy
 =ð
hdr
->
h—d”
 + hdr->
h—d”_size
)

1986  
hdr
->
d©a_size
 - hdr->
off£t
;

1987 ià((*
fmt
->
ty³_ªd_off£t_»ad
)(&
Ãxt_’Œy_ty³
, &
Ãxt_’Œy_off£t
,

1988 
Ãxt_’Œy
 + 
fmt
->
fixed_hdr_’Œy
,

1989 
hdr
->
off£t_size
))

1990  
DYNCOL_OFFSET_ERROR
;

1991  (
Ãxt_’Œy_off£t
 - 
hdr
->
off£t
);

1992 
	}
}

1999 
	$h—d”_com·r_num
(cÚ¡ *
a
, cÚ¡ *
b
)

2001 
ušt
 
va
ð
	`ušt2kÜr
((
uch¬
*)
a
), 
vb
ðušt2kÜr((uch¬*)
b
);

2002  (
va
 > 
vb
 ? 1 : (va < vb ? -1 : 0));

2003 
	}
}

2015 
uch¬
 *
	$fšd_’Œy_num
(
DYN_HEADER
 *
hdr
, 
ušt
 
key
)

2017 
uch¬
 
h—d”_’Œy
[2+4];

2018 
	`DBUG_ASSERT
(
hdr
->
fÜm©
 =ð
dyncÞ_fmt_num
);

2019 
	`št2¡Üe
(
h—d”_’Œy
, 
key
);

2020  
hdr
->
’Œy
ð
	`b£¬ch
(
h—d”_’Œy
, hdr->
h—d”
,

2021 (
size_t
)
hdr
->
cÞumn_couÁ
,

2022 
hdr
->
’Œy_size
, &
h—d”_com·r_num
);

2023 
	}
}

2037 
my_boÞ
 
	$»ad_Çme
(
DYN_HEADER
 *
hdr
, 
uch¬
 *
’Œy
, 
LEX_STRING
 *
Çme
)

2039 
size_t
 
nmoff£t
ð
	`ušt2kÜr
(
’Œy
);

2040 
uch¬
 *
Ãxt_’Œy
ð
’Œy
 + 
hdr
->
’Œy_size
;

2042 ià(
nmoff£t
 > 
hdr
->
nmpoÞ_size
)

2045 
Çme
->
¡r
ð(*)
hdr
->
nmpoÞ
 + 
nmoff£t
;

2046 ià(
Ãxt_’Œy
 =ð
hdr
->
h—d”
 + hdr->
h—d”_size
)

2047 
Çme
->
Ëngth
ð
hdr
->
nmpoÞ_size
 - 
nmoff£t
;

2050 
size_t
 
Ãxt_nmoff£t
ð
	`ušt2kÜr
(
Ãxt_’Œy
);

2051 ià(
Ãxt_nmoff£t
 > 
hdr
->
nmpoÞ_size
)

2053 
Çme
->
Ëngth
ð
Ãxt_nmoff£t
 - 
nmoff£t
;

2056 
	}
}

2067 
uch¬
 *
	$fšd_’Œy_Çmed
(
DYN_HEADER
 *
hdr
, 
LEX_STRING
 *
key
)

2069 
uch¬
 *
mš
ð
hdr
->
h—d”
;

2070 
uch¬
 *
max
ð
hdr
->
h—d”
 + (hdr->
cÞumn_couÁ
 - 1è* hdr->
’Œy_size
;

2071 
uch¬
 *
mid
;

2072 
	`DBUG_ASSERT
(
hdr
->
fÜm©
 =ð
dyncÞ_fmt_¡r
);

2073 
	`DBUG_ASSERT
(
hdr
->
nmpoÞ
 !ð
NULL
);

2074 
max
 >ð
mš
)

2076 
LEX_STRING
 
Çme
;

2077 
cmp
;

2078 
mid
ð
hdr
->
h—d”
 + ((
mš
 - hdr->header) +

2079 (
max
 - 
hdr
->
h—d”
)) /

2081 
hdr
->
’Œy_size
 * hdr->entry_size;

2082 ià(
	`»ad_Çme
(
hdr
, 
mid
, &
Çme
))

2083  
NULL
;

2084 
cmp
ð
	`m¬Ÿdb_dyncÞ_cÞumn_cmp_Çmed
(&
Çme
, 
key
);

2085 ià(
cmp
 < 0)

2086 
mš
ð
mid
 + 
hdr
->
’Œy_size
;

2087 ià(
cmp
 > 0)

2088 
max
ð
mid
 - 
hdr
->
’Œy_size
;

2090  
mid
;

2092  
NULL
;

2093 
	}
}

2102 *
	$backwr™’um
(*
chr
, 
ušt
 
numkey
)

2104 ià(
numkey
 == 0)

2105 *(--
chr
)= '0';

2107 
numkey
 > 0)

2109 *(--
chr
)ð'0' + 
numkey
 % 10;

2110 
numkey
/= 10;

2112  
chr
;

2113 
	}
}

2127 
my_boÞ


2128 
	$fšd_cÞumn
(
DYN_HEADER
 *
hdr
, 
ušt
 
numkey
, 
LEX_STRING
 *
¡rkey
)

2130 
LEX_STRING
 
nmkey
;

2131 
nmkeybuff
[
DYNCOL_NUM_CHAR
];

2132 
	`DBUG_ASSERT
(
hdr
->
h—d”
 !ð
NULL
);

2134 ià(
hdr
->
h—d”
 + hdr->
h—d”_size
 > hdr->
d©a_’d
)

2135  
TRUE
;

2138 ià(
hdr
->
fÜm©
 =ð
dyncÞ_fmt_num
 && 
¡rkey
 !ð
NULL
)

2140 *
’d
;

2141 
numkey
ð(
ušt
è
	`¡¹oul
(
¡rkey
->
¡r
, &
’d
, 10);

2142 ià(
’d
 !ð
¡rkey
->
¡r
 + sŒkey->
Ëngth
)

2145 
hdr
->
ty³
ð
DYN_COL_NULL
;

2149 ià(
hdr
->
fÜm©
 =ð
dyncÞ_fmt_¡r
 && 
¡rkey
 =ð
NULL
)

2151 
nmkey
.
¡r
ð
	`backwr™’um
(
nmkeybuff
 + Òmkeybuff), 
numkey
);

2152 
nmkey
.
Ëngth
ð(
nmkeybuff
 + Òmkeybuff)è-‚mkey.
¡r
;

2153 
¡rkey
ð&
nmkey
;

2155 ià(
hdr
->
fÜm©
 =ð
dyncÞ_fmt_num
)

2156 
hdr
->
’Œy
ð
	`fšd_’Œy_num
(hdr, 
numkey
);

2158 
hdr
->
’Œy
ð
	`fšd_’Œy_Çmed
(hdr, 
¡rkey
);

2160 ià(!
hdr
->
’Œy
)

2163 
hdr
->
ty³
ð
DYN_COL_NULL
;

2166 
hdr
->
Ëngth
ð
	`hdr_š‹rv®_Ëngth
(hdr, hdr->
’Œy
 + hdr->
’Œy_size
);

2167 
hdr
->
d©a
ðhdr->
doÞ
 + hdr->
off£t
;

2172 ià(
hdr
->
Ëngth
 =ð
DYNCOL_OFFSET_ERROR
 ||

2173 
hdr
->
Ëngth
 > 
INT_MAX
 || hdr->
off£t
 > hdr->
d©a_size
)

2177 
	}
}

2194 
šlše
 
my_boÞ
 
	$»ad_fixed_h—d”
(
DYN_HEADER
 *
hdr
,

2195 
DYNAMIC_COLUMN
 *
¡r
)

2197 
	`DBUG_ASSERT
(
¡r
 !ð
NULL
 && sŒ->
Ëngth
 != 0);

2198 ià((
¡r
->
Ëngth
 < 1) ||

2199 (
¡r
->¡r[0] & (~
DYNCOL_FLG_KNOWN
)))

2201 
hdr
->
fÜm©
ð((
¡r
->¡r[0] & 
DYNCOL_FLG_NAMES
) ?

2202 
dyncÞ_fmt_¡r
:

2203 
dyncÞ_fmt_num
);

2204 ià((
¡r
->
Ëngth
 < 
fmt_d©a
[
hdr
->
fÜm©
].
fixed_hdr
))

2206 
hdr
->
off£t_size
ð(
¡r
->¡r[0] & 
DYNCOL_FLG_OFFSET
) + 1 +

2207 (
hdr
->
fÜm©
 =ð
dyncÞ_fmt_¡r
 ? 1 : 0);

2208 
hdr
->
cÞumn_couÁ
ð
	`ušt2kÜr
(
¡r
->str + 1);

2209 ià(
hdr
->
fÜm©
 =ð
dyncÞ_fmt_¡r
)

2210 
hdr
->
nmpoÞ_size
ð
	`ušt2kÜr
(
¡r
->str + 3);

2212 
hdr
->
nmpoÞ_size
= 0;

2214 
	}
}

2227 
’um_dyncÞ_func_»suÉ


2228 
	$dyÇmic_cÞumn_g‘
(
DYNAMIC_COLUMN
 *
¡r
, 
ušt
 
cÞumn_Ä
,

2229 
DYNAMIC_COLUMN_VALUE
 *
¡Üe_™_h”e
)

2231  
	`dyÇmic_cÞumn_g‘_š‹º®
(
¡r
, 
¡Üe_™_h”e
, 
cÞumn_Ä
, 
NULL
);

2232 
	}
}

2234 
’um_dyncÞ_func_»suÉ


2235 
	$m¬Ÿdb_dyncÞ_g‘_num
(
DYNAMIC_COLUMN
 *
¡r
, 
ušt
 
cÞumn_Ä
,

2236 
DYNAMIC_COLUMN_VALUE
 *
¡Üe_™_h”e
)

2238  
	`dyÇmic_cÞumn_g‘_š‹º®
(
¡r
, 
¡Üe_™_h”e
, 
cÞumn_Ä
, 
NULL
);

2239 
	}
}

2252 
’um_dyncÞ_func_»suÉ


2253 
	$m¬Ÿdb_dyncÞ_g‘_Çmed
(
DYNAMIC_COLUMN
 *
¡r
, 
LEX_STRING
 *
Çme
,

2254 
DYNAMIC_COLUMN_VALUE
 *
¡Üe_™_h”e
)

2256 
	`DBUG_ASSERT
(
Çme
 !ð
NULL
);

2257  
	`dyÇmic_cÞumn_g‘_š‹º®
(
¡r
, 
¡Üe_™_h”e
, 0, 
Çme
);

2258 
	}
}

2261 
’um_dyncÞ_func_»suÉ


2262 
	$dyÇmic_cÞumn_g‘_v®ue
(
DYN_HEADER
 *
hdr
, 
DYNAMIC_COLUMN_VALUE
 *
¡Üe_™_h”e
)

2264 
’um_dyncÞ_func_»suÉ
 
rc
;

2265 (
¡Üe_™_h”e
->
ty³
ð
hdr
->type)) {

2266 
DYN_COL_INT
:

2267 
rc
ð
	`dyÇmic_cÞumn_sšt_»ad
(
¡Üe_™_h”e
, 
hdr
->
d©a
, hdr->
Ëngth
);

2269 
DYN_COL_UINT
:

2270 
rc
ð
	`dyÇmic_cÞumn_ušt_»ad
(
¡Üe_™_h”e
, 
hdr
->
d©a
, hdr->
Ëngth
);

2272 
DYN_COL_DOUBLE
:

2273 
rc
ð
	`dyÇmic_cÞumn_doubË_»ad
(
¡Üe_™_h”e
, 
hdr
->
d©a
, hdr->
Ëngth
);

2275 
DYN_COL_STRING
:

2276 
rc
ð
	`dyÇmic_cÞumn_¡ršg_»ad
(
¡Üe_™_h”e
, 
hdr
->
d©a
, hdr->
Ëngth
);

2278 #iâdeà
LIBMARIADB


2279 
DYN_COL_DECIMAL
:

2280 
rc
ð
	`dyÇmic_cÞumn_decim®_»ad
(
¡Üe_™_h”e
, 
hdr
->
d©a
, hdr->
Ëngth
);

2283 
DYN_COL_DATETIME
:

2284 
rc
ð
	`dyÇmic_cÞumn_d©e_time_»ad
(
¡Üe_™_h”e
, 
hdr
->
d©a
,

2285 
hdr
->
Ëngth
);

2287 
DYN_COL_DATE
:

2288 
rc
ð
	`dyÇmic_cÞumn_d©e_»ad
(
¡Üe_™_h”e
, 
hdr
->
d©a
, hdr->
Ëngth
);

2290 
DYN_COL_TIME
:

2291 
rc
ð
	`dyÇmic_cÞumn_time_»ad
(
¡Üe_™_h”e
, 
hdr
->
d©a
, hdr->
Ëngth
);

2293 
DYN_COL_NULL
:

2294 
rc
ð
ER_DYNCOL_OK
;

2296 
DYN_COL_DYNCOL
:

2297 
rc
ð
	`dyÇmic_cÞumn_dyncÞ_»ad
(
¡Üe_™_h”e
, 
hdr
->
d©a
, hdr->
Ëngth
);

2300 
rc
ð
ER_DYNCOL_FORMAT
;

2301 
¡Üe_™_h”e
->
ty³
ð
DYN_COL_NULL
;

2304  
rc
;

2305 
	}
}

2318 
’um_dyncÞ_func_»suÉ


2319 
	$dyÇmic_cÞumn_g‘_š‹º®
(
DYNAMIC_COLUMN
 *
¡r
,

2320 
DYNAMIC_COLUMN_VALUE
 *
¡Üe_™_h”e
,

2321 
ušt
 
num_key
, 
LEX_STRING
 *
¡r_key
)

2323 
DYN_HEADER
 
h—d”
;

2324 
’um_dyncÞ_func_»suÉ
 
rc
ð
ER_DYNCOL_FORMAT
;

2325 
	`mem£t
(&
h—d”
, 0, (header));

2327 ià(
¡r
->
Ëngth
 == 0)

2328 
nuÎ
;

2330 ià((
rc
ð
	`š™_»ad_hdr
(&
h—d”
, 
¡r
)) < 0)

2331 
”r
;

2333 ià(
h—d”
.
cÞumn_couÁ
 == 0)

2334 
nuÎ
;

2336 ià(
	`fšd_cÞumn
(&
h—d”
, 
num_key
, 
¡r_key
))

2337 
”r
;

2339 
rc
ð
	`dyÇmic_cÞumn_g‘_v®ue
(&
h—d”
, 
¡Üe_™_h”e
);

2340  
rc
;

2342 
nuÎ
:

2343 
rc
ð
ER_DYNCOL_OK
;

2344 
”r
:

2345 
¡Üe_™_h”e
->
ty³
ð
DYN_COL_NULL
;

2346  
rc
;

2347 
	}
}

2359 
’um_dyncÞ_func_»suÉ


2360 
	$m¬Ÿdb_dyncÞ_exi¡s_num
(
DYNAMIC_COLUMN
 *
¡r
, 
ušt
 
cÞumn_Ä
)

2362  
	`dyÇmic_cÞumn_exi¡s_š‹º®
(
¡r
, 
cÞumn_Ä
, 
NULL
);

2363 
	}
}

2374 
’um_dyncÞ_func_»suÉ


2375 
	$m¬Ÿdb_dyncÞ_exi¡s_Çmed
(
DYNAMIC_COLUMN
 *
¡r
, 
LEX_STRING
 *
Çme
)

2377 
	`DBUG_ASSERT
(
Çme
 !ð
NULL
);

2378  
	`dyÇmic_cÞumn_exi¡s_š‹º®
(
¡r
, 0, 
Çme
);

2379 
	}
}

2392 
’um_dyncÞ_func_»suÉ


2393 
	$dyÇmic_cÞumn_exi¡s_š‹º®
(
DYNAMIC_COLUMN
 *
¡r
, 
ušt
 
num_key
,

2394 
LEX_STRING
 *
¡r_key
)

2396 
DYN_HEADER
 
h—d”
;

2397 
’um_dyncÞ_func_»suÉ
 
rc
;

2398 
	`mem£t
(&
h—d”
, 0, (header));

2400 ià(
¡r
->
Ëngth
 == 0)

2401  
ER_DYNCOL_NO
;

2403 ià((
rc
ð
	`š™_»ad_hdr
(&
h—d”
, 
¡r
)) < 0)

2404  
rc
;

2406 ià(
h—d”
.
cÞumn_couÁ
 == 0)

2407  
ER_DYNCOL_NO
;

2409 ià(
	`fšd_cÞumn
(&
h—d”
, 
num_key
, 
¡r_key
))

2410  
ER_DYNCOL_FORMAT
;

2412  (
h—d”
.
ty³
 !ð
DYN_COL_NULL
 ? 
ER_DYNCOL_YES
 : 
ER_DYNCOL_NO
);

2413 
	}
}

2424 
’um_dyncÞ_func_»suÉ


2425 
	$dyÇmic_cÞumn_li¡
(
DYNAMIC_COLUMN
 *
¡r
, 
DYNAMIC_ARRAY
 *
¬¿y_of_ušt
)

2427 
DYN_HEADER
 
h—d”
;

2428 
uch¬
 *
»ad
;

2429 
ušt
 
i
;

2430 
’um_dyncÞ_func_»suÉ
 
rc
;

2432 
	`mem£t
(
¬¿y_of_ušt
, 0, (*array_of_uint));

2433 ià(
¡r
->
Ëngth
 == 0)

2434  
ER_DYNCOL_OK
;

2436 ià((
rc
ð
	`š™_»ad_hdr
(&
h—d”
, 
¡r
)) < 0)

2437  
rc
;

2439 ià(
h—d”
.
fÜm©
 !ð
dyncÞ_fmt_num
)

2440  
ER_DYNCOL_FORMAT
;

2442 ià(
h—d”
.
’Œy_size
 * h—d”.
cÞumn_couÁ
 + 
FIXED_HEADER_SIZE
 >

2443 
¡r
->
Ëngth
)

2444  
ER_DYNCOL_FORMAT
;

2446 ià(
	`ma_š™_dyÇmic_¬¿y
(
¬¿y_of_ušt
, (
ušt
), 
h—d”
.
cÞumn_couÁ
, 0))

2447  
ER_DYNCOL_RESOURCE
;

2449 
i
ð0, 
»ad
ð
h—d”
.header;

2450 
i
 < 
h—d”
.
cÞumn_couÁ
;

2451 
i
++, 
»ad
+ð
h—d”
.
’Œy_size
)

2453 
ušt
 
nm
ð
	`ušt2kÜr
(
»ad
);

2455 (è
	`ma_š£¹_dyÇmic
(
¬¿y_of_ušt
, (
uch¬
 *)&
nm
);

2457  
ER_DYNCOL_OK
;

2458 
	}
}

2468 
’um_dyncÞ_func_»suÉ


2469 
	$m¬Ÿdb_dyncÞ_li¡_num
(
DYNAMIC_COLUMN
 *
¡r
, 
ušt
 *
couÁ
, ušˆ**
nums
)

2471 
DYN_HEADER
 
h—d”
;

2472 
uch¬
 *
»ad
;

2473 
ušt
 
i
;

2474 
’um_dyncÞ_func_»suÉ
 
rc
;

2476 (*
nums
)ð0; (*
couÁ
)= 0;

2477 ià(
¡r
->
Ëngth
 == 0)

2478  
ER_DYNCOL_OK
;

2480 ià((
rc
ð
	`š™_»ad_hdr
(&
h—d”
, 
¡r
)) < 0)

2481  
rc
;

2483 ià(
h—d”
.
fÜm©
 !ð
dyncÞ_fmt_num
)

2484  
ER_DYNCOL_FORMAT
;

2486 ià(
h—d”
.
’Œy_size
 * h—d”.
cÞumn_couÁ
 + 
FIXED_HEADER_SIZE
 >

2487 
¡r
->
Ëngth
)

2488  
ER_DYNCOL_FORMAT
;

2490 ià(!((*
nums
)ð(
ušt
 *)
	`m®loc
((uštè* 
h—d”
.
cÞumn_couÁ
)))

2491  
ER_DYNCOL_RESOURCE
;

2493 
i
ð0, 
»ad
ð
h—d”
.header;

2494 
i
 < 
h—d”
.
cÞumn_couÁ
;

2495 
i
++, 
»ad
+ð
h—d”
.
’Œy_size
)

2497 (*
nums
)[
i
]ð
	`ušt2kÜr
(
»ad
);

2499 (*
couÁ
)ð
h—d”
.
cÞumn_couÁ
;

2500  
ER_DYNCOL_OK
;

2501 
	}
}

2513 
’um_dyncÞ_func_»suÉ


2514 
	$m¬Ÿdb_dyncÞ_li¡_Çmed
(
DYNAMIC_COLUMN
 *
¡r
, 
ušt
 *
couÁ
, 
LEX_STRING
 **
Çmes
)

2516 
DYN_HEADER
 
h—d”
;

2517 
uch¬
 *
»ad
;

2518 *
poÞ
;

2519 
¡_£rviû_funcs
 *
fmt
;

2520 
ušt
 
i
;

2521 
’um_dyncÞ_func_»suÉ
 
rc
;

2523 (*
Çmes
)ð0; (*
couÁ
)= 0;

2525 ià(
¡r
->
Ëngth
 == 0)

2526  
ER_DYNCOL_OK
;

2528 ià((
rc
ð
	`š™_»ad_hdr
(&
h—d”
, 
¡r
)) < 0)

2529  
rc
;

2531 
fmt
ð
fmt_d©a
 + 
h—d”
.
fÜm©
;

2533 ià(
h—d”
.
’Œy_size
 * h—d”.
cÞumn_couÁ
 + 
fmt
->
fixed_hdr
 >

2534 
¡r
->
Ëngth
)

2535  
ER_DYNCOL_FORMAT
;

2537 ià(
h—d”
.
fÜm©
 =ð
dyncÞ_fmt_num
)

2538 *
Çmes
ð(
LEX_STRING
 *)
	`m®loc
((LEX_STRINGè* 
h—d”
.
cÞumn_couÁ
 +

2539 
DYNCOL_NUM_CHAR
 * 
h—d”
.
cÞumn_couÁ
);

2541 *
Çmes
ð(
LEX_STRING
 *)
	`m®loc
((LEX_STRINGè* 
h—d”
.
cÞumn_couÁ
 +

2542 
h—d”
.
nmpoÞ_size
 + h—d”.
cÞumn_couÁ
);

2543 ià(!(*
Çmes
))

2544  
ER_DYNCOL_RESOURCE
;

2545 
poÞ
ð((*)(*
Çmes
)è+ (
LEX_STRING
è* 
h—d”
.
cÞumn_couÁ
;

2547 
i
ð0, 
»ad
ð
h—d”
.header;

2548 
i
 < 
h—d”
.
cÞumn_couÁ
;

2549 
i
++, 
»ad
+ð
h—d”
.
’Œy_size
)

2551 ià(
h—d”
.
fÜm©
 =ð
dyncÞ_fmt_num
)

2553 
ušt
 
nm
ð
	`ušt2kÜr
(
»ad
);

2554 (*
Çmes
)[
i
].
¡r
ð
poÞ
;

2555 
poÞ
+ð
DYNCOL_NUM_CHAR
;

2556 (*
Çmes
)[
i
].
Ëngth
=

2557 
	`ma_Î2¡r
(
nm
, (*
Çmes
)[
i
].
¡r
, 10) - (*names)[i].str;

2561 
LEX_STRING
 
tmp
;

2562 ià(
	`»ad_Çme
(&
h—d”
, 
»ad
, &
tmp
))

2563  
ER_DYNCOL_FORMAT
;

2564 (*
Çmes
)[
i
].
Ëngth
ð
tmp
.length;

2565 (*
Çmes
)[
i
].
¡r
ð
poÞ
;

2566 
poÞ
+ð
tmp
.
Ëngth
 + 1;

2567 
	`memýy
((*
Çmes
)[
i
].
¡r
, (cÚ¡ *)
tmp
.¡r,mp.
Ëngth
);

2568 (*
Çmes
)[
i
].
¡r
[
tmp
.
Ëngth
]= '\0';

2571 (*
couÁ
)ð
h—d”
.
cÞumn_couÁ
;

2572  
ER_DYNCOL_OK
;

2573 
	}
}

2587 
my_boÞ


2588 
	$fšd_¶aû
(
DYN_HEADER
 *
hdr
, *
key
, 
my_boÞ
 
¡ršg_keys
)

2590 
ušt
 
mid
, 
¡¬t
, 
’d
, 
v®
;

2591 
	`UNINIT_VAR
(
æag
);

2592 
LEX_STRING
 
¡r
;

2593 
buff
[
DYNCOL_NUM_CHAR
];

2594 
my_boÞ
 
Ãed_cÚv”siÚ
ð((
¡ršg_keys
 ? 
dyncÞ_fmt_¡r
 : 
dyncÞ_fmt_num
) !=

2595 
hdr
->
fÜm©
);

2597 
	`DBUG_ASSERT
(
¡ršg_keys
 ||

2598 
hdr
->
fÜm©
 =ð
dyncÞ_fmt_num
);

2600 
¡¬t
= 0;

2601 
’d
ð
hdr
->
cÞumn_couÁ
 -1;

2602 
mid
= 1;

2603 
¡¬t
 !ð
’d
)

2605 
ušt
 
v®
;

2606 
mid
ð(
¡¬t
 + 
’d
) / 2;

2607 
hdr
->
’Œy
ðhdr->
h—d”
 + 
mid
 * hdr->
’Œy_size
;

2608 ià(!
¡ršg_keys
)

2610 
v®
ð
	`ušt2kÜr
(
hdr
->
’Œy
);

2611 
æag
ð
	`CMP_NUM
(*((
ušt
 *)
key
), 
v®
);

2615 ià(
Ãed_cÚv”siÚ
)

2617 
¡r
.¡rð
	`backwr™’um
(
buff
 + (buff), 
	`ušt2kÜr
(
hdr
->
’Œy
));

2618 
¡r
.
Ëngth
ð(
buff
 + (buff)) - str.str;

2622 
	`DBUG_ASSERT
(
hdr
->
fÜm©
 =ð
dyncÞ_fmt_¡r
);

2623 ià(
	`»ad_Çme
(
hdr
, hdr->
’Œy
, &
¡r
))

2626 
æag
ð
	`m¬Ÿdb_dyncÞ_cÞumn_cmp_Çmed
((
LEX_STRING
 *)
key
, &
¡r
);

2628 ià(
æag
 <= 0)

2629 
’d
ð
mid
;

2631 
¡¬t
ð
mid
 + 1;

2633 
hdr
->
’Œy
ðhdr->
h—d”
 + 
¡¬t
 * hdr->
’Œy_size
;

2634 ià(
¡¬t
 !ð
mid
)

2636 ià(!
¡ršg_keys
)

2638 
v®
ð
	`ušt2kÜr
(
hdr
->
’Œy
);

2639 
æag
ð
	`CMP_NUM
(*((
ušt
 *)
key
), 
v®
);

2643 ià(
Ãed_cÚv”siÚ
)

2645 
¡r
.¡rð
	`backwr™’um
(
buff
 + (buff), 
	`ušt2kÜr
(
hdr
->
’Œy
));

2646 
¡r
.
Ëngth
ð(
buff
 + (buff)) - str.str;

2650 
	`DBUG_ASSERT
(
hdr
->
fÜm©
 =ð
dyncÞ_fmt_¡r
);

2651 ià(
	`»ad_Çme
(
hdr
, hdr->
’Œy
, &
¡r
))

2654 
æag
ð
	`m¬Ÿdb_dyncÞ_cÞumn_cmp_Çmed
((
LEX_STRING
 *)
key
, &
¡r
);

2657 ià(
æag
 > 0)

2658 
hdr
->
’Œy
+ðhdr->
’Œy_size
;

2659  
æag
 == 0;

2660 
	}
}

2668 ’um {
	mPLAN_REPLACE
, 
	mPLAN_ADD
, 
	mPLAN_DELETE
, 
	mPLAN_NOP
} 
	tPLAN_ACT
;

2670 
	s¡_¶ª
 {

2671 
DYNAMIC_COLUMN_VALUE
 *
	mv®
;

2672 *
	mkey
;

2673 
uch¬
 *
	m¶aû
;

2674 
size_t
 
	mËngth
;

2675 
	mhd–
, 
	mdd–
, 
	mnd–
;

2676 
	mmv_off£t
, 
	mmv_Ëngth
;

2677 
ušt
 
	mmv_’d
;

2678 
PLAN_ACT
 
	maù
;

2680 
¡_¶ª
 
	tPLAN
;

2687 
	$¶ª_sÜt_num
(cÚ¡ *
a
, cÚ¡ *
b
)

2689  *((
ušt
 *)((
PLAN
 *)
a
)->
key
è- *((ušˆ*)((PLAN *)
b
)->key);

2690 
	}
}

2697 
	$¶ª_sÜt_Çmed
(cÚ¡ *
a
, cÚ¡ *
b
)

2699  
	`m¬Ÿdb_dyncÞ_cÞumn_cmp_Çmed
((
LEX_STRING
 *)((
PLAN
 *)
a
)->
key
,

2700 (
LEX_STRING
 *)((
PLAN
 *)
b
)->
key
);

2701 
	}
}

2703 
	#DELTA_CHECK
(
S
, 
D
, 
C
) \

2704 ià((
S
) == 0) \

2705 (
S
)ð(
D
); \

2706 ià(((
S
è> 0 && (
D
) < 0) || \

2707 ((
S
è< 0 && (
D
) > 0)) \

2709 (
C
)ð
TRUE
; \

2710 }

	)

2725 
’um_dyncÞ_func_»suÉ


2726 
	$dyÇmic_cÞumn_upd©e_cÝy
(
DYNAMIC_COLUMN
 *
¡r
, 
PLAN
 *
¶ª
,

2727 
ušt
 
add_cÞumn_couÁ
,

2728 
DYN_HEADER
 *
hdr
, DYN_HEADER *
Ãw_hdr
,

2729 
my_boÞ
 
cÚv”t
)

2731 
DYNAMIC_COLUMN
 
tmp
;

2732 
¡_£rviû_funcs
 *
fmt
ð
fmt_d©a
 + 
hdr
->
fÜm©
,

2733 *
Ãw_fmt
ð
fmt_d©a
 + 
Ãw_hdr
->
fÜm©
;

2734 
ušt
 
i
, 
j
, 
k
;

2735 
size_t
 
®l_h—d”s_size
;

2737 ià(
	`dyÇmic_cÞumn_š™_Çmed
(&
tmp
,

2738 (
Ãw_fmt
->
fixed_hdr
 + 
Ãw_hdr
->
h—d”_size
 +

2739 
Ãw_hdr
->
nmpoÞ_size
 +

2740 
Ãw_hdr
->
d©a_size
 + 
DYNCOL_SYZERESERVE
)))

2742  
ER_DYNCOL_RESOURCE
;

2744 
	`mem£t
(
tmp
.
¡r
, 0, 
Ãw_fmt
->
fixed_hdr
);

2745 (*
Ãw_fmt
->
£t_fixed_hdr
)(&
tmp
, 
Ãw_hdr
);

2747 
tmp
.
Ëngth
ð
Ãw_fmt
->
fixed_hdr
 + 
Ãw_hdr
->
h—d”_size
 +‚ew_hdr->
nmpoÞ_size
;

2755 
Ãw_hdr
->
’Œy
ðÃw_hdr->
h—d”
;

2756 
Ãw_hdr
->
Çme
ðÃw_hdr->
nmpoÞ
;

2757 
®l_h—d”s_size
ð
Ãw_fmt
->
fixed_hdr
 +

2758 
Ãw_hdr
->
h—d”_size
 +‚ew_hdr->
nmpoÞ_size
;

2759 
i
ð0, 
j
ð0; i < 
add_cÞumn_couÁ
 || j < 
hdr
->
cÞumn_couÁ
; i++)

2761 
size_t
 
fœ¡_off£t
= 0;

2762 
ušt
 
¡¬t
ð
j
, 
’d
;

2769 
i
 < 
add_cÞumn_couÁ
 && 
¶ª
[i].
aù
 =ð
PLAN_NOP
)

2770 
i
++;

2772 ià(
i
 =ð
add_cÞumn_couÁ
)

2773 
j
ð
’d
ð
hdr
->
cÞumn_couÁ
;

2781 
hdr
->
h—d”
 + 
j
 * hdr->
’Œy_size
 < 
¶ª
[
i
].
¶aû
)

2782 
j
++;

2783 
’d
ð
j
;

2784 ià((
¶ª
[
i
].
aù
 =ð
PLAN_REPLACE
 ||…Ïn[i].aù =ð
PLAN_DELETE
))

2785 
j
++;

2792 
k
ð
¡¬t
; k < 
’d
; k++)

2794 
uch¬
 *
»ad
ð
hdr
->
h—d”
 + 
k
 * hdr->
’Œy_size
;

2795 *
key
;

2796 
LEX_STRING
 
Çme
;

2797 
size_t
 
offs
;

2798 
ušt
 
nm
;

2799 
DYNAMIC_COLUMN_TYPE
 

;

2800 
buff
[
DYNCOL_NUM_CHAR
];

2802 ià(
hdr
->
fÜm©
 =ð
dyncÞ_fmt_num
)

2804 ià(
cÚv”t
)

2806 
Çme
.
¡r
ð
	`backwr™’um
(
buff
 + (buff), 
	`ušt2kÜr
(
»ad
));

2807 
Çme
.
Ëngth
ð(
buff
 + (buff)è-‚ame.
¡r
;

2808 
key
ð&
Çme
;

2812 
nm
ð
	`ušt2kÜr
(
»ad
);

2813 
key
ð&
nm
;

2818 ià(
	`»ad_Çme
(
hdr
, 
»ad
, &
Çme
))

2819 
”r
;

2820 
key
ð&
Çme
;

2822 ià(
fmt
->
	`ty³_ªd_off£t_»ad
(&

, &
offs
,

2823 
»ad
 + 
fmt
->
fixed_hdr_’Œy
,

2824 
hdr
->
off£t_size
))

2825 
”r
;

2826 ià(
k
 =ð
¡¬t
)

2827 
fœ¡_off£t
ð
offs
;

2828 ià(
offs
 < 
fœ¡_off£t
)

2829 
”r
;

2831 
offs
+ð(
size_t
)
¶ª
[
i
].
dd–
;

2833 
DYNAMIC_COLUMN_VALUE
 
v®
;

2834 
v®
.
ty³
ð

;

2835 ià((*
Ãw_fmt
->
put_h—d”_’Œy
)(
Ãw_hdr
, 
key
, &
v®
, 
offs
))

2836 
”r
;

2841 ià(
¡¬t
 < 
’d
)

2843 
size_t
 
d©a_size
;

2845 
hdr
->
’Œy
ðhdr->
h—d”
 + 
¡¬t
 * hdr->
’Œy_size
;

2846 
d©a_size
=

2847 
	`hdr_š‹rv®_Ëngth
(
hdr
, hdr->
h—d”
 + 
’d
 * hdr->
’Œy_size
);

2848 ià(
d©a_size
 =ð
DYNCOL_OFFSET_ERROR
 ||

2849 (è
d©a_size
 < 0 ||

2850 
d©a_size
 > 
hdr
->d©a_siz- 
fœ¡_off£t
)

2851 
”r
;

2853 
	`memýy
(
tmp
.
¡r
 +mp.
Ëngth
, (*)
hdr
->
doÞ
 + 
fœ¡_off£t
,

2854 
d©a_size
);

2855 
tmp
.
Ëngth
+ð
d©a_size
;

2859 ià(
i
 < 
add_cÞumn_couÁ
)

2861 ifÐ
¶ª
[
i
].
aù
 =ð
PLAN_ADD
 ||…Ïn[i].aù =ð
PLAN_REPLACE
)

2863 ià((*
Ãw_fmt
->
put_h—d”_’Œy
)(
Ãw_hdr
, 
¶ª
[
i
].
key
,

2864 
¶ª
[
i
].
v®
,

2865 
tmp
.
Ëngth
 - 
®l_h—d”s_size
))

2866 
”r
;

2867 
	`d©a_¡Üe
(&
tmp
, 
¶ª
[
i
].
v®
, 
Ãw_hdr
->
fÜm©
);

2871 
	`dyÇmic_cÞumn_cÞumn_ä“
(
¡r
);

2872 *
¡r
ð
tmp
;

2873  
ER_DYNCOL_OK
;

2874 
”r
:

2875 
	`dyÇmic_cÞumn_cÞumn_ä“
(&
tmp
);

2876  
ER_DYNCOL_FORMAT
;

2877 
	}
}

2879 
’um_dyncÞ_func_»suÉ


2880 
	$dyÇmic_cÞumn_upd©e_move_Ëá
(
DYNAMIC_COLUMN
 *
¡r
, 
PLAN
 *
¶ª
,

2881 
size_t
 
off£t_size
,

2882 
size_t
 
’Œy_size
,

2883 
size_t
 
h—d”_size
,

2884 
size_t
 
Ãw_off£t_size
,

2885 
size_t
 
Ãw_’Œy_size
,

2886 
size_t
 
Ãw_h—d”_size
,

2887 
ušt
 
cÞumn_couÁ
,

2888 
ušt
 
Ãw_cÞumn_couÁ
,

2889 
ušt
 
add_cÞumn_couÁ
,

2890 
uch¬
 *
h—d”_’d
,

2891 
size_t
 
max_off£t
)

2893 
uch¬
 *
wr™e
;

2894 
uch¬
 *
h—d”_ba£
ð(uch¬ *)
¡r
->¡¸+ 
FIXED_HEADER_SIZE
;

2895 
ušt
 
i
, 
j
, 
k
;

2896 
size_t
 
cu¼_off£t
;

2898 
wr™e
ð(
uch¬
 *)
¡r
->¡¸+ 
FIXED_HEADER_SIZE
;

2899 
	`£t_fixed_h—d”
(
¡r
, (
ušt
)
Ãw_off£t_size
, 
Ãw_cÞumn_couÁ
);

2906 
cu¼_off£t
ð0, 
i
ð0, 
j
= 0;

2907 
i
 < 
add_cÞumn_couÁ
 || 
j
 < 
cÞumn_couÁ
;

2908 
i
++)

2910 
size_t
 
	`UNINIT_VAR
(
fœ¡_off£t
);

2911 
ušt
 
¡¬t
ð
j
, 
’d
;

2918 
i
 < 
add_cÞumn_couÁ
 && 
¶ª
[i].
aù
 =ð
PLAN_NOP
)

2919 
i
++;

2921 ià(
i
 =ð
add_cÞumn_couÁ
)

2922 
j
ð
’d
ð
cÞumn_couÁ
;

2930 
h—d”_ba£
 + 
j
 * 
’Œy_size
 < 
¶ª
[
i
].
¶aû
)

2931 
j
++;

2932 
’d
ð
j
;

2933 ià((
¶ª
[
i
].
aù
 =ð
PLAN_REPLACE
 ||…Ïn[i].aù =ð
PLAN_DELETE
))

2934 
j
++;

2936 
¶ª
[
i
].
mv_’d
ð
’d
;

2939 
DYNAMIC_COLUMN_TYPE
 

;

2940 ià(
	`ty³_ªd_off£t_»ad_num
(&

, &
fœ¡_off£t
,

2941 
h—d”_ba£
 + 
¡¬t
 * 
’Œy_size
 +

2942 
COLUMN_NUMBER_SIZE
, 
off£t_size
))

2943  
ER_DYNCOL_FORMAT
;

2946 ià(
¡¬t
 < 
’d
)

2948 
size_t
 
d©a_size
=

2949 
	`g‘_Ëngth_š‹rv®
(
h—d”_ba£
 + 
¡¬t
 * 
’Œy_size
,

2950 
h—d”_ba£
 + 
’d
 * 
’Œy_size
,

2951 
h—d”_’d
, 
off£t_size
, 
max_off£t
);

2952 ià(
d©a_size
 =ð
DYNCOL_OFFSET_ERROR
 ||

2953 (è
d©a_size
 < 0 ||

2954 
d©a_size
 > 
max_off£t
 - 
fœ¡_off£t
)

2956 
¡r
->
Ëngth
= 0;

2957  
ER_DYNCOL_FORMAT
;

2959 
	`DBUG_ASSERT
(
cu¼_off£t
 =ð
fœ¡_off£t
 + 
¶ª
[
i
].
dd–
);

2960 
¶ª
[
i
].
mv_off£t
ð
fœ¡_off£t
;

2961 
¶ª
[
i
].
mv_Ëngth
ð
d©a_size
;

2962 
cu¼_off£t
+ð
d©a_size
;

2966 
¶ª
[
i
].
mv_Ëngth
= 0;

2967 
¶ª
[
i
].
mv_off£t
ð
cu¼_off£t
;

2970 ià(
¶ª
[
i
].
dd–
 =ð0 && 
off£t_size
 =ð
Ãw_off£t_size
 &&

2971 
¶ª
[
i
].
aù
 !ð
PLAN_DELETE
)

2972 
wr™e
+ð
’Œy_size
 * (
’d
 - 
¡¬t
);

2979 
k
ð
¡¬t
; k < 
’d
; k++)

2981 
uch¬
 *
»ad
ð
h—d”_ba£
 + 
k
 * 
’Œy_size
;

2982 
size_t
 
offs
;

2983 
ušt
 
nm
;

2984 
DYNAMIC_COLUMN_TYPE
 

;

2986 
nm
ð
	`ušt2kÜr
(
»ad
);

2987 ià(
	`ty³_ªd_off£t_»ad_num
(&

, &
offs
, 
»ad
 + 
COLUMN_NUMBER_SIZE
,

2988 
off£t_size
))

2989  
ER_DYNCOL_FORMAT
;

2991 ià(
k
 > 
¡¬t
 && 
offs
 < 
fœ¡_off£t
)

2993 
¡r
->
Ëngth
= 0;

2994  
ER_DYNCOL_FORMAT
;

2997 
offs
+ð(
size_t
)
¶ª
[
i
].
dd–
;

2998 
	`št2¡Üe
(
wr™e
, 
nm
);

3000 
	`ty³_ªd_off£t_¡Üe_num
(
wr™e
, 
Ãw_off£t_size
, 

, 
offs
);

3001 
wr™e
+ð
Ãw_’Œy_size
;

3006 ià(
i
 < 
add_cÞumn_couÁ
)

3008 ifÐ
¶ª
[
i
].
aù
 =ð
PLAN_ADD
 ||…Ïn[i].aù =ð
PLAN_REPLACE
)

3010 
	`št2¡Üe
(
wr™e
, *((
ušt
 *)
¶ª
[
i
].
key
));

3011 
	`ty³_ªd_off£t_¡Üe_num
(
wr™e
, 
Ãw_off£t_size
,

3012 
¶ª
[
i
].
v®
[0].
ty³
,

3013 
cu¼_off£t
);

3014 
wr™e
+ð
Ãw_’Œy_size
;

3015 
cu¼_off£t
+ð
¶ª
[
i
].
Ëngth
;

3025 
¡r
->
Ëngth
ð(
FIXED_HEADER_SIZE
 + 
Ãw_h—d”_size
);

3026 
i
ð0, 
j
= 0;

3027 
i
 < 
add_cÞumn_couÁ
 || 
j
 < 
cÞumn_couÁ
;

3028 
i
++)

3030 
ušt
 
¡¬t
ð
j
, 
’d
;

3037 
i
 < 
add_cÞumn_couÁ
 && 
¶ª
[i].
aù
 =ð
PLAN_NOP
)

3038 
i
++;

3040 
j
ð
’d
ð
¶ª
[
i
].
mv_’d
;

3041 ià(
i
 !ð
add_cÞumn_couÁ
 &&

3042 (
¶ª
[
i
].
aù
 =ð
PLAN_REPLACE
 ||…Ïn[i].aù =ð
PLAN_DELETE
))

3043 
j
++;

3046 ià(
¡¬t
 < 
’d
 && 
¶ª
[
i
].
mv_Ëngth
)

3048 
	`memmove
((
h—d”_ba£
 + 
Ãw_h—d”_size
 +

3049 (
size_t
)
¶ª
[
i
].
mv_off£t
 + (size_tíÏn[i].
dd–
),

3050 
h—d”_ba£
 + 
h—d”_size
 + (
size_t
)
¶ª
[
i
].
mv_off£t
,

3051 (
size_t
)
¶ª
[
i
].
mv_Ëngth
);

3053 
¡r
->
Ëngth
+ð(
size_t
)
¶ª
[
i
].
mv_Ëngth
;

3056 ià(
i
 < 
add_cÞumn_couÁ
)

3058 ifÐ
¶ª
[
i
].
aù
 =ð
PLAN_ADD
 ||…Ïn[i].aù =ð
PLAN_REPLACE
)

3060 
	`d©a_¡Üe
(
¡r
, 
¶ª
[
i
].
v®
, 
dyncÞ_fmt_num
);

3064  
ER_DYNCOL_OK
;

3065 
	}
}

3067 #ifdeà
UNUSED


3068 
’um_dyncÞ_func_»suÉ


3069 
	$dyÇmic_cÞumn_upd©e_move_right
(
DYNAMIC_COLUMN
 *
¡r
, 
PLAN
 *
¶ª
,

3070 
size_t
 
off£t_size
,

3071 
size_t
 
’Œy_size
,

3072 
size_t
 
h—d”_size
,

3073 
size_t
 
Ãw_off£t_size
,

3074 
size_t
 
Ãw_’Œy_size
,

3075 
size_t
 
Ãw_h—d”_size
,

3076 
ušt
 
cÞumn_couÁ
,

3077 
ušt
 
Ãw_cÞumn_couÁ
,

3078 
ušt
 
add_cÞumn_couÁ
,

3079 
uch¬
 *
h—d”_’d
,

3080 
size_t
 
max_off£t
)

3082 
uch¬
 *
wr™e
;

3083 
uch¬
 *
h—d”_ba£
ð(uch¬ *)
¡r
->¡¸+ 
FIXED_HEADER_SIZE
;

3084 
ušt
 
i
, 
j
, 
k
;

3085 
size_t
 
cu¼_off£t
;

3087 
wr™e
ð(
uch¬
 *)
¡r
->¡¸+ 
FIXED_HEADER_SIZE
;

3088 
	`£t_fixed_h—d”
(
¡r
, 
Ãw_off£t_size
, 
Ãw_cÞumn_couÁ
);

3095 
cu¼_off£t
ð0, 
i
ð0, 
j
= 0;

3096 
i
 < 
add_cÞumn_couÁ
 || 
j
 < 
cÞumn_couÁ
;

3097 
i
++)

3099 
size_t
 
	`UNINIT_VAR
(
fœ¡_off£t
);

3100 
ušt
 
¡¬t
ð
j
, 
’d
;

3107 
i
 < 
add_cÞumn_couÁ
 && 
¶ª
[i].
aù
 =ð
PLAN_NOP
)

3108 
i
++;

3110 ià(
i
 =ð
add_cÞumn_couÁ
)

3111 
j
ð
’d
ð
cÞumn_couÁ
;

3119 
h—d”_ba£
 + 
j
 * 
’Œy_size
 < 
¶ª
[
i
].
¶aû
)

3120 
j
++;

3121 
’d
ð
j
;

3122 ià((
¶ª
[
i
].
aù
 =ð
PLAN_REPLACE
 ||…Ïn[i].aù =ð
PLAN_DELETE
))

3123 
j
++;

3125 
¶ª
[
i
].
mv_’d
ð
’d
;

3128 
DYNAMIC_COLUMN_TYPE
 

;

3129 
	`ty³_ªd_off£t_»ad_num
(&

, &
fœ¡_off£t
,

3130 
h—d”_ba£
 +

3131 
¡¬t
 * 
’Œy_size
 + 
COLUMN_NUMBER_SIZE
,

3132 
off£t_size
);

3135 ià(
¡¬t
 < 
’d
)

3137 
size_t
 
d©a_size
=

3138 
	`g‘_Ëngth_š‹rv®
(
h—d”_ba£
 + 
¡¬t
 * 
’Œy_size
,

3139 
h—d”_ba£
 + 
’d
 * 
’Œy_size
,

3140 
h—d”_’d
, 
off£t_size
, 
max_off£t
);

3141 ià(
d©a_size
 =ð
DYNCOL_OFFSET_ERROR
 ||

3142 (è
d©a_size
 < 0 ||

3143 
d©a_size
 > 
max_off£t
 - 
fœ¡_off£t
)

3145 
¡r
->
Ëngth
= 0;

3146  
ER_DYNCOL_FORMAT
;

3148 
	`DBUG_ASSERT
(
cu¼_off£t
 =ð
fœ¡_off£t
 + 
¶ª
[
i
].
dd–
);

3149 
¶ª
[
i
].
mv_off£t
ð
fœ¡_off£t
;

3150 
¶ª
[
i
].
mv_Ëngth
ð
d©a_size
;

3151 
cu¼_off£t
+ð
d©a_size
;

3155 
¶ª
[
i
].
mv_Ëngth
= 0;

3156 
¶ª
[
i
].
mv_off£t
ð
cu¼_off£t
;

3159 ià(
¶ª
[
i
].
dd–
 =ð0 && 
off£t_size
 =ð
Ãw_off£t_size
 &&

3160 
¶ª
[
i
].
aù
 !ð
PLAN_DELETE
)

3161 
wr™e
+ð
’Œy_size
 * (
’d
 - 
¡¬t
);

3168 
k
ð
¡¬t
; k < 
’d
; k++)

3170 
uch¬
 *
»ad
ð
h—d”_ba£
 + 
k
 * 
’Œy_size
;

3171 
size_t
 
offs
;

3172 
ušt
 
nm
;

3173 
DYNAMIC_COLUMN_TYPE
 

;

3175 
nm
ð
	`ušt2kÜr
(
»ad
);

3176 
	`ty³_ªd_off£t_»ad_num
(&

, &
offs
, 
»ad
 + 
COLUMN_NUMBER_SIZE
,

3177 
off£t_size
);

3178 ià(
k
 > 
¡¬t
 && 
offs
 < 
fœ¡_off£t
)

3180 
¡r
->
Ëngth
= 0;

3181  
ER_DYNCOL_FORMAT
;

3184 
offs
+ð
¶ª
[
i
].
dd–
;

3185 
	`št2¡Üe
(
wr™e
, 
nm
);

3187 ià(
	`ty³_ªd_off£t_¡Üe_num
(
wr™e
, 
Ãw_off£t_size
, 

, 
offs
))

3189 
¡r
->
Ëngth
= 0;

3190  
ER_DYNCOL_FORMAT
;

3192 
wr™e
+ð
Ãw_’Œy_size
;

3197 ià(
i
 < 
add_cÞumn_couÁ
)

3199 ifÐ
¶ª
[
i
].
aù
 =ð
PLAN_ADD
 ||…Ïn[i].aù =ð
PLAN_REPLACE
)

3201 
	`št2¡Üe
(
wr™e
, *((
ušt
 *)
¶ª
[
i
].
key
));

3202 ià(
	`ty³_ªd_off£t_¡Üe_num
(
wr™e
, 
Ãw_off£t_size
,

3203 
¶ª
[
i
].
v®
[0].
ty³
,

3204 
cu¼_off£t
))

3206 
¡r
->
Ëngth
= 0;

3207  
ER_DYNCOL_FORMAT
;

3209 
wr™e
+ð
Ãw_’Œy_size
;

3210 
cu¼_off£t
+ð
¶ª
[
i
].
Ëngth
;

3220 
¡r
->
Ëngth
ð(
FIXED_HEADER_SIZE
 + 
Ãw_h—d”_size
);

3221 
i
ð0, 
j
= 0;

3222 
i
 < 
add_cÞumn_couÁ
 || 
j
 < 
cÞumn_couÁ
;

3223 
i
++)

3225 
ušt
 
¡¬t
ð
j
, 
’d
;

3232 
i
 < 
add_cÞumn_couÁ
 && 
¶ª
[i].
aù
 =ð
PLAN_NOP
)

3233 
i
++;

3235 
j
ð
’d
ð
¶ª
[
i
].
mv_’d
;

3236 ià(
i
 !ð
add_cÞumn_couÁ
 &&

3237 (
¶ª
[
i
].
aù
 =ð
PLAN_REPLACE
 ||…Ïn[i].aù =ð
PLAN_DELETE
))

3238 
j
++;

3241 ià(
¡¬t
 < 
’d
 && 
¶ª
[
i
].
mv_Ëngth
)

3243 
	`memmove
((
h—d”_ba£
 + 
Ãw_h—d”_size
 +

3244 
¶ª
[
i
].
mv_off£t
 +…Ïn[i].
dd–
),

3245 
h—d”_ba£
 + 
h—d”_size
 + 
¶ª
[
i
].
mv_off£t
,

3246 
¶ª
[
i
].
mv_Ëngth
);

3248 
¡r
->
Ëngth
+ð
¶ª
[
i
].
mv_Ëngth
;

3251 ià(
i
 < 
add_cÞumn_couÁ
)

3253 ifÐ
¶ª
[
i
].
aù
 =ð
PLAN_ADD
 ||…Ïn[i].aù =ð
PLAN_REPLACE
)

3255 
	`d©a_¡Üe
(
¡r
, 
¶ª
[
i
].
v®
, 
dyncÞ_fmt_num
);

3259  
ER_DYNCOL_OK
;

3260 
	}
}

3274 
	#IN_PLACE_PLAN
 4

	)

3276 
’um_dyncÞ_func_»suÉ


3277 
	$dyÇmic_cÞumn_upd©e_mªy
(
DYNAMIC_COLUMN
 *
¡r
,

3278 
ušt
 
add_cÞumn_couÁ
,

3279 
ušt
 *
cÞumn_numb”s
,

3280 
DYNAMIC_COLUMN_VALUE
 *
v®ues
)

3282  
	`dyÇmic_cÞumn_upd©e_mªy_fmt
(
¡r
, 
add_cÞumn_couÁ
, 
cÞumn_numb”s
,

3283 
v®ues
, 
FALSE
);

3284 
	}
}

3286 
’um_dyncÞ_func_»suÉ


3287 
	$m¬Ÿdb_dyncÞ_upd©e_mªy_num
(
DYNAMIC_COLUMN
 *
¡r
,

3288 
ušt
 
add_cÞumn_couÁ
,

3289 
ušt
 *
cÞumn_numb”s
,

3290 
DYNAMIC_COLUMN_VALUE
 *
v®ues
)

3292  
	`dyÇmic_cÞumn_upd©e_mªy_fmt
(
¡r
, 
add_cÞumn_couÁ
, 
cÞumn_numb”s
,

3293 
v®ues
, 
FALSE
);

3294 
	}
}

3296 
’um_dyncÞ_func_»suÉ


3297 
	$m¬Ÿdb_dyncÞ_upd©e_mªy_Çmed
(
DYNAMIC_COLUMN
 *
¡r
,

3298 
ušt
 
add_cÞumn_couÁ
,

3299 
LEX_STRING
 *
cÞumn_Çmes
,

3300 
DYNAMIC_COLUMN_VALUE
 *
v®ues
)

3302  
	`dyÇmic_cÞumn_upd©e_mªy_fmt
(
¡r
, 
add_cÞumn_couÁ
, 
cÞumn_Çmes
,

3303 
v®ues
, 
TRUE
);

3304 
	}
}

3306 
ušt
 
	$numËn
(
ušt
 
v®
)

3308 
ušt
 
»s
;

3309 ià(
v®
 == 0)

3311 
»s
= 0;

3312 
v®
)

3314 
»s
++;

3315 
v®
/=10;

3317  
»s
;

3318 
	}
}

3320 
’um_dyncÞ_func_»suÉ


3321 
	$dyÇmic_cÞumn_upd©e_mªy_fmt
(
DYNAMIC_COLUMN
 *
¡r
,

3322 
ušt
 
add_cÞumn_couÁ
,

3323 *
cÞumn_keys
,

3324 
DYNAMIC_COLUMN_VALUE
 *
v®ues
,

3325 
my_boÞ
 
¡ršg_keys
)

3327 
PLAN
 *
¶ª
, *
®loc_¶ª
ð
NULL
, 
š_¶aû_¶ª
[
IN_PLACE_PLAN
];

3328 
uch¬
 *
–em’t
;

3329 
DYN_HEADER
 
h—d”
, 
Ãw_h—d”
;

3330 
¡_£rviû_funcs
 *
fmt
, *
Ãw_fmt
;

3331 
d©a_d–
ð0, 
Çme_d–
= 0;

3332 
ušt
 
i
;

3333 
ušt
 
nÙ_nuÎ
;

3334 
h—d”_d–
= 0;

3335 
h—d”_d–_sign
, 
d©a_d–_sign
;

3336 
cÝy
ð
FALSE
;

3337 
’um_dyncÞ_func_»suÉ
 
rc
;

3338 
my_boÞ
 
cÚv”t
;

3340 ià(
add_cÞumn_couÁ
 == 0)

3341  
ER_DYNCOL_OK
;

3343 
	`mem£t
(&
h—d”
, 0, (header));

3344 
	`mem£t
(&
Ãw_h—d”
, 0, (new_header));

3345 
Ãw_h—d”
.
fÜm©
ð(
¡ršg_keys
 ? 
dyncÞ_fmt_¡r
 : 
dyncÞ_fmt_num
);

3346 
Ãw_fmt
ð
fmt_d©a
 + 
Ãw_h—d”
.
fÜm©
;

3352 ià(
IN_PLACE_PLAN
 > 
add_cÞumn_couÁ
)

3353 
¶ª
ð
š_¶aû_¶ª
;

3354 ià(!(
®loc_¶ª
ð
¶ª
=

3355 (
PLAN
 *)
	`m®loc
((PLANè* (
add_cÞumn_couÁ
 + 1))))

3356  
ER_DYNCOL_RESOURCE
;

3358 
nÙ_nuÎ
ð
add_cÞumn_couÁ
;

3359 
i
ð0, 
–em’t
ð(
uch¬
 *è
cÞumn_keys
;

3360 
i
 < 
add_cÞumn_couÁ
;

3361 
i
++, 
–em’t
+ð
Ãw_fmt
->
key_size_š_¬¿y
)

3363 ià((*
Ãw_fmt
->
check_lim™
)(&
–em’t
))

3365 
rc
ð
ER_DYNCOL_DATA
;

3366 
’d
;

3369 
¶ª
[
i
].
v®
ð
v®ues
 + i;

3370 
¶ª
[
i
].
key
ð
–em’t
;

3371 ià(
v®ues
[
i
].
ty³
 =ð
DYN_COL_NULL
)

3372 
nÙ_nuÎ
--;

3376 ià(
¡r
->
Ëngth
 == 0)

3382 
ü—‹_Ãw_¡ršg
;

3386 ià((
rc
ð
	`š™_»ad_hdr
(&
h—d”
, 
¡r
)) < 0)

3387 
’d
;

3388 
fmt
ð
fmt_d©a
 + 
h—d”
.
fÜm©
;

3390 
	`DBUG_ASSERT
(
Ãw_h—d”
.
fÜm©
 =ð
dyncÞ_fmt_¡r
 ||

3391 
h—d”
.
fÜm©
 =ð
dyncÞ_fmt_num
);

3392 ià(
h—d”
.
cÞumn_couÁ
 == 0)

3393 
ü—‹_Ãw_¡ršg
;

3395 
	`qsÜt
(
¶ª
, (
size_t
)
add_cÞumn_couÁ
, (
PLAN
), 
Ãw_fmt
->
¶ª_sÜt
);

3397 
Ãw_h—d”
.
cÞumn_couÁ
ð
h—d”
.column_count;

3398 
Ãw_h—d”
.
nmpoÞ_size
ð
h—d”
.nmpool_size;

3399 ià((
cÚv”t
ð(
Ãw_h—d”
.
fÜm©
 =ð
dyncÞ_fmt_¡r
 &&

3400 
h—d”
.
fÜm©
 =ð
dyncÞ_fmt_num
)))

3402 
	`DBUG_ASSERT
(
Ãw_h—d”
.
nmpoÞ_size
 == 0);

3403 
i
ð0, 
h—d”
.
’Œy
= header.header;

3404 
i
 < 
h—d”
.
cÞumn_couÁ
;

3405 
i
++, 
h—d”
.
’Œy
+ðh—d”.
’Œy_size
)

3407 
Ãw_h—d”
.
nmpoÞ_size
+ð
	`numËn
(
	`ušt2kÜr
(
h—d”
.
’Œy
));

3411 ià(
fmt
->
fixed_hdr
 + 
h—d”
.
h—d”_size
 + h—d”.
nmpoÞ_size
 > 
¡r
->
Ëngth
)

3413 
rc
ð
ER_DYNCOL_FORMAT
;

3414 
’d
;

3421 
i
ð0; i < 
add_cÞumn_couÁ
; i++)

3428 ià(
i
 < 
add_cÞumn_couÁ
 - 1 &&

3429 
Ãw_fmt
->
	`cÞumn_sÜt
(&
¶ª
[
i
].
key
, &plan[i + 1].key) == 0)

3431 
rc
ð
ER_DYNCOL_DATA
;

3432 
’d
;

3436 
¶ª
[
i
].
dd–
ð
d©a_d–
;

3437 
¶ª
[
i
].
nd–
ð
Çme_d–
;

3439 
¶ª
[
i
].
hd–
ð
h—d”_d–
;

3440 
¶ª
[
i
].
Ëngth
= 0;

3442 ià(
	`fšd_¶aû
(&
h—d”
, 
¶ª
[
i
].
key
, 
¡ršg_keys
))

3444 
size_t
 
’Œy_d©a_size
, 
’Œy_Çme_size
= 0;

3448 
’Œy_d©a_size
ð
	`hdr_š‹rv®_Ëngth
(&
h—d”
, h—d”.
’Œy
 +

3449 
h—d”
.
’Œy_size
);

3450 ià(
’Œy_d©a_size
 =ð
DYNCOL_OFFSET_ERROR
 ||

3451 (è
’Œy_d©a_size
 < 0)

3453 
rc
ð
ER_DYNCOL_FORMAT
;

3454 
’d
;

3457 ià(
Ãw_h—d”
.
fÜm©
 =ð
dyncÞ_fmt_¡r
)

3459 ià(
h—d”
.
fÜm©
 =ð
dyncÞ_fmt_¡r
)

3461 
LEX_STRING
 
Çme
;

3462 ià(
	`»ad_Çme
(&
h—d”
, h—d”.
’Œy
, &
Çme
))

3464 
rc
ð
ER_DYNCOL_FORMAT
;

3465 
’d
;

3467 
’Œy_Çme_size
ð
Çme
.
Ëngth
;

3470 
’Œy_Çme_size
ð
	`numËn
(
	`ušt2kÜr
(
h—d”
.
’Œy
));

3473 ià(
¶ª
[
i
].
v®
->
ty³
 =ð
DYN_COL_NULL
)

3477 
¶ª
[
i
].
aù
ð
PLAN_DELETE
;

3478 
h—d”_d–
--;

3479 
d©a_d–
-ð
’Œy_d©a_size
;

3480 
Çme_d–
-ð
’Œy_Çme_size
;

3486 
¶ª
[
i
].
aù
ð
PLAN_REPLACE
;

3488 ià((
¶ª
[
i
].
Ëngth
ð
	`dyÇmic_cÞumn_v®ue_Ën
ÕÏn[i].
v®
,

3489 
Ãw_h—d”
.
fÜm©
)) ==

3490 (
size_t
) ~0)

3492 
rc
ð
ER_DYNCOL_DATA
;

3493 
’d
;

3495 
d©a_d–
+ð
¶ª
[
i
].
Ëngth
 - 
’Œy_d©a_size
;

3496 ià(
Ãw_h—d”
.
fÜm©
 =ð
dyncÞ_fmt_¡r
)

3498 
Çme_d–
+ð((
LEX_STRING
 *)(
¶ª
[
i
].
key
))->
Ëngth
 - 
’Œy_Çme_size
;

3506 ià(
¶ª
[
i
].
v®
->
ty³
 =ð
DYN_COL_NULL
)

3508 
¶ª
[
i
].
aù
ð
PLAN_NOP
;

3514 
¶ª
[
i
].
aù
ð
PLAN_ADD
;

3515 
h—d”_d–
++;

3517 ià((
¶ª
[
i
].
Ëngth
ð
	`dyÇmic_cÞumn_v®ue_Ën
ÕÏn[i].
v®
,

3518 
Ãw_h—d”
.
fÜm©
)) ==

3519 (
size_t
) ~0)

3521 
rc
ð
ER_DYNCOL_DATA
;

3522 
’d
;

3524 
d©a_d–
+ð
¶ª
[
i
].
Ëngth
;

3525 ià(
Ãw_h—d”
.
fÜm©
 =ð
dyncÞ_fmt_¡r
)

3526 
Çme_d–
+ð((
LEX_STRING
 *)
¶ª
[
i
].
key
)->
Ëngth
;

3529 
¶ª
[
i
].
¶aû
ð
h—d”
.
’Œy
;

3531 
¶ª
[
add_cÞumn_couÁ
].
hd–
ð
h—d”_d–
;

3532 
¶ª
[
add_cÞumn_couÁ
].
dd–
ð
d©a_d–
;

3533 
¶ª
[
add_cÞumn_couÁ
].
aù
ð
PLAN_NOP
;

3534 
¶ª
[
add_cÞumn_couÁ
].
¶aû
ð
h—d”
.
doÞ
;

3536 
Ãw_h—d”
.
cÞumn_couÁ
ð(
ušt
)(
h—d”
.cÞumn_couÁ + 
h—d”_d–
);

3542 
Ãw_h—d”
.
d©a_size
ð
h—d”
.d©a_siz+ (
size_t
)
d©a_d–
;

3543 
Ãw_h—d”
.
nmpoÞ_size
ðÃw_h—d”.nmpoÞ_siz+ (
size_t
)
Çme_d–
;

3544 
	`DBUG_ASSERT
(
Ãw_h—d”
.
fÜm©
 !ð
dyncÞ_fmt_num
 ||

3545 
Ãw_h—d”
.
nmpoÞ_size
 == 0);

3546 ià((
Ãw_h—d”
.
off£t_size
=

3547 
Ãw_fmt
->
	`dyÇmic_cÞumn_off£t_by‹s
(
Ãw_h—d”
.
d©a_size
)) >=

3548 
Ãw_fmt
->
max_off£t_size
)

3550 
rc
ð
ER_DYNCOL_LIMIT
;

3551 
’d
;

3554 
cÝy
ð((
h—d”
.
fÜm©
 !ð
Ãw_h—d”
.format) ||

3555 (
Ãw_h—d”
.
fÜm©
 =ð
dyncÞ_fmt_¡r
));

3557 
h—d”_d–_sign
=

3558 (()
Ãw_h—d”
.
off£t_size
 + 
Ãw_fmt
->
fixed_hdr_’Œy
) -

3559 (()
h—d”
.
off£t_size
 + 
fmt
->
fixed_hdr_’Œy
);

3560 
d©a_d–_sign
= 0;

3562 
i
ð0; i <ð
add_cÞumn_couÁ
 && !
cÝy
; i++)

3565 
	`DELTA_CHECK
(
h—d”_d–_sign
, 
¶ª
[
i
].
hd–
, 
cÝy
);

3566 
	`DELTA_CHECK
(
d©a_d–_sign
, 
¶ª
[
i
].
dd–
, 
cÝy
);

3568 
	`ÿlc_·¿m
(&
Ãw_h—d”
.
’Œy_size
, &Ãw_h—d”.
h—d”_size
,

3569 
Ãw_fmt
->
fixed_hdr_’Œy
,

3570 
Ãw_h—d”
.
off£t_size
,‚ew_h—d”.
cÞumn_couÁ
);

3578 ià(
cÝy
 ||

3579 
¡r
->
max_Ëngth
 < sŒ->
Ëngth
 + 
h—d”_d–
 + 
d©a_d–
 ||

3580 ((
h—d”_d–_sign
 < 0 && 
d©a_d–_sign
 > 0) ||

3581 (
h—d”_d–_sign
 > 0 && 
d©a_d–_sign
 < 0)))

3582 
rc
ð
	`dyÇmic_cÞumn_upd©e_cÝy
(
¡r
, 
¶ª
, 
add_cÞumn_couÁ
,

3583 &
h—d”
, &
Ãw_h—d”
,

3584 
cÚv”t
);

3586 ià(
h—d”_d–_sign
 < 0)

3587 
rc
ð
	`dyÇmic_cÞumn_upd©e_move_Ëá
(
¡r
, 
¶ª
, 
h—d”
.
off£t_size
,

3588 
h—d”
.
’Œy_size
,

3589 
h—d”
.
h—d”_size
,

3590 
Ãw_h—d”
.
off£t_size
,

3591 
Ãw_h—d”
.
’Œy_size
,

3592 
Ãw_h—d”
.
h—d”_size
,

3593 
h—d”
.
cÞumn_couÁ
,

3594 
Ãw_h—d”
.
cÞumn_couÁ
,

3595 
add_cÞumn_couÁ
, 
h—d”
.
doÞ
,

3596 
h—d”
.
d©a_size
);

3608 
rc
ð
	`dyÇmic_cÞumn_upd©e_cÝy
(
¡r
, 
¶ª
, 
add_cÞumn_couÁ
,

3609 &
h—d”
, &
Ãw_h—d”
,

3610 
cÚv”t
);

3611 
’d
:

3612 
	`ä“
(
®loc_¶ª
);

3613  
rc
;

3615 
ü—‹_Ãw_¡ršg
:

3617 
rc
ð
ER_DYNCOL_OK
;

3618 ià(
nÙ_nuÎ
 != 0)

3619 
rc
ð
	`dyÇmic_cÞumn_ü—‹_mªy_š‹º®_fmt
(
¡r
, 
add_cÞumn_couÁ
,

3620 (
ušt
*)
cÞumn_keys
, 
v®ues
,

3621 
¡r
->¡¸=ð
NULL
,

3622 
¡ršg_keys
);

3623 
’d
;

3624 
	}
}

3638 
	$dyÇmic_cÞumn_upd©e
(
DYNAMIC_COLUMN
 *
¡r
, 
ušt
 
cÞumn_Ä
,

3639 
DYNAMIC_COLUMN_VALUE
 *
v®ue
)

3641  
	`dyÇmic_cÞumn_upd©e_mªy
(
¡r
, 1, &
cÞumn_Ä
, 
v®ue
);

3642 
	}
}

3645 
’um_dyncÞ_func_»suÉ


3646 
	$m¬Ÿdb_dyncÞ_check
(
DYNAMIC_COLUMN
 *
¡r
)

3648 
¡_£rviû_funcs
 *
fmt
;

3649 
’um_dyncÞ_func_»suÉ
 
rc
ð
ER_DYNCOL_FORMAT
;

3650 
DYN_HEADER
 
h—d”
;

3651 
ušt
 
i
;

3652 
size_t
 
d©a_off£t
ð0, 
Çme_off£t
= 0;

3653 
size_t
 
´ev_d©a_off£t
ð0, 
´ev_Çme_off£t
= 0;

3654 
LEX_STRING
 
Çme
ð{0,0}, 
´ev_Çme
= {0,0};

3655 
ušt
 
num
ð0, 
´ev_num
= 0;

3656 *
key
, *
´ev_key
;

3657 
’um_dyÇmic_cÞumn_ty³
 
ty³
ð
DYN_COL_NULL
, 
´ev_ty³
= DYN_COL_NULL;

3659 ià(
¡r
->
Ëngth
 == 0)

3661 (
ER_DYNCOL_OK
);

3664 
	`mem£t
(&
h—d”
, 0, (header));

3667 ià(
	`»ad_fixed_h—d”
(&
h—d”
, 
¡r
))

3669 
’d
;

3671 
fmt
ð
fmt_d©a
 + 
h—d”
.
fÜm©
;

3672 
	`ÿlc_·¿m
(&
h—d”
.
’Œy_size
, &h—d”.
h—d”_size
,

3673 
fmt
->
fixed_hdr_’Œy
, 
h—d”
.
off£t_size
,

3674 
h—d”
.
cÞumn_couÁ
);

3676 ià(
fmt
->
fixed_hdr
 + 
h—d”
.
h—d”_size
 + h—d”.
nmpoÞ_size
 > 
¡r
->
Ëngth
)

3678 
’d
;

3680 
h—d”
.h—d”ð(
uch¬
*)
¡r
->¡¸+ 
fmt
->
fixed_hdr
;

3681 
h—d”
.
nmpoÞ
ðh—d”.h—d” + h—d”.
h—d”_size
;

3682 
h—d”
.
doÞ
ðh—d”.
nmpoÞ
 + h—d”.
nmpoÞ_size
;

3683 
h—d”
.
d©a_size
ð
¡r
->
Ëngth
 - 
fmt
->
fixed_hdr
 -

3684 
h—d”
.
h—d”_size
 - h—d”.
nmpoÞ_size
;

3687 ià(
h—d”
.
fÜm©
 =ð
dyncÞ_fmt_num
)

3689 
key
ð&
num
;

3690 
´ev_key
ð&
´ev_num
;

3694 
key
ð&
Çme
;

3695 
´ev_key
ð&
´ev_Çme
;

3697 
i
ð0, 
h—d”
.
’Œy
= header.header;

3698 
i
 < 
h—d”
.
cÞumn_couÁ
;

3699 
i
++, 
h—d”
.
’Œy
+ðh—d”.
’Œy_size
)

3702 ià(
h—d”
.
fÜm©
 =ð
dyncÞ_fmt_num
)

3704 
num
ð
	`ušt2kÜr
(
h—d”
.
’Œy
);

3708 
	`DBUG_ASSERT
(
h—d”
.
fÜm©
 =ð
dyncÞ_fmt_¡r
);

3709 ià(
	`»ad_Çme
(&
h—d”
, h—d”.
’Œy
, &
Çme
))

3711 
’d
;

3713 
Çme_off£t
ð
Çme
.
¡r
 - (*)
h—d”
.
nmpoÞ
;

3715 ià((*
fmt
->
ty³_ªd_off£t_»ad
)(&
ty³
, &
d©a_off£t
,

3716 
h—d”
.
’Œy
 + 
fmt
->
fixed_hdr_’Œy
,

3717 
h—d”
.
off£t_size
))

3718 
’d
;

3720 
	`DBUG_ASSERT
(
ty³
 !ð
DYN_COL_NULL
);

3721 ià(
d©a_off£t
 > 
h—d”
.
d©a_size
)

3723 
’d
;

3725 ià(
´ev_ty³
 !ð
DYN_COL_NULL
)

3728 ià(
´ev_d©a_off£t
 >ð
d©a_off£t
)

3730 
’d
;

3732 ià(
´ev_Çme_off£t
 > 
Çme_off£t
)

3734 
’d
;

3736 ià((*
fmt
->
cÞumn_sÜt
)(&
´ev_key
, &
key
) >= 0)

3738 
’d
;

3741 
´ev_num
ð
num
;

3742 
´ev_Çme
ð
Çme
;

3743 
´ev_d©a_off£t
ð
d©a_off£t
;

3744 
´ev_Çme_off£t
ð
Çme_off£t
;

3745 
´ev_ty³
ð
ty³
;

3749 
i
ð0, 
h—d”
.
’Œy
= header.header;

3750 
i
 < 
h—d”
.
cÞumn_couÁ
;

3751 
i
++, 
h—d”
.
’Œy
+ðh—d”.
’Œy_size
)

3753 
DYNAMIC_COLUMN_VALUE
 
¡Üe
;

3755 (*
fmt
->
ty³_ªd_off£t_»ad
)(&
h—d”
.
ty³
, &h—d”.
off£t
,

3756 
h—d”
.
’Œy
 + 
fmt
->
fixed_hdr_’Œy
,

3757 
h—d”
.
off£t_size
);

3758 
h—d”
.
Ëngth
=

3759 
	`hdr_š‹rv®_Ëngth
(&
h—d”
, h—d”.
’Œy
 + h—d”.
’Œy_size
);

3760 
h—d”
.
d©a
ðh—d”.
doÞ
 + h—d”.
off£t
;

3761 (
h—d”
.
ty³
)) {

3762 
DYN_COL_INT
:

3763 
rc
ð
	`dyÇmic_cÞumn_sšt_»ad
(&
¡Üe
, 
h—d”
.
d©a
, h—d”.
Ëngth
);

3765 
DYN_COL_UINT
:

3766 
rc
ð
	`dyÇmic_cÞumn_ušt_»ad
(&
¡Üe
, 
h—d”
.
d©a
, h—d”.
Ëngth
);

3768 
DYN_COL_DOUBLE
:

3769 
rc
ð
	`dyÇmic_cÞumn_doubË_»ad
(&
¡Üe
, 
h—d”
.
d©a
, h—d”.
Ëngth
);

3771 
DYN_COL_STRING
:

3772 
rc
ð
	`dyÇmic_cÞumn_¡ršg_»ad
(&
¡Üe
, 
h—d”
.
d©a
, h—d”.
Ëngth
);

3774 #iâdeà
LIBMARIADB


3775 
DYN_COL_DECIMAL
:

3776 
rc
ð
	`dyÇmic_cÞumn_decim®_»ad
(&
¡Üe
, 
h—d”
.
d©a
, h—d”.
Ëngth
);

3779 
DYN_COL_DATETIME
:

3780 
rc
ð
	`dyÇmic_cÞumn_d©e_time_»ad
(&
¡Üe
, 
h—d”
.
d©a
,

3781 
h—d”
.
Ëngth
);

3783 
DYN_COL_DATE
:

3784 
rc
ð
	`dyÇmic_cÞumn_d©e_»ad
(&
¡Üe
, 
h—d”
.
d©a
, h—d”.
Ëngth
);

3786 
DYN_COL_TIME
:

3787 
rc
ð
	`dyÇmic_cÞumn_time_»ad
(&
¡Üe
, 
h—d”
.
d©a
, h—d”.
Ëngth
);

3789 
DYN_COL_DYNCOL
:

3790 
rc
ð
	`dyÇmic_cÞumn_dyncÞ_»ad
(&
¡Üe
, 
h—d”
.
d©a
, h—d”.
Ëngth
);

3792 
DYN_COL_NULL
:

3794 
rc
ð
ER_DYNCOL_FORMAT
;

3795 
’d
;

3797 ià(
rc
 !ð
ER_DYNCOL_OK
)

3799 
	`DBUG_ASSERT
(
rc
 < 0);

3800 
’d
;

3804 
rc
ð
ER_DYNCOL_OK
;

3805 
’d
:

3806 (
rc
);

3807 
	}
}

3809 
’um_dyncÞ_func_»suÉ


3810 
	$m¬Ÿdb_dyncÞ_v®_¡r
(
DYNAMIC_STRING
 *
¡r
, 
DYNAMIC_COLUMN_VALUE
 *
v®
,

3811 
MARIADB_CHARSET_INFO
 *
cs
, 
quÙe
)

3813 
buff
[40];

3814 
size_t
 
Ën
;

3815 
v®
->
ty³
) {

3816 
DYN_COL_INT
:

3817 
Ën
ð
	`¢´štf
(
buff
, (buff), "%Îd", 
v®
->
x
.
lÚg_v®ue
);

3818 ià(
	`ma_dyn¡r_­³nd_mem
(
¡r
, 
buff
, 
Ën
))

3819  
ER_DYNCOL_RESOURCE
;

3821 
DYN_COL_UINT
:

3822 
Ën
ð
	`¢´štf
(
buff
, (buff), "%Îu", 
v®
->
x
.
ulÚg_v®ue
);

3823 ià(
	`ma_dyn¡r_­³nd_mem
(
¡r
, 
buff
, 
Ën
))

3824  
ER_DYNCOL_RESOURCE
;

3826 
DYN_COL_DOUBLE
:

3827 
Ën
ð
	`¢´štf
(
buff
, (buff), "%g", 
v®
->
x
.
doubË_v®ue
);

3828 ià(
	`ma_dyn¡r_»®loc
(
¡r
, 
Ën
 + (
quÙe
 ? 2 : 0)))

3829  
ER_DYNCOL_RESOURCE
;

3830 ià(
quÙe
)

3831 
¡r
->¡r[¡r->
Ëngth
++]ð
quÙe
;

3832 
	`ma_dyn¡r_­³nd_mem
(
¡r
, 
buff
, 
Ën
);

3833 ià(
quÙe
)

3834 
¡r
->¡r[¡r->
Ëngth
++]ð
quÙe
;

3836 
DYN_COL_DYNCOL
:

3837 
DYN_COL_STRING
:

3839 *
®loc
ð
NULL
;

3840 *
äom
ð
v®
->
x
.
¡ršg
.
v®ue
.
¡r
;

3841 
ulÚg
 
bufæ’
;

3842 
my_boÞ
 
cÚv
ð((
v®
->
x
.
¡ršg
.
ch¬£t
 =ð
cs
) ||

3843 !
	`¡rcmp
(
v®
->
x
.
¡ršg
.
ch¬£t
->
Çme
, 
cs
->name));

3844 
my_boÞ
 
rc
;

3845 
Ën
ð
v®
->
x
.
¡ršg
.
v®ue
.
Ëngth
;

3846 
bufæ’
ð(
ulÚg
)(
Ën
 * (
cÚv
 ? 
cs
->
ch¬_maxËn
 : 1));

3847 ià(
	`ma_dyn¡r_»®loc
(
¡r
, 
bufæ’
))

3848  
ER_DYNCOL_RESOURCE
;

3851 ià(!
cÚv
)

3853 #iâdeà
LIBMARIADB


3854 
ušt
 
dumma_”rÜs
;

3856 
dumma_”rÜs
;

3858 ià(!
quÙe
)

3861 
¡r
->
Ëngth
+=

3862 #iâdeà
LIBMARIADB


3863 
	`cÝy_ªd_cÚv”t_ex‹nded
(
¡r
->¡r, 
bufæ’
,

3864 
cs
,

3865 
äom
, (
ušt32
)
Ën
,

3866 
v®
->
x
.
¡ršg
.
ch¬£t
,

3867 &
dumma_”rÜs
);

3869 
	`m¬Ÿdb_cÚv”t_¡ršg
(
äom
, &
Ën
, 
v®
->
x
.
¡ršg
.
ch¬£t
,

3870 
¡r
->¡r, (
size_t
 *)&
bufæ’
, 
cs
, &
dumma_”rÜs
);

3872  
ER_DYNCOL_OK
;

3874 ià((
®loc
ð(*)
	`m®loc
(
bufæ’
)))

3876 
Ën
=

3877 #iâdeà
LIBMARIADB


3878 
	`cÝy_ªd_cÚv”t_ex‹nded
(
®loc
, 
bufæ’
, 
cs
,

3879 
äom
, (
ušt32
)
Ën
,

3880 
v®
->
x
.
¡ršg
.
ch¬£t
,

3881 &
dumma_”rÜs
);

3883 
	`m¬Ÿdb_cÚv”t_¡ršg
(
äom
, &
Ën
, 
v®
->
x
.
¡ršg
.
ch¬£t
,

3884 
®loc
, (
size_t
 *)&
bufæ’
, 
cs
, &
dumma_”rÜs
);

3886 
äom
ð
®loc
;

3889  
ER_DYNCOL_RESOURCE
;

3891 ià(
quÙe
)

3892 
rc
ð
	`ma_dyn¡r_­³nd_quÙed
(
¡r
, 
äom
, 
Ën
, 
quÙe
);

3894 
rc
ð
	`ma_dyn¡r_­³nd_mem
(
¡r
, 
äom
, 
Ën
);

3895 ià(
®loc
)

3896 
	`ä“
(
®loc
);

3897 ià(
rc
)

3898  
ER_DYNCOL_RESOURCE
;

3901 #iâdeà
LIBMARIADB


3902 
DYN_COL_DECIMAL
:

3904 
Ën
ð(
buff
);

3905 
	`decim®2¡ršg
(&
v®
->
x
.
decim®
.
v®ue
, 
buff
, &
Ën
,

3906 0, 
v®
->
x
.
decim®
.
v®ue
.
äac
,

3908 ià(
	`ma_dyn¡r_­³nd_mem
(
¡r
, 
buff
, 
Ën
))

3909  
ER_DYNCOL_RESOURCE
;

3913 
DYN_COL_DATETIME
:

3914 
DYN_COL_DATE
:

3915 
DYN_COL_TIME
:

3916 #iâdeà
LIBMARIADB


3917 
Ën
ð
	`my_TIME_to_¡r
(&
v®
->
x
.
time_v®ue
, 
buff
, 
AUTO_SEC_PART_DIGITS
);

3919 
Ën
ð
	`m¬Ÿdb_time_to_¡ršg
(&
v®
->
x
.
time_v®ue
, 
buff
, 39, 
AUTO_SEC_PART_DIGITS
);

3921 ià(
	`ma_dyn¡r_»®loc
(
¡r
, 
Ën
 + (
quÙe
 ? 2 : 0)))

3922  
ER_DYNCOL_RESOURCE
;

3923 ià(
quÙe
)

3924 
¡r
->¡r[¡r->
Ëngth
++]= '"';

3925 
	`ma_dyn¡r_­³nd_mem
(
¡r
, 
buff
, 
Ën
);

3926 ià(
quÙe
)

3927 
¡r
->¡r[¡r->
Ëngth
++]= '"';

3929 
DYN_COL_NULL
:

3930 ià(
	`ma_dyn¡r_­³nd_mem
(
¡r
, "null", 4))

3931  
ER_DYNCOL_RESOURCE
;

3934 (
ER_DYNCOL_FORMAT
);

3936 (
ER_DYNCOL_OK
);

3937 
	}
}

3939 
’um_dyncÞ_func_»suÉ


3940 
	$m¬Ÿdb_dyncÞ_v®_lÚg
(
lÚglÚg
 *
Î
, 
DYNAMIC_COLUMN_VALUE
 *
v®
)

3942 
’um_dyncÞ_func_»suÉ
 
rc
ð
ER_DYNCOL_OK
;

3943 *
Î
= 0;

3944 
v®
->
ty³
) {

3945 
DYN_COL_INT
:

3946 *
Î
ð
v®
->
x
.
lÚg_v®ue
;

3948 
DYN_COL_UINT
:

3949 *
Î
ð(
lÚglÚg
)
v®
->
x
.
ulÚg_v®ue
;

3950 ià(*
Î
 > (
lÚglÚg
)
ULONGLONG_MAX
)

3951 
rc
ð
ER_DYNCOL_TRUNCATED
;

3953 
DYN_COL_DOUBLE
:

3954 *
Î
ð(
lÚglÚg
)
v®
->
x
.
doubË_v®ue
;

3955 ià(((è*
Î
è!ð
v®
->
x
.
doubË_v®ue
)

3956 
rc
ð
ER_DYNCOL_TRUNCATED
;

3958 
DYN_COL_STRING
:

3960 *
¤c
ð
v®
->
x
.
¡ršg
.
v®ue
.
¡r
;

3961 
size_t
 
Ën
ð
v®
->
x
.
¡ršg
.
v®ue
.
Ëngth
;

3962 
lÚglÚg
 
i
ð0, 
sign
= 1;

3964 
Ën
 && 
	`is¥aû
(*
¤c
)) src++,len--;

3966 ià(
Ën
)

3968 ià(*
¤c
 == '-')

3970 
sign
= -1;

3971 
¤c
++;

3973 
Ën
 && 
	`isdig™
(*
¤c
))

3975 
i
ð˜* 10 + (*
¤c
 - '0');

3976 
¤c
++;

3980 
rc
ð
ER_DYNCOL_TRUNCATED
;

3981 ià(
Ën
)

3982 
rc
ð
ER_DYNCOL_TRUNCATED
;

3983 *
Î
ð
i
 * 
sign
;

3986 #iâdeà
LIBMARIADB


3987 
DYN_COL_DECIMAL
:

3988 ià(
	`decim®2lÚglÚg
(&
v®
->
x
.
decim®
.
v®ue
, 
Î
è!ð
E_DEC_OK
)

3989 
rc
ð
ER_DYNCOL_TRUNCATED
;

3992 
DYN_COL_DATETIME
:

3993 *
Î
ð(
v®
->
x
.
time_v®ue
.
y—r
 * 10000000000ull +

3994 
v®
->
x
.
time_v®ue
.
mÚth
 * 100000000L +

3995 
v®
->
x
.
time_v®ue
.
day
 * 1000000 +

3996 
v®
->
x
.
time_v®ue
.
hour
 * 10000 +

3997 
v®
->
x
.
time_v®ue
.
mšu‹
 * 100 +

3998 
v®
->
x
.
time_v®ue
.
£cÚd
) *

3999 (
v®
->
x
.
time_v®ue
.
Ãg
 ? -1 : 1);

4001 
DYN_COL_DATE
:

4002 *
Î
ð(
v®
->
x
.
time_v®ue
.
y—r
 * 10000 +

4003 
v®
->
x
.
time_v®ue
.
mÚth
 * 100 +

4004 
v®
->
x
.
time_v®ue
.
day
) *

4005 (
v®
->
x
.
time_v®ue
.
Ãg
 ? -1 : 1);

4007 
DYN_COL_TIME
:

4008 *
Î
ð(
v®
->
x
.
time_v®ue
.
hour
 * 10000 +

4009 
v®
->
x
.
time_v®ue
.
mšu‹
 * 100 +

4010 
v®
->
x
.
time_v®ue
.
£cÚd
) *

4011 (
v®
->
x
.
time_v®ue
.
Ãg
 ? -1 : 1);

4013 
DYN_COL_DYNCOL
:

4014 
DYN_COL_NULL
:

4015 
rc
ð
ER_DYNCOL_TRUNCATED
;

4018 (
ER_DYNCOL_FORMAT
);

4020 (
rc
);

4021 
	}
}

4024 
’um_dyncÞ_func_»suÉ


4025 
	$m¬Ÿdb_dyncÞ_v®_doubË
(*
dbl
, 
DYNAMIC_COLUMN_VALUE
 *
v®
)

4027 
’um_dyncÞ_func_»suÉ
 
rc
ð
ER_DYNCOL_OK
;

4028 *
dbl
= 0;

4029 
v®
->
ty³
) {

4030 
DYN_COL_INT
:

4031 *
dbl
ð()
v®
->
x
.
lÚg_v®ue
;

4032 ià(((
lÚglÚg
è*
dbl
è!ð
v®
->
x
.
lÚg_v®ue
)

4033 
rc
ð
ER_DYNCOL_TRUNCATED
;

4035 
DYN_COL_UINT
:

4036 *
dbl
ð()
v®
->
x
.
ulÚg_v®ue
;

4037 ià(((
ulÚglÚg
è*
dbl
è!ð
v®
->
x
.
ulÚg_v®ue
)

4038 
rc
ð
ER_DYNCOL_TRUNCATED
;

4040 
DYN_COL_DOUBLE
:

4041 *
dbl
ð
v®
->
x
.
doubË_v®ue
;

4043 
DYN_COL_STRING
:

4045 *
¡r
, *
’d
;

4046 ià(!(
¡r
ð
	`m®loc
(
v®
->
x
.
¡ršg
.
v®ue
.
Ëngth
 + 1)))

4047  
ER_DYNCOL_RESOURCE
;

4048 
	`memýy
(
¡r
, 
v®
->
x
.
¡ršg
.
v®ue
.¡r, v®->x.¡ršg.v®ue.
Ëngth
);

4049 
¡r
[
v®
->
x
.
¡ršg
.
v®ue
.
Ëngth
]= '\0';

4050 *
dbl
ð
	`¡¹od
(
¡r
, &
’d
);

4051 ià(*
’d
 != '\0')

4052 
rc
ð
ER_DYNCOL_TRUNCATED
;

4053 
	`ä“
(
¡r
);

4056 #iâdeà
LIBMARIADB


4057 
DYN_COL_DECIMAL
:

4058 ià(
	`decim®2doubË
(&
v®
->
x
.
decim®
.
v®ue
, 
dbl
è!ð
E_DEC_OK
)

4059 
rc
ð
ER_DYNCOL_TRUNCATED
;

4062 
DYN_COL_DATETIME
:

4063 *
dbl
ð()(
v®
->
x
.
time_v®ue
.
y—r
 * 10000000000ull +

4064 
v®
->
x
.
time_v®ue
.
mÚth
 * 100000000L +

4065 
v®
->
x
.
time_v®ue
.
day
 * 1000000 +

4066 
v®
->
x
.
time_v®ue
.
hour
 * 10000 +

4067 
v®
->
x
.
time_v®ue
.
mšu‹
 * 100 +

4068 
v®
->
x
.
time_v®ue
.
£cÚd
) *

4069 (
v®
->
x
.
time_v®ue
.
Ãg
 ? -1 : 1);

4071 
DYN_COL_DATE
:

4072 *
dbl
ð()(
v®
->
x
.
time_v®ue
.
y—r
 * 10000 +

4073 
v®
->
x
.
time_v®ue
.
mÚth
 * 100 +

4074 
v®
->
x
.
time_v®ue
.
day
) *

4075 (
v®
->
x
.
time_v®ue
.
Ãg
 ? -1 : 1);

4077 
DYN_COL_TIME
:

4078 *
dbl
ð()(
v®
->
x
.
time_v®ue
.
hour
 * 10000 +

4079 
v®
->
x
.
time_v®ue
.
mšu‹
 * 100 +

4080 
v®
->
x
.
time_v®ue
.
£cÚd
) *

4081 (
v®
->
x
.
time_v®ue
.
Ãg
 ? -1 : 1);

4083 
DYN_COL_DYNCOL
:

4084 
DYN_COL_NULL
:

4085 
rc
ð
ER_DYNCOL_TRUNCATED
;

4088 (
ER_DYNCOL_FORMAT
);

4090 (
rc
);

4091 
	}
}

4103 
	#JSON_STACK_PROTECTION
 10

	)

4105 
’um_dyncÞ_func_»suÉ


4106 
	$m¬Ÿdb_dyncÞ_jsÚ_š‹º®
(
DYNAMIC_COLUMN
 *
¡r
, 
DYNAMIC_STRING
 *
jsÚ
,

4107 
ušt
 
lvl
)

4109 
DYN_HEADER
 
h—d”
;

4110 
ušt
 
i
;

4111 
’um_dyncÞ_func_»suÉ
 
rc
;

4113 ià(
lvl
 >ð
JSON_STACK_PROTECTION
)

4115 
rc
ð
ER_DYNCOL_RESOURCE
;

4116 
”r
;

4120 ià(
¡r
->
Ëngth
 == 0)

4121  
ER_DYNCOL_OK
;

4123 ià((
rc
ð
	`š™_»ad_hdr
(&
h—d”
, 
¡r
)) < 0)

4124 
”r
;

4126 ià(
h—d”
.
’Œy_size
 * h—d”.
cÞumn_couÁ
 + 
FIXED_HEADER_SIZE
 >

4127 
¡r
->
Ëngth
)

4129 
rc
ð
ER_DYNCOL_FORMAT
;

4130 
”r
;

4133 
rc
ð
ER_DYNCOL_RESOURCE
;

4135 ià(
	`ma_dyn¡r_­³nd_mem
(
jsÚ
, "{", 1))

4136 
”r
;

4137 
i
ð0, 
h—d”
.
’Œy
= header.header;

4138 
i
 < 
h—d”
.
cÞumn_couÁ
;

4139 
i
++, 
h—d”
.
’Œy
+ðh—d”.
’Œy_size
)

4141 
DYNAMIC_COLUMN_VALUE
 
v®
;

4142 ià(
i
 !ð0 && 
	`ma_dyn¡r_­³nd_mem
(
jsÚ
, ",", 1))

4143 
”r
;

4144 
h—d”
.
Ëngth
=

4145 
	`hdr_š‹rv®_Ëngth
(&
h—d”
, h—d”.
’Œy
 + h—d”.
’Œy_size
);

4146 
h—d”
.
d©a
ðh—d”.
doÞ
 + h—d”.
off£t
;

4151 ià(
h—d”
.
Ëngth
 =ð
DYNCOL_OFFSET_ERROR
 ||

4152 
h—d”
.
Ëngth
 > 
INT_MAX
 || h—d”.
off£t
 > h—d”.
d©a_size
)

4154 
rc
ð
ER_DYNCOL_FORMAT
;

4155 
”r
;

4157 ià((
rc
ð
	`dyÇmic_cÞumn_g‘_v®ue
(&
h—d”
, &
v®
)) < 0)

4158 
”r
;

4159 ià(
h—d”
.
fÜm©
 =ð
dyncÞ_fmt_num
)

4161 
ušt
 
nm
ð
	`ušt2kÜr
(
h—d”
.
’Œy
);

4162 ià(
	`ma_dyn¡r_»®loc
(
jsÚ
, 
DYNCOL_NUM_CHAR
 + 3))

4163 
”r
;

4164 
jsÚ
->
¡r
[jsÚ->
Ëngth
++]= '"';

4165 
jsÚ
->
Ëngth
+ð
	`¢´štf
(jsÚ->
¡r
 + json->length,

4166 
DYNCOL_NUM_CHAR
, "%u", 
nm
);

4170 
LEX_STRING
 
Çme
;

4171 ià(
	`»ad_Çme
(&
h—d”
, h—d”.
’Œy
, &
Çme
))

4173 
rc
ð
ER_DYNCOL_FORMAT
;

4174 
”r
;

4176 ià(
	`ma_dyn¡r_»®loc
(
jsÚ
, 
Çme
.
Ëngth
 + 3))

4177 
”r
;

4178 
jsÚ
->
¡r
[jsÚ->
Ëngth
++]= '"';

4179 
	`memýy
(
jsÚ
->
¡r
 + jsÚ->
Ëngth
, 
Çme
.str,‚ame.length);

4180 
jsÚ
->
Ëngth
+ð
Çme
.length;

4182 
jsÚ
->
¡r
[jsÚ->
Ëngth
++]= '"';

4183 
jsÚ
->
¡r
[jsÚ->
Ëngth
++]= ':';

4184 ià(
v®
.
ty³
 =ð
DYN_COL_DYNCOL
)

4187 
DYNAMIC_COLUMN
 
dc
;

4188 
	`mem£t
(&
dc
, 0, (dc));

4189 
dc
.
¡r
ð
v®
.
x
.
¡ršg
.
v®ue
.str;

4190 
dc
.
Ëngth
ð
v®
.
x
.
¡ršg
.
v®ue
.length;

4191 ià(
	`m¬Ÿdb_dyncÞ_jsÚ_š‹º®
(&
dc
, 
jsÚ
, 
lvl
 + 1) < 0)

4193 
dc
.
¡r
ð
NULL
; dc.
Ëngth
= 0;

4194 
”r
;

4196 
dc
.
¡r
ð
NULL
; dc.
Ëngth
= 0;

4200 ià((
rc
ð
	`m¬Ÿdb_dyncÞ_v®_¡r
(
jsÚ
, &
v®
,

4201 
ma_ch¬£t_utf8_g’”®_ci
, '"')) < 0)

4202 
”r
;

4205 ià(
	`ma_dyn¡r_­³nd_mem
(
jsÚ
, "}", 1))

4207 
rc
ð
ER_DYNCOL_RESOURCE
;

4208 
”r
;

4210  
ER_DYNCOL_OK
;

4212 
”r
:

4213 
jsÚ
->
Ëngth
= 0;

4214  
rc
;

4215 
	}
}

4217 
’um_dyncÞ_func_»suÉ


4218 
	$m¬Ÿdb_dyncÞ_jsÚ
(
DYNAMIC_COLUMN
 *
¡r
, 
DYNAMIC_STRING
 *
jsÚ
)

4221 ià(
	`ma_š™_dyÇmic_¡ršg
(
jsÚ
, 
NULL
, 
¡r
->
Ëngth
 * 2, 100))

4222  
ER_DYNCOL_RESOURCE
;

4224  
	`m¬Ÿdb_dyncÞ_jsÚ_š‹º®
(
¡r
, 
jsÚ
, 1);

4225 
	}
}

4238 
’um_dyncÞ_func_»suÉ


4239 
	$m¬Ÿdb_dyncÞ_uÅack
(
DYNAMIC_COLUMN
 *
¡r
,

4240 
ušt
 *
couÁ
,

4241 
LEX_STRING
 **
Çmes
, 
DYNAMIC_COLUMN_VALUE
 **
v®s
)

4243 
DYN_HEADER
 
h—d”
;

4244 *
nm
;

4245 
ušt
 
i
;

4246 
’um_dyncÞ_func_»suÉ
 
rc
;

4248 *
couÁ
ð0; *
Çmes
ð0; *
v®s
= 0;

4250 ià(
¡r
->
Ëngth
 == 0)

4251  
ER_DYNCOL_OK
;

4253 ià((
rc
ð
	`š™_»ad_hdr
(&
h—d”
, 
¡r
)) < 0)

4254  
rc
;

4257 ià(
h—d”
.
’Œy_size
 * h—d”.
cÞumn_couÁ
 + 
FIXED_HEADER_SIZE
 >

4258 
¡r
->
Ëngth
)

4259  
ER_DYNCOL_FORMAT
;

4261 *
v®s
ð(
DYNAMIC_COLUMN_VALUE
 *)
	`m®loc
((DYNAMIC_COLUMN_VALUE)* 
h—d”
.
cÞumn_couÁ
);

4262 ià(
h—d”
.
fÜm©
 =ð
dyncÞ_fmt_num
)

4264 *
Çmes
ð(
LEX_STRING
 *)
	`m®loc
((LEX_STRINGè* 
h—d”
.
cÞumn_couÁ
 +

4265 
DYNCOL_NUM_CHAR
 * 
h—d”
.
cÞumn_couÁ
);

4266 
nm
ð(*)((*
Çmes
è+ 
h—d”
.
cÞumn_couÁ
);

4270 *
Çmes
ð(
LEX_STRING
 *)
	`m®loc
((LEX_STRINGè* 
h—d”
.
cÞumn_couÁ
);

4271 
nm
= 0;

4273 ià(!(*
v®s
è|| !(*
Çmes
))

4275 
rc
ð
ER_DYNCOL_RESOURCE
;

4276 
”r
;

4279 
i
ð0, 
h—d”
.
’Œy
= header.header;

4280 
i
 < 
h—d”
.
cÞumn_couÁ
;

4281 
i
++, 
h—d”
.
’Œy
+ðh—d”.
’Œy_size
)

4283 
h—d”
.
Ëngth
=

4284 
	`hdr_š‹rv®_Ëngth
(&
h—d”
, h—d”.
’Œy
 + h—d”.
’Œy_size
);

4285 
h—d”
.
d©a
ðh—d”.
doÞ
 + h—d”.
off£t
;

4290 ià(
h—d”
.
Ëngth
 =ð
DYNCOL_OFFSET_ERROR
 ||

4291 
h—d”
.
Ëngth
 > 
INT_MAX
 || h—d”.
off£t
 > h—d”.
d©a_size
)

4293 
rc
ð
ER_DYNCOL_FORMAT
;

4294 
”r
;

4296 ià((
rc
ð
	`dyÇmic_cÞumn_g‘_v®ue
(&
h—d”
, (*
v®s
è+ 
i
)) < 0)

4297 
”r
;

4299 ià(
h—d”
.
fÜm©
 =ð
dyncÞ_fmt_num
)

4301 
ušt
 
num
ð
	`ušt2kÜr
(
h—d”
.
’Œy
);

4302 (*
Çmes
)[
i
].
¡r
ð
nm
;

4303 (*
Çmes
)[
i
].
Ëngth
ð
	`¢´štf
(
nm
, 
DYNCOL_NUM_CHAR
, "%u", 
num
);

4304 
nm
+ð(*
Çmes
)[
i
].
Ëngth
 + 1;

4308 ià(
	`»ad_Çme
(&
h—d”
, h—d”.
’Œy
, (*
Çmes
è+ 
i
))

4310 
rc
ð
ER_DYNCOL_FORMAT
;

4311 
”r
;

4316 *
couÁ
ð
h—d”
.
cÞumn_couÁ
;

4317  
ER_DYNCOL_OK
;

4319 
”r
:

4320 ià(*
v®s
)

4322 
	`ä“
(*
v®s
);

4323 *
v®s
= 0;

4325 ià(*
Çmes
)

4327 
	`ä“
(*
Çmes
);

4328 *
Çmes
= 0;

4330  
rc
;

4331 
	}
}

4343 
’um_dyncÞ_func_»suÉ


4344 
	$m¬Ÿdb_dyncÞ_cÞumn_couÁ
(
DYNAMIC_COLUMN
 *
¡r
, 
ušt
 *
cÞumn_couÁ
)

4346 
DYN_HEADER
 
h—d”
;

4347 
’um_dyncÞ_func_»suÉ
 
rc
;

4349 (*
cÞumn_couÁ
)= 0;

4350 ià(
¡r
->
Ëngth
 == 0)

4351  
ER_DYNCOL_OK
;

4353 ià((
rc
ð
	`š™_»ad_hdr
(&
h—d”
, 
¡r
)) < 0)

4354  
rc
;

4355 *
cÞumn_couÁ
ð
h—d”
.column_count;

4356  
rc
;

4357 
	}
}

4365 
	$m¬Ÿdb_dyncÞ_ä“
(
DYNAMIC_COLUMN
 *
¡r
)

4367 
	`ma_dyn¡r_ä“
(
¡r
);

4368 
	}
}

	@libmariadb/mariadb_lib.c

24 
	~<ma_glob®.h
>

26 
	~<ma_sys.h
>

27 
	~<ma_¡ršg.h
>

28 
	~<m¬Ÿdb_ùy³.h
>

29 
	~<ma_commÚ.h
>

30 
	~"ma_´iv.h
"

31 
	~"ma_cÚ‹xt.h
"

32 
	~"mysql.h
"

33 
	~"m¬Ÿdb_v”siÚ.h
"

34 
	~"ma_£rv”_”rÜ.h
"

35 
	~<m¬Ÿdb/ma_io.h
>

36 
	~"”rmsg.h
"

37 
	~<sys/¡©.h
>

38 
	~<sigÇl.h
>

39 
	~<time.h
>

40 
	~<m¬Ÿdb_dyncÞ.h
>

42 #iâdeà
__has_ã©u»


43 
	#__has_ã©u»
(
x
è0

	)

46 #ifdeà
HAVE_PWD_H


47 
	~<pwd.h
>

49 #ià!
defšed
(
_WIN32
)

50 
	~<sys/sock‘.h
>

51 
	~<Ãtš‘/š.h
>

52 
	~<¬·/š‘.h
>

53 
	~<Ãtdb.h
>

54 #ifdeà
HAVE_SELECT_H


55 
	~<£Ëù.h
>

57 #ifdeà
HAVE_SYS_SELECT_H


58 
	~<sys/£Ëù.h
>

61 #ifdeà
HAVE_SYS_UN_H


62 
	~<sys/un.h
>

64 #iâdeà
INADDR_NONE


65 
	#INADDR_NONE
 -1

	)

67 
	~<ma_sha1.h
>

68 #iâdeà
_WIN32


69 
	~<pÞl.h
>

71 
	~<ma_pvio.h
>

72 #ifdeà
HAVE_TLS


73 
	~<ma_Žs.h
>

75 
	~<mysql/þ›Á_¶ugš.h
>

76 #ifdeà
_WIN32


77 
	~"shlw­i.h
"

78 
	#¡ºÿ£cmp
 
_¡ºicmp


	)

81 
	#ASYNC_CONTEXT_DEFAULT_STACK_SIZE
 (4096*15)

	)

82 
	#MA_RPL_VERSION_HACK
 "5.5.5-"

	)

84 
	#CHARSET_NAME_LEN
 64

	)

86 #undeà
max_®lowed_·ck‘


87 #undeà
Ãt_bufãr_Ëngth


88 
ulÚg
 
max_®lowed_·ck‘
;

89 
ulÚg
 
Ãt_bufãr_Ëngth
;

91 
MYSQL_PARAMETERS
 
	gm¬Ÿdb_š‹º®_·¿m‘”s
ð{&
max_®lowed_·ck‘
, &
Ãt_bufãr_Ëngth
, 0};

92 
my_boÞ
 
	gmysql_þ›Á_š™
=0;

93 
mysql_þo£_ÝtiÚs
(
MYSQL
 *
mysql
);

94 
ma_þ—r_£ssiÚ_¡©e
(
MYSQL
 *
mysql
);

95 
»Ëa£_cÚfigu¿tiÚ_dœs
();

96 **
g‘_deçuÉ_cÚfigu¿tiÚ_dœs
();

97 
my_boÞ
 
ma_š™_dÚe
;

98 
my_boÞ
 
mysql_ps_subsy¡em_š™Ÿlized
;

99 
my_boÞ
 
mysql_hªdË_loÿl_šfže
(
MYSQL
 *
mysql
, cÚ¡ *
fž’ame
, my_boÞ 
ÿn_loÿl_šfže
);

100 cÚ¡ 
MARIADB_CHARSET_INFO
 * 
mysql_fšd_ch¬£t_Ä
(
ušt
 
ch¬£Šr
);

101 cÚ¡ 
MARIADB_CHARSET_INFO
 * 
mysql_fšd_ch¬£t_Çme
(cÚ¡ * cÚ¡ 
Çme
);

102 
my_boÞ
 
£t_deçuÉ_ch¬£t_by_Çme
(cÚ¡ *
cs_Çme
, 
myf
 
æags
 
__©Œibu‹__
((
unu£d
)));

103 
run_¶ugš_auth
(
MYSQL
 *
mysql
, *
d©a
, 
ušt
 
d©a_Ën
,

104 cÚ¡ *
d©a_¶ugš
, cÚ¡ *
db
);

105 
Ãt_add_muÉi_commªd
(
NET
 *
Ãt
, 
uch¬
 
commªd
, cÚ¡ uch¬ *
·ck‘
,

106 
size_t
 
Ëngth
);

108 
LIST
 *
pvio_ÿÎback
;

111 
my_boÞ
 
mthd_suµÜ‹d_bufãr_ty³
(
’um_f›ld_ty³s
 
ty³
);

112 
my_boÞ
 
mthd_¡mt_»ad_´•¬e_»¥Ú£
(
MYSQL_STMT
 *
¡mt
);

113 
my_boÞ
 
mthd_¡mt_g‘_·¿m_m‘ad©a
(
MYSQL_STMT
 *
¡mt
);

114 
my_boÞ
 
mthd_¡mt_g‘_»suÉ_m‘ad©a
(
MYSQL_STMT
 *
¡mt
);

115 
mthd_¡mt_ãtch_row
(
MYSQL_STMT
 *
¡mt
, **
row
);

116 
mthd_¡mt_ãtch_to_bšd
(
MYSQL_STMT
 *
¡mt
, *
row
);

117 
mthd_¡mt_»ad_®l_rows
(
MYSQL_STMT
 *
¡mt
);

118 
mthd_¡mt_æush_unbufã»d
(
MYSQL_STMT
 *
¡mt
);

119 
my_boÞ
 
_m¬Ÿdb_»ad_ÝtiÚs
(
MYSQL
 *
mysql
, cÚ¡ *
dœ
, cÚ¡ *
cÚfig_fže
, *
group
, 
»cursiÚ
);

120 *
mysql_Ãt_¡Üe_Ëngth
(*
·ck‘
, 
size_t
 
Ëngth
);

123 
my_cÚ‹xt_š¡®l_su¥’d_»sume_hook
(
mysql_async_cÚ‹xt
 *
b
,

124 (*
hook
)(
my_boÞ
, *),

125 *
u£r_d©a
);

127 
ušt
 
mysql_pÜt
=0;

128 
my_¡ršg
 
mysql_unix_pÜt
=0;

130 
	#CONNECT_TIMEOUT
 0

	)

132 
¡_m¬Ÿdb_m‘hods
 
MARIADB_DEFAULT_METHODS
;

134 #ià
	`defšed
(
_WIN32
)

136 
	#³¼Ü
(
A
)

	)

138 
	~<”ºo.h
>

139 
	#SOCKET_ERROR
 -1

	)

142 
	~<mysql/þ›Á_¶ugš.h
>

144 
	#IS_CONNHDLR_ACTIVE
(
mysql
)\

145 ((
mysql
)->
ex‹nsiÚ
 && (mysql)->ex‹nsiÚ->
cÚn_hdÌ
)

	)

147 
	`’d_£rv”
(
MYSQL
 *
mysql
);

148 
	`mysql_þo£_memÜy
(
MYSQL
 *
mysql
);

149 
	`»ad_u£r_Çme
(*
Çme
);

150 
my_boÞ
 
STDCALL
 
	`m¬Ÿdb_»cÚÃù
(
MYSQL
 *
mysql
);

151 
	`þi_»pÜt_´og»ss
(
MYSQL
 *
mysql
, 
uch¬
 *
·ck‘
, 
ušt
 
Ëngth
);

153 
	`mysql_þ›Á_¶ugš_š™
();

154 
	`mysql_þ›Á_¶ugš_deš™
();

157 
	$Ãt_g‘_”rÜ
(*
buf
, 
size_t
 
buf_Ën
,

158 *
”rÜ
, 
size_t
 
”rÜ_Ën
,

159 *
”rÜ_no
,

160 *
sql¡©e
)

162 *
p
ð
buf
;

163 
size_t
 
”rÜ_msg_Ën
= 0;

165 ià(
buf_Ën
 > 2)

167 *
”rÜ_no
ð
	`ušt2kÜr
(
p
);

168 
p
+= 2;

171 ià(*
p
 == '#')

173 
	`memýy
(
sql¡©e
, ++
p
, 
SQLSTATE_LENGTH
);

174 
p
+ð
SQLSTATE_LENGTH
;

176 
”rÜ_msg_Ën
ð
buf_Ën
 - (
p
 - 
buf
);

177 
”rÜ_msg_Ën
ð
	`MIN
Ó¼Ü_msg_Ën, 
”rÜ_Ën
 - 1);

178 
	`memýy
(
”rÜ
, 
p
, 
”rÜ_msg_Ën
);

182 *
”rÜ_no
ð
CR_UNKNOWN_ERROR
;

183 
	`memýy
(
sql¡©e
, 
SQLSTATE_UNKNOWN
, 
SQLSTATE_LENGTH
);

185 
	}
}

192 
ulÚg


193 
	$ma_Ãt_§ã_»ad
(
MYSQL
 *
mysql
)

195 
NET
 *
Ãt
ð&
mysql
->net;

196 
ulÚg
 
Ën
=0;

198 
»¡¬t
:

199 ià(
Ãt
->
pvio
 != 0)

200 
Ën
=
	`ma_Ãt_»ad
(
Ãt
);

202 ià(
Ën
 =ð
·ck‘_”rÜ
 ||†en == 0)

204 
	`’d_£rv”
(
mysql
);

205 
	`my_£t_”rÜ
(
mysql
, 
Ãt
->
Ï¡_”ºo
 =ð
ER_NET_PACKET_TOO_LARGE
 ?

206 
CR_NET_PACKET_TOO_LARGE
:

207 
CR_SERVER_LOST
,

208 
SQLSTATE_UNKNOWN
, 0, 
”ºo
);

209 (
·ck‘_”rÜ
);

211 ià(
Ãt
->
»ad_pos
[0] == 255)

213 ià(
Ën
 > 3)

215 *
pos
=(*è
Ãt
->
»ad_pos
+1;

216 
ušt
 
Ï¡_”ºo
=
	`ušt2kÜr
(
pos
);

217 
pos
+=2;

218 
Ën
-=2;

220 ià(
Ï¡_”ºo
== 65535 &&

221 ((
	`m¬Ÿdb_cÚÃùiÚ
(
mysql
è&& (mysql->
£rv”_ÿ·bž™›s
 & 
CLIENT_PROGRESS
)) ||

222 (!(
mysql
->
ex‹nsiÚ
->
m¬Ÿdb_£rv”_ÿ·bž™›s
 & 
MARIADB_CLIENT_PROGRESS
 << 32))))

224 ià(
	`þi_»pÜt_´og»ss
(
mysql
, (
uch¬
 *)
pos
, (
ušt
è(
Ën
-1)))

227 
	`my_£t_”rÜ
(
mysql
, 
CR_MALFORMED_PACKET
, 
SQLSTATE_UNKNOWN
, 0);

228  (
·ck‘_”rÜ
);

230 
»¡¬t
;

232 
Ãt
->
Ï¡_”ºo
=†ast_errno;

233 ià(
pos
[0]== '#')

235 
	`ma_¡rmake
(
Ãt
->
sql¡©e
, 
pos
+1, 
SQLSTATE_LENGTH
);

236 
pos
+ð
SQLSTATE_LENGTH
 + 1;

240 
	`¡ºýy
(
Ãt
->
sql¡©e
, 
SQLSTATE_UNKNOWN
, 
SQLSTATE_LENGTH
);

242 
	`ma_¡rmake
(
Ãt
->
Ï¡_”rÜ
,(*è
pos
,

243 
	`mš
(
Ën
,(
Ãt
->
Ï¡_”rÜ
)-1));

247 
	`my_£t_”rÜ
(
mysql
, 
CR_UNKNOWN_ERROR
, 
SQLSTATE_UNKNOWN
, 0);

250 
mysql
->
£rv”_¡©us
&ð~
SERVER_MORE_RESULTS_EXIST
;

252 (
·ck‘_”rÜ
);

254  
Ën
;

255 
	}
}

264 
	$þi_»pÜt_´og»ss
(
MYSQL
 *
mysql
, 
uch¬
 *
·ck‘
, 
ušt
 
Ëngth
)

266 
ušt
 
¡age
, 
max_¡age
, 
´oc_Ëngth
;

267 
´og»ss
;

268 
uch¬
 *
¡¬t
ð
·ck‘
;

270 ià(
Ëngth
 < 5)

273 ià(!(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
 && mysql->ÝtiÚs.ex‹nsiÚ->
»pÜt_´og»ss
))

276 
·ck‘
++;

277 
¡age
ð(
ušt
è*
·ck‘
++;

278 
max_¡age
ð(
ušt
è*
·ck‘
++;

279 
´og»ss
ð
	`ušt3kÜr
(
·ck‘
)/1000.0;

280 
·ck‘
+= 3;

281 
´oc_Ëngth
ð
	`Ãt_f›ld_Ëngth
(&
·ck‘
);

282 ià(
·ck‘
 + 
´oc_Ëngth
 > 
¡¬t
 + 
Ëngth
)

284 (*
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
»pÜt_´og»ss
)(mysql, 
¡age
, 
max_¡age
,

285 
´og»ss
, (*è
·ck‘
,

286 
´oc_Ëngth
);

288 
	}
}

291 
ulÚg


292 
	$Ãt_f›ld_Ëngth
(
uch¬
 **
·ck‘
)

294 
»g1
 
uch¬
 *
pos
ð*
·ck‘
;

295 ià(*
pos
 < 251)

297 (*
·ck‘
)++;

298  (
ulÚg
è*
pos
;

300 ià(*
pos
 == 251)

302 (*
·ck‘
)++;

303  
NULL_LENGTH
;

305 ià(*
pos
 == 252)

307 (*
·ck‘
)+=3;

308  (
ulÚg
è
	`ušt2kÜr
(
pos
+1);

310 ià(*
pos
 == 253)

312 (*
·ck‘
)+=4;

313  (
ulÚg
è
	`ušt3kÜr
(
pos
+1);

315 (*
·ck‘
)+=9;

316  (
ulÚg
è
	`ušt4kÜr
(
pos
+1);

317 
	}
}

322 
	$Ãt_f›ld_Ëngth_Î
(
uch¬
 **
·ck‘
)

324 
»g1
 
uch¬
 *
pos
ð*
·ck‘
;

325 ià(*
pos
 < 251)

327 (*
·ck‘
)++;

328  (è*
pos
;

330 ià(*
pos
 == 251)

332 (*
·ck‘
)++;

333  (è
NULL_LENGTH
;

335 ià(*
pos
 == 252)

337 (*
·ck‘
)+=3;

338  (è
	`ušt2kÜr
(
pos
+1);

340 ià(*
pos
 == 253)

342 (*
·ck‘
)+=4;

343  (è
	`ušt3kÜr
(
pos
+1);

345 (*
·ck‘
)+=9;

346 #ifdeà
NO_CLIENT_LONGLONG


347  (è
	`ušt4kÜr
(
pos
+1);

349  (è
	`ušt8kÜr
(
pos
+1);

351 
	}
}

354 
	$ä“_rows
(
MYSQL_DATA
 *
cur
)

356 ià(
cur
)

358 
	`ma_ä“_roÙ
(&
cur
->
®loc
,
	`MYF
(0));

359 
	`ä“
(
cur
);

361 
	}
}

364 
	$mthd_my_£nd_cmd
(
MYSQL
 *
mysql
,
’um_£rv”_commªd
 
commªd
, cÚ¡ *
¬g
,

365 
size_t
 
Ëngth
, 
my_boÞ
 
skp_check
, *
Ýt_¬g
)

367 
NET
 *
Ãt
ð&
mysql
->net;

368 
»suÉ
= -1;

369 ià(
mysql
->
Ãt
.
pvio
 == 0)

372 ià(
	`m¬Ÿdb_»cÚÃù
(
mysql
))

375 ià(
mysql
->
¡©us
 !ð
MYSQL_STATUS_READY
 ||

376 
mysql
->
£rv”_¡©us
 & 
SERVER_MORE_RESULTS_EXIST
)

378 
	`SET_CLIENT_ERROR
(
mysql
, 
CR_COMMANDS_OUT_OF_SYNC
, 
SQLSTATE_UNKNOWN
, 0);

379 
’d
;

382 ià(
	`IS_CONNHDLR_ACTIVE
(
mysql
))

384 
»suÉ
ð
mysql
->
ex‹nsiÚ
->
cÚn_hdÌ
->
¶ugš
->
	`£t_cÚÃùiÚ
(mysql, 
commªd
, 
¬g
, 
Ëngth
, 
skp_check
, 
Ýt_¬g
);

385 ià(
»suÉ
== -1)

386 (
»suÉ
);

389 
	`CLEAR_CLIENT_ERROR
(
mysql
);

391 
mysql
->
šfo
=0;

392 
mysql
->
afãùed_rows
= ~() 0;

393 
	`ma_Ãt_þ—r
(
Ãt
);

394 ià(!
¬g
)

395 
¬g
="";

397 ià(
Ãt
->
ex‹nsiÚ
->
muÉi_¡©us
=ð
COM_MULTI_ENABLED
)

399  
	`Ãt_add_muÉi_commªd
(
Ãt
, 
commªd
, (cÚ¡ 
uch¬
 *)
¬g
, 
Ëngth
);

402 ià(
	`ma_Ãt_wr™e_commªd
(
Ãt
,(
uch¬
è
commªd
,
¬g
,

403 
Ëngth
 ?†’gth : (
ulÚg
è
	`¡¾’
(
¬g
), 0))

405 ià(
Ãt
->
Ï¡_”ºo
 =ð
ER_NET_PACKET_TOO_LARGE
)

407 
	`my_£t_”rÜ
(
mysql
, 
CR_NET_PACKET_TOO_LARGE
, 
SQLSTATE_UNKNOWN
, 0);

408 
’d
;

410 
	`’d_£rv”
(
mysql
);

411 ià(
	`m¬Ÿdb_»cÚÃù
(
mysql
))

412 
’d
;

413 ià(
	`ma_Ãt_wr™e_commªd
(
Ãt
,(
uch¬
è
commªd
,
¬g
,

414 
Ëngth
 ?†’gth : (
ulÚg
è
	`¡¾’
(
¬g
), 0))

416 
	`my_£t_”rÜ
(
mysql
, 
CR_SERVER_GONE_ERROR
, 
SQLSTATE_UNKNOWN
, 0);

417 
’d
;

420 
»suÉ
=0;

422 ià(
Ãt
->
ex‹nsiÚ
->
muÉi_¡©us
 > 
COM_MULTI_OFF
)

423 
skp_check
= 1;

425 ià(!
skp_check
)

427 
»suÉ
ð((
mysql
->
·ck‘_Ëngth
=
	`ma_Ãt_§ã_»ad
(mysql)è=ð
·ck‘_”rÜ
 ?

430 
’d
:

431 (
»suÉ
);

432 
	}
}

435 
	$ma_sim¶e_commªd
(
MYSQL
 *
mysql
,
’um_£rv”_commªd
 
commªd
, cÚ¡ *
¬g
,

436 
size_t
 
Ëngth
, 
my_boÞ
 
skp_check
, *
Ýt_¬g
)

438 ià((
mysql
->
ÝtiÚs
.
þ›Á_æag
 & 
CLIENT_LOCAL_FILES
) &&

439 
mysql
->
ÝtiÚs
.
ex‹nsiÚ
 && mysql->ex‹nsiÚ->
auto_loÿl_šfže
 =ð
WAIT_FOR_QUERY
 &&

440 
¬g
 && (*arg == 'l' || *arg == 'L') &&

441 
commªd
 =ð
COM_QUERY
)

443 ià(
	`¡ºÿ£cmp
(
¬g
, "load", 4) == 0)

444 
mysql
->
ex‹nsiÚ
->
auto_loÿl_šfže
ð
ACCEPT_FILE_REQUEST
;

446  
mysql
->
m‘hods
->
	`db_commªd
(mysql, 
commªd
, 
¬g
, 
Ëngth
, 
skp_check
, 
Ýt_¬g
);

447 
	}
}

449 
	$ma_muÉi_commªd
(
MYSQL
 *
mysql
, 
’um_muÉi_¡©us
 
¡©us
)

451 
NET
 *
Ãt
ð&
mysql
->net;

453 
¡©us
) {

454 
COM_MULTI_OFF
:

455 
	`ma_Ãt_þ—r
(
Ãt
);

456 
Ãt
->
ex‹nsiÚ
->
muÉi_¡©us
ð
¡©us
;

458 
COM_MULTI_ENABLED
:

459 ià(
Ãt
->
ex‹nsiÚ
->
muÉi_¡©us
 > 
COM_MULTI_DISABLED
)

461 
	`ma_Ãt_þ—r
(
Ãt
);

462 
Ãt
->
ex‹nsiÚ
->
muÉi_¡©us
ð
¡©us
;

464 
COM_MULTI_DISABLED
:

467 
Ãt
->
ex‹nsiÚ
->
muÉi_¡©us
ð
¡©us
;

469 
COM_MULTI_END
:

471 
size_t
 
Ën
ð
Ãt
->
wr™e_pos
 -‚‘->
buff
 - 
NET_HEADER_SIZE
;

473 ià(
Ën
 < 
NET_HEADER_SIZE
)

475 
	`ma_Ãt_þ—r
(
Ãt
);

478 
Ãt
->
ex‹nsiÚ
->
muÉi_¡©us
ð
COM_MULTI_OFF
;

479  
	`ma_Ãt_æush
(
Ãt
);

481 
COM_MULTI_CANCEL
:

482 
	`ma_Ãt_þ—r
(
Ãt
);

483 
Ãt
->
ex‹nsiÚ
->
muÉi_¡©us
ð
COM_MULTI_OFF
;

488 
	}
}

490 
	$ä“_Þd_qu”y
(
MYSQL
 *
mysql
)

492 ià(
mysql
->
f›lds
)

493 
	`ma_ä“_roÙ
(&
mysql
->
f›ld_®loc
,
	`MYF
(0));

494 
	`ma_š™_®loc_roÙ
(&
mysql
->
f›ld_®loc
,8192,0);

495 
mysql
->
f›lds
=0;

496 
mysql
->
f›ld_couÁ
=0;

497 
mysql
->
šfo
= 0;

499 
	}
}

501 #ià
defšed
(
HAVE_GETPWUID
è&& defšed(
NO_GETPWUID_DECL
)

502 
·sswd
 *
g‘pwuid
(
uid_t
);

503 * 
g‘logš
();

506 #ià!
defšed
(
_WIN32
)

507 
	$»ad_u£r_Çme
(*
Çme
)

509 ià(
	`g‘euid
() == 0)

510 
	`¡rýy
(
Çme
,"root");

513 #ifdeà
HAVE_GETPWUID


514 
·sswd
 *
skr
;

515 cÚ¡ *
¡r
;

516 ià((
skr
=
	`g‘pwuid
(
	`g‘euid
())è!ð
NULL
)

518 
¡r
=
skr
->
pw_Çme
;

519 } ià((
¡r
=
	`g‘logš
()è=ð
NULL
)

521 ià(!(
¡r
=
	`g‘’v
("USER")) && !(str=getenv("LOGNAME")) &&

522 !(
¡r
=
	`g‘’v
("LOGIN")))

523 
¡r
="UNKNOWN_USER";

525 
	`ma_¡rmake
(
Çme
,
¡r
,
USERNAME_LENGTH
);

526 #–ià
	`defšed
(
HAVE_CUSERID
)

527 (è
	`cu£rid
(
Çme
);

529 
	`ma_¡rmake
(
Çme
,"UNKNOWN_USER", 
USERNAME_LENGTH
);

533 
	}
}

537 
	$»ad_u£r_Çme
(*
Çme
)

539 *
¡r
=
	`g‘’v
("USERNAME");

540 
	`ma_¡rmake
(
Çme
,
¡r
 ? sŒ : "ODBC", 
USERNAME_LENGTH
);

541 
	}
}

551 
	$’d_£rv”
(
MYSQL
 *
mysql
)

555 ià(
mysql
->
Ãt
.
pvio
 != 0)

557 
	`ma_pvio_þo£
(
mysql
->
Ãt
.
pvio
);

558 
mysql
->
Ãt
.
pvio
= 0;

560 
	`ma_Ãt_’d
(&
mysql
->
Ãt
);

561 
	`ä“_Þd_qu”y
(
mysql
);

563 
	}
}

565 
	$mthd_my_sk_»suÉ
(
MYSQL
 *
mysql
)

567 
ulÚg
 
pkt_Ën
;

570 
pkt_Ën
ð
	`ma_Ãt_§ã_»ad
(
mysql
);

571 ià(
pkt_Ën
 =ð
·ck‘_”rÜ
)

573 } 
pkt_Ën
 > 8 || 
mysql
->
Ãt
.
»ad_pos
[0] != 254);

575 
	}
}

577 
STDCALL


578 
	$mysql_ä“_»suÉ
(
MYSQL_RES
 *
»suÉ
)

580 ià(
»suÉ
)

582 ià(
»suÉ
->
hªdË
 &&„esuÉ->hªdË->
¡©us
 =ð
MYSQL_STATUS_USE_RESULT
)

584 
»suÉ
->
hªdË
->
m‘hods
->
	`db_sk_»suÉ
(result->handle);

585 
»suÉ
->
hªdË
->
¡©us
=
MYSQL_STATUS_READY
;

587 
	`ä“_rows
(
»suÉ
->
d©a
);

588 ià(
»suÉ
->
f›lds
)

589 
	`ma_ä“_roÙ
(&
»suÉ
->
f›ld_®loc
,
	`MYF
(0));

590 ià(
»suÉ
->
row
)

591 
	`ä“
(
»suÉ
->
row
);

592 
	`ä“
(
»suÉ
);

595 
	}
}

601 
	e’um_ÝtiÚ_ty³
 {

602 
	mMARIADB_OPTION_NONE
,

603 
	mMARIADB_OPTION_BOOL
,

604 
	mMARIADB_OPTION_INT
,

605 
	mMARIADB_OPTION_SIZET
,

606 
	mMARIADB_OPTION_STR
,

609 
	s¡_deçuÉ_ÝtiÚs
 {

610 
mysql_ÝtiÚ
 
	mÝtiÚ
;

611 
’um_ÝtiÚ_ty³
 
	mty³
;

612 cÚ¡ *
	mcÚf_key
;

615 
¡_deçuÉ_ÝtiÚs
 
	gm¬Ÿdb_deçuÉs
[] =

617 {
MARIADB_OPT_PORT
, 
MARIADB_OPTION_INT
,"port"},

618 {
MARIADB_OPT_UNIXSOCKET
, 
MARIADB_OPTION_STR
, "socket"},

619 {
MYSQL_OPT_COMPRESS
, 
MARIADB_OPTION_BOOL
, "compress"},

620 {
MARIADB_OPT_PASSWORD
, 
MARIADB_OPTION_STR
, "password"},

621 {
MYSQL_OPT_NAMED_PIPE
, 
MARIADB_OPTION_BOOL
, "pipe"},

622 {
MYSQL_OPT_CONNECT_TIMEOUT
, 
MARIADB_OPTION_INT
, "timeout"},

623 {
MARIADB_OPT_USER
, 
MARIADB_OPTION_STR
, "user"},

624 {
MYSQL_INIT_COMMAND
, 
MARIADB_OPTION_STR
, "init-command"},

625 {
MARIADB_OPT_HOST
, 
MARIADB_OPTION_STR
, "host"},

626 {
MARIADB_OPT_SCHEMA
, 
MARIADB_OPTION_STR
, "database"},

627 {
MARIADB_OPT_DEBUG
, 
MARIADB_OPTION_STR
, "debug"},

628 {
MARIADB_OPT_FOUND_ROWS
, 
MARIADB_OPTION_NONE
, "return-found-rows"},

629 {
MYSQL_OPT_SSL_KEY
, 
MARIADB_OPTION_STR
, "ssl-key"},

630 {
MYSQL_OPT_SSL_CERT
, 
MARIADB_OPTION_STR
,"ssl-cert"},

631 {
MYSQL_OPT_SSL_CA
, 
MARIADB_OPTION_STR
,"ssl-ca"},

632 {
MYSQL_OPT_SSL_CAPATH
, 
MARIADB_OPTION_STR
,"ssl-capath"},

633 {
MYSQL_OPT_SSL_CRL
, 
MARIADB_OPTION_STR
,"ssl-crl"},

634 {
MYSQL_OPT_SSL_CRLPATH
, 
MARIADB_OPTION_STR
,"ssl-crlpath"},

635 {
MYSQL_OPT_SSL_VERIFY_SERVER_CERT
, 
MARIADB_OPTION_BOOL
,"ssl-verify-server-cert"},

636 {
MYSQL_SET_CHARSET_DIR
, 
MARIADB_OPTION_STR
, "character-sets-dir"},

637 {
MYSQL_SET_CHARSET_NAME
, 
MARIADB_OPTION_STR
, "default-character-set"},

638 {
MARIADB_OPT_INTERACTIVE
, 
MARIADB_OPTION_NONE
, "interactive-timeout"},

639 {
MYSQL_OPT_CONNECT_TIMEOUT
, 
MARIADB_OPTION_INT
, "connect-timeout"},

640 {
MYSQL_OPT_LOCAL_INFILE
, 
MARIADB_OPTION_BOOL
, "local-infile"},

642 {
MYSQL_OPT_SSL_CIPHER
, 
MARIADB_OPTION_STR
, "ssl-cipher"},

643 {
MYSQL_OPT_MAX_ALLOWED_PACKET
, 
MARIADB_OPTION_SIZET
, "max-allowed-packet"},

644 {
MYSQL_OPT_NET_BUFFER_LENGTH
, 
MARIADB_OPTION_SIZET
, "net-buffer-length"},

645 {
MYSQL_OPT_PROTOCOL
, 
MARIADB_OPTION_INT
, "protocol"},

646 {
MYSQL_SHARED_MEMORY_BASE_NAME
, 
MARIADB_OPTION_STR
,"shared-memory-base-name"},

647 {
MARIADB_OPT_MULTI_RESULTS
, 
MARIADB_OPTION_NONE
, "multi-results"},

648 {
MARIADB_OPT_MULTI_STATEMENTS
, 
MARIADB_OPTION_STR
, "multi-statements"},

649 {
MARIADB_OPT_MULTI_STATEMENTS
, 
MARIADB_OPTION_STR
, "multi-queries"},

650 {
MYSQL_SECURE_AUTH
, 
MARIADB_OPTION_BOOL
, "secure-auth"},

651 {
MYSQL_REPORT_DATA_TRUNCATION
, 
MARIADB_OPTION_BOOL
, "report-data-truncation"},

652 {
MYSQL_OPT_RECONNECT
, 
MARIADB_OPTION_BOOL
, "reconnect"},

653 {
MYSQL_PLUGIN_DIR
, 
MARIADB_OPTION_STR
, "plugin-dir"},

654 {
MYSQL_DEFAULT_AUTH
, 
MARIADB_OPTION_STR
, "default-auth"},

655 {
MARIADB_OPT_SSL_FP
, 
MARIADB_OPTION_STR
, "ssl-fp"},

656 {
MARIADB_OPT_SSL_FP_LIST
, 
MARIADB_OPTION_STR
, "ssl-fp-list"},

657 {
MARIADB_OPT_SSL_FP_LIST
, 
MARIADB_OPTION_STR
, "ssl-fplist"},

658 {
MARIADB_OPT_TLS_PASSPHRASE
, 
MARIADB_OPTION_STR
, "ssl-passphrase"},

659 {
MARIADB_OPT_TLS_VERSION
, 
MARIADB_OPTION_STR
, "tls-version"},

660 {
MYSQL_SERVER_PUBLIC_KEY
, 
MARIADB_OPTION_STR
, "server-public-key"},

661 {
MYSQL_OPT_BIND
, 
MARIADB_OPTION_STR
, "bind-address"},

662 {
MYSQL_OPT_SSL_ENFORCE
, 
MARIADB_OPTION_BOOL
, "ssl-enforce"},

663 {0, 0, 
NULL
}

666 
	#CHECK_OPT_EXTENSION_SET
(
OPTS
)\

667 ià(!(
OPTS
)->
ex‹nsiÚ
) \

668 (
OPTS
)->
ex‹nsiÚ
ð(
¡_mysql_ÝtiÚs_ex‹nsiÚ
 *) \

669 
	`ÿÎoc
(1, (
¡_mysql_ÝtiÚs_ex‹nsiÚ
));

	)

671 
	#OPT_SET_EXTENDED_VALUE_STR
(
OPTS
, 
KEY
, 
VAL
) \

672 
	`CHECK_OPT_EXTENSION_SET
(
OPTS
) \

673 
	`ä“
((
g±r
)(
OPTS
)->
ex‹nsiÚ
->
KEY
); \

674 if((
VAL
)) \

675 (
OPTS
)->
ex‹nsiÚ
->
KEY
ð
	`¡rdup
((*)(
VAL
)); \

677 (
OPTS
)->
ex‹nsiÚ
->
KEY
ð
NULL


	)

679 
	#OPT_SET_EXTENDED_VALUE
(
OPTS
, 
KEY
, 
VAL
) \

680 
	`CHECK_OPT_EXTENSION_SET
(
OPTS
) \

681 (
OPTS
)->
ex‹nsiÚ
->
KEY
ð(
VAL
)

	)

683 
	#OPT_SET_EXTENDED_VALUE_INT
(
A
,
B
,
C
è
	`OPT_SET_EXTENDED_VALUE
(A,B,C)

	)

685 
	#OPT_SET_VALUE_STR
(
OPTS
, 
KEY
, 
VAL
) \

686 
	`ä“
((
OPTS
)->
KEY
); \

687 if((
VAL
)) \

688 (
OPTS
)->
KEY
ð
	`¡rdup
((*)(
VAL
)); \

690 (
OPTS
)->
KEY
ð
NULL


	)

692 
	#OPT_SET_VALUE_INT
(
OPTS
, 
KEY
, 
VAL
) \

693 (
OPTS
)->
KEY
ð(
VAL
)

	)

695 
	$ÝtiÚs_add_š™commªd
(
¡_mysql_ÝtiÚs
 *
ÝtiÚs
,

696 cÚ¡ *
š™_cmd
)

698 *
š£¹
ð
	`¡rdup
(
š™_cmd
);

699 ià(!
ÝtiÚs
->
š™_commªd
)

701 
ÝtiÚs
->
š™_commªd
ð(
DYNAMIC_ARRAY
*)
	`m®loc
((DYNAMIC_ARRAY));

702 
	`ma_š™_dyÇmic_¬¿y
(
ÝtiÚs
->
š™_commªd
, (*), 5, 5);

705 ià(
	`ma_š£¹_dyÇmic
(
ÝtiÚs
->
š™_commªd
, (
g±r
)&
š£¹
))

706 
	`ä“
(
š£¹
);

707 
	}
}

708 
my_boÞ
 
	$_m¬Ÿdb_£t_cÚf_ÝtiÚ
(
MYSQL
 *
mysql
, cÚ¡ *
cÚfig_ÝtiÚ
, cÚ¡ *
cÚfig_v®ue
)

710 ià(
cÚfig_ÝtiÚ
)

712 
i
;

713 *
c
;

716 (
c
ð
	`¡rchr
(
cÚfig_ÝtiÚ
, '_')))

717 *
c
= '-';

719 
i
=0; 
m¬Ÿdb_deçuÉs
[i].
cÚf_key
; i++)

721 ià(!
	`¡rcmp
(
m¬Ÿdb_deçuÉs
[
i
].
cÚf_key
, 
cÚfig_ÝtiÚ
))

723 
my_boÞ
 
v®_boÞ
;

724 
v®_št
;

725 
size_t
 
v®_siz‘
;

726 
rc
;

727 *
ÝtiÚ_v®
ð
NULL
;

728 
m¬Ÿdb_deçuÉs
[
i
].
ty³
) {

729 
MARIADB_OPTION_BOOL
:

730 
v®_boÞ
= 0;

731 ià(
cÚfig_v®ue
)

732 
v®_boÞ
ð
	`©oi
(
cÚfig_v®ue
);

733 
ÝtiÚ_v®
ð&
v®_boÞ
;

735 
MARIADB_OPTION_INT
:

736 
v®_št
= 0;

737 ià(
cÚfig_v®ue
)

738 
v®_št
ð
	`©oi
(
cÚfig_v®ue
);

739 
ÝtiÚ_v®
ð&
v®_št
;

741 
MARIADB_OPTION_SIZET
:

742 
v®_siz‘
= 0;

743 ià(
cÚfig_v®ue
)

744 
v®_siz‘
ð
	`¡¹Þ
(
cÚfig_v®ue
, 
NULL
, 10);

745 
ÝtiÚ_v®
ð&
v®_siz‘
;

747 
MARIADB_OPTION_STR
:

748 
ÝtiÚ_v®
ð(*)
cÚfig_v®ue
;

750 
MARIADB_OPTION_NONE
:

753 
rc
ð
	`mysql_ÝtiÚsv
(
mysql
, 
m¬Ÿdb_deçuÉs
[
i
].
ÝtiÚ
, 
ÝtiÚ_v®
);

754 (
	`‹¡
(
rc
));

760 
	}
}

763 
MARIADB_CONST_STRING
 
	gnuÎ_cÚ¡_¡ršg
= {0,0};

768 
MARIADB_CONST_STRING
 
	$ma_cÚ¡_¡ršg_cÝy_roÙ
(
MA_MEM_ROOT
 *
memroÙ
,

769 cÚ¡ *
¡r
,

770 
size_t
 
Ëngth
)

772 
MARIADB_CONST_STRING
 
»s
;

773 ià(!
¡r
 || !(
»s
.¡rð
	`ma_memdup_roÙ
(
memroÙ
, sŒ, 
Ëngth
)))

774  
nuÎ_cÚ¡_¡ršg
;

775 
»s
.
Ëngth
=†ength;

776  
»s
;

777 
	}
}

783 
MA_FIELD_EXTENSION
 *
	$Ãw_ma_f›ld_ex‹nsiÚ
(
MA_MEM_ROOT
 *
memroÙ
)

785 
MA_FIELD_EXTENSION
 *
ext
ð
	`ma_®loc_roÙ
(
memroÙ
, (MA_FIELD_EXTENSION));

786 ià(
ext
)

787 
	`mem£t
((*è
ext
, 0, (*ext));

788  
ext
;

789 
	}
}

796 
	$ma_f›ld_ex‹nsiÚ_š™_ty³_šfo
(
MA_MEM_ROOT
 *
memroÙ
,

797 
MA_FIELD_EXTENSION
 *
ext
,

798 cÚ¡ *
±r
, 
size_t
 
Ëngth
)

800 cÚ¡ *
’d
ð
±r
 + 
Ëngth
;

801  ; 
±r
 < 
’d
; )

803 
ušt
 
™y³
ð(
uch¬
è*
±r
++;

804 
ušt
 
Ën
ð(
uch¬
è*
±r
++;

805 ià(
±r
 + 
Ën
 > 
’d
 ||†en > 127)

807 ià(
™y³
 <ð127 && ity³ <ð
MARIADB_FIELD_ATTR_LAST
)

808 
ext
->
m‘ad©a
[
™y³
]ð
	`ma_cÚ¡_¡ršg_cÝy_roÙ
(
memroÙ
, 
±r
, 
Ën
);

809 
±r
+ð
Ën
;

811 
	}
}

818 
MA_FIELD_EXTENSION
 *
	$ma_f›ld_ex‹nsiÚ_d“p_dup
(
MA_MEM_ROOT
 *
memroÙ
,

819 cÚ¡ 
MA_FIELD_EXTENSION
 *
äom
)

821 
MA_FIELD_EXTENSION
 *
ext
ð
	`Ãw_ma_f›ld_ex‹nsiÚ
(
memroÙ
);

822 
ušt
 
i
;

823 ià(!
ext
)

824  
NULL
;

825 
i
ð0; i < 
MARIADB_FIELD_ATTR_LAST
; i++)

827 ià(
äom
->
m‘ad©a
[
i
].
¡r
)

828 
ext
->
m‘ad©a
[
i
]ð
	`ma_cÚ¡_¡ršg_cÝy_roÙ
(
memroÙ
,

829 
äom
->
m‘ad©a
[
i
].
¡r
,

830 
äom
->
m‘ad©a
[
i
].
Ëngth
);

832  
ext
;

833 
	}
}

839 
size_t
 
	gr£t_f›ld_off£ts
[]= {

840 
OFFSET
(
MYSQL_FIELD
, 
ÿlog
),

841 
OFFSET
(
MYSQL_FIELD
, 
ÿlog_Ëngth
),

842 
OFFSET
(
MYSQL_FIELD
, 
db
),

843 
OFFSET
(
MYSQL_FIELD
, 
db_Ëngth
),

844 
OFFSET
(
MYSQL_FIELD
, 
bË
),

845 
OFFSET
(
MYSQL_FIELD
, 
bË_Ëngth
),

846 
OFFSET
(
MYSQL_FIELD
, 
Üg_bË
),

847 
OFFSET
(
MYSQL_FIELD
, 
Üg_bË_Ëngth
),

848 
OFFSET
(
MYSQL_FIELD
, 
Çme
),

849 
OFFSET
(
MYSQL_FIELD
, 
Çme_Ëngth
),

850 
OFFSET
(
MYSQL_FIELD
, 
Üg_Çme
),

851 
OFFSET
(
MYSQL_FIELD
, 
Üg_Çme_Ëngth
)

854 
MYSQL_FIELD
 *

855 
	$uÅack_f›lds
(cÚ¡ 
MYSQL
 *
mysql
,

856 
MYSQL_DATA
 *
d©a
, 
MA_MEM_ROOT
 *
®loc
, 
ušt
 
f›lds
,

857 
my_boÞ
 
deçuÉ_v®ue
)

859 
MYSQL_ROWS
 *
row
;

860 
MYSQL_FIELD
 *
f›ld
,*
»suÉ
;

861 *
p
;

862 
i
, 
f›ld_couÁ
ð(
r£t_f›ld_off£ts
)/(
size_t
)/2;

864 
f›ld
=
»suÉ
=(
MYSQL_FIELD
*è
	`ma_®loc_roÙ
(
®loc
,(MYSQL_FIELD)*
f›lds
);

865 ià(!
»suÉ
)

868 
row
=
d©a
->d©a;„ow ;„ow =„ow->
Ãxt
,
f›ld
++)

870 ià(
f›ld
 >ð
»suÉ
 + 
f›lds
)

871 
”rÜ
;

873 
i
=0; i < 
f›ld_couÁ
; i++)

875 
ušt
 
Ëngth
ð(ušt)(
row
->
d©a
[
i
+1] -„ow->data[i] - 1);

876 ià(!
row
->
d©a
[
i
] &&„ow->d©a[i][
Ëngth
])

877 
”rÜ
;

879 *(**)(((*)
f›ld
è+ 
r£t_f›ld_off£ts
[
i
*2])=

880 
	`ma_¡rdup_roÙ
(
®loc
, (*)
row
->
d©a
[
i
]);

881 *(*)(((*)
f›ld
è+ 
r£t_f›ld_off£ts
[
i
*2+1])ð
Ëngth
;

884 
f›ld
->
ex‹nsiÚ
ð
NULL
;

885 ià(
	`ma_has_ex‹nded_ty³_šfo
(
mysql
))

887 ià(
row
->
d©a
[
i
+1] -„ow->data[i] > 1)

889 
size_t
 
Ën
ð
row
->
d©a
[
i
+1] -„ow->data[i] - 1;

890 
MA_FIELD_EXTENSION
 *
ext
ð
	`Ãw_ma_f›ld_ex‹nsiÚ
(
®loc
);

891 ià((
f›ld
->
ex‹nsiÚ
ð
ext
))

892 
	`ma_f›ld_ex‹nsiÚ_š™_ty³_šfo
(
®loc
, 
ext
, 
row
->
d©a
[
i
], 
Ën
);

894 
i
++;

897 
p
ð(*)
row
->
d©a
[
i
];

899 
f›ld
->
ch¬£Šr
ð
	`ušt2kÜr
(
p
);

900 
p
+= 2;

901 
f›ld
->
Ëngth
ð(
ušt
è
	`ušt4kÜr
(
p
);

902 
p
+= 4;

903 
f›ld
->
ty³
ð(
’um_f›ld_ty³s
)
	`ušt1kÜr
(
p
);

904 
p
++;

905 
f›ld
->
æags
ð
	`ušt2kÜr
(
p
);

906 
p
+= 2;

907 
f›ld
->
decim®s
ð(
ušt
è
p
[0];

908 
p
++;

911 
p
+= 2;

913 ià(
	`INTERNAL_NUM_FIELD
(
f›ld
))

914 
f›ld
->
æags
|ð
NUM_FLAG
;

916 
i
++;

919 ià(
deçuÉ_v®ue
 && 
row
->
d©a
[
i
])

920 
f›ld
->
def
=
	`ma_¡rdup_roÙ
(
®loc
,(*è
row
->
d©a
[
i
]);

922 
f›ld
->
def
=0;

923 
f›ld
->
def_Ëngth
= 0;

925 
f›ld
->
max_Ëngth
= 0;

927 ià(
f›ld
 < 
»suÉ
 + 
f›lds
)

928 
”rÜ
;

929 
	`ä“_rows
(
d©a
);

930 (
»suÉ
);

931 
”rÜ
:

932 
	`ä“_rows
(
d©a
);

933 
	`ma_ä“_roÙ
(
®loc
, 
	`MYF
(0));

935 
	}
}

940 
MYSQL_DATA
 *
	$mthd_my_»ad_rows
(
MYSQL
 *
mysql
,
MYSQL_FIELD
 *
mysql_f›lds
,

941 
ušt
 
f›lds
)

943 
ušt
 
f›ld
;

944 
ulÚg
 
pkt_Ën
;

945 
ulÚg
 
Ën
;

946 
uch¬
 *
ý
;

947 *
to
, *
’d_to
;

948 
MYSQL_DATA
 *
»suÉ
;

949 
MYSQL_ROWS
 **
´ev_±r
,*
cur
;

950 
NET
 *
Ãt
 = &
mysql
->net;

952 ià((
pkt_Ën
ð
	`ma_Ãt_§ã_»ad
(
mysql
)è=ð
·ck‘_”rÜ
)

954 ià(!(
»suÉ
=(
MYSQL_DATA
*è
	`ÿÎoc
(1, (MYSQL_DATA))))

956 
	`SET_CLIENT_ERROR
(
mysql
, 
CR_OUT_OF_MEMORY
, 
SQLSTATE_UNKNOWN
, 0);

959 
	`ma_š™_®loc_roÙ
(&
»suÉ
->
®loc
,8192,0);

960 
»suÉ
->
®loc
.
mš_m®loc
=(
MYSQL_ROWS
);

961 
´ev_±r
ð&
»suÉ
->
d©a
;

962 
»suÉ
->
rows
=0;

963 
»suÉ
->
f›lds
=fields;

965 *(
ý
=
Ãt
->
»ad_pos
è!ð254 || 
pkt_Ën
 >= 8)

967 
»suÉ
->
rows
++;

968 ià(!(
cur
ð(
MYSQL_ROWS
*è
	`ma_®loc_roÙ
(&
»suÉ
->
®loc
,

969 (
MYSQL_ROWS
))) ||

970 !(
cur
->
d©a
ð((
MYSQL_ROW
)

971 
	`ma_®loc_roÙ
(&
»suÉ
->
®loc
,

972 (
f›lds
+1)*(*)+f›lds+
pkt_Ën
))))

974 
	`ä“_rows
(
»suÉ
);

975 
	`SET_CLIENT_ERROR
(
mysql
, 
CR_OUT_OF_MEMORY
, 
SQLSTATE_UNKNOWN
, 0);

978 *
´ev_±r
=
cur
;

979 
´ev_±r
ð&
cur
->
Ãxt
;

980 
to
ð(*è(
cur
->
d©a
+
f›lds
+1);

981 
’d_to
=
to
+
f›lds
+
pkt_Ën
-1;

982 
f›ld
=0 ; f›ld < 
f›lds
 ; field++)

984 ià((
Ën
=(
ulÚg
è
	`Ãt_f›ld_Ëngth
(&
ý
)è=ð
NULL_LENGTH
)

986 
cur
->
d©a
[
f›ld
] = 0;

990 
cur
->
d©a
[
f›ld
] = 
to
;

991 ià(
Ën
 > (
ulÚg
)(
’d_to
 - 
to
) ||o >ƒnd_to)

993 
	`ä“_rows
(
»suÉ
);

994 
	`SET_CLIENT_ERROR
(
mysql
, 
CR_UNKNOWN_ERROR
, 
SQLSTATE_UNKNOWN
, 0);

997 
	`memýy
(
to
,(*è
ý
,
Ën
);o[len]=0;

998 
to
+=
Ën
+1;

999 
ý
+=
Ën
;

1000 ià(
mysql_f›lds
)

1002 ià(
mysql_f›lds
[
f›ld
].
max_Ëngth
 < 
Ën
)

1003 
mysql_f›lds
[
f›ld
].
max_Ëngth
=
Ën
;

1007 
cur
->
d©a
[
f›ld
]=
to
;

1008 ià((
pkt_Ën
=
	`ma_Ãt_§ã_»ad
(
mysql
)è=ð
·ck‘_”rÜ
)

1010 
	`ä“_rows
(
»suÉ
);

1014 *
´ev_±r
=0;

1016 ià(
pkt_Ën
 > 1)

1018 
ý
++;

1019 
mysql
->
w¬nšg_couÁ
ð
	`ušt2kÜr
(
ý
);

1020 
ý
+= 2;

1021 
mysql
->
£rv”_¡©us
ð
	`ušt2kÜr
(
ý
);

1023 (
»suÉ
);

1024 
	}
}

1033 
	$mthd_my_»ad_Úe_row
(
MYSQL
 *
mysql
,
ušt
 
f›lds
,
MYSQL_ROW
 
row
, 
ulÚg
 *
Ëngths
)

1035 
ušt
 
f›ld
;

1036 
ulÚg
 
pkt_Ën
,
Ën
;

1037 
uch¬
 *
pos
,*
´ev_pos
, *
’d_pos
;

1039 ià((
pkt_Ën
=(
ušt
è
	`ma_Ãt_§ã_»ad
(
mysql
)è=ð
·ck‘_”rÜ
)

1042 ià(
pkt_Ën
 <ð8 && 
mysql
->
Ãt
.
»ad_pos
[0] == 254)

1044 
mysql
->
w¬nšg_couÁ
ð
	`ušt2kÜr
(mysql->
Ãt
.
»ad_pos
 + 1);

1045 
mysql
->
£rv”_¡©us
ð
	`ušt2kÜr
(mysql->
Ãt
.
»ad_pos
 + 3);

1048 
´ev_pos
= 0;

1049 
pos
=
mysql
->
Ãt
.
»ad_pos
;

1050 
’d_pos
=
pos
+
pkt_Ën
;

1051 
f›ld
=0 ; f›ld < 
f›lds
 ; field++)

1053 ià((
Ën
=(
ulÚg
è
	`Ãt_f›ld_Ëngth
(&
pos
)è=ð
NULL_LENGTH
)

1055 
row
[
f›ld
] = 0;

1056 *
Ëngths
++=0;

1060 ià(
Ën
 > (
ulÚg
è(
’d_pos
 - 
pos
) ||…os >ƒnd_pos)

1062 
mysql
->
Ãt
.
Ï¡_”ºo
=
CR_UNKNOWN_ERROR
;

1063 
	`¡ºýy
(
mysql
->
Ãt
.
Ï¡_”rÜ
,
	`ER
(mysql->Ãt.
Ï¡_”ºo
),

1064 
MYSQL_ERRMSG_SIZE
 - 1);

1067 
row
[
f›ld
] = (*è
pos
;

1068 
pos
+=
Ën
;

1069 *
Ëngths
++=
Ën
;

1071 ià(
´ev_pos
)

1072 *
´ev_pos
=0;

1073 
´ev_pos
=
pos
;

1075 
row
[
f›ld
]=(*è
´ev_pos
+1;

1076 *
´ev_pos
=0;

1078 
	}
}

1084 
MYSQL
 * 
STDCALL


1085 
	$mysql_š™
(
MYSQL
 *
mysql
)

1087 ià(
	`mysql_£rv”_š™
(0, 
NULL
, NULL))

1088  
NULL
;

1089 ià(!
mysql
)

1091 ià(!(
mysql
=(
MYSQL
*è
	`ÿÎoc
(1, (MYSQL))))

1093 
mysql
->
ä“_me
=1;

1094 
mysql
->
Ãt
.
pvio
= 0;

1095 
mysql
->
Ãt
.
ex‹nsiÚ
= 0;

1099 
	`mem£t
((*è(
mysql
), 0, (*(mysql)));

1100 
mysql
->
Ãt
.
pvio
= 0;

1101 
mysql
->
ä“_me
= 0;

1102 
mysql
->
Ãt
.
ex‹nsiÚ
= 0;

1105 ià(!(
mysql
->
Ãt
.
ex‹nsiÚ
ð(
¡_m¬Ÿdb_Ãt_ex‹nsiÚ
 *)

1106 
	`ÿÎoc
(1, (
¡_m¬Ÿdb_Ãt_ex‹nsiÚ
))) ||

1107 !(
mysql
->
ex‹nsiÚ
ð(
¡_m¬Ÿdb_ex‹nsiÚ
 *)

1108 
	`ÿÎoc
(1, (
¡_m¬Ÿdb_ex‹nsiÚ
))))

1109 
”rÜ
;

1110 
mysql
->
ÝtiÚs
.
»pÜt_d©a_ŒunÿtiÚ
= 1;

1111 
mysql
->
ÝtiÚs
.
cÚÃù_timeout
=
CONNECT_TIMEOUT
;

1112 
mysql
->
ch¬£t
ð
	`mysql_fšd_ch¬£t_Çme
(
MARIADB_DEFAULT_CHARSET
);

1113 
mysql
->
m‘hods
ð&
MARIADB_DEFAULT_METHODS
;

1114 
	`¡rýy
(
mysql
->
Ãt
.
sql¡©e
, "00000");

1115 
mysql
->
Ãt
.
Ï¡_”rÜ
[0]ðmysql->Ãt.
Ï¡_”ºo
ðmysql->Ãt.
ex‹nsiÚ
->
ex‹nded_”ºo
= 0;

1117 ià(
ENABLED_LOCAL_INFILE
 !ð
LOCAL_INFILE_MODE_OFF
)

1118 
mysql
->
ÝtiÚs
.
þ›Á_æag
|ð
CLIENT_LOCAL_FILES
;

1119 
mysql
->
ex‹nsiÚ
->
auto_loÿl_šfže
ð
ENABLED_LOCAL_INFILE
 =ð
LOCAL_INFILE_MODE_AUTO


1120 ? 
WAIT_FOR_QUERY
 : 
ALWAYS_ACCEPT
;

1121 
mysql
->
ÝtiÚs
.
»cÚÃù
= 0;

1122  
mysql
;

1123 
”rÜ
:

1124 ià(
mysql
->
ä“_me
)

1125 
	`ä“
(
mysql
);

1127 
	}
}

1129 
STDCALL


1130 
mysql_s¦_£t
(
MYSQL
 *
mysql
 
__©Œibu‹__
((
unu£d
)),

1131 cÚ¡ *
key
 
__©Œibu‹__
((
unu£d
)),

1132 cÚ¡ *
û¹
 
__©Œibu‹__
((
unu£d
)),

1133 cÚ¡ *
ÿ
 
__©Œibu‹__
((
unu£d
)),

1134 cÚ¡ *
ÿ·th
 
__©Œibu‹__
((
unu£d
)),

1135 cÚ¡ *
ch”
 
__©Œibu‹__
((
unu£d
)))

1137 #ifdeà
HAVE_TLS


1138 
	g’abË
= 1;

1139  (
mysql_ÝtiÚsv
(
mysql
, 
MYSQL_OPT_SSL_ENFORCE
, &
’abË
) |

1140 
mysql_ÝtiÚsv
(
mysql
, 
MYSQL_OPT_SSL_KEY
, 
key
) |

1141 
mysql_ÝtiÚsv
(
mysql
, 
MYSQL_OPT_SSL_CERT
, 
û¹
) |

1142 
mysql_ÝtiÚsv
(
mysql
, 
MYSQL_OPT_SSL_CA
, 
ÿ
) |

1143 
mysql_ÝtiÚsv
(
mysql
, 
MYSQL_OPT_SSL_CAPATH
, 
ÿ·th
) |

1144 
mysql_ÝtiÚsv
(
mysql
, 
MYSQL_OPT_SSL_CIPHER
, 
ch”
)) ? 1 : 0;

1153 cÚ¡ * 
STDCALL


1154 
mysql_g‘_s¦_ch”
(
MYSQL
 *
mysql
 
__©Œibu‹__
((
unu£d
)))

1156 #ifdeà
HAVE_TLS


1157 ià(
	gmysql
->
	gÃt
.
	gpvio
 && mysql->Ãt.pvio->
	gùls
)

1159  
ma_pvio_Žs_ch”
(
mysql
->
Ãt
.
pvio
->
ùls
);

1162 (
	gNULL
);

1170 *
	$ma_£nd_cÚÃù_©Œ
(
MYSQL
 *
mysql
, *
bufãr
)

1172 ià(
mysql
->
£rv”_ÿ·bž™›s
 & 
CLIENT_CONNECT_ATTRS
)

1174 
bufãr
ð(*)
	`mysql_Ãt_¡Üe_Ëngth
((*)bufãr, (
mysql
->
ÝtiÚs
.
ex‹nsiÚ
) ?

1175 
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
cÚÃù_©Œs_Ën
 : 0);

1176 ià(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
 &&

1177 
	`hash_š™ed
(&
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
cÚÃù_©Œs
))

1179 
ušt
 
i
;

1180 
i
=0; i < 
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
cÚÃù_©Œs
.
»cÜds
; i++)

1182 
size_t
 
Ën
;

1183 
uch¬
 *
p
ð
	`hash_–em’t
(&
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
cÚÃù_©Œs
, 
i
);

1185 
Ën
ð
	`¡¾’
((*)
p
);

1186 
bufãr
ð
	`mysql_Ãt_¡Üe_Ëngth
(bufãr, 
Ën
);

1187 
	`memýy
(
bufãr
, 
p
, 
Ën
);

1188 
bufãr
+ð(
Ën
);

1189 
p
+ð(
Ën
 + 1);

1190 
Ën
ð
	`¡¾’
((*)
p
);

1191 
bufãr
ð
	`mysql_Ãt_¡Üe_Ëngth
(bufãr, 
Ën
);

1192 
	`memýy
(
bufãr
, 
p
, 
Ën
);

1193 
bufãr
+ð
Ën
;

1197  (*)
bufãr
;

1198 
	}
}

1201 
my_boÞ


1202 
	$ma_£t_cÚÃù_©Œs
(
MYSQL
 *
mysql
, cÚ¡ *
ho¡
)

1204 
bufãr
[255];

1205 
rc
= 0;

1207 
rc
ð
	`mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_CONNECT_ATTR_DELETE
, "_client_name") +

1208 
	`mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_CONNECT_ATTR_DELETE
, "_client_version") +

1209 
	`mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_CONNECT_ATTR_DELETE
, "_os") +

1210 
	`mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_CONNECT_ATTR_DELETE
, "_server_host") +

1211 #ifdeà
_WIN32


1212 
	`mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_CONNECT_ATTR_DELETE
, "_thread") +

1214 
	`mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_CONNECT_ATTR_DELETE
, "_pid") +

1215 
	`mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_CONNECT_ATTR_DELETE
, "_platform");

1217 
rc
+ð
	`mysql_ÝtiÚsv
(
mysql
, 
MYSQL_OPT_CONNECT_ATTR_ADD
, "_client_name", "libmariadb")

1218 + 
	`mysql_ÝtiÚsv
(
mysql
, 
MYSQL_OPT_CONNECT_ATTR_ADD
, "_þ›Á_v”siÚ", 
MARIADB_PACKAGE_VERSION
)

1219 + 
	`mysql_ÝtiÚsv
(
mysql
, 
MYSQL_OPT_CONNECT_ATTR_ADD
, "_os", 
MARIADB_SYSTEM_TYPE
);

1221 ià(
ho¡
 && *host)

1222 
rc
+ð
	`mysql_ÝtiÚsv
(
mysql
, 
MYSQL_OPT_CONNECT_ATTR_ADD
, "_£rv”_ho¡", 
ho¡
);

1224 #ifdeà
_WIN32


1225 
	`¢´štf
(
bufãr
, 255, "%lu", (
ulÚg
è
	`G‘Cu¼’tTh»adId
());

1226 
rc
+ð
	`mysql_ÝtiÚsv
(
mysql
, 
MYSQL_OPT_CONNECT_ATTR_ADD
, "_th»ad", 
bufãr
);

1227 
	`¢´štf
(
bufãr
, 255, "%lu", (
ulÚg
è
	`G‘Cu¼’tProûssId
());

1229 
	`¢´štf
(
bufãr
, 255, "%lu", (
ulÚg
è
	`g‘pid
());

1231 
rc
+ð
	`mysql_ÝtiÚsv
(
mysql
, 
MYSQL_OPT_CONNECT_ATTR_ADD
, "_pid", 
bufãr
);

1233 
rc
+ð
	`mysql_ÝtiÚsv
(
mysql
, 
MYSQL_OPT_CONNECT_ATTR_ADD
, "_¶©fÜm", 
MARIADB_MACHINE_TYPE
);

1234 (
	`‹¡
(
rc
>0));

1235 
	}
}

1242 
MYSQL
 * 
STDCALL


1243 
	$mysql_»®_cÚÃù
(
MYSQL
 *
mysql
, cÚ¡ *
ho¡
, cÚ¡ *
u£r
,

1244 cÚ¡ *
·sswd
, cÚ¡ *
db
,

1245 
ušt
 
pÜt
, cÚ¡ *
unix_sock‘
,
þ›Á_æag
)

1247 *
’d
ð
NULL
;

1248 *
cÚÃùiÚ_hªdËr
ð(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
) ?

1249 
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
cÚÃùiÚ_hªdËr
 : 0;

1251 ià(!
mysql
->
m‘hods
)

1252 
mysql
->
m‘hods
ð&
MARIADB_DEFAULT_METHODS
;

1254 ià(
cÚÃùiÚ_hªdËr
 ||

1255 (
ho¡
 && (
’d
ð
	`¡r¡r
(host, "://"))))

1257 
MARIADB_CONNECTION_PLUGIN
 *
¶ugš
;

1258 
¶ugš_Çme
[64];

1260 ià(!
cÚÃùiÚ_hªdËr
 || !connection_handler[0])

1262 
	`mem£t
(
¶ugš_Çme
, 0, 64);

1263 
	`ma_¡rmake
(
¶ugš_Çme
, 
ho¡
, 
	`MIN
(
’d
 - host, 63));

1264 
’d
+= 3;

1267 
	`ma_¡rmake
(
¶ugš_Çme
, 
cÚÃùiÚ_hªdËr
, 
	`MIN
(63, 
	`¡¾’
(connection_handler)));

1269 ià(!(
¶ugš
ð(
MARIADB_CONNECTION_PLUGIN
 *)
	`mysql_þ›Á_fšd_¶ugš
(
mysql
, 
¶ugš_Çme
, 
MARIADB_CLIENT_CONNECTION_PLUGIN
)))

1270  
NULL
;

1272 ià(!(
mysql
->
ex‹nsiÚ
->
cÚn_hdÌ
ð(
MA_CONNECTION_HANDLER
 *)
	`ÿÎoc
(1, (MA_CONNECTION_HANDLER))))

1274 
	`SET_CLIENT_ERROR
(
mysql
, 
CR_OUT_OF_MEMORY
, 
SQLSTATE_UNKNOWN
, 0);

1275  
NULL
;

1279 
	`OPT_SET_EXTENDED_VALUE_STR
(&
mysql
->
ÝtiÚs
, 
u¾
, 
ho¡
);

1281 
mysql
->
ex‹nsiÚ
->
cÚn_hdÌ
->
¶ugš
=…lugin;

1283 ià(
¶ugš
 &&…lugš->
cÚÃù
)

1285 
MYSQL
 *
my
ð
¶ugš
->
	`cÚÃù
(
mysql
, 
’d
, 
u£r
, 
·sswd
, 
db
, 
pÜt
, 
unix_sock‘
, 
þ›Á_æag
);

1286 ià(!
my
)

1288 
	`ä“
(
mysql
->
ex‹nsiÚ
->
cÚn_hdÌ
);

1289 
mysql
->
ex‹nsiÚ
->
cÚn_hdÌ
ð
NULL
;

1291  
my
;

1294 #iâdeà
HAVE_SCHANNEL


1295  
mysql
->
m‘hods
->
	`db_cÚÃù
(mysql, 
ho¡
, 
u£r
, 
·sswd
,

1296 
db
, 
pÜt
, 
unix_sock‘
, 
þ›Á_æag
);

1304 
	#MAX_SCHANNEL_CONNECT_ATTEMPTS
 3

	)

1306 
s¦_»Œy
ð(
mysql
->
ÝtiÚs
.
u£_s¦
è? 
MAX_SCHANNEL_CONNECT_ATTEMPTS
 : 1;

1307 
MYSQL
 *
my
ð
NULL
;

1308 
s¦_»Œy
)

1310 ià((
my
ð
mysql
->
m‘hods
->
	`db_cÚÃù
(mysql, 
ho¡
, 
u£r
, 
·sswd
,

1311 
db
, 
pÜt
, 
unix_sock‘
, 
þ›Á_æag
 | 
CLIENT_REMEMBER_OPTIONS
)))

1312  
my
;

1314 
mysql
->
Ãt
.
ex‹nsiÚ
->
ex‹nded_”ºo
) {

1315 
SEC_E_INVALID_TOKEN
:

1316 
SEC_E_BUFFER_TOO_SMALL
:

1317 
SEC_E_MESSAGE_ALTERED
:

1318 
s¦_»Œy
--;

1321 
s¦_»Œy
= 0;

1325 ià(!
my
 && !(
þ›Á_æag
 & 
CLIENT_REMEMBER_OPTIONS
))

1326 
	`mysql_þo£_ÝtiÚs
(
mysql
);

1327  
my
;

1330 
	}
}

1332 
MYSQL
 *
	$mthd_my_»®_cÚÃù
(
MYSQL
 *
mysql
, cÚ¡ *
ho¡
, cÚ¡ *
u£r
,

1333 cÚ¡ *
·sswd
, cÚ¡ *
db
,

1334 
ušt
 
pÜt
, cÚ¡ *
unix_sock‘
, 
þ›Á_æag
)

1336 
buff
[
NAME_LEN
+
USERNAME_LENGTH
+100];

1337 *
’d
, *
’d_pkt
, *
ho¡_šfo
;

1338 
MA_PVIO_CINFO
 
cšfo
ð{
NULL
, NULL, 0, -1, NULL};

1339 
MARIADB_PVIO
 *
pvio
ð
NULL
;

1340 *
süambË_d©a
;

1341 
my_boÞ
 
is_m¬Ÿ
= 0;

1342 cÚ¡ *
süambË_¶ugš
;

1343 
ušt
 
pkt_Ëngth
, 
süambË_Ën
, 
pkt_süambË_Ën
= 0;

1344 
NET
 *
Ãt
ð&
mysql
->net;

1346 ià(!
mysql
->
m‘hods
)

1347 
mysql
->
m‘hods
ð&
MARIADB_DEFAULT_METHODS
;

1349 ià(
Ãt
->
pvio
)

1351 
	`SET_CLIENT_ERROR
(
mysql
, 
CR_ALREADY_CONNECTED
, 
SQLSTATE_UNKNOWN
, 0);

1352 (
NULL
);

1356 ià(
mysql
->
ÝtiÚs
.
my_úf_fže
 || mysql->ÝtiÚs.
my_úf_group
)

1358 
	`_m¬Ÿdb_»ad_ÝtiÚs
(
mysql
, 
NULL
,

1359 (
mysql
->
ÝtiÚs
.
my_úf_fže
 ?

1360 
mysql
->
ÝtiÚs
.
my_úf_fže
 : 
NULL
),

1361 
mysql
->
ÝtiÚs
.
my_úf_group
, 0);

1362 
	`ä“
(
mysql
->
ÝtiÚs
.
my_úf_fže
);

1363 
	`ä“
(
mysql
->
ÝtiÚs
.
my_úf_group
);

1364 
mysql
->
ÝtiÚs
.
my_úf_fže
=mysql->ÝtiÚs.
my_úf_group
=0;

1367 ià(!
ho¡
 || !host[0])

1368 
ho¡
 = 
mysql
->
ÝtiÚs
.host;

1370 
	`ma_£t_cÚÃù_©Œs
(
mysql
, 
ho¡
);

1372 #iâdeà
WIN32


1373 ià(
mysql
->
ÝtiÚs
.
´ÙocÞ
 > 
MYSQL_PROTOCOL_SOCKET
)

1375 
	`SET_CLIENT_ERROR
(
mysql
, 
CR_CONN_UNKNOWN_PROTOCOL
, 
SQLSTATE_UNKNOWN
, 0);

1376 (
NULL
);

1381 ià(!
u£r
 || !user[0])

1382 
u£r
=
mysql
->
ÝtiÚs
.user;

1383 ià(!
·sswd
)

1385 
·sswd
=
mysql
->
ÝtiÚs
.
·sswÜd
;

1386 #iâdeà
DONT_USE_MYSQL_PWD


1387 ià(!
·sswd
)

1388 
·sswd
=
	`g‘’v
("MYSQL_PWD");

1389 ià(!
·sswd
)

1390 
·sswd
= "";

1393 ià(!
db
 || !db[0])

1394 
db
=
mysql
->
ÝtiÚs
.db;

1395 ià(!
pÜt
)

1396 
pÜt
=
mysql
->
ÝtiÚs
.port;

1397 ià(!
unix_sock‘
)

1398 
unix_sock‘
=
mysql
->
ÝtiÚs
.unix_socket;

1400 
mysql
->
£rv”_¡©us
=
SERVER_STATUS_AUTOCOMMIT
;

1403 
cšfo
.
ho¡
= host;

1404 
cšfo
.
unix_sock‘
= unix_socket;

1405 
cšfo
.
pÜt
=…ort;

1406 
cšfo
.
mysql
= mysql;

1411 #iâdeà
_WIN32


1412 #ià
	`defšed
(
HAVE_SYS_UN_H
)

1413 ià((!
ho¡
 || 
	`¡rcmp
(ho¡,
LOCAL_HOST
) == 0) &&

1414 
mysql
->
ÝtiÚs
.
´ÙocÞ
 !ð
MYSQL_PROTOCOL_TCP
 &&

1415 (
unix_sock‘
 || 
mysql_unix_pÜt
))

1417 
cšfo
.
ho¡
ð
LOCAL_HOST
;

1418 
cšfo
.
unix_sock‘
ð(unix_sock‘è? unix_sock‘ : 
mysql_unix_pÜt
;

1419 
cšfo
.
ty³
ð
PVIO_TYPE_UNIXSOCKET
;

1420 
	`¥rštf
(
ho¡_šfo
=
buff
,
	`ER
(
CR_LOCALHOST_CONNECTION
),
cšfo
.
ho¡
);

1425 ià(
mysql
->
ÝtiÚs
.
´ÙocÞ
 =ð
MYSQL_PROTOCOL_MEMORY
)

1427 
cšfo
.
ho¡
ð
mysql
->
ÝtiÚs
.
sh¬ed_memÜy_ba£_Çme
;

1428 
cšfo
.
ty³
ð
PVIO_TYPE_SHAREDMEM
;

1429 
	`¥rštf
(
ho¡_šfo
=
buff
,
	`ER
(
CR_SHARED_MEMORY_CONNECTION
), 
cšfo
.
ho¡
 ? cšfo.ho¡ : 
SHM_DEFAULT_NAME
);

1432 ià(
mysql
->
ÝtiÚs
.
´ÙocÞ
 =ð
MYSQL_PROTOCOL_PIPE
 ||

1433 (
ho¡
 && 
	`¡rcmp
(ho¡,
LOCAL_HOST_NAMEDPIPE
) == 0))

1435 
cšfo
.
ty³
ð
PVIO_TYPE_NAMEDPIPE
;

1436 
	`¥rštf
(
ho¡_šfo
=
buff
,
	`ER
(
CR_NAMEDPIPE_CONNECTION
),
cšfo
.
ho¡
);

1441 
cšfo
.
unix_sock‘
=0;

1442 ià(!
pÜt
)

1443 
pÜt
=
mysql_pÜt
;

1444 ià(!
ho¡
)

1445 
ho¡
=
LOCAL_HOST
;

1446 
cšfo
.
ho¡
= host;

1447 
cšfo
.
pÜt
=…ort;

1448 
cšfo
.
ty³
ð
PVIO_TYPE_SOCKET
;

1449 
	`¥rštf
(
ho¡_šfo
=
buff
,
	`ER
(
CR_TCP_CONNECTION
), 
cšfo
.
ho¡
);

1452 ià(!(
pvio
ð
	`ma_pvio_š™
(&
cšfo
)))

1453 
”rÜ
;

1456 ià(
	`ma_pvio_cÚÃù
(
pvio
, &
cšfo
) != 0)

1458 
	`ma_pvio_þo£
(
pvio
);

1459 
”rÜ
;

1462 ià(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
 && mysql->ÝtiÚs.ex‹nsiÚ->
´oxy_h—d”
)

1464 *
hdr
 = 
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
´oxy_h—d”
;

1465 
size_t
 
Ën
 = 
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
´oxy_h—d”_Ën
;

1466 ià(
	`ma_pvio_wr™e
(
pvio
, (*)
hdr
, 
Ën
) <= 0)

1468 
	`ma_pvio_þo£
(
pvio
);

1469 
”rÜ
;

1473 ià(
	`ma_Ãt_š™
(
Ãt
, 
pvio
))

1474 
”rÜ
;

1476 ià(
mysql
->
ÝtiÚs
.
max_®lowed_·ck‘
)

1477 
Ãt
->
max_·ck‘_size
ð
mysql
->
ÝtiÚs
.
max_®lowed_·ck‘
;

1479 
	`ma_pvio_k“·live
(
Ãt
->
pvio
);

1480 
	`¡rýy
(
mysql
->
Ãt
.
sql¡©e
, "00000");

1483 
mysql
->
´ÙocÞ_v”siÚ
ð
PROTOCOL_VERSION
;

1494 ià((
pkt_Ëngth
=
	`ma_Ãt_§ã_»ad
(
mysql
)è=ð
·ck‘_”rÜ
)

1496 ià(
mysql
->
Ãt
.
Ï¡_”ºo
 =ð
CR_SERVER_LOST
)

1497 
	`my_£t_”rÜ
(
mysql
, 
CR_SERVER_LOST
, 
SQLSTATE_UNKNOWN
,

1498 
	`ER
(
CR_SERVER_LOST_EXTENDED
),

1500 
”ºo
);

1502 
”rÜ
;

1504 
’d
ð(*)
Ãt
->
»ad_pos
;

1505 
’d_pkt
ð(*)
Ãt
->
»ad_pos
 + 
pkt_Ëngth
;

1509 
mysql
->
´ÙocÞ_v”siÚ
ð
’d
[0];

1510 
’d
++;

1513 ià(
mysql
->
´ÙocÞ_v”siÚ
 == 0XFF)

1515 
	`Ãt_g‘_”rÜ
(
’d
, 
pkt_Ëngth
 - 1, 
Ãt
->
Ï¡_”rÜ
, (net->last_error),

1516 &
Ãt
->
Ï¡_”ºo
,‚‘->
sql¡©e
);

1518 ià(
Ãt
->
Ï¡_”ºo
 == 1040)

1519 
	`memýy
(
Ãt
->
sql¡©e
, "08004", 
SQLSTATE_LENGTH
);

1520 
”rÜ
;

1523 ià(
mysql
->
´ÙocÞ_v”siÚ
 < 
PROTOCOL_VERSION
)

1525 
Ãt
->
Ï¡_”ºo
ð
CR_VERSION_ERROR
;

1526 
	`¥rštf
(
Ãt
->
Ï¡_”rÜ
, 
	`ER
(
CR_VERSION_ERROR
), 
mysql
->
´ÙocÞ_v”siÚ
,

1527 
PROTOCOL_VERSION
);

1528 
”rÜ
;

1531 ià(!
u£r
) user="";

1533 ià(!(
mysql
->
ho¡_šfo
ð
	`¡rdup
(host_info)) ||

1534 !(
mysql
->
ho¡
ð
	`¡rdup
(
cšfo
.host ? cinfo.host : "")) ||

1535 !(
mysql
->
u£r
=
	`¡rdup
(user)) ||

1536 !(
mysql
->
·sswd
=
	`¡rdup
(passwd)))

1538 
	`SET_CLIENT_ERROR
(
mysql
, 
CR_OUT_OF_MEMORY
, 
SQLSTATE_UNKNOWN
, 0);

1539 
”rÜ
;

1541 ià(
cšfo
.
unix_sock‘
)

1542 
mysql
->
unix_sock‘
ð
	`¡rdup
(
cšfo
.unix_socket);

1544 
mysql
->
unix_sock‘
=0;

1545 
mysql
->
pÜt
=port;

1546 
þ›Á_æag
|=
mysql
->
ÝtiÚs
.client_flag;

1548 ià(
	`¡ºcmp
(
’d
, 
MA_RPL_VERSION_HACK
, (MA_RPL_VERSION_HACK) - 1) == 0)

1550 
mysql
->
£rv”_v”siÚ
ð
	`¡rdup
(
’d
 + (
MA_RPL_VERSION_HACK
) - 1);

1551 
is_m¬Ÿ
= 1;

1555 ià(!(
mysql
->
£rv”_v”siÚ
ð
	`¡rdup
(
’d
)))

1557 
	`SET_CLIENT_ERROR
(
mysql
, 
CR_OUT_OF_MEMORY
, 
SQLSTATE_UNKNOWN
, 0);

1558 
”rÜ
;

1561 
’d
+ð
	`¡¾’
(end) + 1;

1563 
mysql
->
th»ad_id
=
	`ušt4kÜr
(
’d
);

1564 
’d
+=4;

1568 
süambË_d©a
ð
’d
;

1569 
süambË_Ën
ð
SCRAMBLE_LENGTH_323
 + 1;

1570 
süambË_¶ugš
ð
Þd_·sswÜd_¶ugš_Çme
;

1571 
’d
+ð
SCRAMBLE_LENGTH_323
;

1574 
’d
++;

1576 ià(
’d
 + 1<ð
’d_pkt
)

1578 
mysql
->
£rv”_ÿ·bž™›s
=
	`ušt2kÜr
(
’d
);

1582 ià(
’d
 + 18 <ð
’d_pkt
)

1584 
mysql
->
£rv”_Ïnguage
ð
	`ušt1kÜr
(
’d
 + 2);

1585 
mysql
->
£rv”_¡©us
ð
	`ušt2kÜr
(
’d
 + 3);

1586 
mysql
->
£rv”_ÿ·bž™›s
|ð()(
	`ušt2kÜr
(
’d
 + 5)) << 16;

1587 
pkt_süambË_Ën
ð
	`ušt1kÜr
(
’d
 + 7);

1590 ià(
is_m¬Ÿ
 && !(
mysql
->
£rv”_ÿ·bž™›s
 & 
CLIENT_MYSQL
))

1592 
mysql
->
ex‹nsiÚ
->
m¬Ÿdb_£rv”_ÿ·bž™›s
ð(
ulÚglÚg
è
	`ušt4kÜr
(
’d
 + 14);

1597 
’d
+= 18;

1600 ià(
’d
 + 
SCRAMBLE_LENGTH
 - 
SCRAMBLE_LENGTH_323
 + 1 <ð
’d_pkt
)

1602 
	`memýy
(
’d
 - 
SCRAMBLE_LENGTH_323
, 
süambË_d©a
, SCRAMBLE_LENGTH_323);

1603 
süambË_d©a
ð
’d
 - 
SCRAMBLE_LENGTH_323
;

1604 ià(
mysql
->
£rv”_ÿ·bž™›s
 & 
CLIENT_PLUGIN_AUTH
)

1606 
süambË_Ën
ð
pkt_süambË_Ën
;

1607 
süambË_¶ugš
ð
süambË_d©a
 + 
süambË_Ën
;

1608 ià(
süambË_d©a
 + 
süambË_Ën
 > 
’d_pkt
)

1610 
	`SET_CLIENT_ERROR
(
mysql
, 
CR_MALFORMED_PACKET
, 
SQLSTATE_UNKNOWN
, 0);

1611 
”rÜ
;

1615 
süambË_Ën
ð(
ušt
)(
’d_pkt
 - 
süambË_d©a
);

1616 
süambË_¶ugš
ð
Çtive_·sswÜd_¶ugš_Çme
;

1620 
mysql
->
£rv”_ÿ·bž™›s
&ð~
CLIENT_SECURE_CONNECTION
;

1621 ià(
mysql
->
ÝtiÚs
.
£cu»_auth
)

1623 
	`SET_CLIENT_ERROR
(
mysql
, 
CR_SECURE_AUTH
, 
SQLSTATE_UNKNOWN
, 0);

1624 
”rÜ
;

1629 ià(
mysql
->
ÝtiÚs
.
ch¬£t_Çme
)

1630 
mysql
->
ch¬£t
ð
	`mysql_fšd_ch¬£t_Çme
(mysql->
ÝtiÚs
.
ch¬£t_Çme
);

1632 
mysql
->
ch¬£t
=
	`mysql_fšd_ch¬£t_Çme
(
MARIADB_DEFAULT_CHARSET
);

1634 ià(!
mysql
->
ch¬£t
)

1636 
Ãt
->
Ï¡_”ºo
=
CR_CANT_READ_CHARSET
;

1637 
	`¥rštf
(
Ãt
->
Ï¡_”rÜ
,
	`ER
Ò‘->
Ï¡_”ºo
),

1638 
mysql
->
ÝtiÚs
.
ch¬£t_Çme
 ? mysql->options.charset_name :

1639 
MARIADB_DEFAULT_CHARSET
,

1641 
”rÜ
;

1644 
mysql
->
þ›Á_æag
= client_flag;

1645 
mysql
->
þ›Á_æag
|ð
CLIENT_SUPPORT_ORACLE_MODE
;

1646 
mysql
->
þ›Á_æag
|ðmysql->
ÝtiÚs
.client_flag;

1647 
mysql
->
þ›Á_æag
|ð
CLIENT_CAPABILITIES
;

1649 ià(
	`run_¶ugš_auth
(
mysql
, 
süambË_d©a
, 
süambË_Ën
,

1650 
süambË_¶ugš
, 
db
))

1651 
”rÜ
;

1653 ià(
mysql
->
þ›Á_æag
 & 
CLIENT_COMPRESS
)

1654 
Ãt
->
com´ess
= 1;

1657 ià(!(
mysql
->
£rv”_ÿ·bž™›s
 & 
CLIENT_CONNECT_WITH_DB
) &&

1658 (
db
 && !
mysql
->db))

1660 ià(
	`mysql_£Ëù_db
(
mysql
, 
db
))

1662 
	`my_£t_”rÜ
(
mysql
, 
CR_SERVER_LOST
, 
SQLSTATE_UNKNOWN
,

1663 
	`ER
(
CR_SERVER_LOST_EXTENDED
),

1665 
”ºo
);

1666 
”rÜ
;

1670 ià(
mysql
->
ÝtiÚs
.
š™_commªd
)

1672 **
begš
ð(**)
mysql
->
ÝtiÚs
.
š™_commªd
->
bufãr
;

1673 **
’d
ð
begš
 + 
mysql
->
ÝtiÚs
.
š™_commªd
->
–em’ts
;

1676 
my_boÞ
 
§ve_»cÚÃù
ð
mysql
->
ÝtiÚs
.
»cÚÃù
;

1677 
mysql
->
ÝtiÚs
.
»cÚÃù
= 0;

1679 ;
begš
 < 
’d
; begin++)

1681 ià(
	`mysql_»®_qu”y
(
mysql
, *
begš
, ()
	`¡¾’
(*begin)))

1682 
”rÜ
;

1686 
MYSQL_RES
 *
»s
;

1687 ià((
»s
ð
	`mysql_u£_»suÉ
(
mysql
)))

1688 
	`mysql_ä“_»suÉ
(
»s
);

1689 } !
	`mysql_Ãxt_»suÉ
(
mysql
));

1691 
mysql
->
ÝtiÚs
.
»cÚÃù
ð
§ve_»cÚÃù
;

1694 
	`¡rýy
(
mysql
->
Ãt
.
sql¡©e
, "00000");

1697 
	`ma_pvio_£t_timeout
(
mysql
->
Ãt
.
pvio
, 
PVIO_READ_TIMEOUT
, mysql->
ÝtiÚs
.
»ad_timeout
);

1698 
	`ma_pvio_£t_timeout
(
mysql
->
Ãt
.
pvio
, 
PVIO_WRITE_TIMEOUT
, mysql->
ÝtiÚs
.
wr™e_timeout
);

1699 (
mysql
);

1701 
”rÜ
:

1703 
	`’d_£rv”
(
mysql
);

1705 
	`mysql_þo£_memÜy
(
mysql
);

1706 ià(!(
þ›Á_æag
 & 
CLIENT_REMEMBER_OPTIONS
) &&

1707 !(
	`IS_MYSQL_ASYNC
(
mysql
)))

1708 
	`mysql_þo£_ÝtiÚs
(
mysql
);

1710 
	}
}

1712 
	smy_hook_d©a
 {

1713 
MYSQL
 *
	mÜig_mysql
;

1714 
MYSQL
 *
	mÃw_mysql
;

1716 
MARIADB_PVIO
 *
	mÜig_pvio
;

1723 
	$my_su¥’d_hook
(
my_boÞ
 
su¥’d
, *
d©a
)

1725 
my_hook_d©a
 *
hook_d©a
ð(my_hook_d©¨*)
d©a
;

1726 ià(
su¥’d
)

1728 
hook_d©a
->
Üig_pvio
ðhook_d©a->
Üig_mysql
->
Ãt
.
pvio
;

1729 
hook_d©a
->
Üig_mysql
->
Ãt
.
pvio
ðhook_d©a->
Ãw_mysql
->net.pvio;

1732 
hook_d©a
->
Üig_mysql
->
Ãt
.
pvio
ðhook_d©a->
Üig_pvio
;

1733 
	}
}

1735 
my_boÞ
 
STDCALL
 
	$m¬Ÿdb_»cÚÃù
(
MYSQL
 *
mysql
)

1737 
MYSQL
 
tmp_mysql
;

1738 
my_hook_d©a
 
hook_d©a
;

1739 
mysql_async_cÚ‹xt
 *
ùxt
ð
NULL
;

1740 
LIST
 *
li_¡mt
ð
mysql
->
¡mts
;

1743 ià(
	`IS_CONNHDLR_ACTIVE
(
mysql
))

1745 ià(
mysql
->
ex‹nsiÚ
->
cÚn_hdÌ
->
¶ugš
 && mysql->ex‹nsiÚ->cÚn_hdÌ->¶ugš->
»cÚÃù
)

1746 (
mysql
->
ex‹nsiÚ
->
cÚn_hdÌ
->
¶ugš
->
	`»cÚÃù
(mysql));

1749 ià(!
mysql
->
ÝtiÚs
.
»cÚÃù
 ||

1750 (
mysql
->
£rv”_¡©us
 & 
SERVER_STATUS_IN_TRANS
è|| !mysql->
ho¡_šfo
)

1753 
mysql
->
£rv”_¡©us
&ð~
SERVER_STATUS_IN_TRANS
;

1754 
	`my_£t_”rÜ
(
mysql
, 
CR_SERVER_GONE_ERROR
, 
SQLSTATE_UNKNOWN
, 0);

1758 
	`mysql_š™
(&
tmp_mysql
);

1759 
tmp_mysql
.
ä“_me
= 0;

1760 
tmp_mysql
.
ÝtiÚs
=
mysql
->options;

1761 ià(
mysql
->
ex‹nsiÚ
->
cÚn_hdÌ
)

1763 
tmp_mysql
.
ex‹nsiÚ
->
cÚn_hdÌ
ð
mysql
->extension->conn_hdlr;

1764 
mysql
->
ex‹nsiÚ
->
cÚn_hdÌ
= 0;

1768 
tmp_mysql
.
ÝtiÚs
.
my_úf_group
ðtmp_mysql.ÝtiÚs.
my_úf_fže
ð
NULL
;

1769 ià(
	`IS_MYSQL_ASYNC_ACTIVE
(
mysql
))

1771 
ùxt
ð
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
async_cÚ‹xt
;

1772 
hook_d©a
.
Üig_mysql
ð
mysql
;

1773 
hook_d©a
.
Ãw_mysql
ð&
tmp_mysql
;

1774 
hook_d©a
.
Üig_pvio
ð
mysql
->
Ãt
.
pvio
;

1775 
	`my_cÚ‹xt_š¡®l_su¥’d_»sume_hook
(
ùxt
, 
my_su¥’d_hook
, &
hook_d©a
);

1778 ià(!
	`mysql_»®_cÚÃù
(&
tmp_mysql
,
mysql
->
ho¡
,mysql->
u£r
,mysql->
·sswd
,

1779 
mysql
->
db
, mysql->
pÜt
, mysql->
unix_sock‘
,

1780 
mysql
->
þ›Á_æag
 | 
CLIENT_REMEMBER_OPTIONS
) ||

1781 
	`mysql_£t_ch¬aù”_£t
(&
tmp_mysql
, 
mysql
->
ch¬£t
->
c¢ame
))

1783 ià(
ùxt
)

1784 
	`my_cÚ‹xt_š¡®l_su¥’d_»sume_hook
(
ùxt
, 
NULL
, NULL);

1786 
	`mem£t
(&
tmp_mysql
.
ÝtiÚs
, 0, (
¡_mysql_ÝtiÚs
));

1787 
	`my_£t_”rÜ
(
mysql
, 
tmp_mysql
.
Ãt
.
Ï¡_”ºo
,

1788 
tmp_mysql
.
Ãt
.
sql¡©e
,

1789 
tmp_mysql
.
Ãt
.
Ï¡_”rÜ
);

1790 
	`mysql_þo£
(&
tmp_mysql
);

1794 ;
li_¡mt
;li_¡mtðli_¡mt->
Ãxt
)

1796 
MYSQL_STMT
 *
¡mt
ð(MYSQL_STMT *)
li_¡mt
->
d©a
;

1798 ià(
¡mt
->
¡©e
 !ð
MYSQL_STMT_INITTED
)

1800 
¡mt
->
¡©e
ð
MYSQL_STMT_INITTED
;

1801 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
CR_SERVER_LOST
, 
SQLSTATE_UNKNOWN
, 0);

1805 
tmp_mysql
.
ä“_me
ð
mysql
->free_me;

1806 
tmp_mysql
.
¡mts
ð
mysql
->stmts;

1807 
mysql
->
¡mts
ð
NULL
;

1809 ià(
ùxt
)

1810 
	`my_cÚ‹xt_š¡®l_su¥’d_»sume_hook
(
ùxt
, 
NULL
, NULL);

1812 
	`mem£t
(&
mysql
->
ÝtiÚs
, 0, (mysql->options));

1813 
mysql
->
ä“_me
=0;

1814 
	`mysql_þo£
(
mysql
);

1815 *
mysql
=
tmp_mysql
;

1816 
mysql
->
Ãt
.
pvio
->mysql= mysql;

1817 
	`ma_Ãt_þ—r
(&
mysql
->
Ãt
);

1818 
mysql
->
afãùed_rows
= ~() 0;

1819 
mysql
->
šfo
= 0;

1821 
	}
}

1823 
	$ma_šv®id©e_¡mts
(
MYSQL
 *
mysql
, cÚ¡ *
funùiÚ_Çme
)

1825 ià(
mysql
->
¡mts
)

1827 
LIST
 *
li_¡mt
ð
mysql
->
¡mts
;

1829 ; 
li_¡mt
;†i_¡mtðli_¡mt->
Ãxt
)

1831 
MYSQL_STMT
 *
¡mt
ð(MYSQL_STMT *)
li_¡mt
->
d©a
;

1832 
¡mt
->
mysql
ð
NULL
;

1833 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
CR_STMT_CLOSED
, 
SQLSTATE_UNKNOWN
, 
funùiÚ_Çme
);

1835 
mysql
->
¡mts
ð
NULL
;

1837 
	}
}

1844 
STDCALL


1845 
	$mysql_g‘_timeout_v®ue
(cÚ¡ 
MYSQL
 *
mysql
)

1847 
timeout
= 0;

1849 ià(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
 && mysql->ÝtiÚs.ex‹nsiÚ->
async_cÚ‹xt
)

1850 
timeout
ð
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
async_cÚ‹xt
->
timeout_v®ue
;

1852 ià(
timeout
 > 
UINT_MAX
 - 999)

1853  (
timeout
 - 1)/1000 + 1;

1855  (
timeout
+999)/1000;

1856 
	}
}

1859 
STDCALL


1860 
	$mysql_g‘_timeout_v®ue_ms
(cÚ¡ 
MYSQL
 *
mysql
)

1862 ià(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
 && mysql->ÝtiÚs.ex‹nsiÚ->
async_cÚ‹xt
)

1863  
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
async_cÚ‹xt
->
timeout_v®ue
;

1865 
	}
}

1871 
my_boÞ
 
STDCALL
 
	$mysql_chªge_u£r
(
MYSQL
 *
mysql
, cÚ¡ *
u£r
,

1872 cÚ¡ *
·sswd
, cÚ¡ *
db
)

1874 cÚ¡ 
MARIADB_CHARSET_INFO
 *
s_cs
ð
mysql
->
ch¬£t
;

1875 *
s_u£r
ð
mysql
->
u£r
,

1876 *
s_·sswd
ð
mysql
->
·sswd
,

1877 *
s_db
ð
mysql
->
db
;

1878 
rc
;

1880 ià(
mysql
->
ÝtiÚs
.
ch¬£t_Çme
)

1881 
mysql
->
ch¬£t
ð
	`mysql_fšd_ch¬£t_Çme
(mysql->
ÝtiÚs
.
ch¬£t_Çme
);

1883 
mysql
->
ch¬£t
=
	`mysql_fšd_ch¬£t_Çme
(
MARIADB_DEFAULT_CHARSET
);

1885 
mysql
->
u£r
ð
	`¡rdup
(user ? user : "");

1886 
mysql
->
·sswd
ð
	`¡rdup
(passwd ?…asswd : "");

1889 
mysql
->
db
= 0;

1890 
rc
ð
	`run_¶ugš_auth
(
mysql
, 0, 0, 0, 
db
);

1893 
	`ma_šv®id©e_¡mts
(
mysql
, "mysql_change_user()");

1895 ià(
rc
==0)

1897 
	`ä“
(
s_u£r
);

1898 
	`ä“
(
s_·sswd
);

1899 
	`ä“
(
s_db
);

1901 ià(!
mysql
->
db
 && db && !(mysql->dbð
	`¡rdup
(db)))

1903 
	`SET_CLIENT_ERROR
(
mysql
, 
CR_OUT_OF_MEMORY
, 
SQLSTATE_UNKNOWN
, 0);

1904 
rc
= 1;

1908 
	`ä“
(
mysql
->
u£r
);

1909 
	`ä“
(
mysql
->
·sswd
);

1910 
	`ä“
(
mysql
->
db
);

1912 
mysql
->
u£r
ð
s_u£r
;

1913 
mysql
->
·sswd
ð
s_·sswd
;

1914 
mysql
->
db
ð
s_db
;

1915 
mysql
->
ch¬£t
ð
s_cs
;

1917 (
rc
);

1918 
	}
}

1925 
STDCALL


1926 
	$mysql_£Ëù_db
(
MYSQL
 *
mysql
, cÚ¡ *
db
)

1928 
”rÜ
;

1930 ià(!
db
)

1933 ià((
”rÜ
=
	`ma_sim¶e_commªd
(
mysql
, 
COM_INIT_DB
, 
db
,

1934 (
ušt
è
	`¡¾’
(
db
),0,0)))

1935 (
”rÜ
);

1936 
	`ä“
(
mysql
->
db
);

1937 
mysql
->
db
=
	`¡rdup
(db);

1939 
	}
}

1947 
	$mysql_þo£_ÝtiÚs
(
MYSQL
 *
mysql
)

1949 ià(
mysql
->
ÝtiÚs
.
š™_commªd
)

1951 **
begš
ð(**)
mysql
->
ÝtiÚs
.
š™_commªd
->
bufãr
;

1952 **
’d
ð
begš
 + 
mysql
->
ÝtiÚs
.
š™_commªd
->
–em’ts
;

1954 ;
begš
 < 
’d
; begin++)

1955 
	`ä“
(*
begš
);

1956 
	`ma_d–‘e_dyÇmic
(
mysql
->
ÝtiÚs
.
š™_commªd
);

1957 
	`ä“
(
mysql
->
ÝtiÚs
.
š™_commªd
);

1959 
	`ä“
(
mysql
->
ÝtiÚs
.
u£r
);

1960 
	`ä“
(
mysql
->
ÝtiÚs
.
ho¡
);

1961 
	`ä“
(
mysql
->
ÝtiÚs
.
·sswÜd
);

1962 
	`ä“
(
mysql
->
ÝtiÚs
.
unix_sock‘
);

1963 
	`ä“
(
mysql
->
ÝtiÚs
.
db
);

1964 
	`ä“
(
mysql
->
ÝtiÚs
.
my_úf_fže
);

1965 
	`ä“
(
mysql
->
ÝtiÚs
.
my_úf_group
);

1966 
	`ä“
(
mysql
->
ÝtiÚs
.
ch¬£t_dœ
);

1967 
	`ä“
(
mysql
->
ÝtiÚs
.
ch¬£t_Çme
);

1968 
	`ä“
(
mysql
->
ÝtiÚs
.
bšd_add»ss
);

1969 
	`ä“
(
mysql
->
ÝtiÚs
.
s¦_key
);

1970 
	`ä“
(
mysql
->
ÝtiÚs
.
s¦_û¹
);

1971 
	`ä“
(
mysql
->
ÝtiÚs
.
s¦_ÿ
);

1972 
	`ä“
(
mysql
->
ÝtiÚs
.
s¦_ÿ·th
);

1973 
	`ä“
(
mysql
->
ÝtiÚs
.
s¦_ch”
);

1975 ià(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
)

1977 
mysql_async_cÚ‹xt
 *
ùxt
;

1978 ià((
ùxt
 = 
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
async_cÚ‹xt
))

1980 
	`my_cÚ‹xt_de¡roy
(&
ùxt
->
async_cÚ‹xt
);

1981 
	`ä“
(
ùxt
);

1982 
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
async_cÚ‹xt
= 0;

1984 
	`ä“
(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
¶ugš_dœ
);

1985 
	`ä“
(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
deçuÉ_auth
);

1986 
	`ä“
(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
db_driv”
);

1987 
	`ä“
(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
s¦_ül
);

1988 
	`ä“
(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
s¦_üÍ©h
);

1989 
	`ä“
(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
Žs_å
);

1990 
	`ä“
(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
Žs_å_li¡
);

1991 
	`ä“
(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
Žs_pw
);

1992 
	`ä“
(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
Žs_v”siÚ
);

1993 
	`ä“
(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
u¾
);

1994 
	`ä“
(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
cÚÃùiÚ_hªdËr
);

1995 if(
	`hash_š™ed
(&
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
cÚÃù_©Œs
))

1996 
	`hash_ä“
(&
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
cÚÃù_©Œs
);

1997 ià(
	`hash_š™ed
(&
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
u£rd©a
))

1998 
	`hash_ä“
(&
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
u£rd©a
);

2001 
	`ä“
(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
);

2003 
	`mem£t
(&
mysql
->
ÝtiÚs
, 0, (mysql->options));

2004 
	}
}

2006 
	$mysql_þo£_memÜy
(
MYSQL
 *
mysql
)

2008 
	`ma_þ—r_£ssiÚ_¡©e
(
mysql
);

2009 
	`ä“
(
mysql
->
ho¡_šfo
);

2010 
	`ä“
(
mysql
->
ho¡
);

2011 
	`ä“
(
mysql
->
u£r
);

2012 
	`ä“
(
mysql
->
·sswd
);

2013 
	`ä“
(
mysql
->
db
);

2014 
	`ä“
(
mysql
->
unix_sock‘
);

2015 
	`ä“
(
mysql
->
£rv”_v”siÚ
);

2016 
mysql
->
ho¡_šfo
ðmysql->
ho¡
ðmysql->
unix_sock‘
=

2017 
mysql
->
£rv”_v”siÚ
=mysql->
u£r
=mysql->
·sswd
=mysql->
db
=0;

2018 
	}
}

2020 
	$my_£t_”rÜ
(
MYSQL
 *
mysql
,

2021 
”rÜ_Ä
,

2022 cÚ¡ *
sql¡©e
,

2023 cÚ¡ *
fÜm©
,

2026 
va_li¡
 
­
;

2028 cÚ¡ *
”rmsg
;

2030 ià(!
fÜm©
)

2032 ià(
”rÜ_Ä
 >ð
CR_MIN_ERROR
 &&ƒ¼Ü_Ä <ð
CR_MYSQL_LAST_ERROR
)

2033 
”rmsg
ð
	`ER
(
”rÜ_Ä
);

2034 ià(
”rÜ_Ä
 >ð
CER_MIN_ERROR
 &&ƒ¼Ü_Ä <ð
CR_MARIADB_LAST_ERROR
)

2035 
”rmsg
ð
	`CER
(
”rÜ_Ä
);

2037 
”rmsg
ð
	`ER
(
CR_UNKNOWN_ERROR
);

2040 
mysql
->
Ãt
.
Ï¡_”ºo
ð
”rÜ_Ä
;

2041 
	`ma_¡rmake
(
mysql
->
Ãt
.
sql¡©e
, sql¡©e, 
SQLSTATE_LENGTH
);

2042 
	`va_¡¬t
(
­
, 
fÜm©
);

2043 
	`v¢´štf
(
mysql
->
Ãt
.
Ï¡_”rÜ
, 
MYSQL_ERRMSG_SIZE
 - 1,

2044 
fÜm©
 ? fÜm© : 
”rmsg
, 
­
);

2045 
	`va_’d
(
­
);

2047 
	}
}

2049 
	$mysql_þo£_¦ow_·¹
(
MYSQL
 *
mysql
)

2051 ià(
mysql
->
Ãt
.
pvio
)

2053 
	`ä“_Þd_qu”y
(
mysql
);

2054 
mysql
->
¡©us
=
MYSQL_STATUS_READY
;

2055 
mysql
->
ÝtiÚs
.
»cÚÃù
=0;

2056 ià(
mysql
->
Ãt
.
pvio
 && mysql->Ãt.
buff
)

2057 
	`ma_sim¶e_commªd
(
mysql
, 
COM_QUIT
,
NuÎS
,0,1,0);

2058 
	`’d_£rv”
(
mysql
);

2060 
	}
}

2062 
	$ma_þ—r_£ssiÚ_¡©e
(
MYSQL
 *
mysql
)

2064 
ušt
 
i
;

2066 ià(!
mysql
 || !mysql->
ex‹nsiÚ
)

2069 
i
ð
SESSION_TRACK_BEGIN
; i <ð
SESSION_TRACK_END
; i++)

2071 
	`li¡_ä“
(
mysql
->
ex‹nsiÚ
->
£ssiÚ_¡©e
[
i
].
li¡
, 0);

2073 
	`mem£t
(
mysql
->
ex‹nsiÚ
->
£ssiÚ_¡©e
, 0, (
¡_m¬Ÿdb_£ssiÚ_¡©e
è* 
SESSION_TRACK_TYPES
);

2074 
	}
}

2076 
STDCALL


2077 
	$mysql_þo£
(
MYSQL
 *
mysql
)

2079 ià(
mysql
)

2081 ià(
mysql
->
ex‹nsiÚ
 && mysql->ex‹nsiÚ->
cÚn_hdÌ
)

2083 
MA_CONNECTION_HANDLER
 *
p
ð
mysql
->
ex‹nsiÚ
->
cÚn_hdÌ
;

2084 ià(
p
->
¶ugš
->
þo£
)

2085 
p
->
¶ugš
->
	`þo£
(
mysql
);

2086 
	`ä“
(
p
);

2090 
mysql
->
ex‹nsiÚ
->
cÚn_hdÌ
ð
NULL
;

2093 ià(
mysql
->
m‘hods
)

2094 
mysql
->
m‘hods
->
	`db_þo£
(mysql);

2097 
	`ma_šv®id©e_¡mts
(
mysql
, "mysql_close()");

2099 
	`mysql_þo£_memÜy
(
mysql
);

2100 
	`mysql_þo£_ÝtiÚs
(
mysql
);

2101 
	`ma_þ—r_£ssiÚ_¡©e
(
mysql
);

2103 ià(
mysql
->
Ãt
.
ex‹nsiÚ
)

2104 
	`ä“
(
mysql
->
Ãt
.
ex‹nsiÚ
);

2106 
mysql
->
ho¡_šfo
=mysql->
u£r
=mysql->
·sswd
=mysql->
db
=0;

2109 
	`mem£t
((*è&
mysql
->
ÝtiÚs
, 0, (mysql->options));

2111 ià(
mysql
->
ex‹nsiÚ
)

2112 
	`ä“
(
mysql
->
ex‹nsiÚ
);

2115 
mysql
->
Ãt
.
ex‹nsiÚ
 = 
NULL
;

2116 
mysql
->
ex‹nsiÚ
 = 
NULL
;

2118 
mysql
->
Ãt
.
pvio
= 0;

2119 ià(
mysql
->
ä“_me
)

2120 
	`ä“
(
mysql
);

2123 
	}
}

2131 
STDCALL


2132 
	$mysql_qu”y
(
MYSQL
 *
mysql
, cÚ¡ *
qu”y
)

2134  
	`mysql_»®_qu”y
(
mysql
,
qu”y
, (è
	`¡¾’
(query));

2135 
	}
}

2143 
STDCALL


2144 
	$mysql_£nd_qu”y
(
MYSQL
* 
mysql
, cÚ¡ * 
qu”y
, 
Ëngth
)

2146  
	`ma_sim¶e_commªd
(
mysql
, 
COM_QUERY
, 
qu”y
, 
Ëngth
, 1,0);

2147 
	}
}

2149 
	$ma_»ad_ok_·ck‘
(
MYSQL
 *
mysql
, 
uch¬
 *
pos
, 
ulÚg
 
Ëngth
)

2151 
uch¬
 *
’d
ð
mysql
->
Ãt
.
»ad_pos
+
Ëngth
;

2152 
size_t
 
™em_Ën
;

2153 
mysql
->
afãùed_rows
ð
	`Ãt_f›ld_Ëngth_Î
(&
pos
);

2154 
mysql
->
š£¹_id
ð
	`Ãt_f›ld_Ëngth_Î
(&
pos
);

2155 
mysql
->
£rv”_¡©us
=
	`ušt2kÜr
(
pos
);

2156 ià(
mysql
->
£rv”_¡©us
 & 
SERVER_ORACLE_MODE
) {

2157 
mysql
->
Üaþe_mode
 = 
TRUE
;

2159 
pos
+=2;

2160 
mysql
->
w¬nšg_couÁ
=
	`ušt2kÜr
(
pos
);

2161 
pos
+=2;

2162 ià(
pos
 > 
’d
)

2163 
cÜru±ed
;

2164 ià(
pos
 < 
’d
)

2166 ià((
™em_Ën
ð
	`Ãt_f›ld_Ëngth
(&
pos
)))

2167 
mysql
->
šfo
=(*è
pos
;

2168 ià(
pos
 + 
™em_Ën
 > 
’d
)

2169 
cÜru±ed
;

2172 ià(
mysql
->
£rv”_ÿ·bž™›s
 & 
CLIENT_SESSION_TRACKING
)

2174 
	`ma_þ—r_£ssiÚ_¡©e
(
mysql
);

2175 
pos
+ð
™em_Ën
;

2177 ià(
mysql
->
£rv”_¡©us
 & 
SERVER_SESSION_STATE_CHANGED
)

2179 
i
;

2180 ià(
pos
 < 
’d
)

2182 
LIST
 *
£ssiÚ_™em
;

2183 
MYSQL_LEX_STRING
 *
¡r
ð
NULL
;

2184 
’um_£ssiÚ_¡©e_ty³
 
si_ty³
;

2185 
uch¬
 *
Þd_pos
ð
pos
;

2187 
™em_Ën
ð
	`Ãt_f›ld_Ëngth
(&
pos
);

2188 ià(
pos
 + 
™em_Ën
 > 
’d
)

2189 
cÜru±ed
;

2190 
’d
ð
pos
 + 
™em_Ën
;

2193 ià(
mysql
->
šfo
)

2194 *
Þd_pos
= 0;

2196 
pos
 < 
’d
)

2198 
size_t
 
¶’
;

2199 *
d©a
;

2200 
si_ty³
ð(
’um_£ssiÚ_¡©e_ty³
)
	`Ãt_f›ld_Ëngth
(&
pos
);

2202 
si_ty³
) {

2203 
SESSION_TRACK_SCHEMA
:

2204 
SESSION_TRACK_STATE_CHANGE
:

2205 
SESSION_TRACK_TRANSACTION_CHARACTERISTICS
:

2206 
SESSION_TRACK_SYSTEM_VARIABLES
:

2207 
SESSION_TRACK_TRANSACTION_STATE
:

2208 
SESSION_TRACK_GTIDS
:

2209 ià(
si_ty³
 !ð
SESSION_TRACK_STATE_CHANGE
)

2211 
	`Ãt_f›ld_Ëngth
(&
pos
);

2213 ià(
si_ty³
 =ð
SESSION_TRACK_GTIDS
)

2216 
	`Ãt_f›ld_Ëngth
(&
pos
);

2218 
¶’
ð
	`Ãt_f›ld_Ëngth
(&
pos
);

2219 ià(
pos
 + 
¶’
 > 
’d
)

2220 
cÜru±ed
;

2221 ià(!(
£ssiÚ_™em
ð
	`ma_muÉi_m®loc
(0,

2222 &
£ssiÚ_™em
, (
LIST
),

2223 &
¡r
, (
MYSQL_LEX_STRING
),

2224 &
d©a
, 
¶’
,

2225 
NULL
)))

2226 
oom
;

2227 
¡r
->
Ëngth
ð
¶’
;

2228 
¡r
->¡rð
d©a
;

2229 
	`memýy
(
¡r
->¡r, (*)
pos
, 
¶’
);

2230 
pos
+ð
¶’
;

2231 
£ssiÚ_™em
->
d©a
ð
¡r
;

2232 
mysql
->
ex‹nsiÚ
->
£ssiÚ_¡©e
[
si_ty³
].
li¡
ð
	`li¡_add
(mysql->ex‹nsiÚ->£ssiÚ_¡©e[si_ty³].li¡, 
£ssiÚ_™em
);

2235 ià(
si_ty³
 =ð
SESSION_TRACK_SCHEMA
)

2237 
	`ä“
(
mysql
->
db
);

2238 
mysql
->
db
ð
	`m®loc
(
¶’
 + 1);

2239 
	`memýy
(
mysql
->
db
, 
¡r
->¡r, 
¶’
);

2240 
mysql
->
db
[
¶’
]= 0;

2242 ià(
si_ty³
 =ð
SESSION_TRACK_SYSTEM_VARIABLES
)

2244 
my_boÞ
 
£t_ch¬£t
= 0;

2246 ià(!
	`¡ºcmp
(
¡r
->¡r, "ch¬aù”_£t_þ›Á", sŒ->
Ëngth
))

2247 
£t_ch¬£t
= 1;

2248 
¶’
ð
	`Ãt_f›ld_Ëngth
(&
pos
);

2249 ià(
pos
 + 
¶’
 > 
’d
)

2250 
cÜru±ed
;

2251 ià(!(
£ssiÚ_™em
ð
	`ma_muÉi_m®loc
(0,

2252 &
£ssiÚ_™em
, (
LIST
),

2253 &
¡r
, (
MYSQL_LEX_STRING
),

2254 &
d©a
, 
¶’
,

2255 
NULL
)))

2256 
oom
;

2257 
¡r
->
Ëngth
ð
¶’
;

2258 
¡r
->¡rð
d©a
;

2259 
	`memýy
(
¡r
->¡r, (*)
pos
, 
¶’
);

2260 
pos
+ð
¶’
;

2261 
£ssiÚ_™em
->
d©a
ð
¡r
;

2262 
mysql
->
ex‹nsiÚ
->
£ssiÚ_¡©e
[
si_ty³
].
li¡
ð
	`li¡_add
(mysql->ex‹nsiÚ->£ssiÚ_¡©e[si_ty³].li¡, 
£ssiÚ_™em
);

2263 ià(
£t_ch¬£t
 && 
¡r
->
Ëngth
 < 
CHARSET_NAME_LEN
 &&

2264 
	`¡ºcmp
(
mysql
->
ch¬£t
->
c¢ame
, 
¡r
->¡r, sŒ->
Ëngth
) != 0)

2266 
cs_Çme
[
CHARSET_NAME_LEN
];

2267 cÚ¡ 
MARIADB_CHARSET_INFO
 *
cs_šfo
;

2268 
	`memýy
(
cs_Çme
, 
¡r
->¡r, sŒ->
Ëngth
);

2269 
cs_Çme
[
¡r
->
Ëngth
]= 0;

2270 ià((
cs_šfo
 = 
	`mysql_fšd_ch¬£t_Çme
(
cs_Çme
)))

2271 
mysql
->
ch¬£t
ð
cs_šfo
;

2277 
¶’
ð
	`Ãt_f›ld_Ëngth
(&
pos
);

2278 ià(
pos
 + 
¶’
 > 
’d
)

2279 
cÜru±ed
;

2280 
pos
+ð
¶’
;

2285 
i
ð
SESSION_TRACK_BEGIN
; i <ð
SESSION_TRACK_END
; i++)

2287 
mysql
->
ex‹nsiÚ
->
£ssiÚ_¡©e
[
i
].
li¡
ð
	`li¡_»v”£
(mysql->extension->session_state[i].list);

2288 
mysql
->
ex‹nsiÚ
->
£ssiÚ_¡©e
[
i
].
cu¼’t
ðmysql->ex‹nsiÚ->£ssiÚ_¡©e[i].
li¡
;

2294 ià(
mysql
->
£rv”_ÿ·bž™›s
 & 
CLIENT_SESSION_TRACKING
)

2295 
	`ma_þ—r_£ssiÚ_¡©e
(
mysql
);

2298 
oom
:

2299 
	`ma_þ—r_£ssiÚ_¡©e
(
mysql
);

2300 
	`SET_CLIENT_ERROR
(
mysql
, 
CR_OUT_OF_MEMORY
, 
SQLSTATE_UNKNOWN
, 0);

2303 
cÜru±ed
:

2304 
	`ma_þ—r_£ssiÚ_¡©e
(
mysql
);

2305 
	`SET_CLIENT_ERROR
(
mysql
, 
CR_MALFORMED_PACKET
, 
SQLSTATE_UNKNOWN
, 0);

2307 
	}
}

2309 
	$mthd_my_»ad_qu”y_»suÉ
(
MYSQL
 *
mysql
)

2311 
uch¬
 *
pos
;

2312 
ulÚg
 
f›ld_couÁ
;

2313 
MYSQL_DATA
 *
f›lds
;

2314 
ulÚg
 
Ëngth
;

2315 
my_boÞ
 
ÿn_loÿl_šfže
ð(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
è&& (mysql->ex‹nsiÚ->
auto_loÿl_šfže
 !ð
WAIT_FOR_QUERY
);

2317 ià(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
 && mysql->ex‹nsiÚ->
auto_loÿl_šfže
 =ð
ACCEPT_FILE_REQUEST
)

2318 
mysql
->
ex‹nsiÚ
->
auto_loÿl_šfže
ð
WAIT_FOR_QUERY
;

2320 ià((
Ëngth
 = 
	`ma_Ãt_§ã_»ad
(
mysql
)è=ð
·ck‘_”rÜ
)

2324 
	`ä“_Þd_qu”y
(
mysql
);

2325 
g‘_šfo
:

2326 
pos
=(
uch¬
*è
mysql
->
Ãt
.
»ad_pos
;

2327 ià((
f›ld_couÁ
ð
	`Ãt_f›ld_Ëngth
(&
pos
)) == 0)

2328  
	`ma_»ad_ok_·ck‘
(
mysql
, 
pos
, 
Ëngth
);

2329 ià(
f›ld_couÁ
 =ð
NULL_LENGTH
)

2331 
”rÜ
=
	`mysql_hªdË_loÿl_šfže
(
mysql
, (*)
pos
, 
ÿn_loÿl_šfže
);

2333 ià((
Ëngth
=
	`ma_Ãt_§ã_»ad
(
mysql
)è=ð
·ck‘_”rÜ
 || 
”rÜ
)

2335 
g‘_šfo
;

2337 ià(!(
mysql
->
£rv”_¡©us
 & 
SERVER_STATUS_AUTOCOMMIT
))

2338 
mysql
->
£rv”_¡©us
|ð
SERVER_STATUS_IN_TRANS
;

2340 
mysql
->
exŒa_šfo
ð
	`Ãt_f›ld_Ëngth_Î
(&
pos
);

2341 ià(!(
f›lds
=
mysql
->
m‘hods
->
	`db_»ad_rows
(mysql,(
MYSQL_FIELD
*) 0,

2342 
	`ma_»suÉ_£t_rows
(
mysql
))))

2344 ià(!(
mysql
->
f›lds
=
	`uÅack_f›lds
(mysql, f›lds, &mysql->
f›ld_®loc
,

2345 (
ušt
è
f›ld_couÁ
, 1)))

2347 
mysql
->
¡©us
=
MYSQL_STATUS_GET_RESULT
;

2348 
mysql
->
f›ld_couÁ
=field_count;

2350 
	}
}

2352 
STDCALL
 
	$mysql_£ssiÚ_Œack_g‘_Ãxt
(
MYSQL
 *
mysql
, 
’um_£ssiÚ_¡©e_ty³
 
ty³
,

2353 cÚ¡ **
d©a
, 
size_t
 *
Ëngth
)

2355 
MYSQL_LEX_STRING
 *
¡r
;

2356 ià(!
mysql
->
ex‹nsiÚ
->
£ssiÚ_¡©e
[
ty³
].
cu¼’t
)

2359 
¡r
ð(
MYSQL_LEX_STRING
 *)
mysql
->
ex‹nsiÚ
->
£ssiÚ_¡©e
[
ty³
].
cu¼’t
->
d©a
;

2360 
mysql
->
ex‹nsiÚ
->
£ssiÚ_¡©e
[
ty³
].
cu¼’t
ðmysql->ex‹nsiÚ->£ssiÚ_¡©e[ty³].cu¼’t->
Ãxt
;

2362 *
d©a
ð
¡r
->¡¸? sŒ->¡¸: 
NULL
;

2363 *
Ëngth
ð
¡r
->str ? str->length : 0;

2365 
	}
}

2367 
STDCALL
 
	$mysql_£ssiÚ_Œack_g‘_fœ¡
(
MYSQL
 *
mysql
, 
’um_£ssiÚ_¡©e_ty³
 
ty³
,

2368 cÚ¡ **
d©a
, 
size_t
 *
Ëngth
)

2370 
mysql
->
ex‹nsiÚ
->
£ssiÚ_¡©e
[
ty³
].
cu¼’t
ðmysql->ex‹nsiÚ->£ssiÚ_¡©e[ty³].
li¡
;

2371  
	`mysql_£ssiÚ_Œack_g‘_Ãxt
(
mysql
, 
ty³
, 
d©a
, 
Ëngth
);

2372 
	}
}

2374 
my_boÞ
 
STDCALL


2375 
	$mysql_»ad_qu”y_»suÉ
(
MYSQL
 *
mysql
)

2377  
	`‹¡
(
mysql
->
m‘hods
->
	`db_»ad_qu”y_»suÉ
(mysql)) ? 1 : 0;

2378 
	}
}

2380 
STDCALL


2381 
	$mysql_»®_qu”y
(
MYSQL
 *
mysql
, cÚ¡ *
qu”y
, 
Ëngth
)

2383 
my_boÞ
 
sk_»suÉ
ð
	`OPT_EXT_VAL
(
mysql
, 
muÉi_commªd
);

2385 ià(
Ëngth
 == ()-1)

2386 
Ëngth
ð()
	`¡¾’
(
qu”y
);

2388 
	`ä“_Þd_qu”y
(
mysql
);

2390 ià(
	`ma_sim¶e_commªd
(
mysql
, 
COM_QUERY
,
qu”y
,
Ëngth
,1,0))

2392 ià(!
sk_»suÉ
)

2393 (
mysql
->
m‘hods
->
	`db_»ad_qu”y_»suÉ
(mysql));

2395 
	}
}

2402 
MYSQL_RES
 * 
STDCALL


2403 
	$mysql_¡Üe_»suÉ
(
MYSQL
 *
mysql
)

2405 
MYSQL_RES
 *
»suÉ
;

2407 ià(!
mysql
->
f›lds
)

2409 ià(
mysql
->
¡©us
 !ð
MYSQL_STATUS_GET_RESULT
)

2411 
	`SET_CLIENT_ERROR
(
mysql
, 
CR_COMMANDS_OUT_OF_SYNC
, 
SQLSTATE_UNKNOWN
, 0);

2414 
mysql
->
¡©us
=
MYSQL_STATUS_READY
;

2415 ià(!(
»suÉ
=(
MYSQL_RES
*è
	`ÿÎoc
(1, (MYSQL_RES)+

2416 (
ulÚg
)*
mysql
->
f›ld_couÁ
)))

2418 
	`SET_CLIENT_ERROR
(
mysql
, 
CR_OUT_OF_MEMORY
, 
SQLSTATE_UNKNOWN
, 0);

2421 
»suÉ
->
eof
=1;

2422 
»suÉ
->
Ëngths
=(
ulÚg
*) (result+1);

2423 ià(!(
»suÉ
->
d©a
=
mysql
->
m‘hods
->
	`db_»ad_rows
(mysql,mysql->
f›lds
,mysql->
f›ld_couÁ
)))

2425 
	`ä“
(
»suÉ
);

2428 
mysql
->
afãùed_rows
ð
»suÉ
->
row_couÁ
ð»suÉ->
d©a
->
rows
;

2429 
»suÉ
->
d©a_cursÜ
ð»suÉ->
d©a
->data;

2430 
»suÉ
->
f›lds
ð
mysql
->fields;

2431 
»suÉ
->
f›ld_®loc
ð
mysql
->field_alloc;

2432 
»suÉ
->
f›ld_couÁ
ð
mysql
->field_count;

2433 
»suÉ
->
cu¼’t_f›ld
=0;

2434 
»suÉ
->
cu¼’t_row
=0;

2435 
mysql
->
f›lds
=0;

2436 (
»suÉ
);

2437 
	}
}

2450 
MYSQL_RES
 * 
STDCALL


2451 
	$mysql_u£_»suÉ
(
MYSQL
 *
mysql
)

2453 
MYSQL_RES
 *
»suÉ
;

2455 ià(!
mysql
->
f›lds
)

2457 ià(
mysql
->
¡©us
 !ð
MYSQL_STATUS_GET_RESULT
)

2459 
	`SET_CLIENT_ERROR
(
mysql
, 
CR_COMMANDS_OUT_OF_SYNC
, 
SQLSTATE_UNKNOWN
, 0);

2462 ià(!(
»suÉ
=(
MYSQL_RES
*è
	`ÿÎoc
(1, (*result)+

2463 (
ulÚg
)*
mysql
->
f›ld_couÁ
)))

2465 
»suÉ
->
Ëngths
=(
ulÚg
*) (result+1);

2466 ià(!(
»suÉ
->
row
=(
MYSQL_ROW
)

2467 
	`m®loc
((
»suÉ
->
row
[0])*(
mysql
->
f›ld_couÁ
+1))))

2469 
	`ä“
(
»suÉ
);

2472 
»suÉ
->
f›lds
ð
mysql
->fields;

2473 
»suÉ
->
f›ld_®loc
ð
mysql
->field_alloc;

2474 
»suÉ
->
f›ld_couÁ
ð
mysql
->field_count;

2475 
»suÉ
->
cu¼’t_f›ld
=0;

2476 
»suÉ
->
hªdË
ð
mysql
;

2477 
»suÉ
->
cu¼’t_row
= 0;

2478 
mysql
->
f›lds
=0;

2479 
mysql
->
¡©us
=
MYSQL_STATUS_USE_RESULT
;

2480 (
»suÉ
);

2481 
	}
}

2486 
MYSQL_FIELD
 * 
STDCALL


2487 
	$mysql_ãtch_f›ld
(
MYSQL_RES
 *
»suÉ
)

2489 ià(
»suÉ
->
cu¼’t_f›ld
 >ð»suÉ->
f›ld_couÁ
)

2490 (
NULL
);

2491  &
»suÉ
->
f›lds
[»suÉ->
cu¼’t_f›ld
++];

2492 
	}
}

2498 
STDCALL


2499 
	$m¬Ÿdb_f›ld_©Œ
(
MARIADB_CONST_STRING
 *
©Œ
,

2500 cÚ¡ 
MYSQL_FIELD
 *
f›ld
,

2501 
m¬Ÿdb_f›ld_©Œ_t
 
ty³
)

2503 
MA_FIELD_EXTENSION
 *
ext
ð(MA_FIELD_EXTENSION*è
f›ld
->
ex‹nsiÚ
;

2504 ià(!
ext
 || 
ty³
 > 
MARIADB_FIELD_ATTR_LAST
)

2506 *
©Œ
ð
nuÎ_cÚ¡_¡ršg
;

2509 *
©Œ
ð
ext
->
m‘ad©a
[
ty³
];

2511 
	}
}

2517 
MYSQL_ROW
 
STDCALL


2518 
	$mysql_ãtch_row
(
MYSQL_RES
 *
»s
)

2520 ià(!
»s
)

2522 ià(
»s
->
hªdË
)

2524 ià(
»s
->
hªdË
->
¡©us
 !ð
MYSQL_STATUS_USE_RESULT
 &&

2525 
»s
->
hªdË
->
¡©us
 !ð
MYSQL_STATUS_GET_RESULT
)

2528 ià(!
»s
->
d©a
)

2530 ià(!
»s
->
eof
 &&„es->
hªdË
)

2532 ià(!(
»s
->
hªdË
->
m‘hods
->
	`db_»ad_Úe_row
Ôes->hªdË,»s->
f›ld_couÁ
,»s->
row
,„es->
Ëngths
)))

2534 
»s
->
row_couÁ
++;

2535 (
»s
->
cu¼’t_row
ôes->
row
);

2537 
»s
->
eof
=1;

2538 
»s
->
hªdË
->
¡©us
=
MYSQL_STATUS_READY
;

2540 
»s
->
hªdË
=0;

2542 ((
MYSQL_ROW
è
NULL
);

2545 
MYSQL_ROW
 
tmp
;

2546 ià(!
»s
->
d©a_cursÜ
)

2548 (
»s
->
cu¼’t_row
=(
MYSQL_ROW
è
NULL
);

2550 
tmp
 = 
»s
->
d©a_cursÜ
->
d©a
;

2551 
»s
->
d©a_cursÜ
 =„es->d©a_cursÜ->
Ãxt
;

2552 (
»s
->
cu¼’t_row
=
tmp
);

2554 
	}
}

2562 
ulÚg
 * 
STDCALL


2563 
	$mysql_ãtch_Ëngths
(
MYSQL_RES
 *
»s
)

2565 
ulÚg
 *
Ëngths
,*
´ev_Ëngth
;

2566 *
¡¬t
;

2567 
MYSQL_ROW
 
cÞumn
,
’d
;

2569 ià(!(
cÞumn
=
»s
->
cu¼’t_row
))

2571 ià(
»s
->
d©a
)

2573 
¡¬t
=0;

2574 
´ev_Ëngth
=0;

2575 
Ëngths
=
»s
->lengths;

2576 
’d
=
cÞumn
+
»s
->
f›ld_couÁ
+1 ; cÞumÀ!ð’d ; cÞumn++,
Ëngths
++)

2578 ià(!*
cÞumn
)

2580 *
Ëngths
=0;

2583 ià(
¡¬t
)

2584 *
´ev_Ëngth
ð(
ušt
è(*
cÞumn
-
¡¬t
-1);

2585 
¡¬t
ð*
cÞumn
;

2586 
´ev_Ëngth
=
Ëngths
;

2589  
»s
->
Ëngths
;

2590 
	}
}

2596 
STDCALL


2597 
	$mysql_d©a_£ek
(
MYSQL_RES
 *
»suÉ
, 
row
)

2599 
MYSQL_ROWS
 *
tmp
=0;

2600 ià(
»suÉ
->
d©a
)

2601 
tmp
=
»suÉ
->
d©a
->d©a; 
row
-- &&m°;m°ðtmp->
Ãxt
) ;

2602 
»suÉ
->
cu¼’t_row
=0;

2603 
»suÉ
->
d©a_cursÜ
 = 
tmp
;

2604 
	}
}

2612 
MYSQL_ROW_OFFSET
 
STDCALL


2613 
	$mysql_row_£ek
(
MYSQL_RES
 *
»suÉ
, 
MYSQL_ROW_OFFSET
 
row
)

2615 
MYSQL_ROW_OFFSET
 
»tuº_v®ue
=
»suÉ
->
d©a_cursÜ
;

2616 
»suÉ
->
cu¼’t_row
= 0;

2617 
»suÉ
->
d©a_cursÜ
ð
row
;

2618  
»tuº_v®ue
;

2619 
	}
}

2622 
MYSQL_FIELD_OFFSET
 
STDCALL


2623 
	$mysql_f›ld_£ek
(
MYSQL_RES
 *
»suÉ
, 
MYSQL_FIELD_OFFSET
 
f›ld_off£t
)

2625 
MYSQL_FIELD_OFFSET
 
»tuº_v®ue
=
»suÉ
->
cu¼’t_f›ld
;

2626 
»suÉ
->
cu¼’t_f›ld
=
f›ld_off£t
;

2627  
»tuº_v®ue
;

2628 
	}
}

2640 
MYSQL_RES
 * 
STDCALL


2641 
	$mysql_li¡_dbs
(
MYSQL
 *
mysql
, cÚ¡ *
wžd
)

2643 
buff
[255];

2644 
	`¢´štf
(
buff
, 255, "SHOW DATABASES LIKE '%s'", 
wžd
 ? wild : "%");

2645 ià(
	`mysql_qu”y
(
mysql
,
buff
))

2647  (
	`mysql_¡Üe_»suÉ
(
mysql
));

2648 
	}
}

2661 
MYSQL_RES
 * 
STDCALL


2662 
	$mysql_li¡_bËs
(
MYSQL
 *
mysql
, cÚ¡ *
wžd
)

2664 
buff
[255];

2666 
	`¢´štf
(
buff
, 255, "SHOW TABLES LIKE '%s'", 
wžd
 ? wild : "%");

2667 ià(
	`mysql_qu”y
(
mysql
,
buff
))

2669  (
	`mysql_¡Üe_»suÉ
(
mysql
));

2670 
	}
}

2680 
MYSQL_RES
 * 
STDCALL


2681 
	$mysql_li¡_f›lds
(
MYSQL
 *
mysql
, cÚ¡ *
bË
, cÚ¡ *
wžd
)

2683 
MYSQL_RES
 *
»suÉ
;

2684 
MYSQL_DATA
 *
qu”y
;

2685 
buff
[255];

2686 
Ëngth
= 0;

2688 
	`LINT_INIT
(
qu”y
);

2690 
Ëngth
ð
	`¢´štf
(
buff
, 128, "%s%c%s", 
bË
, '\0', 
wžd
 ? wild : "");

2692 ià(
	`ma_sim¶e_commªd
(
mysql
, 
COM_FIELD_LIST
,
buff
,
Ëngth
,1,0) ||

2693 !(
qu”y
 = 
mysql
->
m‘hods
->
	`db_»ad_rows
(mysql,(
MYSQL_FIELD
*) 0,

2694 
	`ma_»suÉ_£t_rows
(
mysql
))))

2695 (
NULL
);

2697 
	`ä“_Þd_qu”y
(
mysql
);

2698 ià(!(
»suÉ
 = (
MYSQL_RES
 *è
	`ÿÎoc
(1, (MYSQL_RES))))

2700 
	`ä“_rows
(
qu”y
);

2701 (
NULL
);

2703 
»suÉ
->
f›ld_®loc
=
mysql
->field_alloc;

2704 
mysql
->
f›lds
=0;

2705 
»suÉ
->
eof
=1;

2706 
»suÉ
->
f›ld_couÁ
 = (
ušt
è
qu”y
->
rows
;

2707 
»suÉ
->
f›lds
ð
	`uÅack_f›lds
(
mysql
, 
qu”y
, &»suÉ->
f›ld_®loc
,

2708 
»suÉ
->
f›ld_couÁ
, 1);

2709 ià(
»suÉ
->
f›lds
)

2710 (
»suÉ
);

2712 
	`ä“
(
»suÉ
);

2713 (
NULL
);

2714 
	}
}

2724 
MYSQL_RES
 * 
STDCALL


2725 
	$mysql_li¡_´oûs£s
(
MYSQL
 *
mysql
)

2727 
MYSQL_DATA
 *
f›lds
;

2728 
ušt
 
f›ld_couÁ
;

2729 
uch¬
 *
pos
;

2731 
	`LINT_INIT
(
f›lds
);

2732 ià(
	`ma_sim¶e_commªd
(
mysql
, 
COM_PROCESS_INFO
,0,0,0,0))

2733 (
NULL
);

2734 
	`ä“_Þd_qu”y
(
mysql
);

2735 
pos
=(
uch¬
*è
mysql
->
Ãt
.
»ad_pos
;

2736 
f›ld_couÁ
=(
ušt
è
	`Ãt_f›ld_Ëngth
(&
pos
);

2737 ià(!(
f›lds
 = 
mysql
->
m‘hods
->
	`db_»ad_rows
(mysql,(
MYSQL_FIELD
*) 0,7)))

2738 (
NULL
);

2739 ià(!(
mysql
->
f›lds
ð
	`uÅack_f›lds
(mysql, f›lds, &mysql->
f›ld_®loc
,

2740 
f›ld_couÁ
, 0)))

2741 (
NULL
);

2742 
mysql
->
¡©us
=
MYSQL_STATUS_GET_RESULT
;

2743 
mysql
->
f›ld_couÁ
=field_count;

2744 (
	`mysql_¡Üe_»suÉ
(
mysql
));

2745 
	}
}

2748 
STDCALL


2749 
	$mysql_shutdown
(
MYSQL
 *
mysql
, 
mysql_’um_shutdown_Ëv–
 
shutdown_Ëv–
)

2751 
uch¬
 
s_Ëv–
[2];

2752 
s_Ëv–
[0]ð(
uch¬
)
shutdown_Ëv–
;

2753 (
	`ma_sim¶e_commªd
(
mysql
, 
COM_SHUTDOWN
, (*)
s_Ëv–
, 1, 0, 0));

2754 
	}
}

2756 
STDCALL


2757 
	$mysql_»äesh
(
MYSQL
 *
mysql
,
ušt
 
ÝtiÚs
)

2759 
uch¬
 
b™s
[1];

2760 
b™s
[0]ð(
uch¬
è
ÝtiÚs
;

2761 (
	`ma_sim¶e_commªd
(
mysql
, 
COM_REFRESH
,(*è
b™s
,1,0,0));

2762 
	}
}

2764 
STDCALL


2765 
	$mysql_kžl
(
MYSQL
 *
mysql
,
ulÚg
 
pid
)

2767 
buff
[12];

2768 
	`št4¡Üe
(
buff
,
pid
);

2770 (
	`ma_sim¶e_commªd
(
mysql
, 
COM_PROCESS_KILL
,
buff
,4,0,0));

2771 
	}
}

2774 
STDCALL


2775 
	$mysql_dump_debug_šfo
(
MYSQL
 *
mysql
)

2777 (
	`ma_sim¶e_commªd
(
mysql
, 
COM_DEBUG
,0,0,0,0));

2778 
	}
}

2780 * 
STDCALL


2781 
	$mysql_¡©
(
MYSQL
 *
mysql
)

2783 ià(
	`ma_sim¶e_commªd
(
mysql
, 
COM_STATISTICS
,0,0,0,0))

2784  
mysql
->
Ãt
.
Ï¡_”rÜ
;

2785 
mysql
->
Ãt
.
»ad_pos
[mysql->
·ck‘_Ëngth
]=0;

2786 ià(!
mysql
->
Ãt
.
»ad_pos
[0])

2788 
	`SET_CLIENT_ERROR
(
mysql
, 
CR_WRONG_HOST_INFO
 , 
SQLSTATE_UNKNOWN
, 0);

2789  
mysql
->
Ãt
.
Ï¡_”rÜ
;

2791 ((*è
mysql
->
Ãt
.
»ad_pos
);

2792 
	}
}

2794 
STDCALL


2795 
	$mysql_pšg
(
MYSQL
 *
mysql
)

2797 
rc
;

2798 
rc
ð
	`ma_sim¶e_commªd
(
mysql
, 
COM_PING
, 0, 0, 0, 0);

2799 ià(
rc
 && 
mysql
->
ÝtiÚs
.
»cÚÃù
)

2800 
rc
ð
	`ma_sim¶e_commªd
(
mysql
, 
COM_PING
, 0, 0, 0, 0);

2801  
rc
;

2802 
	}
}

2804 * 
STDCALL


2805 
	$mysql_g‘_£rv”_šfo
(
MYSQL
 *
mysql
)

2807 ((*è
mysql
->
£rv”_v”siÚ
);

2808 
	}
}

2810 
size_t
 
	$m¬Ÿdb_£rv”_v”siÚ_id
(
MYSQL
 *
mysql
)

2812 
size_t
 
majÜ
, 
mšÜ
, 
·tch
;

2813 *
p
;

2815 ià(!(
p
 = 
mysql
->
£rv”_v”siÚ
)) {

2819 
majÜ
 = 
	`¡¹Þ
(
p
, &p, 10);

2820 
p
 += 1;

2821 
mšÜ
 = 
	`¡¹Þ
(
p
, &p, 10);

2822 
p
 += 1;

2823 
·tch
 = 
	`¡¹Þ
(
p
, &p, 10);

2825  (
majÜ
 * 10000L + ()(
mšÜ
 * 100L + 
·tch
));

2826 
	}
}

2828 
STDCALL
 
	$mysql_g‘_£rv”_v”siÚ
(
MYSQL
 *
mysql
)

2830  ()
	`m¬Ÿdb_£rv”_v”siÚ_id
(
mysql
);

2831 
	}
}

2833 * 
STDCALL


2834 
	$mysql_g‘_ho¡_šfo
(
MYSQL
 *
mysql
)

2836 (
mysql
->
ho¡_šfo
);

2837 
	}
}

2839 
ušt
 
STDCALL


2840 
	$mysql_g‘_´Ùo_šfo
(
MYSQL
 *
mysql
)

2842  (
mysql
->
´ÙocÞ_v”siÚ
);

2843 
	}
}

2845 cÚ¡ * 
STDCALL


2846 
	$mysql_g‘_þ›Á_šfo
()

2848  (*è
MARIADB_CLIENT_VERSION_STR
;

2849 
	}
}

2851 
size_t
 
	$g‘_¡Üe_Ëngth
(
size_t
 
Ëngth
)

2853 
	#MAX_STORE_SIZE
 9

	)

2854 
bufãr
[
MAX_STORE_SIZE
], *
p
;

2858 
p
ð
	`mysql_Ãt_¡Üe_Ëngth
(
bufãr
, 
Ëngth
);

2859  
p
 - 
bufãr
;

2860 
	}
}

2862 
uch¬
 *
ma_g‘_hash_keyv®
(cÚ¡ uch¬ *
hash_’Œy
,

2863 *
Ëngth
,

2864 
my_boÞ
 
nÙ_u£d
 
__©Œibu‹__
((
unu£d
)))

2870 
uch¬
 *
	gp
ð(uch¬ *)
hash_’Œy
;

2871 
size_t
 
	gËn
ð
¡¾’
((*)
p
);

2872 *
	gËngth
ð()
Ën
;

2873  
	gp
;

2876 
	$ma_št_hash_ä“
(*
p
)

2878 
	`ä“
(
p
);

2879 
	}
}

2882 
	$mysql_ÝtiÚsv
(
MYSQL
 *
mysql
,
mysql_ÝtiÚ
 
ÝtiÚ
, ...)

2884 
va_li¡
 
­
;

2885 *
¬g1
;

2886 
size_t
 
¡acksize
;

2887 
mysql_async_cÚ‹xt
 *
ùxt
;

2889 
	`va_¡¬t
(
­
, 
ÝtiÚ
);

2891 
¬g1
ð
	`va_¬g
(
­
, *);

2893 
ÝtiÚ
) {

2894 
MYSQL_OPT_CONNECT_TIMEOUT
:

2895 
mysql
->
ÝtiÚs
.
cÚÃù_timeout
ð*(
ušt
*è
¬g1
;

2897 
MYSQL_OPT_COMPRESS
:

2898 
mysql
->
ÝtiÚs
.
com´ess
= 1;

2899 
mysql
->
ÝtiÚs
.
þ›Á_æag
|ð
CLIENT_COMPRESS
;

2901 
MYSQL_OPT_NAMED_PIPE
:

2902 
mysql
->
ÝtiÚs
.
Çmed_pe
=1;

2904 
MYSQL_OPT_LOCAL_INFILE
:

2905 ià(!
¬g1
 || 
	`‹¡
(*(*)‡rg1))

2906 
mysql
->
ÝtiÚs
.
þ›Á_æag
|ð
CLIENT_LOCAL_FILES
;

2908 
mysql
->
ÝtiÚs
.
þ›Á_æag
&ð~
CLIENT_LOCAL_FILES
;

2909 ià(
¬g1
) {

2910 
	`CHECK_OPT_EXTENSION_SET
(&
mysql
->
ÝtiÚs
);

2911 
mysql
->
ex‹nsiÚ
->
auto_loÿl_šfže
ð*(
ušt
*)
¬g1
 =ð
LOCAL_INFILE_MODE_AUTO


2912 ? 
WAIT_FOR_QUERY
 : 
ALWAYS_ACCEPT
;

2915 
MYSQL_INIT_COMMAND
:

2916 
	`ÝtiÚs_add_š™commªd
(&
mysql
->
ÝtiÚs
, (*)
¬g1
);

2918 
MYSQL_READ_DEFAULT_FILE
:

2919 
	`OPT_SET_VALUE_STR
(&
mysql
->
ÝtiÚs
, 
my_úf_fže
, (*)
¬g1
);

2921 
MYSQL_READ_DEFAULT_GROUP
:

2922 
	`OPT_SET_VALUE_STR
(&
mysql
->
ÝtiÚs
, 
my_úf_group
, 
¬g1
 ? (*)arg1 : "");

2924 
MYSQL_SET_CHARSET_DIR
:

2925 
	`OPT_SET_VALUE_STR
(&
mysql
->
ÝtiÚs
, 
ch¬£t_dœ
, 
¬g1
);

2927 
MYSQL_SET_CHARSET_NAME
:

2928 
	`OPT_SET_VALUE_STR
(&
mysql
->
ÝtiÚs
, 
ch¬£t_Çme
, 
¬g1
);

2930 
MYSQL_OPT_RECONNECT
:

2931 
mysql
->
ÝtiÚs
.
»cÚÃù
ð*(
my_boÞ
 *)
¬g1
;

2933 
MYSQL_OPT_PROTOCOL
:

2934 
mysql
->
ÝtiÚs
.
´ÙocÞ
ð*((
ušt
 *)
¬g1
);

2936 #ifdeà
_WIN32


2937 
MYSQL_SHARED_MEMORY_BASE_NAME
:

2938 
	`OPT_SET_VALUE_STR
(&
mysql
->
ÝtiÚs
, 
sh¬ed_memÜy_ba£_Çme
, 
¬g1
);

2941 
MYSQL_OPT_READ_TIMEOUT
:

2942 
mysql
->
ÝtiÚs
.
»ad_timeout
ð*(
ušt
 *)
¬g1
;

2944 
MYSQL_OPT_WRITE_TIMEOUT
:

2945 
mysql
->
ÝtiÚs
.
wr™e_timeout
ð*(
ušt
 *)
¬g1
;

2947 
MYSQL_REPORT_DATA_TRUNCATION
:

2948 
mysql
->
ÝtiÚs
.
»pÜt_d©a_ŒunÿtiÚ
ð*(
my_boÞ
 *)
¬g1
;

2950 
MYSQL_PROGRESS_CALLBACK
:

2951 
	`CHECK_OPT_EXTENSION_SET
(&
mysql
->
ÝtiÚs
);

2952 ià(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
)

2953 
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
»pÜt_´og»ss
=

2954 ((*)(cÚ¡ 
MYSQL
 *, 
ušt
, ušt, , cÚ¡ *, ušt)è
¬g1
;

2956 
MYSQL_SERVER_PUBLIC_KEY
:

2957 
	`OPT_SET_EXTENDED_VALUE_STR
(&
mysql
->
ÝtiÚs
, 
£rv”_public_key
, (*)
¬g1
);

2959 
MYSQL_PLUGIN_DIR
:

2960 
	`OPT_SET_EXTENDED_VALUE_STR
(&
mysql
->
ÝtiÚs
, 
¶ugš_dœ
, (*)
¬g1
);

2962 
MYSQL_DEFAULT_AUTH
:

2963 
	`OPT_SET_EXTENDED_VALUE_STR
(&
mysql
->
ÝtiÚs
, 
deçuÉ_auth
, (*)
¬g1
);

2965 
MYSQL_OPT_NONBLOCK
:

2966 ià(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
 &&

2967 (
ùxt
 = 
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
async_cÚ‹xt
) != 0)

2973 ià(
ùxt
->
su¥’ded
)

2974 
’d
;

2975 
	`my_cÚ‹xt_de¡roy
(&
ùxt
->
async_cÚ‹xt
);

2976 
	`ä“
(
ùxt
);

2978 ià(!(
ùxt
ð(
mysql_async_cÚ‹xt
 *)

2979 
	`ÿÎoc
(1, (*
ùxt
))))

2981 
	`SET_CLIENT_ERROR
(
mysql
, 
CR_OUT_OF_MEMORY
, 
SQLSTATE_UNKNOWN
, 0);

2982 
’d
;

2984 
¡acksize
= 0;

2985 ià(
¬g1
)

2986 
¡acksize
ð*(cÚ¡ 
size_t
 *)
¬g1
;

2987 ià(!
¡acksize
)

2988 
¡acksize
ð
ASYNC_CONTEXT_DEFAULT_STACK_SIZE
;

2989 ià(
	`my_cÚ‹xt_š™
(&
ùxt
->
async_cÚ‹xt
, 
¡acksize
))

2991 
	`ä“
(
ùxt
);

2992 
’d
;

2994 ià(!
mysql
->
ÝtiÚs
.
ex‹nsiÚ
)

2995 if(!(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
ð(
¡_mysql_ÝtiÚs_ex‹nsiÚ
 *)

2996 
	`ÿÎoc
(1, (
¡_mysql_ÝtiÚs_ex‹nsiÚ
))))

2998 
	`ä“
(
ùxt
);

2999 
	`SET_CLIENT_ERROR
(
mysql
, 
CR_OUT_OF_MEMORY
, 
SQLSTATE_UNKNOWN
, 0);

3000 
’d
;

3002 
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
async_cÚ‹xt
ð
ùxt
;

3004 
MYSQL_OPT_MAX_ALLOWED_PACKET
:

3005 ià(
mysql
)

3006 
mysql
->
ÝtiÚs
.
max_®lowed_·ck‘
ð()(*(
size_t
 *)
¬g1
);

3008 
max_®lowed_·ck‘
ð()(*(
size_t
 *)
¬g1
);

3010 
MYSQL_OPT_NET_BUFFER_LENGTH
:

3011 
Ãt_bufãr_Ëngth
ð()(*(
size_t
 *)
¬g1
);

3013 
MYSQL_OPT_CAN_HANDLE_EXPIRED_PASSWORDS
:

3014 ià(*(
my_boÞ
 *)
¬g1
)

3015 
mysql
->
ÝtiÚs
.
þ›Á_æag
 |ð
CLIENT_CAN_HANDLE_EXPIRED_PASSWORDS
;

3017 
mysql
->
ÝtiÚs
.
þ›Á_æag
 &ð~
CLIENT_CAN_HANDLE_EXPIRED_PASSWORDS
;

3019 
MYSQL_OPT_SSL_ENFORCE
:

3020 
mysql
->
ÝtiÚs
.
u£_s¦
ð(*(
my_boÞ
 *)
¬g1
);

3022 
MYSQL_OPT_SSL_VERIFY_SERVER_CERT
:

3023 ià(*(
my_boÞ
 *)
¬g1
)

3024 
mysql
->
ÝtiÚs
.
þ›Á_æag
 |ð
CLIENT_SSL_VERIFY_SERVER_CERT
;

3026 
mysql
->
ÝtiÚs
.
þ›Á_æag
 &ð~
CLIENT_SSL_VERIFY_SERVER_CERT
;

3028 
MYSQL_OPT_SSL_KEY
:

3029 
	`OPT_SET_VALUE_STR
(&
mysql
->
ÝtiÚs
, 
s¦_key
, (*)
¬g1
);

3031 
MYSQL_OPT_SSL_CERT
:

3032 
	`OPT_SET_VALUE_STR
(&
mysql
->
ÝtiÚs
, 
s¦_û¹
, (*)
¬g1
);

3034 
MYSQL_OPT_SSL_CA
:

3035 
	`OPT_SET_VALUE_STR
(&
mysql
->
ÝtiÚs
, 
s¦_ÿ
, (*)
¬g1
);

3037 
MYSQL_OPT_SSL_CAPATH
:

3038 
	`OPT_SET_VALUE_STR
(&
mysql
->
ÝtiÚs
, 
s¦_ÿ·th
, (*)
¬g1
);

3040 
MYSQL_OPT_SSL_CIPHER
:

3041 
	`OPT_SET_VALUE_STR
(&
mysql
->
ÝtiÚs
, 
s¦_ch”
, (*)
¬g1
);

3043 
MYSQL_OPT_SSL_CRL
:

3044 
	`OPT_SET_EXTENDED_VALUE_STR
(&
mysql
->
ÝtiÚs
, 
s¦_ül
, (*)
¬g1
);

3046 
MYSQL_OPT_SSL_CRLPATH
:

3047 
	`OPT_SET_EXTENDED_VALUE_STR
(&
mysql
->
ÝtiÚs
, 
s¦_üÍ©h
, (*)
¬g1
);

3049 
MYSQL_OPT_CONNECT_ATTR_DELETE
:

3051 
uch¬
 *
h
;

3052 
	`CHECK_OPT_EXTENSION_SET
(&
mysql
->
ÝtiÚs
);

3053 ià(
	`hash_š™ed
(&
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
cÚÃù_©Œs
) &&

3054 (
h
ð(
uch¬
 *)
	`hash_£¬ch
(&
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
cÚÃù_©Œs
, (uch¬ *)
¬g1
,

3055 
¬g1
 ? (
ušt
)
	`¡¾’
((*)arg1) : 0)))

3057 
uch¬
 *
p
ð
h
;

3058 
size_t
 
key_Ën
ð
	`¡¾’
((*)
p
);

3059 
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
cÚÃù_©Œs_Ën
-ð
key_Ën
 + 
	`g‘_¡Üe_Ëngth
(key_len);

3060 
p
+ð
key_Ën
 + 1;

3061 
key_Ën
ð
	`¡¾’
((*)
p
);

3062 
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
cÚÃù_©Œs_Ën
-ð
key_Ën
 + 
	`g‘_¡Üe_Ëngth
(key_len);

3063 
	`hash_d–‘e
(&
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
cÚÃù_©Œs
, 
h
);

3068 
MYSQL_OPT_CONNECT_ATTR_RESET
:

3069 
	`CHECK_OPT_EXTENSION_SET
(&
mysql
->
ÝtiÚs
);

3070 ià(
	`hash_š™ed
(&
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
cÚÃù_©Œs
))

3072 
	`hash_ä“
(&
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
cÚÃù_©Œs
);

3073 
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
cÚÃù_©Œs_Ën
= 0;

3076 
MARIADB_OPT_CONNECTION_HANDLER
:

3077 
	`OPT_SET_EXTENDED_VALUE_STR
(&
mysql
->
ÝtiÚs
, 
cÚÃùiÚ_hªdËr
, (*)
¬g1
);

3079 
MARIADB_OPT_PORT
:

3080 
	`OPT_SET_VALUE_INT
(&
mysql
->
ÝtiÚs
, 
pÜt
, *((
ušt
 *)
¬g1
));

3082 
MARIADB_OPT_UNIXSOCKET
:

3083 
	`OPT_SET_VALUE_STR
(&
mysql
->
ÝtiÚs
, 
unix_sock‘
, 
¬g1
);

3085 
MARIADB_OPT_USER
:

3086 
	`OPT_SET_VALUE_STR
(&
mysql
->
ÝtiÚs
, 
u£r
, 
¬g1
);

3088 
MARIADB_OPT_HOST
:

3089 
	`OPT_SET_VALUE_STR
(&
mysql
->
ÝtiÚs
, 
ho¡
, 
¬g1
);

3091 
MARIADB_OPT_SCHEMA
:

3092 
	`OPT_SET_VALUE_STR
(&
mysql
->
ÝtiÚs
, 
db
, 
¬g1
);

3094 
MARIADB_OPT_DEBUG
:

3096 
MARIADB_OPT_FOUND_ROWS
:

3097 
mysql
->
ÝtiÚs
.
þ›Á_æag
|ð
CLIENT_FOUND_ROWS
;

3099 
MARIADB_OPT_INTERACTIVE
:

3100 
mysql
->
ÝtiÚs
.
þ›Á_æag
|ð
CLIENT_INTERACTIVE
;

3102 
MARIADB_OPT_MULTI_RESULTS
:

3103 
mysql
->
ÝtiÚs
.
þ›Á_æag
|ð
CLIENT_MULTI_RESULTS
;

3105 
MARIADB_OPT_MULTI_STATEMENTS
:

3106 
mysql
->
ÝtiÚs
.
þ›Á_æag
|ð
CLIENT_MULTI_STATEMENTS
 | 
CLIENT_MULTI_RESULTS
;

3108 
MARIADB_OPT_PASSWORD
:

3109 
	`OPT_SET_VALUE_STR
(&
mysql
->
ÝtiÚs
, 
·sswÜd
, 
¬g1
);

3111 
MARIADB_OPT_USERDATA
:

3113 *
d©a
ð
	`va_¬g
(
­
, *);

3114 
uch¬
 *
bufãr
, *
p
;

3115 *
key
ð(*)
¬g1
;

3117 ià(!
key
 || !
d©a
)

3119 
	`SET_CLIENT_ERROR
(
mysql
, 
CR_INVALID_PARAMETER_NO
, 
SQLSTATE_UNKNOWN
, 0);

3120 
’d
;

3123 
	`CHECK_OPT_EXTENSION_SET
(&
mysql
->
ÝtiÚs
);

3124 ià(!
	`hash_š™ed
(&
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
u£rd©a
))

3126 ià(
	`_hash_š™
(&
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
u£rd©a
,

3127 0, 0, 0, 
ma_g‘_hash_keyv®
, 
ma_št_hash_ä“
, 0))

3129 
	`SET_CLIENT_ERROR
(
mysql
, 
CR_OUT_OF_MEMORY
, 
SQLSTATE_UNKNOWN
, 0);

3130 
’d
;

3134 
p
ð(
uch¬
 *)
	`hash_£¬ch
(&
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
u£rd©a
,

3135 (
uch¬
 *)
key
,

3136 (
ušt
)
	`¡¾’
(
key
));

3137 ià(
p
)

3139 
p
+ð
	`¡¾’
(
key
) + 1;

3140 
	`memýy
(
p
, &
d©a
, (*));

3144 ià(!(
bufãr
ð(
uch¬
 *)
	`m®loc
(
	`¡¾’
(
key
) + 1 + (*))))

3146 
	`SET_CLIENT_ERROR
(
mysql
, 
CR_OUT_OF_MEMORY
, 
SQLSTATE_UNKNOWN
, 0);

3147 
’d
;

3150 
p
ð
bufãr
;

3151 
	`¡rýy
((*)
p
, 
key
);

3152 
p
+ð
	`¡¾’
(
key
) + 1;

3153 
	`memýy
(
p
, &
d©a
, (*));

3155 ià(
	`hash_š£¹
(&
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
u£rd©a
, 
bufãr
))

3157 
	`ä“
(
bufãr
);

3158 
	`SET_CLIENT_ERROR
(
mysql
, 
CR_INVALID_PARAMETER_NO
, 
SQLSTATE_UNKNOWN
, 0);

3159 
’d
;

3163 
MYSQL_OPT_CONNECT_ATTR_ADD
:

3165 
uch¬
 *
bufãr
;

3166 *
¬g2
ð
	`va_¬g
(
­
, *);

3167 
size_t
 
¡Üage_Ën
, 
key_Ën
ð
¬g1
 ? 
	`¡¾’
((*)arg1) : 0,

3168 
v®ue_Ën
ð
¬g2
 ? 
	`¡¾’
((*)arg2) : 0;

3169 ià(!
key_Ën
 || !
v®ue_Ën
)

3171 
	`SET_CLIENT_ERROR
(
mysql
, 
CR_INVALID_PARAMETER_NO
, 
SQLSTATE_UNKNOWN
, 0);

3172 
’d
;

3174 
¡Üage_Ën
ð
key_Ën
 + 
v®ue_Ën
 +

3175 
	`g‘_¡Üe_Ëngth
(
key_Ën
) +

3176 
	`g‘_¡Üe_Ëngth
(
v®ue_Ën
);

3180 
key_Ën
++;

3181 
v®ue_Ën
++;

3183 
	`CHECK_OPT_EXTENSION_SET
(&
mysql
->
ÝtiÚs
);

3184 ià(!
key_Ën
 ||

3185 
¡Üage_Ën
 + 
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
cÚÃù_©Œs_Ën
 > 0xFFFF)

3187 
	`SET_CLIENT_ERROR
(
mysql
, 
CR_INVALID_PARAMETER_NO
, 
SQLSTATE_UNKNOWN
, 0);

3188 
’d
;

3191 ià(!
	`hash_š™ed
(&
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
cÚÃù_©Œs
))

3193 ià(
	`_hash_š™
(&
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
cÚÃù_©Œs
,

3194 0, 0, 0, 
ma_g‘_hash_keyv®
, 
ma_št_hash_ä“
, 0))

3196 
	`SET_CLIENT_ERROR
(
mysql
, 
CR_OUT_OF_MEMORY
, 
SQLSTATE_UNKNOWN
, 0);

3197 
’d
;

3200 ià((
bufãr
ð(
uch¬
 *)
	`m®loc
(
key_Ën
 + 
v®ue_Ën
)))

3202 
uch¬
 *
p
ð
bufãr
;

3203 
	`¡rýy
((*)
p
, 
¬g1
);

3204 
p
+ð(
	`¡¾’
(
¬g1
) + 1);

3205 ià(
¬g2
)

3206 
	`¡rýy
((*)
p
, 
¬g2
);

3208 ià(
	`hash_š£¹
(&
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
cÚÃù_©Œs
, 
bufãr
))

3210 
	`ä“
(
bufãr
);

3211 
	`SET_CLIENT_ERROR
(
mysql
, 
CR_INVALID_PARAMETER_NO
, 
SQLSTATE_UNKNOWN
, 0);

3212 
’d
;

3214 
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
cÚÃù_©Œs_Ën
+ð
¡Üage_Ën
;

3218 
	`SET_CLIENT_ERROR
(
mysql
, 
CR_OUT_OF_MEMORY
, 
SQLSTATE_UNKNOWN
, 0);

3219 
’d
;

3223 
MYSQL_ENABLE_CLEARTEXT_PLUGIN
:

3225 
MYSQL_SECURE_AUTH
:

3226 
mysql
->
ÝtiÚs
.
£cu»_auth
ð*(
my_boÞ
 *)
¬g1
;

3228 
MYSQL_OPT_BIND
:

3229 
	`OPT_SET_VALUE_STR
(&
mysql
->
ÝtiÚs
, 
bšd_add»ss
, 
¬g1
);

3231 
MARIADB_OPT_TLS_CIPHER_STRENGTH
:

3232 
	`OPT_SET_EXTENDED_VALUE_INT
(&
mysql
->
ÝtiÚs
, 
Žs_ch”_¡»ngth
, *((*)
¬g1
));

3234 
MARIADB_OPT_SSL_FP
:

3235 
MARIADB_OPT_TLS_PEER_FP
:

3236 
	`OPT_SET_EXTENDED_VALUE_STR
(&
mysql
->
ÝtiÚs
, 
Žs_å
, (*)
¬g1
);

3237 
mysql
->
ÝtiÚs
.
u£_s¦
= 1;

3239 
MARIADB_OPT_SSL_FP_LIST
:

3240 
MARIADB_OPT_TLS_PEER_FP_LIST
:

3241 
	`OPT_SET_EXTENDED_VALUE_STR
(&
mysql
->
ÝtiÚs
, 
Žs_å_li¡
, (*)
¬g1
);

3242 
mysql
->
ÝtiÚs
.
u£_s¦
= 1;

3244 
MARIADB_OPT_TLS_PASSPHRASE
:

3245 
	`OPT_SET_EXTENDED_VALUE_STR
(&
mysql
->
ÝtiÚs
, 
Žs_pw
, (*)
¬g1
);

3247 
MARIADB_OPT_CONNECTION_READ_ONLY
:

3248 
	`OPT_SET_EXTENDED_VALUE_INT
(&
mysql
->
ÝtiÚs
, 
»ad_Úly
, *(
my_boÞ
 *)
¬g1
);

3250 
MARIADB_OPT_PROXY_HEADER
:

3252 
size_t
 
¬g2
 = 
	`va_¬g
(
­
, size_t);

3253 
	`OPT_SET_EXTENDED_VALUE
(&
mysql
->
ÝtiÚs
, 
´oxy_h—d”
, (*)
¬g1
);

3254 
	`OPT_SET_EXTENDED_VALUE
(&
mysql
->
ÝtiÚs
, 
´oxy_h—d”_Ën
, 
¬g2
);

3257 
MARIADB_OPT_TLS_VERSION
:

3258 
MYSQL_OPT_TLS_VERSION
:

3259 
	`OPT_SET_EXTENDED_VALUE_STR
(&
mysql
->
ÝtiÚs
, 
Žs_v”siÚ
, (*)
¬g1
);

3261 
MARIADB_OPT_IO_WAIT
:

3262 
	`CHECK_OPT_EXTENSION_SET
(&
mysql
->
ÝtiÚs
);

3263 
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
io_wa™
 = ((*)(
my_sock‘
, 
my_boÞ
, ))
¬g1
;

3266 
	`va_’d
(
­
);

3267 
	`SET_CLIENT_ERROR
(
mysql
, 
CR_NOT_IMPLEMENTED
, 
SQLSTATE_UNKNOWN
, 0);

3270 
	`va_’d
(
­
);

3272 
’d
:

3273 
	`va_’d
(
­
);

3275 
	}
}

3278 
	$mysql_g‘_ÝtiÚv
(
MYSQL
 *
mysql
, 
mysql_ÝtiÚ
 
ÝtiÚ
, *
¬g
, ...)

3280 
va_li¡
 
­
;

3282 
	`va_¡¬t
(
­
, 
¬g
);

3284 
ÝtiÚ
) {

3285 
MYSQL_OPT_CONNECT_TIMEOUT
:

3286 *((
ušt
 *)
¬g
)ð
mysql
->
ÝtiÚs
.
cÚÃù_timeout
;

3288 
MYSQL_OPT_COMPRESS
:

3289 *((
my_boÞ
 *)
¬g
)ð
mysql
->
ÝtiÚs
.
com´ess
;

3291 
MYSQL_OPT_NAMED_PIPE
:

3292 *((
my_boÞ
 *)
¬g
)ð
mysql
->
ÝtiÚs
.
Çmed_pe
;

3294 
MYSQL_OPT_LOCAL_INFILE
:

3295 *((
ušt
 *)
¬g
)ð
	`‹¡
(
mysql
->
ÝtiÚs
.
þ›Á_æag
 & 
CLIENT_LOCAL_FILES
);

3297 
MYSQL_INIT_COMMAND
:

3300 *
–em’ts
;

3301 ià(
¬g
)

3302 *((**)
¬g
)ð
mysql
->
ÝtiÚs
.
š™_commªd
 ? mysql->ÝtiÚs.š™_commªd->
bufãr
 : 
NULL
;

3303 ià((
–em’ts
ð
	`va_¬g
(
­
, *)))

3304 *
–em’ts
ð
mysql
->
ÝtiÚs
.
š™_commªd
 ? mysql->options.init_command->elements : 0;

3307 
MYSQL_READ_DEFAULT_FILE
:

3308 *((**)
¬g
)ð
mysql
->
ÝtiÚs
.
my_úf_fže
;

3310 
MYSQL_READ_DEFAULT_GROUP
:

3311 *((**)
¬g
)ð
mysql
->
ÝtiÚs
.
my_úf_group
;

3313 
MYSQL_SET_CHARSET_DIR
:

3316 *((**)
¬g
)ð
NULL
;

3318 
MYSQL_SET_CHARSET_NAME
:

3319 ià(
mysql
->
ch¬£t
)

3320 *((cÚ¡ **)
¬g
)ð
mysql
->
ch¬£t
->
c¢ame
;

3322 *((**)
¬g
)ð
mysql
->
ÝtiÚs
.
ch¬£t_Çme
;

3324 
MYSQL_OPT_RECONNECT
:

3325 *((
my_boÞ
 *)
¬g
)ð
mysql
->
ÝtiÚs
.
»cÚÃù
;

3327 
MYSQL_OPT_PROTOCOL
:

3328 *((
ušt
 *)
¬g
)ð
mysql
->
ÝtiÚs
.
´ÙocÞ
;

3330 
MYSQL_OPT_READ_TIMEOUT
:

3331 *((
ušt
 *)
¬g
)ð
mysql
->
ÝtiÚs
.
»ad_timeout
;

3333 
MYSQL_OPT_WRITE_TIMEOUT
:

3334 *((
ušt
 *)
¬g
)ð
mysql
->
ÝtiÚs
.
wr™e_timeout
;

3336 
MYSQL_REPORT_DATA_TRUNCATION
:

3337 *((
my_boÞ
 *)
¬g
)ð
mysql
->
ÝtiÚs
.
»pÜt_d©a_ŒunÿtiÚ
;

3339 
MYSQL_PROGRESS_CALLBACK
:

3340 *(((**)(cÚ¡ 
MYSQL
 *, 
ušt
, ušt, , cÚ¡ *, ušt))
¬g
)=

3341 
mysql
->
ÝtiÚs
.
ex‹nsiÚ
 ? mysql->ÝtiÚs.ex‹nsiÚ->
»pÜt_´og»ss
 : 
NULL
;

3343 
MYSQL_SERVER_PUBLIC_KEY
:

3344 *((**)
¬g
)ð
mysql
->
ÝtiÚs
.
ex‹nsiÚ
 ?

3345 
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
£rv”_public_key
 : 
NULL
;

3347 
MYSQL_PLUGIN_DIR
:

3348 *((**)
¬g
)ð
mysql
->
ÝtiÚs
.
ex‹nsiÚ
 ? mysql->ÝtiÚs.ex‹nsiÚ->
¶ugš_dœ
 : 
NULL
;

3350 
MYSQL_DEFAULT_AUTH
:

3351 *((**)
¬g
)ð
mysql
->
ÝtiÚs
.
ex‹nsiÚ
 ? mysql->ÝtiÚs.ex‹nsiÚ->
deçuÉ_auth
 : 
NULL
;

3353 
MYSQL_OPT_NONBLOCK
:

3354 *((
my_boÞ
 *)
¬g
)ð
	`‹¡
(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
 && mysql->ÝtiÚs.ex‹nsiÚ->
async_cÚ‹xt
);

3356 
MYSQL_OPT_CAN_HANDLE_EXPIRED_PASSWORDS
:

3357 *((
my_boÞ
 *)
¬g
)ð
	`‹¡
(
mysql
->
ÝtiÚs
.
þ›Á_æag
 & 
CLIENT_CAN_HANDLE_EXPIRED_PASSWORDS
);

3359 
MYSQL_OPT_SSL_ENFORCE
:

3360 *((
my_boÞ
 *)
¬g
)ð
mysql
->
ÝtiÚs
.
u£_s¦
;

3362 
MYSQL_OPT_SSL_VERIFY_SERVER_CERT
:

3363 *((
my_boÞ
 *)
¬g
)ð
	`‹¡
(
mysql
->
ÝtiÚs
.
þ›Á_æag
 & 
CLIENT_SSL_VERIFY_SERVER_CERT
);

3365 
MYSQL_OPT_SSL_KEY
:

3366 *((**)
¬g
)ð
mysql
->
ÝtiÚs
.
s¦_key
;

3368 
MYSQL_OPT_SSL_CERT
:

3369 *((**)
¬g
)ð
mysql
->
ÝtiÚs
.
s¦_û¹
;

3371 
MYSQL_OPT_SSL_CA
:

3372 *((**)
¬g
)ð
mysql
->
ÝtiÚs
.
s¦_ÿ
;

3374 
MYSQL_OPT_SSL_CAPATH
:

3375 *((**)
¬g
)ð
mysql
->
ÝtiÚs
.
s¦_ÿ·th
;

3377 
MYSQL_OPT_SSL_CIPHER
:

3378 *((**)
¬g
)ð
mysql
->
ÝtiÚs
.
s¦_ch”
;

3380 
MYSQL_OPT_SSL_CRL
:

3381 *((**)
¬g
)ð
mysql
->
ÝtiÚs
.
ex‹nsiÚ
 ? mysql->ÝtiÚs.
s¦_ch”
 : 
NULL
;

3383 
MYSQL_OPT_SSL_CRLPATH
:

3384 *((**)
¬g
)ð
mysql
->
ÝtiÚs
.
ex‹nsiÚ
 ? mysql->ÝtiÚs.ex‹nsiÚ->
s¦_üÍ©h
 : 
NULL
;

3386 
MYSQL_OPT_CONNECT_ATTRS
:

3389 
i
, *
–em’ts
;

3390 **
key
ð
NULL
;

3391 *
¬g1
;

3392 **
v®
ð
NULL
;

3394 ià(
¬g
)

3395 
key
ð*(***)
¬g
;

3397 
¬g1
ð
	`va_¬g
(
­
, **);

3398 ià(
¬g1
)

3399 
v®
ð*(***)
¬g1
;

3401 ià(!(
–em’ts
ð
	`va_¬g
(
­
, *)))

3402 
”rÜ
;

3404 *
–em’ts
= 0;

3406 ià(!
mysql
->
ÝtiÚs
.
ex‹nsiÚ
 ||

3407 !
	`hash_š™ed
(&
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
cÚÃù_©Œs
))

3410 *
–em’ts
ð
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
cÚÃù_©Œs
.
»cÜds
;

3412 ià(
v®
 || 
key
)

3414 
i
=0; i < *
–em’ts
; i++)

3416 
uch¬
 *
p
ð
	`hash_–em’t
(&
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
cÚÃù_©Œs
, 
i
);

3417 ià(
key
)

3418 
key
[
i
]ð(*)
p
;

3419 
p
+ð
	`¡¾’
((*)p) + 1;

3420 ià(
v®
)

3421 
v®
[
i
]ð(*)
p
;

3426 
MYSQL_OPT_MAX_ALLOWED_PACKET
:

3427 *((*)
¬g
)ð(
mysql
è? mysql->
ÝtiÚs
.
max_®lowed_·ck‘
 :

3428 
max_®lowed_·ck‘
;

3430 
MYSQL_OPT_NET_BUFFER_LENGTH
:

3431 *((*)
¬g
)ð
Ãt_bufãr_Ëngth
;

3433 
MYSQL_SECURE_AUTH
:

3434 *((
my_boÞ
 *)
¬g
)ð
mysql
->
ÝtiÚs
.
£cu»_auth
;

3436 
MYSQL_OPT_BIND
:

3437 *((**)
¬g
)ð
mysql
->
ÝtiÚs
.
bšd_add»ss
;

3439 
MARIADB_OPT_TLS_CIPHER_STRENGTH
:

3440 *((*)
¬g
èð
mysql
->
ÝtiÚs
.
ex‹nsiÚ
 ? mysql->ÝtiÚs.ex‹nsiÚ->
Žs_ch”_¡»ngth
 : 0;

3442 
MARIADB_OPT_SSL_FP
:

3443 
MARIADB_OPT_TLS_PEER_FP
:

3444 *((**)
¬g
)ð
mysql
->
ÝtiÚs
.
ex‹nsiÚ
 ? mysql->ÝtiÚs.ex‹nsiÚ->
Žs_å
 : 
NULL
;

3446 
MARIADB_OPT_SSL_FP_LIST
:

3447 
MARIADB_OPT_TLS_PEER_FP_LIST
:

3448 *((**)
¬g
)ð
mysql
->
ÝtiÚs
.
ex‹nsiÚ
 ? mysql->ÝtiÚs.ex‹nsiÚ->
Žs_å_li¡
 : 
NULL
;

3450 
MARIADB_OPT_TLS_PASSPHRASE
:

3451 *((**)
¬g
)ð
mysql
->
ÝtiÚs
.
ex‹nsiÚ
 ? mysql->ÝtiÚs.ex‹nsiÚ->
Žs_pw
 : 
NULL
;

3453 
MARIADB_OPT_CONNECTION_READ_ONLY
:

3454 *((
my_boÞ
 *)
¬g
)ð
mysql
->
ÝtiÚs
.
ex‹nsiÚ
 ? mysql->ÝtiÚs.ex‹nsiÚ->
»ad_Úly
 : 0;

3456 
MARIADB_OPT_USERDATA
:

3459 
uch¬
 *
p
;

3460 *
d©a
ð
	`va_¬g
(
­
, *);

3461 *
key
ð(*)
¬g
;

3462 ià(
key
 && 
d©a
 && 
mysql
->
ÝtiÚs
.
ex‹nsiÚ
 && 
	`hash_š™ed
(&mysql->ÝtiÚs.ex‹nsiÚ->
u£rd©a
) &&

3463 (
p
ð(
uch¬
 *)
	`hash_£¬ch
(&
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
u£rd©a
, (uch¬ *)
key
,

3464 (
ušt
)
	`¡¾’
((*)
key
))))

3466 
p
+ð
	`¡¾’
(
key
) + 1;

3467 *((**)
d©a
)ð*((**)
p
);

3470 ià(
d©a
)

3471 *((**)
d©a
)ð
NULL
;

3474 
MARIADB_OPT_CONNECTION_HANDLER
:

3475 *((**)
¬g
)ð
mysql
->
ÝtiÚs
.
ex‹nsiÚ
 ? mysql->ÝtiÚs.ex‹nsiÚ->
cÚÃùiÚ_hªdËr
 : 
NULL
;

3477 
MARIADB_OPT_IO_WAIT
:

3478 *(((**)(
my_sock‘
, 
my_boÞ
, ))
¬g
èð
mysql
->
ÝtiÚs
.
ex‹nsiÚ
 ? mysql->ÝtiÚs.ex‹nsiÚ->
io_wa™
 : 
NULL
;

3481 
	`va_’d
(
­
);

3482 
	`SET_CLIENT_ERROR
(
mysql
, 
CR_NOT_IMPLEMENTED
, 
SQLSTATE_UNKNOWN
, 0);

3485 
	`va_’d
(
­
);

3487 
”rÜ
:

3488 
	`va_’d
(
­
);

3490 
	}
}

3492 
STDCALL
 
	$mysql_g‘_ÝtiÚ
(
MYSQL
 *
mysql
, 
mysql_ÝtiÚ
 
ÝtiÚ
, *
¬g
)

3494  
	`mysql_g‘_ÝtiÚv
(
mysql
, 
ÝtiÚ
, 
¬g
);

3495 
	}
}

3497 
STDCALL


3498 
	$mysql_ÝtiÚs
(
MYSQL
 *
mysql
,
mysql_ÝtiÚ
 
ÝtiÚ
, cÚ¡ *
¬g
)

3500  
	`mysql_ÝtiÚsv
(
mysql
, 
ÝtiÚ
, 
¬g
);

3501 
	}
}

3503 
STDCALL


3504 
	$mysql_ÝtiÚs4
(
MYSQL
 *
mysql
,
mysql_ÝtiÚ
 
ÝtiÚ
, cÚ¡ *
¬g1
, cÚ¡ *
¬g2
)

3506  
	`mysql_ÝtiÚsv
(
mysql
, 
ÝtiÚ
, 
¬g1
, 
¬g2
);

3507 
	}
}

3514 
my_ulÚglÚg
 
STDCALL
 
	$mysql_num_rows
(
MYSQL_RES
 *
»s
)

3516  
»s
->
row_couÁ
;

3517 
	}
}

3519 
STDCALL
 
	$mysql_num_f›lds
(
MYSQL_RES
 *
»s
)

3521  
»s
->
f›ld_couÁ
;

3522 
	}
}

3525 
my_boÞ
 
STDCALL
 
	$mysql_eof
(
MYSQL_RES
 *
»s
)

3527  
»s
->
eof
;

3528 
	}
}

3530 
MYSQL_FIELD
 * 
STDCALL
 
	$mysql_ãtch_f›ld_dœeù
(
MYSQL_RES
 *
»s
,
ušt
 
f›ldÄ
)

3532  &(
»s
)->
f›lds
[
f›ldÄ
];

3533 
	}
}

3535 
MYSQL_FIELD
 * 
STDCALL
 
	$mysql_ãtch_f›lds
(
MYSQL_RES
 *
»s
)

3537  (
»s
)->
f›lds
;

3538 
	}
}

3540 
MYSQL_ROWS
 * 
STDCALL
 
	$mysql_row_‹Î
(
MYSQL_RES
 *
»s
)

3542  
»s
->
d©a_cursÜ
;

3543 
	}
}

3545 
ušt
 
STDCALL
 
	$mysql_f›ld_‹Î
(
MYSQL_RES
 *
»s
)

3547  (
»s
)->
cu¼’t_f›ld
;

3548 
	}
}

3552 
STDCALL
 
	$mysql_f›ld_couÁ
(
MYSQL
 *
mysql
)

3554  
mysql
->
f›ld_couÁ
;

3555 
	}
}

3557 
my_ulÚglÚg
 
STDCALL
 
	$mysql_afãùed_rows
(
MYSQL
 *
mysql
)

3559  (
mysql
)->
afãùed_rows
;

3560 
	}
}

3562 
my_boÞ
 
STDCALL
 
	$mysql_autocomm™
(
MYSQL
 *
mysql
, 
my_boÞ
 
mode
)

3564 ((
my_boÞ
è
	`mysql_»®_qu”y
(
mysql
, (
mode
) ? "SET‡utocommit=1" :

3566 
	}
}

3568 
my_boÞ
 
STDCALL
 
	$mysql_comm™
(
MYSQL
 *
mysql
)

3570 ((
my_boÞ
)
	`mysql_»®_qu”y
(
mysql
, "COMMIT", ()
	`¡¾’
("COMMIT")));

3571 
	}
}

3573 
my_boÞ
 
STDCALL
 
	$mysql_rÞlback
(
MYSQL
 *
mysql
)

3575 ((
my_boÞ
)
	`mysql_»®_qu”y
(
mysql
, "ROLLBACK", ()
	`¡¾’
("ROLLBACK")));

3576 
	}
}

3578 
my_ulÚglÚg
 
STDCALL
 
	$mysql_š£¹_id
(
MYSQL
 *
mysql
)

3580  (
mysql
)->
š£¹_id
;

3581 
	}
}

3583 
ušt
 
STDCALL
 
	$mysql_”ºo
(
MYSQL
 *
mysql
)

3585  
mysql
 ? mysql->
Ãt
.
Ï¡_”ºo
 : 0;

3586 
	}
}

3588 cÚ¡ * 
STDCALL
 
	$mysql_”rÜ
(
MYSQL
 *
mysql
)

3590  
mysql
 ? (mysql)->
Ãt
.
Ï¡_”rÜ
 : (*)"";

3591 
	}
}

3593 cÚ¡ *
STDCALL
 
	$mysql_šfo
(
MYSQL
 *
mysql
)

3595  (
mysql
)->
šfo
;

3596 
	}
}

3598 
my_boÞ
 
STDCALL
 
	$mysql_mÜe_»suÉs
(
MYSQL
 *
mysql
)

3600 (
	`‹¡
(
mysql
->
£rv”_¡©us
 & 
SERVER_MORE_RESULTS_EXIST
));

3601 
	}
}

3603 
STDCALL
 
	$mysql_Ãxt_»suÉ
(
MYSQL
 *
mysql
)

3607 ià(
mysql
->
¡©us
 !ð
MYSQL_STATUS_READY
)

3609 
	`SET_CLIENT_ERROR
(
mysql
, 
CR_COMMANDS_OUT_OF_SYNC
, 
SQLSTATE_UNKNOWN
, 0);

3614 
	`CLEAR_CLIENT_ERROR
(
mysql
);

3615 
mysql
->
afãùed_rows
 = (
ulÚglÚg
) ~0;

3617 ià(
mysql
->
£rv”_¡©us
 & 
SERVER_MORE_RESULTS_EXIST
)

3619 (
mysql
->
m‘hods
->
	`db_»ad_qu”y_»suÉ
(mysql));

3623 
	}
}

3625 
ulÚg
 
STDCALL
 
	$mysql_th»ad_id
(
MYSQL
 *
mysql
)

3627  (
mysql
)->
th»ad_id
;

3628 
	}
}

3630 cÚ¡ * 
STDCALL
 
	$mysql_ch¬aù”_£t_Çme
(
MYSQL
 *
mysql
)

3632  
mysql
->
ch¬£t
->
c¢ame
;

3633 
	}
}

3636 
ušt
 
STDCALL
 
	$mysql_th»ad_§ã
()

3638 #ifdeà
THREAD


3643 
	}
}

3655 
ulÚg
 
STDCALL


3656 
	$mysql_esÿ³_¡ršg
(*
to
,cÚ¡ *
äom
, 
ulÚg
 
Ëngth
)

3658  (
ulÚg
)
	`mysql_c£t_esÿ³_¦ashes
(
ma_deçuÉ_ch¬£t_šfo
, 
to
, 
äom
, 
Ëngth
);

3659 
	}
}

3661 
ulÚg
 
STDCALL


3662 
	$mysql_»®_esÿ³_¡ršg
(
MYSQL
 *
mysql
, *
to
,cÚ¡ *
äom
,

3663 
ulÚg
 
Ëngth
)

3665 ià(
mysql
->
£rv”_¡©us
 & 
SERVER_STATUS_NO_BACKSLASH_ESCAPES
)

3666  (
ulÚg
)
	`mysql_c£t_esÿ³_quÙes
(
mysql
->
ch¬£t
, 
to
, 
äom
, 
Ëngth
);

3668  (
ulÚg
)
	`mysql_c£t_esÿ³_¦ashes
(
mysql
->
ch¬£t
, 
to
, 
äom
, 
Ëngth
);

3669 
	}
}

3671 
	$m¬Ÿdb_g‘_ch¬£t_šfo
(
MYSQL
 *
mysql
, 
MY_CHARSET_INFO
 *
cs
)

3673 ià(!
cs
)

3676 
cs
->
numb”
ð
mysql
->
ch¬£t
->
Ä
;

3677 
cs
->
c¢ame
ð
mysql
->
ch¬£t
->csname;

3678 
cs
->
Çme
ð
mysql
->
ch¬£t
->name;

3679 
cs
->
¡©e
= 0;

3680 
cs
->
comm’t
ð
NULL
;

3681 
cs
->
dœ
ð
NULL
;

3682 
cs
->
mbmšËn
ð
mysql
->
ch¬£t
->
ch¬_mšËn
;

3683 
cs
->
mbmaxËn
ð
mysql
->
ch¬£t
->
ch¬_maxËn
;

3686 
	}
}

3688 
STDCALL
 
	$mysql_g‘_ch¬aù”_£t_šfo
(
MYSQL
 *
mysql
, 
MY_CHARSET_INFO
 *
cs
)

3690 
	`m¬Ÿdb_g‘_ch¬£t_šfo
(
mysql
, 
cs
);

3691 
	}
}

3693 
STDCALL
 
	$mysql_£t_ch¬aù”_£t
(
MYSQL
 *
mysql
, cÚ¡ *
c¢ame
)

3695 cÚ¡ 
MARIADB_CHARSET_INFO
 *
cs
;

3697 ià(!
c¢ame
)

3698 
”rÜ
;

3700 ià((
cs
ð
	`mysql_fšd_ch¬£t_Çme
(
c¢ame
)))

3702 
buff
[64];

3704 
	`¢´štf
(
buff
, 63, "SET NAMES %s", 
cs
->
c¢ame
);

3705 ià(!
	`mysql_»®_qu”y
(
mysql
, 
buff
, ()
	`¡¾’
(buff)))

3707 
mysql
->
ch¬£t
ð
cs
;

3710 (
mysql
->
Ãt
.
Ï¡_”ºo
);

3713 
”rÜ
:

3714 
	`my_£t_”rÜ
(
mysql
, 
CR_CANT_READ_CHARSET
, 
SQLSTATE_UNKNOWN
,

3715 0, 
c¢ame
, "compiled_in");

3716 (
mysql
->
Ãt
.
Ï¡_”ºo
);

3717 
	}
}

3719 
STDCALL
 
	$mysql_w¬nšg_couÁ
(
MYSQL
 *
mysql
)

3721  
mysql
->
w¬nšg_couÁ
;

3722 
	}
}

3724 cÚ¡ * 
STDCALL
 
	$mysql_sql¡©e
(
MYSQL
 *
mysql
)

3726  
mysql
->
Ãt
.
sql¡©e
;

3727 
	}
}

3729 #iâdeà
_WIN32


3730 
	~<sigÇl.h
>

3731 
	$ignÜe_sigpe
()

3733 
	`sigÇl
(
SIGPIPE
, 
SIG_IGN
);

3734 
	}
}

3736 
	#ignÜe_sigpe
()

	)

3739 #ifdeà
_WIN32


3740 
	$mysql_Úû_š™
()

3742 
	$mysql_Úû_š™
()

3745 
	`ma_š™
();

3746 
	`š™_þ›Á_”rs
();

3747 
	`g‘_deçuÉ_cÚfigu¿tiÚ_dœs
();

3748 
	`£t_deçuÉ_ch¬£t_by_Çme
(
MARIADB_DEFAULT_CHARSET
, 0);

3749 ià(
	`mysql_þ›Á_¶ugš_š™
())

3751 #ifdeà
_WIN32


3757 ià(!
mysql_pÜt
)

3759 #ià!
	`__has_ã©u»
(
memÜy_§n™iz”
)

3760 
£rv’t
 *
£rv_±r
;

3762 *
’v
;

3764 
mysql_pÜt
 = 
MARIADB_PORT
;

3765 #ià!
	`__has_ã©u»
(
memÜy_§n™iz”
)

3766 ià((
£rv_±r
 = 
	`g‘£rvbyÇme
("mysql", "tcp")))

3767 
mysql_pÜt
 = (
ušt
)
	`Áohs
((
ushÜt
)
£rv_±r
->
s_pÜt
);

3769 ià((
’v
 = 
	`g‘’v
("MYSQL_TCP_PORT")))

3770 
mysql_pÜt
 =(
ušt
)
	`©oi
(
’v
);

3772 ià(!
mysql_unix_pÜt
)

3774 *
’v
;

3775 #ifdeà
_WIN32


3776 
mysql_unix_pÜt
 = (*)
MARIADB_NAMEDPIPE
;

3778 
mysql_unix_pÜt
 = (*)
MARIADB_UNIX_ADDR
;

3780 ià((
’v
 = 
	`g‘’v
("MYSQL_UNIX_PORT")) ||

3781 (
’v
 = 
	`g‘’v
("MARIADB_UNIX_PORT")))

3782 
mysql_unix_pÜt
 = 
’v
;

3784 ià(!
mysql_ps_subsy¡em_š™Ÿlized
)

3785 
	`mysql_š™_ps_subsy¡em
();

3786 #ifdeà
HAVE_TLS


3787 
	`ma_Žs_¡¬t
(0, 0);

3789 
	`ignÜe_sigpe
();

3790 
mysql_þ›Á_š™
 = 1;

3791 #ifdeà
_WIN32


3794 
	}
}

3796 #ifdeà
_WIN32


3797 
INIT_ONCE
 
	gš™_Úû
ð
INIT_ONCE_STATIC_INIT
;

3798 
BOOL
 
CALLBACK
 
	$wš_š™_Úû
(

3799 
PINIT_ONCE
 
In™Onû
,

3800 
PVOID
 
P¬am‘”
,

3801 
PVOID
 *
ÍCÚ‹xt
)

3803  !
	`mysql_Úû_š™
();

3804  
TRUE
;

3805 
	}
}

3807 
±h»ad_Úû_t
 
	gš™_Úû
 = 
PTHREAD_ONCE_INIT
;

3810 
STDCALL
 
mysql_£rv”_š™
(
¬gc
 
__©Œibu‹__
((
unu£d
)),

3811 **
¬gv
 
__©Œibu‹__
((
unu£d
)),

3812 **
groups
 
__©Œibu‹__
((
unu£d
)))

3814 #ifdeà
_WIN32


3815 
BOOL
 
	g»t
 = 
In™OnûExecu‹Onû
(&
š™_Úû
, 
wš_š™_Úû
, 
NULL
, NULL);

3816  
	g»t
? 0: 1;

3818  
±h»ad_Úû
(&
š™_Úû
, 
mysql_Úû_š™
);

3822 
STDCALL
 
	$mysql_£rv”_’d
()

3824 ià(!
mysql_þ›Á_š™
)

3827 
	`»Ëa£_cÚfigu¿tiÚ_dœs
();

3828 
	`mysql_þ›Á_¶ugš_deš™
();

3830 
	`li¡_ä“
(
pvio_ÿÎback
, 0);

3831 ià(
ma_š™_dÚe
)

3832 
	`ma_’d
(0);

3833 #ifdeà
HAVE_TLS


3834 
	`ma_pvio_Žs_’d
();

3836 
mysql_þ›Á_š™
= 0;

3837 
ma_š™_dÚe
= 0;

3838 #ifdeà
WIN32


3839 
š™_Úû
 = (
INIT_ONCE
)
INIT_ONCE_STATIC_INIT
;

3841 
š™_Úû
 = (
±h»ad_Úû_t
)
PTHREAD_ONCE_INIT
;

3843 
	}
}

3845 
my_boÞ
 
STDCALL
 
	$mysql_th»ad_š™
()

3848 
	}
}

3850 
STDCALL
 
	$mysql_th»ad_’d
()

3852 
	}
}

3854 
STDCALL
 
	$mysql_£t_£rv”_ÝtiÚ
(
MYSQL
 *
mysql
,

3855 
’um_mysql_£t_ÝtiÚ
 
ÝtiÚ
)

3857 
bufãr
[2];

3858 
	`št2¡Üe
(
bufãr
, (
ušt
)
ÝtiÚ
);

3859 (
	`ma_sim¶e_commªd
(
mysql
, 
COM_SET_OPTION
, 
bufãr
, (buffer), 0, 0));

3860 
	}
}

3862 
ulÚg
 
STDCALL
 
	$mysql_g‘_þ›Á_v”siÚ
()

3864  
MARIADB_VERSION_ID
;

3865 
	}
}

3867 
ulÚg
 
STDCALL
 
	$mysql_hex_¡ršg
(*
to
, cÚ¡ *
äom
, 
Ën
)

3869 *
¡¬t
ð
to
;

3870 
hexdig™s
[]= "0123456789ABCDEF";

3872 
Ën
--)

3874 *
to
++ð
hexdig™s
[(()*
äom
) >> 4];

3875 *
to
++ð
hexdig™s
[(()*
äom
) & 0x0F];

3876 
äom
++;

3878 *
to
= 0;

3879  (
ulÚg
)(
to
 - 
¡¬t
);

3880 
	}
}

3882 
my_boÞ
 
STDCALL
 
	$m¬Ÿdb_cÚÃùiÚ
(
MYSQL
 *
mysql
)

3884  (
	`¡r¡r
(
mysql
->
£rv”_v”siÚ
, "MariaDB") ||

3885 
	`¡r¡r
(
mysql
->
£rv”_v”siÚ
, "-maria-"));

3886 
	}
}

3888 cÚ¡ * 
STDCALL


3889 
	$mysql_g‘_£rv”_Çme
(
MYSQL
 *
mysql
)

3891 ià(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
 &&

3892 
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
db_driv”
 !ð
NULL
)

3893  
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
db_driv”
->
Çme
;

3894  
	`m¬Ÿdb_cÚÃùiÚ
(
mysql
) ? "MariaDB" : "MySQL";

3895 
	}
}

3897 
my_sock‘
 
	$m¬Ÿdb_g‘_sock‘
(
MYSQL
 *
mysql
)

3899 
my_sock‘
 
sock
ð
INVALID_SOCKET
;

3900 ià(
mysql
->
Ãt
.
pvio
)

3902 
	`ma_pvio_g‘_hªdË
(
mysql
->
Ãt
.
pvio
, &
sock
);

3909 ià(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
 && mysql->ÝtiÚs.ex‹nsiÚ->
async_cÚ‹xt
 &&

3910 
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
async_cÚ‹xt
->
pvio
)

3912 
	`ma_pvio_g‘_hªdË
(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
async_cÚ‹xt
->
pvio
, &
sock
);

3914  
sock
;

3915 
	}
}

3917 
my_sock‘
 
STDCALL


3918 
	$mysql_g‘_sock‘
(
MYSQL
 *
mysql
)

3920  
	`m¬Ÿdb_g‘_sock‘
(
mysql
);

3921 
	}
}

3923 
MARIADB_CHARSET_INFO
 * 
STDCALL
 
	$m¬Ÿdb_g‘_ch¬£t_by_Çme
(cÚ¡ *
c¢ame
)

3925  (
MARIADB_CHARSET_INFO
 *)
	`mysql_fšd_ch¬£t_Çme
(
c¢ame
);

3926 
	}
}

3928 
MARIADB_CHARSET_INFO
 * 
STDCALL
 
	$m¬Ÿdb_g‘_ch¬£t_by_Ä
(
c¢r
)

3930  (
MARIADB_CHARSET_INFO
 *)
	`mysql_fšd_ch¬£t_Ä
(
c¢r
);

3931 
	}
}

3933 
my_boÞ
 
	$m¬Ÿdb_g‘_šfov
(
MYSQL
 *
mysql
, 
m¬Ÿdb_v®ue
 
v®ue
, *
¬g
, ...)

3935 
va_li¡
 
­
;

3937 
	`va_¡¬t
(
­
, 
¬g
);

3939 
v®ue
) {

3940 
MARIADB_MAX_ALLOWED_PACKET
:

3941 *((
size_t
 *)
¬g
)ð(size_t)
max_®lowed_·ck‘
;

3943 
MARIADB_NET_BUFFER_LENGTH
:

3944 *((
size_t
 *)
¬g
)ð(size_t)
Ãt_bufãr_Ëngth
;

3946 
MARIADB_CONNECTION_ERROR_ID
:

3947 ià(!
mysql
)

3948 
”rÜ
;

3949 *((*)
¬g
)ð
mysql
->
Ãt
.
Ï¡_”ºo
;

3951 
MARIADB_CONNECTION_ERROR
:

3952 ià(!
mysql
)

3953 
”rÜ
;

3954 *((**)
¬g
)ð
mysql
->
Ãt
.
Ï¡_”rÜ
;

3956 
MARIADB_CONNECTION_SQLSTATE
:

3957 ià(!
mysql
)

3958 
”rÜ
;

3959 *((**)
¬g
)ð
mysql
->
Ãt
.
sql¡©e
;

3961 
MARIADB_CONNECTION_TLS_VERSION
:

3962 #ifdeà
HAVE_TLS


3963 ià(
mysql
 && mysql->
Ãt
.
pvio
 && mysql->Ãt.pvio->
ùls
)

3964 *((**)
¬g
)ð(*)
	`ma_pvio_Žs_g‘_´ÙocÞ_v”siÚ
(
mysql
->
Ãt
.
pvio
->
ùls
);

3967 
”rÜ
;

3969 
MARIADB_CONNECTION_TLS_VERSION_ID
:

3970 #ifdeà
HAVE_TLS


3971 ià(
mysql
 && mysql->
Ãt
.
pvio
 && mysql->Ãt.pvio->
ùls
)

3972 *((*)
¬g
)ð
	`ma_pvio_Žs_g‘_´ÙocÞ_v”siÚ_id
(
mysql
->
Ãt
.
pvio
->
ùls
);

3975 
”rÜ
;

3977 
MARIADB_TLS_LIBRARY
:

3978 #ifdeà
HAVE_TLS


3979 *((cÚ¡ **)
¬g
)ð
Žs_lib¿ry_v”siÚ
;

3981 *((cÚ¡ **)
¬g
)= "Off";

3984 
MARIADB_CLIENT_VERSION
:

3985 *((cÚ¡ **)
¬g
)ð
MARIADB_CLIENT_VERSION_STR
;

3987 
MARIADB_CLIENT_VERSION_ID
:

3988 *((
size_t
 *)
¬g
)ð
MARIADB_VERSION_ID
;

3990 
MARIADB_CONNECTION_SERVER_VERSION
:

3991 ià(
mysql
)

3992 *((**)
¬g
)ð
mysql
->
£rv”_v”siÚ
;

3994 
”rÜ
;

3996 
MARIADB_CONNECTION_SERVER_TYPE
:

3997 ià(
mysql
)

3998 *((cÚ¡ **)
¬g
)ð
	`m¬Ÿdb_cÚÃùiÚ
(
mysql
) ? "MariaDB" : "MySQL";

4000 
”rÜ
;

4002 
MARIADB_CONNECTION_SERVER_VERSION_ID
:

4003 ià(
mysql
)

4004 *((
size_t
 *)
¬g
)ð
	`m¬Ÿdb_£rv”_v”siÚ_id
(
mysql
);

4006 
”rÜ
;

4008 
MARIADB_CONNECTION_PROTOCOL_VERSION_ID
:

4009 ià(
mysql
)

4010 *((*)
¬g
)ð
mysql
->
´ÙocÞ_v”siÚ
;

4012 
”rÜ
;

4014 
MARIADB_CONNECTION_MARIADB_CHARSET_INFO
:

4015 ià(
mysql
)

4016 
	`m¬Ÿdb_g‘_ch¬£t_šfo
(
mysql
, (
MY_CHARSET_INFO
 *)
¬g
);

4018 
”rÜ
;

4020 
MARIADB_CONNECTION_SOCKET
:

4021 ià(
mysql
)

4022 *((
my_sock‘
 *)
¬g
)ð
	`m¬Ÿdb_g‘_sock‘
(
mysql
);

4024 
”rÜ
;

4026 
MARIADB_CONNECTION_TYPE
:

4027 ià(
mysql
 && mysql->
Ãt
.
pvio
)

4028 *((*)
¬g
)ð()
mysql
->
Ãt
.
pvio
->
ty³
;

4030 
”rÜ
;

4032 
MARIADB_CONNECTION_ASYNC_TIMEOUT_MS
:

4033 ià(
mysql
 && mysql->
ÝtiÚs
.
ex‹nsiÚ
 && mysql->ÝtiÚs.ex‹nsiÚ->
async_cÚ‹xt
)

4034 *((*)
¬g
)ð
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
async_cÚ‹xt
->
timeout_v®ue
;

4036 
MARIADB_CONNECTION_ASYNC_TIMEOUT
:

4037 ià(
mysql
 && mysql->
ÝtiÚs
.
ex‹nsiÚ
 && mysql->ÝtiÚs.ex‹nsiÚ->
async_cÚ‹xt
)

4039 
timeout
ð
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
async_cÚ‹xt
->
timeout_v®ue
;

4040 ià(
timeout
 > 
UINT_MAX
 - 999)

4041 *((*)
¬g
)ð(
timeout
 - 1)/1000 + 1;

4043 *((*)
¬g
)ð(
timeout
+999)/1000;

4046 
MARIADB_CHARSET_NAME
:

4048 *
Çme
;

4049 
Çme
ð
	`va_¬g
(
­
, *);

4050 ià(
Çme
)

4051 *((
MARIADB_CHARSET_INFO
 **)
¬g
)ð(MARIADB_CHARSET_INFO *)
	`mysql_fšd_ch¬£t_Çme
(
Çme
);

4053 
”rÜ
;

4056 
MARIADB_CHARSET_ID
:

4058 
Ä
;

4059 
Ä
ð
	`va_¬g
(
­
, );

4060 *((
MARIADB_CHARSET_INFO
 **)
¬g
)ð(MARIADB_CHARSET_INFO *)
	`mysql_fšd_ch¬£t_Ä
(
Ä
);

4063 
MARIADB_CONNECTION_SSL_CIPHER
:

4064 #ifdeà
HAVE_TLS


4065 ià(
mysql
 && mysql->
Ãt
.
pvio
 && mysql->Ãt.pvio->
ùls
)

4066 *((**)
¬g
)ð(*)
	`ma_pvio_Žs_ch”
(
mysql
->
Ãt
.
pvio
->
ùls
);

4069 
”rÜ
;

4071 
MARIADB_CLIENT_ERRORS
:

4072 *((***)
¬g
)ð(**)
þ›Á_”rÜs
;

4074 
MARIADB_CONNECTION_INFO
:

4075 ià(
mysql
)

4076 *((**)
¬g
)ð(*)
mysql
->
šfo
;

4078 
”rÜ
;

4080 
MARIADB_CONNECTION_PVIO_TYPE
:

4081 ià(
mysql
 && mysql->
Ãt
.
pvio
)

4082 *((*)
¬g
)ð()
mysql
->
Ãt
.
pvio
->
ty³
;

4084 
”rÜ
;

4086 
MARIADB_CONNECTION_SCHEMA
:

4087 ià(
mysql
)

4088 *((**)
¬g
)ð
mysql
->
db
;

4090 
”rÜ
;

4092 
MARIADB_CONNECTION_USER
:

4093 ià(
mysql
)

4094 *((**)
¬g
)ð
mysql
->
u£r
;

4096 
”rÜ
;

4098 
MARIADB_CONNECTION_PORT
:

4099 ià(
mysql
)

4100 *((*)
¬g
)ð
mysql
->
pÜt
;

4102 
”rÜ
;

4104 
MARIADB_CONNECTION_UNIX_SOCKET
:

4105 ià(
mysql
)

4106 *((**)
¬g
)ð
mysql
->
unix_sock‘
;

4108 
”rÜ
;

4110 
MARIADB_CONNECTION_HOST
:

4111 ià(
mysql
)

4112 *((**)
¬g
)ð
mysql
->
ho¡
;

4114 
”rÜ
;

4116 
MARIADB_CONNECTION_SERVER_STATUS
:

4117 ià(
mysql
)

4118 *((*)
¬g
)ð
mysql
->
£rv”_¡©us
;

4120 
”rÜ
;

4122 
MARIADB_CONNECTION_SERVER_CAPABILITIES
:

4123 ià(
mysql
)

4124 *((*)
¬g
)ð
mysql
->
£rv”_ÿ·bž™›s
;

4126 
”rÜ
;

4128 
MARIADB_CONNECTION_EXTENDED_SERVER_CAPABILITIES
:

4129 ià(
mysql
)

4130 *((*)
¬g
)ð
mysql
->
ex‹nsiÚ
->
m¬Ÿdb_£rv”_ÿ·bž™›s
;

4132 
”rÜ
;

4134 
MARIADB_CONNECTION_CLIENT_CAPABILITIES
:

4135 ià(
mysql
)

4136 *((*)
¬g
)ð
mysql
->
þ›Á_æag
;

4138 
”rÜ
;

4141 
	`va_’d
(
­
);

4144 
	`va_’d
(
­
);

4146 
”rÜ
:

4147 
	`va_’d
(
­
);

4149 
	}
}

4151 
my_boÞ
 
STDCALL
 
	$m¬Ÿdb_g‘_šfo
(
MYSQL
 *
mysql
, 
m¬Ÿdb_v®ue
 
v®ue
, *
¬g
)

4153  
	`m¬Ÿdb_g‘_šfov
(
mysql
, 
v®ue
, 
¬g
);

4154 
	}
}

4162 
STDCALL
 
	$m¬Ÿdb_ÿnûl
(
MYSQL
 *
mysql
)

4164 ià(!
mysql
 || !mysql->
Ãt
.
pvio
 || !mysql->Ãt.pvio->
m‘hods
 || !mysql->Ãt.pvio->m‘hods->
shutdown
)

4170 
MARIADB_PVIO
 *
pvio
 = 
mysql
->
Ãt
.pvio;

4171  
pvio
->
m‘hods
->
	`shutdown
(pvio);

4173 
	}
}

4176 
STDCALL


4177 
mysql_debug
(cÚ¡ *
debug
 
__©Œibu‹__
((
unu£d
)))

4185 
ulÚg
 
STDCALL
 
	$mysql_Ãt_»ad_·ck‘
(
MYSQL
 *
mysql
)

4187  
	`ma_Ãt_§ã_»ad
(
mysql
);

4188 
	}
}

4190 
ulÚg
 
STDCALL
 
	$mysql_Ãt_f›ld_Ëngth
(
uch¬
 **
·ck‘
)

4192  
	`Ãt_f›ld_Ëngth
(
·ck‘
);

4193 
	}
}

4195 
my_boÞ
 
STDCALL
 
	$mysql_embedded
()

4197 #ifdeà
EMBEDDED_LIBRARY


4202 
	}
}

4204 
MYSQL_PARAMETERS
 *
STDCALL


4205 
	$mysql_g‘_·¿m‘”s
()

4207  &
m¬Ÿdb_š‹º®_·¿m‘”s
;

4208 
	}
}

4210 
STDCALL
 
	$mysql_»£t_cÚÃùiÚ
(
MYSQL
 *
mysql
)

4212 
rc
;

4215 ià(
	`IS_CONNHDLR_ACTIVE
(
mysql
))

4217 ià(
mysql
->
ex‹nsiÚ
->
cÚn_hdÌ
->
¶ugš
 && mysql->ex‹nsiÚ->cÚn_hdÌ->¶ugš->
»£t
)

4218 (
mysql
->
ex‹nsiÚ
->
cÚn_hdÌ
->
¶ugš
->
	`»£t
(mysql));

4222 ià(
mysql
->
¡©us
 =ð
MYSQL_STATUS_USE_RESULT
 ||

4223 
mysql
->
¡©us
 =ð
MYSQL_STATUS_GET_RESULT
 ||

4224 
mysql
->
¡©us
 & 
SERVER_MORE_RESULTS_EXIST
)

4226 
	`mthd_my_sk_»suÉ
(
mysql
);

4227 
mysql
->
¡©us
ð
MYSQL_STATUS_READY
;

4230 
rc
ð
	`ma_sim¶e_commªd
(
mysql
, 
COM_RESET_CONNECTION
, 0, 0, 0, 0);

4231 ià(
rc
 && 
mysql
->
ÝtiÚs
.
»cÚÃù
)

4234 
rc
ð
	`ma_sim¶e_commªd
(
mysql
, 
COM_RESET_CONNECTION
,0,0,0,0);

4236 ià(
rc
)

4240 
	`ma_šv®id©e_¡mts
(
mysql
, "mysql_reset_connection()");

4241 
	`ä“_Þd_qu”y
(
mysql
);

4242 
mysql
->
¡©us
ð
MYSQL_STATUS_READY
;

4243 
mysql
->
afãùed_rows
ð~(
my_ulÚglÚg
)0;

4244 
mysql
->
š£¹_id
= 0;

4246 
	}
}

4248 #undeà
STDCALL


4250 
¡_m¬Ÿdb_­i
 
	gMARIADB_API
=

4252 
mysql_num_rows
,

4253 
mysql_num_f›lds
,

4254 
mysql_eof
,

4255 
mysql_ãtch_f›ld_dœeù
,

4256 
mysql_ãtch_f›lds
,

4257 
mysql_row_‹Î
,

4258 
mysql_f›ld_‹Î
,

4259 
mysql_f›ld_couÁ
,

4260 
mysql_mÜe_»suÉs
,

4261 
mysql_Ãxt_»suÉ
,

4262 
mysql_afãùed_rows
,

4263 
mysql_autocomm™
,

4264 
mysql_comm™
,

4265 
mysql_rÞlback
,

4266 
mysql_š£¹_id
,

4267 
mysql_”ºo
,

4268 
mysql_”rÜ
,

4269 
mysql_šfo
,

4270 
mysql_th»ad_id
,

4271 
mysql_ch¬aù”_£t_Çme
,

4272 
mysql_g‘_ch¬aù”_£t_šfo
,

4273 
mysql_£t_ch¬aù”_£t
,

4274 
m¬Ÿdb_g‘_šfov
,

4275 
m¬Ÿdb_g‘_šfo
,

4276 
mysql_š™
,

4277 
mysql_s¦_£t
,

4278 
mysql_g‘_s¦_ch”
,

4279 
mysql_chªge_u£r
,

4280 
mysql_»®_cÚÃù
,

4281 
mysql_þo£
,

4282 
mysql_£Ëù_db
,

4283 
mysql_qu”y
,

4284 
mysql_£nd_qu”y
,

4285 
mysql_»ad_qu”y_»suÉ
,

4286 
mysql_»®_qu”y
,

4287 
mysql_shutdown
,

4288 
mysql_dump_debug_šfo
,

4289 
mysql_»äesh
,

4290 
mysql_kžl
,

4291 
mysql_pšg
,

4292 
mysql_¡©
,

4293 
mysql_g‘_£rv”_šfo
,

4294 
mysql_g‘_£rv”_v”siÚ
,

4295 
mysql_g‘_ho¡_šfo
,

4296 
mysql_g‘_´Ùo_šfo
,

4297 
mysql_li¡_dbs
,

4298 
mysql_li¡_bËs
,

4299 
mysql_li¡_f›lds
,

4300 
mysql_li¡_´oûs£s
,

4301 
mysql_¡Üe_»suÉ
,

4302 
mysql_u£_»suÉ
,

4303 
mysql_ÝtiÚs
,

4304 
mysql_ä“_»suÉ
,

4305 
mysql_d©a_£ek
,

4306 
mysql_row_£ek
,

4307 
mysql_f›ld_£ek
,

4308 
mysql_ãtch_row
,

4309 
mysql_ãtch_Ëngths
,

4310 
mysql_ãtch_f›ld
,

4311 
mysql_esÿ³_¡ršg
,

4312 
mysql_»®_esÿ³_¡ršg
,

4313 
mysql_th»ad_§ã
,

4314 
mysql_w¬nšg_couÁ
,

4315 
mysql_sql¡©e
,

4316 
mysql_£rv”_š™
,

4317 
mysql_£rv”_’d
,

4318 
mysql_th»ad_’d
,

4319 
mysql_th»ad_š™
,

4320 
mysql_£t_£rv”_ÝtiÚ
,

4321 
mysql_g‘_þ›Á_šfo
,

4322 
mysql_g‘_þ›Á_v”siÚ
,

4323 
m¬Ÿdb_cÚÃùiÚ
,

4324 
mysql_g‘_£rv”_Çme
,

4325 
m¬Ÿdb_g‘_ch¬£t_by_Çme
,

4326 
m¬Ÿdb_g‘_ch¬£t_by_Ä
,

4327 
m¬Ÿdb_cÚv”t_¡ršg
,

4328 
mysql_ÝtiÚsv
,

4329 
mysql_g‘_ÝtiÚv
,

4330 
mysql_g‘_ÝtiÚ
,

4331 
mysql_hex_¡ršg
,

4332 
mysql_g‘_sock‘
,

4333 
mysql_g‘_timeout_v®ue
,

4334 
mysql_g‘_timeout_v®ue_ms
,

4335 
m¬Ÿdb_»cÚÃù
,

4336 
mysql_¡mt_š™
,

4337 
mysql_¡mt_´•¬e
,

4338 
mysql_¡mt_execu‹
,

4339 
mysql_¡mt_ãtch
,

4340 
mysql_¡mt_ãtch_cÞumn
,

4341 
mysql_¡mt_¡Üe_»suÉ
,

4342 
mysql_¡mt_·¿m_couÁ
,

4343 
mysql_¡mt_©Œ_£t
,

4344 
mysql_¡mt_©Œ_g‘
,

4345 
mysql_¡mt_bšd_·¿m
,

4346 
mysql_¡mt_bšd_»suÉ
,

4347 
mysql_¡mt_þo£
,

4348 
mysql_¡mt_»£t
,

4349 
mysql_¡mt_ä“_»suÉ
,

4350 
mysql_¡mt_£nd_lÚg_d©a
,

4351 
mysql_¡mt_»suÉ_m‘ad©a
,

4352 
mysql_¡mt_·¿m_m‘ad©a
,

4353 
mysql_¡mt_”ºo
,

4354 
mysql_¡mt_”rÜ
,

4355 
mysql_¡mt_sql¡©e
,

4356 
mysql_¡mt_row_£ek
,

4357 
mysql_¡mt_row_‹Î
,

4358 
mysql_¡mt_d©a_£ek
,

4359 
mysql_¡mt_num_rows
,

4360 
mysql_¡mt_afãùed_rows
,

4361 
mysql_¡mt_š£¹_id
,

4362 
mysql_¡mt_f›ld_couÁ
,

4363 
mysql_¡mt_Ãxt_»suÉ
,

4364 
mysql_¡mt_mÜe_»suÉs
,

4365 
m¬Ÿdb_¡mt_execu‹_dœeù
,

4366 
mysql_»£t_cÚÃùiÚ


4374 
¡_m¬Ÿdb_m‘hods
 
	gMARIADB_DEFAULT_METHODS
 = {

4376 
mthd_my_»®_cÚÃù
,

4378 
mysql_þo£_¦ow_·¹
,

4380 
mthd_my_£nd_cmd
,

4382 
mthd_my_sk_»suÉ
,

4384 
mthd_my_»ad_qu”y_»suÉ
,

4386 
mthd_my_»ad_rows
,

4388 
mthd_my_»ad_Úe_row
,

4390 
mthd_suµÜ‹d_bufãr_ty³
,

4392 
mthd_¡mt_»ad_´•¬e_»¥Ú£
,

4394 
mthd_my_»ad_qu”y_»suÉ
,

4396 
mthd_¡mt_g‘_»suÉ_m‘ad©a
,

4398 
mthd_¡mt_g‘_·¿m_m‘ad©a
,

4400 
mthd_¡mt_»ad_®l_rows
,

4402 
mthd_¡mt_ãtch_row
,

4404 
mthd_¡mt_ãtch_to_bšd
,

4406 
mthd_¡mt_æush_unbufã»d
,

4408 
my_£t_”rÜ
,

4410 
ma_šv®id©e_¡mts
,

4412 &
MARIADB_API


	@libmariadb/mariadb_rpl.c

21 
	~<ma_glob®.h
>

22 
	~<ma_sys.h
>

23 
	~<mysql.h
>

24 
	~<”rmsg.h
>

25 
	~<¡dlib.h
>

26 
	~<¡ršg.h
>

27 
	~<¡d¬g.h
>

28 
	~<zlib.h
>

29 
	~<m¬Ÿdb_½l.h
>

31 
	$½l_®loc_¡ršg
(
MARIADB_RPL_EVENT
 *
ev’t
,

32 
MARIADB_STRING
 *
s
,

33 *
bufãr
,

34 
size_t
 
Ën
)

36 ià(!(
s
->
¡r
ð
	`ma_®loc_roÙ
(&
ev’t
->
memroÙ
, 
Ën
)))

38 
	`memýy
(
s
->
¡r
, 
bufãr
, 
Ën
);

39 
s
->
Ëngth
ð
Ën
;

41 
	}
}

43 
MARIADB_RPL
 * 
STDCALL
 
	$m¬Ÿdb_½l_š™_ex
(
MYSQL
 *
mysql
, 
v”siÚ
)

45 
MARIADB_RPL
 *
½l
;

47 ià(
v”siÚ
 < 
MARIADB_RPL_REQUIRED_VERSION
 ||

48 
v”siÚ
 > 
MARIADB_RPL_VERSION
)

50 
	`my_£t_”rÜ
(
mysql
, 
CR_VERSION_MISMATCH
, 
SQLSTATE_UNKNOWN
, 0, 
v”siÚ
,

51 
MARIADB_RPL_VERSION
, 
MARIADB_RPL_REQUIRED_VERSION
);

55 ià(!
mysql
)

56  
NULL
;

58 ià(!(
½l
ð(
MARIADB_RPL
 *)
	`ÿÎoc
(1, (MARIADB_RPL))))

60 
	`SET_CLIENT_ERROR
(
mysql
, 
CR_OUT_OF_MEMORY
, 
SQLSTATE_UNKNOWN
, 0);

63 
½l
->
v”siÚ
= version;

64 
½l
->
mysql
= mysql;

65  
½l
;

66 
	}
}

68 
STDCALL
 
	$m¬Ÿdb_ä“_½l_ev’t
(
MARIADB_RPL_EVENT
 *
ev’t
)

70 ià(
ev’t
)

72 
	`ma_ä“_roÙ
(&
ev’t
->
memroÙ
, 
	`MYF
(0));

73 
	`ä“
(
ev’t
);

75 
	}
}

77 
STDCALL
 
	$m¬Ÿdb_½l_Ý’
(
MARIADB_RPL
 *
½l
)

79 *
±r
, *
buf
;

80 ià(!
½l
 || !½l->
mysql
)

94 
±r
ð
buf
=

95 #ifdeà
WIN32


96 (*)
	`_®loÿ
(
½l
->
fž’ame_Ëngth
 + 11);

98 (*)
	`®loÿ
(
½l
->
fž’ame_Ëngth
 + 11);

101 
	`št4¡Üe
(
±r
, ()
½l
->
¡¬t_pos™iÚ
);

102 
±r
+= 4;

103 
	`št2¡Üe
(
±r
, 
½l
->
æags
);

104 
±r
+= 2;

105 
	`št4¡Üe
(
±r
, 
½l
->
£rv”_id
);

106 
±r
+= 4;

107 
	`memýy
(
±r
, 
½l
->
fž’ame
,„¶->
fž’ame_Ëngth
);

108 
±r
+ð
½l
->
fž’ame_Ëngth
;

110 ià(
	`ma_sim¶e_commªd
(
½l
->
mysql
, 
COM_BINLOG_DUMP
, (cÚ¡ *)
buf
, 
±r
 - buf, 1, 0))

113 
	}
}

115 
MARIADB_RPL_EVENT
 * 
STDCALL
 
	$m¬Ÿdb_½l_ãtch
(
MARIADB_RPL
 *
½l
, 
MARIADB_RPL_EVENT
 *
ev’t
)

117 *
ev
;

118 
size_t
 
Ën
;

119 
MARIADB_RPL_EVENT
 *
½l_ev’t
= 0;

121 ià(!
½l
 || !½l->
mysql
)

125 
pkt_Ën
ð
	`ma_Ãt_§ã_»ad
(
½l
->
mysql
);

127 ià(
pkt_Ën
 =ð
·ck‘_”rÜ
)

129 
½l
->
bufãr_size
= 0;

138 ià(
pkt_Ën
 < 9 && 
½l
->
mysql
->
Ãt
.
»ad_pos
[0] == 0xFE)

140 
½l
->
bufãr_size
= 0;

149 ià(
½l
->
æags
 & 
MARIADB_RPL_IGNORE_HEARTBEAT
)

151 ià(
½l
->
mysql
->
Ãt
.
»ad_pos
[1 + 4] =ð
HEARTBEAT_LOG_EVENT
)

155 
½l
->
bufãr_size
ð
pkt_Ën
;

156 
½l
->
bufãr
ð½l->
mysql
->
Ãt
.
»ad_pos
;

158 ià(
ev’t
)

160 
MA_MEM_ROOT
 
memroÙ
ð
ev’t
->memroot;

161 
½l_ev’t
ð
ev’t
;

162 
	`ma_ä“_roÙ
(&
memroÙ
, 
	`MYF
(
MY_KEEP_PREALLOC
));

163 
	`mem£t
(
½l_ev’t
, 0, (
MARIADB_RPL_EVENT
));

164 
½l_ev’t
->
memroÙ
= memroot;

166 ià(!(
½l_ev’t
 = (
MARIADB_RPL_EVENT
 *)
	`m®loc
((MARIADB_RPL_EVENT))))

167 
mem_”rÜ
;

168 
	`mem£t
(
½l_ev’t
, 0, (
MARIADB_RPL_EVENT
));

169 
	`ma_š™_®loc_roÙ
(&
½l_ev’t
->
memroÙ
, 8192, 0);

171 
½l_ev’t
->
checksum
ð
	`ušt4kÜr
(
½l
->
bufãr
 +„¶->
bufãr_size
 - 4);

173 
½l_ev’t
->
ok
ð
½l
->
bufãr
[0];

174 
½l_ev’t
->
time¡amp
ð
	`ušt4kÜr
(
½l
->
bufãr
 + 1);

175 
½l_ev’t
->
ev’t_ty³
ð()*(
½l
->
bufãr
 + 5);

176 
½l_ev’t
->
£rv”_id
ð
	`ušt4kÜr
(
½l
->
bufãr
 + 6);

177 
½l_ev’t
->
ev’t_Ëngth
ð
	`ušt4kÜr
(
½l
->
bufãr
 + 10);

178 
½l_ev’t
->
Ãxt_ev’t_pos
ð
	`ušt4kÜr
(
½l
->
bufãr
 + 14);

179 
½l_ev’t
->
æags
ð
	`ušt2kÜr
(
½l
->
bufãr
 + 18);

181 
ev
ð
½l
->
bufãr
 + 
EVENT_HEADER_OFS
;

183 ià(
½l
->
u£_checksum
)

185 
½l_ev’t
->
checksum
ð*(
ev
 +„¶_ev’t->
ev’t_Ëngth
 - 4);

186 
½l_ev’t
->
ev’t_Ëngth
-= 4;

189 
½l_ev’t
->
ev’t_ty³
) {

190 
HEARTBEAT_LOG_EVENT
:

191 
½l_ev’t
->
ev’t
.
h—¹b—t
.
time¡amp
ð
	`ušt4kÜr
(
ev
);

192 
ev
+= 4;

193 
½l_ev’t
->
ev’t
.
h—¹b—t
.
Ãxt_pos™iÚ
ð
	`ušt4kÜr
(
ev
);

194 
ev
+= 4;

195 
½l_ev’t
->
ev’t
.
h—¹b—t
.
ty³
ð(
ušt8_t
)*
ev
;

196 
ev
+= 1;

197 
½l_ev’t
->
ev’t
.
h—¹b—t
.
æags
ð
	`ušt2kÜr
(
ev
);

199 
BINLOG_CHECKPOINT_EVENT
:

200 
Ën
ð
	`ušt4kÜr
(
ev
);

201 
ev
+= 4;

202 ià(
	`½l_®loc_¡ršg
(
½l_ev’t
, &½l_ev’t->
ev’t
.
checkpošt
.
fž’ame
, 
ev
, 
Ën
))

203 
mem_”rÜ
;

205 
FORMAT_DESCRIPTION_EVENT
:

206 
½l_ev’t
->
ev’t
.
fÜm©_desütiÚ
.
fÜm©
 = 
	`ušt2kÜr
(
ev
);

207 
ev
+= 2;

208 
½l_ev’t
->
ev’t
.
fÜm©_desütiÚ
.
£rv”_v”siÚ
 = (*)(
ev
);

209 
ev
+= 50;

210 
½l_ev’t
->
ev’t
.
fÜm©_desütiÚ
.
time¡amp
ð
	`ušt4kÜr
(
ev
);

211 
ev
+= 4;

212 
½l
->
fd_h—d”_Ën
ð
½l_ev’t
->
ev’t
.
fÜm©_desütiÚ
.
h—d”_Ën
ð(
ušt8_t
)*
ev
;

213 
ev
ð
½l
->
bufãr
 +„¶->
bufãr_size
 - 5;

214 
½l
->
u£_checksum
ð*
ev
;

216 
QUERY_EVENT
:

218 
size_t
 
db_Ën
, 
¡©us_Ën
;

219 
½l_ev’t
->
ev’t
.
qu”y
.
th»ad_id
ð
	`ušt4kÜr
(
ev
);

220 
ev
+= 4;

221 
½l_ev’t
->
ev’t
.
qu”y
.
£cÚds
ð
	`ušt4kÜr
(
ev
);

222 
ev
+= 4;

223 
db_Ën
ð*
ev
;

224 
ev
++;

225 
½l_ev’t
->
ev’t
.
qu”y
.
”rÜÄ
ð
	`ušt2kÜr
(
ev
);

226 
ev
+= 2;

227 
¡©us_Ën
ð
	`ušt2kÜr
(
ev
);

228 
ev
+= 2;

229 ià(
	`½l_®loc_¡ršg
(
½l_ev’t
, &½l_ev’t->
ev’t
.
qu”y
.
¡©us
, 
ev
, 
¡©us_Ën
))

230 
mem_”rÜ
;

231 
ev
+ð
¡©us_Ën
;

233 ià(
	`½l_®loc_¡ršg
(
½l_ev’t
, &½l_ev’t->
ev’t
.
qu”y
.
d©aba£
, 
ev
, 
db_Ën
))

234 
mem_”rÜ
;

235 
ev
+ð
db_Ën
 + 1;

238 
Ën
ð(
size_t
)(
½l
->
bufãr
 +„¶->
bufãr_size
 - 
ev
 - 4);

239 ià(
	`½l_®loc_¡ršg
(
½l_ev’t
, &½l_ev’t->
ev’t
.
qu”y
.
¡©em’t
, 
ev
, 
Ën
))

240 
mem_”rÜ
;

243 
TABLE_MAP_EVENT
:

244 
½l_ev’t
->
ev’t
.
bË_m­
.
bË_id
ð
	`ušt6kÜr
(
ev
);

245 
ev
+= 8;

246 
Ën
ð*
ev
;

247 
ev
++;

248 ià(
	`½l_®loc_¡ršg
(
½l_ev’t
, &½l_ev’t->
ev’t
.
bË_m­
.
d©aba£
, 
ev
, 
Ën
))

249 
mem_”rÜ
;

250 
ev
+ð
Ën
 + 1;

251 
Ën
ð*
ev
;

252 
ev
++;

253 ià(
	`½l_®loc_¡ršg
(
½l_ev’t
, &½l_ev’t->
ev’t
.
bË_m­
.
bË
, 
ev
, 
Ën
))

254 
mem_”rÜ
;

255 
ev
+ð
Ën
 + 1;

256 
½l_ev’t
->
ev’t
.
bË_m­
.
cÞumn_couÁ
ð
	`mysql_Ãt_f›ld_Ëngth
(&
ev
);

257 
Ën
ð
½l_ev’t
->
ev’t
.
bË_m­
.
cÞumn_couÁ
;

258 ià(
	`½l_®loc_¡ršg
(
½l_ev’t
, &½l_ev’t->
ev’t
.
bË_m­
.
cÞumn_ty³s
, 
ev
, 
Ën
))

259 
mem_”rÜ
;

260 
ev
+ð
Ën
;

261 
Ën
ð
	`mysql_Ãt_f›ld_Ëngth
(&
ev
);

262 ià(
	`½l_®loc_¡ršg
(
½l_ev’t
, &½l_ev’t->
ev’t
.
bË_m­
.
m‘ad©a
, 
ev
, 
Ën
))

263 
mem_”rÜ
;

265 
RAND_EVENT
:

266 
½l_ev’t
->
ev’t
.
¿nd
.
fœ¡_£ed
ð
	`ušt8kÜr
(
ev
);

267 
ev
+= 8;

268 
½l_ev’t
->
ev’t
.
¿nd
.
£cÚd_£ed
ð
	`ušt8kÜr
(
ev
);

270 
INTVAR_EVENT
:

271 
½l_ev’t
->
ev’t
.
štv¬
.
ty³
ð*
ev
;

272 
ev
++;

273 
½l_ev’t
->
ev’t
.
štv¬
.
v®ue
ð
	`ušt8kÜr
(
ev
);

275 
USER_VAR_EVENT
:

276 
Ën
ð
	`ušt4kÜr
(
ev
);

277 
ev
+= 4;

278 ià(
	`½l_®loc_¡ršg
(
½l_ev’t
, &½l_ev’t->
ev’t
.
u£rv¬
.
Çme
, 
ev
, 
Ën
))

279 
mem_”rÜ
;

280 
ev
+ð
Ën
;

281 ià(!(
½l_ev’t
->
ev’t
.
u£rv¬
.
is_nuÎ
ð(
ušt8
)*
ev
))

283 
ev
++;

284 
½l_ev’t
->
ev’t
.
u£rv¬
.
ty³
ð*
ev
;

285 
ev
++;

286 
½l_ev’t
->
ev’t
.
u£rv¬
.
ch¬£t_Ä
ð
	`ušt4kÜr
(
ev
);

287 
ev
+= 4;

288 
Ën
ð
	`ušt4kÜr
(
ev
);

289 
ev
+= 4;

290 ià(
	`½l_®loc_¡ršg
(
½l_ev’t
, &½l_ev’t->
ev’t
.
u£rv¬
.
v®ue
, 
ev
, 
Ën
))

291 
mem_”rÜ
;

292 
ev
+ð
Ën
;

293 ià(()(
ev
 - 
½l
->
bufãr
è<„¶->
bufãr_size
)

294 
½l_ev’t
->
ev’t
.
u£rv¬
.
æags
ð*
ev
;

297 
START_ENCRYPTION_EVENT
:

298 
½l_ev’t
->
ev’t
.
’üy±iÚ
.
scheme
ð*
ev
;

299 
ev
++;

300 
½l_ev’t
->
ev’t
.
’üy±iÚ
.
key_v”siÚ
ð
	`ušt4kÜr
(
ev
);

301 
ev
+= 4;

302 
½l_ev’t
->
ev’t
.
’üy±iÚ
.
nÚû
ð(*)
ev
;

304 
ANNOTATE_ROWS_EVENT
:

305 
Ën
ð(
ušt32
)(
½l
->
bufãr
 +„¶->
bufãr_size
 - (*)
ev
 - 4);

306 ià(
	`½l_®loc_¡ršg
(
½l_ev’t
, &½l_ev’t->
ev’t
.
ªnÙ©e_rows
.
¡©em’t
, 
ev
, 
Ën
))

307 
mem_”rÜ
;

309 
ROTATE_EVENT
:

310 
½l_ev’t
->
ev’t
.
rÙ©e
.
pos™iÚ
ð
	`ušt8kÜr
(
ev
);

311 
ev
+= 8;

312 
Ën
ð
½l_ev’t
->
ev’t_Ëngth
 - 
½l
->
fd_h—d”_Ën
 - 8;

313 ià(
	`½l_®loc_¡ršg
(
½l_ev’t
, &½l_ev’t->
ev’t
.
rÙ©e
.
fž’ame
, 
ev
, 
Ën
))

314 
mem_”rÜ
;

316 
XID_EVENT
:

317 
½l_ev’t
->
ev’t
.
xid
.
Œª§ùiÚ_Ä
ð
	`ušt8kÜr
(
ev
);

319 
STOP_EVENT
:

322 
GTID_EVENT
:

323 
½l_ev’t
->
ev’t
.
gtid
.
£qu’û_Ä
ð
	`ušt8kÜr
(
ev
);

324 
ev
+= 8;

325 
½l_ev’t
->
ev’t
.
gtid
.
domaš_id
ð
	`ušt4kÜr
(
ev
);

326 
ev
+= 4;

327 
½l_ev’t
->
ev’t
.
gtid
.
æags
ð*
ev
;

328 
ev
++;

329 ià(
½l_ev’t
->
ev’t
.
gtid
.
æags
 & 
FL_GROUP_COMMIT_ID
)

330 
½l_ev’t
->
ev’t
.
gtid
.
comm™_id
ð
	`ušt8kÜr
(
ev
);

332 
GTID_LIST_EVENT
:

334 
ušt32
 
i
;

335 
½l_ev’t
->
ev’t
.
gtid_li¡
.
gtid_út
ð
	`ušt4kÜr
(
ev
);

336 
ev
++;

337 ià(!(
½l_ev’t
->
ev’t
.
gtid_li¡
.
gtid
ð(
MARIADB_GTID
 *)
	`ma_®loc_roÙ
(&½l_ev’t->
memroÙ
, (MARIADB_GTIDè*„¶_ev’t->ev’t.gtid_li¡.
gtid_út
)))

338 
mem_”rÜ
;

339 
i
=0; i < 
½l_ev’t
->
ev’t
.
gtid_li¡
.
gtid_út
; i++)

341 
½l_ev’t
->
ev’t
.
gtid_li¡
.
gtid
[
i
].
domaš_id
ð
	`ušt4kÜr
(
ev
);

342 
ev
+= 4;

343 
½l_ev’t
->
ev’t
.
gtid_li¡
.
gtid
[
i
].
£rv”_id
ð
	`ušt4kÜr
(
ev
);

344 
ev
+= 4;

345 
½l_ev’t
->
ev’t
.
gtid_li¡
.
gtid
[
i
].
£qu’û_Ä
ð
	`ušt8kÜr
(
ev
);

346 
ev
+= 8;

350 
WRITE_ROWS_EVENT_V1
:

351 
UPDATE_ROWS_EVENT_V1
:

352 
DELETE_ROWS_EVENT_V1
:

353 
½l_ev’t
->
ev’t
.
rows
.
ty³
ð½l_ev’t->
ev’t_ty³
 - 
WRITE_ROWS_EVENT_V1
;

354 ià(
½l
->
fd_h—d”_Ën
 == 6)

356 
½l_ev’t
->
ev’t
.
rows
.
bË_id
ð
	`ušt4kÜr
(
ev
);

357 
ev
+= 4;

359 
½l_ev’t
->
ev’t
.
rows
.
bË_id
ð
	`ušt6kÜr
(
ev
);

360 
ev
+= 6;

362 
½l_ev’t
->
ev’t
.
rows
.
æags
ð
	`ušt2kÜr
(
ev
);

363 
ev
+= 2;

364 
Ën
ð
½l_ev’t
->
ev’t
.
rows
.
cÞumn_couÁ
ð
	`mysql_Ãt_f›ld_Ëngth
(&
ev
);

365 ià(!
Ën
)

367 ià(!(
½l_ev’t
->
ev’t
.
rows
.
cÞumn_b™m­
 =

368 (*)
	`ma_®loc_roÙ
(&
½l_ev’t
->
memroÙ
, (
Ën
 + 7) / 8)))

369 
mem_”rÜ
;

370 
	`memýy
(
½l_ev’t
->
ev’t
.
rows
.
cÞumn_b™m­
, 
ev
, (
Ën
 + 7) / 8);

371 
ev
+ð(
Ën
 + 7) / 8;

372 ià(
½l_ev’t
->
ev’t_ty³
 =ð
UPDATE_ROWS_EVENT_V1
)

374 ià(!(
½l_ev’t
->
ev’t
.
rows
.
cÞumn_upd©e_b™m­
 =

375 (*)
	`ma_®loc_roÙ
(&
½l_ev’t
->
memroÙ
, (
Ën
 + 7) / 8)))

376 
mem_”rÜ
;

377 
	`memýy
(
½l_ev’t
->
ev’t
.
rows
.
cÞumn_upd©e_b™m­
, 
ev
, (
Ën
 + 7) / 8);

378 
ev
+ð(
Ën
 + 7) / 8;

380 
Ën
ð(
½l
->
bufãr
 + 
½l_ev’t
->
ev’t_Ëngth
 + 
EVENT_HEADER_OFS
 -„¶->
fd_h—d”_Ën
è- 
ev
;

381 ià((
½l_ev’t
->
ev’t
.
rows
.
row_d©a_size
ð
Ën
))

383 ià(!(
½l_ev’t
->
ev’t
.
rows
.
row_d©a
 =

384 (*)
	`ma_®loc_roÙ
(&
½l_ev’t
->
memroÙ
,„¶_ev’t->
ev’t
.
rows
.
row_d©a_size
)))

385 
mem_”rÜ
;

386 
	`memýy
(
½l_ev’t
->
ev’t
.
rows
.
row_d©a
, 
ev
,„¶_ev’t->ev’t.rows.
row_d©a_size
);

390 
	`ä“
(
½l_ev’t
);

391  
NULL
;

394  
½l_ev’t
;

396 
mem_”rÜ
:

397 
	`ä“
(
½l_ev’t
);

398 
	`SET_CLIENT_ERROR
(
½l
->
mysql
, 
CR_OUT_OF_MEMORY
, 
SQLSTATE_UNKNOWN
, 0);

400 
	}
}

402 
STDCALL
 
	$m¬Ÿdb_½l_þo£
(
MARIADB_RPL
 *
½l
)

404 ià(!
½l
)

406 ià(
½l
->
fž’ame
)

407 
	`ä“
((*)
½l
->
fž’ame
);

408 
	`ä“
(
½l
);

410 
	}
}

412 
	$m¬Ÿdb_½l_ÝtiÚsv
(
MARIADB_RPL
 *
½l
,

413 
m¬Ÿdb_½l_ÝtiÚ
 
ÝtiÚ
,

416 
va_li¡
 
­
;

417 
rc
= 0;

419 ià(!
½l
)

422 
	`va_¡¬t
(
­
, 
ÝtiÚ
);

424 
ÝtiÚ
) {

425 
MARIADB_RPL_FILENAME
:

427 *
¬g1
ð
	`va_¬g
(
­
, *);

428 
½l
->
fž’ame_Ëngth
ð(
ušt32_t
)
	`va_¬g
(
­
, 
size_t
);

429 
	`ä“
((*)
½l
->
fž’ame
);

430 
½l
->
fž’ame
ð
NULL
;

431 ià(
½l
->
fž’ame_Ëngth
)

433 
½l
->
fž’ame
ð(*)
	`m®loc
Ô¶->
fž’ame_Ëngth
);

434 
	`memýy
((*)
½l
->
fž’ame
, 
¬g1
,„¶->
fž’ame_Ëngth
);

436 ià(
¬g1
)

438 
½l
->
fž’ame
ð
	`¡rdup
((cÚ¡ *)
¬g1
);

439 
½l
->
fž’ame_Ëngth
ð(
ušt32_t
)
	`¡¾’
Ô¶->
fž’ame
);

443 
MARIADB_RPL_SERVER_ID
:

445 
½l
->
£rv”_id
ð
	`va_¬g
(
­
, );

448 
MARIADB_RPL_FLAGS
:

450 
½l
->
æags
ð
	`va_¬g
(
­
, );

453 
MARIADB_RPL_START
:

455 
½l
->
¡¬t_pos™iÚ
ð
	`va_¬g
(
­
, );

459 
rc
= -1;

460 
’d
;

462 
’d
:

463 
	`va_’d
(
­
);

464  
rc
;

465 
	}
}

467 
	$m¬Ÿdb_½l_g‘_ÝtiÚsv
(
MARIADB_RPL
 *
½l
,

468 
m¬Ÿdb_½l_ÝtiÚ
 
ÝtiÚ
,

471 
va_li¡
 
­
;

473 ià(!
½l
)

476 
	`va_¡¬t
(
­
, 
ÝtiÚ
);

478 
ÝtiÚ
) {

479 
MARIADB_RPL_FILENAME
:

481 cÚ¡ **
Çme
ð(cÚ¡ **)
	`va_¬g
(
­
, **);

482 
size_t
 *
Ën
ð(size_t*)
	`va_¬g
(
­
, size_t *);

484 *
Çme
ð
½l
->
fž’ame
;

485 *
Ën
ð
½l
->
fž’ame_Ëngth
;

488 
MARIADB_RPL_SERVER_ID
:

490 *
id
ð
	`va_¬g
(
­
, *);

491 *
id
ð
½l
->
£rv”_id
;

494 
MARIADB_RPL_FLAGS
:

496 *
æags
ð
	`va_¬g
(
­
, *);

497 *
æags
ð
½l
->flags;

500 
MARIADB_RPL_START
:

502 *
¡¬t
ð
	`va_¬g
(
­
, *);

503 *
¡¬t
ð
½l
->
¡¬t_pos™iÚ
;

507 
	`va_’d
(
­
);

511 
	`va_’d
(
­
);

513 
	}
}

	@libmariadb/mariadb_stmt.c

46 
	~"ma_glob®.h
"

47 
	~<ma_sys.h
>

48 
	~<ma_¡ršg.h
>

49 
	~<m¬Ÿdb_ùy³.h
>

50 
	~"mysql.h
"

51 
	~"”rmsg.h
"

52 
	~<ma_pvio.h
>

53 
	~<sys/¡©.h
>

54 
	~<sigÇl.h
>

55 
	~<time.h
>

56 
	~<mysql/þ›Á_¶ugš.h
>

57 
	~<ma_commÚ.h
>

58 
	~"ma_´iv.h
"

61 
	#UPDATE_STMT_ERROR
(
¡mt
)\

62 
	`SET_CLIENT_STMT_ERROR
((
¡mt
), (¡mt)->
mysql
->
Ãt
.
Ï¡_”ºo
, (¡mt)->mysql->Ãt.
sql¡©e
, (¡mt)->mysql->Ãt.
Ï¡_”rÜ
)

	)

64 
	#STMT_NUM_OFS
(
ty³
, 
a
, 
r
è((Ñy³ *)×))[r])

	)

65 
	#MADB_RESET_ERROR
 1

	)

66 
	#MADB_RESET_LONGDATA
 2

	)

67 
	#MADB_RESET_SERVER
 4

	)

68 
	#MADB_RESET_BUFFER
 8

	)

69 
	#MADB_RESET_STORED
 16

	)

71 
	#MAX_TIME_STR_LEN
 13

	)

72 
	#MAX_DATE_STR_LEN
 5

	)

73 
	#MAX_DATETIME_STR_LEN
 12

	)

75 
	#MAX_DATE_REP_LENGTH
 5

	)

76 
	#MAX_TIME_REP_LENGTH
 13

	)

77 
	#MAX_DATETIME_REP_LENGTH
 12

	)

78 
	#MAX_ORACLE_TIMESTAMP_REP_LENGTH
 13

	)

79 
	#MAX_DOUBLE_STRING_REP_LENGTH
 331

	)

83 
MA_MEM_ROOT
 
	mf›lds_ma_®loc_roÙ
;

84 } 
	tMADB_STMT_EXTENSION
;

86 
my_boÞ
 
Ãt_¡mt_þo£
(
MYSQL_STMT
 *
¡mt
, my_boÞ 
»move
);

88 
my_boÞ
 
	gis_nÙ_nuÎ
= 0;

89 
my_boÞ
 
	gis_nuÎ
= 1;

91 
	$¡mt_£t_”rÜ
(
MYSQL_STMT
 *
¡mt
,

92 
”rÜ_Ä
,

93 cÚ¡ *
sql¡©e
,

94 cÚ¡ *
fÜm©
,

97 
va_li¡
 
­
;

98 cÚ¡ *
”rÜ
ð
NULL
;

100 ià(
”rÜ_Ä
 >ð
CR_MIN_ERROR
 &&ƒ¼Ü_Ä <ð
CR_MYSQL_LAST_ERROR
)

101 
”rÜ
ð
	`ER
(
”rÜ_Ä
);

102 ià(
”rÜ_Ä
 >ð
CER_MIN_ERROR
 &&ƒ¼Ü_Ä <ð
CR_MARIADB_LAST_ERROR
)

103 
”rÜ
ð
	`CER
(
”rÜ_Ä
);

105 
¡mt
->
Ï¡_”ºo
ð
”rÜ_Ä
;

106 
	`ma_¡rmake
(
¡mt
->
sql¡©e
, sql¡©e, 
SQLSTATE_LENGTH
);

107 
	`va_¡¬t
(
­
, 
fÜm©
);

108 
	`v¢´štf
(
¡mt
->
Ï¡_”rÜ
, 
MYSQL_ERRMSG_SIZE
,

109 
fÜm©
 ? fÜm© : 
”rÜ
 ?ƒ¼Ü : "", 
­
);

110 
	`va_’d
(
­
);

112 
	}
}

114 
my_boÞ
 
	$mthd_suµÜ‹d_bufãr_ty³
(
’um_f›ld_ty³s
 
ty³
)

116 
ty³
) {

117 
MYSQL_TYPE_BIT
:

118 
MYSQL_TYPE_BLOB
:

119 
MYSQL_TYPE_DATE
:

120 
MYSQL_TYPE_DATETIME
:

121 
MYSQL_TYPE_DECIMAL
:

122 
MYSQL_TYPE_DOUBLE
:

123 
MYSQL_TYPE_FLOAT
:

124 
MYSQL_TYPE_GEOMETRY
:

125 
MYSQL_TYPE_INT24
:

126 
MYSQL_TYPE_LONG
:

127 
MYSQL_TYPE_LONG_BLOB
:

128 
MYSQL_TYPE_LONGLONG
:

129 
MYSQL_TYPE_MEDIUM_BLOB
:

130 
MYSQL_TYPE_NEWDATE
:

131 
MYSQL_TYPE_NEWDECIMAL
:

132 
MYSQL_TYPE_NULL
:

133 
MYSQL_TYPE_SHORT
:

134 
MYSQL_TYPE_STRING
:

135 
MYSQL_TYPE_JSON
:

136 
MYSQL_TYPE_TIME
:

137 
MYSQL_TYPE_TIMESTAMP
:

138 
MYSQL_TYPE_TINY
:

139 
MYSQL_TYPE_TINY_BLOB
:

140 
MYSQL_TYPE_VAR_STRING
:

141 
MYSQL_TYPE_YEAR
:

148 
	}
}

150 
my_boÞ
 
madb_»£t_¡mt
(
MYSQL_STMT
 *
¡mt
, 
æags
);

151 
my_boÞ
 
mysql_¡mt_š‹º®_»£t
(
MYSQL_STMT
 *
¡mt
, my_boÞ 
is_þo£
);

152 
¡mt_unbufã»d_eof
(
MYSQL_STMT
 *
¡mt
 
__©Œibu‹__
((
unu£d
)),

153 
uch¬
 **
row
 
__©Œibu‹__
((
unu£d
)))

155  
	gMYSQL_NO_DATA
;

158 
ušt
 
	$mysql_¡Üe_Ëngth_size
(
ulÚglÚg
 
num
)

160 ià(
num
 < (
ulÚglÚg
) 251LL)

162 ià(
num
 < (
ulÚglÚg
) 65536LL)

164 ià(
num
 < (
ulÚglÚg
) 16777216LL)

167 
	}
}

169 
	$¡mt_unbufã»d_ãtch
(
MYSQL_STMT
 *
¡mt
, 
uch¬
 **
row
)

171 
ulÚg
 
pkt_Ën
;

173 
pkt_Ën
ð
	`ma_Ãt_§ã_»ad
(
¡mt
->
mysql
);

175 ià(
pkt_Ën
 =ð
·ck‘_”rÜ
)

177 
¡mt
->
ãtch_row_func
ð
¡mt_unbufã»d_eof
;

181 ià(
¡mt
->
mysql
->
Ãt
.
»ad_pos
[0] == 254)

183 *
row
 = 
NULL
;

184 
¡mt
->
ãtch_row_func
ð
¡mt_unbufã»d_eof
;

185 (
MYSQL_NO_DATA
);

188 *
row
 = 
¡mt
->
mysql
->
Ãt
.
»ad_pos
;

189 
¡mt
->
»suÉ
.
rows
++;

191 
	}
}

193 
	$¡mt_bufã»d_ãtch
(
MYSQL_STMT
 *
¡mt
, 
uch¬
 **
row
)

195 ià(!
¡mt
->
»suÉ_cursÜ
)

197 *
row
ð
NULL
;

198 
¡mt
->
¡©e
ð
MYSQL_STMT_FETCH_DONE
;

199  
MYSQL_NO_DATA
;

201 
¡mt
->
¡©e
ð
MYSQL_STMT_USER_FETCHING
;

202 *
row
ð(
uch¬
 *)
¡mt
->
»suÉ_cursÜ
->
d©a
;

204 
¡mt
->
»suÉ_cursÜ
ð¡mt->»suÉ_cursÜ->
Ãxt
;

206 
	}
}

208 
	$mthd_¡mt_»ad_®l_rows
(
MYSQL_STMT
 *
¡mt
)

210 
MYSQL_DATA
 *
»suÉ
ð&
¡mt
->result;

211 
MYSQL_ROWS
 *
cu¼’t
, **
µ»vious
;

212 
ulÚg
 
·ck‘_Ën
;

213 *
p
;

215 
µ»vious
ð&
»suÉ
->
d©a
;

217 (
·ck‘_Ën
 = 
	`ma_Ãt_§ã_»ad
(
¡mt
->
mysql
)è!ð
·ck‘_”rÜ
)

219 
p
ð
¡mt
->
mysql
->
Ãt
.
»ad_pos
;

220 ià(
·ck‘_Ën
 > 7 || 
p
[0] != 254)

223 ià(!(
cu¼’t
ð(
MYSQL_ROWS
 *)
	`ma_®loc_roÙ
(&
»suÉ
->
®loc
, (MYSQL_ROWSè+ 
·ck‘_Ën
)))

225 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
CR_OUT_OF_MEMORY
, 
SQLSTATE_UNKNOWN
, 0);

228 
cu¼’t
->
d©a
ð(
MYSQL_ROW
)(current + 1);

229 *
µ»vious
ð
cu¼’t
;

230 
µ»vious
ð&
cu¼’t
->
Ãxt
;

233 
	`memýy
((*)
cu¼’t
->
d©a
, (*)
p
, 
·ck‘_Ën
);

235 ià(
¡mt
->
upd©e_max_Ëngth
)

237 
uch¬
 *
nuÎ_±r
, 
b™_off£t
= 4;

238 
uch¬
 *
ý
ð
p
;

239 
i
;

241 
ý
++;

242 
nuÎ_±r
ð
ý
;

243 
ý
+ð(
¡mt
->
f›ld_couÁ
 + 9) / 8;

245 
i
=0; i < 
¡mt
->
f›ld_couÁ
; i++)

247 ià(!(*
nuÎ_±r
 & 
b™_off£t
))

249 ià(
mysql_ps_ãtch_funùiÚs
[
¡mt
->
f›lds
[
i
].
ty³
].
·ck_Ën
 < 0)

252 
size_t
 
Ën
ð
	`Ãt_f›ld_Ëngth
(&
ý
);

253 
¡mt
->
f›lds
[
i
].
ty³
) {

254 
MYSQL_TYPE_TIME
:

255 
MYSQL_TYPE_DATE
:

256 
MYSQL_TYPE_DATETIME
:

257 
MYSQL_TYPE_TIMESTAMP
:

258 
¡mt
->
f›lds
[
i
].
max_Ëngth
ð
mysql_ps_ãtch_funùiÚs
[¡mt->f›lds[i].
ty³
].
max_Ën
;

261 ià(
Ën
 > 
¡mt
->
f›lds
[
i
].
max_Ëngth
)

262 
¡mt
->
f›lds
[
i
].
max_Ëngth
ð(
ulÚg
)
Ën
;

265 
ý
+ð
Ën
;

269 ià(
¡mt
->
f›lds
[
i
].
æags
 & 
ZEROFILL_FLAG
)

271 
size_t
 
Ën
ð
	`MAX
(
¡mt
->
f›lds
[
i
].
Ëngth
, 
mysql_ps_ãtch_funùiÚs
[¡mt->f›lds[i].
ty³
].
max_Ën
);

272 ià(
Ën
 > 
¡mt
->
f›lds
[
i
].
max_Ëngth
)

273 
¡mt
->
f›lds
[
i
].
max_Ëngth
ð()
Ën
;

275 ià(!
¡mt
->
f›lds
[
i
].
max_Ëngth
)

277 
¡mt
->
f›lds
[
i
].
max_Ëngth
ð
mysql_ps_ãtch_funùiÚs
[¡mt->f›lds[i].
ty³
].
max_Ën
;

279 
ý
+ð
mysql_ps_ãtch_funùiÚs
[
¡mt
->
f›lds
[
i
].
ty³
].
·ck_Ën
;

282 ià(!((
b™_off£t
 <<=1) & 255))

284 
b™_off£t
= 1;

285 
nuÎ_±r
++;

289 
cu¼’t
->
Ëngth
ð
·ck‘_Ën
;

290 
»suÉ
->
rows
++;

293 *
µ»vious
= 0;

295 
p
++;

296 
¡mt
->
up£¹_¡©us
.
w¬nšg_couÁ
ð¡mt->
mysql
->w¬nšg_couÁð
	`ušt2kÜr
(
p
);

297 
p
+=2;

298 
¡mt
->
up£¹_¡©us
.
£rv”_¡©us
ð¡mt->
mysql
->£rv”_¡©usð
	`ušt2kÜr
(
p
);

299 
¡mt
->
»suÉ_cursÜ
ð
»suÉ
->
d©a
;

303 
¡mt
->
»suÉ_cursÜ
= 0;

304 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, stmt->
mysql
->
Ãt
.
Ï¡_”ºo
, stmt->mysql->Ãt.
sql¡©e
,

305 
¡mt
->
mysql
->
Ãt
.
Ï¡_”rÜ
);

307 
	}
}

309 
	$¡mt_cursÜ_ãtch
(
MYSQL_STMT
 *
¡mt
, 
uch¬
 **
row
)

311 
uch¬
 
buf
[
STMT_ID_LENGTH
 + 4];

312 
MYSQL_DATA
 *
»suÉ
ð&
¡mt
->result;

314 ià(
¡mt
->
¡©e
 < 
MYSQL_STMT_USE_OR_STORE_CALLED
)

316 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
CR_COMMANDS_OUT_OF_SYNC
, 
SQLSTATE_UNKNOWN
, 0);

321 ià(
¡mt
->
»suÉ_cursÜ
)

322 (
	`¡mt_bufã»d_ãtch
(
¡mt
, 
row
));

323 ià(
¡mt
->
up£¹_¡©us
.
£rv”_¡©us
 & 
SERVER_STATUS_LAST_ROW_SENT
)

324 
¡mt
->
up£¹_¡©us
.
£rv”_¡©us
&ð~
SERVER_STATUS_LAST_ROW_SENT
;

327 
	`št4¡Üe
(
buf
, 
¡mt
->
¡mt_id
);

328 
	`št4¡Üe
(
buf
 + 
STMT_ID_LENGTH
, 
¡mt
->
´eãtch_rows
);

330 ià(
¡mt
->
mysql
->
m‘hods
->
	`db_commªd
(¡mt->mysql, 
COM_STMT_FETCH
, (*)
buf
, (buf), 1, stmt))

332 
	`UPDATE_STMT_ERROR
(
¡mt
);

337 
	`ma_ä“_roÙ
(&
»suÉ
->
®loc
, 
	`MYF
(
MY_KEEP_PREALLOC
));

338 
»suÉ
->
d©a
= 0;

339 
»suÉ
->
rows
= 0;

341 ià(
¡mt
->
mysql
->
m‘hods
->
	`db_¡mt_»ad_®l_rows
(stmt))

344 (
	`¡mt_bufã»d_ãtch
(
¡mt
, 
row
));

347 *
row
ð
NULL
;

348 (
MYSQL_NO_DATA
);

349 
	}
}

352 
	$mthd_¡mt_æush_unbufã»d
(
MYSQL_STMT
 *
¡mt
)

354 
ulÚg
 
·ck‘_Ën
;

355 
š_»suÉ£t
ð
¡mt
->
¡©e
 > 
MYSQL_STMT_EXECUTED
 &&

356 
¡mt
->
¡©e
 < 
MYSQL_STMT_FETCH_DONE
;

357 (
·ck‘_Ën
 = 
	`ma_Ãt_§ã_»ad
(
¡mt
->
mysql
)è!ð
·ck‘_”rÜ
)

359 
uch¬
 *
pos
ð
¡mt
->
mysql
->
Ãt
.
»ad_pos
;

360 ià(!
š_»suÉ£t
 && *
pos
 == 0)

362 
pos
++;

363 
	`Ãt_f›ld_Ëngth
(&
pos
);

364 
	`Ãt_f›ld_Ëngth
(&
pos
);

365 
¡mt
->
mysql
->
£rv”_¡©us
ð
	`ušt2kÜr
(
pos
);

366 
’d
;

368 ià(
·ck‘_Ën
 < 8 && *
pos
 == 254)

370 ià(
	`m¬Ÿdb_cÚÃùiÚ
(
¡mt
->
mysql
))

372 
¡mt
->
mysql
->
£rv”_¡©us
ð
	`ušt2kÜr
(
pos
 + 3);

373 ià(
š_»suÉ£t
)

374 
’d
;

375 
š_»suÉ£t
= 1;

378 
’d
;

381 
’d
:

382 
¡mt
->
¡©e
ð
MYSQL_STMT_FETCH_DONE
;

383 
	}
}

385 
	$mthd_¡mt_ãtch_to_bšd
(
MYSQL_STMT
 *
¡mt
, *
row
)

387 
ušt
 
i
;

388 
size_t
 
ŒunÿtiÚs
= 0;

389 *
nuÎ_±r
, 
b™_off£t
= 4;

390 
row
++;

391 
nuÎ_±r
ð
row
;

392 
row
+ð(
¡mt
->
f›ld_couÁ
 + 9) / 8;

394 
i
=0; i < 
¡mt
->
f›ld_couÁ
; i++)

397 ià(*
nuÎ_±r
 & 
b™_off£t
)

399 ià(
¡mt
->
»suÉ_ÿÎback
)

400 
¡mt
->
	`»suÉ_ÿÎback
(¡mt->
u£r_d©a
, 
i
, 
NULL
);

403 ià(!
¡mt
->
bšd
[
i
].
is_nuÎ
)

404 
¡mt
->
bšd
[
i
].
is_nuÎ
ð&¡mt->bšd[i].
is_nuÎ_v®ue
;

405 *
¡mt
->
bšd
[
i
].
is_nuÎ
= 1;

406 
¡mt
->
bšd
[
i
].
u
.
row_±r
ð
NULL
;

410 
¡mt
->
bšd
[
i
].
u
.
row_±r
ð
row
;

411 ià(!
¡mt
->
bšd_»suÉ_dÚe
 ||

412 
¡mt
->
bšd
[
i
].
æags
 & 
MADB_BIND_DUMMY
)

414 
Ëngth
;

416 ià(
¡mt
->
»suÉ_ÿÎback
)

417 
¡mt
->
	`»suÉ_ÿÎback
(¡mt->
u£r_d©a
, 
i
, &
row
);

419 ià(
mysql_ps_ãtch_funùiÚs
[
¡mt
->
f›lds
[
i
].
ty³
].
·ck_Ën
 >= 0)

420 
Ëngth
ð
mysql_ps_ãtch_funùiÚs
[
¡mt
->
f›lds
[
i
].
ty³
].
·ck_Ën
;

422 
Ëngth
ð
	`Ãt_f›ld_Ëngth
(&
row
);

423 
row
+ð
Ëngth
;

424 ià(!
¡mt
->
bšd
[
i
].
Ëngth
)

425 
¡mt
->
bšd
[
i
].
Ëngth
ð&¡mt->bšd[i].
Ëngth_v®ue
;

426 *
¡mt
->
bšd
[
i
].
Ëngth
ð¡mt->bšd[i].
Ëngth_v®ue
=†ength;

431 ià(!
¡mt
->
bšd
[
i
].
Ëngth
)

432 
¡mt
->
bšd
[
i
].
Ëngth
ð&¡mt->bšd[i].
Ëngth_v®ue
;

433 ià(!
¡mt
->
bšd
[
i
].
is_nuÎ
)

434 
¡mt
->
bšd
[
i
].
is_nuÎ
ð&¡mt->bšd[i].
is_nuÎ_v®ue
;

435 *
¡mt
->
bšd
[
i
].
is_nuÎ
= 0;

436 
mysql_ps_ãtch_funùiÚs
[
¡mt
->
f›lds
[
i
].
ty³
].
	`func
(&¡mt->
bšd
[i], &¡mt->f›lds[i], &
row
);

437 ià(
¡mt
->
mysql
->
ÝtiÚs
.
»pÜt_d©a_ŒunÿtiÚ
)

438 
ŒunÿtiÚs
+ð*
¡mt
->
bšd
[
i
].
”rÜ
;

442 ià(!((
b™_off£t
 <<=1) & 255)) {

443 
b™_off£t
= 1;

444 
nuÎ_±r
++;

447 ((
ŒunÿtiÚs
è? 
MYSQL_DATA_TRUNCATED
 : 0);

448 
	}
}

450 
MYSQL_RES
 *
	$_mysql_¡mt_u£_»suÉ
(
MYSQL_STMT
 *
¡mt
)

452 
MYSQL
 *
mysql
ð
¡mt
->mysql;

454 ià(!
¡mt
->
f›ld_couÁ
 ||

455 (!
¡mt
->
cursÜ_exi¡s
 && 
mysql
->
¡©us
 !ð
MYSQL_STATUS_STMT_RESULT
) ||

456 (
¡mt
->
cursÜ_exi¡s
 && 
mysql
->
¡©us
 !ð
MYSQL_STATUS_READY
) ||

457 (
¡mt
->
¡©e
 !ð
MYSQL_STMT_WAITING_USE_OR_STORE
))

459 
	`SET_CLIENT_ERROR
(
mysql
, 
CR_COMMANDS_OUT_OF_SYNC
, 
SQLSTATE_UNKNOWN
, 0);

460 (
NULL
);

463 
	`CLEAR_CLIENT_STMT_ERROR
(
¡mt
);

465 
¡mt
->
¡©e
 = 
MYSQL_STMT_USE_OR_STORE_CALLED
;

466 ià(!
¡mt
->
cursÜ_exi¡s
)

467 
¡mt
->
ãtch_row_func
ð
¡mt_unbufã»d_ãtch
;

469 
¡mt
->
ãtch_row_func
ð
¡mt_cursÜ_ãtch
;

471 (
NULL
);

472 
	}
}

474 *
	$mysql_Ãt_¡Üe_Ëngth
(*
·ck‘
, 
size_t
 
Ëngth
)

476 ià(
Ëngth
 < (è
	`L64
(251)) {

477 *
·ck‘
 = (è
Ëngth
;

478  
·ck‘
 + 1;

481 ià(
Ëngth
 < (è
	`L64
(65536)) {

482 *
·ck‘
++ = 252;

483 
	`št2¡Üe
(
·ck‘
,(
ušt
è
Ëngth
);

484  
·ck‘
 + 2;

487 ià(
Ëngth
 < (è
	`L64
(16777216)) {

488 *
·ck‘
++ = 253;

489 
	`št3¡Üe
(
·ck‘
,(
ulÚg
è
Ëngth
);

490  
·ck‘
 + 3;

492 *
·ck‘
++ = 254;

493 
	`št8¡Üe
(
·ck‘
, 
Ëngth
);

494  
·ck‘
 + 8;

495 
	}
}

497 
	$ma_g‘_Ëngth
(
MYSQL_STMT
 *
¡mt
, 
·¿m_Ä
, 
row_Ä
)

499 ià(!
¡mt
->
·¿ms
[
·¿m_Ä
].
Ëngth
)

501 ià(
¡mt
->
·¿m_ÿÎback
)

502  ()*
¡mt
->
·¿ms
[
·¿m_Ä
].
Ëngth
;

503 ià(
¡mt
->
row_size
)

504  *(*)((*)
¡mt
->
·¿ms
[
·¿m_Ä
].
Ëngth
 + 
row_Ä
 * stmt->
row_size
);

506  
¡mt
->
·¿ms
[
·¿m_Ä
].
Ëngth
[
row_Ä
];

507 
	}
}

509 sigÃd 
	$ma_g‘_šdiÿtÜ
(
MYSQL_STMT
 *
¡mt
, 
·¿m_Ä
, 
row_Ä
)

511 ià(!
	`MARIADB_STMT_BULK_SUPPORTED
(
¡mt
) ||

512 !
¡mt
->
¬¿y_size
 ||

513 !
¡mt
->
·¿ms
[
·¿m_Ä
].
u
.
šdiÿtÜ
)

515 ià(
¡mt
->
·¿m_ÿÎback
)

516  *
¡mt
->
·¿ms
[
·¿m_Ä
].
u
.
šdiÿtÜ
;

517 ià(
¡mt
->
row_size
)

518  *((*)
¡mt
->
·¿ms
[
·¿m_Ä
].
u
.
šdiÿtÜ
 + (
row_Ä
 * stmt->
row_size
));

519  
¡mt
->
·¿ms
[
·¿m_Ä
].
u
.
šdiÿtÜ
[
row_Ä
];

520 
	}
}

522 *
	$ma_g‘_bufãr_off£t
(
MYSQL_STMT
 *
¡mt
, 
’um_f›ld_ty³s
 
ty³
,

523 *
bufãr
, 
row_Ä
)

525 ià(
¡mt
->
·¿m_ÿÎback
)

526  
bufãr
;

528 ià(
¡mt
->
¬¿y_size
)

530 
Ën
;

531 ià(
¡mt
->
row_size
)

532  (*)((*)
bufãr
 + 
¡mt
->
row_size
 * 
row_Ä
);

533 
Ën
ð
mysql_ps_ãtch_funùiÚs
[
ty³
].
·ck_Ën
;

534 ià(
Ën
 > 0)

535  (*)((*)
bufãr
 + 
Ën
 * 
row_Ä
);

536  ((**)
bufãr
)[
row_Ä
];

538  
bufãr
;

539 
	}
}

541 
	$¡Üe_·¿m_ty³
(
MYSQL
 *
mysql
, **
pos
, 
MYSQL_BIND
 *
·¿m
)

543 
ušt
 
ty³code
 = 
·¿m
->
bufãr_ty³
 | (·¿m->
is_unsigÃd
 ? 32768 : 0);

544 
	`št2¡Üe
(*
pos
, 
ty³code
);

545 *
pos
+= 2;

547 ià(
MYSQL_TYPE_OBJECT
 =ð
·¿m
->
bufãr_ty³
) {

548 
MYSQL_COMPLEX_BIND_OBJECT
 *
h—d”
 = (MYSQL_COMPLEX_BIND_OBJECT *)
·¿m
->
bufãr
;

549 ià(
NULL
 =ð
h—d”
->
ty³_Çme
) {

550 
	`¡Üe_·¿m_¬¿y_ty³
(
mysql
, 
pos
, (
MYSQL_COMPLEX_BIND_ARRAY
 *)
h—d”
);

552 
	`¡Üe_·¿m_objeù_ty³
(
mysql
, 
pos
, 
h—d”
);

555 
	}
}

556 
	$¡Üe_·¿m_tšyšt_com¶ex
(**
pos
, 
MYSQL_COMPLEX_BIND_HEADER
 *
·¿m
)

558 *((*
pos
)++)ð*(
uch¬
 *è
·¿m
->
bufãr
;

559 
	}
}

561 
	$¡Üe_·¿m_shÜt_com¶ex
(**
pos
, 
MYSQL_COMPLEX_BIND_HEADER
 *
·¿m
)

563 
v®ue
ð*(*è
·¿m
->
bufãr
;

564 
	`št2¡Üe
(*
pos
,
v®ue
);

565 (*
pos
)+=2;

566 
	}
}

568 
	$¡Üe_·¿m_št32_com¶ex
(**
pos
, 
MYSQL_COMPLEX_BIND_HEADER
 *
·¿m
)

570 
št32
 
v®ue
ð*(št32*è
·¿m
->
bufãr
;

571 
	`št4¡Üe
(*
pos
,
v®ue
);

572 (*
pos
)+=4;

573 
	}
}

575 
	$¡Üe_·¿m_št64_com¶ex
(**
pos
, 
MYSQL_COMPLEX_BIND_HEADER
 *
·¿m
)

577 
lÚglÚg
 
v®ue
ð*ÖÚglÚg*è
·¿m
->
bufãr
;

578 
	`št8¡Üe
(*
pos
,
v®ue
);

579 (*
pos
)+= 8;

580 
	}
}

582 
	$¡Üe_·¿m_æßt_com¶ex
(**
pos
, 
MYSQL_COMPLEX_BIND_HEADER
 *
·¿m
)

584 
v®ue
ð*(*è
·¿m
->
bufãr
;

585 
	`æßt4¡Üe
(*
pos
, 
v®ue
);

586 (*
pos
)+= 4;

587 
	}
}

589 
	$¡Üe_·¿m_doubË_com¶ex
(**
pos
, 
MYSQL_COMPLEX_BIND_HEADER
 *
·¿m
)

591 
v®ue
ð*(*è
·¿m
->
bufãr
;

592 
	`æßt8¡Üe
(*
pos
, 
v®ue
);

593 (*
pos
)+= 8;

594 
	}
}

596 
	$¡Üe_·¿m_time_com¶ex
(**
pos
, 
MYSQL_COMPLEX_BIND_HEADER
 *
·¿m
)

598 
MYSQL_TIME
 *
tm
ð(MYSQL_TIME *è
·¿m
->
bufãr
;

599 
uch¬
 
buff
[
MAX_TIME_REP_LENGTH
], *
tmp
;

600 
ušt
 
Ëngth
;

602 
tmp
ð
buff
+1;

603 
tmp
[0]ð
tm
->
Ãg
 ? 1: 0;

604 
	`št4¡Üe
(
tmp
+1, 
tm
->
day
);

605 
tmp
[5]ð(
uch¬
è
tm
->
hour
;

606 
tmp
[6]ð(
uch¬
è
tm
->
mšu‹
;

607 
tmp
[7]ð(
uch¬
è
tm
->
£cÚd
;

608 
	`št4¡Üe
(
tmp
+8, 
tm
->
£cÚd_·¹
);

609 ià(
tm
->
£cÚd_·¹
)

610 
Ëngth
= 12;

611 ià(
tm
->
hour
 ||m->
mšu‹
 ||m->
£cÚd
 ||m->
day
)

612 
Ëngth
= 8;

614 
Ëngth
= 0;

615 
buff
[0]ð(è
Ëngth
++;

616 
	`memýy
((*)*
pos
, 
buff
, 
Ëngth
);

617 (*
pos
è+ð
Ëngth
;

618 
	}
}

619 
	$Ãt_¡Üe_d©‘ime
(**
pos
, 
MYSQL_TIME
 *
t
)

621 
t_bufãr
[
MAX_DATETIME_STR_LEN
];

622 
ušt
 
Ën
= 0;

624 
	`št2¡Üe
(
t_bufãr
 + 1, 
t
->
y—r
);

625 
t_bufãr
[3]ð(è
t
->
mÚth
;

626 
t_bufãr
[4]ð(è
t
->
day
;

627 
t_bufãr
[5]ð(è
t
->
hour
;

628 
t_bufãr
[6]ð(è
t
->
mšu‹
;

629 
t_bufãr
[7]ð(è
t
->
£cÚd
;

630 ià(
t
->
£cÚd_·¹
)

632 
	`št4¡Üe
(
t_bufãr
 + 8, 
t
->
£cÚd_·¹
);

633 
Ën
= 11;

635 ià(
t
->
hour
 ||->
mšu‹
 ||->
£cÚd
)

636 
Ën
= 7;

637 ià(
t
->
y—r
 ||->
mÚth
 ||->
day
)

638 
Ën
= 4;

640 
Ën
=0;

641 
t_bufãr
[0]ð
Ën
++;

642 
	`memýy
(*
pos
, 
t_bufãr
, 
Ën
);

643 (*
pos
)+ð
Ën
;

644 
	}
}

645 
	$¡Üe_·¿m_d©e_com¶ex
(**
pos
, 
MYSQL_COMPLEX_BIND_HEADER
 *
·¿m
)

647 
MYSQL_TIME
 
tm
ð*((MYSQL_TIME *è
·¿m
->
bufãr
);

648 
tm
.
hour
ðtm.
mšu‹
ðtm.
£cÚd
ðtm.
£cÚd_·¹
= 0;

649 
	`Ãt_¡Üe_d©‘ime
(
pos
, &
tm
);

650 
	}
}

652 
	$¡Üe_·¿m_d©‘ime_com¶ex
(**
pos
, 
MYSQL_COMPLEX_BIND_HEADER
 *
·¿m
)

654 
MYSQL_TIME
 *
tm
ð(MYSQL_TIME *)
·¿m
->
bufãr
;

655 
	`Ãt_¡Üe_d©‘ime
(
pos
, 
tm
);

656 
	}
}

658 
	$¡Üe_·¿m_Üaþe_time¡amp_Çno_com¶ex
(**
pos
, 
MYSQL_COMPLEX_BIND_HEADER
 *
·¿m
)

660 
ORACLE_TIME
 *
tm
ð(ORACLE_TIME *è
·¿m
->
bufãr
;

661 
uch¬
 
buff
[
MAX_ORACLE_TIMESTAMP_REP_LENGTH
];

663 
buff
[0] = 12;

665 
buff
[1]ð(è
tm
->
ûÁury
;

666 
buff
[2]ð(è
tm
->
y—r
;

667 
buff
[3]ð(
uch¬
è
tm
->
mÚth
;

668 
buff
[4]ð(
uch¬
è
tm
->
day
;

669 
buff
[5]ð(
uch¬
è
tm
->
hour
;

670 
buff
[6]ð(
uch¬
è
tm
->
mšu‹
;

671 
buff
[7]ð(
uch¬
è
tm
->
£cÚd
;

672 
	`št4¡Üe
(
buff
+8, 
tm
->
£cÚd_·¹
);

673 
buff
[12] = 9;

675 
	`memýy
((*)*
pos
, 
buff
, 
MAX_ORACLE_TIMESTAMP_REP_LENGTH
);

676 (*
pos
è+ð
MAX_ORACLE_TIMESTAMP_REP_LENGTH
;

677 
	}
}

679 
	$¡Üe_·¿m_Üaþe_time¡amp_tz_com¶ex
(**
pos
, 
MYSQL_COMPLEX_BIND_HEADER
 *
·¿m
)

681 
ORACLE_TIME
 *
tm
ð(ORACLE_TIME *è
·¿m
->
bufãr
;

682 
uch¬
 *
to
;

683 
Ëngth
 = 16;

684 
tz_Ëngth
;

686 
	`¡Üe_·¿m_Üaþe_time¡amp_Çno_com¶ex
(
pos
, 
·¿m
);

688 *(*
pos
++èð(è
tm
->
off£t_hour
;

689 *(*
pos
++èð(è
tm
->
off£t_mšu‹
;

691 ià(
tm
->
tz_Çme
 !ð
NULL
) {

692 
tz_Ëngth
 = 
	`¡¾’
(
tm
->
tz_Çme
);

693 
to
ð
	`mysql_Ãt_¡Üe_Ëngth
(*
pos
, 
tz_Ëngth
);

694 
	`memýy
(
to
, 
tm
->
tz_Çme
, 
tz_Ëngth
);

695 *
pos
 = 
to
 + 
tz_Ëngth
;

696 
Ëngth
 +ð
tz_Ëngth
;

698 *
pos
 = 
	`mysql_Ãt_¡Üe_Ëngth
(*pos, 0);

701 ià(
tm
->
tz_abbr
 !ð
NULL
) {

702 
tz_Ëngth
 = 
	`¡¾’
(
tm
->
tz_abbr
);

703 
to
ð
	`mysql_Ãt_¡Üe_Ëngth
(*
pos
, 
tz_Ëngth
);

704 
	`memýy
(
to
, 
tm
->
tz_abbr
, 
tz_Ëngth
);

705 *
pos
 = 
to
 + 
tz_Ëngth
;

706 
Ëngth
 +ð
tz_Ëngth
;

708 *
pos
 = 
	`mysql_Ãt_¡Üe_Ëngth
(*pos, 0);

711 *(*
pos
 - 
Ëngth
 - 1) =†ength;

712 
	}
}

714 
	$¡Üe_·¿m_¡r_com¶ex
(**
pos
, 
MYSQL_COMPLEX_BIND_STRING
 *
·¿m
)

717 
ulÚg
 
Ëngth
ð
·¿m
->length;

718 
uch¬
 *
to
ð
	`mysql_Ãt_¡Üe_Ëngth
(*
pos
, 
Ëngth
);

719 
	`memýy
(
to
, 
·¿m
->
bufãr
, 
Ëngth
);

720 *
pos
 = 
to
+
Ëngth
;

721 
	}
}

723 
	$¡Üe_·¿m_¡r
(
MYSQL_STMT
 *
¡mt
, 
cÞumn
, **
pos
, 
row_Ä
)

725 
MYSQL_COMPLEX_BIND_STRING
 
h—d”
;

726 *
buf
ð
	`ma_g‘_bufãr_off£t
(
¡mt
, stmt->
·¿ms
[
cÞumn
].
bufãr_ty³
,

727 
¡mt
->
·¿ms
[
cÞumn
].
bufãr
, 
row_Ä
);

728 
h—d”
.
bufãr
 = 
buf
;

729 
h—d”
.
Ëngth
 = 
¡mt
->
·¿ms
[
cÞumn
].length;

731 
	`¡Üe_·¿m_¡r_com¶ex
(
pos
, &
h—d”
);

732 
	}
}

734 
	$¡Üe_·¿m_ob_lob_com¶ex
(**
pos
, 
MYSQL_COMPLEX_BIND_HEADER
 *
·¿m
)

736 
OB_LOB_LOCATOR
 *
lob_loÿtÜ
 = (OB_LOB_LOCATOR *è
·¿m
->
bufãr
;

737 
uch¬
 
buff
[
MAX_OB_LOB_LOCATOR_HEADER_LENGTH
];

739 *
pos
 = 
	`mysql_Ãt_¡Üe_Ëngth
(*pos, 
MAX_OB_LOB_LOCATOR_HEADER_LENGTH
 + 
lob_loÿtÜ
->
·ylßd_size_
 +†ob_loÿtÜ->
·ylßd_off£t_
);

741 
	`št4¡Üe
(
buff
, 
lob_loÿtÜ
->
magic_code_
);

742 
	`št4¡Üe
(
buff
 + 4, 
lob_loÿtÜ
->
v”siÚ_
);

743 
	`št8¡Üe
(
buff
 + 8, 
lob_loÿtÜ
->
¢­shÙ_v”siÚ_
);

744 
	`št8¡Üe
(
buff
 + 16, 
lob_loÿtÜ
->
bË_id_
);

745 
	`št4¡Üe
(
buff
 + 24, 
lob_loÿtÜ
->
cÞumn_id_
);

746 
	`št2¡Üe
(
buff
 + 28, 
lob_loÿtÜ
->
mode_
);

747 
	`št2¡Üe
(
buff
 + 30, 
lob_loÿtÜ
->
ÝtiÚ_
);

748 
	`št4¡Üe
(
buff
 + 32, 
lob_loÿtÜ
->
·ylßd_off£t_
);

749 
	`št4¡Üe
(
buff
 + 36, 
lob_loÿtÜ
->
·ylßd_size_
);

751 
	`memýy
((*)*
pos
, 
buff
, 
MAX_OB_LOB_LOCATOR_HEADER_LENGTH
);

752 *
pos
 +ð
MAX_OB_LOB_LOCATOR_HEADER_LENGTH
;

754 
	`memýy
((*)*
pos
, 
lob_loÿtÜ
->
d©a_
,†ob_loÿtÜ->
·ylßd_size_
 +†ob_loÿtÜ->
·ylßd_off£t_
);

755 *
pos
 +ð
lob_loÿtÜ
->
·ylßd_size_
 +†ob_loÿtÜ->
·ylßd_off£t_
;

756 
	}
}

758 
	$¡Üe_·¿m_ob_lob
(
MYSQL_STMT
 *
¡mt
, 
cÞumn
, **
pos
, 
row_Ä
)

760 *
buf
ð
	`ma_g‘_bufãr_off£t
(
¡mt
, stmt->
·¿ms
[
cÞumn
].
bufãr_ty³
,

761 
¡mt
->
·¿ms
[
cÞumn
].
bufãr
, 
row_Ä
);

762 
MYSQL_COMPLEX_BIND_HEADER
 
h—d”
;

763 
h—d”
.
bufãr
 = 
buf
;

765 
	`¡Üe_·¿m_ob_lob_com¶ex
(
pos
, &
h—d”
);

766 
	}
}

767 
¡Üe_·¿m_objeù_com¶ex
(**
pos
, 
MYSQL_COMPLEX_BIND_OBJECT
 *
·¿m
);

768 
¡Üe_·¿m_¬¿y_com¶ex
(**
pos
, 
MYSQL_COMPLEX_BIND_ARRAY
 *
·¿m
);

770 
	$¡Üe_·¿m_®l_com¶ex
(**
pos
, 
MYSQL_COMPLEX_BIND_HEADER
 *
h—d”
)

772 
h—d”
->
bufãr_ty³
) {

773 
MYSQL_TYPE_TINY
:

774 
	`¡Üe_·¿m_tšyšt_com¶ex
(
pos
, 
h—d”
);

776 
MYSQL_TYPE_SHORT
:

777 
	`¡Üe_·¿m_shÜt_com¶ex
(
pos
, 
h—d”
);

779 
MYSQL_TYPE_LONG
:

780 
MYSQL_TYPE_CURSOR
:

781 
	`¡Üe_·¿m_št32_com¶ex
(
pos
, 
h—d”
);

783 
MYSQL_TYPE_LONGLONG
:

784 
	`¡Üe_·¿m_št64_com¶ex
(
pos
, 
h—d”
);

786 
MYSQL_TYPE_FLOAT
:

787 
	`¡Üe_·¿m_æßt_com¶ex
(
pos
, 
h—d”
);

789 
MYSQL_TYPE_DOUBLE
:

790 
	`¡Üe_·¿m_doubË_com¶ex
(
pos
, 
h—d”
);

792 
MYSQL_TYPE_TIME
:

793 
	`¡Üe_·¿m_time_com¶ex
(
pos
, 
h—d”
);

795 
MYSQL_TYPE_DATE
:

796 
	`¡Üe_·¿m_d©e_com¶ex
(
pos
, 
h—d”
);

798 
MYSQL_TYPE_DATETIME
:

799 
MYSQL_TYPE_TIMESTAMP
:

800 
	`¡Üe_·¿m_d©‘ime_com¶ex
(
pos
, 
h—d”
);

802 
MYSQL_TYPE_ORA_BLOB
:

803 
MYSQL_TYPE_ORA_CLOB
:

804 
	`¡Üe_·¿m_ob_lob_com¶ex
(
pos
, 
h—d”
);

806 
MYSQL_TYPE_OB_TIMESTAMP_NANO
:

807 
MYSQL_TYPE_OB_TIMESTAMP_WITH_LOCAL_TIME_ZONE
:

808 
	`¡Üe_·¿m_Üaþe_time¡amp_Çno_com¶ex
(
pos
, 
h—d”
);

810 
MYSQL_TYPE_OB_TIMESTAMP_WITH_TIME_ZONE
:

811 
	`¡Üe_·¿m_Üaþe_time¡amp_tz_com¶ex
(
pos
, 
h—d”
);

813 
MYSQL_TYPE_TINY_BLOB
:

814 
MYSQL_TYPE_MEDIUM_BLOB
:

815 
MYSQL_TYPE_LONG_BLOB
:

816 
MYSQL_TYPE_OB_RAW
:

817 
MYSQL_TYPE_BLOB
:

818 
MYSQL_TYPE_VARCHAR
:

819 
MYSQL_TYPE_VAR_STRING
:

820 
MYSQL_TYPE_STRING
:

821 
MYSQL_TYPE_OB_NVARCHAR2
:

822 
MYSQL_TYPE_OB_NCHAR
:

823 
MYSQL_TYPE_DECIMAL
:

824 
MYSQL_TYPE_NEWDECIMAL
:

825 
MYSQL_TYPE_OB_NUMBER_FLOAT
:

826 
MYSQL_TYPE_JSON
:

827 
MYSQL_TYPE_OB_UROWID
:

828 
	`¡Üe_·¿m_¡r_com¶ex
(
pos
, (
MYSQL_COMPLEX_BIND_STRING
 *)
h—d”
);

830 
MYSQL_TYPE_ARRAY
:

831 
	`¡Üe_·¿m_¬¿y_com¶ex
(
pos
, (
MYSQL_COMPLEX_BIND_ARRAY
 *)
h—d”
);

833 
MYSQL_TYPE_OBJECT
:

834 
	`¡Üe_·¿m_objeù_com¶ex
(
pos
, (
MYSQL_COMPLEX_BIND_OBJECT
 *)
h—d”
);

839 
	}
}

840 
	$¡Üe_·¿m_objeù_com¶ex
(**
pos
, 
MYSQL_COMPLEX_BIND_OBJECT
 *
·¿m
)

842 
couÁ
 = 0;

843 
i
 = 0;

844 *
nuÎ_buff
 = 
NULL
;

845 
ušt
 
nuÎ_couÁ
;

846 *
bufãr_’d
 = (*)
·¿m
->
bufãr
 +…¬am->
Ëngth
;

847 
MYSQL_COMPLEX_BIND_HEADER
 *
h—d”
 = (MYSQL_COMPLEX_BIND_HEADER *è
·¿m
->
bufãr
;

849 
h—d”
 !ð
bufãr_’d
) {

850 
	`sk_·¿m_com¶ex
(&
h—d”
);

851 
couÁ
++;

854 
nuÎ_buff
 = *
pos
;

855 
nuÎ_couÁ
 = (
couÁ
 + 7) /8;

856 
	`mem£t
(
nuÎ_buff
, 0, 
nuÎ_couÁ
);

858 *
pos
 +ð
nuÎ_couÁ
;

859 
h—d”
 = (
MYSQL_COMPLEX_BIND_HEADER
 *è
·¿m
->
bufãr
;

861 ; 
i
 < 
couÁ
; i++) {

862 ià(
h—d”
->
is_nuÎ
) {

863 
nuÎ_buff
[
i
/8]|ð(
uch¬
) (1 << (i & 7));

865 
	`¡Üe_·¿m_®l_com¶ex
(
pos
, 
h—d”
);

867 
	`sk_·¿m_com¶ex
(&
h—d”
);

869 
	}
}

870 
	$¡Üe_·¿m_¬¿y_com¶ex
(**
pos
, 
MYSQL_COMPLEX_BIND_ARRAY
 *
·¿m
)

872 
i
 = 0;

873 *
nuÎ_buff
 = 
NULL
;

874 
ušt
 
nuÎ_couÁ
;

875 
MYSQL_COMPLEX_BIND_HEADER
 *
h—d”
 = (MYSQL_COMPLEX_BIND_HEADER *è
·¿m
->
bufãr
;

877 *
pos
 = 
	`mysql_Ãt_¡Üe_Ëngth
(*pos, 
·¿m
->
Ëngth
);

878 
nuÎ_buff
 = *
pos
;

879 
nuÎ_couÁ
 = (
·¿m
->
Ëngth
 + 7) /8;

880 
	`mem£t
(
nuÎ_buff
, 0, 
nuÎ_couÁ
);

882 *
pos
 +ð
nuÎ_couÁ
;

884 ; 
i
 < 
·¿m
->
Ëngth
; i++) {

885 ià(
h—d”
->
is_nuÎ
) {

886 
nuÎ_buff
[
i
/8]|ð(
uch¬
) (1 << (i & 7));

888 
	`¡Üe_·¿m_®l_com¶ex
(
pos
, 
h—d”
);

890 
	`sk_·¿m_com¶ex
(&
h—d”
);

892 
	}
}

894 
	$¡Üe_·¿m_objeù
(
MYSQL_STMT
 *
¡mt
, 
cÞumn
, **
pos
, 
row_Ä
)

896 *
buf
ð
	`ma_g‘_bufãr_off£t
(
¡mt
, stmt->
·¿ms
[
cÞumn
].
bufãr_ty³
,

897 
¡mt
->
·¿ms
[
cÞumn
].
bufãr
, 
row_Ä
);

898 
MYSQL_COMPLEX_BIND_OBJECT
 *
h—d”
 = (MYSQL_COMPLEX_BIND_OBJECT *)
buf
;

900 ià(
MYSQL_TYPE_ARRAY
 =ð
h—d”
->
bufãr_ty³
) {

901 
	`¡Üe_·¿m_¬¿y_com¶ex
(
pos
, (
MYSQL_COMPLEX_BIND_ARRAY
 *)
h—d”
);

902 } ià(
MYSQL_TYPE_OBJECT
 =ð
h—d”
->
bufãr_ty³
){

903 
	`¡Üe_·¿m_objeù_com¶ex
(
pos
, 
h—d”
);

905 
	}
}

908 
	#STORE_PARAM
(
Çme
) \

909 
¡Üe_·¿m_
##
	`Çme
(
MYSQL_STMT
 *
¡mt
, 
cÞumn
, **
pos
, 
row_Ä
) \

911 
MYSQL_COMPLEX_BIND_HEADER
 
h—d”
; \

912 *
buf
ð
	`ma_g‘_bufãr_off£t
(
¡mt
, stmt->
·¿ms
[
cÞumn
].
bufãr_ty³
, \

913 
¡mt
->
·¿ms
[
cÞumn
].
bufãr
, 
row_Ä
);\

914 
h—d”
.
bufãr
 = 
buf
; \

915 
¡Üe_·¿m_
##
Çme
##
	`_com¶ex
(
pos
, &
h—d”
); \

916 }

	)

918 
	$STORE_PARAM
(
tšyšt
)

919 
	$STORE_PARAM
()

920 
	$STORE_PARAM
(
št32
)

921 
	$STORE_PARAM
(
št64
)

922 
	$STORE_PARAM
()

923 
	$STORE_PARAM
()

924 
	$STORE_PARAM
(
time
)

925 
	$STORE_PARAM
(
d©e
)

926 
	$STORE_PARAM
(
d©‘ime
)

927 
	$STORE_PARAM
(
Üaþe_time¡amp_Çno
)

928 
	$STORE_PARAM
(
Üaþe_time¡amp_tz
)

930 
	$¡Üe_·¿m
(
MYSQL_STMT
 *
¡mt
, 
cÞumn
, **
p
, 
row_Ä
)

932 *
buf
ð
	`ma_g‘_bufãr_off£t
(
¡mt
, stmt->
·¿ms
[
cÞumn
].
bufãr_ty³
,

933 
¡mt
->
·¿ms
[
cÞumn
].
bufãr
, 
row_Ä
);

934 sigÃd 
šdiÿtÜ
ð
	`ma_g‘_šdiÿtÜ
(
¡mt
, 
cÞumn
, 
row_Ä
);

936 
¡mt
->
·¿ms
[
cÞumn
].
bufãr_ty³
) {

937 
MYSQL_TYPE_TINY
:

938 
	`št1¡Üe
(*
p
, (*(
uch¬
 *)
buf
));

939 (*
p
) += 1;

941 
MYSQL_TYPE_SHORT
:

942 
MYSQL_TYPE_YEAR
:

943 
	`št2¡Üe
(*
p
, (*(*)
buf
));

944 (*
p
) += 2;

946 
MYSQL_TYPE_FLOAT
:

947 
	`æßt4¡Üe
(*
p
, (*(*)
buf
));

948 (*
p
) += 4;

950 
MYSQL_TYPE_DOUBLE
:

951 
	`æßt8¡Üe
(*
p
, (*(*)
buf
));

952 (*
p
) += 8;

954 
MYSQL_TYPE_LONGLONG
:

955 
	`št8¡Üe
(*
p
, (*(
ulÚglÚg
 *)
buf
));

956 (*
p
) += 8;

958 
MYSQL_TYPE_LONG
:

959 
MYSQL_TYPE_INT24
:

960 
	`št4¡Üe
(*
p
, (*(
št32
 *)
buf
));

961 (*
p
)+= 4;

963 
MYSQL_TYPE_TIME
:

975 
MYSQL_TIME
 *
t
ð(MYSQL_TIME *)
	`ma_g‘_bufãr_off£t
(
¡mt
, stmt->
·¿ms
[
cÞumn
].
bufãr_ty³
,

976 
¡mt
->
·¿ms
[
cÞumn
].
bufãr
, 
row_Ä
);

977 
t_bufãr
[
MAX_TIME_STR_LEN
];

978 
ušt
 
Ën
= 0;

980 
t_bufãr
[1]ð
t
->
Ãg
 ? 1 : 0;

981 
	`št4¡Üe
(
t_bufãr
 + 2, 
t
->
day
);

982 
t_bufãr
[6]ð(
uch¬
è
t
->
hour
;

983 
t_bufãr
[7]ð(
uch¬
è
t
->
mšu‹
;

984 
t_bufãr
[8]ð(
uch¬
è
t
->
£cÚd
;

985 ià(
t
->
£cÚd_·¹
)

987 
	`št4¡Üe
(
t_bufãr
 + 9, 
t
->
£cÚd_·¹
);

988 
Ën
= 12;

990 ià(
t
->
day
 ||->
hour
 ||->
mšu‹
 ||->
£cÚd
)

991 
Ën
= 8;

992 
t_bufãr
[0]ð
Ën
++;

993 
	`memýy
(*
p
, 
t_bufãr
, 
Ën
);

994 (*
p
)+ð
Ën
;

997 
MYSQL_TYPE_DATE
:

998 
MYSQL_TYPE_TIMESTAMP
:

999 
MYSQL_TYPE_DATETIME
:

1012 
MYSQL_TIME
 *
t
ð(MYSQL_TIME *)
	`ma_g‘_bufãr_off£t
(
¡mt
, stmt->
·¿ms
[
cÞumn
].
bufãr_ty³
,

1013 
¡mt
->
·¿ms
[
cÞumn
].
bufãr
, 
row_Ä
);

1014 
t_bufãr
[
MAX_DATETIME_STR_LEN
];

1015 
ušt
 
Ën
= 0;

1017 
	`št2¡Üe
(
t_bufãr
 + 1, 
t
->
y—r
);

1018 
t_bufãr
[3]ð(è
t
->
mÚth
;

1019 
t_bufãr
[4]ð(è
t
->
day
;

1020 
t_bufãr
[5]ð(è
t
->
hour
;

1021 
t_bufãr
[6]ð(è
t
->
mšu‹
;

1022 
t_bufãr
[7]ð(è
t
->
£cÚd
;

1023 ià(
t
->
£cÚd_·¹
)

1025 
	`št4¡Üe
(
t_bufãr
 + 8, 
t
->
£cÚd_·¹
);

1026 
Ën
= 11;

1028 ià(
t
->
hour
 ||->
mšu‹
 ||->
£cÚd
)

1029 
Ën
= 7;

1030 ià(
t
->
y—r
 ||->
mÚth
 ||->
day
)

1031 
Ën
= 4;

1033 
Ën
=0;

1034 
t_bufãr
[0]ð
Ën
++;

1035 
	`memýy
(*
p
, 
t_bufãr
, 
Ën
);

1036 (*
p
)+ð
Ën
;

1039 
MYSQL_TYPE_TINY_BLOB
:

1040 
MYSQL_TYPE_MEDIUM_BLOB
:

1041 
MYSQL_TYPE_LONG_BLOB
:

1042 
MYSQL_TYPE_BLOB
:

1043 
MYSQL_TYPE_VARCHAR
:

1044 
MYSQL_TYPE_VAR_STRING
:

1045 
MYSQL_TYPE_STRING
:

1046 
MYSQL_TYPE_JSON
:

1047 
MYSQL_TYPE_DECIMAL
:

1048 
MYSQL_TYPE_NEWDECIMAL
:

1050 
ulÚg
 
Ën
;

1052 
uch¬
 *
to
;

1054 ià(
šdiÿtÜ
 =ð
STMT_INDICATOR_NTS
)

1055 
Ën
= -1;

1057 
Ën
ð
	`ma_g‘_Ëngth
(
¡mt
, 
cÞumn
, 
row_Ä
);

1059 ià(
Ën
 =ð(
ulÚg
)-1)

1060 
Ën
ð(
ulÚg
)
	`¡¾’
((*)
buf
);

1062 
to
 = 
	`mysql_Ãt_¡Üe_Ëngth
(*
p
, 
Ën
);

1064 ià(
Ën
)

1065 
	`memýy
(
to
, 
buf
, 
Ën
);

1066 (*
p
èð
to
 + 
Ën
;

1070 
MYSQL_TYPE_CURSOR
:

1071 
	`¡Üe_·¿m_št32
(
¡mt
, 
cÞumn
, 
p
, 
row_Ä
);

1073 
MYSQL_TYPE_OB_TIMESTAMP_WITH_TIME_ZONE
:

1074 
	`¡Üe_·¿m_Üaþe_time¡amp_tz
(
¡mt
, 
cÞumn
, 
p
, 
row_Ä
);

1076 
MYSQL_TYPE_OB_TIMESTAMP_NANO
:

1077 
MYSQL_TYPE_OB_TIMESTAMP_WITH_LOCAL_TIME_ZONE
:

1078 
	`¡Üe_·¿m_Üaþe_time¡amp_Çno
(
¡mt
, 
cÞumn
, 
p
, 
row_Ä
);

1080 
MYSQL_TYPE_ORA_BLOB
:

1081 
MYSQL_TYPE_ORA_CLOB
:

1082 
	`¡Üe_·¿m_ob_lob
(
¡mt
, 
cÞumn
, 
p
, 
row_Ä
);

1084 
MYSQL_TYPE_OB_RAW
:

1085 
MYSQL_TYPE_OB_NVARCHAR2
:

1086 
MYSQL_TYPE_OB_NCHAR
:

1087 
MYSQL_TYPE_OB_NUMBER_FLOAT
:

1088 
MYSQL_TYPE_OB_UROWID
:

1090 
ulÚg
 
Ën
;

1091 ià(
šdiÿtÜ
 =ð
STMT_INDICATOR_NTS
)

1092 
Ën
= -1;

1094 
Ën
ð
	`ma_g‘_Ëngth
(
¡mt
, 
cÞumn
, 
row_Ä
);

1095 ià(
Ën
 =ð(
ulÚg
)-1)

1096 
Ën
ð(
ulÚg
)
	`¡¾’
((*)
buf
);

1097 
¡mt
->
·¿ms
->
Ëngth
 = 
Ën
;

1098 
	`¡Üe_·¿m_¡r
(
¡mt
, 
cÞumn
, 
p
, 
row_Ä
);

1101 
MYSQL_TYPE_OBJECT
:

1102 
	`¡Üe_·¿m_objeù
(
¡mt
, 
cÞumn
, 
p
, 
row_Ä
);

1107 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
CR_UNSUPPORTED_PARAM_TYPE
, 
SQLSTATE_UNKNOWN
, 0);

1111 
	}
}

1113 
ulÚg
 
ÿlcuÏ‹_·¿m_com¶ex_Ën
(
MYSQL_COMPLEX_BIND_HEADER
 *
h—d”
);

1114 
ulÚg
 
ÿlcuÏ‹_·¿m_Üaþe_time¡amp_Ën
(
ORACLE_TIME
 * 
tm
);

1116 
ulÚg
 
	$ÿlcuÏ‹_·¿m_objeù_Ën
(
MYSQL_COMPLEX_BIND_OBJECT
 *
·¿m
)

1118 
ulÚg
 
Ën
 = 0;

1119 
i
 = 0;

1120 *
bufãr_’d
 = (*)
·¿m
->
bufãr
 +…¬am->
Ëngth
;

1121 
MYSQL_COMPLEX_BIND_HEADER
 *
h—d”
 = (MYSQL_COMPLEX_BIND_HEADER *è
·¿m
->
bufãr
;

1123 
h—d”
 !ð
bufãr_’d
) {

1124 
i
++;

1125 
Ën
 +ð
	`ÿlcuÏ‹_·¿m_com¶ex_Ën
(
h—d”
);

1126 
	`sk_·¿m_com¶ex
(&
h—d”
);

1128 
Ën
 +ð(
i
 + 7) /8;

1130  
Ën
;

1131 
	}
}

1132 
	$cÚv”t_ty³_to_com¶ex
(
’um_f›ld_ty³s
 
ty³
)

1134 
ty³
) {

1135 
MYSQL_TYPE_TINY
:

1136 
MYSQL_TYPE_SHORT
:

1137 
MYSQL_TYPE_LONG
:

1138 
MYSQL_TYPE_LONGLONG
:

1139 
MYSQL_TYPE_FLOAT
:

1140 
MYSQL_TYPE_DOUBLE
:

1141 
MYSQL_TYPE_TIME
:

1142 
MYSQL_TYPE_DATE
:

1143 
MYSQL_TYPE_DATETIME
:

1144 
MYSQL_TYPE_TIMESTAMP
:

1145 
MYSQL_TYPE_CURSOR
:

1146 
MYSQL_TYPE_ORA_BLOB
:

1147 
MYSQL_TYPE_ORA_CLOB
:

1148 
MYSQL_TYPE_OB_TIMESTAMP_NANO
:

1149 
MYSQL_TYPE_OB_TIMESTAMP_WITH_TIME_ZONE
:

1150 
MYSQL_TYPE_OB_TIMESTAMP_WITH_LOCAL_TIME_ZONE
:

1151  (
MYSQL_COMPLEX_BIND_HEADER
);

1152 
MYSQL_TYPE_TINY_BLOB
:

1153 
MYSQL_TYPE_MEDIUM_BLOB
:

1154 
MYSQL_TYPE_LONG_BLOB
:

1155 
MYSQL_TYPE_OB_RAW
:

1156 
MYSQL_TYPE_BLOB
:

1157 
MYSQL_TYPE_VARCHAR
:

1158 
MYSQL_TYPE_VAR_STRING
:

1159 
MYSQL_TYPE_STRING
:

1160 
MYSQL_TYPE_OB_NVARCHAR2
:

1161 
MYSQL_TYPE_OB_NCHAR
:

1162 
MYSQL_TYPE_DECIMAL
:

1163 
MYSQL_TYPE_NEWDECIMAL
:

1164 
MYSQL_TYPE_OB_NUMBER_FLOAT
:

1165 
MYSQL_TYPE_JSON
:

1166 
MYSQL_TYPE_OB_UROWID
:

1167  (
MYSQL_COMPLEX_BIND_STRING
);

1169  (
MYSQL_COMPLEX_BIND_HEADER
);

1171 
	}
}

1173 
	$sk_·¿m_com¶ex
(
MYSQL_COMPLEX_BIND_HEADER
 **
·¿m
)

1175 
MYSQL_COMPLEX_BIND_HEADER
 *
h—d”
 = *
·¿m
;

1176 
h—d”
->
bufãr_ty³
) {

1177 
MYSQL_TYPE_TINY
:

1178 
MYSQL_TYPE_SHORT
:

1179 
MYSQL_TYPE_LONG
:

1180 
MYSQL_TYPE_LONGLONG
:

1181 
MYSQL_TYPE_FLOAT
:

1182 
MYSQL_TYPE_DOUBLE
:

1183 
MYSQL_TYPE_TIME
:

1184 
MYSQL_TYPE_DATE
:

1185 
MYSQL_TYPE_DATETIME
:

1186 
MYSQL_TYPE_TIMESTAMP
:

1187 
MYSQL_TYPE_CURSOR
:

1188 
MYSQL_TYPE_ORA_BLOB
:

1189 
MYSQL_TYPE_ORA_CLOB
:

1190 
MYSQL_TYPE_OB_TIMESTAMP_NANO
:

1191 
MYSQL_TYPE_OB_TIMESTAMP_WITH_TIME_ZONE
:

1192 
MYSQL_TYPE_OB_TIMESTAMP_WITH_LOCAL_TIME_ZONE
:

1193 (*
·¿m
)++;

1195 
MYSQL_TYPE_TINY_BLOB
:

1196 
MYSQL_TYPE_MEDIUM_BLOB
:

1197 
MYSQL_TYPE_LONG_BLOB
:

1198 
MYSQL_TYPE_OB_RAW
:

1199 
MYSQL_TYPE_BLOB
:

1200 
MYSQL_TYPE_VARCHAR
:

1201 
MYSQL_TYPE_VAR_STRING
:

1202 
MYSQL_TYPE_STRING
:

1203 
MYSQL_TYPE_OB_NVARCHAR2
:

1204 
MYSQL_TYPE_OB_NCHAR
:

1205 
MYSQL_TYPE_DECIMAL
:

1206 
MYSQL_TYPE_NEWDECIMAL
:

1207 
MYSQL_TYPE_OB_NUMBER_FLOAT
:

1208 
MYSQL_TYPE_JSON
:

1209 
MYSQL_TYPE_OB_UROWID
:

1210 *
·¿m
 = (
MYSQL_COMPLEX_BIND_HEADER
 *)(((
MYSQL_COMPLEX_BIND_STRING
 *)
h—d”
) + 1);

1216 
MYSQL_TYPE_ARRAY
:

1217 *
·¿m
 = (
MYSQL_COMPLEX_BIND_HEADER
 *)(((
MYSQL_COMPLEX_BIND_ARRAY
 *)
h—d”
) + 1);

1219 
MYSQL_TYPE_OBJECT
:

1220 *
·¿m
 = (
MYSQL_COMPLEX_BIND_HEADER
 *)(((
MYSQL_COMPLEX_BIND_OBJECT
 *)
h—d”
) + 1);

1225 
	}
}

1227 
ulÚg
 
	$ÿlcuÏ‹_·¿m_¬¿y_Ën
(
MYSQL_COMPLEX_BIND_ARRAY
 *
·¿m
)

1229 
ulÚg
 
Ën
 = 0;

1230 
ušt
 
i
 = 0;

1231 
MYSQL_COMPLEX_BIND_HEADER
 *
h—d”
 = (MYSQL_COMPLEX_BIND_HEADER *è
·¿m
->
bufãr
;

1233 
Ën
 +ð
	`mysql_¡Üe_Ëngth_size
(
·¿m
->
Ëngth
);

1234 
Ën
 +ð(
·¿m
->
Ëngth
 + 7) /8;

1236 
i
 = 0; i < 
·¿m
->
Ëngth
; i++) {

1237 
Ën
 +ð
	`ÿlcuÏ‹_·¿m_com¶ex_Ën
(
h—d”
);

1238 
	`sk_·¿m_com¶ex
(&
h—d”
);

1241  
Ën
;

1242 
	}
}

1244 
ulÚg
 
	$ÿlcuÏ‹_·¿m_com¶ex_Ën
(
MYSQL_COMPLEX_BIND_HEADER
 *
h—d”
)

1246 
ulÚg
 
Ën
 = 0;

1247 
h—d”
->
bufãr_ty³
) {

1248 
MYSQL_TYPE_TINY
:

1249 
Ën
 = 1;

1251 
MYSQL_TYPE_SHORT
:

1252 
Ën
 = 2;

1254 
MYSQL_TYPE_LONG
:

1255 
MYSQL_TYPE_CURSOR
:

1256 
Ën
 = 4;

1258 
MYSQL_TYPE_LONGLONG
:

1259 
Ën
 = 8;

1261 
MYSQL_TYPE_FLOAT
:

1262 
Ën
 = 4;

1264 
MYSQL_TYPE_DOUBLE
:

1265 
Ën
 = 8;

1267 
MYSQL_TYPE_TIME
:

1268 
Ën
 = 
MAX_TIME_REP_LENGTH
;

1270 
MYSQL_TYPE_DATE
:

1271 
Ën
 = 
MAX_DATE_REP_LENGTH
;

1273 
MYSQL_TYPE_DATETIME
:

1274 
MYSQL_TYPE_TIMESTAMP
:

1275 
Ën
 = 
MAX_DATETIME_REP_LENGTH
;

1277 
MYSQL_TYPE_ORA_BLOB
:

1278 
MYSQL_TYPE_ORA_CLOB
: {

1279 
OB_LOB_LOCATOR
 *
ob_lob_loÿtÜ
ð(OB_LOB_LOCATOR *è
h—d”
->
bufãr
;

1280 
Ën
 = 
MAX_OB_LOB_LOCATOR_HEADER_LENGTH
 + 
ob_lob_loÿtÜ
->
·ylßd_off£t_
 + ob_lob_loÿtÜ->
·ylßd_size_
;

1281 
Ën
 +ð
	`mysql_¡Üe_Ëngth_size
(len);

1284 
MYSQL_TYPE_OB_TIMESTAMP_WITH_TIME_ZONE
:

1285 
Ën
 = 
	`ÿlcuÏ‹_·¿m_Üaþe_time¡amp_Ën
((
ORACLE_TIME
 *è
h—d”
->
bufãr
);

1287 
MYSQL_TYPE_OB_TIMESTAMP_NANO
:

1288 
MYSQL_TYPE_OB_TIMESTAMP_WITH_LOCAL_TIME_ZONE
:

1289 
Ën
 = 
MAX_ORACLE_TIMESTAMP_REP_LENGTH
;

1291 
MYSQL_TYPE_TINY_BLOB
:

1292 
MYSQL_TYPE_MEDIUM_BLOB
:

1293 
MYSQL_TYPE_LONG_BLOB
:

1294 
MYSQL_TYPE_OB_RAW
:

1295 
MYSQL_TYPE_BLOB
:

1296 
MYSQL_TYPE_VARCHAR
:

1297 
MYSQL_TYPE_VAR_STRING
:

1298 
MYSQL_TYPE_STRING
:

1299 
MYSQL_TYPE_OB_NVARCHAR2
:

1300 
MYSQL_TYPE_OB_NCHAR
:

1301 
MYSQL_TYPE_DECIMAL
:

1302 
MYSQL_TYPE_NEWDECIMAL
:

1303 
MYSQL_TYPE_OB_NUMBER_FLOAT
:

1304 
MYSQL_TYPE_JSON
:

1305 
MYSQL_TYPE_OB_UROWID
:

1306 
Ën
 = ((
MYSQL_COMPLEX_BIND_STRING
 *è
h—d”
)->
Ëngth
;

1307 
Ën
 +ð
	`mysql_¡Üe_Ëngth_size
(len);

1309 
MYSQL_TYPE_ARRAY
:

1310 
Ën
 = 
	`ÿlcuÏ‹_·¿m_¬¿y_Ën
((
MYSQL_COMPLEX_BIND_ARRAY
 *)
h—d”
);

1312 
MYSQL_TYPE_OBJECT
:

1313 
Ën
 = 
	`ÿlcuÏ‹_·¿m_objeù_Ën
((
MYSQL_COMPLEX_BIND_OBJECT
 *)
h—d”
);

1316 
Ën
 = 0;

1319 ià(
h—d”
->
is_nuÎ
) {

1322  
Ën
;

1324 
	}
}

1326 
ulÚg
 
	$ÿlcuÏ‹_·¿m_Üaþe_time¡amp_Ën
(
ORACLE_TIME
 * 
tm
)

1328 
ulÚg
 
Ën
 = 17;

1330 ià(
tm
->
tz_Çme
 !ð
NULL
) {

1331 
Ën
 +ð
	`¡¾’
(
tm
->
tz_Çme
);

1334 ià(
tm
->
tz_abbr
 !ð
NULL
) {

1335 
Ën
 +ð
	`¡¾’
(
tm
->
tz_abbr
);

1338  
Ën
;

1339 
	}
}

1341 
ulÚg
 
	$ÿlcuÏ‹_·¿m_ob_lob_Ën
(
MYSQL_BIND
 *
·¿m
)

1343 
ulÚg
 
Ën
 = 0;

1345 ià(
NULL
 !ð
·¿m
->
bufãr
) {

1346 
OB_LOB_LOCATOR
 *
ob_lob_loÿtÜ
ð(OB_LOB_LOCATOR *è
·¿m
->
bufãr
;

1347 
Ën
 = 
MAX_OB_LOB_LOCATOR_HEADER_LENGTH
 + 
ob_lob_loÿtÜ
->
·ylßd_off£t_
 + ob_lob_loÿtÜ->
·ylßd_size_
;

1348 
Ën
 +ð
	`mysql_¡Üe_Ëngth_size
(len);

1350  
Ën
;

1351 
	}
}

1353 
ulÚg
 
	$ÿlcuÏ‹_·¿m_Ën
(
MYSQL_BIND
 *
·¿m
)

1355 ià(
MYSQL_TYPE_OBJECT
 =ð
·¿m
->
bufãr_ty³
) {

1356 
MYSQL_COMPLEX_BIND_OBJECT
 *
h—d”
 = (MYSQL_COMPLEX_BIND_OBJECT *)
·¿m
->
bufãr
;

1357 ià(
MYSQL_TYPE_ARRAY
 =ð
h—d”
->
bufãr_ty³
) {

1358  
	`ÿlcuÏ‹_·¿m_¬¿y_Ën
((
MYSQL_COMPLEX_BIND_ARRAY
 *)
h—d”
);

1360  
	`ÿlcuÏ‹_·¿m_objeù_Ën
(
h—d”
);

1362 } ià(
MYSQL_TYPE_OB_TIMESTAMP_WITH_TIME_ZONE
 =ð
·¿m
->
bufãr_ty³
) {

1363  
	`ÿlcuÏ‹_·¿m_Üaþe_time¡amp_Ën
((
ORACLE_TIME
 *)
·¿m
->
bufãr
);

1364 } ià(
MYSQL_TYPE_ORA_BLOB
 =ð
·¿m
->
bufãr_ty³
 || 
MYSQL_TYPE_ORA_CLOB
 ==…aram->buffer_type) {

1365  
	`ÿlcuÏ‹_·¿m_ob_lob_Ën
(
·¿m
);

1367  *
·¿m
->
Ëngth
;

1369 
	}
}

1372 * 
	$mysql_¡mt_execu‹_g’”©e_sim¶e_»que¡
(
MYSQL_STMT
 *
¡mt
, 
size_t
 *
»que¡_Ën
)

1395 
size_t
 
Ëngth
= 1024;

1396 
size_t
 
ä“_by‹s
= 0;

1397 
size_t
 
nuÎ_by‹_off£t
= 0;

1398 
ušt
 
i
;

1400 
uch¬
 *
¡¬t
ð
NULL
, *
p
;

1404 ià(!(
¡¬t
ð
p
ð(
uch¬
 *)
	`m®loc
(
Ëngth
)))

1405 
mem_”rÜ
;

1407 
	`št4¡Üe
(
p
, 
¡mt
->
¡mt_id
);

1408 
p
 +ð
STMT_ID_LENGTH
;

1411 
	`št1¡Üe
(
p
, (è
¡mt
->
æags
);

1412 
p
++;

1414 
	`št4¡Üe
(
p
, 1);

1415 
p
+= 4;

1417 ià(
¡mt
->
·¿m_couÁ
)

1419 
size_t
 
nuÎ_couÁ
ð(
¡mt
->
·¿m_couÁ
 + 7) / 8;

1421 
ä“_by‹s
ð
Ëngth
 - (
p
 - 
¡¬t
);

1422 ià(
nuÎ_couÁ
 + 20 > 
ä“_by‹s
)

1424 
size_t
 
off£t
ð
p
 - 
¡¬t
;

1425 
Ëngth
+ð
off£t
 + 
nuÎ_couÁ
 + 20;

1426 ià(!(
¡¬t
ð(
uch¬
 *)
	`»®loc
(¡¬t, 
Ëngth
)))

1427 
mem_”rÜ
;

1428 
p
ð
¡¬t
 + 
off£t
;

1431 
nuÎ_by‹_off£t
ð
p
 - 
¡¬t
;

1432 
	`mem£t
(
p
, 0, 
nuÎ_couÁ
);

1433 
p
 +ð
nuÎ_couÁ
;

1435 
	`št1¡Üe
(
p
, 
¡mt
->
£nd_ty³s_to_£rv”
);

1436 
p
++;

1438 
ä“_by‹s
ð
Ëngth
 - (
p
 - 
¡¬t
);

1443 ià(
¡mt
->
£nd_ty³s_to_£rv”
)

1445 ià(
ä“_by‹s
 < 
¡mt
->
·¿m_couÁ
 * 2 + 20)

1447 
size_t
 
off£t
ð
p
 - 
¡¬t
;

1448 
Ëngth
ð
off£t
 + 
¡mt
->
·¿m_couÁ
 * 2 + 20;

1449 ià(!(
¡¬t
ð(
uch¬
 *)
	`»®loc
(¡¬t, 
Ëngth
)))

1450 
mem_”rÜ
;

1451 
p
ð
¡¬t
 + 
off£t
;

1453 
i
 = 0; i < 
¡mt
->
·¿m_couÁ
; i++)

1456 
ušt
 
bufãr_ty³
ð
¡mt
->
·¿ms
[
i
].bufãr_ty³ | (¡mt->·¿ms[i].
is_unsigÃd
 ? 32768 : 0);

1458 
	`št2¡Üe
(
p
, 
bufãr_ty³
);

1459 
p
+= 2;

1464 
i
=0; i < 
¡mt
->
·¿m_couÁ
; i++)

1466 
size_t
 
size
= 0;

1467 
my_boÞ
 
has_d©a
ð
TRUE
;

1469 ià(
¡mt
->
·¿ms
[
i
].
lÚg_d©a_u£d
)

1471 
has_d©a
ð
FALSE
;

1472 
¡mt
->
·¿ms
[
i
].
lÚg_d©a_u£d
= 0;

1475 ià(
has_d©a
)

1477 
¡mt
->
·¿ms
[
i
].
bufãr_ty³
) {

1478 
MYSQL_TYPE_NULL
:

1479 
has_d©a
ð
FALSE
;

1481 
MYSQL_TYPE_TINY_BLOB
:

1482 
MYSQL_TYPE_MEDIUM_BLOB
:

1483 
MYSQL_TYPE_LONG_BLOB
:

1484 
MYSQL_TYPE_BLOB
:

1485 
MYSQL_TYPE_VARCHAR
:

1486 
MYSQL_TYPE_VAR_STRING
:

1487 
MYSQL_TYPE_STRING
:

1488 
MYSQL_TYPE_JSON
:

1489 
MYSQL_TYPE_DECIMAL
:

1490 
MYSQL_TYPE_NEWDECIMAL
:

1491 
MYSQL_TYPE_GEOMETRY
:

1492 
MYSQL_TYPE_NEWDATE
:

1493 
MYSQL_TYPE_ENUM
:

1494 
MYSQL_TYPE_BIT
:

1495 
MYSQL_TYPE_SET
:

1496 
size
+= 5;

1497 
size
+ð(
size_t
)
	`ma_g‘_Ëngth
(
¡mt
, 
i
, 0);

1500 
MYSQL_TYPE_ORA_BLOB
:

1501 
MYSQL_TYPE_ORA_CLOB
:

1502 
MYSQL_TYPE_OB_TIMESTAMP_WITH_TIME_ZONE
:

1503 
MYSQL_TYPE_OBJECT
:

1504 
size
 +ð(
size_t
è
	`ÿlcuÏ‹_·¿m_Ën
(&
¡mt
->
·¿ms
[
i
]);

1508 
size
+ð
mysql_ps_ãtch_funùiÚs
[
¡mt
->
·¿ms
[
i
].
bufãr_ty³
].
·ck_Ën
;

1512 
ä“_by‹s
ð
Ëngth
 - (
p
 - 
¡¬t
);

1513 ià(
ä“_by‹s
 < 
size
 + 20)

1515 
size_t
 
off£t
ð
p
 - 
¡¬t
;

1516 
Ëngth
ð
	`MAX
(2 *†’gth, 
off£t
 + 
size
 + 20);

1517 ià(!(
¡¬t
ð(
uch¬
 *)
	`»®loc
(¡¬t, 
Ëngth
)))

1518 
mem_”rÜ
;

1519 
p
ð
¡¬t
 + 
off£t
;

1521 ià(((
¡mt
->
·¿ms
[
i
].
is_nuÎ
 && *stmt->params[i].is_null) ||

1522 
¡mt
->
·¿ms
[
i
].
bufãr_ty³
 =ð
MYSQL_TYPE_NULL
 ||

1523 !
¡mt
->
·¿ms
[
i
].
bufãr
))

1525 
has_d©a
ð
FALSE
;

1526 (
¡¬t
 + 
nuÎ_by‹_off£t
)[
i
/8] |= () (1 << (i & 7));

1529 ià(
has_d©a
)

1531 
	`¡Üe_·¿m
(
¡mt
, 
i
, &
p
, 0);

1535 
¡mt
->
£nd_ty³s_to_£rv”
= 0;

1536 *
»que¡_Ën
 = (
size_t
)(
p
 - 
¡¬t
);

1537  
¡¬t
;

1538 
mem_”rÜ
:

1539 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
CR_OUT_OF_MEMORY
, 
SQLSTATE_UNKNOWN
, 0);

1540 
	`ä“
(
¡¬t
);

1541 *
»que¡_Ën
= 0;

1542  
NULL
;

1543 
	}
}

1547 
my_boÞ
 
	$mysql_¡mt_sk_·¿m£t
(
MYSQL_STMT
 *
¡mt
, 
ušt
 
row
)

1549 
ušt
 
i
;

1550 
i
=0; i < 
¡mt
->
·¿m_couÁ
; i++)

1552 ià(
	`ma_g‘_šdiÿtÜ
(
¡mt
, 
i
, 
row
è=ð
STMT_INDICATOR_IGNORE_ROW
)

1557 
	}
}

1561 * 
	$mysql_¡mt_execu‹_g’”©e_bulk_»que¡
(
MYSQL_STMT
 *
¡mt
, 
size_t
 *
»que¡_Ën
)

1588 
size_t
 
Ëngth
= 1024;

1589 
size_t
 
ä“_by‹s
= 0;

1590 
ushÜt
 
æags
= 0;

1591 
ušt
 
i
, 
j
;

1593 
uch¬
 *
¡¬t
ð
NULL
, *
p
;

1595 ià(!
	`MARIADB_STMT_BULK_SUPPORTED
(
¡mt
))

1597 
	`¡mt_£t_”rÜ
(
¡mt
, 
CR_FUNCTION_NOT_SUPPORTED
, "IM001",

1598 
	`CER
(
CR_FUNCTION_NOT_SUPPORTED
), "Bulk operation");

1599  
NULL
;

1602 ià(!
¡mt
->
·¿m_couÁ
)

1604 
	`¡mt_£t_”rÜ
(
¡mt
, 
CR_BULK_WITHOUT_PARAMETERS
, "IM001",

1605 
	`CER
(
CR_BULK_WITHOUT_PARAMETERS
));

1606  
NULL
;

1610 ià(!(
¡¬t
ð
p
ð(
uch¬
 *)
	`m®loc
(
Ëngth
)))

1611 
mem_”rÜ
;

1613 
	`št4¡Üe
(
p
, 
¡mt
->
¡mt_id
);

1614 
p
 +ð
STMT_ID_LENGTH
;

1617 ià(
¡mt
->
£nd_ty³s_to_£rv”
)

1618 
æags
|ð
STMT_BULK_FLAG_CLIENT_SEND_TYPES
;

1619 
	`št2¡Üe
(
p
, 
æags
);

1620 
p
+=2;

1626 ià(!
¡mt
->
·¿m_couÁ
 && stmt->
´ebšd_·¿ms
)

1627 
¡mt
->
·¿m_couÁ
ð¡mt->
´ebšd_·¿ms
;

1629 ià(
¡mt
->
·¿m_couÁ
)

1631 
ä“_by‹s
ð
Ëngth
 - (
p
 - 
¡¬t
);

1636 ià(
¡mt
->
£nd_ty³s_to_£rv”
)

1638 ià(
ä“_by‹s
 < 
¡mt
->
·¿m_couÁ
 * 2 + 20)

1640 
size_t
 
off£t
ð
p
 - 
¡¬t
;

1641 
Ëngth
ð
off£t
 + 
¡mt
->
·¿m_couÁ
 * 2 + 20;

1642 ià(!(
¡¬t
ð(
uch¬
 *)
	`»®loc
(¡¬t, 
Ëngth
)))

1643 
mem_”rÜ
;

1644 
p
ð
¡¬t
 + 
off£t
;

1646 
i
 = 0; i < 
¡mt
->
·¿m_couÁ
; i++)

1649 
ušt
 
bufãr_ty³
ð
¡mt
->
·¿ms
[
i
].bufãr_ty³ | (¡mt->·¿ms[i].
is_unsigÃd
 ? 32768 : 0);

1650 
	`št2¡Üe
(
p
, 
bufãr_ty³
);

1651 
p
+= 2;

1656 
j
=0; j < 
¡mt
->
¬¿y_size
; j++)

1660 ià(
¡mt
->
·¿m_ÿÎback
)

1661 
¡mt
->
	`·¿m_ÿÎback
(¡mt->
u£r_d©a
, stmt->
·¿ms
, 
j
);

1663 ià(
	`mysql_¡mt_sk_·¿m£t
(
¡mt
, 
j
))

1666 
i
=0; i < 
¡mt
->
·¿m_couÁ
; i++)

1668 
size_t
 
size
= 0;

1669 
my_boÞ
 
has_d©a
ð
TRUE
;

1670 sigÃd 
šdiÿtÜ
ð
	`ma_g‘_šdiÿtÜ
(
¡mt
, 
i
, 
j
);

1672 ià(
šdiÿtÜ
 > 0)

1673 
has_d©a
ð
FALSE
;

1674 
size
= 1;

1679 ià(
has_d©a
)

1681 
¡mt
->
·¿ms
[
i
].
bufãr_ty³
) {

1682 
MYSQL_TYPE_NULL
:

1683 
has_d©a
ð
FALSE
;

1684 
šdiÿtÜ
ð
STMT_INDICATOR_NULL
;

1686 
MYSQL_TYPE_TINY_BLOB
:

1687 
MYSQL_TYPE_MEDIUM_BLOB
:

1688 
MYSQL_TYPE_LONG_BLOB
:

1689 
MYSQL_TYPE_BLOB
:

1690 
MYSQL_TYPE_VARCHAR
:

1691 
MYSQL_TYPE_VAR_STRING
:

1692 
MYSQL_TYPE_STRING
:

1693 
MYSQL_TYPE_JSON
:

1694 
MYSQL_TYPE_DECIMAL
:

1695 
MYSQL_TYPE_NEWDECIMAL
:

1696 
MYSQL_TYPE_GEOMETRY
:

1697 
MYSQL_TYPE_NEWDATE
:

1698 
MYSQL_TYPE_ENUM
:

1699 
MYSQL_TYPE_BIT
:

1700 
MYSQL_TYPE_SET
:

1701 
size
+= 5;

1702 ià(!
¡mt
->
·¿m_ÿÎback
)

1704 ià(
šdiÿtÜ
 =ð
STMT_INDICATOR_NTS
 ||

1705 (!
¡mt
->
row_size
 && 
	`ma_g‘_Ëngth
(¡mt,
i
,
j
) == -1))

1707 
size
+ð
	`¡¾’
(
	`ma_g‘_bufãr_off£t
(
¡mt
,

1708 
¡mt
->
·¿ms
[
i
].
bufãr_ty³
,

1709 
¡mt
->
·¿ms
[
i
].
bufãr
,
j
));

1712 
size
+ð(
size_t
)
	`ma_g‘_Ëngth
(
¡mt
, 
i
, 
j
);

1715 
size
+ð
¡mt
->
·¿ms
[
i
].
bufãr_Ëngth
;

1719 
size
+ð
mysql_ps_ãtch_funùiÚs
[
¡mt
->
·¿ms
[
i
].
bufãr_ty³
].
·ck_Ën
;

1723 
ä“_by‹s
ð
Ëngth
 - (
p
 - 
¡¬t
);

1724 ià(
ä“_by‹s
 < 
size
 + 20)

1726 
size_t
 
off£t
ð
p
 - 
¡¬t
;

1727 
Ëngth
ð
	`MAX
(2 *†’gth, 
off£t
 + 
size
 + 20);

1728 ià(!(
¡¬t
ð(
uch¬
 *)
	`»®loc
(¡¬t, 
Ëngth
)))

1729 
mem_”rÜ
;

1730 
p
ð
¡¬t
 + 
off£t
;

1733 
	`št1¡Üe
(
p
, 
šdiÿtÜ
 > 0 ? indicator : 0);

1734 
p
++;

1735 ià(
has_d©a
) {

1736 
	`¡Üe_·¿m
(
¡mt
, 
i
, &
p
, (¡mt->
·¿m_ÿÎback
è? 0 : 
j
);

1742 
¡mt
->
£nd_ty³s_to_£rv”
= 0;

1743 *
»que¡_Ën
 = (
size_t
)(
p
 - 
¡¬t
);

1744  
¡¬t
;

1745 
mem_”rÜ
:

1746 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
CR_OUT_OF_MEMORY
, 
SQLSTATE_UNKNOWN
, 0);

1747 
	`ä“
(
¡¬t
);

1748 *
»que¡_Ën
= 0;

1749  
NULL
;

1750 
	}
}

1762 
STDCALL
 
	$mysql_¡mt_afãùed_rows
(
MYSQL_STMT
 *
¡mt
)

1764  
¡mt
->
up£¹_¡©us
.
afãùed_rows
;

1765 
	}
}

1767 
my_boÞ
 
STDCALL
 
	$mysql_¡mt_©Œ_g‘
(
MYSQL_STMT
 *
¡mt
, 
’um_¡mt_©Œ_ty³
 
©Œ_ty³
, *
v®ue
)

1769 
©Œ_ty³
) {

1770 
STMT_ATTR_STATE
:

1771 *(
mysql_¡mt_¡©e
 *)
v®ue
ð
¡mt
->
¡©e
;

1773 
STMT_ATTR_UPDATE_MAX_LENGTH
:

1774 *(
my_boÞ
 *)
v®ue
ð
¡mt
->
upd©e_max_Ëngth
;

1776 
STMT_ATTR_CURSOR_TYPE
:

1777 *(*)
v®ue
ð
¡mt
->
æags
;

1779 
STMT_ATTR_PREFETCH_ROWS
:

1780 *(*)
v®ue
ð
¡mt
->
´eãtch_rows
;

1782 
STMT_ATTR_PREBIND_PARAMS
:

1783 *(*)
v®ue
ð
¡mt
->
´ebšd_·¿ms
;

1785 
STMT_ATTR_ARRAY_SIZE
:

1786 *(*)
v®ue
ð
¡mt
->
¬¿y_size
;

1788 
STMT_ATTR_ROW_SIZE
:

1789 *(
size_t
 *)
v®ue
ð
¡mt
->
row_size
;

1791 
STMT_ATTR_CB_USER_DATA
:

1792 *((**)
v®ue
èð
¡mt
->
u£r_d©a
;

1798 
	}
}

1800 
my_boÞ
 
STDCALL
 
	$mysql_¡mt_©Œ_£t
(
MYSQL_STMT
 *
¡mt
, 
’um_¡mt_©Œ_ty³
 
©Œ_ty³
, cÚ¡ *
v®ue
)

1802 
©Œ_ty³
) {

1803 
STMT_ATTR_UPDATE_MAX_LENGTH
:

1804 
¡mt
->
upd©e_max_Ëngth
ð*(
my_boÞ
 *)
v®ue
;

1806 
STMT_ATTR_CURSOR_TYPE
:

1807 ià(*(
ulÚg
 *)
v®ue
 > (è
CURSOR_TYPE_READ_ONLY
)

1809 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
CR_NOT_IMPLEMENTED
, 
SQLSTATE_UNKNOWN
, 0);

1812 
¡mt
->
æags
 = *(
ulÚg
 *)
v®ue
;

1814 
STMT_ATTR_PREFETCH_ROWS
:

1815 ià(*(
ulÚg
 *)
v®ue
 == 0)

1816 *(*)
v®ue
ð
MYSQL_DEFAULT_PREFETCH_ROWS
;

1818 
¡mt
->
´eãtch_rows
ð*(*)
v®ue
;

1820 
STMT_ATTR_PREBIND_PARAMS
:

1821 ià(
¡mt
->
¡©e
 > 
MYSQL_STMT_INITTED
)

1823 
	`mysql_¡mt_š‹º®_»£t
(
¡mt
, 1);

1824 
	`Ãt_¡mt_þo£
(
¡mt
, 0);

1825 
¡mt
->
¡©e
ð
MYSQL_STMT_INITTED
;

1826 
¡mt
->
·¿ms
= 0;

1828 
¡mt
->
´ebšd_·¿ms
ð*(*)
v®ue
;

1830 
STMT_ATTR_ARRAY_SIZE
:

1831 
¡mt
->
¬¿y_size
ð*(*)
v®ue
;

1833 
STMT_ATTR_ROW_SIZE
:

1834 
¡mt
->
row_size
ð*(
size_t
 *)
v®ue
;

1836 
STMT_ATTR_CB_RESULT
:

1837 
¡mt
->
»suÉ_ÿÎback
ð(
ps_»suÉ_ÿÎback
)
v®ue
;

1839 
STMT_ATTR_CB_PARAM
:

1840 
¡mt
->
·¿m_ÿÎback
ð(
ps_·¿m_ÿÎback
)
v®ue
;

1842 
STMT_ATTR_CB_USER_DATA
:

1843 
¡mt
->
u£r_d©a
ð(*)
v®ue
;

1846 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
CR_NOT_IMPLEMENTED
, 
SQLSTATE_UNKNOWN
, 0);

1850 
	}
}

1852 
my_boÞ
 
STDCALL
 
	$mysql_¡mt_bšd_·¿m
(
MYSQL_STMT
 *
¡mt
, 
MYSQL_BIND
 *
bšd
)

1854 
MYSQL
 *
mysql
ð
¡mt
->mysql;

1856 ià(!
mysql
)

1858 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
CR_SERVER_LOST
, 
SQLSTATE_UNKNOWN
, 0);

1865 ià((
¡mt
->
¡©e
 < 
MYSQL_STMT_PREPARED
 || stmt->¡©>ð
MYSQL_STMT_EXECUTED
) &&

1866 
¡mt
->
´ebšd_·¿ms
 > 0)

1868 ià(!
¡mt
->
·¿ms
 && stmt->
´ebšd_·¿ms
)

1870 ià(!(
¡mt
->
·¿ms
ð(
MYSQL_BIND
 *)
	`ma_®loc_roÙ
(&¡mt->
mem_roÙ
, stmt->
´ebšd_·¿ms
 * (MYSQL_BIND))))

1872 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
CR_OUT_OF_MEMORY
, 
SQLSTATE_UNKNOWN
, 0);

1875 
	`mem£t
(
¡mt
->
·¿ms
, '\0', stmt->
´ebšd_·¿ms
 * (
MYSQL_BIND
));

1877 
¡mt
->
·¿m_couÁ
ð¡mt->
´ebšd_·¿ms
;

1879 ià(
¡mt
->
¡©e
 < 
MYSQL_STMT_PREPARED
) {

1880 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
CR_NO_PREPARE_STMT
, 
SQLSTATE_UNKNOWN
, 0);

1884 ià(
¡mt
->
·¿m_couÁ
 && 
bšd
)

1886 
ušt
 
i
;

1888 
	`memýy
(
¡mt
->
·¿ms
, 
bšd
, (
MYSQL_BIND
è* stmt->
·¿m_couÁ
);

1889 
¡mt
->
£nd_ty³s_to_£rv”
= 1;

1891 
i
=0; i < 
¡mt
->
·¿m_couÁ
; i++)

1893 ià(
¡mt
->
mysql
->
m‘hods
->
db_suµÜ‹d_bufãr_ty³
 &&

1894 !
¡mt
->
mysql
->
m‘hods
->
	`db_suµÜ‹d_bufãr_ty³
(¡mt->
·¿ms
[
i
].
bufãr_ty³
))

1896 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
CR_UNSUPPORTED_PARAM_TYPE
, 
SQLSTATE_UNKNOWN
, 0);

1899 ià(!
¡mt
->
·¿ms
[
i
].
is_nuÎ
)

1900 
¡mt
->
·¿ms
[
i
].
is_nuÎ
ð&
is_nÙ_nuÎ
;

1902 ià(
¡mt
->
·¿ms
[
i
].
lÚg_d©a_u£d
)

1903 
¡mt
->
·¿ms
[
i
].
lÚg_d©a_u£d
= 0;

1905 ià(!
¡mt
->
·¿ms
[
i
].
Ëngth
)

1906 
¡mt
->
·¿ms
[
i
].
Ëngth
ð&¡mt->·¿ms[i].
bufãr_Ëngth
;

1908 
¡mt
->
·¿ms
[
i
].
bufãr_ty³
) {

1909 
MYSQL_TYPE_NULL
:

1910 
¡mt
->
·¿ms
[
i
].
is_nuÎ
= &is_null;

1912 
MYSQL_TYPE_TINY
:

1913 
¡mt
->
·¿ms
[
i
].
bufãr_Ëngth
= 1;

1915 
MYSQL_TYPE_SHORT
:

1916 
MYSQL_TYPE_YEAR
:

1917 
¡mt
->
·¿ms
[
i
].
bufãr_Ëngth
= 2;

1919 
MYSQL_TYPE_LONG
:

1920 
MYSQL_TYPE_FLOAT
:

1921 
¡mt
->
·¿ms
[
i
].
bufãr_Ëngth
= 4;

1923 
MYSQL_TYPE_LONGLONG
:

1924 
MYSQL_TYPE_DOUBLE
:

1925 
¡mt
->
·¿ms
[
i
].
bufãr_Ëngth
= 8;

1927 
MYSQL_TYPE_DATETIME
:

1928 
MYSQL_TYPE_TIMESTAMP
:

1929 
¡mt
->
·¿ms
[
i
].
bufãr_Ëngth
= 12;

1931 
MYSQL_TYPE_TIME
:

1932 
¡mt
->
·¿ms
[
i
].
bufãr_Ëngth
= 13;

1934 
MYSQL_TYPE_DATE
:

1935 
¡mt
->
·¿ms
[
i
].
bufãr_Ëngth
= 5;

1938 
MYSQL_TYPE_CURSOR
:

1939 
¡mt
->
·¿ms
[
i
].
bufãr_Ëngth
= 4;

1941 
MYSQL_TYPE_OB_TIMESTAMP_WITH_TIME_ZONE
:

1943 
MYSQL_TYPE_OB_TIMESTAMP_NANO
:

1944 
MYSQL_TYPE_OB_TIMESTAMP_WITH_LOCAL_TIME_ZONE
:

1945 
¡mt
->
·¿ms
[
i
].
bufãr_Ëngth
= 13;

1947 
MYSQL_TYPE_ORA_BLOB
:

1948 
MYSQL_TYPE_ORA_CLOB
:

1949 
MYSQL_TYPE_OB_RAW
:

1950 
MYSQL_TYPE_VARCHAR
:

1951 
MYSQL_TYPE_OB_NVARCHAR2
:

1952 
MYSQL_TYPE_OB_NCHAR
:

1953 
MYSQL_TYPE_OB_NUMBER_FLOAT
:

1954 
MYSQL_TYPE_OB_UROWID
:

1955 
MYSQL_TYPE_OBJECT
:

1957 
MYSQL_TYPE_STRING
:

1958 
MYSQL_TYPE_JSON
:

1959 
MYSQL_TYPE_VAR_STRING
:

1960 
MYSQL_TYPE_BLOB
:

1961 
MYSQL_TYPE_TINY_BLOB
:

1962 
MYSQL_TYPE_MEDIUM_BLOB
:

1963 
MYSQL_TYPE_LONG_BLOB
:

1964 
MYSQL_TYPE_DECIMAL
:

1965 
MYSQL_TYPE_NEWDECIMAL
:

1968 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
CR_UNSUPPORTED_PARAM_TYPE
, 
SQLSTATE_UNKNOWN
, 0);

1974 
¡mt
->
bšd_·¿m_dÚe
ð¡mt->
£nd_ty³s_to_£rv”
= 1;

1976 
	`CLEAR_CLIENT_STMT_ERROR
(
¡mt
);

1978 
	}
}

1980 
my_boÞ
 
STDCALL
 
	$mysql_¡mt_bšd_»suÉ
(
MYSQL_STMT
 *
¡mt
, 
MYSQL_BIND
 *
bšd
)

1982 
ušt
 
i
;

1984 ià(
¡mt
->
¡©e
 < 
MYSQL_STMT_PREPARED
)

1986 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
CR_NO_PREPARE_STMT
, 
SQLSTATE_UNKNOWN
, 0);

1990 ià(!
¡mt
->
f›ld_couÁ
)

1992 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
CR_NO_STMT_METADATA
, 
SQLSTATE_UNKNOWN
, 0);

1996 ià(!
bšd
)

2003 ià(
¡mt
->
f›ld_couÁ
 && !¡mt->
bšd
)

2005 
MA_MEM_ROOT
 *
f›lds_ma_®loc_roÙ
=

2006 &((
MADB_STMT_EXTENSION
 *)
¡mt
->
ex‹nsiÚ
)->
f›lds_ma_®loc_roÙ
;

2007 ià(!(
¡mt
->
bšd
ð(
MYSQL_BIND
 *)
	`ma_®loc_roÙ
(
f›lds_ma_®loc_roÙ
, stmt->
f›ld_couÁ
 * (MYSQL_BIND))))

2009 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
CR_OUT_OF_MEMORY
, 
SQLSTATE_UNKNOWN
, 0);

2014 
	`memýy
(
¡mt
->
bšd
, bšd, (
MYSQL_BIND
è* stmt->
f›ld_couÁ
);

2016 
i
=0; i < 
¡mt
->
f›ld_couÁ
; i++)

2018 ià(
¡mt
->
mysql
->
m‘hods
->
db_suµÜ‹d_bufãr_ty³
 &&

2019 !
¡mt
->
mysql
->
m‘hods
->
	`db_suµÜ‹d_bufãr_ty³
(
bšd
[
i
].
bufãr_ty³
))

2021 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
CR_UNSUPPORTED_PARAM_TYPE
, 
SQLSTATE_UNKNOWN
, 0);

2025 ià(!
¡mt
->
bšd
[
i
].
is_nuÎ
)

2026 
¡mt
->
bšd
[
i
].
is_nuÎ
ð&¡mt->bšd[i].
is_nuÎ_v®ue
;

2027 ià(!
¡mt
->
bšd
[
i
].
Ëngth
)

2028 
¡mt
->
bšd
[
i
].
Ëngth
ð&¡mt->bšd[i].
Ëngth_v®ue
;

2029 ià(!
¡mt
->
bšd
[
i
].
”rÜ
)

2030 
¡mt
->
bšd
[
i
].
”rÜ
ð&¡mt->bšd[i].
”rÜ_v®ue
;

2033 
bšd
[
i
].
bufãr_ty³
) {

2034 
MYSQL_TYPE_NULL
:

2035 *
¡mt
->
bšd
[
i
].
Ëngth
ð¡mt->bšd[i].
Ëngth_v®ue
= 0;

2037 
MYSQL_TYPE_TINY
:

2038 *
¡mt
->
bšd
[
i
].
Ëngth
ð¡mt->bšd[i].
Ëngth_v®ue
= 1;

2040 
MYSQL_TYPE_SHORT
:

2041 
MYSQL_TYPE_YEAR
:

2042 *
¡mt
->
bšd
[
i
].
Ëngth
ð¡mt->bšd[i].
Ëngth_v®ue
= 2;

2044 
MYSQL_TYPE_INT24
:

2045 
MYSQL_TYPE_LONG
:

2046 
MYSQL_TYPE_FLOAT
:

2047 *
¡mt
->
bšd
[
i
].
Ëngth
ð¡mt->bšd[i].
Ëngth_v®ue
= 4;

2049 
MYSQL_TYPE_LONGLONG
:

2050 
MYSQL_TYPE_DOUBLE
:

2051 *
¡mt
->
bšd
[
i
].
Ëngth
ð¡mt->bšd[i].
Ëngth_v®ue
= 8;

2053 
MYSQL_TYPE_TIME
:

2054 
MYSQL_TYPE_DATE
:

2055 
MYSQL_TYPE_DATETIME
:

2056 
MYSQL_TYPE_TIMESTAMP
:

2057 *
¡mt
->
bšd
[
i
].
Ëngth
ð¡mt->bšd[i].
Ëngth_v®ue
ð(
MYSQL_TIME
);

2063 
¡mt
->
bšd_»suÉ_dÚe
= 1;

2064 
	`CLEAR_CLIENT_STMT_ERROR
(
¡mt
);

2067 
	}
}

2069 
my_boÞ
 
	$Ãt_¡mt_þo£
(
MYSQL_STMT
 *
¡mt
, 
my_boÞ
 
»move
)

2071 
¡mt_id
[
STMT_ID_LENGTH
];

2072 
MA_MEM_ROOT
 *
f›lds_ma_®loc_roÙ
ð&((
MADB_STMT_EXTENSION
 *)
¡mt
->
ex‹nsiÚ
)->fields_ma_alloc_root;

2075 
	`ma_ä“_roÙ
(&
¡mt
->
»suÉ
.
®loc
, 
	`MYF
(0));

2076 
	`ma_ä“_roÙ
(&
¡mt
->
mem_roÙ
,
	`MYF
(0));

2077 
	`ma_ä“_roÙ
(
f›lds_ma_®loc_roÙ
, 
	`MYF
(0));

2079 ià(
¡mt
->
mysql
)

2081 
	`CLEAR_CLIENT_ERROR
(
¡mt
->
mysql
);

2084 ià(
»move
)

2085 
¡mt
->
mysql
->
¡mts
ð
	`li¡_d–‘e
(¡mt->mysql->¡mts, &¡mt->
li¡
);

2088 ià(
¡mt
->
mysql
->
¡©us
 !ð
MYSQL_STATUS_READY
)

2091 
¡mt
->
mysql
->
m‘hods
->
	`db_¡mt_æush_unbufã»d
(stmt);

2092 } 
	`mysql_¡mt_mÜe_»suÉs
(
¡mt
));

2093 
¡mt
->
mysql
->
¡©us
ð
MYSQL_STATUS_READY
;

2095 ià(
¡mt
->
¡©e
 > 
MYSQL_STMT_INITTED
)

2097 
	`št4¡Üe
(
¡mt_id
, 
¡mt
->stmt_id);

2098 ià(
¡mt
->
mysql
->
m‘hods
->
	`db_commªd
(¡mt->mysql,
COM_STMT_CLOSE
, 
¡mt_id
,

2099 (
¡mt_id
), 1, 
¡mt
))

2101 
	`UPDATE_STMT_ERROR
(
¡mt
);

2107 
	}
}

2109 
my_boÞ
 
STDCALL
 
	$mysql_¡mt_þo£
(
MYSQL_STMT
 *
¡mt
)

2111 
my_boÞ
 
rc
= 1;

2113 ià(
¡mt
)

2115 ià(
¡mt
->
mysql
 && stmt->mysql->
Ãt
.
pvio
)

2116 
	`mysql_¡mt_š‹º®_»£t
(
¡mt
, 1);

2118 
rc
ð
	`Ãt_¡mt_þo£
(
¡mt
, 1);

2120 
	`ä“
(
¡mt
->
ex‹nsiÚ
);

2121 
	`ä“
(
¡mt
);

2123 (
rc
);

2124 
	}
}

2126 
STDCALL
 
	$mysql_¡mt_d©a_£ek
(
MYSQL_STMT
 *
¡mt
, 
off£t
)

2128 
i
ð
off£t
;

2129 
MYSQL_ROWS
 *
±r
ð
¡mt
->
»suÉ
.
d©a
;

2131 
i
-- && 
±r
)

2132 
±r
ð±r->
Ãxt
;

2134 
¡mt
->
»suÉ_cursÜ
ð
±r
;

2135 
¡mt
->
¡©e
ð
MYSQL_STMT_USER_FETCHING
;

2138 
	}
}

2140 
STDCALL
 
	$mysql_¡mt_”ºo
(
MYSQL_STMT
 *
¡mt
)

2142  
¡mt
->
Ï¡_”ºo
;

2143 
	}
}

2145 cÚ¡ * 
STDCALL
 
	$mysql_¡mt_”rÜ
(
MYSQL_STMT
 *
¡mt
)

2147  (cÚ¡ *)
¡mt
->
Ï¡_”rÜ
;

2148 
	}
}

2150 
	$mthd_¡mt_ãtch_row
(
MYSQL_STMT
 *
¡mt
, **
row
)

2152  
¡mt
->
	`ãtch_row_func
(¡mt, 
row
);

2153 
	}
}

2155 
STDCALL
 
	$mysql_¡mt_ãtch
(
MYSQL_STMT
 *
¡mt
)

2157 *
row
;

2158 
rc
;

2160 ià(
¡mt
->
¡©e
 <ð
MYSQL_STMT_EXECUTED
)

2162 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
CR_COMMANDS_OUT_OF_SYNC
, 
SQLSTATE_UNKNOWN
, 0);

2166 ià(
¡mt
->
¡©e
 < 
MYSQL_STMT_WAITING_USE_OR_STORE
 || !¡mt->
f›ld_couÁ
)

2168 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
CR_COMMANDS_OUT_OF_SYNC
, 
SQLSTATE_UNKNOWN
, 0);

2170 } ià(
¡mt
->
¡©e
=ð
MYSQL_STMT_WAITING_USE_OR_STORE
)

2172 
¡mt
->
	`deçuÉ_r£t_hªdËr
(stmt);

2175 ià(
¡mt
->
¡©e
 =ð
MYSQL_STMT_FETCH_DONE
)

2176 (
MYSQL_NO_DATA
);

2178 ià((
rc
ð
¡mt
->
mysql
->
m‘hods
->
	`db_¡mt_ãtch
(¡mt, &
row
)))

2180 
¡mt
->
¡©e
ð
MYSQL_STMT_FETCH_DONE
;

2181 
¡mt
->
mysql
->
¡©us
ð
MYSQL_STATUS_READY
;

2183 (
rc
);

2186 
rc
ð
¡mt
->
mysql
->
m‘hods
->
	`db_¡mt_ãtch_to_bšd
(¡mt, 
row
);

2188 
¡mt
->
¡©e
ð
MYSQL_STMT_USER_FETCHING
;

2189 
	`CLEAR_CLIENT_ERROR
(
¡mt
->
mysql
);

2190 
	`CLEAR_CLIENT_STMT_ERROR
(
¡mt
);

2191 (
rc
);

2192 
	}
}

2194 
STDCALL
 
	$mysql_¡mt_ãtch_cÞumn
(
MYSQL_STMT
 *
¡mt
, 
MYSQL_BIND
 *
bšd
, 
cÞumn
, 
off£t
)

2196 ià(
¡mt
->
¡©e
 < 
MYSQL_STMT_USER_FETCHING
 || 
cÞumn
 >ð¡mt->
f›ld_couÁ
 ||

2197 
¡mt
->
¡©e
 =ð
MYSQL_STMT_FETCH_DONE
) {

2198 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
CR_NO_DATA
, 
SQLSTATE_UNKNOWN
, 0);

2202 ià(!
¡mt
->
bšd
[
cÞumn
].
u
.
row_±r
)

2205 ià(
bšd
[0].
is_nuÎ
)

2206 *
bšd
[0].
is_nuÎ
= 1;

2210 *
§ve_±r
;

2211 ià(
bšd
[0].
Ëngth
)

2212 *
bšd
[0].
Ëngth
ð*
¡mt
->bšd[
cÞumn
].length;

2214 
bšd
[0].
Ëngth
ð&
¡mt
->bšd[
cÞumn
].
Ëngth_v®ue
;

2215 ià(
bšd
[0].
is_nuÎ
)

2216 *
bšd
[0].
is_nuÎ
= 0;

2218 
bšd
[0].
is_nuÎ
ð&bšd[0].
is_nuÎ_v®ue
;

2219 ià(!
bšd
[0].
”rÜ
)

2220 
bšd
[0].
”rÜ
ð&bšd[0].
”rÜ_v®ue
;

2221 *
bšd
[0].
”rÜ
= 0;

2222 
bšd
[0].
off£t
= offset;

2223 
§ve_±r
ð
¡mt
->
bšd
[
cÞumn
].
u
.
row_±r
;

2224 
mysql_ps_ãtch_funùiÚs
[
¡mt
->
f›lds
[
cÞumn
].
ty³
].
	`func
(&
bšd
[0], &¡mt->f›lds[cÞumn], &¡mt->bšd[cÞumn].
u
.
row_±r
);

2225 
¡mt
->
bšd
[
cÞumn
].
u
.
row_±r
ð
§ve_±r
;

2228 
	}
}

2230 
STDCALL
 
	$mysql_¡mt_f›ld_couÁ
(
MYSQL_STMT
 *
¡mt
)

2232  
¡mt
->
f›ld_couÁ
;

2233 
	}
}

2235 
my_boÞ
 
STDCALL
 
	$mysql_¡mt_ä“_»suÉ
(
MYSQL_STMT
 *
¡mt
)

2237  
	`madb_»£t_¡mt
(
¡mt
, 
MADB_RESET_LONGDATA
 | 
MADB_RESET_STORED
 |

2238 
MADB_RESET_BUFFER
 | 
MADB_RESET_ERROR
);

2239 
	}
}

2241 
MYSQL_STMT
 * 
STDCALL
 
	$mysql_¡mt_š™
(
MYSQL
 *
mysql
)

2244 
MYSQL_STMT
 *
¡mt
ð
NULL
;

2246 ià(!(
¡mt
ð(
MYSQL_STMT
 *)
	`ÿÎoc
(1, (MYSQL_STMT))) ||

2247 !(
¡mt
->
ex‹nsiÚ
ð(
MADB_STMT_EXTENSION
 *)
	`ÿÎoc
(1, (MADB_STMT_EXTENSION))))

2249 
	`ä“
(
¡mt
);

2250 
	`SET_CLIENT_ERROR
(
mysql
, 
CR_OUT_OF_MEMORY
, 
SQLSTATE_UNKNOWN
, 0);

2251 (
NULL
);

2256 
¡mt
->
li¡
.
d©a
= stmt;

2257 
¡mt
->
mysql
= mysql;

2258 
¡mt
->
¡mt_id
= 0;

2259 
mysql
->
¡mts
ð
	`li¡_add
(mysql->¡mts, &
¡mt
->
li¡
);

2263 
	`¡rýy
(
¡mt
->
sql¡©e
, "00000");

2265 
¡mt
->
¡©e
ð
MYSQL_STMT_INITTED
;

2268 
¡mt
->
´eãtch_rows
= 1;

2270 
	`ma_š™_®loc_roÙ
(&
¡mt
->
mem_roÙ
, 2048, 2048);

2271 
	`ma_š™_®loc_roÙ
(&
¡mt
->
»suÉ
.
®loc
, 4096, 4096);

2272 
	`ma_š™_®loc_roÙ
(&((
MADB_STMT_EXTENSION
 *)
¡mt
->
ex‹nsiÚ
)->
f›lds_ma_®loc_roÙ
, 2048, 2048);

2274 (
¡mt
);

2275 
	}
}

2277 
my_boÞ
 
	$mthd_¡mt_»ad_´•¬e_»¥Ú£
(
MYSQL_STMT
 *
¡mt
)

2279 
ulÚg
 
·ck‘_Ëngth
;

2280 
uch¬
 *
p
;

2282 ià((
·ck‘_Ëngth
ð
	`ma_Ãt_§ã_»ad
(
¡mt
->
mysql
)è=ð
·ck‘_”rÜ
)

2285 
p
ð(
uch¬
 *)
¡mt
->
mysql
->
Ãt
.
»ad_pos
;

2287 ià(0xFF =ð
p
[0])

2292 
p
++;

2293 
¡mt
->
¡mt_id
ð
	`ušt4kÜr
(
p
);

2294 
p
+= 4;

2295 
¡mt
->
f›ld_couÁ
ð
	`ušt2kÜr
(
p
);

2296 
p
+= 2;

2297 
¡mt
->
·¿m_couÁ
ð
	`ušt2kÜr
(
p
);

2298 
p
+= 2;

2301 
p
++;

2303 
¡mt
->
mysql
->
w¬nšg_couÁ
ð¡mt->
up£¹_¡©us
.w¬nšg_couÁð
	`ušt2kÜr
(
p
);

2305 
	}
}

2307 
my_boÞ
 
	$mthd_¡mt_g‘_·¿m_m‘ad©a
(
MYSQL_STMT
 *
¡mt
)

2309 
MYSQL_DATA
 *
»suÉ
;

2311 ià(!(
»suÉ
ð
¡mt
->
mysql
->
m‘hods
->
	`db_»ad_rows
(¡mt->mysql, (
MYSQL_FIELD
 *)0,

2312 7 + 
	`ma_ex‹nded_ty³_šfo_rows
(
¡mt
->
mysql
))))

2315 
	`ä“_rows
(
»suÉ
);

2317 
	}
}

2319 
my_boÞ
 
	$mthd_¡mt_g‘_»suÉ_m‘ad©a
(
MYSQL_STMT
 *
¡mt
)

2321 
MYSQL_DATA
 *
»suÉ
;

2322 
MA_MEM_ROOT
 *
f›lds_ma_®loc_roÙ
ð&((
MADB_STMT_EXTENSION
 *)
¡mt
->
ex‹nsiÚ
)->fields_ma_alloc_root;

2324 ià(!(
»suÉ
ð
¡mt
->
mysql
->
m‘hods
->
	`db_»ad_rows
(¡mt->mysql, (
MYSQL_FIELD
 *)0,

2325 7 + 
	`ma_ex‹nded_ty³_šfo_rows
(
¡mt
->
mysql
))))

2327 ià(!(
¡mt
->
f›lds
ð
	`uÅack_f›lds
(¡mt->
mysql
, 
»suÉ
, 
f›lds_ma_®loc_roÙ
,

2328 
¡mt
->
f›ld_couÁ
, 0)))

2331 
	}
}

2333 
STDCALL
 
	$mysql_¡mt_w¬nšg_couÁ
(
MYSQL_STMT
 *
¡mt
)

2335  
¡mt
->
up£¹_¡©us
.
w¬nšg_couÁ
;

2336 
	}
}

2338 
STDCALL
 
	$mysql_¡mt_´•¬e
(
MYSQL_STMT
 *
¡mt
, cÚ¡ *
qu”y
, 
Ëngth
)

2340 
MYSQL
 *
mysql
ð
¡mt
->mysql;

2341 
rc
= 1;

2342 
my_boÞ
 
is_muÉi
= 0;

2344 ià(!
¡mt
->
mysql
)

2346 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
CR_SERVER_LOST
, 
SQLSTATE_UNKNOWN
, 0);

2350 ià(
Ëngth
 == () -1)

2351 
Ëngth
ð()
	`¡¾’
(
qu”y
);

2354 
	`CLEAR_CLIENT_STMT_ERROR
(
¡mt
);

2355 
	`CLEAR_CLIENT_ERROR
(
¡mt
->
mysql
);

2356 
¡mt
->
up£¹_¡©us
.
afãùed_rows
ð
mysql
->affected_rows= () ~0;

2359 ià(
¡mt
->
¡©e
 > 
MYSQL_STMT_INITTED
)

2361 
¡mt_id
[
STMT_ID_LENGTH
];

2362 
is_muÉi
ð(
mysql
->
Ãt
.
ex‹nsiÚ
->
muÉi_¡©us
 > 
COM_MULTI_OFF
);

2367 ià(!
is_muÉi
)

2368 
	`ma_muÉi_commªd
(
mysql
, 
COM_MULTI_ENABLED
);

2370 ià(
	`mysql_¡mt_š‹º®_»£t
(
¡mt
, 1))

2371 
çž
;

2373 
	`ma_ä“_roÙ
(&
¡mt
->
mem_roÙ
, 
	`MYF
(
MY_KEEP_PREALLOC
));

2374 
	`ma_ä“_roÙ
(&((
MADB_STMT_EXTENSION
 *)
¡mt
->
ex‹nsiÚ
)->
f›lds_ma_®loc_roÙ
, 
	`MYF
(0));

2376 
¡mt
->
·¿m_couÁ
= 0;

2377 
¡mt
->
f›ld_couÁ
= 0;

2378 
¡mt
->
·¿ms
= 0;

2380 
	`št4¡Üe
(
¡mt_id
, 
¡mt
->stmt_id);

2381 ià(
mysql
->
m‘hods
->
	`db_commªd
(mysql, 
COM_STMT_CLOSE
, 
¡mt_id
,

2382 (
¡mt_id
), 1, 
¡mt
))

2383 
çž
;

2385 ià(
mysql
->
m‘hods
->
	`db_commªd
(mysql, 
COM_STMT_PREPARE
, 
qu”y
, 
Ëngth
, 1, 
¡mt
))

2386 
çž
;

2388 ià(!
is_muÉi
 && 
mysql
->
Ãt
.
ex‹nsiÚ
->
muÉi_¡©us
 =ð
COM_MULTI_ENABLED
)

2389 
	`ma_muÉi_commªd
(
mysql
, 
COM_MULTI_END
);

2391 ià(
mysql
->
Ãt
.
ex‹nsiÚ
->
muÉi_¡©us
 > 
COM_MULTI_OFF
)

2394 ià(
mysql
->
m‘hods
->
db_»ad_´•¬e_»¥Ú£
 &&

2395 
mysql
->
m‘hods
->
	`db_»ad_´•¬e_»¥Ú£
(
¡mt
))

2396 
çž
;

2400 ià(
¡mt
->
·¿m_couÁ
 &&

2401 
¡mt
->
mysql
->
m‘hods
->
	`db_¡mt_g‘_·¿m_m‘ad©a
(stmt))

2403 
çž
;

2407 ià(
¡mt
->
f›ld_couÁ
 &&

2408 
¡mt
->
mysql
->
m‘hods
->
	`db_¡mt_g‘_»suÉ_m‘ad©a
(stmt))

2410 
çž
;

2412 ià(
¡mt
->
·¿m_couÁ
)

2414 ià(
¡mt
->
´ebšd_·¿ms
)

2416 ià(
¡mt
->
´ebšd_·¿ms
 !ð¡mt->
·¿m_couÁ
)

2418 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
CR_INVALID_PARAMETER_NO
, 
SQLSTATE_UNKNOWN
, 0);

2419 
çž
;

2422 ià(!(
¡mt
->
·¿ms
ð(
MYSQL_BIND
 *)
	`ma_®loc_roÙ
(&¡mt->
mem_roÙ
, stmt->
·¿m_couÁ
 * (MYSQL_BIND))))

2424 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
CR_OUT_OF_MEMORY
, 
SQLSTATE_UNKNOWN
, 0);

2425 
çž
;

2427 
	`mem£t
(
¡mt
->
·¿ms
, '\0', stmt->
·¿m_couÁ
 * (
MYSQL_BIND
));

2431 ià(
¡mt
->
f›ld_couÁ
)

2433 
MA_MEM_ROOT
 *
f›lds_ma_®loc_roÙ
ð&((
MADB_STMT_EXTENSION
 *)
¡mt
->
ex‹nsiÚ
)->fields_ma_alloc_root;

2434 ià(!(
¡mt
->
bšd
ð(
MYSQL_BIND
 *)
	`ma_®loc_roÙ
(
f›lds_ma_®loc_roÙ
, stmt->
f›ld_couÁ
 * (MYSQL_BIND))))

2436 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
CR_OUT_OF_MEMORY
, 
SQLSTATE_UNKNOWN
, 0);

2437 
çž
;

2439 
	`mem£t
(
¡mt
->
bšd
, 0, (
MYSQL_BIND
è* stmt->
f›ld_couÁ
);

2441 
¡mt
->
¡©e
 = 
MYSQL_STMT_PREPARED
;

2444 
çž
:

2445 
¡mt
->
¡©e
ð
MYSQL_STMT_INITTED
;

2446 
	`UPDATE_STMT_ERROR
(
¡mt
);

2447 (
rc
);

2448 
	}
}

2450 
STDCALL
 
	$mysql_¡mt_¡Üe_»suÉ
(
MYSQL_STMT
 *
¡mt
)

2452 
Ï¡_£rv”_¡©us
;

2454 ià(!
¡mt
->
mysql
)

2456 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
CR_SERVER_LOST
, 
SQLSTATE_UNKNOWN
, 0);

2460 ià(!
¡mt
->
f›ld_couÁ
)

2464 ià(
¡mt
->
Ï¡_”ºo
)

2467 ià(
¡mt
->
¡©e
 < 
MYSQL_STMT_EXECUTED
)

2469 
	`SET_CLIENT_ERROR
(
¡mt
->
mysql
, 
CR_COMMANDS_OUT_OF_SYNC
, 
SQLSTATE_UNKNOWN
, 0);

2470 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
CR_COMMANDS_OUT_OF_SYNC
, 
SQLSTATE_UNKNOWN
, 0);

2474 
Ï¡_£rv”_¡©us
ð
¡mt
->
mysql
->
£rv”_¡©us
;

2477 ià(
¡mt
->
cursÜ_exi¡s
 && stmt->
mysql
->
¡©us
 =ð
MYSQL_STATUS_READY
)

2479 
buff
[
STMT_ID_LENGTH
 + 4];

2480 
	`št4¡Üe
(
buff
, 
¡mt
->
¡mt_id
);

2481 
	`št4¡Üe
(
buff
 + 
STMT_ID_LENGTH
, ()~0);

2483 ià(
¡mt
->
mysql
->
m‘hods
->
	`db_commªd
(¡mt->mysql, 
COM_STMT_FETCH
,

2484 
buff
, (buff), 1, 
¡mt
))

2486 
	`UPDATE_STMT_ERROR
(
¡mt
);

2490 ià(
¡mt
->
mysql
->
¡©us
 !ð
MYSQL_STATUS_STMT_RESULT
)

2492 
	`SET_CLIENT_ERROR
(
¡mt
->
mysql
, 
CR_COMMANDS_OUT_OF_SYNC
, 
SQLSTATE_UNKNOWN
, 0);

2493 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
CR_COMMANDS_OUT_OF_SYNC
, 
SQLSTATE_UNKNOWN
, 0);

2497 ià(
¡mt
->
mysql
->
m‘hods
->
	`db_¡mt_»ad_®l_rows
(stmt))

2500 
	`ma_ä“_roÙ
(&
¡mt
->
»suÉ
.
®loc
, 0);

2501 
¡mt
->
»suÉ
.
d©a
ð
NULL
;

2502 
¡mt
->
»suÉ
.
rows
= 0;

2503 
¡mt
->
mysql
->
¡©us
ð
MYSQL_STATUS_READY
;

2511 ià(
Ï¡_£rv”_¡©us
 & 
SERVER_PS_OUT_PARAMS
 &&

2512 !(
¡mt
->
mysql
->
£rv”_¡©us
 & 
SERVER_MORE_RESULTS_EXIST
))

2513 
¡mt
->
mysql
->
£rv”_¡©us
|ð
SERVER_MORE_RESULTS_EXIST
;

2515 
¡mt
->
»suÉ_cursÜ
ð¡mt->
»suÉ
.
d©a
;

2516 
¡mt
->
ãtch_row_func
ð
¡mt_bufã»d_ãtch
;

2517 
¡mt
->
mysql
->
¡©us
ð
MYSQL_STATUS_READY
;

2519 ià(!
¡mt
->
»suÉ
.
rows
)

2520 
¡mt
->
¡©e
ð
MYSQL_STMT_FETCH_DONE
;

2522 
¡mt
->
¡©e
ð
MYSQL_STMT_USE_OR_STORE_CALLED
;

2525 
¡mt
->
up£¹_¡©us
.
afãùed_rows
ð¡mt->
»suÉ
.
rows
;

2526 
¡mt
->
mysql
->
afãùed_rows
ð¡mt->
»suÉ
.
rows
;

2529 
	}
}

2531 
	$madb_®loc_¡mt_f›lds
(
MYSQL_STMT
 *
¡mt
)

2533 
ušt
 
i
;

2534 
MA_MEM_ROOT
 *
f›lds_ma_®loc_roÙ
ð&((
MADB_STMT_EXTENSION
 *)
¡mt
->
ex‹nsiÚ
)->fields_ma_alloc_root;

2536 ià(
¡mt
->
mysql
->
f›ld_couÁ
)

2538 
	`ma_ä“_roÙ
(
f›lds_ma_®loc_roÙ
, 
	`MYF
(0));

2539 ià(!(
¡mt
->
f›lds
ð(
MYSQL_FIELD
 *)
	`ma_®loc_roÙ
(
f›lds_ma_®loc_roÙ
,

2540 (
MYSQL_FIELD
è* 
¡mt
->
mysql
->
f›ld_couÁ
)))

2542 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
CR_OUT_OF_MEMORY
, 
SQLSTATE_UNKNOWN
, 0);

2545 
¡mt
->
f›ld_couÁ
ð¡mt->
mysql
->field_count;

2547 
i
=0; i < 
¡mt
->
f›ld_couÁ
; i++)

2549 ià(
¡mt
->
mysql
->
f›lds
[
i
].
db
)

2550 
¡mt
->
f›lds
[
i
].
db
ð
	`ma_¡rdup_roÙ
(
f›lds_ma_®loc_roÙ
, stmt->
mysql
->fields[i].db);

2551 ià(
¡mt
->
mysql
->
f›lds
[
i
].
bË
)

2552 
¡mt
->
f›lds
[
i
].
bË
ð
	`ma_¡rdup_roÙ
(
f›lds_ma_®loc_roÙ
, stmt->
mysql
->fields[i].table);

2553 ià(
¡mt
->
mysql
->
f›lds
[
i
].
Üg_bË
)

2554 
¡mt
->
f›lds
[
i
].
Üg_bË
ð
	`ma_¡rdup_roÙ
(
f›lds_ma_®loc_roÙ
, stmt->
mysql
->fields[i].org_table);

2555 ià(
¡mt
->
mysql
->
f›lds
[
i
].
Çme
)

2556 
¡mt
->
f›lds
[
i
].
Çme
ð
	`ma_¡rdup_roÙ
(
f›lds_ma_®loc_roÙ
, stmt->
mysql
->fields[i].name);

2557 ià(
¡mt
->
mysql
->
f›lds
[
i
].
Üg_Çme
)

2558 
¡mt
->
f›lds
[
i
].
Üg_Çme
ð
	`ma_¡rdup_roÙ
(
f›lds_ma_®loc_roÙ
, stmt->
mysql
->fields[i].org_name);

2559 ià(
¡mt
->
mysql
->
f›lds
[
i
].
ÿlog
)

2560 
¡mt
->
f›lds
[
i
].
ÿlog
ð
	`ma_¡rdup_roÙ
(
f›lds_ma_®loc_roÙ
, stmt->
mysql
->fields[i].catalog);

2561 
¡mt
->
f›lds
[
i
].
def
ð¡mt->
mysql
->f›lds[i].deà? 
	`ma_¡rdup_roÙ
(
f›lds_ma_®loc_roÙ
, stmt->mysql->f›lds[i].defè: 
NULL
;

2562 
¡mt
->
f›lds
[
i
].
ty³
ð¡mt->
mysql
->fields[i].type;

2563 
¡mt
->
f›lds
[
i
].
Ëngth
ð¡mt->
mysql
->fields[i].length;

2564 
¡mt
->
f›lds
[
i
].
æags
ð¡mt->
mysql
->fields[i].flags;

2565 
¡mt
->
f›lds
[
i
].
decim®s
ð¡mt->
mysql
->fields[i].decimals;

2566 
¡mt
->
f›lds
[
i
].
ch¬£Šr
ð¡mt->
mysql
->fields[i].charsetnr;

2567 
¡mt
->
f›lds
[
i
].
max_Ëngth
ð¡mt->
mysql
->fields[i].max_length;

2568 
¡mt
->
f›lds
[
i
].
ex‹nsiÚ
=

2569 
¡mt
->
mysql
->
f›lds
[
i
].
ex‹nsiÚ
 ?

2570 
	`ma_f›ld_ex‹nsiÚ_d“p_dup
(
f›lds_ma_®loc_roÙ
,

2571 
¡mt
->
mysql
->
f›lds
[
i
].
ex‹nsiÚ
) :

2572 
NULL
;

2574 ià(!(
¡mt
->
bšd
ð(
MYSQL_BIND
 *)
	`ma_®loc_roÙ
(
f›lds_ma_®loc_roÙ
, stmt->
f›ld_couÁ
 * (MYSQL_BIND))))

2576 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
CR_OUT_OF_MEMORY
, 
SQLSTATE_UNKNOWN
, 0);

2579 
	`mem£t
(
¡mt
->
bšd
, 0, stmt->
f›ld_couÁ
 * (
MYSQL_BIND
));

2580 
¡mt
->
bšd_»suÉ_dÚe
= 0;

2583 
	}
}

2585 
	$¡mt_»ad_execu‹_»¥Ú£
(
MYSQL_STMT
 *
¡mt
)

2587 
MYSQL
 *
mysql
ð
¡mt
->mysql;

2588 
»t
;

2590 ià(!
mysql
)

2593 
»t
ð
	`‹¡
((
mysql
->
m‘hods
->
db_»ad_¡mt_»suÉ
 &&

2594 
mysql
->
m‘hods
->
	`db_»ad_¡mt_»suÉ
(mysql)));

2596 ià(!
¡mt
->
mysql
)

2600 
¡mt
->
up£¹_¡©us
.
afãùed_rows
ð¡mt->
mysql
->affected_rows;

2602 ià(
»t
)

2604 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
mysql
->
Ãt
.
Ï¡_”ºo
, mysql->Ãt.
sql¡©e
,

2605 
mysql
->
Ãt
.
Ï¡_”rÜ
);

2606 
¡mt
->
¡©e
ð
MYSQL_STMT_PREPARED
;

2609 
¡mt
->
up£¹_¡©us
.
Ï¡_š£¹_id
ð
mysql
->
š£¹_id
;

2610 
¡mt
->
up£¹_¡©us
.
£rv”_¡©us
ð
mysql
->server_status;

2611 
¡mt
->
up£¹_¡©us
.
w¬nšg_couÁ
ð
mysql
->warning_count;

2613 
	`CLEAR_CLIENT_ERROR
(
mysql
);

2614 
	`CLEAR_CLIENT_STMT_ERROR
(
¡mt
);

2616 
¡mt
->
execu‹_couÁ
++;

2617 
¡mt
->
£nd_ty³s_to_£rv”
= 0;

2619 
¡mt
->
¡©e
ð
MYSQL_STMT_EXECUTED
;

2621 ià(
mysql
->
f›ld_couÁ
)

2623 ià(!
¡mt
->
f›ld_couÁ
 ||

2624 
mysql
->
£rv”_¡©us
 & 
SERVER_MORE_RESULTS_EXIST
)

2626 
MA_MEM_ROOT
 *
f›lds_ma_®loc_roÙ
=

2627 &((
MADB_STMT_EXTENSION
 *)
¡mt
->
ex‹nsiÚ
)->
f›lds_ma_®loc_roÙ
;

2628 
ušt
 
i
;

2630 
	`ma_ä“_roÙ
(
f›lds_ma_®loc_roÙ
, 
	`MYF
(0));

2631 ià(!(
¡mt
->
bšd
ð(
MYSQL_BIND
 *)
	`ma_®loc_roÙ
(
f›lds_ma_®loc_roÙ
,

2632 (
MYSQL_BIND
è* 
mysql
->
f›ld_couÁ
)) ||

2633 !(
¡mt
->
f›lds
ð(
MYSQL_FIELD
 *)
	`ma_®loc_roÙ
(
f›lds_ma_®loc_roÙ
,

2634 (
MYSQL_FIELD
è* 
mysql
->
f›ld_couÁ
)))

2636 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
CR_OUT_OF_MEMORY
, 
SQLSTATE_UNKNOWN
, 0);

2639 
	`mem£t
(
¡mt
->
bšd
, 0, (
MYSQL_BIND
è* 
mysql
->
f›ld_couÁ
);

2640 
¡mt
->
f›ld_couÁ
ð
mysql
->field_count;

2642 
i
=0; i < 
¡mt
->
f›ld_couÁ
; i++)

2644 
	`memýy
(&
¡mt
->
f›lds
[
i
], &
mysql
->f›lds[i], (
MYSQL_FIELD
));

2649 ià(
mysql
->
f›lds
[
i
].
db
)

2650 
¡mt
->
f›lds
[
i
].
db
ð
	`ma_¡rdup_roÙ
(
f›lds_ma_®loc_roÙ
, 
mysql
->fields[i].db);

2651 ià(
mysql
->
f›lds
[
i
].
bË
)

2652 
¡mt
->
f›lds
[
i
].
bË
ð
	`ma_¡rdup_roÙ
(
f›lds_ma_®loc_roÙ
, 
mysql
->fields[i].table);

2653 ià(
mysql
->
f›lds
[
i
].
Üg_bË
)

2654 
¡mt
->
f›lds
[
i
].
Üg_bË
ð
	`ma_¡rdup_roÙ
(
f›lds_ma_®loc_roÙ
, 
mysql
->fields[i].org_table);

2655 ià(
mysql
->
f›lds
[
i
].
Çme
)

2656 
¡mt
->
f›lds
[
i
].
Çme
ð
	`ma_¡rdup_roÙ
(
f›lds_ma_®loc_roÙ
, 
mysql
->fields[i].name);

2657 ià(
mysql
->
f›lds
[
i
].
Üg_Çme
)

2658 
¡mt
->
f›lds
[
i
].
Üg_Çme
ð
	`ma_¡rdup_roÙ
(
f›lds_ma_®loc_roÙ
, 
mysql
->fields[i].org_name);

2659 ià(
mysql
->
f›lds
[
i
].
ÿlog
)

2660 
¡mt
->
f›lds
[
i
].
ÿlog
ð
	`ma_¡rdup_roÙ
(
f›lds_ma_®loc_roÙ
, 
mysql
->fields[i].catalog);

2661 ià(
mysql
->
f›lds
[
i
].
def
)

2662 
¡mt
->
f›lds
[
i
].
def
ð
	`ma_¡rdup_roÙ
(
f›lds_ma_®loc_roÙ
, 
mysql
->fields[i].def);

2663 
¡mt
->
f›lds
[
i
].
ex‹nsiÚ
=

2664 
mysql
->
f›lds
[
i
].
ex‹nsiÚ
 ?

2665 
	`ma_f›ld_ex‹nsiÚ_d“p_dup
(
f›lds_ma_®loc_roÙ
,

2666 
mysql
->
f›lds
[
i
].
ex‹nsiÚ
) :

2667 
NULL
;

2671 ià((
¡mt
->
up£¹_¡©us
.
£rv”_¡©us
 & 
SERVER_STATUS_CURSOR_EXISTS
) &&

2672 (
¡mt
->
æags
 & 
CURSOR_TYPE_READ_ONLY
))

2674 
¡mt
->
cursÜ_exi¡s
 = 
TRUE
;

2675 
mysql
->
¡©us
 = 
MYSQL_STATUS_READY
;

2678 
¡mt
->
deçuÉ_r£t_hªdËr
 = 
_mysql_¡mt_u£_»suÉ
;

2680 } ià(
¡mt
->
æags
 & 
CURSOR_TYPE_READ_ONLY
)

2693 ià(
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
))

2695 
¡mt
->
mysql
->
¡©us
ð
MYSQL_STATUS_STMT_RESULT
;

2699 
¡mt
->
deçuÉ_r£t_hªdËr
 = 
_mysql_¡mt_u£_»suÉ
;

2700 
¡mt
->
mysql
->
¡©us
ð
MYSQL_STATUS_STMT_RESULT
;

2702 
¡mt
->
¡©e
ð
MYSQL_STMT_WAITING_USE_OR_STORE
;

2705 ià(
mysql
->
f›ld_couÁ
 =ð
¡mt
->field_count)

2707 
ušt
 
i
;

2708 
i
=0; i < 
¡mt
->
f›ld_couÁ
; i++)

2710 
¡mt
->
f›lds
[
i
].
ty³
ð
mysql
->fields[i].type;

2711 
¡mt
->
f›lds
[
i
].
Ëngth
ð
mysql
->fields[i].length;

2712 
¡mt
->
f›lds
[
i
].
æags
ð
mysql
->fields[i].flags;

2713 
¡mt
->
f›lds
[
i
].
decim®s
ð
mysql
->fields[i].decimals;

2714 
¡mt
->
f›lds
[
i
].
ch¬£Šr
ð
mysql
->fields[i].charsetnr;

2715 
¡mt
->
f›lds
[
i
].
max_Ëngth
ð
mysql
->fields[i].max_length;

2720 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
CR_NEW_STMT_METADATA
, 
SQLSTATE_UNKNOWN
, 0);

2725 
	}
}

2727 
STDCALL
 
	$mysql_¡mt_execu‹
(
MYSQL_STMT
 *
¡mt
)

2729 
MYSQL
 *
mysql
ð
¡mt
->mysql;

2730 *
»que¡
;

2731 
»t
;

2732 
size_t
 
»que¡_Ën
= 0;

2734 ià(!
¡mt
->
mysql
)

2736 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
CR_SERVER_LOST
, 
SQLSTATE_UNKNOWN
, 0);

2740 ià(
¡mt
->
¡©e
 < 
MYSQL_STMT_PREPARED
)

2742 
	`SET_CLIENT_ERROR
(
mysql
, 
CR_COMMANDS_OUT_OF_SYNC
, 
SQLSTATE_UNKNOWN
, 0);

2743 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
CR_COMMANDS_OUT_OF_SYNC
, 
SQLSTATE_UNKNOWN
, 0);

2747 ià(
¡mt
->
·¿m_couÁ
 && !¡mt->
bšd_·¿m_dÚe
)

2749 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
CR_PARAMS_NOT_BOUND
, 
SQLSTATE_UNKNOWN
, 0);

2753 ià(
¡mt
->
¡©e
 =ð
MYSQL_STMT_WAITING_USE_OR_STORE
)

2755 
¡mt
->
deçuÉ_r£t_hªdËr
 = 
_mysql_¡mt_u£_»suÉ
;

2756 
¡mt
->
	`deçuÉ_r£t_hªdËr
(stmt);

2758 ià(
¡mt
->
¡©e
 > 
MYSQL_STMT_WAITING_USE_OR_STORE
 && stmt->¡©< 
MYSQL_STMT_FETCH_DONE
 && !¡mt->
»suÉ
.
d©a
)

2760 ià(!
¡mt
->
cursÜ_exi¡s
)

2762 
¡mt
->
mysql
->
m‘hods
->
	`db_¡mt_æush_unbufã»d
(stmt);

2763 } 
	`mysql_¡mt_mÜe_»suÉs
(
¡mt
));

2764 
¡mt
->
¡©e
ð
MYSQL_STMT_PREPARED
;

2765 
¡mt
->
mysql
->
¡©us
ð
MYSQL_STATUS_READY
;

2769 ià(
¡mt
->
»suÉ
.
d©a
)

2771 
	`ma_ä“_roÙ
(&
¡mt
->
»suÉ
.
®loc
, 
	`MYF
(
MY_KEEP_PREALLOC
));

2772 
¡mt
->
»suÉ_cursÜ
ð¡mt->
»suÉ
.
d©a
= 0;

2775 
¡mt
->
»suÉ
.
rows
= 0;

2776 ià(
¡mt
->
¬¿y_size
 > 0)

2777 
»que¡
ð(*)
	`mysql_¡mt_execu‹_g’”©e_bulk_»que¡
(
¡mt
, &
»que¡_Ën
);

2779 
»que¡
ð(*)
	`mysql_¡mt_execu‹_g’”©e_sim¶e_»que¡
(
¡mt
, &
»que¡_Ën
);

2781 ià(!
»que¡
)

2784 
»t
ð
¡mt
->
mysql
->
m‘hods
->
	`db_commªd
(mysql,

2785 
¡mt
->
¬¿y_size
 > 0 ? 
COM_STMT_BULK_EXECUTE
 : 
COM_STMT_EXECUTE
,

2786 
»que¡
, 
»que¡_Ën
, 1, 
¡mt
);

2787 ià(
»que¡
)

2788 
	`ä“
(
»que¡
);

2790 ià(
»t
)

2792 
	`UPDATE_STMT_ERROR
(
¡mt
);

2796 ià(
mysql
->
Ãt
.
ex‹nsiÚ
->
muÉi_¡©us
 > 
COM_MULTI_OFF
)

2799 (
	`¡mt_»ad_execu‹_»¥Ú£
(
¡mt
));

2800 
	}
}

2802 
my_boÞ
 
	$madb_»£t_¡mt
(
MYSQL_STMT
 *
¡mt
, 
æags
)

2804 
MYSQL
 *
mysql
ð
¡mt
->mysql;

2805 
my_boÞ
 
»t
= 0;

2807 ià(!
¡mt
->
mysql
)

2809 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
CR_SERVER_LOST
, 
SQLSTATE_UNKNOWN
, 0);

2814 ià(
æags
 & 
MADB_RESET_ERROR
)

2816 
	`CLEAR_CLIENT_ERROR
(
¡mt
->
mysql
);

2817 
	`CLEAR_CLIENT_STMT_ERROR
(
¡mt
);

2820 ià(
¡mt
->
¡mt_id
)

2825 ià(
æags
 & 
MADB_RESET_STORED
 &&

2826 
¡mt
->
»suÉ_cursÜ
)

2828 
	`ma_ä“_roÙ
(&
¡mt
->
»suÉ
.
®loc
, 
	`MYF
(
MY_KEEP_PREALLOC
));

2829 
¡mt
->
»suÉ
.
d©a
ð
NULL
;

2830 
¡mt
->
»suÉ
.
rows
= 0;

2831 
¡mt
->
»suÉ_cursÜ
ð
NULL
;

2832 
¡mt
->
mysql
->
¡©us
ð
MYSQL_STATUS_READY
;

2833 
¡mt
->
¡©e
ð
MYSQL_STMT_FETCH_DONE
;

2837 ià(
æags
 & 
MADB_RESET_BUFFER
)

2839 ià(
¡mt
->
¡©e
 =ð
MYSQL_STMT_WAITING_USE_OR_STORE
)

2841 
¡mt
->
	`deçuÉ_r£t_hªdËr
(stmt);

2842 
¡mt
->
¡©e
 = 
MYSQL_STMT_USER_FETCHING
;

2845 ià(
¡mt
->
mysql
->
¡©us
!ð
MYSQL_STATUS_READY
 && stmt->
f›ld_couÁ
)

2847 
mysql
->
m‘hods
->
	`db_¡mt_æush_unbufã»d
(
¡mt
);

2848 
mysql
->
¡©us
ð
MYSQL_STATUS_READY
;

2852 ià(
æags
 & 
MADB_RESET_SERVER
)

2855 ià(
¡mt
->
mysql
 && stmt->mysql->
¡©us
 =ð
MYSQL_STATUS_READY
 &&

2856 
¡mt
->
mysql
->
Ãt
.
pvio
)

2858 
cmd_buf
[
STMT_ID_LENGTH
];

2859 
	`št4¡Üe
(
cmd_buf
, 
¡mt
->
¡mt_id
);

2860 ià((
»t
ð
¡mt
->
mysql
->
m‘hods
->
	`db_commªd
(mysql,
COM_STMT_RESET
, (*)
cmd_buf
,

2861 (
cmd_buf
), 0, 
¡mt
)))

2863 
	`UPDATE_STMT_ERROR
(
¡mt
);

2864 (
»t
);

2869 ià(
æags
 & 
MADB_RESET_LONGDATA
)

2871 ià(
¡mt
->
·¿ms
)

2873 
ulÚglÚg
 
i
;

2874 
i
=0; i < 
¡mt
->
·¿m_couÁ
; i++)

2875 ià(
¡mt
->
·¿ms
[
i
].
lÚg_d©a_u£d
)

2876 
¡mt
->
·¿ms
[
i
].
lÚg_d©a_u£d
= 0;

2881 (
»t
);

2882 
	}
}

2884 
my_boÞ
 
	$mysql_¡mt_š‹º®_»£t
(
MYSQL_STMT
 *
¡mt
, 
my_boÞ
 
is_þo£
)

2886 
MYSQL
 *
mysql
ð
¡mt
->mysql;

2887 
my_boÞ
 
»t
= 1;

2888 
æags
ð
MADB_RESET_LONGDATA
 | 
MADB_RESET_BUFFER
 | 
MADB_RESET_ERROR
;

2890 ià(!
mysql
)

2894 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
CR_SERVER_LOST
, 
SQLSTATE_UNKNOWN
, 0);

2898 ià(
¡mt
->
¡©e
 >ð
MYSQL_STMT_USER_FETCHING
 &&

2899 
¡mt
->
ãtch_row_func
 =ð
¡mt_unbufã»d_ãtch
)

2900 
æags
|ð
MADB_RESET_BUFFER
;

2902 
»t
ð
	`madb_»£t_¡mt
(
¡mt
, 
æags
);

2904 ià(
¡mt
->
¡mt_id
)

2906 ià((
¡mt
->
¡©e
 > 
MYSQL_STMT_EXECUTED
 &&

2907 
¡mt
->
mysql
->
¡©us
 !ð
MYSQL_STATUS_READY
) ||

2908 
¡mt
->
mysql
->
£rv”_¡©us
 & 
SERVER_MORE_RESULTS_EXIST
)

2911 ià(
¡mt
->
¡©e
 =ð
MYSQL_STMT_WAITING_USE_OR_STORE
)

2913 
¡mt
->
	`deçuÉ_r£t_hªdËr
(stmt);

2914 
¡mt
->
¡©e
 = 
MYSQL_STMT_USER_FETCHING
;

2917 ià(
¡mt
->
f›ld_couÁ
)

2919 
	`mysql_¡mt_Ãxt_»suÉ
(
¡mt
) == 0);

2920 
¡mt
->
mysql
->
¡©us
ð
MYSQL_STATUS_READY
;

2923 ià(!
is_þo£
)

2924 
»t
ð
	`madb_»£t_¡mt
(
¡mt
, 
MADB_RESET_SERVER
);

2925 
¡mt
->
¡©e
ð
MYSQL_STMT_PREPARED
;

2928 
¡mt
->
¡©e
ð
MYSQL_STMT_INITTED
;

2930 
¡mt
->
up£¹_¡©us
.
afãùed_rows
ð
mysql
->affected_rows;

2931 
¡mt
->
up£¹_¡©us
.
Ï¡_š£¹_id
ð
mysql
->
š£¹_id
;

2932 
¡mt
->
up£¹_¡©us
.
£rv”_¡©us
ð
mysql
->server_status;

2933 
¡mt
->
up£¹_¡©us
.
w¬nšg_couÁ
ð
mysql
->warning_count;

2934 
mysql
->
¡©us
ð
MYSQL_STATUS_READY
;

2936 (
»t
);

2937 
	}
}

2939 
MYSQL_RES
 * 
STDCALL
 
	$mysql_¡mt_»suÉ_m‘ad©a
(
MYSQL_STMT
 *
¡mt
)

2941 
MYSQL_RES
 *
»s
;

2943 ià(!
¡mt
->
f›ld_couÁ
)

2944 (
NULL
);

2947 ià(!(
»s
ð(
MYSQL_RES
 *)
	`ÿÎoc
(1, (MYSQL_RES))))

2949 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
CR_OUT_OF_MEMORY
, 
SQLSTATE_UNKNOWN
, 0);

2950 (
NULL
);

2953 
»s
->
eof
= 1;

2954 
»s
->
f›lds
ð
¡mt
->fields;

2955 
»s
->
f›ld_couÁ
ð
¡mt
->field_count;

2956 (
»s
);

2957 
	}
}

2959 
my_boÞ
 
STDCALL
 
	$mysql_¡mt_»£t
(
MYSQL_STMT
 *
¡mt
)

2961 ià(
¡mt
->
¡mt_id
 > 0 &&

2962 
¡mt
->
¡mt_id
 != () -1)

2963  
	`mysql_¡mt_š‹º®_»£t
(
¡mt
, 0);

2965 
	}
}

2967 cÚ¡ * 
STDCALL
 
	$mysql_¡mt_sql¡©e
(
MYSQL_STMT
 *
¡mt
)

2969  
¡mt
->
sql¡©e
;

2970 
	}
}

2972 
MYSQL_ROW_OFFSET
 
STDCALL
 
	$mysql_¡mt_row_‹Î
(
MYSQL_STMT
 *
¡mt
)

2974 (
¡mt
->
»suÉ_cursÜ
);

2975 
	}
}

2977 
STDCALL
 
	$mysql_¡mt_·¿m_couÁ
(
MYSQL_STMT
 *
¡mt
)

2979  
¡mt
->
·¿m_couÁ
;

2980 
	}
}

2982 
MYSQL_ROW_OFFSET
 
STDCALL
 
	$mysql_¡mt_row_£ek
(
MYSQL_STMT
 *
¡mt
, 
MYSQL_ROW_OFFSET
 
Ãw_row
)

2984 
MYSQL_ROW_OFFSET
 
Þd_row
;

2986 
Þd_row
ð
¡mt
->
»suÉ_cursÜ
;

2987 
¡mt
->
»suÉ_cursÜ
ð
Ãw_row
;

2989 (
Þd_row
);

2990 
	}
}

2992 
my_boÞ
 
STDCALL
 
	$mysql_¡mt_£nd_lÚg_d©a
(
MYSQL_STMT
 *
¡mt
, 
ušt
 
·¿m_numb”
,

2993 cÚ¡ *
d©a
, 
Ëngth
)

2995 
	`CLEAR_CLIENT_ERROR
(
¡mt
->
mysql
);

2996 
	`CLEAR_CLIENT_STMT_ERROR
(
¡mt
);

2998 ià(
¡mt
->
¡©e
 < 
MYSQL_STMT_PREPARED
 || !¡mt->
·¿ms
)

3000 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
CR_NO_PREPARE_STMT
, 
SQLSTATE_UNKNOWN
, 0);

3004 ià(
·¿m_numb”
 >ð
¡mt
->
·¿m_couÁ
)

3006 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
CR_INVALID_PARAMETER_NO
, 
SQLSTATE_UNKNOWN
, 0);

3010 ià(
Ëngth
 || !
¡mt
->
·¿ms
[
·¿m_numb”
].
lÚg_d©a_u£d
)

3012 
»t
;

3013 
size_t
 
·ck‘_Ën
ð
STMT_ID_LENGTH
 + 2 + 
Ëngth
;

3014 
uch¬
 *
cmd_buff
ð(uch¬ *)
	`ÿÎoc
(1, 
·ck‘_Ën
);

3015 
	`št4¡Üe
(
cmd_buff
, 
¡mt
->
¡mt_id
);

3016 
	`št2¡Üe
(
cmd_buff
 + 
STMT_ID_LENGTH
, 
·¿m_numb”
);

3017 
	`memýy
(
cmd_buff
 + 
STMT_ID_LENGTH
 + 2, 
d©a
, 
Ëngth
);

3018 
¡mt
->
·¿ms
[
·¿m_numb”
].
lÚg_d©a_u£d
= 1;

3019 
»t
ð
¡mt
->
mysql
->
m‘hods
->
	`db_commªd
(¡mt->mysql, 
COM_STMT_SEND_LONG_DATA
,

3020 (*)
cmd_buff
, 
·ck‘_Ën
, 1, 
¡mt
);

3021 ià(
»t
)

3022 
	`UPDATE_STMT_ERROR
(
¡mt
);

3023 
	`ä“
(
cmd_buff
);

3024 (
»t
);

3027 
	}
}

3029 
STDCALL
 
	$mysql_¡mt_š£¹_id
(
MYSQL_STMT
 *
¡mt
)

3031  
¡mt
->
up£¹_¡©us
.
Ï¡_š£¹_id
;

3032 
	}
}

3034 
STDCALL
 
	$mysql_¡mt_num_rows
(
MYSQL_STMT
 *
¡mt
)

3036  
¡mt
->
»suÉ
.
rows
;

3037 
	}
}

3039 
MYSQL_RES
* 
STDCALL
 
mysql_¡mt_·¿m_m‘ad©a
(
MYSQL_STMT
 *
¡mt
 
__©Œibu‹__
((
unu£d
)))

3044 (
	gNULL
);

3047 
my_boÞ
 
STDCALL
 
	$mysql_¡mt_mÜe_»suÉs
(
MYSQL_STMT
 *
¡mt
)

3054  (
¡mt
 &&

3055 
¡mt
->
mysql
 &&

3056 ((
¡mt
->
mysql
->
£rv”_¡©us
 & 
SERVER_MORE_RESULTS_EXIST
) ||

3057 (
¡mt
->
mysql
->
£rv”_¡©us
 & 
SERVER_PS_OUT_PARAMS
)));

3058 
	}
}

3060 
STDCALL
 
	$mysql_¡mt_Ãxt_»suÉ
(
MYSQL_STMT
 *
¡mt
)

3062 
rc
= 0;

3064 ià(!
¡mt
->
mysql
)

3066 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
CR_SERVER_LOST
, 
SQLSTATE_UNKNOWN
, 0);

3070 ià(
¡mt
->
¡©e
 < 
MYSQL_STMT_EXECUTED
)

3072 
	`SET_CLIENT_ERROR
(
¡mt
->
mysql
, 
CR_COMMANDS_OUT_OF_SYNC
, 
SQLSTATE_UNKNOWN
, 0);

3073 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
CR_COMMANDS_OUT_OF_SYNC
, 
SQLSTATE_UNKNOWN
, 0);

3077 ià(!
	`mysql_¡mt_mÜe_»suÉs
(
¡mt
))

3080 ià(
¡mt
->
¡©e
 > 
MYSQL_STMT_EXECUTED
 &&

3081 
¡mt
->
¡©e
 < 
MYSQL_STMT_FETCH_DONE
)

3082 
	`madb_»£t_¡mt
(
¡mt
, 
MADB_RESET_ERROR
 | 
MADB_RESET_BUFFER
 | 
MADB_RESET_LONGDATA
);

3083 
¡mt
->
¡©e
ð
MYSQL_STMT_WAITING_USE_OR_STORE
;

3085 ià(
	`mysql_Ãxt_»suÉ
(
¡mt
->
mysql
))

3087 
¡mt
->
¡©e
ð
MYSQL_STMT_FETCH_DONE
;

3088 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, stmt->
mysql
->
Ãt
.
Ï¡_”ºo
, stmt->mysql->Ãt.
sql¡©e
,

3089 
¡mt
->
mysql
->
Ãt
.
Ï¡_”rÜ
);

3093 ià(
¡mt
->
mysql
->
¡©us
 =ð
MYSQL_STATUS_GET_RESULT
)

3094 
¡mt
->
mysql
->
¡©us
ð
MYSQL_STATUS_STMT_RESULT
;

3096 ià(
¡mt
->
mysql
->
f›ld_couÁ
)

3097 
rc
ð
	`madb_®loc_¡mt_f›lds
(
¡mt
);

3100 
¡mt
->
up£¹_¡©us
.
afãùed_rows
ð¡mt->
mysql
->affected_rows;

3101 
¡mt
->
up£¹_¡©us
.
Ï¡_š£¹_id
ð¡mt->
mysql
->
š£¹_id
;

3102 
¡mt
->
up£¹_¡©us
.
£rv”_¡©us
ð¡mt->
mysql
->server_status;

3103 
¡mt
->
up£¹_¡©us
.
w¬nšg_couÁ
ð¡mt->
mysql
->warning_count;

3106 
¡mt
->
f›ld_couÁ
ð¡mt->
mysql
->field_count;

3107 
¡mt
->
»suÉ
.
rows
= 0;

3109 (
rc
);

3110 
	}
}

3112 
STDCALL
 
	$m¬Ÿdb_¡mt_execu‹_dœeù
(
MYSQL_STMT
 *
¡mt
,

3113 cÚ¡ *
¡mt_¡r
,

3114 
size_t
 
Ëngth
)

3116 
MYSQL
 *
mysql
;

3117 
my_boÞ
 
emuÏ‹_cmd
;

3118 
my_boÞ
 
þ—r_»suÉ
= 0;

3120 ià(!
¡mt
)

3123 
mysql
ð
¡mt
->mysql;

3124 ià(!
mysql
)

3126 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
CR_SERVER_LOST
, 
SQLSTATE_UNKNOWN
, 0);

3130 
emuÏ‹_cmd
ð!(!(
¡mt
->
mysql
->
£rv”_ÿ·bž™›s
 & 
CLIENT_MYSQL
) &&

3131 (
¡mt
->
mysql
->
ex‹nsiÚ
->
m¬Ÿdb_£rv”_ÿ·bž™›s
 &

3132 (
MARIADB_CLIENT_STMT_BULK_OPERATIONS
 >> 32))è|| 
mysql
->
Ãt
.
com´ess
;

3136 ià(
emuÏ‹_cmd
)

3138 
rc
;

3141 ià((
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
¡mt_¡r
, ()
Ëngth
)))

3142  
rc
;

3143  
	`mysql_¡mt_execu‹
(
¡mt
);

3146 ià(
	`ma_muÉi_commªd
(
mysql
, 
COM_MULTI_ENABLED
))

3148 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
CR_COMMANDS_OUT_OF_SYNC
, 
SQLSTATE_UNKNOWN
, 0);

3152 ià(
Ëngth
 =ð(
size_t
) -1)

3153 
Ëngth
ð
	`¡¾’
(
¡mt_¡r
);

3156 
	`CLEAR_CLIENT_STMT_ERROR
(
¡mt
);

3157 
	`CLEAR_CLIENT_ERROR
(
¡mt
->
mysql
);

3158 
¡mt
->
up£¹_¡©us
.
afãùed_rows
ð
mysql
->affected_rows= () ~0;

3161 ià(
¡mt
->
¡©e
 > 
MYSQL_STMT_INITTED
)

3166 
¡mt_id
[
STMT_ID_LENGTH
];

3168 ià(
	`mysql_¡mt_š‹º®_»£t
(
¡mt
, 1))

3169 
çž
;

3171 
	`ma_ä“_roÙ
(&
¡mt
->
mem_roÙ
, 
	`MYF
(
MY_KEEP_PREALLOC
));

3172 
	`ma_ä“_roÙ
(&((
MADB_STMT_EXTENSION
 *)
¡mt
->
ex‹nsiÚ
)->
f›lds_ma_®loc_roÙ
, 
	`MYF
(0));

3173 
¡mt
->
f›ld_couÁ
= 0;

3174 
¡mt
->
·¿m_couÁ
= 0;

3175 
¡mt
->
·¿ms
= 0;

3177 
	`št4¡Üe
(
¡mt_id
, 
¡mt
->stmt_id);

3178 ià(
mysql
->
m‘hods
->
	`db_commªd
(mysql, 
COM_STMT_CLOSE
, 
¡mt_id
,

3179 (
¡mt_id
), 1, 
¡mt
))

3180 
çž
;

3182 
¡mt
->
¡mt_id
= -1;

3183 ià(
mysql
->
m‘hods
->
	`db_commªd
(mysql, 
COM_STMT_PREPARE
, 
¡mt_¡r
, 
Ëngth
, 1, 
¡mt
))

3184 
çž
;

3188 
þ—r_»suÉ
= 1;

3190 
¡mt
->
¡©e
ð
MYSQL_STMT_PREPARED
;

3193 
¡mt
->
¡mt_id
= -1;

3194 ià(
	`mysql_¡mt_execu‹
(
¡mt
))

3195 
çž
;

3198 ià(
	`ma_muÉi_commªd
(
mysql
, 
COM_MULTI_END
))

3199 
çž
;

3202 ià(
mysql
->
m‘hods
->
db_»ad_´•¬e_»¥Ú£
 &&

3203 
mysql
->
m‘hods
->
	`db_»ad_´•¬e_»¥Ú£
(
¡mt
))

3204 
çž
;

3206 
þ—r_»suÉ
= 0;

3210 ià(
¡mt
->
·¿m_couÁ
 &&

3211 
¡mt
->
mysql
->
m‘hods
->
	`db_¡mt_g‘_·¿m_m‘ad©a
(stmt))

3213 
çž
;

3217 ià(
¡mt
->
f›ld_couÁ
 &&

3218 
¡mt
->
mysql
->
m‘hods
->
	`db_¡mt_g‘_»suÉ_m‘ad©a
(stmt))

3220 
çž
;

3224 ià(
¡mt
->
f›ld_couÁ
)

3226 
MA_MEM_ROOT
 *
f›lds_ma_®loc_roÙ
ð&((
MADB_STMT_EXTENSION
 *)
¡mt
->
ex‹nsiÚ
)->fields_ma_alloc_root;

3227 ià(!(
¡mt
->
bšd
ð(
MYSQL_BIND
 *)
	`ma_®loc_roÙ
(
f›lds_ma_®loc_roÙ
, stmt->
f›ld_couÁ
 * (MYSQL_BIND))))

3229 
	`SET_CLIENT_STMT_ERROR
(
¡mt
, 
CR_OUT_OF_MEMORY
, 
SQLSTATE_UNKNOWN
, 0);

3230 
çž
;

3232 
	`mem£t
(
¡mt
->
bšd
, 0, (
MYSQL_BIND
è* stmt->
f›ld_couÁ
);

3234 
¡mt
->
¡©e
 = 
MYSQL_STMT_PREPARED
;

3237  
	`¡mt_»ad_execu‹_»¥Ú£
(
¡mt
);

3238 
çž
:

3240 ià(!
	`mysql_¡mt_”ºo
(
¡mt
))

3241 
	`UPDATE_STMT_ERROR
(
¡mt
);

3242 ià(
þ—r_»suÉ
) {

3244 
¡mt
->
mysql
->
m‘hods
->
	`db_¡mt_æush_unbufã»d
(stmt);

3245 } 
	`mysql_¡mt_mÜe_»suÉs
(
¡mt
));

3247 
¡mt
->
¡©e
ð
MYSQL_STMT_INITTED
;

3249 
	}
}

3251 
MYSQL_FIELD
 * 
STDCALL
 
	$m¬Ÿdb_¡mt_ãtch_f›lds
(
MYSQL_STMT
 *
¡mt
)

3253 ià(
¡mt
)

3254  
¡mt
->
f›lds
;

3255  
NULL
;

3256 
	}
}

	@libmariadb/secure/gnutls.c

20 #ifdeà
HAVE_GNUTLS


22 
	~<ma_glob®.h
>

23 
	~<gnuŽs/gnuŽs.h
>

24 
	~<gnuŽs/x509.h
>

25 
	~<gnuŽs/ab¡¿ù.h
>

26 
	~<ma_sys.h
>

27 
	~<ma_commÚ.h
>

28 
	~<ma_pvio.h
>

29 
	~<”rmsg.h
>

30 
	~<ma_±h»ad.h
>

31 
	~<mysql/þ›Á_¶ugš.h
>

32 
	~<¡ršg.h
>

33 
	~<ma_Žs.h
>

34 
	~<m¬Ÿdb_async.h
>

35 
	~<ma_cÚ‹xt.h
>

37 
±h»ad_mu‹x_t
 
	gLOCK_gnuŽs_cÚfig
;

39 
my_boÞ
 
ma_Žs_š™Ÿlized
;

40 
m¬Ÿdb_deš™Ÿlize_s¦
;

42 
	ema_³m_ty³
 {

43 
	mMA_TLS_PEM_CERT
= 0,

44 
	mMA_TLS_PEM_KEY
,

45 
	mMA_TLS_PEM_CA
,

46 
	mMA_TLS_PEM_CRL


49 
my_v”ify_ÿÎback
(
gnuŽs_£ssiÚ_t
 
s¦
);

51 
	gŽs_lib¿ry_v”siÚ
[
TLS_VERSION_LENGTH
];

53 
	s¡_gnuŽs_d©a
 {

54 
MYSQL
 *
	mmysql
;

55 
gnuŽs_´ivkey_t
 
	mkey
;

56 
gnuŽs_pû¹_¡
 
	mû¹
;

59 
	s¡_ch”_m­
 {

60 
	msid
[2];

61 cÚ¡ *
	mŸÇ_Çme
;

62 cÚ¡ *
	mÝ’s¦_Çme
;

63 cÚ¡ *
	mgnuŽs_Çme
;

66 cÚ¡ 
¡_ch”_m­
 
	gŽs_ch”s
[]=

70 
NULL
,

74 
NULL
,

78 
NULL
,

82 
NULL
,

86 
NULL
,

106 
NULL
,

134 
NULL
,

138 
NULL
,

142 
NULL
,

146 
NULL
,

150 
NULL
,

154 
NULL
,

158 
NULL
,

162 
NULL
,

166 
NULL
,

170 
NULL
,

174 
NULL
,

178 
NULL
,

182 
NULL
,

186 
NULL
,

190 
NULL
,

194 
NULL
,

198 
NULL
,

202 
NULL
,

206 
NULL
,

210 
NULL
,

226 
NULL
,

230 
NULL
,

258 
NULL
,

262 
NULL
,

270 
NULL
,

274 
NULL
,

278 
NULL
,

282 
NULL
,

286 
NULL
,

306 
NULL
,

310 
NULL
,

314 
NULL
,

318 
NULL
,

334 
NULL
,

338 
NULL
,

342 
NULL
,

354 
NULL
,

358 
NULL
,

382 
NULL
,

386 
NULL
,

398 
NULL
,

402 
NULL
,

406 
NULL
,

410 
NULL
,

434 
NULL
,

438 
NULL
,

442 
NULL
,

446 
NULL
,

450 
NULL
,

454 
NULL
,

458 
NULL
,

482 
NULL
,

486 
NULL
,

494 
NULL
,

498 
NULL
,

502 
NULL
,

506 
NULL
,

514 
NULL
,

518 
NULL
,

534 
NULL
,

538 
NULL
,

550 
NULL
,

554 
NULL
,

566 
NULL
,

570 
NULL
,

574 
NULL
,

578 
NULL
,

602 
NULL
,

606 
NULL
,

610 
NULL
,

622 
NULL
,

626 
NULL
,

630 
NULL
,

634 
NULL
,

638 
NULL
,

642 
NULL
,

646 
NULL
,

650 
NULL
,

654 
NULL
,

658 
NULL
,

662 
NULL
,

666 
NULL
,

686 
NULL
,

690 
NULL
,

694 
NULL
,

698 
NULL
,

702 
NULL
,

706 
NULL
,

710 
NULL
,

714 
NULL
,

718 
NULL
,

722 
NULL
,

726 
NULL
,

730 
NULL
,

734 
NULL
,

738 
NULL
,

742 
NULL
,

746 
NULL
,

750 
NULL
,

754 
NULL
,

758 
NULL
,

774 
NULL
,

782 
NULL
,

790 
NULL
,

797 
NULL
,

798 
NULL
,

799 
NULL
}

803 
	$ä“_gnuŽs_d©a
(
¡_gnuŽs_d©a
 *
d©a
)

805 ià(
d©a
)

807 ià(
d©a
->
key
)

808 
	`gnuŽs_´ivkey_deš™
(
d©a
->
key
);

809 
	`gnuŽs_pû¹_deš™
(&
d©a
->
û¹
);

810 
	`ä“
(
d©a
);

812 
	}
}

816 cÚ¡ *
	$Ý’s¦_ch”_Çme
(
gnuŽs_kx_®gÜ™hm_t
 
kx
,

817 
gnuŽs_ch”_®gÜ™hm_t
 
ch”
,

818 
gnuŽs_mac_®gÜ™hm_t
 
mac
)

820 
i
=0;

821 cÚ¡ *
Çme
= 0;

822 
sid
[2];

823 
gnuŽs_kx_®gÜ™hm_t
 
lkx
;

824 
gnuŽs_ch”_®gÜ™hm_t
 
lch”
;

825 
gnuŽs_mac_®gÜ™hm_t
 
lmac
;

827 (
Çme
ð
	`gnuŽs_ch”_su™e_šfo
(
i
++, (*)&
sid
, &
lkx
, &
lch”
, &
lmac
, 
NULL
)))

829 ià(
lkx
 =ð
kx
 &&

830 
lch”
 =ð
ch”
 &&

831 
lmac
 =ð
mac
)

833 
i
=0;

834 
Žs_ch”s
[
i
].
ŸÇ_Çme
)

836 ià(!
	`memcmp
(
Žs_ch”s
[
i
].
sid
, &sid, 2))

838 ià(
Žs_ch”s
[
i
].
Ý’s¦_Çme
)

839  
Žs_ch”s
[
i
].
Ý’s¦_Çme
;

840 ià(
Žs_ch”s
[
i
].
gnuŽs_Çme
)

841  
Žs_ch”s
[
i
].
gnuŽs_Çme
;

842  
Žs_ch”s
[
i
].
ŸÇ_Çme
;

844 
i
++;

848  
NULL
;

849 
	}
}

852 *
	$g‘_´iÜ™y
(cÚ¡ *
ch”_Çme
, *
´iÜ™y
, 
size_t
 
Ën
)

854 
i
= 0;

855 
Žs_ch”s
[
i
].
ŸÇ_Çme
)

857 ià(
	`¡rcmp
(
Žs_ch”s
[
i
].
ŸÇ_Çme
, 
ch”_Çme
) == 0 ||

858 (
Žs_ch”s
[
i
].
Ý’s¦_Çme
 &&

859 
	`¡rcmp
(
Žs_ch”s
[
i
].
Ý’s¦_Çme
, 
ch”_Çme
) == 0) ||

860 (
Žs_ch”s
[
i
].
gnuŽs_Çme
 &&

861 
	`¡rcmp
(
Žs_ch”s
[
i
].
gnuŽs_Çme
, 
ch”_Çme
) == 0))

863 cÚ¡ *
Çme
;

864 
gnuŽs_kx_®gÜ™hm_t
 
kx
;

865 
gnuŽs_ch”_®gÜ™hm_t
 
ch”
;

866 
gnuŽs_mac_®gÜ™hm_t
 
mac
;

867 
gnuŽs_´ÙocÞ_t
 
mš_v”siÚ
;

868 
j
= 0;

870 ià(!
Žs_ch”s
[
i
].
gnuŽs_Çme
)

871  
NULL
;

873 (
Çme
ð
	`gnuŽs_ch”_su™e_šfo
(
j
++, 
NULL
, &
kx
, &
ch”
,

874 &
mac
, &
mš_v”siÚ
)))

876 ià(!
	`¡rcmp
(
Çme
, 
Žs_ch”s
[
i
].
gnuŽs_Çme
))

878 
	`¢´štf
(
´iÜ™y
, 
Ën
 - 1, ":+%s:+%s:+%s",

879 
	`gnuŽs_ch”_g‘_Çme
(
ch”
),

880 
	`gnuŽs_mac_g‘_Çme
(
mac
),

881 
	`gnuŽs_kx_g‘_Çme
(
kx
));

882  
´iÜ™y
;

885  
NULL
;

887 
i
++;

889  
NULL
;

890 
	}
}

892 
	#MAX_SSL_ERR_LEN
 100

	)

894 
	$ma_Žs_£t_”rÜ
(
MYSQL
 *
mysql
, *
s¦
, 
s¦_”ºo
)

896 
s¦_”rÜ
[
MAX_SSL_ERR_LEN
];

897 cÚ¡ *
s¦_”rÜ_»asÚ
;

898 
MARIADB_PVIO
 *
pvio
ð
mysql
->
Ãt
.pvio;

900 ià(!
s¦_”ºo
)

902 
pvio
->
	`£t_”rÜ
(
mysql
, 
CR_SSL_CONNECTION_ERROR
, 
SQLSTATE_UNKNOWN
, "Unknown SSLƒrror");

907 ià(
s¦_”ºo
 =ð
GNUTLS_E_FATAL_ALERT_RECEIVED
)

909 
gnuŽs_®”t_desütiÚ_t
 
®”t_desc
;

910 cÚ¡ *
®”t_Çme
;

911 
®”t_desc
ð
	`gnuŽs_®”t_g‘
((
gnuŽs_£ssiÚ_t
)
s¦
);

912 
®”t_Çme
ð
	`gnuŽs_®”t_g‘_Çme
(
®”t_desc
);

913 
	`¢´štf
(
s¦_”rÜ
, 
MAX_SSL_ERR_LEN
, "fatal‡lert„eceived: %s",

914 
®”t_Çme
);

915 
pvio
->
	`£t_”rÜ
(
mysql
, 
CR_SSL_CONNECTION_ERROR
, 
SQLSTATE_UNKNOWN
, 0,

916 
s¦_”rÜ
);

920 ià((
s¦_”rÜ_»asÚ
ð
	`gnuŽs_¡»¼Ü
(
s¦_”ºo
)))

922 
pvio
->
	`£t_”rÜ
(
mysql
, 
CR_SSL_CONNECTION_ERROR
, 
SQLSTATE_UNKNOWN
, 0,

923 
s¦_”rÜ_»asÚ
);

926 
	`¢´štf
(
s¦_”rÜ
, 
MAX_SSL_ERR_LEN
, "SSLƒ¼no=%d", 
s¦_”ºo
);

927 
pvio
->
	`£t_”rÜ
(
mysql
, 
CR_SSL_CONNECTION_ERROR
, 
SQLSTATE_UNKNOWN
,

928 
s¦_”rÜ
);

929 
	}
}

932 
	$ma_Žs_g‘_”rÜ
(*
”rmsg
, 
size_t
 
Ëngth
, 
s¦_”ºo
)

934 cÚ¡ *
s¦_”rÜ_»asÚ
;

936 ià(!
s¦_”ºo
)

938 
	`¡ºýy
(
”rmsg
, "UnknowÀSSLƒ¼Ü", 
Ëngth
);

941 ià((
s¦_”rÜ_»asÚ
ð
	`gnuŽs_¡»¼Ü
(
s¦_”ºo
)))

943 
	`¡ºýy
(
”rmsg
, 
s¦_”rÜ_»asÚ
, 
Ëngth
);

946 
	`¢´štf
(
”rmsg
, 
Ëngth
, "SSLƒ¼no=%d", 
s¦_”ºo
);

947 
	}
}

961 
	$ma_Žs_¡¬t
(*
”rmsg
, 
size_t
 
”rmsg_Ën
)

963 
rc
= 0;

965 ià(
ma_Žs_š™Ÿlized
)

968 
	`±h»ad_mu‹x_š™
(&
LOCK_gnuŽs_cÚfig
,
NULL
);

969 
	`±h»ad_mu‹x_lock
(&
LOCK_gnuŽs_cÚfig
);

971 ià((
rc
ð
	`gnuŽs_glob®_š™
()è!ð
GNUTLS_E_SUCCESS
)

973 
	`ma_Žs_g‘_”rÜ
(
”rmsg
, 
”rmsg_Ën
, 
rc
);

974 
’d
;

976 
	`¢´štf
(
Žs_lib¿ry_v”siÚ
, 
TLS_VERSION_LENGTH
 - 1, "GnuTLS %s",

977 
	`gnuŽs_check_v”siÚ
(
NULL
));

979 
ma_Žs_š™Ÿlized
ð
TRUE
;

980 
’d
:

981 
	`±h»ad_mu‹x_uÆock
(&
LOCK_gnuŽs_cÚfig
);

982  
rc
;

983 
	}
}

997 
	$ma_Žs_’d
()

999 ià(
ma_Žs_š™Ÿlized
)

1001 
	`±h»ad_mu‹x_lock
(&
LOCK_gnuŽs_cÚfig
);

1002 ià(
m¬Ÿdb_deš™Ÿlize_s¦
)

1003 
	`gnuŽs_glob®_deš™
();

1004 
ma_Žs_š™Ÿlized
ð
FALSE
;

1005 
	`±h»ad_mu‹x_uÆock
(&
LOCK_gnuŽs_cÚfig
);

1006 
	`±h»ad_mu‹x_de¡roy
(&
LOCK_gnuŽs_cÚfig
);

1009 
	}
}

1011 
size_t
 
	$ma_gnuŽs_g‘_´ÙocÞ_v”siÚ
(cÚ¡ *
Žs_v”siÚ_ÝtiÚ
,

1012 *
´iÜ™y_¡ršg
,

1013 
size_t
 
´io_Ën
)

1015 
Žs_v”siÚs
[128];

1017 
Žs_v”siÚs
[0]= 0;

1018 ià(!
Žs_v”siÚ_ÝtiÚ
 || !tls_version_option[0])

1019 
’d
;

1022 ià(
	`¡r¡r
(
Žs_v”siÚ_ÝtiÚ
, "TLSv1.0"))

1023 
	`¡rÿt
(
Žs_v”siÚs
, ":+VERS-TLS1.0");

1024 ià(
	`¡r¡r
(
Žs_v”siÚ_ÝtiÚ
, "TLSv1.1"))

1025 
	`¡rÿt
(
Žs_v”siÚs
, ":+VERS-TLS1.1");

1026 ià(
	`¡r¡r
(
Žs_v”siÚ_ÝtiÚ
, "TLSv1.2"))

1027 
	`¡rÿt
(
Žs_v”siÚs
, ":+VERS-TLS1.2");

1028 #ià
GNUTLS_VERSION_NUMBER
 > 0x030605

1029 ià(
	`¡r¡r
(
Žs_v”siÚ_ÝtiÚ
, "TLSv1.3"))

1030 
	`¡rÿt
(
Žs_v”siÚs
, ":+VERS-TLS1.3");

1032 
’d
:

1033 ià(
Žs_v”siÚs
[0])

1034 
	`¢´štf
(
´iÜ™y_¡ršg
, 
´io_Ën
 - 1, "-VERS-TLS-ALL%s:NORMAL", 
Žs_v”siÚs
);

1036 
	`¡ºýy
(
´iÜ™y_¡ršg
, "NORMAL:+VERS-ALL", 
´io_Ën
 - 1);

1037  
	`¡¾’
(
´iÜ™y_¡ršg
);

1038 
	}
}

1040 
	$ma_gnuŽs_£t_ch”s
(
gnuŽs_£ssiÚ_t
 
s¦
,

1041 cÚ¡ *
ch”_¡r
,

1042 cÚ¡ *
Žs_v”siÚ
)

1044 cÚ¡ *
”r
;

1045 *
tok’
;

1046 
	#PRIO_SIZE
 1024

	)

1047 
´io
[
PRIO_SIZE
];

1049 
	`ma_gnuŽs_g‘_´ÙocÞ_v”siÚ
(
Žs_v”siÚ
, 
´io
, 
PRIO_SIZE
);

1051 ià(!
ch”_¡r
)

1052  
	`gnuŽs_´iÜ™y_£t_dœeù
(
s¦
, 
´io
, &
”r
);

1054 
tok’
ð
	`¡¹ok
((*)
ch”_¡r
, ":");

1056 
	`¡rýy
(
´io
, "NONE:+VERS-TLS-ALL:+SIGN-ALL:+COMP-NULL");

1058 
tok’
)

1060 
´iÜ™y
[1024];

1061 *
p
ð
	`g‘_´iÜ™y
(
tok’
, 
´iÜ™y
, 1024);

1062 ià(
p
)

1063 
	`¡ºÿt
(
´io
, 
p
, 
PRIO_SIZE
 - 
	`¡¾’
(prio) - 1);

1064 
tok’
 = 
	`¡¹ok
(
NULL
, ":");

1066  
	`gnuŽs_´iÜ™y_£t_dœeù
(
s¦
, 
´io
 , &
”r
);

1067 
	}
}

1069 
	$ma_Žs_£t_û¹s
(
MYSQL
 *
mysql
,

1070 
gnuŽs_û¹ifiÿ‹_üed’tŸls_t
 
ùx
)

1072 
s¦_”rÜ
= 0;

1074 ià(
mysql
->
ÝtiÚs
.
s¦_ÿ
)

1077 
s¦_”rÜ
ð
	`gnuŽs_û¹ifiÿ‹_£t_x509_Œu¡_fže
(
ùx
,

1078 
mysql
->
ÝtiÚs
.
s¦_ÿ
,

1079 
GNUTLS_X509_FMT_PEM
);

1080 ià(
s¦_”rÜ
 < 0)

1081 
”rÜ
;

1084 ià(
mysql
->
ÝtiÚs
.
s¦_ÿ·th
)

1086 
s¦_”rÜ
ð
	`gnuŽs_û¹ifiÿ‹_£t_x509_Œu¡_dœ
(
ùx
,

1087 
mysql
->
ÝtiÚs
.
s¦_ÿ·th
,

1088 
GNUTLS_X509_FMT_PEM
);

1089 ià(
s¦_”rÜ
 < 0)

1090 
”rÜ
;

1093 ià(!
mysql
->
ÝtiÚs
.
s¦_ÿ
 && !mysql->ÝtiÚs.
s¦_ÿ·th
)

1095 
s¦_”rÜ
ð
	`gnuŽs_û¹ifiÿ‹_£t_x509_sy¡em_Œu¡
(
ùx
);

1096 ià(
s¦_”rÜ
 < 0)

1097 
”rÜ
;

1100 
	`gnuŽs_û¹ifiÿ‹_£t_v”ify_funùiÚ
(
ùx
,

1101 
my_v”ify_ÿÎback
);

1103 ià(
mysql
->
ÝtiÚs
.
s¦_key
 || mysql->ÝtiÚs.
s¦_û¹
)

1105 *
keyfže
ð
mysql
->
ÝtiÚs
.
s¦_key
;

1106 *
û¹fže
ð
mysql
->
ÝtiÚs
.
s¦_û¹
;

1108 ià(!
û¹fže
)

1109 
û¹fže
ð
keyfže
;

1110 ià(!
keyfže
)

1111 
keyfže
ð
û¹fže
;

1114 ià((
s¦_”rÜ
ð
	`gnuŽs_û¹ifiÿ‹_£t_x509_key_fže2
(
ùx
,

1115 
û¹fže
, 
keyfže
, 
GNUTLS_X509_FMT_PEM
,

1116 
mysql
->
ÝtiÚs
.
ex‹nsiÚ
 ? mysql->ÝtiÚs.ex‹nsiÚ->
Žs_pw
 : 
NULL
, 0)) < 0)

1117 
”rÜ
;

1120 
”rÜ
:

1121  
s¦_”rÜ
;

1122 
	}
}

1124 *
	$ma_Žs_š™
(
MYSQL
 *
mysql
)

1126 
gnuŽs_£ssiÚ_t
 
s¦
ð
NULL
;

1127 
gnuŽs_û¹ifiÿ‹_üed’tŸls_t
 
ùx
;

1128 
s¦_”rÜ
= 0;

1129 
¡_gnuŽs_d©a
 *
d©a
ð
NULL
;

1131 
	`±h»ad_mu‹x_lock
(&
LOCK_gnuŽs_cÚfig
);

1133 ià(
	`gnuŽs_û¹ifiÿ‹_®loÿ‹_üed’tŸls
(&
ùx
è!ð
GNUTLS_E_SUCCESS
)

1134 
”rÜ
;

1136 ià((
s¦_”rÜ
ð
	`ma_Žs_£t_û¹s
(
mysql
, 
ùx
)) < 0)

1137 
”rÜ
;

1139 ià((
s¦_”rÜ
 = 
	`gnuŽs_š™
(&
s¦
, 
GNUTLS_CLIENT
 & 
GNUTLS_NONBLOCK
)) < 0)

1140 
”rÜ
;

1142 ià(!(
d©a
ð(
¡_gnuŽs_d©a
 *)
	`ÿÎoc
(1, (st_gnutls_data))))

1143 
”rÜ
;

1145 
d©a
->
mysql
= mysql;

1146 
	`gnuŽs_£ssiÚ_£t_±r
(
s¦
, (*)
d©a
);

1150 
s¦_”rÜ
ð
	`ma_gnuŽs_£t_ch”s
(
s¦
, 
mysql
->
ÝtiÚs
.
s¦_ch”
, mysql->ÝtiÚs.
ex‹nsiÚ
 ? mysql->ÝtiÚs.ex‹nsiÚ->
Žs_v”siÚ
 : 
NULL
);

1151 ià(
s¦_”rÜ
 < 0)

1152 
”rÜ
;

1156 ià((
s¦_”rÜ
ð
	`gnuŽs_üed’tŸls_£t
(
s¦
, 
GNUTLS_CRD_CERTIFICATE
, 
ùx
)) < 0)

1157 
”rÜ
;

1159 
	`±h»ad_mu‹x_uÆock
(&
LOCK_gnuŽs_cÚfig
);

1160  (*)
s¦
;

1161 
”rÜ
:

1162 
	`ä“_gnuŽs_d©a
(
d©a
);

1163 
	`ma_Žs_£t_”rÜ
(
mysql
, 
s¦
, 
s¦_”rÜ
);

1164 
	`gnuŽs_û¹ifiÿ‹_ä“_üed’tŸls
(
ùx
);

1165 ià(
s¦
)

1166 
	`gnuŽs_deš™
(
s¦
);

1167 
	`±h»ad_mu‹x_uÆock
(&
LOCK_gnuŽs_cÚfig
);

1168  
NULL
;

1169 
	}
}

1171 #ifdeà
GNUTLS_EXTERNAL_TRANSPORT


1172 
ssize_t
 
	$ma_Žs_push
(
gnuŽs_Œª¥Üt_±r_t
 
±r
, cÚ¡ * 
d©a
, 
size_t
 
Ën
)

1174 
MARIADB_PVIO
 *
pvio
ð(MARIADB_PVIO *)
±r
;

1175 
ssize_t
 
rc
ð
pvio
->
m‘hods
->
	`wr™e
Õvio, 
d©a
, 
Ën
);

1176  
rc
;

1177 
	}
}

1179 
ssize_t
 
	$ma_Žs_puÎ
(
gnuŽs_Œª¥Üt_±r_t
 
±r
, * 
d©a
, 
size_t
 
Ën
)

1181 
MARIADB_PVIO
 *
pvio
ð(MARIADB_PVIO *)
±r
;

1182 
ssize_t
 
rc
ð
pvio
->
m‘hods
->
	`»ad
Õvio, 
d©a
, 
Ën
);

1183  
rc
;

1184 
	}
}

1186 
	$ma_Žs_puÎ_timeout
(
gnuŽs_Œª¥Üt_±r_t
 
±r
, 
ms
)

1188 
MARIADB_PVIO
 *
pvio
ð(MARIADB_PVIO *)
±r
;

1189  
pvio
->
m‘hods
->
	`wa™_io_Ü_timeout
Õvio, 0, 
ms
);

1190 
	}
}

1193 
my_boÞ
 
	$ma_Žs_cÚÃù
(
MARIADB_TLS
 *
ùls
)

1195 
gnuŽs_£ssiÚ_t
 
s¦
 = (gnuŽs_£ssiÚ_t)
ùls
->ssl;

1196 
my_boÞ
 
blockšg
;

1197 
MYSQL
 *
mysql
;

1198 
MARIADB_PVIO
 *
pvio
;

1199 
»t
;

1200 
¡_gnuŽs_d©a
 *
d©a
;

1201 
d©a
ð(
¡_gnuŽs_d©a
 *)
	`gnuŽs_£ssiÚ_g‘_±r
(
s¦
);

1202 
mysql
ð
d©a
->mysql;

1204 ià(!
mysql
)

1207 
pvio
ð
mysql
->
Ãt
.pvio;

1210 ià(!(
blockšg
ð
pvio
->
m‘hods
->
	`is_blockšg
(pvio)))

1211 
pvio
->
m‘hods
->
	`blockšg
Õvio, 
TRUE
, 0);

1214 #ifdeà
GNUTLS_EXTERNAL_TRANSPORT


1216 
	`gnuŽs_Œª¥Üt_£t_±r
(
s¦
, 
pvio
);

1217 
	`gnuŽs_Œª¥Üt_£t_push_funùiÚ
(
s¦
, 
ma_Žs_push
);

1218 
	`gnuŽs_Œª¥Üt_£t_puÎ_funùiÚ
(
s¦
, 
ma_Žs_puÎ
);

1219 
	`gnuŽs_Œª¥Üt_£t_puÎ_timeout_funùiÚ
(
s¦
, 
ma_Žs_puÎ_timeout
);

1220 
	`gnuŽs_hªdshake_£t_timeout
(
s¦
, 
pvio
->
timeout
[
PVIO_CONNECT_TIMEOUT
]);

1222 
	`gnuŽs_Œª¥Üt_£t_št
(
s¦
, 
	`mysql_g‘_sock‘
(
mysql
));

1226 
»t
 = 
	`gnuŽs_hªdshake
(
s¦
);

1227 } 
»t
 < 0 && 
	`gnuŽs_”rÜ_is_çl
(ret) == 0);

1229 ià(
»t
 < 0)

1233 ià(!
	`mysql_”ºo
(
mysql
))

1234 
	`ma_Žs_£t_”rÜ
(
mysql
, 
s¦
, 
»t
);

1236 
	`ma_Žs_þo£
(
ùls
);

1239 ià(!
blockšg
)

1240 
pvio
->
m‘hods
->
	`blockšg
Õvio, 
FALSE
, 0);

1243 
ùls
->
s¦
= (*)ssl;

1245 
	}
}

1247 
ssize_t
 
	$ma_Žs_wr™e_async
(
MARIADB_PVIO
 *
pvio
, cÚ¡ 
uch¬
 *
bufãr
, 
size_t
 
Ëngth
)

1249 
ssize_t
 
»s
;

1250 
mysql_async_cÚ‹xt
 *
b
ð
pvio
->
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
async_cÚ‹xt
;

1251 
MARIADB_TLS
 *
ùls
ð
pvio
->ctls;

1255 
b
->
ev’ts_to_wa™_fÜ
= 0;

1256 
»s
ð
	`gnuŽs_»cÜd_£nd
((
gnuŽs_£ssiÚ_t
)
ùls
->
s¦
, (*)
bufãr
, 
Ëngth
);

1257 ià(
»s
 > 0)

1258  
»s
;

1259 ià(
»s
 =ð
GNUTLS_E_AGAIN
)

1260 
b
->
ev’ts_to_wa™_fÜ
|ð
MYSQL_WAIT_WRITE
;

1262  
»s
;

1263 ià(
b
->
su¥’d_»sume_hook
)

1264 (*
b
->
su¥’d_»sume_hook
)(
TRUE
, b->
su¥’d_»sume_hook_u£r_d©a
);

1265 
	`my_cÚ‹xt_y›ld
(&
b
->
async_cÚ‹xt
);

1266 ià(
b
->
su¥’d_»sume_hook
)

1267 (*
b
->
su¥’d_»sume_hook
)(
FALSE
, b->
su¥’d_»sume_hook_u£r_d©a
);

1269 
	}
}

1272 
ssize_t
 
	$ma_Žs_»ad_async
(
MARIADB_PVIO
 *
pvio
, cÚ¡ 
uch¬
 *
bufãr
, 
size_t
 
Ëngth
)

1274 
ssize_t
 
»s
;

1275 
mysql_async_cÚ‹xt
 *
b
ð
pvio
->
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
async_cÚ‹xt
;

1276 
MARIADB_TLS
 *
ùls
ð
pvio
->ctls;

1280 
b
->
ev’ts_to_wa™_fÜ
= 0;

1281 
»s
ð
	`gnuŽs_»cÜd_»cv
((
gnuŽs_£ssiÚ_t
)
ùls
->
s¦
, (*)
bufãr
, 
Ëngth
);

1282 ià(
»s
 > 0)

1283  
»s
;

1284 ià(
»s
 =ð
GNUTLS_E_AGAIN
)

1285 
b
->
ev’ts_to_wa™_fÜ
|ð
MYSQL_WAIT_READ
;

1287  
»s
;

1288 ià(
b
->
su¥’d_»sume_hook
)

1289 (*
b
->
su¥’d_»sume_hook
)(
TRUE
, b->
su¥’d_»sume_hook_u£r_d©a
);

1290 
	`my_cÚ‹xt_y›ld
(&
b
->
async_cÚ‹xt
);

1291 ià(
b
->
su¥’d_»sume_hook
)

1292 (*
b
->
su¥’d_»sume_hook
)(
FALSE
, b->
su¥’d_»sume_hook_u£r_d©a
);

1294 
	}
}

1296 
ssize_t
 
	$ma_Žs_»ad
(
MARIADB_TLS
 *
ùls
, cÚ¡ 
uch¬
* 
bufãr
, 
size_t
 
Ëngth
)

1298 
ssize_t
 
rc
;

1299 
MARIADB_PVIO
 *
pvio
ð
ùls
->pvio;

1301 (
rc
ð
	`gnuŽs_»cÜd_»cv
((
gnuŽs_£ssiÚ_t
)
ùls
->
s¦
, (*)
bufãr
, 
Ëngth
)) <= 0)

1303 ià(
rc
 !ð
GNUTLS_E_AGAIN
 &&„ø!ð
GNUTLS_E_INTERRUPTED
)

1304  
rc
;

1305 ià(
pvio
->
m‘hods
->
	`wa™_io_Ü_timeout
Õvio, 
TRUE
,…vio->
mysql
->
ÝtiÚs
.
»ad_timeout
) < 1)

1306  
rc
;

1308  
rc
;

1309 
	}
}

1311 
ssize_t
 
	$ma_Žs_wr™e
(
MARIADB_TLS
 *
ùls
, cÚ¡ 
uch¬
* 
bufãr
, 
size_t
 
Ëngth
)

1313 
ssize_t
 
rc
;

1314 
MARIADB_PVIO
 *
pvio
ð
ùls
->pvio;

1316 (
rc
ð
	`gnuŽs_»cÜd_£nd
((
gnuŽs_£ssiÚ_t
)
ùls
->
s¦
, (*)
bufãr
, 
Ëngth
)) <= 0)

1318 ià(
rc
 !ð
GNUTLS_E_AGAIN
 &&„ø!ð
GNUTLS_E_INTERRUPTED
)

1319  
rc
;

1320 ià(
pvio
->
m‘hods
->
	`wa™_io_Ü_timeout
Õvio, 
TRUE
,…vio->
mysql
->
ÝtiÚs
.
wr™e_timeout
) < 1)

1321  
rc
;

1323  
rc
;

1324 
	}
}

1326 
my_boÞ
 
	$ma_Žs_þo£
(
MARIADB_TLS
 *
ùls
)

1328 ià(
ùls
->
s¦
)

1330 
gnuŽs_û¹ifiÿ‹_üed’tŸls_t
 
ùx
;

1331 
¡_gnuŽs_d©a
 *
d©a
=

1332 (
¡_gnuŽs_d©a
 *)
	`gnuŽs_£ssiÚ_g‘_±r
(
ùls
->
s¦
);

1338 
	`ä“_gnuŽs_d©a
(
d©a
);

1339 
	`gnuŽs_üed’tŸls_g‘
(
ùls
->
s¦
, 
GNUTLS_CRD_CERTIFICATE
, (**)&
ùx
);

1340 
	`gnuŽs_û¹ifiÿ‹_ä“_keys
(
ùx
);

1341 
	`gnuŽs_û¹ifiÿ‹_ä“_ÿs
(
ùx
);

1342 
	`gnuŽs_û¹ifiÿ‹_ä“_üls
(
ùx
);

1343 
	`gnuŽs_û¹ifiÿ‹_ä“_ÿ_Çmes
(
ùx
);

1344 
	`gnuŽs_û¹ifiÿ‹_ä“_üed’tŸls
(
ùx
);

1345 
	`gnuŽs_deš™
((
gnuŽs_£ssiÚ_t
 )
ùls
->
s¦
);

1346 
ùls
->
s¦
ð
NULL
;

1349 
	}
}

1351 
ma_Žs_v”ify_£rv”_û¹
(
MARIADB_TLS
 *
ùls
 
__©Œibu‹__
((
unu£d
)))

1357 cÚ¡ *
	$ma_Žs_g‘_ch”
(
MARIADB_TLS
 *
ùls
)

1359 
gnuŽs_kx_®gÜ™hm_t
 
kx
;

1360 
gnuŽs_ch”_®gÜ™hm_t
 
ch”
;

1361 
gnuŽs_mac_®gÜ™hm_t
 
mac
;

1363 ià(!
ùls
 || !ùls->
s¦
)

1364  
NULL
;

1366 
mac
ð
	`gnuŽs_mac_g‘
((
gnuŽs_£ssiÚ_t
)
ùls
->
s¦
);

1367 
ch”
ð
	`gnuŽs_ch”_g‘
((
gnuŽs_£ssiÚ_t
)
ùls
->
s¦
);

1368 
kx
ð
	`gnuŽs_kx_g‘
((
gnuŽs_£ssiÚ_t
)
ùls
->
s¦
);

1369  
	`Ý’s¦_ch”_Çme
(
kx
, 
ch”
, 
mac
);

1370 
	}
}

1372 
	$my_v”ify_ÿÎback
(
gnuŽs_£ssiÚ_t
 
s¦
)

1374 
¡©us
= 0;

1375 
¡_gnuŽs_d©a
 *
d©a
ð(¡_gnuŽs_d©¨*)
	`gnuŽs_£ssiÚ_g‘_±r
(
s¦
);

1376 
MYSQL
 *
mysql
;

1378 
mysql
ð
d©a
->mysql;

1380 
	`CLEAR_CLIENT_ERROR
(
mysql
);

1382 ià((
mysql
->
þ›Á_æag
 & 
CLIENT_SSL_VERIFY_SERVER_CERT
))

1384 cÚ¡ *
ho¡Çme
ð
mysql
->
ho¡
;

1386 ià(
	`gnuŽs_û¹ifiÿ‹_v”ify_³”s3
 (
s¦
, 
ho¡Çme
, &
¡©us
) < 0)

1387  
GNUTLS_E_CERTIFICATE_ERROR
;

1389 ià(
	`gnuŽs_û¹ifiÿ‹_v”ify_³”s2
 (
s¦
, &
¡©us
) < 0)

1390  
GNUTLS_E_CERTIFICATE_ERROR
;

1392 ià(
¡©us
 & 
GNUTLS_CERT_INVALID
)

1394 
gnuŽs_d©um_t
 
out
;

1395 
ty³
;

1397 ià(!(
mysql
->
þ›Á_æag
 & 
CLIENT_SSL_VERIFY_SERVER_CERT
) &&

1398 (
¡©us
 & 
GNUTLS_CERT_SIGNER_NOT_FOUND
))

1403 
ty³
ð
	`gnuŽs_û¹ifiÿ‹_ty³_g‘
(
s¦
);

1404 
	`gnuŽs_û¹ifiÿ‹_v”ifiÿtiÚ_¡©us_´št
(
¡©us
, 
ty³
, &
out
, 0);

1405 
	`my_£t_”rÜ
(
mysql
, 
CR_SSL_CONNECTION_ERROR
, 
SQLSTATE_UNKNOWN
,

1406 
	`ER
(
CR_SSL_CONNECTION_ERROR
), 
out
.
d©a
);

1407 
	`gnuŽs_ä“
(
out
.
d©a
);

1409  
GNUTLS_E_CERTIFICATE_ERROR
;

1414 
	}
}

1416 
	$ma_Žs_g‘_fšg”_´št
(
MARIADB_TLS
 *
ùls
, *
å
, 
Ën
)

1418 
MYSQL
 *
mysql
;

1419 
size_t
 
å_Ën
ð
Ën
;

1420 cÚ¡ 
gnuŽs_d©um_t
 *
û¹_li¡
;

1421 
û¹_li¡_size
;

1422 
¡_gnuŽs_d©a
 *
d©a
;

1424 ià(!
ùls
 || !ùls->
s¦
)

1427 
d©a
ð(
¡_gnuŽs_d©a
 *)
	`gnuŽs_£ssiÚ_g‘_±r
(
ùls
->
s¦
);

1428 
mysql
ð(
MYSQL
 *)
d©a
->mysql;

1430 
û¹_li¡
 = 
	`gnuŽs_û¹ifiÿ‹_g‘_³”s
 (
ùls
->
s¦
, &
û¹_li¡_size
);

1431 ià(
û¹_li¡
 =ð
NULL
)

1433 
	`my_£t_”rÜ
(
mysql
, 
CR_SSL_CONNECTION_ERROR
, 
SQLSTATE_UNKNOWN
,

1434 
	`ER
(
CR_SSL_CONNECTION_ERROR
),

1439 ià(
	`gnuŽs_fšg”´št
(
GNUTLS_DIG_SHA1
, &
û¹_li¡
[0], 
å
, &
å_Ën
) == 0)

1440  
å_Ën
;

1443 
	`my_£t_”rÜ
(
mysql
, 
CR_SSL_CONNECTION_ERROR
, 
SQLSTATE_UNKNOWN
,

1444 
	`ER
(
CR_SSL_CONNECTION_ERROR
),

1448 
	}
}

1450 
	$ma_Žs_g‘_´ÙocÞ_v”siÚ
(
MARIADB_TLS
 *
ùls
)

1452 ià(!
ùls
 || !ùls->
s¦
)

1455  
	`gnuŽs_´ÙocÞ_g‘_v”siÚ
(
ùls
->
s¦
) - 1;

1456 
	}
}

	@libmariadb/secure/gnutls_crypt.c

19 
	~<ma_üy±.h
>

20 
	~<gnuŽs/gnuŽs.h
>

21 
	~<gnuŽs/üy±o.h
>

23 
gnuŽs_dige¡_®gÜ™hm_t
 
	$ma_hash_g‘_®gÜ™hm
(
®g
)

25 
®g
)

27 
MA_HASH_MD5
:

28  
GNUTLS_DIG_MD5
;

29 
MA_HASH_SHA1
:

30  
GNUTLS_DIG_SHA1
;

31 
MA_HASH_SHA256
:

32  
GNUTLS_DIG_SHA256
;

33 
MA_HASH_SHA384
:

34  
GNUTLS_DIG_SHA384
;

35 
MA_HASH_SHA512
:

36  
GNUTLS_DIG_SHA512
;

37 
MA_HASH_RIPEMD160
:

38  
GNUTLS_DIG_RMD160
;

40  
GNUTLS_DIG_UNKNOWN
;

42 
	}
}

44 
MA_HASH_CTX
 *
ma_hash_Ãw
(
®gÜ™hm
, MA_HASH_CTX *
unu£d_ùx
 
__©Œibu‹__
((
unu£d
)))

46 
gnuŽs_hash_hd_t
 
	gùx
ð
NULL
;

47 
gnuŽs_dige¡_®gÜ™hm_t
 
	ghash_®g
ð
ma_hash_g‘_®gÜ™hm
(
®gÜ™hm
);

50 ià(
	ghash_®g
 =ð
GNUTLS_DIG_UNKNOWN
)

51  
NULL
;

53 ià(
gnuŽs_hash_š™
(&
ùx
, 
hash_®g
) < 0)

54  
	gNULL
;

56  (
	gMA_HASH_CTX
 *)
	gùx
;

59 
	$ma_hash_ä“
(
MA_HASH_CTX
 *
ùx
)

61 ià(
ùx
)

62 
	`gnuŽs_hash_deš™
((
gnuŽs_hash_hd_t
)
ùx
, 
NULL
);

63 
	}
}

65 
	$ma_hash_šput
(
MA_HASH_CTX
 *
ùx
,

66 cÚ¡ *
bufãr
,

67 
size_t
 
Ën
)

69 
	`gnuŽs_hash
((
gnuŽs_hash_hd_t
)
ùx
, (cÚ¡ *)
bufãr
, 
Ën
);

70 
	}
}

72 
	$ma_hash_»suÉ
(
MA_HASH_CTX
 *
ùx
, *
dige¡
)

74 
	`gnuŽs_hash_ouut
((
gnuŽs_hash_hd_t
)
ùx
, 
dige¡
);

75 
	}
}

	@libmariadb/secure/ma_schannel.c

22 
	~"ma_schªÃl.h
"

23 
	~"schªÃl_û¹s.h
"

24 
	~<as£¹.h
>

26 
	#SC_IO_BUFFER_SIZE
 0x4000

	)

27 
	#MAX_SSL_ERR_LEN
 100

	)

29 
	#SCHANNEL_PAYLOAD
(
A
è((A).
cbMaximumMes§ge
 + (A).
cbH—d”
 + (A).
cbT¿ž”
)

	)

30 
ma_schªÃl_£t_wš_”rÜ
(
MARIADB_PVIO
 *
pvio
, 
DWORD
 
E¼ÜNo
);

36 
	$ma_schªÃl_£t_£c_”rÜ
(
MARIADB_PVIO
* 
pvio
, 
DWORD
 
E¼ÜNo
)

38 
MYSQL
* 
mysql
 = 
pvio
->mysql;

39 ià(
E¼ÜNo
 !ð
SEC_E_OK
)

40 
mysql
->
Ãt
.
ex‹nsiÚ
->
ex‹nded_”ºo
 = 
E¼ÜNo
;

41 ià(
E¼ÜNo
 =ð
SEC_E_INTERNAL_ERROR
 && 
	`G‘La¡E¼Ü
())

43 
	`ma_schªÃl_£t_wš_”rÜ
(
pvio
, 
	`G‘La¡E¼Ü
());

46 
	`ma_schªÃl_£t_wš_”rÜ
(
pvio
, 
E¼ÜNo
);

47 
	}
}

50 
	~"wš32_”rmsg.h
"

52 
	$ma_schªÃl_£t_wš_”rÜ
(
MARIADB_PVIO
 *
pvio
, 
DWORD
 
E¼ÜNo
)

54 
bufãr
[256];

55 
	`ma_fÜm©_wš32_”rÜ
(
bufãr
, (bufãr), 
E¼ÜNo
, "SSL connectionƒrror: ");

56 
pvio
->
	`£t_”rÜ
Õvio->
mysql
, 
CR_SSL_CONNECTION_ERROR
, 
SQLSTATE_UNKNOWN
, 
bufãr
);

58 
	}
}

77 
SECURITY_STATUS
 
	$ma_schªÃl_hªdshake_loÝ
(
MARIADB_PVIO
 *
pvio
, 
my_boÞ
 
In™ŸlR—d
, 
SecBufãr
 *
pExŒaD©a
)

79 
SecBufãrDesc
 
OutBufãr
, 
InBufãr
;

80 
SecBufãr
 
InBufãrs
[2], 
OutBufãrs
;

81 
DWORD
 
dwSSPIFÏgs
, 
dwSSPIOutFÏgs
, 
cbD©a
, 
cbIoBufãr
;

82 
TimeSmp
 
tsExpœy
;

83 
SECURITY_STATUS
 
rc
;

84 
PUCHAR
 
IoBufãr
;

85 
BOOL
 
fDoR—d
;

86 
MARIADB_TLS
 *
ùls
ð
pvio
->ctls;

87 
SC_CTX
 *
sùx
ð(SC_CTX *)
ùls
->
s¦
;

90 
dwSSPIFÏgs
 = 
ISC_REQ_SEQUENCE_DETECT
 |

91 
ISC_REQ_REPLAY_DETECT
 |

92 
ISC_REQ_CONFIDENTIALITY
 |

93 
ISC_RET_EXTENDED_ERROR
 |

94 
ISC_REQ_ALLOCATE_MEMORY
 |

95 
ISC_REQ_STREAM
;

99 ià(!(
IoBufãr
 = 
	`LoÿlAÎoc
(
LMEM_FIXED
, 
SC_IO_BUFFER_SIZE
)))

100  
SEC_E_INSUFFICIENT_MEMORY
;

102 
cbIoBufãr
 = 0;

103 
fDoR—d
 = 
In™ŸlR—d
;

108 
rc
 = 
SEC_I_CONTINUE_NEEDED
;

110 
rc
 =ð
SEC_I_CONTINUE_NEEDED
 ||

111 
rc
 =ð
SEC_E_INCOMPLETE_MESSAGE
 ||

112 
rc
 =ð
SEC_I_INCOMPLETE_CREDENTIALS
 )

115 ià(
rc
 =ð
SEC_E_INCOMPLETE_MESSAGE
 ||

116 !
cbIoBufãr
)

118 if(
fDoR—d
)

120 
ssize_t
 
nby‹s
 = 
pvio
->
m‘hods
->
	`»ad
Õvio, 
IoBufãr
 + 
cbIoBufãr
, (
size_t
)(
SC_IO_BUFFER_SIZE
 - cbIoBuffer));

121 ià(
nby‹s
 <= 0)

123 
rc
 = 
SEC_E_INTERNAL_ERROR
;

126 
cbD©a
 = (
DWORD
)
nby‹s
;

127 
cbIoBufãr
 +ð
cbD©a
;

130 
fDoR—d
 = 
TRUE
;

137 
InBufãrs
[0].
pvBufãr
 = 
IoBufãr
;

138 
InBufãrs
[0].
cbBufãr
 = 
cbIoBufãr
;

139 
InBufãrs
[0].
BufãrTy³
 = 
SECBUFFER_TOKEN
;

141 
InBufãrs
[1].
pvBufãr
 = 
NULL
;

142 
InBufãrs
[1].
cbBufãr
 = 0;

143 
InBufãrs
[1].
BufãrTy³
 = 
SECBUFFER_EMPTY
;

145 
InBufãr
.
cBufãrs
 = 2;

146 
InBufãr
.
pBufãrs
 = 
InBufãrs
;

147 
InBufãr
.
ulV”siÚ
 = 
SECBUFFER_VERSION
;

151 
OutBufãrs
.
pvBufãr
 = 
NULL
;

152 
OutBufãrs
.
BufãrTy³
ð
SECBUFFER_TOKEN
;

153 
OutBufãrs
.
cbBufãr
 = 0;

155 
OutBufãr
.
cBufãrs
 = 1;

156 
OutBufãr
.
pBufãrs
 = &
OutBufãrs
;

157 
OutBufãr
.
ulV”siÚ
 = 
SECBUFFER_VERSION
;

160 
rc
 = 
	`In™ŸlizeSecur™yCÚ‹xtA
(&
sùx
->
C»dHdl
,

161 &
sùx
->
hCtxt
,

162 
NULL
,

163 
dwSSPIFÏgs
,

165 
SECURITY_NATIVE_DREP
,

166 &
InBufãr
,

168 
NULL
,

169 &
OutBufãr
,

170 &
dwSSPIOutFÏgs
,

171 &
tsExpœy
 );

174 ià(
rc
 =ð
SEC_E_OK
 ||

175 
rc
 =ð
SEC_I_CONTINUE_NEEDED
 ||

176 (
	`FAILED
(
rc
è&& (
dwSSPIOutFÏgs
 & 
ISC_RET_EXTENDED_ERROR
)))

178 if(
OutBufãrs
.
cbBufãr
 && OutBufãrs.
pvBufãr
)

180 
ssize_t
 
nby‹s
 = 
pvio
->
m‘hods
->
	`wr™e
Õvio, (
uch¬
 *)
OutBufãrs
.
pvBufãr
, (
size_t
)OutBufãrs.
cbBufãr
);

181 if(
nby‹s
 <= 0)

183 
	`F»eCÚ‹xtBufãr
(
OutBufãrs
.
pvBufãr
);

184 
	`D–‘eSecur™yCÚ‹xt
(&
sùx
->
hCtxt
);

185  
SEC_E_INTERNAL_ERROR
;

187 
cbD©a
ð(
DWORD
)
nby‹s
;

189 
	`F»eCÚ‹xtBufãr
(
OutBufãrs
.
pvBufãr
);

190 
OutBufãrs
.
pvBufãr
 = 
NULL
;

194 
rc
) {

195 
SEC_E_INCOMPLETE_MESSAGE
:

199 
SEC_E_OK
:

202 ià(
InBufãrs
[1].
BufãrTy³
 =ð
SECBUFFER_EXTRA
)

204 ià(!(
pExŒaD©a
->
pvBufãr
ð
	`LoÿlAÎoc
(0, 
InBufãrs
[1].
cbBufãr
)))

205  
SEC_E_INSUFFICIENT_MEMORY
;

207 
	`MoveMemÜy
(
pExŒaD©a
->
pvBufãr
, 
IoBufãr
 + (
cbIoBufãr
 - 
InBufãrs
[1].
cbBufãr
), InBuffers[1].cbBuffer );

208 
pExŒaD©a
->
BufãrTy³
 = 
SECBUFFER_TOKEN
;

209 
pExŒaD©a
->
cbBufãr
 = 
InBufãrs
[1].cbBuffer;

213 
pExŒaD©a
->
BufãrTy³
ð
SECBUFFER_EMPTY
;

214 
pExŒaD©a
->
pvBufãr
ð
NULL
;

215 
pExŒaD©a
->
cbBufãr
= 0;

219 
SEC_I_INCOMPLETE_CREDENTIALS
:

222 
fDoR—d
ð
FALSE
;

223 
rc
ð
SEC_I_CONTINUE_NEEDED
;

227 ià(
	`FAILED
(
rc
))

229 
loÝ’d
;

234 iàÐ
InBufãrs
[1].
BufãrTy³
 =ð
SECBUFFER_EXTRA
 )

236 
	`MoveMemÜy
Ð
IoBufãr
, IoBufã¸+ (
cbIoBufãr
 - 
InBufãrs
[1].
cbBufãr
), InBuffers[1].cbBuffer );

237 
cbIoBufãr
 = 
InBufãrs
[1].
cbBufãr
;

240 
cbIoBufãr
 = 0;

242 
loÝ’d
:

243 ià(
	`FAILED
(
rc
))

245 
	`ma_schªÃl_£t_£c_”rÜ
(
pvio
, 
rc
);

246 
	`D–‘eSecur™yCÚ‹xt
(&
sùx
->
hCtxt
);

248 
	`LoÿlF»e
(
IoBufãr
);

250  
rc
;

251 
	}
}

270 
SECURITY_STATUS
 
	$ma_schªÃl_þ›Á_hªdshake
(
MARIADB_TLS
 *
ùls
)

272 
MARIADB_PVIO
 *
pvio
;

273 
SECURITY_STATUS
 
sR‘
;

274 
DWORD
 
OutFÏgs
;

275 
DWORD
 
r
;

276 
SC_CTX
 *
sùx
;

277 
SecBufãr
 
ExŒaD©a
;

278 
DWORD
 
SFÏgs
ð
ISC_REQ_SEQUENCE_DETECT
 | 
ISC_REQ_REPLAY_DETECT
 |

279 
ISC_REQ_CONFIDENTIALITY
 | 
ISC_RET_EXTENDED_ERROR
 |

280 
ISC_REQ_USE_SUPPLIED_CREDS
 |

281 
ISC_REQ_ALLOCATE_MEMORY
 | 
ISC_REQ_STREAM
;

283 
SecBufãrDesc
 
BufãrOut
;

284 
SecBufãr
 
BufãrsOut
;

286 ià(!
ùls
 || !ùls->
pvio
)

289 
pvio
ð
ùls
->pvio;

290 
sùx
ð(
SC_CTX
 *)
ùls
->
s¦
;

293 
BufãrsOut
.
BufãrTy³
ð
SECBUFFER_TOKEN
;

294 
BufãrsOut
.
cbBufãr
= 0;

295 
BufãrsOut
.
pvBufãr
ð
NULL
;

298 
BufãrOut
.
cBufãrs
= 1;

299 
BufãrOut
.
pBufãrs
ð&
BufãrsOut
;

300 
BufãrOut
.
ulV”siÚ
ð
SECBUFFER_VERSION
;

302 
sR‘
 = 
	`In™ŸlizeSecur™yCÚ‹xt
(&
sùx
->
C»dHdl
,

303 
NULL
,

304 
pvio
->
mysql
->
ho¡
,

305 
SFÏgs
,

307 
SECURITY_NATIVE_DREP
,

308 
NULL
,

310 &
sùx
->
hCtxt
,

311 &
BufãrOut
,

312 &
OutFÏgs
,

313 
NULL
);

315 if(
sR‘
 !ð
SEC_I_CONTINUE_NEEDED
)

317 
	`ma_schªÃl_£t_£c_”rÜ
(
pvio
, 
sR‘
);

318  
sR‘
;

322 if(
BufãrsOut
.
cbBufãr
 !ð0 && BufãrsOut.
pvBufãr
 !ð
NULL
)

324 
ssize_t
 
nby‹s
 = (
DWORD
)
pvio
->
m‘hods
->
	`wr™e
Õvio, (
uch¬
 *)
BufãrsOut
.
pvBufãr
, (
size_t
)BufãrsOut.
cbBufãr
);

326 ià(
nby‹s
 <= 0)

328 
sR‘
ð
SEC_E_INTERNAL_ERROR
;

329 
’d
;

331 
r
 = (
DWORD
)
nby‹s
;

333 
sR‘
ð
	`ma_schªÃl_hªdshake_loÝ
(
pvio
, 
TRUE
, &
ExŒaD©a
);

337 ià((
sR‘
 = 
	`Qu”yCÚ‹xtA‰ribu‹s
(&
sùx
->
hCtxt
, 
SECPKG_ATTR_STREAM_SIZES
, &sùx->
Sizes
 )))

338 
’d
;

340 
sùx
->
IoBufãrSize
ð
	`SCHANNEL_PAYLOAD
(sùx->
Sizes
);

341 ià(!(
sùx
->
IoBufãr
ð(
PUCHAR
)
	`LoÿlAÎoc
(0, sùx->
IoBufãrSize
)))

343 
sR‘
ð
SEC_E_INSUFFICIENT_MEMORY
;

344 
’d
;

347  
sR‘
;

348 
’d
:

349 ià(
BufãrsOut
.
pvBufãr
)

350 
	`F»eCÚ‹xtBufãr
(
BufãrsOut
.
pvBufãr
);

351  
sR‘
;

352 
	}
}

377 
SECURITY_STATUS
 
	$ma_schªÃl_»ad_deüy±
(
MARIADB_PVIO
 *
pvio
,

378 
CtxtHªdË
 * 
phCÚ‹xt
,

379 
DWORD
 *
Deüy±L’gth
,

380 
uch¬
 *
R—dBufãr
,

381 
DWORD
 
R—dBufãrSize
)

383 
ssize_t
 
nby‹s
 = 0;

384 
DWORD
 
dwOff£t
 = 0;

385 
SC_CTX
 *
sùx
;

386 
SECURITY_STATUS
 
sR‘
 = 0;

387 
SecBufãrDesc
 
Msg
;

388 
SecBufãr
 
Bufãrs
[4];

389 
i
;

391 ià(!
pvio
 || !pvio->
m‘hods
 || !pvio->m‘hods->
»ad
 || !pvio->
ùls
 || !
Deüy±L’gth
)

392  
SEC_E_INTERNAL_ERROR
;

394 
sùx
 = (
SC_CTX
 *)
pvio
->
ùls
->
s¦
;

395 *
Deüy±L’gth
 = 0;

397 ià(
sùx
->
d©aBuf
.
cbBufãr
)

400 
nby‹s
 = 
	`MIN
(
R—dBufãrSize
, 
sùx
->
d©aBuf
.
cbBufãr
);

401 
	`memýy
(
R—dBufãr
, 
sùx
->
d©aBuf
.
pvBufãr
, 
nby‹s
);

402 
sùx
->
d©aBuf
.
pvBufãr
 = (*)(sùx->d©aBuf.pvBufãrè+ 
nby‹s
;

403 
sùx
->
d©aBuf
.
cbBufãr
 -ð(
DWORD
)
nby‹s
;

404 *
Deüy±L’gth
 = (
DWORD
)
nby‹s
;

405  
SEC_E_OK
;

412 ià(
sùx
->
exŒaBuf
.
cbBufãr
)

414 
	`memmove
(
sùx
->
IoBufãr
, sùx->
exŒaBuf
.
pvBufãr
, sùx->exŒaBuf.
cbBufãr
);

415 
dwOff£t
 = 
sùx
->
exŒaBuf
.
cbBufãr
;

416 
sùx
->
exŒaBuf
.
cbBufãr
 = 0;

420 
	`as£¹
(
sùx
->
IoBufãrSize
 > 
dwOff£t
);

421 ià(
dwOff£t
 =ð0 || 
sR‘
 =ð
SEC_E_INCOMPLETE_MESSAGE
)

423 
nby‹s
 = 
pvio
->
m‘hods
->
	`»ad
Õvio, 
sùx
->
IoBufãr
 + 
dwOff£t
, (
size_t
)(sùx->
IoBufãrSize
 - dwOffset));

424 ià(
nby‹s
 <= 0)

428  
SEC_E_INVALID_HANDLE
;

430 
dwOff£t
 +ð(
DWORD
)
nby‹s
;

432 
	`Z”oMemÜy
(
Bufãrs
, (
SecBufãr
) * 4);

433 
Bufãrs
[0].
pvBufãr
 = 
sùx
->
IoBufãr
;

434 
Bufãrs
[0].
cbBufãr
 = 
dwOff£t
;

436 
Bufãrs
[0].
BufãrTy³
 = 
SECBUFFER_DATA
;

437 
Bufãrs
[1].
BufãrTy³
 = 
SECBUFFER_EMPTY
;

438 
Bufãrs
[2].
BufãrTy³
 = 
SECBUFFER_EMPTY
;

439 
Bufãrs
[3].
BufãrTy³
 = 
SECBUFFER_EMPTY
;

441 
Msg
.
ulV”siÚ
 = 
SECBUFFER_VERSION
;

442 
Msg
.
cBufãrs
 = 4;

443 
Msg
.
pBufãrs
 = 
Bufãrs
;

445 
sR‘
 = 
	`Deüy±Mes§ge
(
phCÚ‹xt
, &
Msg
, 0, 
NULL
);

447 } 
sR‘
 =ð
SEC_E_INCOMPLETE_MESSAGE
);

450 ià(
sR‘
 !ð
SEC_E_OK
)

452 
	`ma_schªÃl_£t_£c_”rÜ
(
pvio
, 
sR‘
);

453  
sR‘
;

456 
sùx
->
exŒaBuf
.
cbBufãr
 = 0;

457 
sùx
->
d©aBuf
.
cbBufãr
 = 0;

458 
i
 = 0; i < 4; i++)

460 ià(
Bufãrs
[
i
].
BufãrTy³
 =ð
SECBUFFER_DATA
)

461 
sùx
->
d©aBuf
 = 
Bufãrs
[
i
];

462 ià(
Bufãrs
[
i
].
BufãrTy³
 =ð
SECBUFFER_EXTRA
)

463 
sùx
->
exŒaBuf
 = 
Bufãrs
[
i
];

467 ià(
sùx
->
d©aBuf
.
cbBufãr
)

469 
	`as£¹
(
sùx
->
d©aBuf
.
pvBufãr
);

474 
nby‹s
 = 
	`MIN
(
sùx
->
d©aBuf
.
cbBufãr
, 
R—dBufãrSize
);

475 
	`memýy
((*)
R—dBufãr
, 
sùx
->
d©aBuf
.
pvBufãr
, 
nby‹s
);

476 
sùx
->
d©aBuf
.
cbBufãr
 -ð()
nby‹s
;

477 
sùx
->
d©aBuf
.
pvBufãr
 = (*)sùx->d©aBuf.pvBufã¸+ 
nby‹s
;

479 *
Deüy±L’gth
 = (
DWORD
)
nby‹s
;

480  
SEC_E_OK
;

484 
	}
}

486 
	~"wš32_”rmsg.h
"

487 
my_boÞ
 
	$ma_schªÃl_v”ify_û¹s
(
MARIADB_TLS
 *
ùls
, 
BOOL
 
v”ify_£rv”_Çme
)

489 
SECURITY_STATUS
 
¡©us
;

491 
MARIADB_PVIO
 *
pvio
ð
ùls
->pvio;

492 
MYSQL
 *
mysql
ð
pvio
->mysql;

493 
SC_CTX
 *
sùx
 = (SC_CTX *)
ùls
->
s¦
;

494 cÚ¡ *
ÿ_fže
ð
mysql
->
ÝtiÚs
.
s¦_ÿ
;

495 cÚ¡ * 
ÿ_·th
 = 
mysql
->
ÝtiÚs
.
s¦_ÿ·th
;

496 cÚ¡ *
ül_fže
ð
mysql
->
ÝtiÚs
.
ex‹nsiÚ
 ? mysql->ÝtiÚs.ex‹nsiÚ->
s¦_ül
 : 
NULL
;

497 cÚ¡ * 
ül_·th
 = 
mysql
->
ÝtiÚs
.
ex‹nsiÚ
 ? mysql->ÝtiÚs.ex‹nsiÚ->
s¦_üÍ©h
 : 
NULL
;

498 
PCCERT_CONTEXT
 
pS”v”C”t
ð
NULL
;

499 
”rmsg
[256];

500 
HCERTSTORE
 
¡Üe
ð
NULL
;

501 
»t
= 0;

503 
¡©us
 = 
	`schªÃl_ü—‹_¡Üe
(
ÿ_fže
, 
ÿ_·th
, 
ül_fže
, 
ül_·th
, &
¡Üe
, 
”rmsg
, (errmsg));

504 if(
¡©us
)

505 
’d
;

507 
¡©us
 = 
	`Qu”yCÚ‹xtA‰ribu‹sA
(&
sùx
->
hCtxt
, 
SECPKG_ATTR_REMOTE_CERT_CONTEXT
, (
PVOID
)&
pS”v”C”t
);

508 ià(
¡©us
)

510 
	`ma_fÜm©_wš32_”rÜ
(
”rmsg
, Ó¼msg), 
	`G‘La¡E¼Ü
(),

512 
’d
;

515 
¡©us
 = 
	`schªÃl_v”ify_£rv”_û¹ifiÿ‹
(

516 
pS”v”C”t
,

517 
¡Üe
,

518 
ül_fže
 !ð0 || 
ül_·th
 != 0,

519 
mysql
->
ho¡
,

520 
v”ify_£rv”_Çme
,

521 
”rmsg
, (errmsg));

523 ià(
¡©us
)

524 
’d
;

526 
»t
= 1;

528 
’d
:

529 ià(!
»t
)

531 
pvio
->
	`£t_”rÜ
(
mysql
, 
CR_SSL_CONNECTION_ERROR
, 
SQLSTATE_UNKNOWN
,

532 "SSL cÚÃùiÚƒ¼Ü: %s", 
”rmsg
);

534 ià(
pS”v”C”t
)

535 
	`C”tF»eC”tifiÿ‹CÚ‹xt
(
pS”v”C”t
);

536 if(
¡Üe
)

537 
	`schªÃl_ä“_¡Üe
(
¡Üe
);

538  
»t
;

539 
	}
}

560 
ssize_t
 
	$ma_schªÃl_wr™e_’üy±
(
MARIADB_PVIO
 *
pvio
,

561 
uch¬
 *
Wr™eBufãr
,

562 
size_t
 
Wr™eBufãrSize
)

564 
SECURITY_STATUS
 
scR‘
;

565 
SecBufãrDesc
 
Mes§ge
;

566 
SecBufãr
 
Bufãrs
[4];

567 
DWORD
 
cbMes§ge
;

568 
PBYTE
 
pbMes§ge
;

569 
SC_CTX
 *
sùx
ð(SC_CTX *)
pvio
->
ùls
->
s¦
;

570 
size_t
 
·ylßd
;

571 
ssize_t
 
nby‹s
;

572 
DWORD
 
wr™e_size
;

574 
·ylßd
ð
	`MIN
(
Wr™eBufãrSize
, 
sùx
->
Sizes
.
cbMaximumMes§ge
);

576 
	`memýy
(&
sùx
->
IoBufãr
[sùx->
Sizes
.
cbH—d”
], 
Wr™eBufãr
, 
·ylßd
);

577 
pbMes§ge
 = 
sùx
->
IoBufãr
 + sùx->
Sizes
.
cbH—d”
;

578 
cbMes§ge
 = (
DWORD
)
·ylßd
;

580 
Bufãrs
[0].
pvBufãr
 = 
sùx
->
IoBufãr
;

581 
Bufãrs
[0].
cbBufãr
 = 
sùx
->
Sizes
.
cbH—d”
;

582 
Bufãrs
[0].
BufãrTy³
 = 
SECBUFFER_STREAM_HEADER
;

584 
Bufãrs
[1].
pvBufãr
 = &
sùx
->
IoBufãr
[sùx->
Sizes
.
cbH—d”
];

585 
Bufãrs
[1].
cbBufãr
 = (
DWORD
)
·ylßd
;

586 
Bufãrs
[1].
BufãrTy³
 = 
SECBUFFER_DATA
;

588 
Bufãrs
[2].
pvBufãr
 = &
sùx
->
IoBufãr
[sùx->
Sizes
.
cbH—d”
] + 
·ylßd
;

589 
Bufãrs
[2].
cbBufãr
 = 
sùx
->
Sizes
.
cbT¿ž”
;

590 
Bufãrs
[2].
BufãrTy³
 = 
SECBUFFER_STREAM_TRAILER
;

592 
Bufãrs
[3].
pvBufãr
 = 
SECBUFFER_EMPTY
;

593 
Bufãrs
[3].
cbBufãr
 = 
SECBUFFER_EMPTY
;

594 
Bufãrs
[3].
BufãrTy³
 = 
SECBUFFER_EMPTY
;

597 
Mes§ge
.
ulV”siÚ
 = 
SECBUFFER_VERSION
;

598 
Mes§ge
.
cBufãrs
 = 4;

599 
Mes§ge
.
pBufãrs
 = 
Bufãrs
;

600 ià((
scR‘
 = 
	`Enüy±Mes§ge
(&
sùx
->
hCtxt
, 0, &
Mes§ge
, 0))!ð
SEC_E_OK
)

602 
wr™e_size
 = 
Bufãrs
[0].
cbBufãr
 + Buffers[1].cbBuffer + Buffers[2].cbBuffer;

603 
nby‹s
 = 
pvio
->
m‘hods
->
	`wr™e
Õvio, 
sùx
->
IoBufãr
, 
wr™e_size
);

604  
nby‹s
 =ð
wr™e_size
 ? 
·ylßd
 : -1;

605 
	}
}

608 *
s¦_´ÙocÞ_v”siÚ
[5];

611 
	$ma_Žs_g‘_´ÙocÞ_v”siÚ
(
MARIADB_TLS
 *
ùls
)

613 
SC_CTX
 *
sùx
;

614 
SecPkgCÚ‹xt_CÚÃùiÚInfo
 
CÚÃùiÚInfo
;

615 ià(!
ùls
->
s¦
)

618 
sùx
ð(
SC_CTX
 *)
ùls
->
s¦
;

620 ià(
	`Qu”yCÚ‹xtA‰ribu‹s
(&
sùx
->
hCtxt
, 
SECPKG_ATTR_CONNECTION_INFO
, &
CÚÃùiÚInfo
è!ð
SEC_E_OK
)

623 
CÚÃùiÚInfo
.
dwPrÙocÞ
)

625 
SP_PROT_SSL3_CLIENT
:

626  
PROTOCOL_SSLV3
;

627 
SP_PROT_TLS1_CLIENT
:

628  
PROTOCOL_TLS_1_0
;

629 
SP_PROT_TLS1_1_CLIENT
:

630  
PROTOCOL_TLS_1_1
;

631 
SP_PROT_TLS1_2_CLIENT
:

632  
PROTOCOL_TLS_1_2
;

636 
	}
}

	@libmariadb/secure/ma_schannel.h

22 #iâdeà
_ma_schªÃl_h_


23 
	#_ma_schªÃl_h_


	)

25 
	#SECURITY_WIN32


	)

26 
	~<ma_glob®.h
>

27 
	~<ma_sys.h
>

28 
	~<ma_commÚ.h
>

29 
	~<ma_pvio.h
>

30 
	~<”rmsg.h
>

33 
	~<wšüy±.h
>

34 
	~<wšŒu¡.h
>

37 
	~<£cur™y.h
>

39 
	~<schÆ¥.h
>

40 #undeà
SECURITY_WIN32


41 
	~<wšdows.h
>

42 
	~<s¥i.h
>

44 
	#SC_IO_BUFFER_SIZE
 0x4000

	)

47 
	~<ma_±h»ad.h
>

49 
	s¡_DER
 {

50 * 
	md”_bufãr
;

51 
DWORD
 
	md”_Ëngth
;

54 
	s¡_schªÃl
 {

55 
C»dHªdË
 
	mC»dHdl
;

56 
PUCHAR
 
	mIoBufãr
;

57 
DWORD
 
	mIoBufãrSize
;

58 
SecPkgCÚ‹xt_SŒ—mSizes
 
	mSizes
;

59 
CtxtHªdË
 
	mhCtxt
;

62 
SecBufãr
 
	mexŒaBuf
;

63 
SecBufãr
 
	md©aBuf
;

67 
¡_schªÃl
 
	tSC_CTX
;

69 
HCERTSTORE
 
ÿ_C”tStÜe
, 
ül_C”tStÜe
;

70 
my_boÞ
 
ÿ_Check
, 
ül_Check
;

73 
SECURITY_STATUS
 
ma_schªÃl_þ›Á_hªdshake
(
MARIADB_TLS
 *
ùls
);

74 
SECURITY_STATUS
 
ma_schªÃl_hªdshake_loÝ
(
MARIADB_PVIO
 *
pvio
, 
my_boÞ
 
In™ŸlR—d
, 
SecBufãr
 *
pExŒaD©a
);

76 
my_boÞ
 
ma_schªÃl_v”ify_û¹s
(
MARIADB_TLS
 *
ùls
, 
BOOL
 
v”ify_£rv”_Çme
);

77 
ssize_t
 
ma_schªÃl_wr™e_’üy±
(
MARIADB_PVIO
 *
pvio
,

78 
uch¬
 *
Wr™eBufãr
,

79 
size_t
 
Wr™eBufãrSize
);

80 
SECURITY_STATUS
 
ma_schªÃl_»ad_deüy±
(
MARIADB_PVIO
 *
pvio
,

81 
CtxtHªdË
* 
phCÚ‹xt
,

82 
DWORD
 *
Deüy±L’gth
,

83 
uch¬
 *
R—dBufãr
,

84 
DWORD
 
R—dBufãrSize
);

	@libmariadb/secure/openssl.c

20 
	~<ma_glob®.h
>

21 
	~<ma_sys.h
>

22 
	~<ma_commÚ.h
>

23 
	~<ma_pvio.h
>

24 
	~<”rmsg.h
>

25 
	~<¡ršg.h
>

26 
	~<mysql/þ›Á_¶ugš.h
>

27 
	~<¡ršg.h
>

28 
	~<Ý’s¦/s¦.h
>

29 
	~<Ý’s¦/”r.h
>

30 
	~<Ý’s¦/cÚf.h
>

31 
	~<Ý’s¦/md4.h
>

33 #ià
defšed
(
_WIN32
è&& !defšed(
_OPENSSL_Aµlšk
è&& defšed(
HAVE_OPENSSL_APPLINK_C
)

34 
	~<Ý’s¦/­¶šk.c
>

37 #ià
OPENSSL_VERSION_NUMBER
 >ð0x10002000L && !
defšed
(
LIBRESSL_VERSION_NUMBER
)

38 
	~<Ý’s¦/x509v3.h
>

39 
	#HAVE_OPENSSL_CHECK_HOST
 1

	)

42 #ià
OPENSSL_VERSION_NUMBER
 >ð0x10100000L && !
defšed
(
LIBRESSL_VERSION_NUMBER
)

43 
	#HAVE_OPENSSL_1_1_API


	)

46 #ià
OPENSSL_VERSION_NUMBER
 < 0x10000000L

47 
	#SSL_OP_NO_TLSv1_1
 0L

	)

48 
	#SSL_OP_NO_TLSv1_2
 0L

	)

49 
	#CRYPTO_THREADID_£t_ÿÎback
 
CRYPTO_£t_id_ÿÎback


	)

50 
	#CRYPTO_THREADID_g‘_ÿÎback
 
CRYPTO_g‘_id_ÿÎback


	)

53 #ià
defšed
(
OPENSSL_USE_BIOMETHOD
)

54 #undeà
OPENSSL_USE_BIOMETHOD


56 #iâdeà
HAVE_OPENSSL_DEFAULT


57 
	~<memÜy.h
>

58 
	#ma_m®loc
(
A
,
B
è
	`m®loc
((A))

	)

59 #undeà
ma_ä“


60 
	#ma_ä“
(
A
è
	`ä“
((A))

	)

61 
	#ma_¢´štf
 
¢´štf


	)

62 
	#ma_v¢´štf
 
v¢´štf


	)

63 #undeà
SAFE_MUTEX


65 
	~<ma_±h»ad.h
>

67 
	~<m¬Ÿdb_async.h
>

68 
	~<ma_cÚ‹xt.h
>

70 
my_boÞ
 
ma_Žs_š™Ÿlized
;

71 
m¬Ÿdb_deš™Ÿlize_s¦
;

73 
	#MAX_SSL_ERR_LEN
 100

	)

74 
	gŽs_lib¿ry_v”siÚ
[
TLS_VERSION_LENGTH
];

76 
±h»ad_mu‹x_t
 
	gLOCK_Ý’s¦_cÚfig
;

77 #iâdeà
HAVE_OPENSSL_1_1_API


78 
±h»ad_mu‹x_t
 *
	gLOCK_üy±o
ð
NULL
;

80 #ià
defšed
(
OPENSSL_USE_BIOMETHOD
)

81 
ma_bio_»ad
(
BIO
 *
h
, *
buf
, 
size
);

82 
ma_bio_wr™e
(
BIO
 *
h
, cÚ¡ *
buf
, 
size
);

83 
BIO_METHOD
 
	gma_BIO_m‘hod
;

87 
	$ma_Žs_v”siÚ_ÝtiÚs
(cÚ¡ *
v”siÚ
)

89 
´ÙocÞ_ÝtiÚs
,

90 
di§bË_®l_´ÙocÞs
;

92 
´ÙocÞ_ÝtiÚs
ð
di§bË_®l_´ÙocÞs
=

93 
SSL_OP_NO_SSLv2
 |

94 
SSL_OP_NO_SSLv3
 |

95 
SSL_OP_NO_TLSv1
 |

96 
SSL_OP_NO_TLSv1_1
 |

97 
SSL_OP_NO_TLSv1_2


98 #ifdeà
TLS1_3_VERSION


99 | 
SSL_OP_NO_TLSv1_3


103 ià(!
v”siÚ
)

106 ià(
	`¡r¡r
(
v”siÚ
, "TLSv1.0"))

107 
´ÙocÞ_ÝtiÚs
&ð~
SSL_OP_NO_TLSv1
;

108 ià(
	`¡r¡r
(
v”siÚ
, "TLSv1.1"))

109 
´ÙocÞ_ÝtiÚs
&ð~
SSL_OP_NO_TLSv1_1
;

110 ià(
	`¡r¡r
(
v”siÚ
, "TLSv1.2"))

111 
´ÙocÞ_ÝtiÚs
&ð~
SSL_OP_NO_TLSv1_2
;

112 #ifdeà
TLS1_3_VERSION


113 ià(
	`¡r¡r
(
v”siÚ
, "TLSv1.3"))

114 
´ÙocÞ_ÝtiÚs
&ð~
SSL_OP_NO_TLSv1_3
;

117 ià(
´ÙocÞ_ÝtiÚs
 !ð
di§bË_®l_´ÙocÞs
)

118  
´ÙocÞ_ÝtiÚs
;

120 
	}
}

122 
	$ma_Žs_£t_”rÜ
(
MYSQL
 *
mysql
)

124 
ulÚg
 
s¦_”ºo
ð
	`ERR_g‘_”rÜ
();

125 
s¦_”rÜ
[
MAX_SSL_ERR_LEN
];

126 cÚ¡ *
s¦_”rÜ_»asÚ
;

127 
MARIADB_PVIO
 *
pvio
ð
mysql
->
Ãt
.pvio;

129 ià(!
s¦_”ºo
)

131 
pvio
->
	`£t_”rÜ
(
mysql
, 
CR_SSL_CONNECTION_ERROR
, 
SQLSTATE_UNKNOWN
, "Unknown SSLƒrror");

134 ià((
s¦_”rÜ_»asÚ
ð
	`ERR_»asÚ_”rÜ_¡ršg
(
s¦_”ºo
)))

136 
pvio
->
	`£t_”rÜ
(
mysql
, 
CR_SSL_CONNECTION_ERROR
, 
SQLSTATE_UNKNOWN
,

137 0, 
s¦_”rÜ_»asÚ
);

140 
	`¢´štf
(
s¦_”rÜ
, 
MAX_SSL_ERR_LEN
, "SSLƒ¼no=%lu", 
s¦_”ºo
);

141 
pvio
->
	`£t_”rÜ
(
mysql
, 
CR_SSL_CONNECTION_ERROR
, 
SQLSTATE_UNKNOWN
, 0, 
s¦_”rÜ
);

143 
	}
}

145 #iâdeà
HAVE_OPENSSL_1_1_API


151 #ià
OPENSSL_VERSION_NUMBER
 < 0x10000000L

152 
	$my_cb_th»adid
()

155  (è
	`±h»ad_£lf
();

156 
	}
}

158 
	$my_cb_th»adid
(
CRYPTO_THREADID
 *
id
)

160 
	`CRYPTO_THREADID_£t_num”ic
(
id
, ()
	`±h»ad_£lf
());

161 
	}
}

165 #iâdeà
HAVE_OPENSSL_1_1_API


166 
my_cb_lockšg
(
mode
, 
n
,

167 cÚ¡ *
fže
 
__©Œibu‹__
((
unu£d
)),

168 
lše
 
__©Œibu‹__
((
unu£d
)))

170 ià(
	gmode
 & 
	gCRYPTO_LOCK
)

171 
±h»ad_mu‹x_lock
(&
LOCK_üy±o
[
n
]);

173 
±h»ad_mu‹x_uÆock
(&
LOCK_üy±o
[
n
]);

176 
	$s¦_th»ad_š™
()

178 ià(!
	`CRYPTO_THREADID_g‘_ÿÎback
()

179 #iâdeà
OPENSSL_NO_DEPRECATED


180 && !
	`CRYPTO_g‘_id_ÿÎback
()

184 
i
, 
max
ð
	`CRYPTO_num_locks
();

186 ià(
LOCK_üy±o
 =ð
NULL
)

188 ià(!(
LOCK_üy±o
=

189 (
±h»ad_mu‹x_t
 *)
	`ma_m®loc
(Õth»ad_mu‹x_tè* 
max
, 
	`MYF
(0))))

192 
i
=0; i < 
max
; i++)

193 
	`±h»ad_mu‹x_š™
(&
LOCK_üy±o
[
i
], 
NULL
);

195 
	`CRYPTO_£t_lockšg_ÿÎback
(
my_cb_lockšg
);

196 
	`CRYPTO_THREADID_£t_ÿÎback
(
my_cb_th»adid
);

199 
	}
}

202 #ià
defšed
(
_WIN32
è|| !defšed(
DISABLE_SIGPIPE
)

203 
	#di§bË_sigpe
()

	)

205 
	~<sigÇl.h
>

206 
	$ma_sigpe_hªdËr
()

208 
	}
}

210 
	$di§bË_sigpe
()

212 
sigaùiÚ
 
Þd_hªdËr
, 
Ãw_hªdËr
={
NULL
};

213 ià(!
	`sigaùiÚ
 (
SIGPIPE
, 
NULL
, &
Þd_hªdËr
) &&

214 !
Þd_hªdËr
.
§_hªdËr
)

216 
Ãw_hªdËr
.
§_hªdËr
ð
ma_sigpe_hªdËr
;

217 
Ãw_hªdËr
.
§_æags
= 0;

218 ià(!
	`sigem±y£t
(&
Ãw_hªdËr
.
§_mask
))

219 
	`sigaùiÚ
(
SIGPIPE
, &
Ãw_hªdËr
, 
NULL
);

221 
	}
}

235 
ma_Žs_¡¬t
(*
”rmsg
 
__©Œibu‹__
((
unu£d
)), 
size_t
 
”rmsg_Ën
 __attribute__((unused)))

237 
	grc
= 1;

238 *
	gp
;

239 ià(
	gma_Žs_š™Ÿlized
)

243 
±h»ad_mu‹x_š™
(&
LOCK_Ý’s¦_cÚfig
, 
NULL
);

244 
±h»ad_mu‹x_lock
(&
LOCK_Ý’s¦_cÚfig
);

245 #ifdeà
HAVE_OPENSSL_1_1_API


246 ià(!
OPENSSL_š™_s¦
(
OPENSSL_INIT_LOAD_CONFIG
, 
NULL
))

247 
	g’d
;

249 ià(
s¦_th»ad_š™
())

251 
¡ºýy
(
”rmsg
, "NÙƒnough memÜy", 
”rmsg_Ën
);

252 
	g’d
;

254 
SSL_lib¿ry_š™
();

255 #ià
SSLEAY_VERSION_NUMBER
 >= 0x00907000L

256 
OPENSSL_cÚfig
(
NULL
);

259 #iâdeà
HAVE_OPENSSL_1_1_API


261 
SSL_lßd_”rÜ_¡ršgs
();

263 
O³nSSL_add_®l_®gÜ™hms
();

265 
di§bË_sigpe
();

266 #ifdeà
OPENSSL_USE_BIOMETHOD


267 
memýy
(&
ma_BIO_m‘hod
, 
BIO_s_sock‘
(), (
BIO_METHOD
));

268 
	gma_BIO_m‘hod
.
	gb»ad
ð
ma_bio_»ad
;

269 
	gma_BIO_m‘hod
.
	gbwr™e
ð
ma_bio_wr™e
;

271 
¢´štf
(
Žs_lib¿ry_v”siÚ
, 
TLS_VERSION_LENGTH
 - 1, "%s",

272 #ià
defšed
(
LIBRESSL_VERSION_NUMBER
è|| !defšed(
HAVE_OPENSSL_1_1_API
)

273 
SSL—y_v”siÚ
(
SSLEAY_VERSION
));

275 
O³nSSL_v”siÚ
(
OPENSSL_VERSION
));

278 ià((
	gp
ð
¡r¡r
(
Žs_lib¿ry_v”siÚ
, " ")))

279 *
	gp
= 0;

280 
	grc
= 0;

281 
	gma_Žs_š™Ÿlized
ð
TRUE
;

282 
	g’d
:

283 
±h»ad_mu‹x_uÆock
(&
LOCK_Ý’s¦_cÚfig
);

284  
	grc
;

299 
	$ma_Žs_’d
()

301 ià(
ma_Žs_š™Ÿlized
)

303 
	`±h»ad_mu‹x_lock
(&
LOCK_Ý’s¦_cÚfig
);

304 #iâdeà
HAVE_OPENSSL_1_1_API


305 ià(
LOCK_üy±o
)

307 
i
;

308 
	`CRYPTO_£t_lockšg_ÿÎback
(
NULL
);

309 
	`CRYPTO_THREADID_£t_ÿÎback
(
NULL
);

311 
i
=0; i < 
	`CRYPTO_num_locks
(); i++)

312 
	`±h»ad_mu‹x_de¡roy
(&
LOCK_üy±o
[
i
]);

313 
	`ma_ä“
((
g±r
)
LOCK_üy±o
);

314 
LOCK_üy±o
ð
NULL
;

317 ià(
m¬Ÿdb_deš™Ÿlize_s¦
)

319 #iâdeà
HAVE_OPENSSL_1_1_API


320 
	`ERR_»move_th»ad_¡©e
(
NULL
);

321 
	`EVP_þ—nup
();

322 
	`CRYPTO_þ—nup_®l_ex_d©a
();

323 
	`ERR_ä“_¡ršgs
();

324 
	`CONF_moduËs_ä“
();

325 
	`CONF_moduËs_uÆßd
(1);

328 
ma_Žs_š™Ÿlized
ð
FALSE
;

329 
	`±h»ad_mu‹x_uÆock
(&
LOCK_Ý’s¦_cÚfig
);

330 
	`±h»ad_mu‹x_de¡roy
(&
LOCK_Ý’s¦_cÚfig
);

333 
	}
}

335 
ma_Žs_g‘_·sswÜd
(*
buf
, 
size
,

336 
rwæag
 
__©Œibu‹__
((
unu£d
)),

337 *
u£rd©a
)

339 
mem£t
(
buf
, 0, 
size
);

340 ià(
	gu£rd©a
)

341 
¡ºýy
(
buf
, (*)
u£rd©a
, 
size
);

342  ()
¡¾’
(
buf
);

346 
	$ma_Žs_£t_û¹s
(
MYSQL
 *
mysql
, 
SSL_CTX
 *
ùx
)

348 *
û¹fže
ð
mysql
->
ÝtiÚs
.
s¦_û¹
,

349 *
keyfže
ð
mysql
->
ÝtiÚs
.
s¦_key
;

350 *
pw
ð(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
) ?

351 
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
Žs_pw
 : 
NULL
;

354 ià((
mysql
->
ÝtiÚs
.
s¦_ch”
 &&

355 
mysql
->
ÝtiÚs
.
s¦_ch”
[0] != 0))

358 #ifdeà
TLS1_3_VERSION


359 
	`SSL_CTX_£t_ch”su™es
(
ùx
, 
mysql
->
ÝtiÚs
.
s¦_ch”
) == 0 &&

361 
	`SSL_CTX_£t_ch”_li¡
(
ùx
, 
mysql
->
ÝtiÚs
.
s¦_ch”
) == 0)

362 
”rÜ
;

366 ià(!
	`SSL_CTX_lßd_v”ify_loÿtiÚs
(
ùx
,

367 
mysql
->
ÝtiÚs
.
s¦_ÿ
,

368 
mysql
->
ÝtiÚs
.
s¦_ÿ·th
))

370 ià(
mysql
->
ÝtiÚs
.
s¦_ÿ
 || mysql->ÝtiÚs.
s¦_ÿ·th
)

371 
”rÜ
;

372 ià(
	`SSL_CTX_£t_deçuÉ_v”ify_·ths
(
ùx
) == 0)

373 
”rÜ
;

376 ià(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
 &&

377 (
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
s¦_ül
 || mysql->ÝtiÚs.ex‹nsiÚ->
s¦_üÍ©h
))

379 
X509_STORE
 *
û¹¡Üe
;

381 ià((
û¹¡Üe
ð
	`SSL_CTX_g‘_û¹_¡Üe
(
ùx
)))

383 ià(
	`X509_STORE_lßd_loÿtiÚs
(
û¹¡Üe
, 
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
s¦_ül
,

384 
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
s¦_üÍ©h
) == 0)

385 
”rÜ
;

387 ià(
	`X509_STORE_£t_æags
(
û¹¡Üe
, 
X509_V_FLAG_CRL_CHECK
 | 
X509_V_FLAG_CRL_CHECK_ALL
) == 0)

388 
”rÜ
;

392 ià(
keyfže
 && !
û¹fže
)

393 
û¹fže
ð
keyfže
;

394 ià(
û¹fže
 && !
keyfže
)

395 
keyfže
ð
û¹fže
;

398 ià(
û¹fže
 && certfile[0] != 0)

400 ià(
	`SSL_CTX_u£_û¹ifiÿ‹_chaš_fže
(
ùx
, 
û¹fže
) != 1)

402 
”rÜ
;

406 ià(
keyfže
 && keyfile[0])

408 
FILE
 *
å
;

409 ià((
å
ð
	`fÝ’
(
keyfže
, "rb")))

411 
EVP_PKEY
 *
key
ð
	`EVP_PKEY_Ãw
();

412 
	`PEM_»ad_Priv©eKey
(
å
, &
key
, 
NULL
, 
pw
);

413 
	`fþo£
(
å
);

414 ià(
	`SSL_CTX_u£_Priv©eKey
(
ùx
, 
key
) != 1)

416 
”r
ð
	`ERR_³ek_”rÜ
();

417 
	`EVP_PKEY_ä“
(
key
);

418 ià(!(
	`ERR_GET_LIB
(
”r
è=ð
ERR_LIB_X509
 &&

419 
	`ERR_GET_REASON
(
”r
è=ð
X509_R_CERT_ALREADY_IN_HASH_TABLE
))

420 
”rÜ
;

422 
	`EVP_PKEY_ä“
(
key
);

424 
	`my_£t_”rÜ
(
mysql
, 
CR_SSL_CONNECTION_ERROR
, 
SQLSTATE_UNKNOWN
,

425 
	`CER
(
CR_FILE_NOT_FOUND
), 
keyfže
);

430 ià(
û¹fže
 && 
	`SSL_CTX_check_´iv©e_key
(
ùx
) != 1)

431 
”rÜ
;

433 
	`SSL_CTX_£t_v”ify
(
ùx
, (
mysql
->
ÝtiÚs
.
s¦_ÿ
 || mysql->ÝtiÚs.
s¦_ÿ·th
) ?

434 
SSL_VERIFY_PEER
 : 
SSL_VERIFY_NONE
, 
NULL
);

437 
”rÜ
:

438 
	`ma_Žs_£t_”rÜ
(
mysql
);

440 
	}
}

442 *
	$ma_Žs_š™
(
MYSQL
 *
mysql
)

444 
SSL
 *
s¦
ð
NULL
;

445 
SSL_CTX
 *
ùx
ð
NULL
;

446 
ÝtiÚs
ð
SSL_OP_ALL
 |

447 
SSL_OP_NO_SSLv2
 |

448 
SSL_OP_NO_SSLv3
;

449 
	`±h»ad_mu‹x_lock
(&
LOCK_Ý’s¦_cÚfig
);

451 #ià
OPENSSL_VERSION_NUMBER
 >= 0x10100000L

452 ià(!(
ùx
ð
	`SSL_CTX_Ãw
(
	`TLS_þ›Á_m‘hod
())))

454 ià(!(
ùx
ð
	`SSL_CTX_Ãw
(
	`SSLv23_þ›Á_m‘hod
())))

456 
”rÜ
;

457 ià(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
)

458 
ÝtiÚs
|ð
	`ma_Žs_v”siÚ_ÝtiÚs
(
mysql
->ÝtiÚs.
ex‹nsiÚ
->
Žs_v”siÚ
);

459 
	`SSL_CTX_£t_ÝtiÚs
(
ùx
, 
ÝtiÚs
);

462 ià(
	`ma_Žs_£t_û¹s
(
mysql
, 
ùx
))

464 
”rÜ
;

467 ià(!(
s¦
ð
	`SSL_Ãw
(
ùx
)))

468 
”rÜ
;

470 ià(!
	`SSL_£t_­p_d©a
(
s¦
, 
mysql
))

471 
”rÜ
;

473 
	`±h»ad_mu‹x_uÆock
(&
LOCK_Ý’s¦_cÚfig
);

474  (*)
s¦
;

475 
”rÜ
:

476 
	`±h»ad_mu‹x_uÆock
(&
LOCK_Ý’s¦_cÚfig
);

477 ià(
ùx
)

478 
	`SSL_CTX_ä“
(
ùx
);

479 ià(
s¦
)

480 
	`SSL_ä“
(
s¦
);

481  
NULL
;

482 
	}
}

484 
my_boÞ
 
	$ma_Žs_cÚÃù
(
MARIADB_TLS
 *
ùls
)

486 
SSL
 *
s¦
 = (SSL *)
ùls
->ssl;

487 
my_boÞ
 
blockšg
, 
Œy_cÚÃù
= 1;

488 
MYSQL
 *
mysql
;

489 
MARIADB_PVIO
 *
pvio
;

490 
rc
;

491 #ifdeà
OPENSSL_USE_BIOMETHOD


492 
BIO_METHOD
 *
bio_m‘hod
ð
NULL
;

493 
BIO
 *
bio
;

496 
mysql
ð(
MYSQL
 *)
	`SSL_g‘_­p_d©a
(
s¦
);

497 
pvio
ð
mysql
->
Ãt
.pvio;

500 ià(!(
blockšg
ð
pvio
->
m‘hods
->
	`is_blockšg
(pvio)))

501 
pvio
->
m‘hods
->
	`blockšg
Õvio, 
FALSE
, 0);

503 
	`SSL_þ—r
(
s¦
);

505 #ifdeà
OPENSSL_USE_BIOMETHOD


506 
bio
ð
	`BIO_Ãw
(&
ma_BIO_m‘hod
);

507 
bio
->
±r
ð
pvio
;

508 
	`SSL_£t_bio
(
s¦
, 
bio
, bio);

509 
	`BIO_£t_fd
(
bio
, 
	`mysql_g‘_sock‘
(
mysql
), 
BIO_NOCLOSE
);

511 
	`SSL_£t_fd
(
s¦
, ()
	`mysql_g‘_sock‘
(
mysql
));

514 
Œy_cÚÃù
 && (
rc
ð
	`SSL_cÚÃù
(
s¦
)) == -1)

516 (
	`SSL_g‘_”rÜ
(
s¦
, 
rc
))) {

517 
SSL_ERROR_WANT_READ
:

518 ià(
pvio
->
m‘hods
->
	`wa™_io_Ü_timeout
Õvio, 
TRUE
, 
mysql
->
ÝtiÚs
.
cÚÃù_timeout
) < 1)

519 
Œy_cÚÃù
= 0;

521 
SSL_ERROR_WANT_WRITE
:

522 ià(
pvio
->
m‘hods
->
	`wa™_io_Ü_timeout
Õvio, 
TRUE
, 
mysql
->
ÝtiÚs
.
cÚÃù_timeout
) < 1)

523 
Œy_cÚÃù
= 0;

526 
Œy_cÚÃù
= 0;

533 ià(
rc
 != 1 ||

534 (
mysql
->
þ›Á_æag
 & 
CLIENT_SSL_VERIFY_SERVER_CERT
) ||

535 (
mysql
->
ÝtiÚs
.
s¦_ÿ
 || mysql->ÝtiÚs.
s¦_ÿ·th
))

537 
x509_”r
ð
	`SSL_g‘_v”ify_»suÉ
(
s¦
);

538 ià(
x509_”r
 !ð
X509_V_OK
)

540 
	`my_£t_”rÜ
(
mysql
, 
CR_SSL_CONNECTION_ERROR
, 
SQLSTATE_UNKNOWN
,

541 
	`ER
(
CR_SSL_CONNECTION_ERROR
), 
	`X509_v”ify_û¹_”rÜ_¡ršg
(
x509_”r
));

543 ià(!
blockšg
)

544 
pvio
->
m‘hods
->
	`blockšg
Õvio, 
FALSE
, 0);

547 } ià(
rc
 != 1) {

548 
	`ma_Žs_£t_”rÜ
(
mysql
);

552 
pvio
->
ùls
->
s¦
= ctls->ssl= (*)ssl;

555 
	}
}

557 
my_boÞ


558 
	$ma_Žs_async_check_»suÉ
(
»s
, 
mysql_async_cÚ‹xt
 *
b
, 
SSL
 *
s¦
)

560 
s¦_”r
;

561 
b
->
ev’ts_to_wa™_fÜ
= 0;

562 ià(
»s
 >= 0)

564 
s¦_”r
ð
	`SSL_g‘_”rÜ
(
s¦
, 
»s
);

565 ià(
s¦_”r
 =ð
SSL_ERROR_WANT_READ
)

566 
b
->
ev’ts_to_wa™_fÜ
|ð
MYSQL_WAIT_READ
;

567 ià(
s¦_”r
 =ð
SSL_ERROR_WANT_WRITE
)

568 
b
->
ev’ts_to_wa™_fÜ
|ð
MYSQL_WAIT_WRITE
;

571 ià(
b
->
su¥’d_»sume_hook
)

572 (*
b
->
su¥’d_»sume_hook
)(
TRUE
, b->
su¥’d_»sume_hook_u£r_d©a
);

573 
	`my_cÚ‹xt_y›ld
(&
b
->
async_cÚ‹xt
);

574 ià(
b
->
su¥’d_»sume_hook
)

575 (*
b
->
su¥’d_»sume_hook
)(
FALSE
, b->
su¥’d_»sume_hook_u£r_d©a
);

577 
	}
}

579 
ssize_t
 
	$ma_Žs_»ad_async
(
MARIADB_PVIO
 *
pvio
,

580 cÚ¡ *
bufãr
,

581 
size_t
 
Ëngth
)

583 
»s
;

584 
mysql_async_cÚ‹xt
 *
b
ð
pvio
->
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
async_cÚ‹xt
;

585 
MARIADB_TLS
 *
ùls
ð
pvio
->ctls;

589 
»s
ð
	`SSL_»ad
((
SSL
 *)
ùls
->
s¦
, (*)
bufãr
, ()
Ëngth
);

590 ià(
	`ma_Žs_async_check_»suÉ
(
»s
, 
b
, (
SSL
 *)
ùls
->
s¦
))

591  
»s
;

593 
	}
}

595 
ssize_t
 
	$ma_Žs_wr™e_async
(
MARIADB_PVIO
 *
pvio
,

596 cÚ¡ *
bufãr
,

597 
size_t
 
Ëngth
)

599 
»s
;

600 
mysql_async_cÚ‹xt
 *
b
ð
pvio
->
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
async_cÚ‹xt
;

601 
MARIADB_TLS
 *
ùls
ð
pvio
->ctls;

605 
»s
ð
	`SSL_wr™e
((
SSL
 *)
ùls
->
s¦
, (*)
bufãr
, ()
Ëngth
);

606 ià(
	`ma_Žs_async_check_»suÉ
(
»s
, 
b
, (
SSL
 *)
ùls
->
s¦
))

607  
»s
;

609 
	}
}

612 
ssize_t
 
	$ma_Žs_»ad
(
MARIADB_TLS
 *
ùls
, cÚ¡ 
uch¬
* 
bufãr
, 
size_t
 
Ëngth
)

614 
rc
;

615 
MARIADB_PVIO
 *
pvio
ð
ùls
->pvio;

617 (
rc
ð
	`SSL_»ad
((
SSL
 *)
ùls
->
s¦
, (*)
bufãr
, ()
Ëngth
)) < 0)

619 
”rÜ
ð
	`SSL_g‘_”rÜ
((
SSL
 *)
ùls
->
s¦
, 
rc
);

620 ià(
”rÜ
 !ð
SSL_ERROR_WANT_READ
)

621  
rc
;

622 ià(
pvio
->
m‘hods
->
	`wa™_io_Ü_timeout
Õvio, 
TRUE
,…vio->
mysql
->
ÝtiÚs
.
»ad_timeout
) < 1)

623  
rc
;

625  
rc
;

626 
	}
}

628 
ssize_t
 
	$ma_Žs_wr™e
(
MARIADB_TLS
 *
ùls
, cÚ¡ 
uch¬
* 
bufãr
, 
size_t
 
Ëngth
)

630 
rc
;

631 
MARIADB_PVIO
 *
pvio
ð
ùls
->pvio;

633 (
rc
ð
	`SSL_wr™e
((
SSL
 *)
ùls
->
s¦
, (*)
bufãr
, ()
Ëngth
)) <= 0)

635 
”rÜ
ð
	`SSL_g‘_”rÜ
((
SSL
 *)
ùls
->
s¦
, 
rc
);

636 ià(
”rÜ
 !ð
SSL_ERROR_WANT_WRITE
)

637  
rc
;

638 ià(
pvio
->
m‘hods
->
	`wa™_io_Ü_timeout
Õvio, 
TRUE
,…vio->
mysql
->
ÝtiÚs
.
wr™e_timeout
) < 1)

639  
rc
;

641  
rc
;

642 
	}
}

644 
my_boÞ
 
	$ma_Žs_þo£
(
MARIADB_TLS
 *
ùls
)

646 
i
, 
rc
;

647 
SSL
 *
s¦
;

648 
SSL_CTX
 *
ùx
ð
NULL
;

650 ià(!
ùls
 || !ùls->
s¦
)

652 
s¦
ð(
SSL
 *)
ùls
->ssl;

653 
ùx
ð
	`SSL_g‘_SSL_CTX
(
s¦
);

654 ià(
ùx
)

655 
	`SSL_CTX_ä“
(
ùx
);

657 
	`SSL_£t_qu›t_shutdown
(
s¦
, 1);

659 
i
=0; i < 4; i++)

660 ià((
rc
ð
	`SSL_shutdown
(
s¦
)))

666 
	`SSL_ä“
(
s¦
);

667 
ùls
->
s¦
ð
NULL
;

669  
rc
;

670 
	}
}

672 
	$ma_Žs_v”ify_£rv”_û¹
(
MARIADB_TLS
 *
ùls
)

674 
X509
 *
û¹
;

675 
MYSQL
 *
mysql
;

676 
SSL
 *
s¦
;

677 
MARIADB_PVIO
 *
pvio
;

678 #ià!
	`defšed
(
HAVE_OPENSSL_CHECK_HOST
)

679 
X509_NAME
 *
x509¢
;

680 
ú_pos
;

681 
X509_NAME_ENTRY
 *
ú_’Œy
;

682 
ASN1_STRING
 *
ú_a¢1
;

683 cÚ¡ *
ú_¡r
;

685 ià(!
ùls
 || !ùls->
s¦
)

687 
s¦
ð(
SSL
 *)
ùls
->ssl;

689 
mysql
ð(
MYSQL
 *)
	`SSL_g‘_­p_d©a
(
s¦
);

690 
pvio
ð
mysql
->
Ãt
.pvio;

692 ià(!
mysql
->
ho¡
)

694 
pvio
->
	`£t_”rÜ
(
mysql
, 
CR_SSL_CONNECTION_ERROR
, 
SQLSTATE_UNKNOWN
,

695 
	`ER
(
CR_SSL_CONNECTION_ERROR
), "Invalid (empty) hostname");

699 ià(!(
û¹
ð
	`SSL_g‘_³”_û¹ifiÿ‹
(
s¦
)))

701 
pvio
->
	`£t_”rÜ
(
mysql
, 
CR_SSL_CONNECTION_ERROR
, 
SQLSTATE_UNKNOWN
,

702 
	`ER
(
CR_SSL_CONNECTION_ERROR
), "Unableo get server certificate");

705 #ifdeà
HAVE_OPENSSL_CHECK_HOST


706 ià(
	`X509_check_ho¡
(
û¹
, 
mysql
->
ho¡
, 0, 0, 0) != 1

707 && 
	`X509_check__asc
(
û¹
, 
mysql
->
ho¡
, 0) != 1)

708 
”rÜ
;

710 
x509¢
ð
	`X509_g‘_subjeù_Çme
(
û¹
);

712 ià((
ú_pos
ð
	`X509_NAME_g‘_šdex_by_NID
(
x509¢
, 
NID_commÚName
, -1)) < 0)

713 
”rÜ
;

715 ià(!(
ú_’Œy
ð
	`X509_NAME_g‘_’Œy
(
x509¢
, 
ú_pos
)))

716 
”rÜ
;

718 ià(!(
ú_a¢1
 = 
	`X509_NAME_ENTRY_g‘_d©a
(
ú_’Œy
)))

719 
”rÜ
;

721 
ú_¡r
 = (*)
	`ASN1_STRING_d©a
(
ú_a¢1
);

724 ià((
size_t
)
	`ASN1_STRING_Ëngth
(
ú_a¢1
è!ð
	`¡¾’
(
ú_¡r
))

725 
”rÜ
;

727 ià(
	`¡rcmp
(
ú_¡r
, 
mysql
->
ho¡
))

728 
”rÜ
;

730 
	`X509_ä“
(
û¹
);

733 
”rÜ
:

734 
	`X509_ä“
(
û¹
);

736 
pvio
->
	`£t_”rÜ
(
mysql
, 
CR_SSL_CONNECTION_ERROR
, 
SQLSTATE_UNKNOWN
,

737 
	`ER
(
CR_SSL_CONNECTION_ERROR
), "Validation of SSL server certificate failed");

739 
	}
}

741 cÚ¡ *
	$ma_Žs_g‘_ch”
(
MARIADB_TLS
 *
ùls
)

743 ià(!
ùls
 || !ùls->
s¦
)

744  
NULL
;

745  
	`SSL_g‘_ch”_Çme
(
ùls
->
s¦
);

746 
	}
}

748 
	$ma_Žs_g‘_fšg”_´št
(
MARIADB_TLS
 *
ùls
, *
å
, 
Ën
)

750 
X509
 *
û¹
ð
NULL
;

751 
MYSQL
 *
mysql
;

752 
å_Ën
;

754 ià(!
ùls
 || !ùls->
s¦
)

757 
mysql
ð
	`SSL_g‘_­p_d©a
(
ùls
->
s¦
);

759 ià(!(
û¹
ð
	`SSL_g‘_³”_û¹ifiÿ‹
(
ùls
->
s¦
)))

761 
	`my_£t_”rÜ
(
mysql
, 
CR_SSL_CONNECTION_ERROR
, 
SQLSTATE_UNKNOWN
,

762 
	`ER
(
CR_SSL_CONNECTION_ERROR
),

764 
’d
;

767 ià(
Ën
 < 
EVP_MAX_MD_SIZE
)

769 
	`my_£t_”rÜ
(
mysql
, 
CR_SSL_CONNECTION_ERROR
, 
SQLSTATE_UNKNOWN
,

770 
	`ER
(
CR_SSL_CONNECTION_ERROR
),

772 
’d
;

774 ià(!
	`X509_dige¡
(
û¹
, 
	`EVP_sha1
(), (*)
å
, &
å_Ën
))

776 
	`my_£t_”rÜ
(
mysql
, 
CR_SSL_CONNECTION_ERROR
, 
SQLSTATE_UNKNOWN
,

777 
	`ER
(
CR_SSL_CONNECTION_ERROR
),

779 
’d
;

782 
	`X509_ä“
(
û¹
);

783  (
å_Ën
);

784 
’d
:

785 
	`X509_ä“
(
û¹
);

787 
	}
}

790 
	$ma_Žs_g‘_´ÙocÞ_v”siÚ
(
MARIADB_TLS
 *
ùls
)

792 ià(!
ùls
 || !ùls->
s¦
)

795  
	`SSL_v”siÚ
(
ùls
->
s¦
) & 0xFF;

796 
	}
}

	@libmariadb/secure/openssl_crypt.c

19 
	~<ma_glob®.h
>

20 
	~<ma_üy±.h
>

21 
	~<Ý’s¦/evp.h
>

23 cÚ¡ 
EVP_MD
 *
	$ma_hash_g‘_®gÜ™hm
(
®g
)

25 
®g
)

27 
MA_HASH_MD5
:

28  
	`EVP_md5
();

29 
MA_HASH_SHA1
:

30  
	`EVP_sha1
();

31 
MA_HASH_SHA224
:

32  
	`EVP_sha224
();

33 
MA_HASH_SHA256
:

34  
	`EVP_sha256
();

35 
MA_HASH_SHA384
:

36  
	`EVP_sha384
();

37 
MA_HASH_SHA512
:

38  
	`EVP_sha512
();

39 
MA_HASH_RIPEMD160
:

40  
	`EVP_remd160
();

42  
NULL
;

44 
	}
}

46 
MA_HASH_CTX
 *
ma_hash_Ãw
(
®gÜ™hm
, MA_HASH_CTX *
unu£d
 
__©Œibu‹__
((unused)))

48 
EVP_MD_CTX
 *
	gùx
ð
NULL
;

49 cÚ¡ 
EVP_MD
 *
	gevp_md
ð
ma_hash_g‘_®gÜ™hm
(
®gÜ™hm
);

52 ià(!
	gevp_md
)

53  
	gNULL
;

54 #ià
OPENSSL_VERSION_NUMBER
 >= 0x10100000L

55 ià(!(
	gùx
ð
EVP_MD_CTX_Ãw
()))

57 ià(!(
ùx
ð
EVP_MD_CTX_ü—‹
()))

59  
NULL
;

60 ià(!
EVP_Dige¡In™
(
ùx
, 
evp_md
))

62 
ma_hash_ä“
(
ùx
);

63  
	gNULL
;

65  
	gùx
;

68 
	$ma_hash_ä“
(
MA_HASH_CTX
 *
ùx
)

70 ià(
ùx
)

71 #ià
OPENSSL_VERSION_NUMBER
 >= 0x10100000L

72 
	`EVP_MD_CTX_ä“
(
ùx
);

74 
	`EVP_MD_CTX_de¡roy
(
ùx
);

76 
	}
}

78 
	$ma_hash_šput
(
MA_HASH_CTX
 *
ùx
,

79 cÚ¡ *
bufãr
,

80 
size_t
 
Ën
)

82 
	`EVP_Dige¡Upd©e
(
ùx
, 
bufãr
, 
Ën
);

83 
	}
}

85 
	$ma_hash_»suÉ
(
MA_HASH_CTX
 *
ùx
, *
dige¡
)

87 
	`EVP_Dige¡Fš®_ex
(
ùx
, 
dige¡
, 
NULL
);

88 
	}
}

	@libmariadb/secure/schannel.c

20 
	~"ma_schªÃl.h
"

21 
	~"schªÃl_û¹s.h
"

22 
	~<¡ršg.h
>

24 
my_boÞ
 
ma_Žs_š™Ÿlized
;

25 
	gŽs_lib¿ry_v”siÚ
[] = "Schannel";

27 
	#PROT_SSL3
 1

	)

28 
	#PROT_TLS1_0
 2

	)

29 
	#PROT_TLS1_2
 4

	)

30 
	#PROT_TLS1_3
 8

	)

34 
DWORD
 
	mch”_id
;

35 
DWORD
 
	m´ÙocÞ
;

36 cÚ¡ *
	mŸÇ_Çme
;

37 cÚ¡ *
	mÝ’s¦_Çme
;

38 
ALG_ID
 
	m®gs
[4];

40 
	gch”_m­
[] =

44 
PROT_TLS1_0
 | 
PROT_TLS1_2
 | 
PROT_SSL3
,

46 { 
CALG_RSA_KEYX
, 0, 
CALG_SHA1
, 
CALG_RSA_SIGN
 }

50 
PROT_TLS1_0
 | 
PROT_TLS1_2
 | 
PROT_SSL3
,

52 { 
CALG_RSA_KEYX
, 
CALG_RC4
, 
CALG_MD5
, 
CALG_RSA_SIGN
 }

56 
PROT_TLS1_0
 | 
PROT_TLS1_2
 | 
PROT_SSL3
,

58 { 
CALG_RSA_KEYX
, 
CALG_RC4
, 
CALG_SHA1
, 
CALG_RSA_SIGN
 }

62 
PROT_SSL3
,

64 {
CALG_RSA_KEYX
, 
CALG_3DES
, 
CALG_SHA1
, 
CALG_DSS_SIGN
}

68 
PROT_TLS1_0
 | 
PROT_TLS1_2
 | 
PROT_SSL3
,

70 { 
CALG_DH_EPHEM
, 
CALG_3DES
, 
CALG_SHA1
, 
CALG_DSS_SIGN
 }

74 
PROT_SSL3
 | 
PROT_TLS1_0
 | 
PROT_TLS1_2
,

76 { 
CALG_RSA_KEYX
, 
CALG_AES_128
, 
CALG_SHA
, 
CALG_RSA_SIGN
}

80 
PROT_TLS1_0
 | 
PROT_TLS1_2
,

82 { 
CALG_DH_EPHEM
, 
CALG_AES_128
, 
CALG_SHA1
, 
CALG_RSA_SIGN
 }

86 
PROT_TLS1_0
 | 
PROT_TLS1_2
,

88 { 
CALG_DH_EPHEM
, 
CALG_AES_128
, 
CALG_SHA1
, 
CALG_RSA_SIGN
 }

92 
PROT_TLS1_0
 | 
PROT_TLS1_2
,

94 { 
CALG_RSA_KEYX
, 
CALG_AES_256
, 
CALG_SHA1
, 
CALG_RSA_SIGN
 }

98 
PROT_TLS1_0
 | 
PROT_TLS1_2
,

100 { 
CALG_DH_EPHEM
, 
CALG_AES_256
, 
CALG_SHA1
, 
CALG_DSS_SIGN
 }

104 
PROT_TLS1_0
 | 
PROT_TLS1_2
,

106 { 
CALG_DH_EPHEM
, 
CALG_AES_256
, 
CALG_SHA1
, 
CALG_RSA_SIGN
 }

110 
PROT_TLS1_2
,

112 { 
CALG_RSA_KEYX
, 0, 
CALG_SHA_256
, 
CALG_RSA_SIGN
 }

116 
PROT_TLS1_2
,

118 { 
CALG_RSA_KEYX
, 
CALG_AES_128
, 
CALG_SHA_256
, 
CALG_RSA_SIGN
 }

122 
PROT_TLS1_2
,

124 { 
CALG_RSA_KEYX
, 
CALG_AES_256
, 
CALG_SHA_256
, 
CALG_RSA_SIGN
 }

128 
PROT_TLS1_2
,

130 { 
CALG_DH_EPHEM
, 
CALG_AES_128
, 
CALG_SHA_256
, 
CALG_DSS_SIGN
 }

134 
PROT_TLS1_2
,

136 { 
CALG_RSA_KEYX
, 
CALG_AES_128
, 
CALG_SHA_256
, 
CALG_RSA_SIGN
 }

140 
PROT_TLS1_2
,

142 { 
CALG_RSA_KEYX
, 
CALG_AES_256
, 
CALG_SHA_384
, 
CALG_RSA_SIGN
 }

146 
PROT_TLS1_2
,

148 { 
CALG_DH_EPHEM
, 
CALG_AES_128
, 
CALG_SHA_256
, 
CALG_RSA_SIGN
 }

152 
PROT_TLS1_2
,

154 { 
CALG_DH_EPHEM
, 
CALG_AES_256
, 
CALG_SHA_384
, 
CALG_RSA_SIGN
 }

158 
	#MAX_ALG_ID
 50

	)

160 
ma_schªÃl_£t_£c_”rÜ
(
MARIADB_PVIO
 *
pvio
, 
DWORD
 
E¼ÜNo
);

173 
	$ma_Žs_¡¬t
(*
”rmsg
, 
size_t
 
”rmsg_Ën
)

175 
ma_Žs_š™Ÿlized
 = 
TRUE
;

177 
	}
}

191 
	$ma_Žs_’d
()

194 
	}
}

197 
	$ma_Žs_£t_þ›Á_û¹s
(
MARIADB_TLS
 *
ùls
,cÚ¡ 
CERT_CONTEXT
 **
û¹_ùx
)

199 
MYSQL
 *
mysql
ð
ùls
->
pvio
->mysql;

200 *
û¹fže
ð
mysql
->
ÝtiÚs
.
s¦_û¹
,

201 *
keyfže
ð
mysql
->
ÝtiÚs
.
s¦_key
;

202 
MARIADB_PVIO
 *
pvio
ð
ùls
->pvio;

203 
”rmsg
[256];

205 ià(!
û¹fže
 && 
keyfže
)

206 
û¹fže
ð
keyfže
;

207 ià(!
keyfže
 && 
û¹fže
)

208 
keyfže
ð
û¹fže
;

210 ià(!
û¹fže
)

213 *
û¹_ùx
 = 
	`schªÃl_ü—‹_û¹_cÚ‹xt
(
û¹fže
, 
keyfže
, 
”rmsg
, (errmsg));

214 ià(!*
û¹_ùx
)

216 
pvio
->
	`£t_”rÜ
Õvio->
mysql
, 
CR_SSL_CONNECTION_ERROR
, 
SQLSTATE_UNKNOWN
, "SSL cÚÃùiÚƒ¼Ü: %s", 
”rmsg
);

221 
	}
}

225 *
	$ma_Žs_š™
(
MYSQL
 *
mysql
)

227 
SC_CTX
 *
sùx
 = (SC_CTX *)
	`LoÿlAÎoc
(
LMEM_ZEROINIT
, (SC_CTX));

228 ià(
sùx
)

230 
	`SecInv®id©eHªdË
(&
sùx
->
C»dHdl
);

231 
	`SecInv®id©eHªdË
(&
sùx
->
hCtxt
);

233  
sùx
;

234 
	}
}

249 
	s_Žs_v”siÚ
 {

250 cÚ¡ *
	mŽs_v”siÚ
;

251 
DWORD
 
	m´ÙocÞ
;

252 } 
	gŽs_v”siÚ
[]= {

253 {"TLSv1.0", 
PROT_TLS1_0
},

254 {"TLSv1.2", 
PROT_TLS1_2
},

255 {"TLSv1.3", 
PROT_TLS1_3
},

256 {"SSLv3", 
PROT_SSL3
}

259 
size_t
 
	$£t_ch”
(* 
ch”_¡r
, 
DWORD
 
´ÙocÞ
, 
ALG_ID
 *
¬r
 , 
size_t
 
¬r_size
)

261 *
tok’
 = 
	`¡¹ok
(
ch”_¡r
, ":");

262 
size_t
 
pos
 = 0;

264 
tok’
)

266 
size_t
 
i
;

268 
i
 = 0; i < (
ch”_m­
)/(cipher_map[0]) ; i++)

270 if((
pos
 + 4 < 
¬r_size
 && 
	`¡rcmp
(
ch”_m­
[
i
].
Ý’s¦_Çme
, 
tok’
) == 0) ||

271 (
ch”_m­
[
i
].
´ÙocÞ
 <=…rotocol))

273 
	`memýy
(
¬r
 + 
pos
, 
ch”_m­
[
i
].
®gs
, (
ALG_ID
)* 4);

274 
pos
 += 4;

278 
tok’
 = 
	`¡¹ok
(
NULL
, ":");

280  
pos
;

281 
	}
}

283 
my_boÞ
 
	$ma_Žs_cÚÃù
(
MARIADB_TLS
 *
ùls
)

285 
MYSQL
 *
mysql
;

286 
SCHANNEL_CRED
 
C»d
 = {0};

287 
MARIADB_PVIO
 *
pvio
;

288 
my_boÞ
 
rc
= 1;

289 
SC_CTX
 *
sùx
;

290 
SECURITY_STATUS
 
sR‘
;

291 
ALG_ID
 
AlgId
[
MAX_ALG_ID
];

292 
size_t
 
i
;

293 
DWORD
 
´ÙocÞ
 = 0;

294 
v”ify_û¹s
;

295 cÚ¡ 
CERT_CONTEXT
* 
û¹_cÚ‹xt
 = 
NULL
;

297 ià(!
ùls
)

300 
pvio
ð
ùls
->pvio;

301 
sùx
ð(
SC_CTX
 *)
ùls
->
s¦
;

302 ià(!
pvio
 || !
sùx
)

305 
mysql
ð
pvio
->mysql;

306 ià(!
mysql
)

310 ià(
mysql
->
ÝtiÚs
.
s¦_ch”
)

317 
i
 = 0; i < (
Žs_v”siÚ
) / (tls_version[0]); i++)

319 ià(!
	`_¡ricmp
(
mysql
->
ÝtiÚs
.
s¦_ch”
, 
Žs_v”siÚ
[
i
].tls_version))

320 
´ÙocÞ
 |ð
Žs_v”siÚ
[
i
].protocol;

322 
	`mem£t
(
AlgId
, 0, (AlgId));

323 
C»d
.
cSuµÜ‹dAlgs
 = (
DWORD
)
	`£t_ch”
(
mysql
->
ÝtiÚs
.
s¦_ch”
, 
´ÙocÞ
, 
AlgId
, 
MAX_ALG_ID
);

324 ià(
C»d
.
cSuµÜ‹dAlgs
)

326 
C»d
.
·lgSuµÜ‹dAlgs
 = 
AlgId
;

328 ià(!
´ÙocÞ
)

330 
	`ma_schªÃl_£t_£c_”rÜ
(
pvio
, 
SEC_E_ALGORITHM_MISMATCH
);

331 
’d
;

335 
C»d
.
dwV”siÚ
ð
SCHANNEL_CRED_VERSION
;

337 
C»d
.
dwFÏgs
 = 
SCH_CRED_NO_SERVERNAME_CHECK
 | 
SCH_CRED_NO_DEFAULT_CREDS
 | 
SCH_CRED_MANUAL_CRED_VALIDATION
;

339 ià(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
 && mysql->ÝtiÚs.ex‹nsiÚ->
Žs_v”siÚ
)

341 ià(
	`¡r¡r
(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
Žs_v”siÚ
, "TLSv1.0"))

342 
C»d
.
grb™EÇbËdPrÙocÞs
|ð
SP_PROT_TLS1_0_CLIENT
;

343 ià(
	`¡r¡r
(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
Žs_v”siÚ
, "TLSv1.1"))

344 
C»d
.
grb™EÇbËdPrÙocÞs
|ð
SP_PROT_TLS1_1_CLIENT
;

345 ià(
	`¡r¡r
(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
Žs_v”siÚ
, "TLSv1.2"))

346 
C»d
.
grb™EÇbËdPrÙocÞs
|ð
SP_PROT_TLS1_2_CLIENT
;

348 ià(!
C»d
.
grb™EÇbËdPrÙocÞs
)

349 
C»d
.
grb™EÇbËdPrÙocÞs
 = 
SP_PROT_TLS1_0_CLIENT
 | 
SP_PROT_TLS1_1_CLIENT
 | 
SP_PROT_TLS1_2_CLIENT
;

352 ià(
	`ma_Žs_£t_þ›Á_û¹s
(
ùls
, &
û¹_cÚ‹xt
))

353 
’d
;

355 ià(
û¹_cÚ‹xt
)

357 
C»d
.
cC»ds
 = 1;

358 
C»d
.
·C»d
 = &
û¹_cÚ‹xt
;

360 
sR‘
ð
	`AcquœeC»d’tŸlsHªdËA
(
NULL
, 
UNISP_NAME_A
, 
SECPKG_CRED_OUTBOUND
,

361 
NULL
, &
C»d
, NULL, NULL, &
sùx
->
C»dHdl
, NULL);

362 ià(
sR‘
)

364 
	`ma_schªÃl_£t_£c_”rÜ
(
pvio
, 
sR‘
);

365 
’d
;

367 ià(
	`ma_schªÃl_þ›Á_hªdshake
(
ùls
è!ð
SEC_E_OK
)

368 
’d
;

370 
v”ify_û¹s
 = 
mysql
->
ÝtiÚs
.
s¦_ÿ
 || mysql->ÝtiÚs.
s¦_ÿ·th
 ||

371 (
mysql
->
þ›Á_æag
 & 
CLIENT_SSL_VERIFY_SERVER_CERT
);

373 ià(
v”ify_û¹s
)

375 ià(!
	`ma_schªÃl_v”ify_û¹s
(
ùls
, (
mysql
->
þ›Á_æag
 & 
CLIENT_SSL_VERIFY_SERVER_CERT
)))

376 
’d
;

379 
rc
 = 0;

381 
’d
:

382 ià(
û¹_cÚ‹xt
)

383 
	`schªÃl_ä“_û¹_cÚ‹xt
(
û¹_cÚ‹xt
);

384  
rc
;

385 
	}
}

387 
ssize_t
 
	$ma_Žs_»ad
(
MARIADB_TLS
 *
ùls
, cÚ¡ 
uch¬
* 
bufãr
, 
size_t
 
Ëngth
)

389 
SC_CTX
 *
sùx
ð(SC_CTX *)
ùls
->
s¦
;

390 
MARIADB_PVIO
 *
pvio
ð
ùls
->pvio;

391 
DWORD
 
dËngth
= 0;

392 
SECURITY_STATUS
 
¡©us
 = 
	`ma_schªÃl_»ad_deüy±
(
pvio
, &
sùx
->
hCtxt
, &
dËngth
, (
uch¬
 *)
bufãr
, (
DWORD
)
Ëngth
);

393 ià(
¡©us
 =ð
SEC_I_CONTEXT_EXPIRED
)

395 ià(
¡©us
 =ð
SEC_I_RENEGOTIATE
)

398  (
¡©us
 =ð
SEC_E_OK
)? (
ssize_t
)
dËngth
 : -1;

399 
	}
}

401 
ssize_t
 
	$ma_Žs_wr™e
(
MARIADB_TLS
 *
ùls
, cÚ¡ 
uch¬
* 
bufãr
, 
size_t
 
Ëngth
)

403 
MARIADB_PVIO
 *
pvio
ð
ùls
->pvio;

404 
ssize_t
 
rc
, 
wËngth
= 0;

405 
ssize_t
 
»maš
ð
Ëngth
;

407 
»maš
 > 0)

409 ià((
rc
ð
	`ma_schªÃl_wr™e_’üy±
(
pvio
, (
uch¬
 *)
bufãr
 + 
wËngth
, 
»maš
)) <= 0)

410  
rc
;

411 
wËngth
+ð
rc
;

412 
»maš
-ð
rc
;

414  
Ëngth
;

415 
	}
}

418 
my_boÞ
 
	$ma_Žs_þo£
(
MARIADB_TLS
 *
ùls
)

420 
SC_CTX
 *
sùx
ð(SC_CTX *)
ùls
->
s¦
;

422 ià(
sùx
)

424 
	`LoÿlF»e
(
sùx
->
IoBufãr
);

426 ià(
	`SecIsV®idHªdË
(&
sùx
->
C»dHdl
))

427 
	`F»eC»d’tŸlHªdË
(&
sùx
->
C»dHdl
);

429 ià(
	`SecIsV®idHªdË
(&
sùx
->
hCtxt
))

430 
	`D–‘eSecur™yCÚ‹xt
(&
sùx
->
hCtxt
);

432 
	`LoÿlF»e
(
sùx
);

434 
	}
}

437 
	$ma_Žs_v”ify_£rv”_û¹
(
MARIADB_TLS
 *
ùls
)

441 
	}
}

443 cÚ¡ *
	$ch”_Çme
(cÚ¡ 
SecPkgCÚ‹xt_Ch”Info
 *
Ch”Info
)

445 
size_t
 
i
;

447 
i
 = 0; i < (
ch”_m­
)/(cipher_map[0]) ; i++)

449 ià(
Ch”Info
->
dwCh”Su™e
 =ð
ch”_m­
[
i
].
ch”_id
)

450  
ch”_m­
[
i
].
Ý’s¦_Çme
;

453 
	}
};

455 cÚ¡ *
	$ma_Žs_g‘_ch”
(
MARIADB_TLS
 *
ùls
)

457 
SecPkgCÚ‹xt_Ch”Info
 
Ch”Info
 = { 
SECPKGCONTEXT_CIPHERINFO_V1
 };

458 
SECURITY_STATUS
 
sR‘
;

459 
SC_CTX
 *
sùx
;

461 ià(!
ùls
 || !ùls->
s¦
)

462  
NULL
;

464 
sùx
ð(
SC_CTX
 *)
ùls
->
s¦
;

465 
sR‘
ð
	`Qu”yCÚ‹xtA‰ribu‹sA
(&
sùx
->
hCtxt
, 
SECPKG_ATTR_CIPHER_INFO
, (
PVOID
)&
Ch”Info
);

467 ià(
sR‘
 !ð
SEC_E_OK
)

468  
NULL
;

470  
	`ch”_Çme
(&
Ch”Info
);

471 
	}
}

473 
	$ma_Žs_g‘_fšg”_´št
(
MARIADB_TLS
 *
ùls
, *
å
, 
Ën
)

475 
SC_CTX
 *
sùx
ð(SC_CTX *)
ùls
->
s¦
;

476 
PCCERT_CONTEXT
 
pRemÙeC”tCÚ‹xt
 = 
NULL
;

477 ià(
	`Qu”yCÚ‹xtA‰ribu‹s
(&
sùx
->
hCtxt
, 
SECPKG_ATTR_REMOTE_CERT_CONTEXT
, (
PVOID
)&
pRemÙeC”tCÚ‹xt
è!ð
SEC_E_OK
)

479 
	`C”tG‘C”tifiÿ‹CÚ‹xtPrÝ”ty
(
pRemÙeC”tCÚ‹xt
, 
CERT_HASH_PROP_ID
, 
å
, (
DWORD
 *)&
Ën
);

480 
	`C”tF»eC”tifiÿ‹CÚ‹xt
(
pRemÙeC”tCÚ‹xt
);

481  
Ën
;

482 
	}
}

	@libmariadb/secure/schannel_certs.c

31 #ifdeà
_WIN32_WINNT


32 #undeà
_WIN32_WINNT


33 
	#_WIN32_WINNT
 0x0601

	)

36 
	~"schªÃl_û¹s.h
"

37 
	~<m®loc.h
>

38 
	~<¡dio.h
>

39 
	~<¡ršg.h
>

40 
	~<wšsock2.h
>

41 
	~<ws2tý.h
>

42 
	~<wšh‰p.h
>

43 
	~<as£¹.h
>

44 
	~"wš32_”rmsg.h
"

54 
DWORD
 
	$g‘_Ï¡_”rÜ
()

56 
DWORD
 
»t
 = 
	`G‘La¡E¼Ü
();

57 ià(
»t
)

58  
»t
;

62 
	`as£¹
(0);

63  
ERROR_INTERNAL_ERROR
;

64 
	}
}

66 
	#FAIL
(...) \

68 
¡©us
 = 
	`g‘_Ï¡_”rÜ
();\

69 
	`ma_fÜm©_wš32_”rÜ
(
”rmsg
, 
”rmsg_Ën
, 
¡©us
, 
__VA_ARGS__
);\

70 
þ—nup
;\

71 } 0)

	)

76 * 
	$³m_fže_to_¡ršg
(cÚ¡ * 
fže
, * 
”rmsg
, 
size_t
 
”rmsg_Ën
)

78 
LARGE_INTEGER
 
fže_size
;

79 
size_t
 
fže_bufsize
 = 0;

80 
size_t
 
tÙ®_by‹s_»ad
 = 0;

81 * 
fže_bufãr
 = 
NULL
;

82 
SECURITY_STATUS
 
¡©us
 = 
SEC_E_OK
;

84 
HANDLE
 
fže_hªdË
 = 
	`C»©eFže
(
fže
, 
GENERIC_READ
, 
FILE_SHARE_READ
, 
NULL
,

85 
OPEN_EXISTING
, 
FILE_ATTRIBUTE_NORMAL
, 
NULL
);

86 ià(
fže_hªdË
 =ð
INVALID_HANDLE_VALUE
)

88 
	`FAIL
("çžedØÝ’ fž'%s'", 
fže
);

91 ià(!
	`G‘FžeSizeEx
(
fže_hªdË
, &
fže_size
))

93 
	`FAIL
("G‘FžeSizeEx fažed oÀ'%s'", 
fže
);

96 ià(
fže_size
.
QuadP¬t
 > 
ULONG_MAX
 - 1)

98 
	`S‘La¡E¼Ü
(
SEC_E_INVALID_PARAMETER
);

99 
	`FAIL
("fž'%s'oØÏrge", 
fže
);

102 
fže_bufsize
 = (
size_t
)
fže_size
.
QuadP¬t
;

103 
fže_bufãr
 = (*)
	`LoÿlAÎoc
(0,
fže_bufsize
 + 1);

104 ià(!
fže_bufãr
)

106 
	`FAIL
("LoÿlAÎoc(0,%zuèçžed", 
fže_bufsize
 + 1);

109 
tÙ®_by‹s_»ad
 < 
fže_bufsize
)

111 
DWORD
 
by‹s_to_»ad
 = (DWORD)(
fže_bufsize
 - 
tÙ®_by‹s_»ad
);

112 
DWORD
 
by‹s_»ad
 = 0;

114 ià(!
	`R—dFže
(
fže_hªdË
, 
fže_bufãr
 + 
tÙ®_by‹s_»ad
,

115 
by‹s_to_»ad
, &
by‹s_»ad
, 
NULL
))

117 
	`FAIL
("R—dFže(èçžedØ»ad fž'%s'", 
fže
);

119 ià(
by‹s_»ad
 == 0)

122 
fže_bufsize
 = 
tÙ®_by‹s_»ad
;

126 
tÙ®_by‹s_»ad
 +ð
by‹s_»ad
;

131 
fže_bufãr
[
fže_bufsize
] = '\0';

133 
þ—nup
:

134 ià(
fže_hªdË
 !ð
INVALID_HANDLE_VALUE
)

136 
	`Clo£HªdË
(
fže_hªdË
);

138 ià(
¡©us
)

141 
	`LoÿlF»e
(
fže_bufãr
);

142 
fže_bufãr
 = 
NULL
;

144  
fže_bufãr
;

145 
	}
}

149 
	s_³m_ty³_desc


151 cÚ¡ * 
	mbegš_g
;

152 
size_t
 
	mbegš_g_Ën
;

153 cÚ¡ * 
	m’d_g
;

154 
size_t
 
	m’d_g_Ën
;

155 } 
	t³m_ty³_desc
;

157 
	#BEGIN_TAG
(
x
è"-----BEGIN " x "-----"

	)

158 
	#END_TAG
(
x
è"\n-----END " x "-----"

	)

159 
	#PEM_SECTION
(
g
è{
	`BEGIN_TAG
Ñag), (BEGIN_TAGÑag))-1, 
	`END_TAG
Ñag), (END_TAGÑag))-1}

	)

162 
	mPEM_TYPE_CERTIFICATE
 = 0,

163 
	mPEM_TYPE_X509_CRL
,

164 
	mPEM_TYPE_RSA_PRIVATE_KEY
,

165 
	mPEM_TYPE_PRIVATE_KEY


166 } 
	tPEM_TYPE
;

168 cÚ¡ 
³m_ty³_desc
 
	g³m_£ùiÚs
[] = {

169 
PEM_SECTION
("CERTIFICATE"),

170 
PEM_SECTION
("X509 CRL"),

171 
PEM_SECTION
("RSA PRIVATE KEY"),

172 
PEM_SECTION
("PRIVATE KEY")

185 
	$³m_loÿ‹
(* 
³m_¡r
,

186 
PEM_TYPE
 
ty³
,

187 ** 
begš
,

188 ** 
’d
)

190 *
begš
 = 
NULL
;

191 *
’d
 = 
NULL
;

192 
c
;

194 cÚ¡ 
³m_ty³_desc
* 
desc
 = &
³m_£ùiÚs
[
ty³
];

195 *
begš
 = 
	`¡r¡r
(
³m_¡r
, 
desc
->
begš_g
);

196 ià(!(*
begš
))

201 
c
 = (*
begš
)[
desc
->
begš_g_Ën
];

203 ià(
c
 != '\r' && c != '\n')

205 *
begš
 = 
NULL
;

209 *
’d
 = 
	`¡r¡r
(*
begš
 + 
desc
->
begš_g_Ën
 + 1, desc->
’d_g
);

210 ià(!*
’d
)

213 (*
’d
è+ð
desc
->
’d_g_Ën
;

215 
	}
}

221 
SECURITY_STATUS
 
	$add_û¹s_to_¡Üe
(

222 
HCERTSTORE
 
Œu¡_¡Üe
,

223 cÚ¡ * 
fže
,

224 
PEM_TYPE
 
ty³
,

225 * 
”rmsg
,

226 
size_t
 
”rmsg_Ën
)

228 * 
fže_bufãr
 = 
NULL
;

229 * 
cur
 = 
NULL
;

230 
SECURITY_STATUS
 
¡©us
 = 
SEC_E_OK
;

231 
CRL_CONTEXT
* 
ül_cÚ‹xt
 = 
NULL
;

232 
CERT_CONTEXT
* 
û¹_cÚ‹xt
 = 
NULL
;

233 * 
begš
;

234 * 
’d
;

236 
fže_bufãr
 = 
	`³m_fže_to_¡ršg
(
fže
, 
”rmsg
, 
”rmsg_Ën
);

237 ià(!
fže_bufãr
)

238 
þ—nup
;

240 
cur
 = 
fže_bufãr
; ; cu¸ð
’d
)

242 
	`³m_loÿ‹
(
cur
, 
ty³
, &
begš
, &
’d
);

244 ià(!
begš
)

247 ià(!
’d
)

249 
	`S‘La¡E¼Ü
(
SEC_E_INVALID_PARAMETER
);

250 
	`FAIL
("Invalid PEM file '%s', missingƒnd marker correspondingo begin marker '%s'‡t offset %zu",

251 
fže
, 
³m_£ùiÚs
[
ty³
].
begš_g
, (
size_t
)(
begš
 - 
fže_bufãr
));

253 
CERT_BLOB
 
û¹_blob
;

254 * 
cÚ‹xt
 = 
NULL
;

255 
DWORD
 
aùu®_cÚ‹Á_ty³
 = 0;

257 
û¹_blob
.
pbD©a
 = (
BYTE
*)
begš
;

258 
û¹_blob
.
cbD©a
 = (
DWORD
)(
’d
 - 
begš
);

259 ià(!
	`Cry±Qu”yObjeù
(

260 
CERT_QUERY_OBJECT_BLOB
, &
û¹_blob
,

261 
CERT_QUERY_CONTENT_FLAG_CERT
 | 
CERT_QUERY_CONTENT_FLAG_CRL
,

262 
CERT_QUERY_FORMAT_FLAG_ALL
, 0, 
NULL
, &
aùu®_cÚ‹Á_ty³
,

263 
NULL
, NULL, NULL, (cÚ¡ **)&
cÚ‹xt
))

265 
	`FAIL
("çžedØexŒaù c”tifiÿ‹ from PEM fž'%s'",
fže
);

268 ià(!
cÚ‹xt
)

270 
	`S‘La¡E¼Ü
(
SEC_E_INTERNAL_ERROR
);

271 
	`FAIL
("unexpected„esult from CryptQueryObject(),cert_context is NULL"

273 
fže
);

276 ià(
aùu®_cÚ‹Á_ty³
 =ð
CERT_QUERY_CONTENT_CERT
)

278 
CERT_CONTEXT
* 
û¹_cÚ‹xt
 = (CERT_CONTEXT*)
cÚ‹xt
;

279 ià(!
	`C”tAddC”tifiÿ‹CÚ‹xtToStÜe
(

280 
Œu¡_¡Üe
, 
û¹_cÚ‹xt
,

281 
CERT_STORE_ADD_ALWAYS
, 
NULL
))

283 
	`FAIL
("CertAddCertificateContextToStore failed");

286 ià(
aùu®_cÚ‹Á_ty³
 =ð
CERT_QUERY_CONTENT_CRL
)

288 
CRL_CONTEXT
* 
ül_cÚ‹xt
 = (CRL_CONTEXT*)
cÚ‹xt
;

289 ià(!
	`C”tAddCRLCÚ‹xtToStÜe
(

290 
Œu¡_¡Üe
, 
ül_cÚ‹xt
,

291 
CERT_STORE_ADD_ALWAYS
, 
NULL
))

293 
	`FAIL
("CertAddCRLContextToStore() failed");

297 
þ—nup
:

298 
	`LoÿlF»e
(
fže_bufãr
);

299 ià(
û¹_cÚ‹xt
)

300 
	`C”tF»eC”tifiÿ‹CÚ‹xt
(
û¹_cÚ‹xt
);

301 ià(
ül_cÚ‹xt
)

302 
	`C”tF»eCRLCÚ‹xt
(
ül_cÚ‹xt
);

303  
¡©us
;

304 
	}
}

312 
SECURITY_STATUS
 
	$add_dœ_to_¡Üe
(
HCERTSTORE
 
Œu¡_¡Üe
, cÚ¡ * 
dœ
,

313 
PEM_TYPE
 
ty³
, * 
”rmsg
, 
size_t
 
”rmsg_Ën
)

315 
WIN32_FIND_DATAA
 
ffd
;

316 
·th
[
MAX_PATH
];

317 
·‰”n
[
MAX_PATH
];

318 
DWORD
 
dwA‰r
;

319 
HANDLE
 
hFšd
 = 
INVALID_HANDLE_VALUE
;

320 
SECURITY_STATUS
 
¡©us
 = 
SEC_E_OK
;

322 ià((
dwA‰r
 = 
	`G‘FžeA‰ribu‹s
(
dœ
)è=ð
INVALID_FILE_ATTRIBUTES
)

324 
	`S‘La¡E¼Ü
(
SEC_E_INVALID_PARAMETER
);

325 
	`FAIL
("dœeùÜy '%s' dÛ nÙƒxi¡", 
dœ
);

327 ià(!(
dwA‰r
 & 
FILE_ATTRIBUTE_DIRECTORY
))

329 
	`S‘La¡E¼Ü
(
SEC_E_INVALID_PARAMETER
);

330 
	`FAIL
("'%s' i nÙ‡ dœeùÜy", 
dœ
);

332 
	`¥rštf_s
(
·‰”n
, Õ©‹º), "%s\\*", 
dœ
);

333 
hFšd
 = 
	`FšdFœ¡Fže
(
·‰”n
, &
ffd
);

334 ià(
hFšd
 =ð
INVALID_HANDLE_VALUE
)

336 
	`FAIL
("FšdFœ¡Fže(%sèçžed",
·‰”n
);

340 ià(
ffd
.
dwFžeA‰ribu‹s
 & 
FILE_ATTRIBUTE_DIRECTORY
)

342 
	`¥rštf_s
(
·th
, Õ©h), "%s\\%s", 
dœ
, 
ffd
.
cFžeName
);

346 
	`add_û¹s_to_¡Üe
(
Œu¡_¡Üe
, 
·th
, 
ty³
, 
”rmsg
,

347 
”rmsg_Ën
);

348 } 
	`FšdNextFže
(
hFšd
, &
ffd
) != 0);

350 
þ—nup
:

351 ià(
hFšd
 !ð
INVALID_HANDLE_VALUE
)

352 
	`FšdClo£
(
hFšd
);

354  
¡©us
;

355 
	}
}

358 
	$couÁ_û¹ifiÿ‹s
(
HCERTSTORE
 
¡Üe
)

360 
num_û¹s
 = 0;

361 
PCCERT_CONTEXT
 
c
 = 
NULL
;

363 (
c
 = 
	`C”tEnumC”tifiÿ‹sInStÜe
(
¡Üe
, c)))

364 
num_û¹s
++;

366  
num_û¹s
;

367 
	}
}

382 
SECURITY_STATUS
 
	$schªÃl_ü—‹_¡Üe
(

383 cÚ¡ * 
CAFže
,

384 cÚ¡ * 
CAP©h
,

385 cÚ¡ * 
CRLFže
,

386 cÚ¡ * 
CRLP©h
,

387 
HCERTSTORE
* 
out_¡Üe
,

388 * 
”rmsg
,

389 
size_t
 
”rmsg_Ën
)

392 
HCERTSTORE
 
¡Üe
 = 
NULL
;

393 
HCERTSTORE
 
sy¡em_¡Üe
 = 
NULL
;

394 
¡©us
 = 
SEC_E_OK
;

396 *
out_¡Üe
 = 
NULL
;

397 ià(!
CAFže
 && !
CAP©h
 && !
CRLFže
 && !
CRLP©h
)

400 *
out_¡Üe
 = 
NULL
;

401  
SEC_E_OK
;

403 ià(
CAFže
 || 
CAP©h
)

406 
¡Üe
 = 
	`C”tO³nStÜe
(
CERT_STORE_PROV_MEMORY
, 0, (
HCRYPTPROV
)
NULL
,

407 
CERT_STORE_CREATE_NEW_FLAG
, 
NULL
);

408 ià(!
¡Üe
)

410 
	`FAIL
("CertOpenStore failed for memory store");

413 ià(
CRLFže
 || 
CRLP©h
)

417 
sy¡em_¡Üe
 =

418 
	`C”tO³nStÜe
(
CERT_STORE_PROV_SYSTEM
, 0, (
HCRYPTPROV_LEGACY
)
NULL
,

419 
CERT_SYSTEM_STORE_CURRENT_USER
, 
L
"MY");

420 ià(!
sy¡em_¡Üe
)

422 
	`FAIL
("CertOpenStore failed for system store");

425 
¡Üe
 = 
	`C”tDu¶iÿ‹StÜe
(
sy¡em_¡Üe
);

426 ià(!
¡Üe
)

428 
	`FAIL
("CertDuplicateStore failed");

432 ià(
CAFže
)

434 
¡©us
 = 
	`add_û¹s_to_¡Üe
(
¡Üe
, 
CAFže
,

435 
PEM_TYPE_CERTIFICATE
, 
”rmsg
, 
”rmsg_Ën
);

436 ià(
¡©us
)

437 
þ—nup
;

439 ià(
CAP©h
)

441 
¡©us
 = 
	`add_dœ_to_¡Üe
(
¡Üe
, 
CAP©h
,

442 
PEM_TYPE_CERTIFICATE
, 
”rmsg
, 
”rmsg_Ën
);

443 ià(
¡©us
)

444 
þ—nup
;

447 ià((
CAFže
 || 
CAP©h
è&& 
¡Üe
 && !
	`couÁ_û¹ifiÿ‹s
(store))

449 
	`S‘La¡E¼Ü
(
SEC_E_INVALID_PARAMETER
);

450 
	`FAIL
("no valid certificates were found, CAFile='%s', CAPath='%s'",

451 
CAFže
 ? CAFž: "<nÙ s‘>", 
CAP©h
 ? CAPath : "<not set>");

454 ià(
CRLFže
)

456 
¡©us
 = 
	`add_û¹s_to_¡Üe
(
¡Üe
, 
CRLFže
, 
PEM_TYPE_X509_CRL
,

457 
”rmsg
, 
”rmsg_Ën
);

459 ià(
CRLP©h
)

461 
¡©us
 = 
	`add_dœ_to_¡Üe
(
¡Üe
, 
CRLP©h
, 
PEM_TYPE_X509_CRL
,

462 
”rmsg
, 
”rmsg_Ën
);

465 
þ—nup
:

466 ià(
sy¡em_¡Üe
)

467 
	`C”tClo£StÜe
(
sy¡em_¡Üe
, 0);

468 ià(
¡©us
 && 
¡Üe
)

470 
	`C”tClo£StÜe
(
¡Üe
, 0);

471 
¡Üe
 = 
NULL
;

473 *
out_¡Üe
 = 
¡Üe
;

474  
¡©us
;

475 
	}
}

485 
SECURITY_STATUS
 
	$V”ifyS”v”C”tifiÿ‹
(

486 
PCCERT_CONTEXT
 
pS”v”C”t
,

487 
HCERTSTORE
 
hStÜe
,

488 
LPWSTR
 
pwszS”v”Name
,

489 
DWORD
 
dwRevoÿtiÚCheckFÏgs
,

490 
DWORD
 
dwV”ifyFÏgs
,

491 
LPSTR
 
”rmsg
,

492 
size_t
 
”rmsg_Ën
)

494 
SSL_EXTRA_CERT_CHAIN_POLICY_PARA
 
pÞExŒa
;

495 
CERT_CHAIN_POLICY_PARA
 
PÞicyP¬a
;

496 
CERT_CHAIN_POLICY_STATUS
 
PÞicyStus
;

497 
CERT_CHAIN_PARA
 
ChašP¬a
;

498 
HCERTCHAINENGINE
 
hChašEngše
 = 
NULL
;

499 
PCCERT_CHAIN_CONTEXT
 
pChašCÚ‹xt
 = 
NULL
;

500 
LPSTR
 
rgszU§ges
[] = { 
szOID_PKIX_KP_SERVER_AUTH
,

501 
szOID_SERVER_GATED_CRYPTO
,

502 
szOID_SGC_NETSCAPE
 };

503 
DWORD
 
cU§ges
 = (
rgszU§ges
è/ (
LPSTR
);

504 
SECURITY_STATUS
 
¡©us
 = 
SEC_E_OK
;

506 ià(
pS”v”C”t
 =ð
NULL
)

508 
	`S‘La¡E¼Ü
(
SEC_E_WRONG_PRINCIPAL
);

509 
	`FAIL
("Invalid…arameter…ServerCert…assedo VerifyServerCertificate");

512 
	`Z”oMemÜy
(&
ChašP¬a
, (ChainPara));

513 
ChašP¬a
.
cbSize
 = (ChainPara);

514 
ChašP¬a
.
Reque¡edU§ge
.
dwTy³
 = 
USAGE_MATCH_TYPE_OR
;

515 
ChašP¬a
.
Reque¡edU§ge
.
U§ge
.
cU§geId’tif›r
 = 
cU§ges
;

516 
ChašP¬a
.
Reque¡edU§ge
.
U§ge
.
rgpszU§geId’tif›r
 = 
rgszU§ges
;

518 ià(
hStÜe
)

520 
CERT_CHAIN_ENGINE_CONFIG
 
EngšeCÚfig
 = { 0 };

521 
EngšeCÚfig
.
cbSize
 = (EngineConfig);

522 
EngšeCÚfig
.
hExþusiveRoÙ
 = 
hStÜe
;

523 ià(!
	`C”tC»©eC”tifiÿ‹ChašEngše
(&
EngšeCÚfig
, &
hChašEngše
))

525 
	`FAIL
("CertCreateCertificateChainEngine failed");

529 ià(!
	`C”tG‘C”tifiÿ‹Chaš
(

530 
hChašEngše
,

531 
pS”v”C”t
,

532 
NULL
,

533 
pS”v”C”t
->
hC”tStÜe
,

534 &
ChašP¬a
,

535 
dwRevoÿtiÚCheckFÏgs
,

536 
NULL
,

537 &
pChašCÚ‹xt
))

539 
	`FAIL
("CertGetCertificateChain failed");

540 
þ—nup
;

544 
	`Z”oMemÜy
(&
pÞExŒa
, (
SSL_EXTRA_CERT_CHAIN_POLICY_PARA
));

545 
pÞExŒa
.
cbSŒuù
 = (
SSL_EXTRA_CERT_CHAIN_POLICY_PARA
);

546 
pÞExŒa
.
dwAuthTy³
 = 
AUTHTYPE_SERVER
;

547 
pÞExŒa
.
fdwChecks
 = 
dwV”ifyFÏgs
;

548 
pÞExŒa
.
pwszS”v”Name
 =…wszServerName;

550 
	`mem£t
(&
PÞicyP¬a
, 0, (PolicyPara));

551 
PÞicyP¬a
.
cbSize
 = (PolicyPara);

552 
PÞicyP¬a
.
pvExŒaPÞicyP¬a
 = &
pÞExŒa
;

554 
	`mem£t
(&
PÞicyStus
, 0, (PolicyStatus));

555 
PÞicyStus
.
cbSize
 = (PolicyStatus);

557 ià(!
	`C”tV”ifyC”tifiÿ‹ChašPÞicy
(

558 
CERT_CHAIN_POLICY_SSL
,

559 
pChašCÚ‹xt
,

560 &
PÞicyP¬a
,

561 &
PÞicyStus
))

563 
	`FAIL
("CertVerifyCertificateChainPolicy failed");

566 ià(
PÞicyStus
.
dwE¼Ü
)

568 
	`S‘La¡E¼Ü
(
PÞicyStus
.
dwE¼Ü
);

569 
	`FAIL
("Server certificate validation failed");

572 
þ—nup
:

573 ià(
hChašEngše
)

575 
	`C”tF»eC”tifiÿ‹ChašEngše
(
hChašEngše
);

577 ià(
pChašCÚ‹xt
)

579 
	`C”tF»eC”tifiÿ‹Chaš
(
pChašCÚ‹xt
);

581  
¡©us
;

582 
	}
}

585 
	$schªÃl_ä“_¡Üe
(
HCERTSTORE
 
¡Üe
)

587 ià(
¡Üe
)

588 
	`C”tClo£StÜe
(
¡Üe
, 0);

589 
	}
}

596 
SECURITY_STATUS
 
	$schªÃl_v”ify_£rv”_û¹ifiÿ‹
(

597 cÚ¡ 
CERT_CONTEXT
* 
û¹
,

598 
HCERTSTORE
 
¡Üe
,

599 
BOOL
 
check_»voÿtiÚ
,

600 cÚ¡ * 
£rv”_Çme
,

601 
BOOL
 
check_£rv”_Çme
,

602 * 
”rmsg
,

603 
size_t
 
”rmsg_Ën
)

605 
SECURITY_STATUS
 
¡©us
 = 
SEC_E_OK
;

606 
wch¬_t
* 
w£rv”_Çme
 = 
NULL
;

607 
DWORD
 
dwV”ifyFÏgs
;

608 
DWORD
 
dwRevoÿtiÚFÏgs
;

610 ià(
check_£rv”_Çme
)

612 
cchS”v”Name
 = ()
	`¡¾’
(
£rv”_Çme
) + 1;

613 
w£rv”_Çme
 = (
wch¬_t
*)
	`LoÿlAÎoc
(0,(wch¬_tè* 
cchS”v”Name
);

614 ià(!
w£rv”_Çme
)

616 
	`FAIL
("LocalAlloc() failed");

618 ià(
	`MuÉiBy‹ToWideCh¬
(
CP_UTF8
, 0, 
£rv”_Çme
, 
cchS”v”Name
, 
w£rv”_Çme
, cchServerName) < 0)

620 
	`FAIL
("MultiByteToWideChar() failed");

624 
dwV”ifyFÏgs
 = 0;

625 
dwRevoÿtiÚFÏgs
 = 0;

626 ià(
check_»voÿtiÚ
)

627 
dwRevoÿtiÚFÏgs
 |ð
CERT_CHAIN_REVOCATION_CHECK_CHAIN_EXCLUDE_ROOT
 | 
CERT_CHAIN_REVOCATION_CHECK_CACHE_ONLY
;

628 ià(!
check_£rv”_Çme
)

629 
dwV”ifyFÏgs
 |ð
SECURITY_FLAG_IGNORE_CERT_CN_INVALID
;

631 
¡©us
 = 
	`V”ifyS”v”C”tifiÿ‹
(
û¹
, 
¡Üe
, 
w£rv”_Çme
 ? w£rv”_Çm: 
L
"SERVER_NAME",

632 
dwRevoÿtiÚFÏgs
, 
dwV”ifyFÏgs
, 
”rmsg
, 
”rmsg_Ën
);

634 
þ—nup
:

635 
	`LoÿlF»e
(
w£rv”_Çme
);

636  
¡©us
;

637 
	}
}

641 
SECURITY_STATUS
 
	$lßd_´iv©e_key
(
CERT_CONTEXT
* 
û¹
, * 
´iv©e_key_¡r
, 
size_t
 
Ën
, * 
”rmsg
, size_ˆ
”rmsg_Ën
)

643 
DWORD
 
d”Ën
 = (DWORD)
Ën
;

644 
BYTE
* 
d”buf
 = 
NULL
;

645 
DWORD
 
keyblob_Ën
 = 0;

646 
BYTE
* 
keyblob
 = 
NULL
;

647 
HCRYPTPROV
 
hProv
 = 0;

648 
HCRYPTKEY
 
hKey
 = 0;

649 
CERT_KEY_CONTEXT
 
û¹_key_cÚ‹xt
 = { 0 };

650 
PCRYPT_PRIVATE_KEY_INFO
 
pki
 = 
NULL
;

651 
DWORD
 
pki_Ën
 = 0;

652 
SECURITY_STATUS
 
¡©us
 = 
SEC_E_OK
;

654 
d”buf
 = 
	`LoÿlAÎoc
(0, 
d”Ën
);

655 ià(!
d”buf
)

657 
	`FAIL
("LocalAlloc failed");

660 ià(!
	`Cry±SŒšgToBš¬yA
(
´iv©e_key_¡r
, (
DWORD
)
Ën
, 
CRYPT_STRING_BASE64HEADER
, 
d”buf
, &
d”Ën
, 
NULL
, NULL))

662 
	`FAIL
("Failedo convert BASE64…rivate key");

670 ià(
	`Cry±DecodeObjeùEx
(

671 
X509_ASN_ENCODING
,

672 
PKCS_PRIVATE_KEY_INFO
,

673 
d”buf
, 
d”Ën
,

674 
CRYPT_DECODE_ALLOC_FLAG
,

675 
NULL
, &
pki
, &
pki_Ën
))

678 ià(!
	`Cry±DecodeObjeùEx
(

679 
X509_ASN_ENCODING
 | 
PKCS_7_ASN_ENCODING
,

680 
PKCS_RSA_PRIVATE_KEY
,

681 
pki
->
Priv©eKey
.
pbD©a
,

682 
pki
->
Priv©eKey
.
cbD©a
,

683 
CRYPT_DECODE_ALLOC_FLAG
,

684 
NULL
, &
keyblob
, &
keyblob_Ën
))

686 
	`FAIL
("Failedo…arse…rivate key");

689 ià(!
	`Cry±DecodeObjeùEx
(

690 
X509_ASN_ENCODING
 | 
PKCS_7_ASN_ENCODING
,

691 
PKCS_RSA_PRIVATE_KEY
,

692 
d”buf
, 
d”Ën
,

693 
CRYPT_DECODE_ALLOC_FLAG
, 
NULL
,

694 &
keyblob
, &
keyblob_Ën
))

696 
	`FAIL
("Failedo…arse…rivate key");

699 ià(!
	`Cry±AcquœeCÚ‹xt
(&
hProv
, 
NULL
, 
MS_ENHANCED_PROV
, 
PROV_RSA_FULL
, 
CRYPT_VERIFYCONTEXT
))

701 
	`FAIL
("CryptAcquireContext failed");

704 ià(!
	`Cry±ImpÜtKey
(
hProv
, 
keyblob
, 
keyblob_Ën
, 0, 0, (
HCRYPTKEY
*)&
hKey
))

706 
	`FAIL
("CryptImportKey failed");

708 
û¹_key_cÚ‹xt
.
hCry±Prov
 = 
hProv
;

709 
û¹_key_cÚ‹xt
.
dwKeyS³c
 = 
AT_KEYEXCHANGE
;

710 
û¹_key_cÚ‹xt
.
cbSize
 = (cert_key_context);

713 ià(!
	`C”tS‘C”tifiÿ‹CÚ‹xtPrÝ”ty
(
û¹
, 
CERT_KEY_CONTEXT_PROP_ID
, 0, &
û¹_key_cÚ‹xt
))

715 
	`FAIL
("CertSetCertificateContextProperty failed");

718 
þ—nup
:

719 
	`LoÿlF»e
(
d”buf
);

720 
	`LoÿlF»e
(
keyblob
);

721 
	`LoÿlF»e
(
pki
);

722 ià(
hKey
)

723 
	`Cry±De¡royKey
(
hKey
);

724 ià(
¡©us
)

726 ià(
hProv
)

727 
	`Cry±R–—£CÚ‹xt
(
hProv
, 0);

729  
¡©us
;

730 
	}
}

736 
CERT_CONTEXT
* 
	$ü—‹_þ›Á_û¹ifiÿ‹_mem
(

737 * 
û¹_fže_cÚ‹Á
,

738 * 
key_fže_cÚ‹Á
,

739 * 
”rmsg
,

740 
size_t
 
”rmsg_Ën
)

742 
CERT_CONTEXT
* 
ùx
 = 
NULL
;

743 * 
begš
;

744 * 
’d
;

745 
CERT_BLOB
 
û¹_blob
;

746 
DWORD
 
aùu®_cÚ‹Á_ty³
 = 0;

747 
SECURITY_STATUS
 
¡©us
 = 
SEC_E_OK
;

750 
	`³m_loÿ‹
(
û¹_fže_cÚ‹Á
, 
PEM_TYPE_CERTIFICATE
,

751 &
begš
, &
’d
);

753 ià(!
begš
 || !
’d
)

755 
	`S‘La¡E¼Ü
(
SEC_E_INVALID_PARAMETER
);

756 
	`FAIL
("Client certificate‚ot found in PEM file");

759 
û¹_blob
.
pbD©a
 = (
BYTE
*)
begš
;

760 
û¹_blob
.
cbD©a
 = (
DWORD
)(
’d
 - 
begš
);

761 ià(!
	`Cry±Qu”yObjeù
(

762 
CERT_QUERY_OBJECT_BLOB
, &
û¹_blob
,

763 
CERT_QUERY_CONTENT_FLAG_CERT
,

764 
CERT_QUERY_FORMAT_FLAG_ALL
, 0, 
NULL
, &
aùu®_cÚ‹Á_ty³
,

765 
NULL
, NULL, NULL, (cÚ¡ **)&
ùx
))

767 
	`FAIL
("Can't…arse client certficate");

771 
PEM_TYPE
 
ty³s
[] = { 
PEM_TYPE_RSA_PRIVATE_KEY
, 
PEM_TYPE_PRIVATE_KEY
 };

772 
i
 = 0; i < (
ty³s
) / (types[0]); i++)

774 
	`³m_loÿ‹
(
key_fže_cÚ‹Á
, 
ty³s
[
i
], &
begš
, &
’d
);

775 ià(
begš
 && 
’d
)

778 
¡©us
 = 
	`lßd_´iv©e_key
(
ùx
, 
begš
, (
’d
 - begš), 
”rmsg
, 
”rmsg_Ën
);

779 
þ—nup
;

783 ià(!
begš
 || !
’d
)

785 
	`S‘La¡E¼Ü
(
SEC_E_INVALID_PARAMETER
);

786 
	`FAIL
("Client…rivate key‚ot found in PEM");

789 
þ—nup
:

790 ià(
¡©us
 && 
ùx
)

792 
	`C”tF»eC”tifiÿ‹CÚ‹xt
(
ùx
);

793 
ùx
 = 
NULL
;

795  
ùx
;

796 
	}
}

800 
CERT_CONTEXT
* 
	$schªÃl_ü—‹_û¹_cÚ‹xt
(* 
û¹_fže
, * 
key_fže
, * 
”rmsg
, 
size_t
 
”rmsg_Ën
)

802 
CERT_CONTEXT
* 
ùx
 = 
NULL
;

803 * 
key_fže_cÚ‹Á
 = 
NULL
;

804 * 
û¹_fže_cÚ‹Á
 = 
NULL
;

806 
û¹_fže_cÚ‹Á
 = 
	`³m_fže_to_¡ršg
(
û¹_fže
, 
”rmsg
, 
”rmsg_Ën
);

808 ià(!
û¹_fže_cÚ‹Á
)

809 
þ—nup
;

811 ià(
û¹_fže
 =ð
key_fže
)

813 
key_fže_cÚ‹Á
 = 
û¹_fže_cÚ‹Á
;

817 
key_fže_cÚ‹Á
 = 
	`³m_fže_to_¡ršg
(
key_fže
, 
”rmsg
, 
”rmsg_Ën
);

818 ià(!
key_fže_cÚ‹Á
)

819 
þ—nup
;

822 
ùx
 = 
	`ü—‹_þ›Á_û¹ifiÿ‹_mem
(
û¹_fže_cÚ‹Á
, 
key_fže_cÚ‹Á
, 
”rmsg
, 
”rmsg_Ën
);

824 
þ—nup
:

825 
	`LoÿlF»e
(
û¹_fže_cÚ‹Á
);

826 ià(
û¹_fže
 !ð
key_fže
)

827 
	`LoÿlF»e
(
key_fže_cÚ‹Á
);

829  
ùx
;

830 
	}
}

835 
	$schªÃl_ä“_û¹_cÚ‹xt
(cÚ¡ 
CERT_CONTEXT
* 
û¹
)

838 
CERT_KEY_CONTEXT
 
û¹_key_cÚ‹xt
 = { 0 };

839 
û¹_key_cÚ‹xt
.
cbSize
 = (cert_key_context);

840 
DWORD
 
cbD©a
 = (
CERT_KEY_CONTEXT
);

842 ià(
	`C”tG‘C”tifiÿ‹CÚ‹xtPrÝ”ty
(
û¹
, 
CERT_KEY_CONTEXT_PROP_ID
, &
û¹_key_cÚ‹xt
, &
cbD©a
))

844 
	`Cry±R–—£CÚ‹xt
(
û¹_key_cÚ‹xt
.
hCry±Prov
, 0);

852 
	`as£¹
(0);

854 
	`C”tF»eC”tifiÿ‹CÚ‹xt
(
û¹
);

855 
	}
}

	@libmariadb/secure/schannel_certs.h

21 #´agm¨
Úû


22 
	~<wšdows.h
>

23 
	~<wšüy±.h
>

25 
SECURITY_STATUS
 
schªÃl_ü—‹_¡Üe
(

26 cÚ¡ * 
CAFže
,

27 cÚ¡ * 
CAP©h
,

28 cÚ¡ * 
CRLFže
,

29 cÚ¡ * 
CRLP©h
,

30 
HCERTSTORE
* 
¡Üe
,

31 * 
”rmsg
,

32 
size_t
 
”rmsg_Ën


35 
SECURITY_STATUS
 
schªÃl_v”ify_£rv”_û¹ifiÿ‹
(

36 cÚ¡ 
CERT_CONTEXT
* 
û¹
,

37 
HCERTSTORE
 
¡Üe
,

38 
BOOL
 
check_»voÿtiÚ
,

39 cÚ¡ * 
£rv”_Çme
,

40 
BOOL
 
check_£rv”_Çme
,

41 * 
”rmsg
,

42 
size_t
 
”rmsg_Ën
);

44 
schªÃl_ä“_¡Üe
(
HCERTSTORE
 
¡Üe
);

46 
CERT_CONTEXT
* 
schªÃl_ü—‹_û¹_cÚ‹xt
(

47 * 
û¹_fže
,

48 * 
key_fže
,

49 * 
”rmsg
,

50 
size_t
 
”rmsg_Ën
);

52 
schªÃl_ä“_û¹_cÚ‹xt
(cÚ¡ 
CERT_CONTEXT
* 
û¹
);

	@libmariadb/secure/win_crypt.c

19 
	~<wšdows.h
>

20 
	~<büy±.h
>

21 
	~<ma_üy±.h
>

22 
	~<m®loc.h
>

24 
BCRYPT_ALG_HANDLE
 
	gSha256Prov
= 0;

25 
BCRYPT_ALG_HANDLE
 
	gSha512Prov
= 0;

26 
BCRYPT_ALG_HANDLE
 
	gR§Prov
= 0;

28 
LPCWSTR
 
	$ma_hash_g‘_®gÜ™hm
(
®g
, 
BCRYPT_ALG_HANDLE
 *
®gHdl
)

30 
®g
)

32 
MA_HASH_SHA256
:

33 *
®gHdl
ð
Sha256Prov
;

34  
BCRYPT_SHA256_ALGORITHM
;

35 
MA_HASH_SHA512
:

36 *
®gHdl
ð
Sha512Prov
;

37  
BCRYPT_SHA512_ALGORITHM
;

39 *
®gHdl
= 0;

40  
NULL
;

42 
	}
}

44 
MA_HASH_CTX
 *
	$ma_hash_Ãw
(
®gÜ™hm
, 
MA_HASH_CTX
 *
ùx
)

46 
MA_HASH_CTX
 *
Ãwùx
ð
ùx
;

47 
DWORD
 
cbObjSize
, 
cbD©a
;

48 
LPCWSTR
 
®g
;

49 
BCRYPT_ALG_HANDLE
 
®gHdl
= 0;

51 
®g
ð
	`ma_hash_g‘_®gÜ™hm
(
®gÜ™hm
, &
®gHdl
);

53 ià(!
®g
 || !
®gHdl
)

54  
NULL
;

56 ià(
	`BCry±G‘PrÝ”ty
(
®gHdl
, 
BCRYPT_OBJECT_LENGTH
,

57 (
PBYTE
)&
cbObjSize
, (
DWORD
),

58 &
cbD©a
, 0) < 0)

59 
”rÜ
;

61 ià(!
Ãwùx
)

63 
Ãwùx
ð(
MA_HASH_CTX
 *)
	`ÿÎoc
(1, (MA_HASH_CTX));

64 
Ãwùx
->
ä“_me
= 1;

67 
	`mem£t
(
Ãwùx
, 0, (
MA_HASH_CTX
));

69 
Ãwùx
->
hashObjeù
ð(
PBYTE
)
	`m®loc
(
cbObjSize
);

70 
Ãwùx
->
dige¡_Ën
ð(
DWORD
)
	`ma_hash_dige¡_size
(
®gÜ™hm
);

71 
	`BCry±C»©eHash
(
®gHdl
, &
Ãwùx
->
hHash
,‚ewùx->
hashObjeù
, 
cbObjSize
, 
NULL
, 0, 0);

73  
Ãwùx
;

74 
”rÜ
:

75 ià(
Ãwùx
 && !
ùx
)

76 
	`ä“
(
Ãwùx
);

77  
NULL
;

78 
	}
}

80 
	$ma_hash_ä“
(
MA_HASH_CTX
 *
ùx
)

82 ià(
ùx
)

84 ià(
ùx
->
hHash
)

85 
	`BCry±De¡royHash
(
ùx
->
hHash
);

86 ià(
ùx
->
hashObjeù
)

87 
	`ä“
(
ùx
->
hashObjeù
);

88 ià(
ùx
->
ä“_me
)

89 
	`ä“
(
ùx
);

91 
	}
}

93 
	$ma_hash_šput
(
MA_HASH_CTX
 *
ùx
,

94 cÚ¡ *
bufãr
,

95 
size_t
 
Ën
)

97 
	`BCry±HashD©a
(
ùx
->
hHash
, (
PUCHAR
)
bufãr
, (
LONG
)
Ën
, 0);

98 
	}
}

100 
	$ma_hash_»suÉ
(
MA_HASH_CTX
 *
ùx
, *
dige¡
)

102 
	`BCry±FšishHash
(
ùx
->
hHash
, 
dige¡
, ctx->
dige¡_Ën
, 0);

103 
	}
}

	@libmariadb/win32_errmsg.c

21 
	~<wšdows.h
>

22 
	~<¡dio.h
>

23 
	~<¡dlib.h
>

24 
	~<¡ršg.h
>

35 
	$ma_fÜm©_wš32_”rÜ
(* 
buf
, 
size_t
 
buæ’
, 
DWORD
 
code
, 
_Prštf_fÜm©_¡ršg_
 cÚ¡ * 
fmt
, ...)

37 * 
cur
 = 
buf
;

38 * 
’d
 = 
cur
 + 
buæ’
;

39 *
cur
 = 0;

40 ià(
fmt
)

42 
va_li¡
 
v¬gs
;

43 
	`va_¡¬t
(
v¬gs
, 
fmt
);

44 
cur
 +ð
	`v¢´štf_s
(cur, 
’d
 - cur, 
_TRUNCATE
, 
fmt
, 
v¬gs
);

45 
	`va_’d
(
v¬gs
);

48 ià(
code
 == 0)

51 
	sm­_’Œy


53 
DWORD
 
code
;

54 cÚ¡ * 
sym
;

55 cÚ¡ * 
msg
;

57 
m­
[] =

59 
	#ENTRY
(
x
, 
y
è{x,#x, y}

	)

60 
	`ENTRY
(
SEC_E_WRONG_PRINCIPAL
, "Thearget…rincipal‚ame is incorrect"),

61 
	`ENTRY
(
CERT_E_CN_NO_MATCH
,"The certificate's CN‚ame does‚ot matchhe…assed value"),

62 
	`ENTRY
(
SEC_E_UNTRUSTED_ROOT
,"The certificate chain was issued by‡n‡uthorityhat is‚otrusted"),

63 
	`ENTRY
(
TRUST_E_CERT_SIGNATURE
,"The signature ofhe certificate cannot be verified"),

64 
	`ENTRY
(
SEC_E_CERT_EXPIRED
,"The„eceived certificate hasƒxpired"),

65 
	`ENTRY
(
CERT_E_EXPIRED
,"A„equired certificate is‚ot within its validity…eriod when verifying‡gainsthe current system clock orheimestamp inhe signed file"),

66 
	`ENTRY
(
CRYPT_E_NO_REVOCATION_CHECK
, "The„evocation function was unableo check„evocation forhe certificate"),

67 
	`ENTRY
(
CRYPT_E_REVOCATION_OFFLINE
,"The„evocation function was unableo check„evocation becausehe„evocation server was offline"),

68 
	`ENTRY
(
CRYPT_E_REVOKED
,"The certificate is„evoked"),

69 
	`ENTRY
(
SEC_E_CERT_UNKNOWN
,"An unknownƒrror occurred while…rocessinghe certificate"),

70 
	`ENTRY
(
CERT_E_ROLE
," A certificatehat can only be used‡s‡nƒnd-entity is being used‡s‡ CA or vice versa"),

71 
	`ENTRY
(
CERT_E_WRONG_USAGE
,"The certificate is‚ot valid forhe„equested usage"),

72 
	`ENTRY
(
SEC_E_ILLEGAL_MESSAGE
, "The message„eceived was unexpected or badly formatted"),

73 
	`ENTRY
(
CERT_E_VALIDITYPERIODNESTING
,"The validity…eriods ofhe certification chain do‚ot‚est correctly"),

74 
	`ENTRY
(
CERT_E_PATHLENCONST
,"A…ath†ength constraint inhe certification chain has been violated"),

75 
	`ENTRY
(
CERT_E_CRITICAL
,"A certificate contains‡n unknownƒxtensionhat is marked 'critical'"),

76 
	`ENTRY
(
CERT_E_PURPOSE
,"A certificate being used for‡…urpose otherhanhe ones specified by its CA"),

77 
	`ENTRY
(
CERT_E_ISSUERCHAINING
,"A…arent of‡ given certificate in fact did‚ot issuehat child certificate"),

78 
	`ENTRY
(
CERT_E_MALFORMED
, "A certificate is missing or has‡nƒmpty value for‡n important field, such‡s‡ subject or issuer‚ame"),

79 
	`ENTRY
(
CERT_E_CHAINING
,"A certificate chain could‚ot be builto‡rusted„oot‡uthority"),

80 
	`ENTRY
(
TRUST_E_FAIL
," Genericrust failure"),

81 
	`ENTRY
(
CERT_E_UNTRUSTEDTESTROOT
,"The certification…atherminates withheest„oot which is‚otrusted withhe current…olicy settings"),

82 
	`ENTRY
(
CERT_E_UNTRUSTEDROOT
,"A certificate chain…rocessed, buterminated in‡„oot certificate which is‚otrusted byherust…rovider"),

83 
	`ENTRY
(
CERT_E_REVOCATION_FAILURE
,"The„evocation…rocess could‚ot continue -he certificate(s) could‚ot be checked"),

84 
	`ENTRY
(
SEC_E_ILLEGAL_MESSAGE
, "The message„eceived was unexpected or badly formatted"),

85 
	`ENTRY
(
SEC_E_UNTRUSTED_ROOT
, "Untrusted„oot certificate"),

86 
	`ENTRY
(
SEC_E_BUFFER_TOO_SMALL
, "Bufferoo small"),

87 
	`ENTRY
(
SEC_E_CRYPTO_SYSTEM_INVALID
, "Cipher is‚ot supported"),

88 
	`ENTRY
(
SEC_E_INSUFFICIENT_MEMORY
, "Out of memory"),

89 
	`ENTRY
(
SEC_E_OUT_OF_SEQUENCE
, "Invalid message sequence"),

90 
	`ENTRY
(
SEC_E_DECRYPT_FAILURE
, "The specified data could‚ot be decrypted"),

91 
	`ENTRY
(
SEC_I_INCOMPLETE_CREDENTIALS
, "Incomplete credentials"),

92 
	`ENTRY
(
SEC_E_ENCRYPT_FAILURE
, "The specified data could‚ot beƒncrypted"),

93 
	`ENTRY
(
SEC_I_CONTEXT_EXPIRED
, "The context hasƒxpired‡nd can‚o†onger be used"),

94 
	`ENTRY
(
SEC_E_ALGORITHM_MISMATCH
, "no cipher match"),

95 
	`ENTRY
(
SEC_E_NO_CREDENTIALS
, "no credentials"),

96 
	`ENTRY
(
SEC_E_INVALID_TOKEN
, "Theoken suppliedo function is invalid"),

97 
	`ENTRY
(
SEC_E_UNSUPPORTED_FUNCTION
,"The function„equested is‚ot supported")

100 
m­_’Œy
* 
’Œy
 = 
NULL
;

102 ià(
cur
 > 
buf
 && cur[-1] != ' ' && cur[-1] != '.')

104 
	`¡ºýy_s
(
cur
,
’d
-cur, ". ", 
_TRUNCATE
);

105 
cur
 += 2;

108 
size_t
 
i
 = 0; i < (
m­
) / (map[0]); i++)

110 ià(
code
 =ð
m­
[
i
].code)

112 
’Œy
 = &
m­
[
i
];

116 ià(
cur
 > 
’d
 - 20)

118 ià(
’Œy
)

120 
	`¥rštf_s
(
cur
, 
’d
 - cur, "%s. E¼Ü 0x%08lX(%s)", 
’Œy
->
msg
, 
code
,ƒÁry->
sym
);

124 
cur
 +ð
	`FÜm©Mes§geA
(
FORMAT_MESSAGE_FROM_SYSTEM
 | 
FORMAT_MESSAGE_IGNORE_INSERTS
,

125 
NULL
, 
code
, 
	`MAKELANGID
(
LANG_ENGLISH
, 
SUBLANG_ENGLISH_US
),

126 
cur
, (
DWORD
)(
’d
 - cur), 
NULL
);

127 
cur
 > 
buf
 && (*cur == '\0' || *cur == '\n' || *cur == '\r' || *cur == '.'))

128 
cur
--;

129 ià(*
cur
)

131 
cur
++;

132 *
cur
 = 0;

134 
	`¥rštf_s
(
cur
, 
’d
 - cur, ". E¼Ü %lu/0x%08lX", 
code
, code);

136 
	}
}

	@libmariadb/win32_errmsg.h

1 
	~<wšdows.h
>

2 
ma_fÜm©_wš32_”rÜ
(* 
buf
, 
size_t
 
buæ’
, 
DWORD
 
code
, 
_Prštf_fÜm©_¡ršg_
 cÚ¡ * 
fmt
, ...);

	@plugins/auth/auth_gssapi_client.c

34 
	~<¡ršg.h
>

35 
	~<¡d¬g.h
>

36 
	~<ma_glob®.h
>

37 
	~<mysql.h
>

38 
	~<ma_£rv”_”rÜ.h
>

39 
	~<mysql/þ›Á_¶ugš.h
>

40 
	~<mysql.h
>

41 
	~<¡dio.h
>

42 
	~"commÚ.h
"

44 
auth_þ›Á
(*
´šc®_Çme
,

45 *
mech
,

46 
MYSQL
 *
mysql
,

47 
MYSQL_PLUGIN_VIO
 *
vio
);

49 
	$·r£_£rv”_·ck‘
(*
·ck‘
, 
size_t
 
·ck‘_Ën
, *
¥n
, *
mech
)

51 
size_t
 
¥n_Ën
;

52 
¥n_Ën
 = 
	`¡ºËn
(
·ck‘
, 
·ck‘_Ën
);

53 
	`¡ºýy
(
¥n
, 
·ck‘
, 
PRINCIPAL_NAME_MAX
);

54 ià(
¥n_Ën
 =ð
·ck‘_Ën
 - 1)

57 *
mech
 = 0;

61 
	`¡ºýy
(
mech
, 
·ck‘
 + 
¥n_Ën
 + 1, 
MECH_NAME_MAX
);

63 
	}
}

68 
	$log_þ›Á_”rÜ
(
MYSQL
 *
mysql
, cÚ¡ *
fÜm©
, ...)

70 
NET
 *
Ãt
ð&
mysql
->net;

71 
va_li¡
 
¬gs
;

73 
Ãt
->
Ï¡_”ºo
ð
ER_UNKNOWN_ERROR
;

74 
	`va_¡¬t
(
¬gs
, 
fÜm©
);

75 
	`v¢´štf
(
Ãt
->
Ï¡_”rÜ
, (net->last_error) - 1,

76 
fÜm©
, 
¬gs
);

77 
	`va_’d
(
¬gs
);

78 
	`memýy
(
Ãt
->
sql¡©e
, "HY000", (net->sqlstate));

79 
	}
}

84 
	$gs§pi_auth_þ›Á
(
MYSQL_PLUGIN_VIO
 *
vio
, 
MYSQL
 *
mysql
)

86 
·ck‘_Ën
;

87 *
·ck‘
;

88 
¥n
[
PRINCIPAL_NAME_MAX
 + 1];

89 
mech
[
MECH_NAME_MAX
 + 1];

92 
·ck‘_Ën
ð
vio
->
	`»ad_·ck‘
(vio, &
·ck‘
);

93 ià(
·ck‘_Ën
 < 0)

95  
CR_ERROR
;

97 
	`·r£_£rv”_·ck‘
((*)
·ck‘
, (
size_t
)
·ck‘_Ën
, 
¥n
, 
mech
);

98  
	`auth_þ›Á
(
¥n
, 
mech
, 
mysql
, 
vio
);

99 
	}
}

103 #iâdeà
PLUGIN_DYNAMIC


104 
¡_mysql_þ›Á_¶ugš_AUTHENTICATION
 
	gauth_gs§pi_þ›Á_þ›Á_¶ugš
=

106 
¡_mysql_þ›Á_¶ugš_AUTHENTICATION
 
_mysql_þ›Á_¶ugš_deþ¬©iÚ_
 =

109 
MYSQL_CLIENT_AUTHENTICATION_PLUGIN
,

110 
MYSQL_CLIENT_AUTHENTICATION_PLUGIN_INTERFACE_VERSION
,

116 
NULL
,

117 
NULL
,

118 
NULL
,

119 
NULL
,

120 
gs§pi_auth_þ›Á


	@plugins/auth/caching_sha2_pw.c

19 #iâdeà
_WIN32


20 
	#_GNU_SOURCE
 1

	)

23 #ifdeà
_WIN32


24 
	#HAVE_WINCRYPT


	)

25 #undeà
HAVE_OPENSSL


26 #undeà
HAVE_GNUTLS


29 #ià
defšed
(
HAVE_OPENSSL
è|| defšed(
HAVE_WINCRYPT
è|| defšed(
HAVE_GNUTLS
)

31 
	~<ma_glob®.h
>

32 
	~<mysql.h
>

33 
	~<mysql/þ›Á_¶ugš.h
>

34 
	~<¡ršg.h
>

35 
	~<memÜy.h
>

36 
	~<”rmsg.h
>

37 
	~<ma_glob®.h
>

38 
	~<ma_sys.h
>

39 
	~<ma_commÚ.h
>

41 #iâdeà
WIN32


42 
	~<dlfú.h
>

45 #ià
defšed
(
HAVE_OPENSSL
)

46 
	~<Ý’s¦/r§.h
>

47 
	~<Ý’s¦/³m.h
>

48 
	~<Ý’s¦/”r.h
>

49 #–ià
defšed
(
HAVE_GNUTLS
)

50 
	~<gnuŽs/gnuŽs.h
>

51 #–ià
defšed
(
HAVE_WINCRYPT
)

52 
	~<wšdows.h
>

53 
	~<wšüy±.h
>

54 
	~<büy±.h
>

56 
BCRYPT_ALG_HANDLE
 
R§Prov
;

57 
BCRYPT_ALG_HANDLE
 
Sha256Prov
;

60 
	~<ma_üy±.h
>

62 
	#MAX_PW_LEN
 1024

	)

64 
	#REQUEST_PUBLIC_KEY
 2

	)

65 
	#CACHED_LOGIN_SUCCEEDED
 3

	)

66 
	#RSA_LOGIN_REQUIRED
 4

	)

73 
	$is_cÚÃùiÚ_£cu»
(
MYSQL
 *
mysql
)

75 ià(
mysql
->
ÝtiÚs
.
u£_s¦
 ||

76 
mysql
->
Ãt
.
pvio
->
ty³
 !ð
PVIO_TYPE_SOCKET
)

79 
	}
}

81 
	$ma_sha256_süambË
(*
süambË
, 
size_t
 
süambË_Ën
,

82 *
sourû
, 
size_t
 
sourû_Ën
,

83 *
§É
, 
size_t
 
§É_Ën
)

85 
dige¡1
[
MA_SHA256_HASH_SIZE
],

86 
dige¡2
[
MA_SHA256_HASH_SIZE
],

87 
Ãw_süambË
[
MA_SHA256_HASH_SIZE
];

88 #ifdeà
HAVE_WINCRYPT


89 
MA_HASH_CTX
 
myùx
;

90 
MA_HASH_CTX
 *
ùx
ð&
myùx
;

92 
MA_HASH_CTX
 *
ùx
 = 
NULL
;

94 
size_t
 
i
;

97 ià(!
süambË_Ën
 || !
sourû_Ën
 || !
§É_Ën
)

102 ià(!(
ùx
ð
	`ma_hash_Ãw
(
MA_HASH_SHA256
, ctx)))

104 
	`ma_hash_šput
(
ùx
, 
sourû
, 
sourû_Ën
);

105 
	`ma_hash_»suÉ
(
ùx
, 
dige¡1
);

106 
	`ma_hash_ä“
(
ùx
);

107 #iâdeà
HAVE_WINCRYPT


108 
ùx
 = 
NULL
;

112 ià(!(
ùx
ð
	`ma_hash_Ãw
(
MA_HASH_SHA256
, ctx)))

114 
	`ma_hash_šput
(
ùx
, 
dige¡1
, 
MA_SHA256_HASH_SIZE
);

115 
	`ma_hash_»suÉ
(
ùx
, 
dige¡2
);

116 
	`ma_hash_ä“
(
ùx
);

117 #iâdeà
HAVE_WINCRYPT


118 
ùx
 = 
NULL
;

122 ià(!(
ùx
ð
	`ma_hash_Ãw
(
MA_HASH_SHA256
, ctx)))

124 
	`ma_hash_šput
(
ùx
, 
dige¡2
, 
MA_SHA256_HASH_SIZE
);

125 
	`ma_hash_šput
(
ùx
, 
§É
, 
§É_Ën
);

126 
	`ma_hash_»suÉ
(
ùx
, 
Ãw_süambË
);

127 
	`ma_hash_ä“
(
ùx
);

130 
i
ð0; i < 
süambË_Ën
; i++)

131 
süambË
[
i
]ð
dige¡1
[i] ^ 
Ãw_süambË
[i];

133 
	}
}

136 
auth_ÿchšg_sha2_þ›Á
(
MYSQL_PLUGIN_VIO
 *
vio
, 
MYSQL
 *
mysql
);

137 
auth_ÿchšg_sha2_deš™
();

138 
auth_ÿchšg_sha2_š™
(*
unu£d1
,

139 
size_t
 
unu£d2
,

140 
unu£d3
,

141 
va_li¡
);

144 #iâdeà
PLUGIN_DYNAMIC


145 
¡_mysql_þ›Á_¶ugš_AUTHENTICATION
 
	gÿchšg_sha2_·sswÜd_þ›Á_¶ugš
=

147 
¡_mysql_þ›Á_¶ugš_AUTHENTICATION
 
_mysql_þ›Á_¶ugš_deþ¬©iÚ_
 =

150 
MYSQL_CLIENT_AUTHENTICATION_PLUGIN
,

151 
MYSQL_CLIENT_AUTHENTICATION_PLUGIN_INTERFACE_VERSION
,

157 
NULL
,

158 
auth_ÿchšg_sha2_š™
,

159 
auth_ÿchšg_sha2_deš™
,

160 
NULL
,

161 
auth_ÿchšg_sha2_þ›Á


164 #ifdeà
HAVE_WINCRYPT


165 
LPBYTE
 
	$ma_lßd_³m
(cÚ¡ *
bufãr
, 
DWORD
 *
bufãr_Ën
)

167 
LPBYTE
 
d”_bufãr
ð
NULL
;

168 
DWORD
 
d”_bufãr_Ëngth
= 0;

170 ià(
bufãr_Ën
 =ð
NULL
 || *buffer_len == 0)

171  
NULL
;

173 ià(!
	`Cry±SŒšgToBš¬yA
(
bufãr
, *
bufãr_Ën
, 
CRYPT_STRING_BASE64HEADER
,

174 
NULL
, &
d”_bufãr_Ëngth
, NULL, NULL))

175 
’d
;

177 ià(!(
d”_bufãr
ð(
LPBYTE
)
	`m®loc
(
d”_bufãr_Ëngth
)))

178 
’d
;

180 ià(!
	`Cry±SŒšgToBš¬yA
(
bufãr
, *
bufãr_Ën
, 
CRYPT_STRING_BASE64HEADER
,

181 
d”_bufãr
, &
d”_bufãr_Ëngth
, 
NULL
, NULL))

182 
’d
;

184 *
bufãr_Ën
ð
d”_bufãr_Ëngth
;

186  
d”_bufãr
;

188 
’d
:

189 ià(
d”_bufãr
)

190 
	`ä“
(
d”_bufãr
);

191 *
bufãr_Ën
= 0;

192  
NULL
;

193 
	}
}

196 #iâdeà
HAVE_GNUTLS


197 *
	$lßd_pub_key_fže
(cÚ¡ *
fž’ame
, *
pub_key_size
)

199 
FILE
 *
å
ð
NULL
;

200 *
bufãr
ð
NULL
;

201 
”rÜ
= 1;

203 ià(!
pub_key_size
)

204  
NULL
;

206 ià(!(
å
ð
	`fÝ’
(
fž’ame
, "r")))

207 
’d
;

209 ià(
	`f£ek
(
å
, 0, 
SEEK_END
))

210 
’d
;

212 ià((*
pub_key_size
ð
	`á–l
(
å
)) < 0)

213 
’d
;

215 
	`»wšd
(
å
);

217 ià(!(
bufãr
ð
	`m®loc
(*
pub_key_size
 + 1)))

218 
’d
;

220 ià(
	`ä—d
(
bufãr
, *
pub_key_size
, 1, 
å
è!ð(
size_t
)*pub_key_size)

221 
’d
;

223 
”rÜ
= 0;

225 
’d
:

226 ià(
å
)

227 
	`fþo£
(
å
);

228 ià(
”rÜ
 && 
bufãr
)

230 
	`ä“
(
bufãr
);

231 
bufãr
ð
NULL
;

233  
bufãr
;

234 
	}
}

237 
	$auth_ÿchšg_sha2_þ›Á
(
MYSQL_PLUGIN_VIO
 *
vio
, 
MYSQL
 *
mysql
)

239 *
·ck‘
;

240 
·ck‘_Ëngth
;

241 
rc
ð
CR_ERROR
;

242 #ià!
	`defšed
(
HAVE_GNUTLS
)

243 
·sswd
[
MAX_PW_LEN
];

244 
r§_’c_pw
[
MAX_PW_LEN
];

245 #ifdeà
HAVE_OPENSSL


246 
r§_size
;

248 
ULONG
 
r§_size
;

250 
pwËn
, 
i
;

251 *
fžebufãr
ð
NULL
;

253 
buf
[
MA_SHA256_HASH_SIZE
];

255 #ià
	`defšed
(
HAVE_OPENSSL
)

256 
RSA
 *
pubkey
ð
NULL
;

257 
BIO
 *
bio
;

258 #–ià
	`defšed
(
HAVE_WINCRYPT
)

259 
BCRYPT_KEY_HANDLE
 
pubkey
= 0;

260 
BCRYPT_OAEP_PADDING_INFO
 
·ddšgInfo
;

261 
LPBYTE
 
d”_bufãr
ð
NULL
;

262 
DWORD
 
d”_bufãr_Ën
= 0;

263 
CERT_PUBLIC_KEY_INFO
 *
publicKeyInfo
ð
NULL
;

264 
DWORD
 
publicKeyInfoL’
;

268 ià((
·ck‘_Ëngth
ð
vio
->
	`»ad_·ck‘
(vio, &
·ck‘
)) < 0)

269  
CR_ERROR
;

271 ià(
·ck‘_Ëngth
 !ð
SCRAMBLE_LENGTH
 + 1)

272  
CR_SERVER_HANDSHAKE_ERR
;

274 
	`memmove
(
mysql
->
süambË_buff
, 
·ck‘
, 
SCRAMBLE_LENGTH
);

275 
mysql
->
süambË_buff
[
SCRAMBLE_LENGTH
]= 0;

278 ià(!
mysql
->
·sswd
 || !mysql->passwd[0])

280 ià(
vio
->
	`wr™e_·ck‘
(vio, 0, 0))

281  
CR_ERROR
;

282  
CR_OK
;

289 ià(
	`ma_sha256_süambË
(
buf
, 
MA_SHA256_HASH_SIZE
,

290 (*)
mysql
->
·sswd
, 
	`¡¾’
(mysql->passwd),

291 (*)
mysql
->
süambË_buff
, 
SCRAMBLE_LENGTH
))

292  
CR_ERROR
;

294 ià(
vio
->
	`wr™e_·ck‘
(vio, 
buf
, 
MA_SHA256_HASH_SIZE
))

295  
CR_ERROR
;

296 ià((
·ck‘_Ëngth
=
vio
->
	`»ad_·ck‘
(vio, &
·ck‘
)) == -1)

297  
CR_ERROR
;

298 ià(
·ck‘_Ëngth
 == 1)

300 *
·ck‘
) {

301 
CACHED_LOGIN_SUCCEEDED
:

302  
CR_OK
;

303 
RSA_LOGIN_REQUIRED
:

306  
CR_ERROR
;

310 ià(!
	`is_cÚÃùiÚ_£cu»
(
mysql
))

312 #ià
	`defšed
(
HAVE_GNUTLS
)

313 
mysql
->
m‘hods
->
	`£t_”rÜ
(mysql, 
CR_AUTH_PLUGIN_ERR
, "HY000",

315  
CR_ERROR
;

318 ià(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
 &&

319 
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
£rv”_public_key
)

321 
fžebufãr
ð
	`lßd_pub_key_fže
(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
£rv”_public_key
,

322 &
·ck‘_Ëngth
);

327 ià(!
fžebufãr
)

329 
»que¡
ð
REQUEST_PUBLIC_KEY
;

330 ià(
vio
->
	`wr™e_·ck‘
(vio, &
»que¡
, 1) ||

331 (
·ck‘_Ëngth
=
vio
->
	`»ad_·ck‘
(vio, &
·ck‘
)) == -1)

333 
mysql
->
m‘hods
->
	`£t_”rÜ
(mysql, 
CR_AUTH_PLUGIN_ERR
, "HY000", "Couldn't„ead RSA…ublic key from server");

334  
CR_ERROR
;

337 #ià
	`defšed
(
HAVE_OPENSSL
)

338 
bio
ð
	`BIO_Ãw_mem_buf
(
fžebufãr
 ? (*)fžebufã¸: 
·ck‘
,

339 
·ck‘_Ëngth
);

340 ià((
pubkey
ð
	`PEM_»ad_bio_RSA_PUBKEY
(
bio
, 
NULL
, NULL, NULL)))

341 
r§_size
ð
	`RSA_size
(
pubkey
);

342 
	`BIO_ä“
(
bio
);

343 
	`ERR_þ—r_”rÜ
();

344 #–ià
	`defšed
(
HAVE_WINCRYPT
)

345 
d”_bufãr_Ën
ð
·ck‘_Ëngth
;

348 ià(!(
d”_bufãr
ð
	`ma_lßd_³m
(
fžebufãr
 ? fžebufã¸: (*)
·ck‘
, &
d”_bufãr_Ën
)))

349 
”rÜ
;

352 ià(!
	`Cry±DecodeObjeùEx
(
X509_ASN_ENCODING
, 
X509_PUBLIC_KEY_INFO
,

353 
d”_bufãr
, 
d”_bufãr_Ën
,

354 
CRYPT_DECODE_ALLOC_FLAG
, 
NULL
,

355 &
publicKeyInfo
, &
publicKeyInfoL’
))

356 
”rÜ
;

357 
	`ä“
(
d”_bufãr
);

360 ià(!
	`Cry±ImpÜtPublicKeyInfoEx2
(
X509_ASN_ENCODING
, 
publicKeyInfo
,

361 
CRYPT_OID_INFO_PUBKEY_ENCRYPT_KEY_FLAG
,

362 
NULL
, &
pubkey
))

363 
”rÜ
;

366 ià(!
pubkey
)

367  
CR_ERROR
;

369 
pwËn
ð()
	`¡¾’
(
mysql
->
·sswd
) + 1;

370 ià(
pwËn
 > 
MAX_PW_LEN
)

371 
”rÜ
;

372 
	`memýy
(
·sswd
, 
mysql
->·sswd, 
pwËn
);

375 
i
=0; i < 
pwËn
; i++)

376 
·sswd
[
i
]^ð*(
mysql
->
süambË_buff
 + i % 
SCRAMBLE_LENGTH
);

379 #ià
	`defšed
(
HAVE_OPENSSL
)

380 ià(
	`RSA_public_’üy±
(
pwËn
, (*)
·sswd
, 
r§_’c_pw
, 
pubkey
, 
RSA_PKCS1_OAEP_PADDING
) < 0)

381 
”rÜ
;

382 #–ià
	`defšed
(
HAVE_WINCRYPT
)

383 
	`Z”oMemÜy
(&
·ddšgInfo
, (paddingInfo));

384 
·ddšgInfo
.
pszAlgId
 = 
BCRYPT_SHA1_ALGORITHM
;

385 ià((
rc
ð
	`BCry±Enüy±
(
pubkey
, (
PUCHAR
)
·sswd
, 
pwËn
, &
·ddšgInfo
, 
NULL
, 0, 
r§_’c_pw
,

386 
MAX_PW_LEN
, &
r§_size
, 
BCRYPT_PAD_OAEP
)))

387 
”rÜ
;

390 ià(
vio
->
	`wr™e_·ck‘
(vio, 
r§_’c_pw
, 
r§_size
))

391 
”rÜ
;

393 
rc
ð
CR_OK
;

398 ià(
vio
->
	`wr™e_·ck‘
(vio, (*)
mysql
->
·sswd
, ()
	`¡¾’
(mysql->passwd) + 1))

399  
CR_ERROR
;

400  
CR_OK
;

402 #ià!
	`defšed
(
HAVE_GNUTLS
)

403 
”rÜ
:

404 #ià
	`defšed
(
HAVE_OPENSSL
)

405 ià(
pubkey
)

406 
	`RSA_ä“
(
pubkey
);

407 #–ià
	`defšed
(
HAVE_WINCRYPT
)

408 ià(
pubkey
)

409 
	`BCry±De¡royKey
(
pubkey
);

410 ià(
publicKeyInfo
)

411 
	`LoÿlF»e
(
publicKeyInfo
);

413 
	`ä“
(
fžebufãr
);

415  
rc
;

416 
	}
}

439 
auth_ÿchšg_sha2_š™
(*
unu£d1
 
__©Œibu‹__
((
unu£d
)),

440 
size_t
 
unu£d2
 
__©Œibu‹__
((
unu£d
)),

441 
unu£d3
 
__©Œibu‹__
((
unu£d
)),

442 
va_li¡
 
unu£d4
 
__©Œibu‹__
((
unu£d
)))

444 #ià
defšed
(
HAVE_WINCRYPT
)

445 
BCry±O³nAlgÜ™hmProvid”
(&
Sha256Prov
, 
BCRYPT_SHA256_ALGORITHM
, 
NULL
, 0);

446 
BCry±O³nAlgÜ™hmProvid”
(&
R§Prov
, 
BCRYPT_RSA_ALGORITHM
, 
NULL
, 0);

453 
	$auth_ÿchšg_sha2_deš™
()

455 #ià
	`defšed
(
HAVE_WINCRYPT
)

456 
	`BCry±Clo£AlgÜ™hmProvid”
(
Sha256Prov
, 0);

457 
	`BCry±Clo£AlgÜ™hmProvid”
(
R§Prov
, 0);

460 
	}
}

	@plugins/auth/common.h

2 
	#PRINCIPAL_NAME_MAX
 256

	)

4 
	#MECH_NAME_MAX
 30

	)

	@plugins/auth/dialog.c

19 #iâdeà
_WIN32


20 
	#_GNU_SOURCE
 1

	)

23 
	~<ma_glob®.h
>

24 
	~<mysql.h
>

25 
	~<mysql/þ›Á_¶ugš.h
>

26 
	~<¡ršg.h
>

27 
	~<memÜy.h
>

29 #iâdeà
WIN32


30 
	~<dlfú.h
>

35 *
g‘_‰y_·sswÜd
(*
Ýt_mes§ge
, *
buff
, 
bufæ’
);

36 
auth_dŸlog_Ý’
(
MYSQL_PLUGIN_VIO
 *
vio
, 
MYSQL
 *
mysql
);

37 
auth_dŸlog_š™
(*
unu£d1
,

38 
size_t
 
unu£d2
,

39 
unu£d3
,

40 
va_li¡
);

42 
mysql_auth’tiÿtiÚ_dŸlog_ask_t
 
	gauth_dŸlog_func
;

44 #iâdeà
PLUGIN_DYNAMIC


45 
¡_mysql_þ›Á_¶ugš_AUTHENTICATION
 
	gdŸlog_þ›Á_¶ugš
=

47 
¡_mysql_þ›Á_¶ugš_AUTHENTICATION
 
_mysql_þ›Á_¶ugš_deþ¬©iÚ_
 =

50 
MYSQL_CLIENT_AUTHENTICATION_PLUGIN
,

51 
MYSQL_CLIENT_AUTHENTICATION_PLUGIN_INTERFACE_VERSION
,

57 
NULL
,

58 
auth_dŸlog_š™
,

59 
NULL
,

60 
NULL
,

61 
auth_dŸlog_Ý’


82 *
auth_dŸlog_Çtive_´om±
(
MYSQL
 *
mysql
 
__©Œibu‹__
((
unu£d
)),

83 
ty³
,

84 cÚ¡ *
´om±
,

85 *
bufãr
,

86 
bufãr_Ën
)

89 
årštf
(
¡dout
, "%s", 
´om±
);

91 
mem£t
(
bufãr
, 0, 
bufãr_Ën
);

94 ià(
	gty³
 != 2)

96 ià(
fg‘s
(
bufãr
, 
bufãr_Ën
 - 1, 
¡dš
))

99 
size_t
 
Ëngth
ð
¡¾’
(
bufãr
);

100 ià(
	gËngth
 && 
	gbufãr
[
Ëngth
 - 1] == '\n')

101 
bufãr
[
Ëngth
 - 1]= 0;

106 
g‘_‰y_·sswÜd
((*)"", 
bufãr
, 
bufãr_Ën
 - 1);

108  
	gbufãr
;

131 
	$auth_dŸlog_Ý’
(
MYSQL_PLUGIN_VIO
 *
vio
, 
MYSQL
 *
mysql
)

133 
uch¬
 *
·ck‘
;

134 
uch¬
 
ty³
= 0;

135 
dŸlog_bufãr
[1024];

136 *
»¥Ú£
;

137 
·ck‘_Ëngth
;

138 
my_boÞ
 
fœ¡_loÝ
ð
TRUE
;

141 ià((
·ck‘_Ëngth
ð
vio
->
	`»ad_·ck‘
(vio, &
·ck‘
)) == -1)

143  
CR_ERROR
;

145 ià(
·ck‘_Ëngth
 > 0)

147 
ty³
ð*
·ck‘
;

148 
·ck‘
++;

151 ià(!
ty³
 ||ype == 254)

152  
CR_OK_HANDSHAKE_COMPLETE
;

154 ià((
ty³
 >> 1) == 2 &&

155 
fœ¡_loÝ
 &&

156 
mysql
->
·sswd
 && mysql->passwd[0])

157 
»¥Ú£
ð
mysql
->
·sswd
;

159 
»¥Ú£
ð
	`auth_dŸlog_func
(
mysql
, 
ty³
 >> 1,

160 (cÚ¡ *)
·ck‘
,

161 
dŸlog_bufãr
, 1024);

167 
»¥Ú£
ð
mysql
->
·sswd
;

169 ià(!
»¥Ú£
 ||

170 
vio
->
	`wr™e_·ck‘
(vio, (
uch¬
 *)
»¥Ú£
, ()
	`¡¾’
(response) + 1))

171  
CR_ERROR
;

173 
fœ¡_loÝ
ð
FALSE
;

175 } (
ty³
 & 1) != 1);

176  
CR_OK
;

177 
	}
}

200 
auth_dŸlog_š™
(*
unu£d1
 
__©Œibu‹__
((
unu£d
)),

201 
size_t
 
unu£d2
 
__©Œibu‹__
((
unu£d
)),

202 
unu£d3
 
__©Œibu‹__
((
unu£d
)),

203 
va_li¡
 
unu£d4
 
__©Œibu‹__
((
unu£d
)))

205 *
	gfunc
;

206 #ifdeà
WIN32


207 ià(!(
	gfunc
ð
G‘ProcAdd»ss
(
G‘ModuËHªdË
(
NULL
), "mariadb_auth_dialog")))

209 
	gfunc
ð
G‘ProcAdd»ss
(
G‘ModuËHªdË
(
NULL
), "mysql_authentication_dialog_ask");

211 ià(!(
	gfunc
ð
dlsym
(
RTLD_DEFAULT
, "mariadb_auth_dialog")))

213 
	gfunc
ð
dlsym
(
RTLD_DEFAULT
, "mysql_authentication_dialog_ask");

215 ià(
	gfunc
)

216 
	gauth_dŸlog_func
ð(
mysql_auth’tiÿtiÚ_dŸlog_ask_t
)
func
;

218 
	gauth_dŸlog_func
ð
auth_dŸlog_Çtive_´om±
;

	@plugins/auth/ed25519.c

19 #iâdeà
_WIN32


20 
	#_GNU_SOURCE
 1

	)

23 #ifdeà
_WIN32


24 
	#HAVE_WINCRYPT


	)

25 #undeà
HAVE_OPENSSL


26 #undeà
HAVE_GNUTLS


29 #ià
defšed
(
HAVE_OPENSSL
è|| defšed(
HAVE_WINCRYPT
è|| defšed(
HAVE_GNUTLS
)

31 
	~<ma_glob®.h
>

32 
	~<mysql.h
>

33 
	~<mysql/þ›Á_¶ugš.h
>

34 
	~<¡ršg.h
>

35 
	~<memÜy.h
>

36 
	~<”rmsg.h
>

37 
	~<ma_glob®.h
>

38 
	~<ma_sys.h
>

39 
	~<ma_commÚ.h
>

41 #iâdeà
WIN32


42 
	~<dlfú.h
>

45 #ià
defšed
(
HAVE_WINCRYPT
)

46 
	~<wšdows.h
>

47 
	~<wšüy±.h
>

48 
	~<büy±.h
>

49 
BCRYPT_ALG_HANDLE
 
Sha512Prov
;

50 #–ià
defšed
(
HAVE_OPENSSL
)

51 
	~<Ý’s¦/r§.h
>

52 
	~<Ý’s¦/³m.h
>

53 
	~<Ý’s¦/”r.h
>

54 #–ià
defšed
(
HAVE_GNUTLS
)

55 
	~<gnuŽs/gnuŽs.h
>

58 
	~<»f10/­i.h
>

59 
	~<»f10/commÚ.h
>

60 
	~<ma_üy±.h
>

63 
auth_ed25519_þ›Á
(
MYSQL_PLUGIN_VIO
 *
vio
, 
MYSQL
 *
mysql
);

64 
auth_ed25519_deš™
();

65 
auth_ed25519_š™
(*
unu£d1
,

66 
size_t
 
unu£d2
,

67 
unu£d3
,

68 
va_li¡
);

71 #iâdeà
PLUGIN_DYNAMIC


72 
¡_mysql_þ›Á_¶ugš_AUTHENTICATION
 
	gþ›Á_ed25519_þ›Á_¶ugš
=

74 
¡_mysql_þ›Á_¶ugš_AUTHENTICATION
 
_mysql_þ›Á_¶ugš_deþ¬©iÚ_
 =

77 
MYSQL_CLIENT_AUTHENTICATION_PLUGIN
,

78 
MYSQL_CLIENT_AUTHENTICATION_PLUGIN_INTERFACE_VERSION
,

84 
NULL
,

85 
auth_ed25519_š™
,

86 
auth_ed25519_deš™
,

87 
NULL
,

88 
auth_ed25519_þ›Á


92 
	$auth_ed25519_þ›Á
(
MYSQL_PLUGIN_VIO
 *
vio
, 
MYSQL
 *
mysql
)

94 *
·ck‘
,

95 
sigÇtu»
[
CRYPTO_BYTES
 + 
NONCE_BYTES
];

96 
pkt_Ën
;

106 
pkt_Ën
ð
vio
->
	`»ad_·ck‘
(vio, &
·ck‘
);

107 ià(
pkt_Ën
 !ð
NONCE_BYTES
)

108  
CR_SERVER_HANDSHAKE_ERR
;

111 
	`üy±o_sign
(
sigÇtu»
, 
·ck‘
, 
NONCE_BYTES
, (*)
mysql
->
·sswd
, 
	`¡¾’
(mysql->passwd));

114 ià(
vio
->
	`wr™e_·ck‘
(vio, 
sigÇtu»
, 
CRYPTO_BYTES
))

115  
CR_ERROR
;

117  
CR_OK
;

118 
	}
}

122 
auth_ed25519_š™
(*
unu£d1
 
__©Œibu‹__
((
unu£d
)),

123 
size_t
 
unu£d2
 
__©Œibu‹__
((
unu£d
)),

124 
unu£d3
 
__©Œibu‹__
((
unu£d
)),

125 
va_li¡
 
unu£d4
 
__©Œibu‹__
((
unu£d
)))

127 #ià
defšed
(
HAVE_WINCRYPT
)

128 
BCry±O³nAlgÜ™hmProvid”
(&
Sha512Prov
, 
BCRYPT_SHA512_ALGORITHM
, 
NULL
, 0);

135 
	$auth_ed25519_deš™
()

137 #ià
	`defšed
(
HAVE_WINCRYPT
)

138 
	`BCry±Clo£AlgÜ™hmProvid”
(
Sha512Prov
, 0);

141 
	}
}

	@plugins/auth/gssapi_client.c

29 #ià
defšed
(
__F»eBSD__
è|| defšed(
SOLARIS
è|| defšed(
__sun
)

30 
	~<gs§pi/gs§pi.h
>

32 
	~<gs§pi.h
>

34 
	~<¡ršg.h
>

35 
	~<¡dio.h
>

36 
	~<mysql/¶ugš_auth.h
>

37 
	~<ma_£rv”_”rÜ.h
>

38 
	~<mysql.h
>

39 
	~"gs§pi_”rmsg.h
"

41 
log_þ›Á_”rÜ
(
MYSQL
 *
mysql
,cÚ¡ *
fmt
,...);

45 
	$log_”rÜ
(
MYSQL
 *
mysql
, 
OM_ušt32
 
majÜ
, OM_ušt32 
mšÜ
, cÚ¡ *
msg
)

47 ià(
	`GSS_ERROR
(
majÜ
))

49 
sysmsg
[1024];

50 
	`gs§pi_”rmsg
(
majÜ
, 
mšÜ
, 
sysmsg
, (sysmsg));

51 
	`log_þ›Á_”rÜ
(
mysql
,

53 
majÜ
, 
mšÜ
, 
msg
, 
sysmsg
);

57 
	`log_þ›Á_”rÜ
(
mysql
, "Cl›Á GSSAPIƒ¼Ü : %s", 
msg
);

59 
	}
}

61 
auth_þ›Á
(*
´šc®_Çme
, *
mech
 
__©Œibu‹__
((
unu£d
)),

62 
MYSQL
 *
mysql
, 
MYSQL_PLUGIN_VIO
 *
vio
)

64 
gss_bufãr_desc
 
	gšput
= {0,0};

65 
	g»t
ð
CR_ERROR
;

66 
OM_ušt32
 
	gmajÜ
ð0, 
	gmšÜ
= 0;

67 
gss_ùx_id_t
 
	gùxt
ð
GSS_C_NO_CONTEXT
;

68 
gss_Çme_t
 
	g£rviû_Çme
ð
GSS_C_NO_NAME
;

70 ià(
	g´šc®_Çme
 &&…rincipal_name[0])

73 
gss_bufãr_desc
 
	g´šc®_Çme_buf
;

74 
	g´šc®_Çme_buf
.
	gËngth
ð
¡¾’
(
´šc®_Çme
);

75 
	g´šc®_Çme_buf
.
	gv®ue
ð(*è
´šc®_Çme
;

76 
	gmajÜ
ð
gss_impÜt_Çme
(&
mšÜ
, &
´šc®_Çme_buf
, 
GSS_C_NT_USER_NAME
, &
£rviû_Çme
);

77 ià(
GSS_ERROR
(
majÜ
))

79 
log_”rÜ
(
mysql
, 
majÜ
, 
mšÜ
, "gss_import_name");

80  
	gCR_ERROR
;

86 
gss_bufãr_desc
 
	gouut
= {0,0};

87 
	gmajÜ
ð
gss_š™_£c_cÚ‹xt
(&
mšÜ
, 
GSS_C_NO_CREDENTIAL
, &
ùxt
, 
£rviû_Çme
,

88 
GSS_C_NO_OID
, 0, 0, 
GSS_C_NO_CHANNEL_BINDINGS
,

89 &
šput
, 
NULL
, &
ouut
, NULL, NULL);

90 ià(
	gouut
.
	gËngth
)

93 if(
	gvio
->
wr™e_·ck‘
(
vio
, (*)
ouut
.
v®ue
, ouut.
Ëngth
))

96 
	g»t
ð
CR_OK_HANDSHAKE_COMPLETE
;

97 
gss_»Ëa£_bufãr
 (&
mšÜ
, &
ouut
);

98 
	gþ—nup
;

101 
gss_»Ëa£_bufãr
 (&
mšÜ
, &
ouut
);

103 ià(
GSS_ERROR
(
majÜ
))

105 
log_”rÜ
(
mysql
, 
majÜ
, 
mšÜ
,"gss_init_sec_context");

106 
	gþ—nup
;

109 ià(
	gmajÜ
 & 
	gGSS_S_CONTINUE_NEEDED
)

111 
	gËn
ð
vio
->
»ad_·ck‘
(vio, (**è&
šput
.
v®ue
);

112 ià(
	gËn
 <= 0)

115 
»t
ð
CR_OK_HANDSHAKE_COMPLETE
;

116 
	gþ—nup
;

118 
	gšput
.
	gËngth
ð
Ën
;

120 } 
	gmajÜ
 & 
	gGSS_S_CONTINUE_NEEDED
);

122 
	g»t
ð
CR_OK
;

124 
	gþ—nup
:

125 ià(
£rviû_Çme
 !ð
GSS_C_NO_NAME
)

126 
gss_»Ëa£_Çme
(&
mšÜ
, &
£rviû_Çme
);

127 ià(
	gùxt
 !ð
GSS_C_NO_CONTEXT
)

128 
gss_d–‘e_£c_cÚ‹xt
(&
mšÜ
, &
ùxt
, 
GSS_C_NO_BUFFER
);

130  
	g»t
;

	@plugins/auth/gssapi_errmsg.c

29 #ià
defšed
(
__F»eBSD__
è|| defšed(
SOLARIS
è|| defšed(
__sun
)

30 
	~<gs§pi/gs§pi.h
>

32 
	~<gs§pi.h
>

34 
	~<¡ršg.h
>

35 
	$gs§pi_”rmsg
(
OM_ušt32
 
majÜ
, OM_ušt32 
mšÜ
, *
buf
, 
size_t
 
size
)

37 
OM_ušt32
 
mes§ge_cÚ‹xt
;

38 
OM_ušt32
 
¡©us_code
;

39 
OM_ušt32
 
maj_¡©us
;

40 
OM_ušt32
 
mš_¡©us
;

41 
gss_bufãr_desc
 
¡©us_¡ršg
;

42 *
p
ð
buf
;

43 *
’d
ð
buf
 + 
size
 - 1;

44 
ty³s
[] = {
GSS_C_GSS_CODE
,
GSS_C_MECH_CODE
};

45 
i
;

46 
i
= 0; i < 2;i++)

48 
mes§ge_cÚ‹xt
= 0;

49 
¡©us_code
ð
ty³s
[
i
] =ð
GSS_C_GSS_CODE
?
majÜ
:
mšÜ
;

51 if(!
¡©us_code
)

55 
maj_¡©us
 = 
	`gss_di¥Ïy_¡©us
(

56 &
mš_¡©us
,

57 
¡©us_code
,

58 
ty³s
[
i
],

59 
GSS_C_NO_OID
,

60 &
mes§ge_cÚ‹xt
,

61 &
¡©us_¡ršg
);

63 if(
maj_¡©us
)

66 if(
p
 + 
¡©us_¡ršg
.
Ëngth
 + 2 < 
’d
)

68 
	`memýy
(
p
,
¡©us_¡ršg
.
v®ue
, stus_¡ršg.
Ëngth
);

69 
p
 +ð
¡©us_¡ršg
.
Ëngth
;

70 *
p
++ = '.';

71 *
p
++ = ' ';

74 
	`gss_»Ëa£_bufãr
(&
mš_¡©us
, &
¡©us_¡ršg
);

76 
mes§ge_cÚ‹xt
 != 0);

78 *
p
= 0;

79 
	}
}

	@plugins/auth/gssapi_errmsg.h

29 
gs§pi_”rmsg
(
OM_ušt32
 
majÜ
, OM_ušt32 
mšÜ
, *
buf
, 
size_t
 
size
);

	@plugins/auth/mariadb_cleartext.c

19 
	~<ma_glob®.h
>

20 
	~<mysql.h
>

21 
	~<mysql/þ›Á_¶ugš.h
>

22 
	~<¡ršg.h
>

45 
	$þ—r_·sswÜd_auth_þ›Á
(
MYSQL_PLUGIN_VIO
 *
vio
, 
MYSQL
 *
mysql
)

47 ià(!
vio
 || !
mysql
 || !mysql->
·sswd
)

48  
CR_ERROR
;

51  
vio
->
	`wr™e_·ck‘
(vio, (cÚ¡ *è
mysql
->
·sswd
, ()
	`¡¾’
(mysql->passwd) + 1) ?

52 
CR_ERROR
 : 
CR_OK
;

53 
	}
}

56 #iâdeà
PLUGIN_DYNAMIC


57 
¡_mysql_þ›Á_¶ugš_AUTHENTICATION
 
	gmysql_þ—r_·sswÜd_þ›Á_¶ugš
=

59 
¡_mysql_þ›Á_¶ugš_AUTHENTICATION
 
_mysql_þ›Á_¶ugš_deþ¬©iÚ_
 =

62 
MYSQL_CLIENT_AUTHENTICATION_PLUGIN
,

63 
MYSQL_CLIENT_AUTHENTICATION_PLUGIN_INTERFACE_VERSION
,

69 
NULL
,

70 
NULL
,

71 
NULL
,

72 
NULL
,

73 
þ—r_·sswÜd_auth_þ›Á


	@plugins/auth/my_auth.c

1 
	~<ma_glob®.h
>

2 
	~<ma_sys.h
>

3 
	~<”rmsg.h
>

4 
	~<¡ršg.h
>

5 
	~<ma_commÚ.h
>

6 
	~<mysql/þ›Á_¶ugš.h
>

8 
¡_mysql_þ›Á_¶ugš_AUTHENTICATION
 
	tauth_¶ugš_t
;

9 
þ›Á_mpvio_wr™e_·ck‘
(
¡_¶ugš_vio
*, cÚ¡ 
uch¬
*, 
size_t
);

10 
Çtive_·sswÜd_auth_þ›Á
(
MYSQL_PLUGIN_VIO
 *
vio
, 
MYSQL
 *
mysql
);

11 
dummy_çÎback_auth_þ›Á
(
MYSQL_PLUGIN_VIO
 *
vio
, 
MYSQL
 *
mysql
 
__©Œibu‹__
((
unu£d
)));

12 
»ad_u£r_Çme
(*
Çme
);

13 *
ma_£nd_cÚÃù_©Œ
(
MYSQL
 *
mysql
, *
bufãr
);

14 
ma_»ad_ok_·ck‘
(
MYSQL
 *
mysql
, 
uch¬
 *
pos
, 
ulÚg
 
Ëngth
);

15 *
mysql_Ãt_¡Üe_Ëngth
(*
·ck‘
, 
size_t
 
Ëngth
);

18 (*
	m»ad_·ck‘
)(
¡_¶ugš_vio
 *
	mvio
, 
uch¬
 **
	mbuf
);

19 (*
	mwr™e_·ck‘
)(
¡_¶ugš_vio
 *
	mvio
, cÚ¡ 
uch¬
 *
	mpkt
, 
size_t
 
	mpkt_Ën
);

20 (*
	mšfo
)(
¡_¶ugš_vio
 *
	mvio
, 
¡_¶ugš_vio_šfo
 *info);

22 
MYSQL
 *
	mmysql
;

23 
auth_¶ugš_t
 *
	m¶ugš
;

24 cÚ¡ *
	mdb
;

26 
uch¬
 *
	mpkt
;

27 
ušt
 
	mpkt_Ën
;

28 } 
	mÿched_£rv”_»¶y
;

29 
ušt
 
	m·ck‘s_»ad
, 
	m·ck‘s_wr™‹n
;

30 
my_boÞ
 
	mmysql_chªge_u£r
;

31 
	mÏ¡_»ad_·ck‘_Ën
;

32 } 
	tMCPVIO_EXT
;

40 
auth_¶ugš_t
 
	gmysql_Çtive_·sswÜd_þ›Á_¶ugš
=

42 
MYSQL_CLIENT_AUTHENTICATION_PLUGIN
,

43 
MYSQL_CLIENT_AUTHENTICATION_PLUGIN_INTERFACE_VERSION
,

44 
Çtive_·sswÜd_¶ugš_Çme
,

49 
NULL
,

50 
NULL
,

51 
NULL
,

52 
NULL
,

53 
Çtive_·sswÜd_auth_þ›Á


57 
	$Çtive_·sswÜd_auth_þ›Á
(
MYSQL_PLUGIN_VIO
 *
vio
, 
MYSQL
 *
mysql
)

59 
pkt_Ën
;

60 
uch¬
 *
pkt
;

62 ià(((
MCPVIO_EXT
 *)
vio
)->
mysql_chªge_u£r
)

68 
pkt
ð(
uch¬
*)
mysql
->
süambË_buff
;

69 
pkt_Ën
ð
SCRAMBLE_LENGTH
 + 1;

74 ià((
pkt_Ën
ð
vio
->
	`»ad_·ck‘
(vio, &
pkt
)) < 0)

75  
CR_ERROR
;

77 ià(
pkt_Ën
 !ð
SCRAMBLE_LENGTH
 + 1)

78  
CR_SERVER_HANDSHAKE_ERR
;

81 
	`memmove
(
mysql
->
süambË_buff
, 
pkt
, 
SCRAMBLE_LENGTH
);

82 
mysql
->
süambË_buff
[
SCRAMBLE_LENGTH
] = 0;

85 ià(
mysql
 && mysql->
·sswd
[0])

87 
süambËd
[
SCRAMBLE_LENGTH
 + 1];

88 
	`ma_süambË_41
((
uch¬
 *)
süambËd
, (*)
pkt
, 
mysql
->
·sswd
);

89 ià(
vio
->
	`wr™e_·ck‘
(vio, (
uch¬
*)
süambËd
, 
SCRAMBLE_LENGTH
))

90  
CR_ERROR
;

93 ià(
vio
->
	`wr™e_·ck‘
(vio, 0, 0))

94  
CR_ERROR
;

96  
CR_OK
;

97 
	}
}

99 
auth_¶ugš_t
 
	gdummy_çÎback_þ›Á_¶ugš
=

101 
MYSQL_CLIENT_AUTHENTICATION_PLUGIN
,

102 
MYSQL_CLIENT_AUTHENTICATION_PLUGIN_INTERFACE_VERSION
,

108 
NULL
,

109 
NULL
,

110 
NULL
,

111 
NULL
,

112 
dummy_çÎback_auth_þ›Á


116 
dummy_çÎback_auth_þ›Á
(
MYSQL_PLUGIN_VIO
 *
vio
, 
MYSQL
 *
mysql
 
__©Œibu‹__
((
unu£d
)))

118 
	gÏ¡_”rÜ
[
MYSQL_ERRMSG_SIZE
];

119 
	gi
, 
	gÏ¡_”ºo
ð((
MCPVIO_EXT
 *)
vio
)->
mysql
->
Ãt
.
Ï¡_”ºo
;

120 ià(
	gÏ¡_”ºo
)

122 
¡ºýy
(
Ï¡_”rÜ
, ((
MCPVIO_EXT
 *)
vio
)->
mysql
->
Ãt
.last_error,

123 (
Ï¡_”rÜ
) - 1);

124 
	gÏ¡_”rÜ
[(
Ï¡_”rÜ
) - 1]= 0;

128 
	gi
=0; i < 10; i++)

130 
uch¬
 *
	gpkt
;

131 ià(
	gvio
->
»ad_·ck‘
(
vio
, &
pkt
) < 0)

133 ià(
	gvio
->
wr™e_·ck‘
(
vio
, 0, 0))

136 ià(
	gÏ¡_”ºo
)

138 
MYSQL
 *
	gmysql
ð((
MCPVIO_EXT
 *)
vio
)->
mysql
;

139 
¡ºýy
(
mysql
->
Ãt
.
Ï¡_”rÜ
,†ast_error,

140 (
mysql
->
Ãt
.
Ï¡_”rÜ
) - 1);

141 
	gmysql
->
	gÃt
.
	gÏ¡_”rÜ
[(
mysql
->
Ãt
.
Ï¡_”rÜ
) - 1]= 0;

143  
	gCR_ERROR
;

146 
	$£nd_chªge_u£r_·ck‘
(
MCPVIO_EXT
 *
mpvio
,

147 cÚ¡ 
uch¬
 *
d©a
, 
d©a_Ën
)

149 
MYSQL
 *
mysql
ð
mpvio
->mysql;

150 *
buff
, *
’d
;

151 
»s
= 1;

152 
size_t
 
cÚn_©Œ_Ën
ð(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
) ?

153 
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
cÚÃù_©Œs_Ën
 : 0;

155 
buff
ð
	`m®loc
(
USERNAME_LENGTH
+1 + 
d©a_Ën
+1 + 
NAME_LEN
+1 + 2 + NAME_LEN+1 + 9 + 
cÚn_©Œ_Ën
);

157 
’d
ð
	`ma_¡rmake
(
buff
, 
mysql
->
u£r
, 
USERNAME_LENGTH
) + 1;

159 ià(!
d©a_Ën
)

160 *
’d
++= 0;

163 ià(
mysql
->
þ›Á_æag
 & 
CLIENT_SECURE_CONNECTION
)

165 
	`DBUG_ASSERT
(
d©a_Ën
 <= 255);

166 ià(
d©a_Ën
 > 255)

168 
	`my_£t_”rÜ
(
mysql
, 
CR_MALFORMED_PACKET
, 
SQLSTATE_UNKNOWN
, 0);

169 
”rÜ
;

171 *
’d
++ð
d©a_Ën
;

175 
	`DBUG_ASSERT
(
d©a_Ën
 =ð
SCRAMBLE_LENGTH_323
 + 1);

176 
	`DBUG_ASSERT
(
d©a
[
SCRAMBLE_LENGTH_323
] == 0);

178 
	`memýy
(
’d
, 
d©a
, 
d©a_Ën
);

179 
’d
+ð
d©a_Ën
;

181 
’d
ð
	`ma_¡rmake
Ónd, 
mpvio
->
db
 ? mpvio->db : "", 
NAME_LEN
) + 1;

183 ià(
mysql
->
£rv”_ÿ·bž™›s
 & 
CLIENT_PROTOCOL_41
)

185 
	`št2¡Üe
(
’d
, (
ushÜt
è
mysql
->
ch¬£t
->
Ä
);

186 
’d
+= 2;

189 ià(
mysql
->
£rv”_ÿ·bž™›s
 & 
CLIENT_PLUGIN_AUTH
)

190 
’d
ð
	`ma_¡rmake
Ónd, 
mpvio
->
¶ugš
->
Çme
, 
NAME_LEN
) + 1;

192 
’d
ð
	`ma_£nd_cÚÃù_©Œ
(
mysql
, (*)end);

194 
»s
ð
	`ma_sim¶e_commªd
(
mysql
, 
COM_CHANGE_USER
,

195 
buff
, (
ulÚg
)(
’d
-buff), 1, 
NULL
);

197 
”rÜ
:

198 
	`ä“
(
buff
);

199  
»s
;

200 
	}
}

204 
	$£nd_þ›Á_»¶y_·ck‘
(
MCPVIO_EXT
 *
mpvio
,

205 cÚ¡ 
uch¬
 *
d©a
, 
d©a_Ën
)

207 
MYSQL
 *
mysql
ð
mpvio
->mysql;

208 
NET
 *
Ãt
ð&
mysql
->net;

209 *
buff
, *
’d
;

210 
size_t
 
cÚn_©Œ_Ën
ð(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
) ?

211 
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
cÚÃù_©Œs_Ën
 : 0;

214 
buff
ð
	`m®loc
(33 + 
USERNAME_LENGTH
 + 
d©a_Ën
 + 
NAME_LEN
 + NAME_LEN + 
cÚn_©Œ_Ën
 + 9);

215 
’d
ð
buff
;

217 
mysql
->
þ›Á_æag
|ðmysql->
ÝtiÚs
.client_flag;

218 
mysql
->
þ›Á_æag
|ð
CLIENT_CAPABILITIES
;

220 ià(
mysql
->
þ›Á_æag
 & 
CLIENT_MULTI_STATEMENTS
)

221 
mysql
->
þ›Á_æag
|ð
CLIENT_MULTI_RESULTS
;

223 #ià
	`defšed
(
HAVE_TLS
è&& !defšed(
EMBEDDED_LIBRARY
)

224 ià(
mysql
->
ÝtiÚs
.
s¦_key
 || mysql->ÝtiÚs.
s¦_û¹
 ||

225 
mysql
->
ÝtiÚs
.
s¦_ÿ
 || mysql->ÝtiÚs.
s¦_ÿ·th
 ||

226 
mysql
->
ÝtiÚs
.
s¦_ch”
 || mysql->ÝtiÚs.
u£_s¦
 ||

227 (
mysql
->
ÝtiÚs
.
þ›Á_æag
 & 
CLIENT_SSL_VERIFY_SERVER_CERT
))

228 
mysql
->
ÝtiÚs
.
u£_s¦
= 1;

229 ià(
mysql
->
ÝtiÚs
.
u£_s¦
)

230 
mysql
->
þ›Á_æag
|ð
CLIENT_SSL
;

232 ià(
mpvio
->
db
)

233 
mysql
->
þ›Á_æag
|ð
CLIENT_CONNECT_WITH_DB
;

237 ià(
mysql
->
ÝtiÚs
.
u£_s¦
 && !(mysql->
£rv”_ÿ·bž™›s
 & 
CLIENT_SSL
))

239 ià((
mysql
->
þ›Á_æag
 & 
CLIENT_SSL_VERIFY_SERVER_CERT
) ||

240 (
mysql
->
ÝtiÚs
.
ex‹nsiÚ
 && (mysql->ÝtiÚs.ex‹nsiÚ->
Žs_å
 ||

241 
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
Žs_å_li¡
)))

243 
	`my_£t_”rÜ
(
mysql
, 
CR_SSL_CONNECTION_ERROR
, 
SQLSTATE_UNKNOWN
,

244 
	`ER
(
CR_SSL_CONNECTION_ERROR
),

246 
”rÜ
;

252 
mysql
->
þ›Á_æag
= mysql->client_flag &

253 (~(
CLIENT_COMPRESS
 | 
CLIENT_SSL
 | 
CLIENT_PROTOCOL_41
)

254 | 
mysql
->
£rv”_ÿ·bž™›s
);

256 #iâdeà
HAVE_COMPRESS


257 
mysql
->
þ›Á_æag
&ð~
CLIENT_COMPRESS
;

260 ià(
mysql
->
þ›Á_æag
 & 
CLIENT_PROTOCOL_41
)

263 ià(!(
mysql
->
£rv”_ÿ·bž™›s
 & 
CLIENT_MYSQL
))

264 
mysql
->
þ›Á_æag
&ð~
CLIENT_MYSQL
;

265 
	`št4¡Üe
(
buff
,
mysql
->
þ›Á_æag
);

266 
	`št4¡Üe
(
buff
+4, 
Ãt
->
max_·ck‘_size
);

267 
buff
[8]ð(è
mysql
->
ch¬£t
->
Ä
;

268 
	`mem£t
(
buff
 + 9, 0, 32-9);

269 ià(!(
mysql
->
£rv”_ÿ·bž™›s
 & 
CLIENT_MYSQL
))

271 
mysql
->
ex‹nsiÚ
->
m¬Ÿdb_þ›Á_æag
 = 
MARIADB_CLIENT_SUPPORTED_FLAGS
 >> 32;

272 
	`št4¡Üe
(
buff
 + 28, 
mysql
->
ex‹nsiÚ
->
m¬Ÿdb_þ›Á_æag
);

274 
’d
ð
buff
+32;

278 
	`št2¡Üe
(
buff
, 
mysql
->
þ›Á_æag
);

279 
	`št3¡Üe
(
buff
+2, 
Ãt
->
max_·ck‘_size
);

280 
’d
ð
buff
+5;

282 #ifdeà
HAVE_TLS


283 ià(
mysql
->
ÝtiÚs
.
s¦_key
 ||

284 
mysql
->
ÝtiÚs
.
s¦_û¹
 ||

285 
mysql
->
ÝtiÚs
.
s¦_ÿ
 ||

286 
mysql
->
ÝtiÚs
.
s¦_ÿ·th
 ||

287 
mysql
->
ÝtiÚs
.
s¦_ch”


288 #ifdeà
CRL_IMPLEMENTED


289 || (
mysql
->
ÝtiÚs
.
ex‹nsiÚ
 &&

290 (
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
s¦_ül
 ||

291 
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
s¦_üÍ©h
))

294 
mysql
->
ÝtiÚs
.
u£_s¦
= 1;

295 ià(
mysql
->
ÝtiÚs
.
u£_s¦
 &&

296 (
mysql
->
þ›Á_æag
 & 
CLIENT_SSL
))

302 ià(
	`ma_Ãt_wr™e
(
Ãt
, (*)
buff
, (
size_t
è(
’d
-buff)è|| 
	`ma_Ãt_æush
(net))

304 
	`my_£t_”rÜ
(
mysql
, 
CR_SERVER_LOST
, 
SQLSTATE_UNKNOWN
,

305 
	`ER
(
CR_SERVER_LOST_EXTENDED
),

307 
”ºo
);

308 
”rÜ
;

310 ià(
	`ma_pvio_¡¬t_s¦
(
mysql
->
Ãt
.
pvio
))

311 
”rÜ
;

316 ià(
mysql
->
u£r
 && mysql->user[0])

317 
	`ma_¡rmake
(
’d
, 
mysql
->
u£r
, 
USERNAME_LENGTH
);

319 
	`»ad_u£r_Çme
(
’d
);

322 
’d
+ð
	`¡¾’
(end) + 1;

323 ià(
d©a_Ën
)

325 ià(
mysql
->
£rv”_ÿ·bž™›s
 & 
CLIENT_SECURE_CONNECTION
)

327 ià(
mysql
->
£rv”_ÿ·bž™›s
 & 
CLIENT_PLUGIN_AUTH_LENENC_CLIENT_DATA
)

329 
’d
ð(*)
	`mysql_Ãt_¡Üe_Ëngth
((
uch¬
 *ënd, 
d©a_Ën
);

334 ià(
d©a_Ën
 > 0xFF)

335 
”rÜ
;

336 *
’d
++ð
d©a_Ën
;

338 
	`memýy
(
’d
, 
d©a
, 
d©a_Ën
);

339 
’d
+ð
d©a_Ën
;

343 
	`DBUG_ASSERT
(
d©a_Ën
 =ð
SCRAMBLE_LENGTH_323
 + 1);

344 
	`memýy
(
’d
, 
d©a
, 
d©a_Ën
);

345 
’d
+ð
d©a_Ën
;

349 *
’d
++= 0;

352 ià(
mpvio
->
db
 && (
mysql
->
£rv”_ÿ·bž™›s
 & 
CLIENT_CONNECT_WITH_DB
))

354 
’d
ð
	`ma_¡rmake
Ónd, 
mpvio
->
db
, 
NAME_LEN
) + 1;

355 
mysql
->
db
ð
	`¡rdup
(
mpvio
->db);

358 ià(
mysql
->
£rv”_ÿ·bž™›s
 & 
CLIENT_PLUGIN_AUTH
)

359 
’d
ð
	`ma_¡rmake
Ónd, 
mpvio
->
¶ugš
->
Çme
, 
NAME_LEN
) + 1;

361 
’d
ð
	`ma_£nd_cÚÃù_©Œ
(
mysql
, (*)end);

364 ià(
	`ma_Ãt_wr™e
(
Ãt
, (*)
buff
, (
size_t
è(
’d
-buff)è|| 
	`ma_Ãt_æush
(net))

366 
	`my_£t_”rÜ
(
mysql
, 
CR_SERVER_LOST
, 
SQLSTATE_UNKNOWN
,

367 
	`ER
(
CR_SERVER_LOST_EXTENDED
),

369 
”ºo
);

370 
”rÜ
;

372 
	`ä“
(
buff
);

375 
”rÜ
:

376 
	`ä“
(
buff
);

378 
	}
}

387 
	$þ›Á_mpvio_»ad_·ck‘
(
¡_¶ugš_vio
 *
mpv
, 
uch¬
 **
buf
)

389 
MCPVIO_EXT
 *
mpvio
ð(MCPVIO_EXT*)
mpv
;

390 
MYSQL
 *
mysql
ð
mpvio
->mysql;

391 
ulÚg
 
pkt_Ën
;

394 ià(
mpvio
->
ÿched_£rv”_»¶y
.
pkt
)

396 *
buf
ð
mpvio
->
ÿched_£rv”_»¶y
.
pkt
;

397 
mpvio
->
ÿched_£rv”_»¶y
.
pkt
= 0;

398 
mpvio
->
·ck‘s_»ad
++;

399  
mpvio
->
ÿched_£rv”_»¶y
.
pkt_Ën
;

402 ià(
mpvio
->
·ck‘s_»ad
 == 0)

410 ià(
	`þ›Á_mpvio_wr™e_·ck‘
(
mpv
, 0, 0))

411  ()
·ck‘_”rÜ
;

415 ià((
pkt_Ën
ð
	`ma_Ãt_§ã_»ad
(
mysql
)è=ð
·ck‘_”rÜ
)

416  ()
·ck‘_”rÜ
;

418 
mpvio
->
Ï¡_»ad_·ck‘_Ën
ð
pkt_Ën
;

419 *
buf
ð
mysql
->
Ãt
.
»ad_pos
;

422 ià(
pkt_Ën
 && **
buf
 == 254)

423  ()
·ck‘_”rÜ
;

432 ià(
pkt_Ën
 && **
buf
 == 1)

434 (*
buf
)++;

435 
pkt_Ën
--;

437 
mpvio
->
·ck‘s_»ad
++;

438  
pkt_Ën
;

439 
	}
}

451 
	$þ›Á_mpvio_wr™e_·ck‘
(
¡_¶ugš_vio
 *
mpv
,

452 cÚ¡ 
uch¬
 *
pkt
, 
size_t
 
pkt_Ën
)

454 
»s
;

455 
MCPVIO_EXT
 *
mpvio
ð(MCPVIO_EXT*)
mpv
;

457 ià(
mpvio
->
·ck‘s_wr™‹n
 == 0)

459 ià(
mpvio
->
mysql_chªge_u£r
)

460 
»s
ð
	`£nd_chªge_u£r_·ck‘
(
mpvio
, 
pkt
, ()
pkt_Ën
);

462 
»s
ð
	`£nd_þ›Á_»¶y_·ck‘
(
mpvio
, 
pkt
, ()
pkt_Ën
);

466 
NET
 *
Ãt
ð&
mpvio
->
mysql
->net;

467 ià(
mpvio
->
mysql
->
thd
)

468 
»s
= 1;

470 
»s
ð
	`ma_Ãt_wr™e
(
Ãt
, (*)
pkt
, 
pkt_Ën
è|| 
	`ma_Ãt_æush
(net);

473 ià(
»s
)

476 ià(!
	`mysql_”ºo
(
mpvio
->
mysql
))

477 
	`my_£t_”rÜ
(
mpvio
->
mysql
, 
CR_SERVER_LOST
, 
SQLSTATE_UNKNOWN
,

478 
	`ER
(
CR_SERVER_LOST_EXTENDED
),

480 
”ºo
);

482 
mpvio
->
·ck‘s_wr™‹n
++;

483  
»s
;

484 
	}
}

491 
	$mpvio_šfo
(
MARIADB_PVIO
 *
pvio
, 
MYSQL_PLUGIN_VIO_INFO
 *
šfo
)

493 
	`mem£t
(
šfo
, 0, (*info));

494 
pvio
->
ty³
) {

495 
PVIO_TYPE_SOCKET
:

496 
šfo
->
´ÙocÞ
ð
MYSQL_VIO_TCP
;

497 
	`ma_pvio_g‘_hªdË
(
pvio
, &
šfo
->
sock‘
);

499 
PVIO_TYPE_UNIXSOCKET
:

500 
šfo
->
´ÙocÞ
ð
MYSQL_VIO_SOCKET
;

501 
	`ma_pvio_g‘_hªdË
(
pvio
, &
šfo
->
sock‘
);

516 #ifdeà
_WIN32


530 : 
	`DBUG_ASSERT
(0);

532 
	}
}

534 
	$þ›Á_mpvio_šfo
(
MYSQL_PLUGIN_VIO
 *
vio
,

535 
MYSQL_PLUGIN_VIO_INFO
 *
šfo
)

537 
MCPVIO_EXT
 *
mpvio
ð(MCPVIO_EXT*)
vio
;

538 
	`mpvio_šfo
(
mpvio
->
mysql
->
Ãt
.
pvio
, 
šfo
);

539 
	}
}

558 
	$run_¶ugš_auth
(
MYSQL
 *
mysql
, *
d©a
, 
ušt
 
d©a_Ën
,

559 cÚ¡ *
d©a_¶ugš
, cÚ¡ *
db
)

561 cÚ¡ *
auth_¶ugš_Çme
ð
NULL
;

562 
auth_¶ugš_t
 *
auth_¶ugš
;

563 
MCPVIO_EXT
 
mpvio
;

564 
ulÚg
 
pkt_Ëngth
;

565 
»s
;

568 ià(
mysql
->
£rv”_ÿ·bž™›s
 & 
CLIENT_PLUGIN_AUTH
)

570 ià(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
 && mysql->ÝtiÚs.ex‹nsiÚ->
deçuÉ_auth
)

571 
auth_¶ugš_Çme
ð
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
deçuÉ_auth
;

572 ià(
d©a_¶ugš
)

573 
auth_¶ugš_Çme
ð
d©a_¶ugš
;

575 ià(!
auth_¶ugš_Çme
)

577 ià(
mysql
->
£rv”_ÿ·bž™›s
 & 
CLIENT_PROTOCOL_41
)

578 
auth_¶ugš_Çme
ð
Çtive_·sswÜd_¶ugš_Çme
;

580 
auth_¶ugš_Çme
= "mysql_old_password";

582 ià(!(
auth_¶ugš
ð(
auth_¶ugš_t
*è
	`mysql_þ›Á_fšd_¶ugš
(
mysql
,

583 
auth_¶ugš_Çme
, 
MYSQL_CLIENT_AUTHENTICATION_PLUGIN
)))

584 
auth_¶ugš
ð&
dummy_çÎback_þ›Á_¶ugš
;

586 
mysql
->
Ãt
.
Ï¡_”ºo
= 0;

588 ià(
d©a_¶ugš
 && 
	`¡rcmp
(d©a_¶ugš, 
auth_¶ugš_Çme
))

592 
d©a
= 0;

593 
d©a_Ën
= 0;

596 
mpvio
.
mysql_chªge_u£r
ð
d©a_¶ugš
 == 0;

597 
mpvio
.
ÿched_£rv”_»¶y
.
pkt
ð(
uch¬
*)
d©a
;

598 
mpvio
.
ÿched_£rv”_»¶y
.
pkt_Ën
ð
d©a_Ën
;

599 
mpvio
.
»ad_·ck‘
ð
þ›Á_mpvio_»ad_·ck‘
;

600 
mpvio
.
wr™e_·ck‘
ð
þ›Á_mpvio_wr™e_·ck‘
;

601 
mpvio
.
šfo
ð
þ›Á_mpvio_šfo
;

602 
mpvio
.
mysql
= mysql;

603 
mpvio
.
·ck‘s_»ad
ðmpvio.
·ck‘s_wr™‹n
= 0;

604 
mpvio
.
db
= db;

606 
»Œy
:

607 
mpvio
.
¶ugš
ð
auth_¶ugš
;

609 
mysql
->
Ãt
.
»ad_pos
[0]= 0;

610 
»s
ð
auth_¶ugš
->
	`auth’tiÿ‹_u£r
((
¡_¶ugš_vio
 *)&
mpvio
, 
mysql
);

612 ià((
»s
 =ð
CR_ERROR
 && !
mysql
->
Ãt
.
buff
) ||

613 (
»s
 > 
CR_OK
 && 
mysql
->
Ãt
.
»ad_pos
[0] != 254))

620 ià(
»s
 > 
CR_ERROR
)

621 
	`my_£t_”rÜ
(
mysql
, 
»s
, 
SQLSTATE_UNKNOWN
, 0);

623 ià(!
mysql
->
Ãt
.
Ï¡_”ºo
) {

624 
	`my_£t_”rÜ
(
mysql
, 
CR_UNKNOWN_ERROR
, 
SQLSTATE_UNKNOWN
, 0);

630 ià(
»s
 =ð
CR_OK
)

631 
pkt_Ëngth
ð
	`ma_Ãt_§ã_»ad
(
mysql
);

633 
pkt_Ëngth
ð
mpvio
.
Ï¡_»ad_·ck‘_Ën
;

635 ià(
pkt_Ëngth
 =ð
·ck‘_”rÜ
)

637 ià(
mysql
->
Ãt
.
Ï¡_”ºo
 =ð
CR_SERVER_LOST
)

638 
	`my_£t_”rÜ
(
mysql
, 
CR_SERVER_LOST
, 
SQLSTATE_UNKNOWN
,

639 
	`ER
(
CR_SERVER_LOST_EXTENDED
),

641 
”ºo
);

644 ià(
mysql
->
Ãt
.
»ad_pos
[0] == 254)

647 ià(
pkt_Ëngth
 == 1)

650 
auth_¶ugš_Çme
ð
Þd_·sswÜd_¶ugš_Çme
;

651 
mpvio
.
ÿched_£rv”_»¶y
.
pkt
ð(
uch¬
*)
mysql
->
süambË_buff
;

652 
mpvio
.
ÿched_£rv”_»¶y
.
pkt_Ën
ð
SCRAMBLE_LENGTH
 + 1;

657 
ušt
 
Ën
;

658 
auth_¶ugš_Çme
ð(*)
mysql
->
Ãt
.
»ad_pos
 + 1;

659 
Ën
ð(
ušt
)
	`¡¾’
(
auth_¶ugš_Çme
);

660 
mpvio
.
ÿched_£rv”_»¶y
.
pkt_Ën
ð
pkt_Ëngth
 - 
Ën
 - 2;

661 
mpvio
.
ÿched_£rv”_»¶y
.
pkt
ð
mysql
->
Ãt
.
»ad_pos
 + 
Ën
 + 2;

663 ià(!(
auth_¶ugš
ð(
auth_¶ugš_t
 *è
	`mysql_þ›Á_fšd_¶ugš
(
mysql
,

664 
auth_¶ugš_Çme
, 
MYSQL_CLIENT_AUTHENTICATION_PLUGIN
)))

665 
auth_¶ugš
ð&
dummy_çÎback_þ›Á_¶ugš
;

667 
»Œy
;

674 ià(
mysql
->
Ãt
.
»ad_pos
[0] == 0)

675  
	`ma_»ad_ok_·ck‘
(
mysql
, mysql->
Ãt
.
»ad_pos
 + 1, 
pkt_Ëngth
);

677 
	}
}

	@plugins/auth/old_password.c

19 
	~<ma_glob®.h
>

20 
	~<mysql.h
>

21 
	~<mysql/þ›Á_¶ugš.h
>

22 
	~<¡ršg.h
>

23 
	~<memÜy.h
>

24 
	~<”rmsg.h
>

28 
auth_Þd_·sswÜd
(
MYSQL_PLUGIN_VIO
 *
vio
, 
MYSQL
 *
mysql
);

30 
¡_mysql_þ›Á_¶ugš_AUTHENTICATION
 
	tauth_¶ugš_t
;

33 (*
	m»ad_·ck‘
)(
¡_¶ugš_vio
 *
	mvio
, 
uch¬
 **
	mbuf
);

34 (*
	mwr™e_·ck‘
)(
¡_¶ugš_vio
 *
	mvio
, cÚ¡ 
uch¬
 *
	mpkt
, 
size_t
 
	mpkt_Ën
);

35 (*
	mšfo
)(
¡_¶ugš_vio
 *
	mvio
, 
¡_¶ugš_vio_šfo
 *info);

37 
MYSQL
 *
	mmysql
;

38 
auth_¶ugš_t
 *
	m¶ugš
;

39 cÚ¡ *
	mdb
;

41 
uch¬
 *
	mpkt
;

42 
ušt
 
	mpkt_Ën
;

43 } 
	mÿched_£rv”_»¶y
;

44 
ušt
 
	m·ck‘s_»ad
, 
	m·ck‘s_wr™‹n
;

45 
my_boÞ
 
	mmysql_chªge_u£r
;

46 
	mÏ¡_»ad_·ck‘_Ën
;

47 } 
	tMCPVIO_EXT
;

49 #iâdeà
PLUGIN_DYNAMIC


50 
¡_mysql_þ›Á_¶ugš_AUTHENTICATION
 
	gmysql_Þd_·sswÜd_þ›Á_¶ugš
=

52 
¡_mysql_þ›Á_¶ugš_AUTHENTICATION
 
_mysql_þ›Á_¶ugš_deþ¬©iÚ_
 =

55 
MYSQL_CLIENT_AUTHENTICATION_PLUGIN
,

56 
MYSQL_CLIENT_AUTHENTICATION_PLUGIN_INTERFACE_VERSION
,

62 
NULL
,

63 
NULL
,

64 
NULL
,

65 
NULL
,

66 
auth_Þd_·sswÜd


74 
	$auth_Þd_·sswÜd
(
MYSQL_PLUGIN_VIO
 *
vio
, 
MYSQL
 *
mysql
)

76 
uch¬
 *
pkt
;

77 
pkt_Ën
;

79 ià(((
MCPVIO_EXT
 *)
vio
)->
mysql_chªge_u£r
)

85 
pkt
ð(
uch¬
*)
mysql
->
süambË_buff
;

90 ià((
pkt_Ën
ð
vio
->
	`»ad_·ck‘
(vio, &
pkt
)) < 0)

91  
CR_ERROR
;

93 ià(
pkt_Ën
 !ð
SCRAMBLE_LENGTH_323
 + 1 &&

94 
pkt_Ën
 !ð
SCRAMBLE_LENGTH
 + 1)

95  
CR_SERVER_HANDSHAKE_ERR
;

98 
	`memmove
(
mysql
->
süambË_buff
, 
pkt
, 
pkt_Ën
 - 1);

99 
mysql
->
süambË_buff
[
pkt_Ën
 - 1] = 0;

102 ià(
mysql
 && mysql->
·sswd
[0])

104 
süambËd
[
SCRAMBLE_LENGTH_323
 + 1];

105 
	`ma_süambË_323
(
süambËd
, (*)
pkt
, 
mysql
->
·sswd
);

106 ià(
vio
->
	`wr™e_·ck‘
(vio, (
uch¬
*)
süambËd
, 
SCRAMBLE_LENGTH_323
 + 1))

107  
CR_ERROR
;

110 ià(
vio
->
	`wr™e_·ck‘
(vio, 0, 0))

111  
CR_ERROR
;

113  
CR_OK
;

114 
	}
}

	@plugins/auth/ref10/api.h

1 
	#CRYPTO_PUBLICKEYBYTES
 32

	)

2 
	#CRYPTO_BYTES
 64

	)

3 
	#CRYPTO_DETERMINISTIC
 1

	)

	@plugins/auth/ref10/base.h

	@plugins/auth/ref10/base2.h

	@plugins/auth/ref10/common.h

17 
	~<mysql.h
>

18 
	~<¡ršg.h
>

20 
	~"»f10/­i.h
"

21 
	~"üy±o_sign.h
"

23 
	#NONCE_BYTES
 32

	)

	@plugins/auth/ref10/crypto_hash_sha512.h

1 #ià
defšed
(
MYSQL_CLIENT
è|| defšed(
LIBMARIADB
)

2 
	~<ma_üy±.h
>

3 
	#üy±o_hash_sha512
(
DST
,
SRC
,
SLEN
è
	`ma_hash
(
MA_HASH_SHA512
, SRC, SLEN, DST)

	)

5 
	~<mysql/£rviû_sha2.h
>

6 
	#üy±o_hash_sha512
(
DST
,
SRC
,
SLEN
è
	`my_sha512
(DST,(*)(SRC),SLEN)

	)

	@plugins/auth/ref10/crypto_int32.h

1 
	~<¡dšt.h
>

2 
	~<sys/ty³s.h
>

3 
št32_t
 
	tüy±o_št32
;

5 
	#£Ëù
 
ed25519_£Ëù


	)

	@plugins/auth/ref10/crypto_int64.h

1 
	~<¡dšt.h
>

2 
	~<sys/ty³s.h
>

3 
št64_t
 
	tüy±o_št64
;

5 
	#£Ëù
 
ed25519_£Ëù


	)

	@plugins/auth/ref10/crypto_sign.h

1 
üy±o_sign_key·œ
(

2 *
pk
,

3 *
pw
, 
pwËn


5 
üy±o_sign
(

6 *
sm
,

7 cÚ¡ *
m
, 
mËn
,

8 cÚ¡ *
pw
, 
pwËn


10 
üy±o_sign_Ý’
(

11 *
sm
, 
smËn
,

12 cÚ¡ *
pk


	@plugins/auth/ref10/crypto_uint32.h

1 
	~<¡dšt.h
>

2 
	~<sys/ty³s.h
>

3 
ušt32_t
 
	tüy±o_ušt32
;

5 
	#£Ëù
 
ed25519_£Ëù


	)

	@plugins/auth/ref10/crypto_uint64.h

1 
	~<¡dšt.h
>

2 
	~<sys/ty³s.h
>

3 
ušt64_t
 
	tüy±o_ušt64
;

5 
	#£Ëù
 
ed25519_£Ëù


	)

	@plugins/auth/ref10/crypto_verify.h

1 
üy±o_v”ify
(cÚ¡ *
x
,cÚ¡ *
y
);

	@plugins/auth/ref10/crypto_verify_32.h

1 
	#üy±o_v”ify_32
 
üy±o_v”ify


	)

2 
üy±o_v”ify
(cÚ¡ *
x
,cÚ¡ *
y
);

	@plugins/auth/ref10/d.h

	@plugins/auth/ref10/d2.h

	@plugins/auth/ref10/fe.h

1 #iâdeà
FE_H


2 
	#FE_H


	)

4 
	~"üy±o_št32.h
"

6 
üy±o_št32
 
	tã
[10];

16 
	#ã_äomby‹s
 
üy±o_sign_ed25519_»f10_ã_äomby‹s


	)

17 
	#ã_toby‹s
 
üy±o_sign_ed25519_»f10_ã_toby‹s


	)

18 
	#ã_cÝy
 
üy±o_sign_ed25519_»f10_ã_cÝy


	)

19 
	#ã_i¢Úz”o
 
üy±o_sign_ed25519_»f10_ã_i¢Úz”o


	)

20 
	#ã_i¢eg©ive
 
üy±o_sign_ed25519_»f10_ã_i¢eg©ive


	)

21 
	#ã_0
 
üy±o_sign_ed25519_»f10_ã_0


	)

22 
	#ã_1
 
üy±o_sign_ed25519_»f10_ã_1


	)

23 
	#ã_csw­
 
üy±o_sign_ed25519_»f10_ã_csw­


	)

24 
	#ã_cmov
 
üy±o_sign_ed25519_»f10_ã_cmov


	)

25 
	#ã_add
 
üy±o_sign_ed25519_»f10_ã_add


	)

26 
	#ã_sub
 
üy±o_sign_ed25519_»f10_ã_sub


	)

27 
	#ã_Ãg
 
üy±o_sign_ed25519_»f10_ã_Ãg


	)

28 
	#ã_mul
 
üy±o_sign_ed25519_»f10_ã_mul


	)

29 
	#ã_sq
 
üy±o_sign_ed25519_»f10_ã_sq


	)

30 
	#ã_sq2
 
üy±o_sign_ed25519_»f10_ã_sq2


	)

31 
	#ã_mul121666
 
üy±o_sign_ed25519_»f10_ã_mul121666


	)

32 
	#ã_šv”t
 
üy±o_sign_ed25519_»f10_ã_šv”t


	)

33 
	#ã_pow22523
 
üy±o_sign_ed25519_»f10_ã_pow22523


	)

35 
ã_äomby‹s
(
ã
,const *);

36 
ã_toby‹s
(*,cÚ¡ 
ã
);

38 
ã_cÝy
(
ã
,const fe);

39 
ã_i¢Úz”o
(cÚ¡ 
ã
);

40 
ã_i¢eg©ive
(cÚ¡ 
ã
);

41 
ã_0
(
ã
);

42 
ã_1
(
ã
);

43 
ã_csw­
(
ã
,fe,);

44 
ã_cmov
(
ã
,const fe,);

46 
ã_add
(
ã
,const fe,const fe);

47 
ã_sub
(
ã
,const fe,const fe);

48 
ã_Ãg
(
ã
,const fe);

49 
ã_mul
(
ã
,const fe,const fe);

50 
ã_sq
(
ã
,const fe);

51 
ã_sq2
(
ã
,const fe);

52 
ã_mul121666
(
ã
,const fe);

53 
ã_šv”t
(
ã
,const fe);

54 
ã_pow22523
(
ã
,const fe);

	@plugins/auth/ref10/fe_0.c

1 
	~"ã.h
"

7 
	$ã_0
(
ã
 
h
)

9 
h
[0] = 0;

10 
h
[1] = 0;

11 
h
[2] = 0;

12 
h
[3] = 0;

13 
h
[4] = 0;

14 
h
[5] = 0;

15 
h
[6] = 0;

16 
h
[7] = 0;

17 
h
[8] = 0;

18 
h
[9] = 0;

19 
	}
}

	@plugins/auth/ref10/fe_1.c

1 
	~"ã.h
"

7 
	$ã_1
(
ã
 
h
)

9 
h
[0] = 1;

10 
h
[1] = 0;

11 
h
[2] = 0;

12 
h
[3] = 0;

13 
h
[4] = 0;

14 
h
[5] = 0;

15 
h
[6] = 0;

16 
h
[7] = 0;

17 
h
[8] = 0;

18 
h
[9] = 0;

19 
	}
}

	@plugins/auth/ref10/fe_add.c

1 
	~"ã.h
"

15 
	$ã_add
(
ã
 
h
,cÚ¡ f
f
,cÚ¡ f
g
)

17 
üy±o_št32
 
f0
 = 
f
[0];

18 
üy±o_št32
 
f1
 = 
f
[1];

19 
üy±o_št32
 
f2
 = 
f
[2];

20 
üy±o_št32
 
f3
 = 
f
[3];

21 
üy±o_št32
 
f4
 = 
f
[4];

22 
üy±o_št32
 
f5
 = 
f
[5];

23 
üy±o_št32
 
f6
 = 
f
[6];

24 
üy±o_št32
 
f7
 = 
f
[7];

25 
üy±o_št32
 
f8
 = 
f
[8];

26 
üy±o_št32
 
f9
 = 
f
[9];

27 
üy±o_št32
 
g0
 = 
g
[0];

28 
üy±o_št32
 
g1
 = 
g
[1];

29 
üy±o_št32
 
g2
 = 
g
[2];

30 
üy±o_št32
 
g3
 = 
g
[3];

31 
üy±o_št32
 
g4
 = 
g
[4];

32 
üy±o_št32
 
g5
 = 
g
[5];

33 
üy±o_št32
 
g6
 = 
g
[6];

34 
üy±o_št32
 
g7
 = 
g
[7];

35 
üy±o_št32
 
g8
 = 
g
[8];

36 
üy±o_št32
 
g9
 = 
g
[9];

37 
üy±o_št32
 
h0
 = 
f0
 + 
g0
;

38 
üy±o_št32
 
h1
 = 
f1
 + 
g1
;

39 
üy±o_št32
 
h2
 = 
f2
 + 
g2
;

40 
üy±o_št32
 
h3
 = 
f3
 + 
g3
;

41 
üy±o_št32
 
h4
 = 
f4
 + 
g4
;

42 
üy±o_št32
 
h5
 = 
f5
 + 
g5
;

43 
üy±o_št32
 
h6
 = 
f6
 + 
g6
;

44 
üy±o_št32
 
h7
 = 
f7
 + 
g7
;

45 
üy±o_št32
 
h8
 = 
f8
 + 
g8
;

46 
üy±o_št32
 
h9
 = 
f9
 + 
g9
;

47 
h
[0] = 
h0
;

48 
h
[1] = 
h1
;

49 
h
[2] = 
h2
;

50 
h
[3] = 
h3
;

51 
h
[4] = 
h4
;

52 
h
[5] = 
h5
;

53 
h
[6] = 
h6
;

54 
h
[7] = 
h7
;

55 
h
[8] = 
h8
;

56 
h
[9] = 
h9
;

57 
	}
}

	@plugins/auth/ref10/fe_cmov.c

1 
	~"ã.h
"

10 
	$ã_cmov
(
ã
 
f
,cÚ¡ f
g
,
b
)

12 
üy±o_št32
 
f0
 = 
f
[0];

13 
üy±o_št32
 
f1
 = 
f
[1];

14 
üy±o_št32
 
f2
 = 
f
[2];

15 
üy±o_št32
 
f3
 = 
f
[3];

16 
üy±o_št32
 
f4
 = 
f
[4];

17 
üy±o_št32
 
f5
 = 
f
[5];

18 
üy±o_št32
 
f6
 = 
f
[6];

19 
üy±o_št32
 
f7
 = 
f
[7];

20 
üy±o_št32
 
f8
 = 
f
[8];

21 
üy±o_št32
 
f9
 = 
f
[9];

22 
üy±o_št32
 
g0
 = 
g
[0];

23 
üy±o_št32
 
g1
 = 
g
[1];

24 
üy±o_št32
 
g2
 = 
g
[2];

25 
üy±o_št32
 
g3
 = 
g
[3];

26 
üy±o_št32
 
g4
 = 
g
[4];

27 
üy±o_št32
 
g5
 = 
g
[5];

28 
üy±o_št32
 
g6
 = 
g
[6];

29 
üy±o_št32
 
g7
 = 
g
[7];

30 
üy±o_št32
 
g8
 = 
g
[8];

31 
üy±o_št32
 
g9
 = 
g
[9];

32 
üy±o_št32
 
x0
 = 
f0
 ^ 
g0
;

33 
üy±o_št32
 
x1
 = 
f1
 ^ 
g1
;

34 
üy±o_št32
 
x2
 = 
f2
 ^ 
g2
;

35 
üy±o_št32
 
x3
 = 
f3
 ^ 
g3
;

36 
üy±o_št32
 
x4
 = 
f4
 ^ 
g4
;

37 
üy±o_št32
 
x5
 = 
f5
 ^ 
g5
;

38 
üy±o_št32
 
x6
 = 
f6
 ^ 
g6
;

39 
üy±o_št32
 
x7
 = 
f7
 ^ 
g7
;

40 
üy±o_št32
 
x8
 = 
f8
 ^ 
g8
;

41 
üy±o_št32
 
x9
 = 
f9
 ^ 
g9
;

42 
b
 = -b;

43 
x0
 &ð
b
;

44 
x1
 &ð
b
;

45 
x2
 &ð
b
;

46 
x3
 &ð
b
;

47 
x4
 &ð
b
;

48 
x5
 &ð
b
;

49 
x6
 &ð
b
;

50 
x7
 &ð
b
;

51 
x8
 &ð
b
;

52 
x9
 &ð
b
;

53 
f
[0] = 
f0
 ^ 
x0
;

54 
f
[1] = 
f1
 ^ 
x1
;

55 
f
[2] = 
f2
 ^ 
x2
;

56 
f
[3] = 
f3
 ^ 
x3
;

57 
f
[4] = 
f4
 ^ 
x4
;

58 
f
[5] = 
f5
 ^ 
x5
;

59 
f
[6] = 
f6
 ^ 
x6
;

60 
f
[7] = 
f7
 ^ 
x7
;

61 
f
[8] = 
f8
 ^ 
x8
;

62 
f
[9] = 
f9
 ^ 
x9
;

63 
	}
}

	@plugins/auth/ref10/fe_copy.c

1 
	~"ã.h
"

7 
	$ã_cÝy
(
ã
 
h
,cÚ¡ f
f
)

9 
üy±o_št32
 
f0
 = 
f
[0];

10 
üy±o_št32
 
f1
 = 
f
[1];

11 
üy±o_št32
 
f2
 = 
f
[2];

12 
üy±o_št32
 
f3
 = 
f
[3];

13 
üy±o_št32
 
f4
 = 
f
[4];

14 
üy±o_št32
 
f5
 = 
f
[5];

15 
üy±o_št32
 
f6
 = 
f
[6];

16 
üy±o_št32
 
f7
 = 
f
[7];

17 
üy±o_št32
 
f8
 = 
f
[8];

18 
üy±o_št32
 
f9
 = 
f
[9];

19 
h
[0] = 
f0
;

20 
h
[1] = 
f1
;

21 
h
[2] = 
f2
;

22 
h
[3] = 
f3
;

23 
h
[4] = 
f4
;

24 
h
[5] = 
f5
;

25 
h
[6] = 
f6
;

26 
h
[7] = 
f7
;

27 
h
[8] = 
f8
;

28 
h
[9] = 
f9
;

29 
	}
}

	@plugins/auth/ref10/fe_frombytes.c

1 
	~"ã.h
"

2 
	~"üy±o_št64.h
"

3 
	~"üy±o_ušt64.h
"

5 
üy±o_ušt64
 
	$lßd_3
(cÚ¡ *
š
)

7 
üy±o_ušt64
 
»suÉ
;

8 
»suÉ
 = (
üy±o_ušt64
è
š
[0];

9 
»suÉ
 |ð((
üy±o_ušt64
è
š
[1]) << 8;

10 
»suÉ
 |ð((
üy±o_ušt64
è
š
[2]) << 16;

11  
»suÉ
;

12 
	}
}

14 
üy±o_ušt64
 
	$lßd_4
(cÚ¡ *
š
)

16 
üy±o_ušt64
 
»suÉ
;

17 
»suÉ
 = (
üy±o_ušt64
è
š
[0];

18 
»suÉ
 |ð((
üy±o_ušt64
è
š
[1]) << 8;

19 
»suÉ
 |ð((
üy±o_ušt64
è
š
[2]) << 16;

20 
»suÉ
 |ð((
üy±o_ušt64
è
š
[3]) << 24;

21  
»suÉ
;

22 
	}
}

28 
	$ã_äomby‹s
(
ã
 
h
,cÚ¡ *
s
)

30 
üy±o_št64
 
h0
 = 
	`lßd_4
(
s
);

31 
üy±o_št64
 
h1
 = 
	`lßd_3
(
s
 + 4) << 6;

32 
üy±o_št64
 
h2
 = 
	`lßd_3
(
s
 + 7) << 5;

33 
üy±o_št64
 
h3
 = 
	`lßd_3
(
s
 + 10) << 3;

34 
üy±o_št64
 
h4
 = 
	`lßd_3
(
s
 + 13) << 2;

35 
üy±o_št64
 
h5
 = 
	`lßd_4
(
s
 + 16);

36 
üy±o_št64
 
h6
 = 
	`lßd_3
(
s
 + 20) << 7;

37 
üy±o_št64
 
h7
 = 
	`lßd_3
(
s
 + 23) << 5;

38 
üy±o_št64
 
h8
 = 
	`lßd_3
(
s
 + 26) << 4;

39 
üy±o_št64
 
h9
 = (
	`lßd_3
(
s
 + 29) & 8388607) << 2;

40 
üy±o_št64
 
ÿ¼y0
;

41 
üy±o_št64
 
ÿ¼y1
;

42 
üy±o_št64
 
ÿ¼y2
;

43 
üy±o_št64
 
ÿ¼y3
;

44 
üy±o_št64
 
ÿ¼y4
;

45 
üy±o_št64
 
ÿ¼y5
;

46 
üy±o_št64
 
ÿ¼y6
;

47 
üy±o_št64
 
ÿ¼y7
;

48 
üy±o_št64
 
ÿ¼y8
;

49 
üy±o_št64
 
ÿ¼y9
;

51 
ÿ¼y9
 = (
h9
 + (
üy±o_št64
è(1<<24)è>> 25; 
h0
 += carry9 * 19; h9 -= carry9 << 25;

52 
ÿ¼y1
 = (
h1
 + (
üy±o_št64
è(1<<24)è>> 25; 
h2
 += carry1; h1 -= carry1 << 25;

53 
ÿ¼y3
 = (
h3
 + (
üy±o_št64
è(1<<24)è>> 25; 
h4
 += carry3; h3 -= carry3 << 25;

54 
ÿ¼y5
 = (
h5
 + (
üy±o_št64
è(1<<24)è>> 25; 
h6
 += carry5; h5 -= carry5 << 25;

55 
ÿ¼y7
 = (
h7
 + (
üy±o_št64
è(1<<24)è>> 25; 
h8
 += carry7; h7 -= carry7 << 25;

57 
ÿ¼y0
 = (
h0
 + (
üy±o_št64
è(1<<25)è>> 26; 
h1
 += carry0; h0 -= carry0 << 26;

58 
ÿ¼y2
 = (
h2
 + (
üy±o_št64
è(1<<25)è>> 26; 
h3
 += carry2; h2 -= carry2 << 26;

59 
ÿ¼y4
 = (
h4
 + (
üy±o_št64
è(1<<25)è>> 26; 
h5
 += carry4; h4 -= carry4 << 26;

60 
ÿ¼y6
 = (
h6
 + (
üy±o_št64
è(1<<25)è>> 26; 
h7
 += carry6; h6 -= carry6 << 26;

61 
ÿ¼y8
 = (
h8
 + (
üy±o_št64
è(1<<25)è>> 26; 
h9
 += carry8; h8 -= carry8 << 26;

63 
h
[0] = 
h0
;

64 
h
[1] = 
h1
;

65 
h
[2] = 
h2
;

66 
h
[3] = 
h3
;

67 
h
[4] = 
h4
;

68 
h
[5] = 
h5
;

69 
h
[6] = 
h6
;

70 
h
[7] = 
h7
;

71 
h
[8] = 
h8
;

72 
h
[9] = 
h9
;

73 
	}
}

	@plugins/auth/ref10/fe_invert.c

1 
	~"ã.h
"

3 
	$ã_šv”t
(
ã
 
out
,cÚ¡ f
z
)

5 
ã
 
t0
;

6 
ã
 
t1
;

7 
ã
 
t2
;

8 
ã
 
t3
;

9 
i
;

11 
	~"pow225521.h
"

14 
	}
}

	@plugins/auth/ref10/fe_isnegative.c

1 
	~"ã.h
"

11 
	$ã_i¢eg©ive
(cÚ¡ 
ã
 
f
)

13 
s
[32];

14 
	`ã_toby‹s
(
s
,
f
);

15  
s
[0] & 1;

16 
	}
}

	@plugins/auth/ref10/fe_isnonzero.c

1 
	~"ã.h
"

2 
	~"üy±o_v”ify_32.h
"

12 cÚ¡ 
	gz”o
[32];

14 
	$ã_i¢Úz”o
(cÚ¡ 
ã
 
f
)

16 
s
[32];

17 
	`ã_toby‹s
(
s
,
f
);

18  
	`üy±o_v”ify_32
(
s
,
z”o
);

19 
	}
}

	@plugins/auth/ref10/fe_mul.c

1 
	~"ã.h
"

2 
	~"üy±o_št64.h
"

36 
	$ã_mul
(
ã
 
h
,cÚ¡ f
f
,cÚ¡ f
g
)

38 
üy±o_št32
 
f0
 = 
f
[0];

39 
üy±o_št32
 
f1
 = 
f
[1];

40 
üy±o_št32
 
f2
 = 
f
[2];

41 
üy±o_št32
 
f3
 = 
f
[3];

42 
üy±o_št32
 
f4
 = 
f
[4];

43 
üy±o_št32
 
f5
 = 
f
[5];

44 
üy±o_št32
 
f6
 = 
f
[6];

45 
üy±o_št32
 
f7
 = 
f
[7];

46 
üy±o_št32
 
f8
 = 
f
[8];

47 
üy±o_št32
 
f9
 = 
f
[9];

48 
üy±o_št32
 
g0
 = 
g
[0];

49 
üy±o_št32
 
g1
 = 
g
[1];

50 
üy±o_št32
 
g2
 = 
g
[2];

51 
üy±o_št32
 
g3
 = 
g
[3];

52 
üy±o_št32
 
g4
 = 
g
[4];

53 
üy±o_št32
 
g5
 = 
g
[5];

54 
üy±o_št32
 
g6
 = 
g
[6];

55 
üy±o_št32
 
g7
 = 
g
[7];

56 
üy±o_št32
 
g8
 = 
g
[8];

57 
üy±o_št32
 
g9
 = 
g
[9];

58 
üy±o_št32
 
g1_19
 = 19 * 
g1
;

59 
üy±o_št32
 
g2_19
 = 19 * 
g2
;

60 
üy±o_št32
 
g3_19
 = 19 * 
g3
;

61 
üy±o_št32
 
g4_19
 = 19 * 
g4
;

62 
üy±o_št32
 
g5_19
 = 19 * 
g5
;

63 
üy±o_št32
 
g6_19
 = 19 * 
g6
;

64 
üy±o_št32
 
g7_19
 = 19 * 
g7
;

65 
üy±o_št32
 
g8_19
 = 19 * 
g8
;

66 
üy±o_št32
 
g9_19
 = 19 * 
g9
;

67 
üy±o_št32
 
f1_2
 = 2 * 
f1
;

68 
üy±o_št32
 
f3_2
 = 2 * 
f3
;

69 
üy±o_št32
 
f5_2
 = 2 * 
f5
;

70 
üy±o_št32
 
f7_2
 = 2 * 
f7
;

71 
üy±o_št32
 
f9_2
 = 2 * 
f9
;

72 
üy±o_št64
 
f0g0
 = 
f0
 * (üy±o_št64è
g0
;

73 
üy±o_št64
 
f0g1
 = 
f0
 * (üy±o_št64è
g1
;

74 
üy±o_št64
 
f0g2
 = 
f0
 * (üy±o_št64è
g2
;

75 
üy±o_št64
 
f0g3
 = 
f0
 * (üy±o_št64è
g3
;

76 
üy±o_št64
 
f0g4
 = 
f0
 * (üy±o_št64è
g4
;

77 
üy±o_št64
 
f0g5
 = 
f0
 * (üy±o_št64è
g5
;

78 
üy±o_št64
 
f0g6
 = 
f0
 * (üy±o_št64è
g6
;

79 
üy±o_št64
 
f0g7
 = 
f0
 * (üy±o_št64è
g7
;

80 
üy±o_št64
 
f0g8
 = 
f0
 * (üy±o_št64è
g8
;

81 
üy±o_št64
 
f0g9
 = 
f0
 * (üy±o_št64è
g9
;

82 
üy±o_št64
 
f1g0
 = 
f1
 * (üy±o_št64è
g0
;

83 
üy±o_št64
 
f1g1_2
 = 
f1_2
 * (üy±o_št64è
g1
;

84 
üy±o_št64
 
f1g2
 = 
f1
 * (üy±o_št64è
g2
;

85 
üy±o_št64
 
f1g3_2
 = 
f1_2
 * (üy±o_št64è
g3
;

86 
üy±o_št64
 
f1g4
 = 
f1
 * (üy±o_št64è
g4
;

87 
üy±o_št64
 
f1g5_2
 = 
f1_2
 * (üy±o_št64è
g5
;

88 
üy±o_št64
 
f1g6
 = 
f1
 * (üy±o_št64è
g6
;

89 
üy±o_št64
 
f1g7_2
 = 
f1_2
 * (üy±o_št64è
g7
;

90 
üy±o_št64
 
f1g8
 = 
f1
 * (üy±o_št64è
g8
;

91 
üy±o_št64
 
f1g9_38
 = 
f1_2
 * (üy±o_št64è
g9_19
;

92 
üy±o_št64
 
f2g0
 = 
f2
 * (üy±o_št64è
g0
;

93 
üy±o_št64
 
f2g1
 = 
f2
 * (üy±o_št64è
g1
;

94 
üy±o_št64
 
f2g2
 = 
f2
 * (üy±o_št64è
g2
;

95 
üy±o_št64
 
f2g3
 = 
f2
 * (üy±o_št64è
g3
;

96 
üy±o_št64
 
f2g4
 = 
f2
 * (üy±o_št64è
g4
;

97 
üy±o_št64
 
f2g5
 = 
f2
 * (üy±o_št64è
g5
;

98 
üy±o_št64
 
f2g6
 = 
f2
 * (üy±o_št64è
g6
;

99 
üy±o_št64
 
f2g7
 = 
f2
 * (üy±o_št64è
g7
;

100 
üy±o_št64
 
f2g8_19
 = 
f2
 * (üy±o_št64è
g8_19
;

101 
üy±o_št64
 
f2g9_19
 = 
f2
 * (üy±o_št64è
g9_19
;

102 
üy±o_št64
 
f3g0
 = 
f3
 * (üy±o_št64è
g0
;

103 
üy±o_št64
 
f3g1_2
 = 
f3_2
 * (üy±o_št64è
g1
;

104 
üy±o_št64
 
f3g2
 = 
f3
 * (üy±o_št64è
g2
;

105 
üy±o_št64
 
f3g3_2
 = 
f3_2
 * (üy±o_št64è
g3
;

106 
üy±o_št64
 
f3g4
 = 
f3
 * (üy±o_št64è
g4
;

107 
üy±o_št64
 
f3g5_2
 = 
f3_2
 * (üy±o_št64è
g5
;

108 
üy±o_št64
 
f3g6
 = 
f3
 * (üy±o_št64è
g6
;

109 
üy±o_št64
 
f3g7_38
 = 
f3_2
 * (üy±o_št64è
g7_19
;

110 
üy±o_št64
 
f3g8_19
 = 
f3
 * (üy±o_št64è
g8_19
;

111 
üy±o_št64
 
f3g9_38
 = 
f3_2
 * (üy±o_št64è
g9_19
;

112 
üy±o_št64
 
f4g0
 = 
f4
 * (üy±o_št64è
g0
;

113 
üy±o_št64
 
f4g1
 = 
f4
 * (üy±o_št64è
g1
;

114 
üy±o_št64
 
f4g2
 = 
f4
 * (üy±o_št64è
g2
;

115 
üy±o_št64
 
f4g3
 = 
f4
 * (üy±o_št64è
g3
;

116 
üy±o_št64
 
f4g4
 = 
f4
 * (üy±o_št64è
g4
;

117 
üy±o_št64
 
f4g5
 = 
f4
 * (üy±o_št64è
g5
;

118 
üy±o_št64
 
f4g6_19
 = 
f4
 * (üy±o_št64è
g6_19
;

119 
üy±o_št64
 
f4g7_19
 = 
f4
 * (üy±o_št64è
g7_19
;

120 
üy±o_št64
 
f4g8_19
 = 
f4
 * (üy±o_št64è
g8_19
;

121 
üy±o_št64
 
f4g9_19
 = 
f4
 * (üy±o_št64è
g9_19
;

122 
üy±o_št64
 
f5g0
 = 
f5
 * (üy±o_št64è
g0
;

123 
üy±o_št64
 
f5g1_2
 = 
f5_2
 * (üy±o_št64è
g1
;

124 
üy±o_št64
 
f5g2
 = 
f5
 * (üy±o_št64è
g2
;

125 
üy±o_št64
 
f5g3_2
 = 
f5_2
 * (üy±o_št64è
g3
;

126 
üy±o_št64
 
f5g4
 = 
f5
 * (üy±o_št64è
g4
;

127 
üy±o_št64
 
f5g5_38
 = 
f5_2
 * (üy±o_št64è
g5_19
;

128 
üy±o_št64
 
f5g6_19
 = 
f5
 * (üy±o_št64è
g6_19
;

129 
üy±o_št64
 
f5g7_38
 = 
f5_2
 * (üy±o_št64è
g7_19
;

130 
üy±o_št64
 
f5g8_19
 = 
f5
 * (üy±o_št64è
g8_19
;

131 
üy±o_št64
 
f5g9_38
 = 
f5_2
 * (üy±o_št64è
g9_19
;

132 
üy±o_št64
 
f6g0
 = 
f6
 * (üy±o_št64è
g0
;

133 
üy±o_št64
 
f6g1
 = 
f6
 * (üy±o_št64è
g1
;

134 
üy±o_št64
 
f6g2
 = 
f6
 * (üy±o_št64è
g2
;

135 
üy±o_št64
 
f6g3
 = 
f6
 * (üy±o_št64è
g3
;

136 
üy±o_št64
 
f6g4_19
 = 
f6
 * (üy±o_št64è
g4_19
;

137 
üy±o_št64
 
f6g5_19
 = 
f6
 * (üy±o_št64è
g5_19
;

138 
üy±o_št64
 
f6g6_19
 = 
f6
 * (üy±o_št64è
g6_19
;

139 
üy±o_št64
 
f6g7_19
 = 
f6
 * (üy±o_št64è
g7_19
;

140 
üy±o_št64
 
f6g8_19
 = 
f6
 * (üy±o_št64è
g8_19
;

141 
üy±o_št64
 
f6g9_19
 = 
f6
 * (üy±o_št64è
g9_19
;

142 
üy±o_št64
 
f7g0
 = 
f7
 * (üy±o_št64è
g0
;

143 
üy±o_št64
 
f7g1_2
 = 
f7_2
 * (üy±o_št64è
g1
;

144 
üy±o_št64
 
f7g2
 = 
f7
 * (üy±o_št64è
g2
;

145 
üy±o_št64
 
f7g3_38
 = 
f7_2
 * (üy±o_št64è
g3_19
;

146 
üy±o_št64
 
f7g4_19
 = 
f7
 * (üy±o_št64è
g4_19
;

147 
üy±o_št64
 
f7g5_38
 = 
f7_2
 * (üy±o_št64è
g5_19
;

148 
üy±o_št64
 
f7g6_19
 = 
f7
 * (üy±o_št64è
g6_19
;

149 
üy±o_št64
 
f7g7_38
 = 
f7_2
 * (üy±o_št64è
g7_19
;

150 
üy±o_št64
 
f7g8_19
 = 
f7
 * (üy±o_št64è
g8_19
;

151 
üy±o_št64
 
f7g9_38
 = 
f7_2
 * (üy±o_št64è
g9_19
;

152 
üy±o_št64
 
f8g0
 = 
f8
 * (üy±o_št64è
g0
;

153 
üy±o_št64
 
f8g1
 = 
f8
 * (üy±o_št64è
g1
;

154 
üy±o_št64
 
f8g2_19
 = 
f8
 * (üy±o_št64è
g2_19
;

155 
üy±o_št64
 
f8g3_19
 = 
f8
 * (üy±o_št64è
g3_19
;

156 
üy±o_št64
 
f8g4_19
 = 
f8
 * (üy±o_št64è
g4_19
;

157 
üy±o_št64
 
f8g5_19
 = 
f8
 * (üy±o_št64è
g5_19
;

158 
üy±o_št64
 
f8g6_19
 = 
f8
 * (üy±o_št64è
g6_19
;

159 
üy±o_št64
 
f8g7_19
 = 
f8
 * (üy±o_št64è
g7_19
;

160 
üy±o_št64
 
f8g8_19
 = 
f8
 * (üy±o_št64è
g8_19
;

161 
üy±o_št64
 
f8g9_19
 = 
f8
 * (üy±o_št64è
g9_19
;

162 
üy±o_št64
 
f9g0
 = 
f9
 * (üy±o_št64è
g0
;

163 
üy±o_št64
 
f9g1_38
 = 
f9_2
 * (üy±o_št64è
g1_19
;

164 
üy±o_št64
 
f9g2_19
 = 
f9
 * (üy±o_št64è
g2_19
;

165 
üy±o_št64
 
f9g3_38
 = 
f9_2
 * (üy±o_št64è
g3_19
;

166 
üy±o_št64
 
f9g4_19
 = 
f9
 * (üy±o_št64è
g4_19
;

167 
üy±o_št64
 
f9g5_38
 = 
f9_2
 * (üy±o_št64è
g5_19
;

168 
üy±o_št64
 
f9g6_19
 = 
f9
 * (üy±o_št64è
g6_19
;

169 
üy±o_št64
 
f9g7_38
 = 
f9_2
 * (üy±o_št64è
g7_19
;

170 
üy±o_št64
 
f9g8_19
 = 
f9
 * (üy±o_št64è
g8_19
;

171 
üy±o_št64
 
f9g9_38
 = 
f9_2
 * (üy±o_št64è
g9_19
;

172 
üy±o_št64
 
h0
 = 
f0g0
+
f1g9_38
+
f2g8_19
+
f3g7_38
+
f4g6_19
+
f5g5_38
+
f6g4_19
+
f7g3_38
+
f8g2_19
+
f9g1_38
;

173 
üy±o_št64
 
h1
 = 
f0g1
+
f1g0
 +
f2g9_19
+
f3g8_19
+
f4g7_19
+
f5g6_19
+
f6g5_19
+
f7g4_19
+
f8g3_19
+
f9g2_19
;

174 
üy±o_št64
 
h2
 = 
f0g2
+
f1g1_2
 +
f2g0
 +
f3g9_38
+
f4g8_19
+
f5g7_38
+
f6g6_19
+
f7g5_38
+
f8g4_19
+
f9g3_38
;

175 
üy±o_št64
 
h3
 = 
f0g3
+
f1g2
 +
f2g1
 +
f3g0
 +
f4g9_19
+
f5g8_19
+
f6g7_19
+
f7g6_19
+
f8g5_19
+
f9g4_19
;

176 
üy±o_št64
 
h4
 = 
f0g4
+
f1g3_2
 +
f2g2
 +
f3g1_2
 +
f4g0
 +
f5g9_38
+
f6g8_19
+
f7g7_38
+
f8g6_19
+
f9g5_38
;

177 
üy±o_št64
 
h5
 = 
f0g5
+
f1g4
 +
f2g3
 +
f3g2
 +
f4g1
 +
f5g0
 +
f6g9_19
+
f7g8_19
+
f8g7_19
+
f9g6_19
;

178 
üy±o_št64
 
h6
 = 
f0g6
+
f1g5_2
 +
f2g4
 +
f3g3_2
 +
f4g2
 +
f5g1_2
 +
f6g0
 +
f7g9_38
+
f8g8_19
+
f9g7_38
;

179 
üy±o_št64
 
h7
 = 
f0g7
+
f1g6
 +
f2g5
 +
f3g4
 +
f4g3
 +
f5g2
 +
f6g1
 +
f7g0
 +
f8g9_19
+
f9g8_19
;

180 
üy±o_št64
 
h8
 = 
f0g8
+
f1g7_2
 +
f2g6
 +
f3g5_2
 +
f4g4
 +
f5g3_2
 +
f6g2
 +
f7g1_2
 +
f8g0
 +
f9g9_38
;

181 
üy±o_št64
 
h9
 = 
f0g9
+
f1g8
 +
f2g7
 +
f3g6
 +
f4g5
 +
f5g4
 +
f6g3
 +
f7g2
 +
f8g1
 +
f9g0
 ;

182 
üy±o_št64
 
ÿ¼y0
;

183 
üy±o_št64
 
ÿ¼y1
;

184 
üy±o_št64
 
ÿ¼y2
;

185 
üy±o_št64
 
ÿ¼y3
;

186 
üy±o_št64
 
ÿ¼y4
;

187 
üy±o_št64
 
ÿ¼y5
;

188 
üy±o_št64
 
ÿ¼y6
;

189 
üy±o_št64
 
ÿ¼y7
;

190 
üy±o_št64
 
ÿ¼y8
;

191 
üy±o_št64
 
ÿ¼y9
;

200 
ÿ¼y0
 = (
h0
 + (
üy±o_št64
è(1<<25)è>> 26; 
h1
 += carry0; h0 -= carry0 << 26;

201 
ÿ¼y4
 = (
h4
 + (
üy±o_št64
è(1<<25)è>> 26; 
h5
 += carry4; h4 -= carry4 << 26;

207 
ÿ¼y1
 = (
h1
 + (
üy±o_št64
è(1<<24)è>> 25; 
h2
 += carry1; h1 -= carry1 << 25;

208 
ÿ¼y5
 = (
h5
 + (
üy±o_št64
è(1<<24)è>> 25; 
h6
 += carry5; h5 -= carry5 << 25;

214 
ÿ¼y2
 = (
h2
 + (
üy±o_št64
è(1<<25)è>> 26; 
h3
 += carry2; h2 -= carry2 << 26;

215 
ÿ¼y6
 = (
h6
 + (
üy±o_št64
è(1<<25)è>> 26; 
h7
 += carry6; h6 -= carry6 << 26;

221 
ÿ¼y3
 = (
h3
 + (
üy±o_št64
è(1<<24)è>> 25; 
h4
 += carry3; h3 -= carry3 << 25;

222 
ÿ¼y7
 = (
h7
 + (
üy±o_št64
è(1<<24)è>> 25; 
h8
 += carry7; h7 -= carry7 << 25;

228 
ÿ¼y4
 = (
h4
 + (
üy±o_št64
è(1<<25)è>> 26; 
h5
 += carry4; h4 -= carry4 << 26;

229 
ÿ¼y8
 = (
h8
 + (
üy±o_št64
è(1<<25)è>> 26; 
h9
 += carry8; h8 -= carry8 << 26;

235 
ÿ¼y9
 = (
h9
 + (
üy±o_št64
è(1<<24)è>> 25; 
h0
 += carry9 * 19; h9 -= carry9 << 25;

239 
ÿ¼y0
 = (
h0
 + (
üy±o_št64
è(1<<25)è>> 26; 
h1
 += carry0; h0 -= carry0 << 26;

243 
h
[0] = 
h0
;

244 
h
[1] = 
h1
;

245 
h
[2] = 
h2
;

246 
h
[3] = 
h3
;

247 
h
[4] = 
h4
;

248 
h
[5] = 
h5
;

249 
h
[6] = 
h6
;

250 
h
[7] = 
h7
;

251 
h
[8] = 
h8
;

252 
h
[9] = 
h9
;

253 
	}
}

	@plugins/auth/ref10/fe_neg.c

1 
	~"ã.h
"

13 
	$ã_Ãg
(
ã
 
h
,cÚ¡ f
f
)

15 
üy±o_št32
 
f0
 = 
f
[0];

16 
üy±o_št32
 
f1
 = 
f
[1];

17 
üy±o_št32
 
f2
 = 
f
[2];

18 
üy±o_št32
 
f3
 = 
f
[3];

19 
üy±o_št32
 
f4
 = 
f
[4];

20 
üy±o_št32
 
f5
 = 
f
[5];

21 
üy±o_št32
 
f6
 = 
f
[6];

22 
üy±o_št32
 
f7
 = 
f
[7];

23 
üy±o_št32
 
f8
 = 
f
[8];

24 
üy±o_št32
 
f9
 = 
f
[9];

25 
üy±o_št32
 
h0
 = -
f0
;

26 
üy±o_št32
 
h1
 = -
f1
;

27 
üy±o_št32
 
h2
 = -
f2
;

28 
üy±o_št32
 
h3
 = -
f3
;

29 
üy±o_št32
 
h4
 = -
f4
;

30 
üy±o_št32
 
h5
 = -
f5
;

31 
üy±o_št32
 
h6
 = -
f6
;

32 
üy±o_št32
 
h7
 = -
f7
;

33 
üy±o_št32
 
h8
 = -
f8
;

34 
üy±o_št32
 
h9
 = -
f9
;

35 
h
[0] = 
h0
;

36 
h
[1] = 
h1
;

37 
h
[2] = 
h2
;

38 
h
[3] = 
h3
;

39 
h
[4] = 
h4
;

40 
h
[5] = 
h5
;

41 
h
[6] = 
h6
;

42 
h
[7] = 
h7
;

43 
h
[8] = 
h8
;

44 
h
[9] = 
h9
;

45 
	}
}

	@plugins/auth/ref10/fe_pow22523.c

1 
	~"ã.h
"

3 
	$ã_pow22523
(
ã
 
out
,cÚ¡ f
z
)

5 
ã
 
t0
;

6 
ã
 
t1
;

7 
ã
 
t2
;

8 
i
;

10 
	~"pow22523.h
"

13 
	}
}

	@plugins/auth/ref10/fe_sq.c

1 
	~"ã.h
"

2 
	~"üy±o_št64.h
"

19 
	$ã_sq
(
ã
 
h
,cÚ¡ f
f
)

21 
üy±o_št32
 
f0
 = 
f
[0];

22 
üy±o_št32
 
f1
 = 
f
[1];

23 
üy±o_št32
 
f2
 = 
f
[2];

24 
üy±o_št32
 
f3
 = 
f
[3];

25 
üy±o_št32
 
f4
 = 
f
[4];

26 
üy±o_št32
 
f5
 = 
f
[5];

27 
üy±o_št32
 
f6
 = 
f
[6];

28 
üy±o_št32
 
f7
 = 
f
[7];

29 
üy±o_št32
 
f8
 = 
f
[8];

30 
üy±o_št32
 
f9
 = 
f
[9];

31 
üy±o_št32
 
f0_2
 = 2 * 
f0
;

32 
üy±o_št32
 
f1_2
 = 2 * 
f1
;

33 
üy±o_št32
 
f2_2
 = 2 * 
f2
;

34 
üy±o_št32
 
f3_2
 = 2 * 
f3
;

35 
üy±o_št32
 
f4_2
 = 2 * 
f4
;

36 
üy±o_št32
 
f5_2
 = 2 * 
f5
;

37 
üy±o_št32
 
f6_2
 = 2 * 
f6
;

38 
üy±o_št32
 
f7_2
 = 2 * 
f7
;

39 
üy±o_št32
 
f5_38
 = 38 * 
f5
;

40 
üy±o_št32
 
f6_19
 = 19 * 
f6
;

41 
üy±o_št32
 
f7_38
 = 38 * 
f7
;

42 
üy±o_št32
 
f8_19
 = 19 * 
f8
;

43 
üy±o_št32
 
f9_38
 = 38 * 
f9
;

44 
üy±o_št64
 
f0f0
 = 
f0
 * (crypto_int64) f0;

45 
üy±o_št64
 
f0f1_2
 = 
f0_2
 * (üy±o_št64è
f1
;

46 
üy±o_št64
 
f0f2_2
 = 
f0_2
 * (üy±o_št64è
f2
;

47 
üy±o_št64
 
f0f3_2
 = 
f0_2
 * (üy±o_št64è
f3
;

48 
üy±o_št64
 
f0f4_2
 = 
f0_2
 * (üy±o_št64è
f4
;

49 
üy±o_št64
 
f0f5_2
 = 
f0_2
 * (üy±o_št64è
f5
;

50 
üy±o_št64
 
f0f6_2
 = 
f0_2
 * (üy±o_št64è
f6
;

51 
üy±o_št64
 
f0f7_2
 = 
f0_2
 * (üy±o_št64è
f7
;

52 
üy±o_št64
 
f0f8_2
 = 
f0_2
 * (üy±o_št64è
f8
;

53 
üy±o_št64
 
f0f9_2
 = 
f0_2
 * (üy±o_št64è
f9
;

54 
üy±o_št64
 
f1f1_2
 = 
f1_2
 * (üy±o_št64è
f1
;

55 
üy±o_št64
 
f1f2_2
 = 
f1_2
 * (üy±o_št64è
f2
;

56 
üy±o_št64
 
f1f3_4
 = 
f1_2
 * (üy±o_št64è
f3_2
;

57 
üy±o_št64
 
f1f4_2
 = 
f1_2
 * (üy±o_št64è
f4
;

58 
üy±o_št64
 
f1f5_4
 = 
f1_2
 * (üy±o_št64è
f5_2
;

59 
üy±o_št64
 
f1f6_2
 = 
f1_2
 * (üy±o_št64è
f6
;

60 
üy±o_št64
 
f1f7_4
 = 
f1_2
 * (üy±o_št64è
f7_2
;

61 
üy±o_št64
 
f1f8_2
 = 
f1_2
 * (üy±o_št64è
f8
;

62 
üy±o_št64
 
f1f9_76
 = 
f1_2
 * (üy±o_št64è
f9_38
;

63 
üy±o_št64
 
f2f2
 = 
f2
 * (crypto_int64) f2;

64 
üy±o_št64
 
f2f3_2
 = 
f2_2
 * (üy±o_št64è
f3
;

65 
üy±o_št64
 
f2f4_2
 = 
f2_2
 * (üy±o_št64è
f4
;

66 
üy±o_št64
 
f2f5_2
 = 
f2_2
 * (üy±o_št64è
f5
;

67 
üy±o_št64
 
f2f6_2
 = 
f2_2
 * (üy±o_št64è
f6
;

68 
üy±o_št64
 
f2f7_2
 = 
f2_2
 * (üy±o_št64è
f7
;

69 
üy±o_št64
 
f2f8_38
 = 
f2_2
 * (üy±o_št64è
f8_19
;

70 
üy±o_št64
 
f2f9_38
 = 
f2
 * (üy±o_št64è
f9_38
;

71 
üy±o_št64
 
f3f3_2
 = 
f3_2
 * (üy±o_št64è
f3
;

72 
üy±o_št64
 
f3f4_2
 = 
f3_2
 * (üy±o_št64è
f4
;

73 
üy±o_št64
 
f3f5_4
 = 
f3_2
 * (üy±o_št64è
f5_2
;

74 
üy±o_št64
 
f3f6_2
 = 
f3_2
 * (üy±o_št64è
f6
;

75 
üy±o_št64
 
f3f7_76
 = 
f3_2
 * (üy±o_št64è
f7_38
;

76 
üy±o_št64
 
f3f8_38
 = 
f3_2
 * (üy±o_št64è
f8_19
;

77 
üy±o_št64
 
f3f9_76
 = 
f3_2
 * (üy±o_št64è
f9_38
;

78 
üy±o_št64
 
f4f4
 = 
f4
 * (crypto_int64) f4;

79 
üy±o_št64
 
f4f5_2
 = 
f4_2
 * (üy±o_št64è
f5
;

80 
üy±o_št64
 
f4f6_38
 = 
f4_2
 * (üy±o_št64è
f6_19
;

81 
üy±o_št64
 
f4f7_38
 = 
f4
 * (üy±o_št64è
f7_38
;

82 
üy±o_št64
 
f4f8_38
 = 
f4_2
 * (üy±o_št64è
f8_19
;

83 
üy±o_št64
 
f4f9_38
 = 
f4
 * (üy±o_št64è
f9_38
;

84 
üy±o_št64
 
f5f5_38
 = 
f5
 * (üy±o_št64è
f5_38
;

85 
üy±o_št64
 
f5f6_38
 = 
f5_2
 * (üy±o_št64è
f6_19
;

86 
üy±o_št64
 
f5f7_76
 = 
f5_2
 * (üy±o_št64è
f7_38
;

87 
üy±o_št64
 
f5f8_38
 = 
f5_2
 * (üy±o_št64è
f8_19
;

88 
üy±o_št64
 
f5f9_76
 = 
f5_2
 * (üy±o_št64è
f9_38
;

89 
üy±o_št64
 
f6f6_19
 = 
f6
 * (üy±o_št64è
f6_19
;

90 
üy±o_št64
 
f6f7_38
 = 
f6
 * (üy±o_št64è
f7_38
;

91 
üy±o_št64
 
f6f8_38
 = 
f6_2
 * (üy±o_št64è
f8_19
;

92 
üy±o_št64
 
f6f9_38
 = 
f6
 * (üy±o_št64è
f9_38
;

93 
üy±o_št64
 
f7f7_38
 = 
f7
 * (üy±o_št64è
f7_38
;

94 
üy±o_št64
 
f7f8_38
 = 
f7_2
 * (üy±o_št64è
f8_19
;

95 
üy±o_št64
 
f7f9_76
 = 
f7_2
 * (üy±o_št64è
f9_38
;

96 
üy±o_št64
 
f8f8_19
 = 
f8
 * (üy±o_št64è
f8_19
;

97 
üy±o_št64
 
f8f9_38
 = 
f8
 * (üy±o_št64è
f9_38
;

98 
üy±o_št64
 
f9f9_38
 = 
f9
 * (üy±o_št64è
f9_38
;

99 
üy±o_št64
 
h0
 = 
f0f0
 +
f1f9_76
+
f2f8_38
+
f3f7_76
+
f4f6_38
+
f5f5_38
;

100 
üy±o_št64
 
h1
 = 
f0f1_2
+
f2f9_38
+
f3f8_38
+
f4f7_38
+
f5f6_38
;

101 
üy±o_št64
 
h2
 = 
f0f2_2
+
f1f1_2
 +
f3f9_76
+
f4f8_38
+
f5f7_76
+
f6f6_19
;

102 
üy±o_št64
 
h3
 = 
f0f3_2
+
f1f2_2
 +
f4f9_38
+
f5f8_38
+
f6f7_38
;

103 
üy±o_št64
 
h4
 = 
f0f4_2
+
f1f3_4
 +
f2f2
 +
f5f9_76
+
f6f8_38
+
f7f7_38
;

104 
üy±o_št64
 
h5
 = 
f0f5_2
+
f1f4_2
 +
f2f3_2
 +
f6f9_38
+
f7f8_38
;

105 
üy±o_št64
 
h6
 = 
f0f6_2
+
f1f5_4
 +
f2f4_2
 +
f3f3_2
 +
f7f9_76
+
f8f8_19
;

106 
üy±o_št64
 
h7
 = 
f0f7_2
+
f1f6_2
 +
f2f5_2
 +
f3f4_2
 +
f8f9_38
;

107 
üy±o_št64
 
h8
 = 
f0f8_2
+
f1f7_4
 +
f2f6_2
 +
f3f5_4
 +
f4f4
 +
f9f9_38
;

108 
üy±o_št64
 
h9
 = 
f0f9_2
+
f1f8_2
 +
f2f7_2
 +
f3f6_2
 +
f4f5_2
;

109 
üy±o_št64
 
ÿ¼y0
;

110 
üy±o_št64
 
ÿ¼y1
;

111 
üy±o_št64
 
ÿ¼y2
;

112 
üy±o_št64
 
ÿ¼y3
;

113 
üy±o_št64
 
ÿ¼y4
;

114 
üy±o_št64
 
ÿ¼y5
;

115 
üy±o_št64
 
ÿ¼y6
;

116 
üy±o_št64
 
ÿ¼y7
;

117 
üy±o_št64
 
ÿ¼y8
;

118 
üy±o_št64
 
ÿ¼y9
;

120 
ÿ¼y0
 = (
h0
 + (
üy±o_št64
è(1<<25)è>> 26; 
h1
 += carry0; h0 -= carry0 << 26;

121 
ÿ¼y4
 = (
h4
 + (
üy±o_št64
è(1<<25)è>> 26; 
h5
 += carry4; h4 -= carry4 << 26;

123 
ÿ¼y1
 = (
h1
 + (
üy±o_št64
è(1<<24)è>> 25; 
h2
 += carry1; h1 -= carry1 << 25;

124 
ÿ¼y5
 = (
h5
 + (
üy±o_št64
è(1<<24)è>> 25; 
h6
 += carry5; h5 -= carry5 << 25;

126 
ÿ¼y2
 = (
h2
 + (
üy±o_št64
è(1<<25)è>> 26; 
h3
 += carry2; h2 -= carry2 << 26;

127 
ÿ¼y6
 = (
h6
 + (
üy±o_št64
è(1<<25)è>> 26; 
h7
 += carry6; h6 -= carry6 << 26;

129 
ÿ¼y3
 = (
h3
 + (
üy±o_št64
è(1<<24)è>> 25; 
h4
 += carry3; h3 -= carry3 << 25;

130 
ÿ¼y7
 = (
h7
 + (
üy±o_št64
è(1<<24)è>> 25; 
h8
 += carry7; h7 -= carry7 << 25;

132 
ÿ¼y4
 = (
h4
 + (
üy±o_št64
è(1<<25)è>> 26; 
h5
 += carry4; h4 -= carry4 << 26;

133 
ÿ¼y8
 = (
h8
 + (
üy±o_št64
è(1<<25)è>> 26; 
h9
 += carry8; h8 -= carry8 << 26;

135 
ÿ¼y9
 = (
h9
 + (
üy±o_št64
è(1<<24)è>> 25; 
h0
 += carry9 * 19; h9 -= carry9 << 25;

137 
ÿ¼y0
 = (
h0
 + (
üy±o_št64
è(1<<25)è>> 26; 
h1
 += carry0; h0 -= carry0 << 26;

139 
h
[0] = 
h0
;

140 
h
[1] = 
h1
;

141 
h
[2] = 
h2
;

142 
h
[3] = 
h3
;

143 
h
[4] = 
h4
;

144 
h
[5] = 
h5
;

145 
h
[6] = 
h6
;

146 
h
[7] = 
h7
;

147 
h
[8] = 
h8
;

148 
h
[9] = 
h9
;

149 
	}
}

	@plugins/auth/ref10/fe_sq2.c

1 
	~"ã.h
"

2 
	~"üy±o_št64.h
"

19 
	$ã_sq2
(
ã
 
h
,cÚ¡ f
f
)

21 
üy±o_št32
 
f0
 = 
f
[0];

22 
üy±o_št32
 
f1
 = 
f
[1];

23 
üy±o_št32
 
f2
 = 
f
[2];

24 
üy±o_št32
 
f3
 = 
f
[3];

25 
üy±o_št32
 
f4
 = 
f
[4];

26 
üy±o_št32
 
f5
 = 
f
[5];

27 
üy±o_št32
 
f6
 = 
f
[6];

28 
üy±o_št32
 
f7
 = 
f
[7];

29 
üy±o_št32
 
f8
 = 
f
[8];

30 
üy±o_št32
 
f9
 = 
f
[9];

31 
üy±o_št32
 
f0_2
 = 2 * 
f0
;

32 
üy±o_št32
 
f1_2
 = 2 * 
f1
;

33 
üy±o_št32
 
f2_2
 = 2 * 
f2
;

34 
üy±o_št32
 
f3_2
 = 2 * 
f3
;

35 
üy±o_št32
 
f4_2
 = 2 * 
f4
;

36 
üy±o_št32
 
f5_2
 = 2 * 
f5
;

37 
üy±o_št32
 
f6_2
 = 2 * 
f6
;

38 
üy±o_št32
 
f7_2
 = 2 * 
f7
;

39 
üy±o_št32
 
f5_38
 = 38 * 
f5
;

40 
üy±o_št32
 
f6_19
 = 19 * 
f6
;

41 
üy±o_št32
 
f7_38
 = 38 * 
f7
;

42 
üy±o_št32
 
f8_19
 = 19 * 
f8
;

43 
üy±o_št32
 
f9_38
 = 38 * 
f9
;

44 
üy±o_št64
 
f0f0
 = 
f0
 * (crypto_int64) f0;

45 
üy±o_št64
 
f0f1_2
 = 
f0_2
 * (üy±o_št64è
f1
;

46 
üy±o_št64
 
f0f2_2
 = 
f0_2
 * (üy±o_št64è
f2
;

47 
üy±o_št64
 
f0f3_2
 = 
f0_2
 * (üy±o_št64è
f3
;

48 
üy±o_št64
 
f0f4_2
 = 
f0_2
 * (üy±o_št64è
f4
;

49 
üy±o_št64
 
f0f5_2
 = 
f0_2
 * (üy±o_št64è
f5
;

50 
üy±o_št64
 
f0f6_2
 = 
f0_2
 * (üy±o_št64è
f6
;

51 
üy±o_št64
 
f0f7_2
 = 
f0_2
 * (üy±o_št64è
f7
;

52 
üy±o_št64
 
f0f8_2
 = 
f0_2
 * (üy±o_št64è
f8
;

53 
üy±o_št64
 
f0f9_2
 = 
f0_2
 * (üy±o_št64è
f9
;

54 
üy±o_št64
 
f1f1_2
 = 
f1_2
 * (üy±o_št64è
f1
;

55 
üy±o_št64
 
f1f2_2
 = 
f1_2
 * (üy±o_št64è
f2
;

56 
üy±o_št64
 
f1f3_4
 = 
f1_2
 * (üy±o_št64è
f3_2
;

57 
üy±o_št64
 
f1f4_2
 = 
f1_2
 * (üy±o_št64è
f4
;

58 
üy±o_št64
 
f1f5_4
 = 
f1_2
 * (üy±o_št64è
f5_2
;

59 
üy±o_št64
 
f1f6_2
 = 
f1_2
 * (üy±o_št64è
f6
;

60 
üy±o_št64
 
f1f7_4
 = 
f1_2
 * (üy±o_št64è
f7_2
;

61 
üy±o_št64
 
f1f8_2
 = 
f1_2
 * (üy±o_št64è
f8
;

62 
üy±o_št64
 
f1f9_76
 = 
f1_2
 * (üy±o_št64è
f9_38
;

63 
üy±o_št64
 
f2f2
 = 
f2
 * (crypto_int64) f2;

64 
üy±o_št64
 
f2f3_2
 = 
f2_2
 * (üy±o_št64è
f3
;

65 
üy±o_št64
 
f2f4_2
 = 
f2_2
 * (üy±o_št64è
f4
;

66 
üy±o_št64
 
f2f5_2
 = 
f2_2
 * (üy±o_št64è
f5
;

67 
üy±o_št64
 
f2f6_2
 = 
f2_2
 * (üy±o_št64è
f6
;

68 
üy±o_št64
 
f2f7_2
 = 
f2_2
 * (üy±o_št64è
f7
;

69 
üy±o_št64
 
f2f8_38
 = 
f2_2
 * (üy±o_št64è
f8_19
;

70 
üy±o_št64
 
f2f9_38
 = 
f2
 * (üy±o_št64è
f9_38
;

71 
üy±o_št64
 
f3f3_2
 = 
f3_2
 * (üy±o_št64è
f3
;

72 
üy±o_št64
 
f3f4_2
 = 
f3_2
 * (üy±o_št64è
f4
;

73 
üy±o_št64
 
f3f5_4
 = 
f3_2
 * (üy±o_št64è
f5_2
;

74 
üy±o_št64
 
f3f6_2
 = 
f3_2
 * (üy±o_št64è
f6
;

75 
üy±o_št64
 
f3f7_76
 = 
f3_2
 * (üy±o_št64è
f7_38
;

76 
üy±o_št64
 
f3f8_38
 = 
f3_2
 * (üy±o_št64è
f8_19
;

77 
üy±o_št64
 
f3f9_76
 = 
f3_2
 * (üy±o_št64è
f9_38
;

78 
üy±o_št64
 
f4f4
 = 
f4
 * (crypto_int64) f4;

79 
üy±o_št64
 
f4f5_2
 = 
f4_2
 * (üy±o_št64è
f5
;

80 
üy±o_št64
 
f4f6_38
 = 
f4_2
 * (üy±o_št64è
f6_19
;

81 
üy±o_št64
 
f4f7_38
 = 
f4
 * (üy±o_št64è
f7_38
;

82 
üy±o_št64
 
f4f8_38
 = 
f4_2
 * (üy±o_št64è
f8_19
;

83 
üy±o_št64
 
f4f9_38
 = 
f4
 * (üy±o_št64è
f9_38
;

84 
üy±o_št64
 
f5f5_38
 = 
f5
 * (üy±o_št64è
f5_38
;

85 
üy±o_št64
 
f5f6_38
 = 
f5_2
 * (üy±o_št64è
f6_19
;

86 
üy±o_št64
 
f5f7_76
 = 
f5_2
 * (üy±o_št64è
f7_38
;

87 
üy±o_št64
 
f5f8_38
 = 
f5_2
 * (üy±o_št64è
f8_19
;

88 
üy±o_št64
 
f5f9_76
 = 
f5_2
 * (üy±o_št64è
f9_38
;

89 
üy±o_št64
 
f6f6_19
 = 
f6
 * (üy±o_št64è
f6_19
;

90 
üy±o_št64
 
f6f7_38
 = 
f6
 * (üy±o_št64è
f7_38
;

91 
üy±o_št64
 
f6f8_38
 = 
f6_2
 * (üy±o_št64è
f8_19
;

92 
üy±o_št64
 
f6f9_38
 = 
f6
 * (üy±o_št64è
f9_38
;

93 
üy±o_št64
 
f7f7_38
 = 
f7
 * (üy±o_št64è
f7_38
;

94 
üy±o_št64
 
f7f8_38
 = 
f7_2
 * (üy±o_št64è
f8_19
;

95 
üy±o_št64
 
f7f9_76
 = 
f7_2
 * (üy±o_št64è
f9_38
;

96 
üy±o_št64
 
f8f8_19
 = 
f8
 * (üy±o_št64è
f8_19
;

97 
üy±o_št64
 
f8f9_38
 = 
f8
 * (üy±o_št64è
f9_38
;

98 
üy±o_št64
 
f9f9_38
 = 
f9
 * (üy±o_št64è
f9_38
;

99 
üy±o_št64
 
h0
 = 
f0f0
 +
f1f9_76
+
f2f8_38
+
f3f7_76
+
f4f6_38
+
f5f5_38
;

100 
üy±o_št64
 
h1
 = 
f0f1_2
+
f2f9_38
+
f3f8_38
+
f4f7_38
+
f5f6_38
;

101 
üy±o_št64
 
h2
 = 
f0f2_2
+
f1f1_2
 +
f3f9_76
+
f4f8_38
+
f5f7_76
+
f6f6_19
;

102 
üy±o_št64
 
h3
 = 
f0f3_2
+
f1f2_2
 +
f4f9_38
+
f5f8_38
+
f6f7_38
;

103 
üy±o_št64
 
h4
 = 
f0f4_2
+
f1f3_4
 +
f2f2
 +
f5f9_76
+
f6f8_38
+
f7f7_38
;

104 
üy±o_št64
 
h5
 = 
f0f5_2
+
f1f4_2
 +
f2f3_2
 +
f6f9_38
+
f7f8_38
;

105 
üy±o_št64
 
h6
 = 
f0f6_2
+
f1f5_4
 +
f2f4_2
 +
f3f3_2
 +
f7f9_76
+
f8f8_19
;

106 
üy±o_št64
 
h7
 = 
f0f7_2
+
f1f6_2
 +
f2f5_2
 +
f3f4_2
 +
f8f9_38
;

107 
üy±o_št64
 
h8
 = 
f0f8_2
+
f1f7_4
 +
f2f6_2
 +
f3f5_4
 +
f4f4
 +
f9f9_38
;

108 
üy±o_št64
 
h9
 = 
f0f9_2
+
f1f8_2
 +
f2f7_2
 +
f3f6_2
 +
f4f5_2
;

109 
üy±o_št64
 
ÿ¼y0
;

110 
üy±o_št64
 
ÿ¼y1
;

111 
üy±o_št64
 
ÿ¼y2
;

112 
üy±o_št64
 
ÿ¼y3
;

113 
üy±o_št64
 
ÿ¼y4
;

114 
üy±o_št64
 
ÿ¼y5
;

115 
üy±o_št64
 
ÿ¼y6
;

116 
üy±o_št64
 
ÿ¼y7
;

117 
üy±o_št64
 
ÿ¼y8
;

118 
üy±o_št64
 
ÿ¼y9
;

120 
h0
 += h0;

121 
h1
 += h1;

122 
h2
 += h2;

123 
h3
 += h3;

124 
h4
 += h4;

125 
h5
 += h5;

126 
h6
 += h6;

127 
h7
 += h7;

128 
h8
 += h8;

129 
h9
 += h9;

131 
ÿ¼y0
 = (
h0
 + (
üy±o_št64
è(1<<25)è>> 26; 
h1
 += carry0; h0 -= carry0 << 26;

132 
ÿ¼y4
 = (
h4
 + (
üy±o_št64
è(1<<25)è>> 26; 
h5
 += carry4; h4 -= carry4 << 26;

134 
ÿ¼y1
 = (
h1
 + (
üy±o_št64
è(1<<24)è>> 25; 
h2
 += carry1; h1 -= carry1 << 25;

135 
ÿ¼y5
 = (
h5
 + (
üy±o_št64
è(1<<24)è>> 25; 
h6
 += carry5; h5 -= carry5 << 25;

137 
ÿ¼y2
 = (
h2
 + (
üy±o_št64
è(1<<25)è>> 26; 
h3
 += carry2; h2 -= carry2 << 26;

138 
ÿ¼y6
 = (
h6
 + (
üy±o_št64
è(1<<25)è>> 26; 
h7
 += carry6; h6 -= carry6 << 26;

140 
ÿ¼y3
 = (
h3
 + (
üy±o_št64
è(1<<24)è>> 25; 
h4
 += carry3; h3 -= carry3 << 25;

141 
ÿ¼y7
 = (
h7
 + (
üy±o_št64
è(1<<24)è>> 25; 
h8
 += carry7; h7 -= carry7 << 25;

143 
ÿ¼y4
 = (
h4
 + (
üy±o_št64
è(1<<25)è>> 26; 
h5
 += carry4; h4 -= carry4 << 26;

144 
ÿ¼y8
 = (
h8
 + (
üy±o_št64
è(1<<25)è>> 26; 
h9
 += carry8; h8 -= carry8 << 26;

146 
ÿ¼y9
 = (
h9
 + (
üy±o_št64
è(1<<24)è>> 25; 
h0
 += carry9 * 19; h9 -= carry9 << 25;

148 
ÿ¼y0
 = (
h0
 + (
üy±o_št64
è(1<<25)è>> 26; 
h1
 += carry0; h0 -= carry0 << 26;

150 
h
[0] = 
h0
;

151 
h
[1] = 
h1
;

152 
h
[2] = 
h2
;

153 
h
[3] = 
h3
;

154 
h
[4] = 
h4
;

155 
h
[5] = 
h5
;

156 
h
[6] = 
h6
;

157 
h
[7] = 
h7
;

158 
h
[8] = 
h8
;

159 
h
[9] = 
h9
;

160 
	}
}

	@plugins/auth/ref10/fe_sub.c

1 
	~"ã.h
"

15 
	$ã_sub
(
ã
 
h
,cÚ¡ f
f
,cÚ¡ f
g
)

17 
üy±o_št32
 
f0
 = 
f
[0];

18 
üy±o_št32
 
f1
 = 
f
[1];

19 
üy±o_št32
 
f2
 = 
f
[2];

20 
üy±o_št32
 
f3
 = 
f
[3];

21 
üy±o_št32
 
f4
 = 
f
[4];

22 
üy±o_št32
 
f5
 = 
f
[5];

23 
üy±o_št32
 
f6
 = 
f
[6];

24 
üy±o_št32
 
f7
 = 
f
[7];

25 
üy±o_št32
 
f8
 = 
f
[8];

26 
üy±o_št32
 
f9
 = 
f
[9];

27 
üy±o_št32
 
g0
 = 
g
[0];

28 
üy±o_št32
 
g1
 = 
g
[1];

29 
üy±o_št32
 
g2
 = 
g
[2];

30 
üy±o_št32
 
g3
 = 
g
[3];

31 
üy±o_št32
 
g4
 = 
g
[4];

32 
üy±o_št32
 
g5
 = 
g
[5];

33 
üy±o_št32
 
g6
 = 
g
[6];

34 
üy±o_št32
 
g7
 = 
g
[7];

35 
üy±o_št32
 
g8
 = 
g
[8];

36 
üy±o_št32
 
g9
 = 
g
[9];

37 
üy±o_št32
 
h0
 = 
f0
 - 
g0
;

38 
üy±o_št32
 
h1
 = 
f1
 - 
g1
;

39 
üy±o_št32
 
h2
 = 
f2
 - 
g2
;

40 
üy±o_št32
 
h3
 = 
f3
 - 
g3
;

41 
üy±o_št32
 
h4
 = 
f4
 - 
g4
;

42 
üy±o_št32
 
h5
 = 
f5
 - 
g5
;

43 
üy±o_št32
 
h6
 = 
f6
 - 
g6
;

44 
üy±o_št32
 
h7
 = 
f7
 - 
g7
;

45 
üy±o_št32
 
h8
 = 
f8
 - 
g8
;

46 
üy±o_št32
 
h9
 = 
f9
 - 
g9
;

47 
h
[0] = 
h0
;

48 
h
[1] = 
h1
;

49 
h
[2] = 
h2
;

50 
h
[3] = 
h3
;

51 
h
[4] = 
h4
;

52 
h
[5] = 
h5
;

53 
h
[6] = 
h6
;

54 
h
[7] = 
h7
;

55 
h
[8] = 
h8
;

56 
h
[9] = 
h9
;

57 
	}
}

	@plugins/auth/ref10/fe_tobytes.c

1 
	~"ã.h
"

28 
	$ã_toby‹s
(*
s
,cÚ¡ 
ã
 
h
)

30 
üy±o_št32
 
h0
 = 
h
[0];

31 
üy±o_št32
 
h1
 = 
h
[1];

32 
üy±o_št32
 
h2
 = 
h
[2];

33 
üy±o_št32
 
h3
 = 
h
[3];

34 
üy±o_št32
 
h4
 = 
h
[4];

35 
üy±o_št32
 
h5
 = 
h
[5];

36 
üy±o_št32
 
h6
 = 
h
[6];

37 
üy±o_št32
 
h7
 = 
h
[7];

38 
üy±o_št32
 
h8
 = 
h
[8];

39 
üy±o_št32
 
h9
 = 
h
[9];

40 
üy±o_št32
 
q
;

41 
üy±o_št32
 
ÿ¼y0
;

42 
üy±o_št32
 
ÿ¼y1
;

43 
üy±o_št32
 
ÿ¼y2
;

44 
üy±o_št32
 
ÿ¼y3
;

45 
üy±o_št32
 
ÿ¼y4
;

46 
üy±o_št32
 
ÿ¼y5
;

47 
üy±o_št32
 
ÿ¼y6
;

48 
üy±o_št32
 
ÿ¼y7
;

49 
üy±o_št32
 
ÿ¼y8
;

50 
üy±o_št32
 
ÿ¼y9
;

52 
q
 = (19 * 
h9
 + (((
üy±o_št32
) 1) << 24)) >> 25;

53 
q
 = (
h0
 + q) >> 26;

54 
q
 = (
h1
 + q) >> 25;

55 
q
 = (
h2
 + q) >> 26;

56 
q
 = (
h3
 + q) >> 25;

57 
q
 = (
h4
 + q) >> 26;

58 
q
 = (
h5
 + q) >> 25;

59 
q
 = (
h6
 + q) >> 26;

60 
q
 = (
h7
 + q) >> 25;

61 
q
 = (
h8
 + q) >> 26;

62 
q
 = (
h9
 + q) >> 25;

65 
h0
 +ð19 * 
q
;

68 
ÿ¼y0
 = 
h0
 >> 26; 
h1
 += carry0; h0 -= carry0 << 26;

69 
ÿ¼y1
 = 
h1
 >> 25; 
h2
 += carry1; h1 -= carry1 << 25;

70 
ÿ¼y2
 = 
h2
 >> 26; 
h3
 += carry2; h2 -= carry2 << 26;

71 
ÿ¼y3
 = 
h3
 >> 25; 
h4
 += carry3; h3 -= carry3 << 25;

72 
ÿ¼y4
 = 
h4
 >> 26; 
h5
 += carry4; h4 -= carry4 << 26;

73 
ÿ¼y5
 = 
h5
 >> 25; 
h6
 += carry5; h5 -= carry5 << 25;

74 
ÿ¼y6
 = 
h6
 >> 26; 
h7
 += carry6; h6 -= carry6 << 26;

75 
ÿ¼y7
 = 
h7
 >> 25; 
h8
 += carry7; h7 -= carry7 << 25;

76 
ÿ¼y8
 = 
h8
 >> 26; 
h9
 += carry8; h8 -= carry8 << 26;

77 
ÿ¼y9
 = 
h9
 >> 25; h9 -= carry9 << 25;

87 
s
[0] = 
h0
 >> 0;

88 
s
[1] = 
h0
 >> 8;

89 
s
[2] = 
h0
 >> 16;

90 
s
[3] = (
h0
 >> 24è| (
h1
 << 2);

91 
s
[4] = 
h1
 >> 6;

92 
s
[5] = 
h1
 >> 14;

93 
s
[6] = (
h1
 >> 22è| (
h2
 << 3);

94 
s
[7] = 
h2
 >> 5;

95 
s
[8] = 
h2
 >> 13;

96 
s
[9] = (
h2
 >> 21è| (
h3
 << 5);

97 
s
[10] = 
h3
 >> 3;

98 
s
[11] = 
h3
 >> 11;

99 
s
[12] = (
h3
 >> 19è| (
h4
 << 6);

100 
s
[13] = 
h4
 >> 2;

101 
s
[14] = 
h4
 >> 10;

102 
s
[15] = 
h4
 >> 18;

103 
s
[16] = 
h5
 >> 0;

104 
s
[17] = 
h5
 >> 8;

105 
s
[18] = 
h5
 >> 16;

106 
s
[19] = (
h5
 >> 24è| (
h6
 << 1);

107 
s
[20] = 
h6
 >> 7;

108 
s
[21] = 
h6
 >> 15;

109 
s
[22] = (
h6
 >> 23è| (
h7
 << 3);

110 
s
[23] = 
h7
 >> 5;

111 
s
[24] = 
h7
 >> 13;

112 
s
[25] = (
h7
 >> 21è| (
h8
 << 4);

113 
s
[26] = 
h8
 >> 4;

114 
s
[27] = 
h8
 >> 12;

115 
s
[28] = (
h8
 >> 20è| (
h9
 << 6);

116 
s
[29] = 
h9
 >> 2;

117 
s
[30] = 
h9
 >> 10;

118 
s
[31] = 
h9
 >> 18;

119 
	}
}

	@plugins/auth/ref10/ge.h

1 #iâdeà
GE_H


2 
	#GE_H


	)

18 
	~"ã.h
"

21 
ã
 
	mX
;

22 
ã
 
	mY
;

23 
ã
 
	mZ
;

24 } 
	tge_p2
;

27 
ã
 
	mX
;

28 
ã
 
	mY
;

29 
ã
 
	mZ
;

30 
ã
 
	mT
;

31 } 
	tge_p3
;

34 
ã
 
	mX
;

35 
ã
 
	mY
;

36 
ã
 
	mZ
;

37 
ã
 
	mT
;

38 } 
	tge_p1p1
;

41 
ã
 
	my¶usx
;

42 
ã
 
	mymšusx
;

43 
ã
 
	mxy2d
;

44 } 
	tge_´ecomp
;

47 
ã
 
	mY¶usX
;

48 
ã
 
	mYmšusX
;

49 
ã
 
	mZ
;

50 
ã
 
	mT2d
;

51 } 
	tge_ÿched
;

53 
	#ge_äomby‹s_Ãg©e_v¬time
 
üy±o_sign_ed25519_»f10_ge_äomby‹s_Ãg©e_v¬time


	)

54 
	#ge_toby‹s
 
üy±o_sign_ed25519_»f10_ge_toby‹s


	)

55 
	#ge_p3_toby‹s
 
üy±o_sign_ed25519_»f10_ge_p3_toby‹s


	)

57 
	#ge_p2_0
 
üy±o_sign_ed25519_»f10_ge_p2_0


	)

58 
	#ge_p3_0
 
üy±o_sign_ed25519_»f10_ge_p3_0


	)

59 
	#ge_´ecomp_0
 
üy±o_sign_ed25519_»f10_ge_´ecomp_0


	)

60 
	#ge_p3_to_p2
 
üy±o_sign_ed25519_»f10_ge_p3_to_p2


	)

61 
	#ge_p3_to_ÿched
 
üy±o_sign_ed25519_»f10_ge_p3_to_ÿched


	)

62 
	#ge_p1p1_to_p2
 
üy±o_sign_ed25519_»f10_ge_p1p1_to_p2


	)

63 
	#ge_p1p1_to_p3
 
üy±o_sign_ed25519_»f10_ge_p1p1_to_p3


	)

64 
	#ge_p2_dbl
 
üy±o_sign_ed25519_»f10_ge_p2_dbl


	)

65 
	#ge_p3_dbl
 
üy±o_sign_ed25519_»f10_ge_p3_dbl


	)

67 
	#ge_madd
 
üy±o_sign_ed25519_»f10_ge_madd


	)

68 
	#ge_msub
 
üy±o_sign_ed25519_»f10_ge_msub


	)

69 
	#ge_add
 
üy±o_sign_ed25519_»f10_ge_add


	)

70 
	#ge_sub
 
üy±o_sign_ed25519_»f10_ge_sub


	)

71 
	#ge_sÿÏrmuÉ_ba£
 
üy±o_sign_ed25519_»f10_ge_sÿÏrmuÉ_ba£


	)

72 
	#ge_doubË_sÿÏrmuÉ_v¬time
 
üy±o_sign_ed25519_»f10_ge_doubË_sÿÏrmuÉ_v¬time


	)

74 
ge_toby‹s
(*,cÚ¡ 
ge_p2
 *);

75 
ge_p3_toby‹s
(*,cÚ¡ 
ge_p3
 *);

76 
ge_äomby‹s_Ãg©e_v¬time
(
ge_p3
 *,const *);

78 
ge_p2_0
(
ge_p2
 *);

79 
ge_p3_0
(
ge_p3
 *);

80 
ge_´ecomp_0
(
ge_´ecomp
 *);

81 
ge_p3_to_p2
(
ge_p2
 *,cÚ¡ 
ge_p3
 *);

82 
ge_p3_to_ÿched
(
ge_ÿched
 *,cÚ¡ 
ge_p3
 *);

83 
ge_p1p1_to_p2
(
ge_p2
 *,cÚ¡ 
ge_p1p1
 *);

84 
ge_p1p1_to_p3
(
ge_p3
 *,cÚ¡ 
ge_p1p1
 *);

85 
ge_p2_dbl
(
ge_p1p1
 *,cÚ¡ 
ge_p2
 *);

86 
ge_p3_dbl
(
ge_p1p1
 *,cÚ¡ 
ge_p3
 *);

88 
ge_madd
(
ge_p1p1
 *,cÚ¡ 
ge_p3
 *,cÚ¡ 
ge_´ecomp
 *);

89 
ge_msub
(
ge_p1p1
 *,cÚ¡ 
ge_p3
 *,cÚ¡ 
ge_´ecomp
 *);

90 
ge_add
(
ge_p1p1
 *,cÚ¡ 
ge_p3
 *,cÚ¡ 
ge_ÿched
 *);

91 
ge_sub
(
ge_p1p1
 *,cÚ¡ 
ge_p3
 *,cÚ¡ 
ge_ÿched
 *);

92 
ge_sÿÏrmuÉ_ba£
(
ge_p3
 *,const *);

93 
ge_doubË_sÿÏrmuÉ_v¬time
(
ge_p2
 *,cÚ¡ *,cÚ¡ 
ge_p3
 *,const *);

	@plugins/auth/ref10/ge_add.c

1 
	~"ge.h
"

7 
	$ge_add
(
ge_p1p1
 *
r
,cÚ¡ 
ge_p3
 *
p
,cÚ¡ 
ge_ÿched
 *
q
)

9 
ã
 
t0
;

10 
	~"ge_add.h
"

11 
	}
}

	@plugins/auth/ref10/ge_add.h

45 
ã_add
(
r
->
X
,
p
->
Y
,p->X);

50 
ã_sub
(
r
->
Y
,
p
->Y,p->
X
);

55 
ã_mul
(
r
->
Z
,r->
X
,
q
->
Y¶usX
);

60 
ã_mul
(
r
->
Y
,r->Y,
q
->
YmšusX
);

65 
ã_mul
(
r
->
T
,
q
->
T2d
,
p
->T);

70 
ã_mul
(
r
->
X
,
p
->
Z
,
q
->Z);

75 
ã_add
(
t0
,
r
->
X
,r->X);

80 
ã_sub
(
r
->
X
,r->
Z
,r->
Y
);

85 
ã_add
(
r
->
Y
,r->
Z
,r->Y);

90 
ã_add
(
r
->
Z
,
t0
,r->
T
);

95 
ã_sub
(
r
->
T
,
t0
,r->T);

	@plugins/auth/ref10/ge_double_scalarmult.c

1 
	~"ge.h
"

3 
	$¦ide
(sigÃd *
r
,cÚ¡ *
a
)

5 
i
;

6 
b
;

7 
k
;

9 
i
 = 0;i < 256;++i)

10 
r
[
i
] = 1 & (
a
[i >> 3] >> (i & 7));

12 
i
 = 0;i < 256;++i)

13 ià(
r
[
i
]) {

14 
b
 = 1;b <ð6 && 
i
 + b < 256;++b) {

15 ià(
r
[
i
 + 
b
]) {

16 ià(
r
[
i
] + (r[˜+ 
b
] << b) <= 15) {

17 
r
[
i
] +ðr[˜+ 
b
] << b;„[i + b] = 0;

18 } ià(
r
[
i
] - (r[˜+ 
b
] << b) >= -15) {

19 
r
[
i
] -ðr[˜+ 
b
] << b;

20 
k
 = 
i
 + 
b
;k < 256;++k) {

21 ià(!
r
[
k
]) {

22 
r
[
k
] = 1;

25 
r
[
k
] = 0;

33 
	}
}

35 
ge_´ecomp
 
	gBi
[8] = {

36 
	~"ba£2.h
"

46 
	$ge_doubË_sÿÏrmuÉ_v¬time
(
ge_p2
 *
r
,cÚ¡ *
a
,cÚ¡ 
ge_p3
 *
A
,cÚ¡ *
b
)

48 sigÃd 
a¦ide
[256];

49 sigÃd 
b¦ide
[256];

50 
ge_ÿched
 
Ai
[8];

51 
ge_p1p1
 
t
;

52 
ge_p3
 
u
;

53 
ge_p3
 
A2
;

54 
i
;

56 
	`¦ide
(
a¦ide
,
a
);

57 
	`¦ide
(
b¦ide
,
b
);

59 
	`ge_p3_to_ÿched
(&
Ai
[0],
A
);

60 
	`ge_p3_dbl
(&
t
,
A
); 
	`ge_p1p1_to_p3
(&
A2
,&t);

61 
	`ge_add
(&
t
,&
A2
,&
Ai
[0]); 
	`ge_p1p1_to_p3
(&
u
,&t); 
	`ge_p3_to_ÿched
(&Ai[1],&u);

62 
	`ge_add
(&
t
,&
A2
,&
Ai
[1]); 
	`ge_p1p1_to_p3
(&
u
,&t); 
	`ge_p3_to_ÿched
(&Ai[2],&u);

63 
	`ge_add
(&
t
,&
A2
,&
Ai
[2]); 
	`ge_p1p1_to_p3
(&
u
,&t); 
	`ge_p3_to_ÿched
(&Ai[3],&u);

64 
	`ge_add
(&
t
,&
A2
,&
Ai
[3]); 
	`ge_p1p1_to_p3
(&
u
,&t); 
	`ge_p3_to_ÿched
(&Ai[4],&u);

65 
	`ge_add
(&
t
,&
A2
,&
Ai
[4]); 
	`ge_p1p1_to_p3
(&
u
,&t); 
	`ge_p3_to_ÿched
(&Ai[5],&u);

66 
	`ge_add
(&
t
,&
A2
,&
Ai
[5]); 
	`ge_p1p1_to_p3
(&
u
,&t); 
	`ge_p3_to_ÿched
(&Ai[6],&u);

67 
	`ge_add
(&
t
,&
A2
,&
Ai
[6]); 
	`ge_p1p1_to_p3
(&
u
,&t); 
	`ge_p3_to_ÿched
(&Ai[7],&u);

69 
	`ge_p2_0
(
r
);

71 
i
 = 255;i >= 0;--i) {

72 ià(
a¦ide
[
i
] || 
b¦ide
[i]) ;

75 ;
i
 >= 0;--i) {

76 
	`ge_p2_dbl
(&
t
,
r
);

78 ià(
a¦ide
[
i
] > 0) {

79 
	`ge_p1p1_to_p3
(&
u
,&
t
);

80 
	`ge_add
(&
t
,&
u
,&
Ai
[
a¦ide
[
i
]/2]);

81 } ià(
a¦ide
[
i
] < 0) {

82 
	`ge_p1p1_to_p3
(&
u
,&
t
);

83 
	`ge_sub
(&
t
,&
u
,&
Ai
[(-
a¦ide
[
i
])/2]);

86 ià(
b¦ide
[
i
] > 0) {

87 
	`ge_p1p1_to_p3
(&
u
,&
t
);

88 
	`ge_madd
(&
t
,&
u
,&
Bi
[
b¦ide
[
i
]/2]);

89 } ià(
b¦ide
[
i
] < 0) {

90 
	`ge_p1p1_to_p3
(&
u
,&
t
);

91 
	`ge_msub
(&
t
,&
u
,&
Bi
[(-
b¦ide
[
i
])/2]);

94 
	`ge_p1p1_to_p2
(
r
,&
t
);

96 
	}
}

	@plugins/auth/ref10/ge_frombytes.c

1 
	~"ge.h
"

3 cÚ¡ 
ã
 
	gd
 = {

4 
	~"d.h
"

7 cÚ¡ 
ã
 
	gsq¹m1
 = {

8 
	~"sq¹m1.h
"

11 
	$ge_äomby‹s_Ãg©e_v¬time
(
ge_p3
 *
h
,cÚ¡ *
s
)

13 
ã
 
u
;

14 
ã
 
v
;

15 
ã
 
v3
;

16 
ã
 
vxx
;

17 
ã
 
check
;

19 
	`ã_äomby‹s
(
h
->
Y
,
s
);

20 
	`ã_1
(
h
->
Z
);

21 
	`ã_sq
(
u
,
h
->
Y
);

22 
	`ã_mul
(
v
,
u
,
d
);

23 
	`ã_sub
(
u
,u,
h
->
Z
);

24 
	`ã_add
(
v
,v,
h
->
Z
);

26 
	`ã_sq
(
v3
,
v
);

27 
	`ã_mul
(
v3
,v3,
v
);

28 
	`ã_sq
(
h
->
X
,
v3
);

29 
	`ã_mul
(
h
->
X
,h->X,
v
);

30 
	`ã_mul
(
h
->
X
,h->X,
u
);

32 
	`ã_pow22523
(
h
->
X
,h->X);

33 
	`ã_mul
(
h
->
X
,h->X,
v3
);

34 
	`ã_mul
(
h
->
X
,h->X,
u
);

36 
	`ã_sq
(
vxx
,
h
->
X
);

37 
	`ã_mul
(
vxx
,vxx,
v
);

38 
	`ã_sub
(
check
,
vxx
,
u
);

39 ià(
	`ã_i¢Úz”o
(
check
)) {

40 
	`ã_add
(
check
,
vxx
,
u
);

41 ià(
	`ã_i¢Úz”o
(
check
))  -1;

42 
	`ã_mul
(
h
->
X
,h->X,
sq¹m1
);

45 ià(
	`ã_i¢eg©ive
(
h
->
X
è=ð(
s
[31] >> 7))

46 
	`ã_Ãg
(
h
->
X
,h->X);

48 
	`ã_mul
(
h
->
T
,h->
X
,h->
Y
);

50 
	}
}

	@plugins/auth/ref10/ge_madd.c

1 
	~"ge.h
"

7 
	$ge_madd
(
ge_p1p1
 *
r
,cÚ¡ 
ge_p3
 *
p
,cÚ¡ 
ge_´ecomp
 *
q
)

9 
ã
 
t0
;

10 
	~"ge_madd.h
"

11 
	}
}

	@plugins/auth/ref10/ge_madd.h

41 
ã_add
(
r
->
X
,
p
->
Y
,p->X);

46 
ã_sub
(
r
->
Y
,
p
->Y,p->
X
);

51 
ã_mul
(
r
->
Z
,r->
X
,
q
->
y¶usx
);

56 
ã_mul
(
r
->
Y
,r->Y,
q
->
ymšusx
);

61 
ã_mul
(
r
->
T
,
q
->
xy2d
,
p
->T);

66 
ã_add
(
t0
,
p
->
Z
,p->Z);

71 
ã_sub
(
r
->
X
,r->
Z
,r->
Y
);

76 
ã_add
(
r
->
Y
,r->
Z
,r->Y);

81 
ã_add
(
r
->
Z
,
t0
,r->
T
);

86 
ã_sub
(
r
->
T
,
t0
,r->T);

	@plugins/auth/ref10/ge_msub.c

1 
	~"ge.h
"

7 
	$ge_msub
(
ge_p1p1
 *
r
,cÚ¡ 
ge_p3
 *
p
,cÚ¡ 
ge_´ecomp
 *
q
)

9 
ã
 
t0
;

10 
	~"ge_msub.h
"

11 
	}
}

	@plugins/auth/ref10/ge_msub.h

41 
ã_add
(
r
->
X
,
p
->
Y
,p->X);

46 
ã_sub
(
r
->
Y
,
p
->Y,p->
X
);

51 
ã_mul
(
r
->
Z
,r->
X
,
q
->
ymšusx
);

56 
ã_mul
(
r
->
Y
,r->Y,
q
->
y¶usx
);

61 
ã_mul
(
r
->
T
,
q
->
xy2d
,
p
->T);

66 
ã_add
(
t0
,
p
->
Z
,p->Z);

71 
ã_sub
(
r
->
X
,r->
Z
,r->
Y
);

76 
ã_add
(
r
->
Y
,r->
Z
,r->Y);

81 
ã_sub
(
r
->
Z
,
t0
,r->
T
);

86 
ã_add
(
r
->
T
,
t0
,r->T);

	@plugins/auth/ref10/ge_p1p1_to_p2.c

1 
	~"ge.h
"

7 
	$ge_p1p1_to_p2
(
ge_p2
 *
r
,cÚ¡ 
ge_p1p1
 *
p
)

9 
	`ã_mul
(
r
->
X
,
p
->X,p->
T
);

10 
	`ã_mul
(
r
->
Y
,
p
->Y,p->
Z
);

11 
	`ã_mul
(
r
->
Z
,
p
->Z,p->
T
);

12 
	}
}

	@plugins/auth/ref10/ge_p1p1_to_p3.c

1 
	~"ge.h
"

7 
	$ge_p1p1_to_p3
(
ge_p3
 *
r
,cÚ¡ 
ge_p1p1
 *
p
)

9 
	`ã_mul
(
r
->
X
,
p
->X,p->
T
);

10 
	`ã_mul
(
r
->
Y
,
p
->Y,p->
Z
);

11 
	`ã_mul
(
r
->
Z
,
p
->Z,p->
T
);

12 
	`ã_mul
(
r
->
T
,
p
->
X
,p->
Y
);

13 
	}
}

	@plugins/auth/ref10/ge_p2_0.c

1 
	~"ge.h
"

3 
	$ge_p2_0
(
ge_p2
 *
h
)

5 
	`ã_0
(
h
->
X
);

6 
	`ã_1
(
h
->
Y
);

7 
	`ã_1
(
h
->
Z
);

8 
	}
}

	@plugins/auth/ref10/ge_p2_dbl.c

1 
	~"ge.h
"

7 
	$ge_p2_dbl
(
ge_p1p1
 *
r
,cÚ¡ 
ge_p2
 *
p
)

9 
ã
 
t0
;

10 
	~"ge_p2_dbl.h
"

11 
	}
}

	@plugins/auth/ref10/ge_p2_dbl.h

31 
ã_sq
(
r
->
X
,
p
->X);

36 
ã_sq
(
r
->
Z
,
p
->
Y
);

41 
ã_sq2
(
r
->
T
,
p
->
Z
);

46 
ã_add
(
r
->
Y
,
p
->
X
,p->Y);

51 
ã_sq
(
t0
,
r
->
Y
);

56 
ã_add
(
r
->
Y
,r->
Z
,r->
X
);

61 
ã_sub
(
r
->
Z
,r->Z,r->
X
);

66 
ã_sub
(
r
->
X
,
t0
,r->
Y
);

71 
ã_sub
(
r
->
T
,r->T,r->
Z
);

	@plugins/auth/ref10/ge_p3_0.c

1 
	~"ge.h
"

3 
	$ge_p3_0
(
ge_p3
 *
h
)

5 
	`ã_0
(
h
->
X
);

6 
	`ã_1
(
h
->
Y
);

7 
	`ã_1
(
h
->
Z
);

8 
	`ã_0
(
h
->
T
);

9 
	}
}

	@plugins/auth/ref10/ge_p3_dbl.c

1 
	~"ge.h
"

7 
	$ge_p3_dbl
(
ge_p1p1
 *
r
,cÚ¡ 
ge_p3
 *
p
)

9 
ge_p2
 
q
;

10 
	`ge_p3_to_p2
(&
q
,
p
);

11 
	`ge_p2_dbl
(
r
,&
q
);

12 
	}
}

	@plugins/auth/ref10/ge_p3_to_cached.c

1 
	~"ge.h
"

7 cÚ¡ 
ã
 
	gd2
 = {

8 
	~"d2.h
"

11 
	$ge_p3_to_ÿched
(
ge_ÿched
 *
r
,cÚ¡ 
ge_p3
 *
p
)

13 
	`ã_add
(
r
->
Y¶usX
,
p
->
Y
,p->
X
);

14 
	`ã_sub
(
r
->
YmšusX
,
p
->
Y
,p->
X
);

15 
	`ã_cÝy
(
r
->
Z
,
p
->Z);

16 
	`ã_mul
(
r
->
T2d
,
p
->
T
,
d2
);

17 
	}
}

	@plugins/auth/ref10/ge_p3_to_p2.c

1 
	~"ge.h
"

7 
	$ge_p3_to_p2
(
ge_p2
 *
r
,cÚ¡ 
ge_p3
 *
p
)

9 
	`ã_cÝy
(
r
->
X
,
p
->X);

10 
	`ã_cÝy
(
r
->
Y
,
p
->Y);

11 
	`ã_cÝy
(
r
->
Z
,
p
->Z);

12 
	}
}

	@plugins/auth/ref10/ge_p3_tobytes.c

1 
	~"ge.h
"

3 
	$ge_p3_toby‹s
(*
s
,cÚ¡ 
ge_p3
 *
h
)

5 
ã
 
»c
;

6 
ã
 
x
;

7 
ã
 
y
;

9 
	`ã_šv”t
(
»c
,
h
->
Z
);

10 
	`ã_mul
(
x
,
h
->
X
,
»c
);

11 
	`ã_mul
(
y
,
h
->
Y
,
»c
);

12 
	`ã_toby‹s
(
s
,
y
);

13 
s
[31] ^ð
	`ã_i¢eg©ive
(
x
) << 7;

14 
	}
}

	@plugins/auth/ref10/ge_precomp_0.c

1 
	~"ge.h
"

3 
	$ge_´ecomp_0
(
ge_´ecomp
 *
h
)

5 
	`ã_1
(
h
->
y¶usx
);

6 
	`ã_1
(
h
->
ymšusx
);

7 
	`ã_0
(
h
->
xy2d
);

8 
	}
}

	@plugins/auth/ref10/ge_scalarmult_base.c

1 
	~"ge.h
"

2 
	~"üy±o_ušt32.h
"

4 
	$equ®
(sigÃd 
b
,sigÃd 
c
)

6 
ub
 = 
b
;

7 
uc
 = 
c
;

8 
x
 = 
ub
 ^ 
uc
;

9 
üy±o_ušt32
 
y
 = 
x
;

10 
y
 -= 1;

11 
y
 >>= 31;

12  
y
;

13 
	}
}

15 
	$Ãg©ive
(sigÃd 
b
)

17 
x
 = 
b
;

18 
x
 >>= 63;

19  
x
;

20 
	}
}

22 
	$cmov
(
ge_´ecomp
 *
t
,ge_´ecom°*
u
,
b
)

24 
	`ã_cmov
(
t
->
y¶usx
,
u
->y¶usx,
b
);

25 
	`ã_cmov
(
t
->
ymšusx
,
u
->ymšusx,
b
);

26 
	`ã_cmov
(
t
->
xy2d
,
u
->xy2d,
b
);

27 
	}
}

30 
ge_´ecomp
 
	gba£
[32][8] = {

31 
	~"ba£.h
"

34 
	$£Ëù
(
ge_´ecomp
 *
t
,
pos
,sigÃd 
b
)

36 
ge_´ecomp
 
mšu¡
;

37 
bÃg©ive
 = 
	`Ãg©ive
(
b
);

38 
babs
 = 
b
 - (((-
bÃg©ive
) & b) << 1);

40 
	`ge_´ecomp_0
(
t
);

41 
	`cmov
(
t
,&
ba£
[
pos
][0],
	`equ®
(
babs
,1));

42 
	`cmov
(
t
,&
ba£
[
pos
][1],
	`equ®
(
babs
,2));

43 
	`cmov
(
t
,&
ba£
[
pos
][2],
	`equ®
(
babs
,3));

44 
	`cmov
(
t
,&
ba£
[
pos
][3],
	`equ®
(
babs
,4));

45 
	`cmov
(
t
,&
ba£
[
pos
][4],
	`equ®
(
babs
,5));

46 
	`cmov
(
t
,&
ba£
[
pos
][5],
	`equ®
(
babs
,6));

47 
	`cmov
(
t
,&
ba£
[
pos
][6],
	`equ®
(
babs
,7));

48 
	`cmov
(
t
,&
ba£
[
pos
][7],
	`equ®
(
babs
,8));

49 
	`ã_cÝy
(
mšu¡
.
y¶usx
,
t
->
ymšusx
);

50 
	`ã_cÝy
(
mšu¡
.
ymšusx
,
t
->
y¶usx
);

51 
	`ã_Ãg
(
mšu¡
.
xy2d
,
t
->xy2d);

52 
	`cmov
(
t
,&
mšu¡
,
bÃg©ive
);

53 
	}
}

64 
	$ge_sÿÏrmuÉ_ba£
(
ge_p3
 *
h
,cÚ¡ *
a
)

66 sigÃd 
e
[64];

67 sigÃd 
ÿ¼y
;

68 
ge_p1p1
 
r
;

69 
ge_p2
 
s
;

70 
ge_´ecomp
 
t
;

71 
i
;

73 
i
 = 0;i < 32;++i) {

74 
e
[2 * 
i
 + 0] = (
a
[i] >> 0) & 15;

75 
e
[2 * 
i
 + 1] = (
a
[i] >> 4) & 15;

80 
ÿ¼y
 = 0;

81 
i
 = 0;i < 63;++i) {

82 
e
[
i
] +ð
ÿ¼y
;

83 
ÿ¼y
 = 
e
[
i
] + 8;

84 
ÿ¼y
 >>= 4;

85 
e
[
i
] -ð
ÿ¼y
 << 4;

87 
e
[63] +ð
ÿ¼y
;

90 
	`ge_p3_0
(
h
);

91 
i
 = 1;i < 64;i += 2) {

92 
	`£Ëù
(&
t
,
i
 / 2,
e
[i]);

93 
	`ge_madd
(&
r
,
h
,&
t
); 
	`ge_p1p1_to_p3
(h,&r);

96 
	`ge_p3_dbl
(&
r
,
h
); 
	`ge_p1p1_to_p2
(&
s
,&r);

97 
	`ge_p2_dbl
(&
r
,&
s
); 
	`ge_p1p1_to_p2
(&s,&r);

98 
	`ge_p2_dbl
(&
r
,&
s
); 
	`ge_p1p1_to_p2
(&s,&r);

99 
	`ge_p2_dbl
(&
r
,&
s
); 
	`ge_p1p1_to_p3
(
h
,&r);

101 
i
 = 0;i < 64;i += 2) {

102 
	`£Ëù
(&
t
,
i
 / 2,
e
[i]);

103 
	`ge_madd
(&
r
,
h
,&
t
); 
	`ge_p1p1_to_p3
(h,&r);

105 
	}
}

	@plugins/auth/ref10/ge_sub.c

1 
	~"ge.h
"

7 
	$ge_sub
(
ge_p1p1
 *
r
,cÚ¡ 
ge_p3
 *
p
,cÚ¡ 
ge_ÿched
 *
q
)

9 
ã
 
t0
;

10 
	~"ge_sub.h
"

11 
	}
}

	@plugins/auth/ref10/ge_sub.h

45 
ã_add
(
r
->
X
,
p
->
Y
,p->X);

50 
ã_sub
(
r
->
Y
,
p
->Y,p->
X
);

55 
ã_mul
(
r
->
Z
,r->
X
,
q
->
YmšusX
);

60 
ã_mul
(
r
->
Y
,r->Y,
q
->
Y¶usX
);

65 
ã_mul
(
r
->
T
,
q
->
T2d
,
p
->T);

70 
ã_mul
(
r
->
X
,
p
->
Z
,
q
->Z);

75 
ã_add
(
t0
,
r
->
X
,r->X);

80 
ã_sub
(
r
->
X
,r->
Z
,r->
Y
);

85 
ã_add
(
r
->
Y
,r->
Z
,r->Y);

90 
ã_sub
(
r
->
Z
,
t0
,r->
T
);

95 
ã_add
(
r
->
T
,
t0
,r->T);

	@plugins/auth/ref10/ge_tobytes.c

1 
	~"ge.h
"

3 
	$ge_toby‹s
(*
s
,cÚ¡ 
ge_p2
 *
h
)

5 
ã
 
»c
;

6 
ã
 
x
;

7 
ã
 
y
;

9 
	`ã_šv”t
(
»c
,
h
->
Z
);

10 
	`ã_mul
(
x
,
h
->
X
,
»c
);

11 
	`ã_mul
(
y
,
h
->
Y
,
»c
);

12 
	`ã_toby‹s
(
s
,
y
);

13 
s
[31] ^ð
	`ã_i¢eg©ive
(
x
) << 7;

14 
	}
}

	@plugins/auth/ref10/keypair.c

1 
	~<¡ršg.h
>

2 
	~"üy±o_sign.h
"

3 
	~"üy±o_hash_sha512.h
"

4 
	~"ge.h
"

6 
	$üy±o_sign_key·œ
(

7 *
pk
,

8 *
pw
, 
pwËn


11 
az
[64];

12 
ge_p3
 
A
;

14 
	`üy±o_hash_sha512
(
az
,
pw
,
pwËn
);

15 
az
[0] &= 248;

16 
az
[31] &= 63;

17 
az
[31] |= 64;

19 
	`ge_sÿÏrmuÉ_ba£
(&
A
,
az
);

20 
	`ge_p3_toby‹s
(
pk
,&
A
);

23 
	}
}

	@plugins/auth/ref10/open.c

1 
	~<¡ršg.h
>

2 
	~"üy±o_sign.h
"

3 
	~"üy±o_hash_sha512.h
"

4 
	~"üy±o_v”ify_32.h
"

5 
	~"ge.h
"

6 
	~"sc.h
"

8 
	$üy±o_sign_Ý’
(

9 *
sm
, 
smËn
,

10 cÚ¡ *
pk


13 
scÝy
[32];

14 
h
[64];

15 
rcheck
[32];

16 
ge_p3
 
A
;

17 
ge_p2
 
R
;

19 ià(
smËn
 < 64è
badsig
;

20 ià(
sm
[63] & 224è
badsig
;

21 ià(
	`ge_äomby‹s_Ãg©e_v¬time
(&
A
,
pk
è!ð0è
badsig
;

23 
	`memmove
(
scÝy
,
sm
 + 32,32);

25 
	`memmove
(
sm
 + 32,
pk
,32);

26 
	`üy±o_hash_sha512
(
h
,
sm
,
smËn
);

27 
	`sc_»duû
(
h
);

29 
	`ge_doubË_sÿÏrmuÉ_v¬time
(&
R
,
h
,&
A
,
scÝy
);

30 
	`ge_toby‹s
(
rcheck
,&
R
);

31 ià(
	`üy±o_v”ify_32
(
rcheck
,
sm
) == 0)

34 
badsig
:

36 
	}
}

	@plugins/auth/ref10/pow22523.h

53 
ã_sq
(
t0
,
z
);

62 
ã_sq
(
t1
,
t0
); 
	gi
 = 1;i < 2;++i) fe_sq(t1,t1);

67 
ã_mul
(
t1
,
z
,t1);

72 
ã_mul
(
t0
,t0,
t1
);

77 
ã_sq
(
t0
,t0);

86 
ã_mul
(
t0
,
t1
,t0);

91 
ã_sq
(
t1
,
t0
); 
	gi
 = 1;i < 5;++i) fe_sq(t1,t1);

96 
ã_mul
(
t0
,
t1
,t0);

101 
ã_sq
(
t1
,
t0
); 
	gi
 = 1;i < 10;++i) fe_sq(t1,t1);

106 
ã_mul
(
t1
,t1,
t0
);

111 
ã_sq
(
t2
,
t1
); 
	gi
 = 1;i < 20;++i) fe_sq(t2,t2);

116 
ã_mul
(
t1
,
t2
,t1);

121 
ã_sq
(
t1
,t1); 
	gi
 = 1;i < 10;++i) fe_sq(t1,t1);

126 
ã_mul
(
t0
,
t1
,t0);

131 
ã_sq
(
t1
,
t0
); 
	gi
 = 1;i < 50;++i) fe_sq(t1,t1);

136 
ã_mul
(
t1
,t1,
t0
);

141 
ã_sq
(
t2
,
t1
); 
	gi
 = 1;i < 100;++i) fe_sq(t2,t2);

146 
ã_mul
(
t1
,
t2
,t1);

151 
ã_sq
(
t1
,t1); 
	gi
 = 1;i < 50;++i) fe_sq(t1,t1);

156 
ã_mul
(
t0
,
t1
,t0);

161 
ã_sq
(
t0
,t0); 
	gi
 = 1;i < 2;++i) fe_sq(t0,t0);

166 
ã_mul
(
out
,
t0
,
z
);

	@plugins/auth/ref10/pow225521.h

53 
ã_sq
(
t0
,
z
);

61 
ã_sq
(
t1
,
t0
); 
	gi
 = 1;i < 2;++i) fe_sq(t1,t1);

66 
ã_mul
(
t1
,
z
,t1);

71 
ã_mul
(
t0
,t0,
t1
);

76 
ã_sq
(
t2
,
t0
);

84 
ã_mul
(
t1
,t1,
t2
);

89 
ã_sq
(
t2
,
t1
); 
	gi
 = 1;i < 5;++i) fe_sq(t2,t2);

94 
ã_mul
(
t1
,
t2
,t1);

99 
ã_sq
(
t2
,
t1
); 
	gi
 = 1;i < 10;++i) fe_sq(t2,t2);

104 
ã_mul
(
t2
,t2,
t1
);

109 
ã_sq
(
t3
,
t2
); 
	gi
 = 1;i < 20;++i) fe_sq(t3,t3);

114 
ã_mul
(
t2
,
t3
,t2);

119 
ã_sq
(
t2
,t2); 
	gi
 = 1;i < 10;++i) fe_sq(t2,t2);

124 
ã_mul
(
t1
,
t2
,t1);

129 
ã_sq
(
t2
,
t1
); 
	gi
 = 1;i < 50;++i) fe_sq(t2,t2);

134 
ã_mul
(
t2
,t2,
t1
);

139 
ã_sq
(
t3
,
t2
); 
	gi
 = 1;i < 100;++i) fe_sq(t3,t3);

144 
ã_mul
(
t2
,
t3
,t2);

149 
ã_sq
(
t2
,t2); 
	gi
 = 1;i < 50;++i) fe_sq(t2,t2);

154 
ã_mul
(
t1
,
t2
,t1);

159 
ã_sq
(
t1
,t1); 
	gi
 = 1;i < 5;++i) fe_sq(t1,t1);

164 
ã_mul
(
out
,
t1
,
t0
);

	@plugins/auth/ref10/sc.h

1 #iâdeà
SC_H


2 
	#SC_H


	)

9 
	#sc_»duû
 
üy±o_sign_ed25519_»f10_sc_»duû


	)

10 
	#sc_muÏdd
 
üy±o_sign_ed25519_»f10_sc_muÏdd


	)

12 
sc_»duû
(*);

13 
sc_muÏdd
(*,const *,const *,const *);

	@plugins/auth/ref10/sc_muladd.c

1 
	~"sc.h
"

2 
	~"üy±o_št64.h
"

3 
	~"üy±o_ušt32.h
"

4 
	~"üy±o_ušt64.h
"

6 
üy±o_ušt64
 
	$lßd_3
(cÚ¡ *
š
)

8 
üy±o_ušt64
 
»suÉ
;

9 
»suÉ
 = (
üy±o_ušt64
è
š
[0];

10 
»suÉ
 |ð((
üy±o_ušt64
è
š
[1]) << 8;

11 
»suÉ
 |ð((
üy±o_ušt64
è
š
[2]) << 16;

12  
»suÉ
;

13 
	}
}

15 
üy±o_ušt64
 
	$lßd_4
(cÚ¡ *
š
)

17 
üy±o_ušt64
 
»suÉ
;

18 
»suÉ
 = (
üy±o_ušt64
è
š
[0];

19 
»suÉ
 |ð((
üy±o_ušt64
è
š
[1]) << 8;

20 
»suÉ
 |ð((
üy±o_ušt64
è
š
[2]) << 16;

21 
»suÉ
 |ð((
üy±o_ušt64
è
š
[3]) << 24;

22  
»suÉ
;

23 
	}
}

36 
	$sc_muÏdd
(*
s
,cÚ¡ *
a
,cÚ¡ *
b
,cÚ¡ *
c
)

38 
üy±o_št64
 
a0
 = 2097151 & 
	`lßd_3
(
a
);

39 
üy±o_št64
 
a1
 = 2097151 & (
	`lßd_4
(
a
 + 2) >> 5);

40 
üy±o_št64
 
a2
 = 2097151 & (
	`lßd_3
(
a
 + 5) >> 2);

41 
üy±o_št64
 
a3
 = 2097151 & (
	`lßd_4
(
a
 + 7) >> 7);

42 
üy±o_št64
 
a4
 = 2097151 & (
	`lßd_4
(
a
 + 10) >> 4);

43 
üy±o_št64
 
a5
 = 2097151 & (
	`lßd_3
(
a
 + 13) >> 1);

44 
üy±o_št64
 
a6
 = 2097151 & (
	`lßd_4
(
a
 + 15) >> 6);

45 
üy±o_št64
 
a7
 = 2097151 & (
	`lßd_3
(
a
 + 18) >> 3);

46 
üy±o_št64
 
a8
 = 2097151 & 
	`lßd_3
(
a
 + 21);

47 
üy±o_št64
 
a9
 = 2097151 & (
	`lßd_4
(
a
 + 23) >> 5);

48 
üy±o_št64
 
a10
 = 2097151 & (
	`lßd_3
(
a
 + 26) >> 2);

49 
üy±o_št64
 
a11
 = (
	`lßd_4
(
a
 + 28) >> 7);

50 
üy±o_št64
 
b0
 = 2097151 & 
	`lßd_3
(
b
);

51 
üy±o_št64
 
b1
 = 2097151 & (
	`lßd_4
(
b
 + 2) >> 5);

52 
üy±o_št64
 
b2
 = 2097151 & (
	`lßd_3
(
b
 + 5) >> 2);

53 
üy±o_št64
 
b3
 = 2097151 & (
	`lßd_4
(
b
 + 7) >> 7);

54 
üy±o_št64
 
b4
 = 2097151 & (
	`lßd_4
(
b
 + 10) >> 4);

55 
üy±o_št64
 
b5
 = 2097151 & (
	`lßd_3
(
b
 + 13) >> 1);

56 
üy±o_št64
 
b6
 = 2097151 & (
	`lßd_4
(
b
 + 15) >> 6);

57 
üy±o_št64
 
b7
 = 2097151 & (
	`lßd_3
(
b
 + 18) >> 3);

58 
üy±o_št64
 
b8
 = 2097151 & 
	`lßd_3
(
b
 + 21);

59 
üy±o_št64
 
b9
 = 2097151 & (
	`lßd_4
(
b
 + 23) >> 5);

60 
üy±o_št64
 
b10
 = 2097151 & (
	`lßd_3
(
b
 + 26) >> 2);

61 
üy±o_št64
 
b11
 = (
	`lßd_4
(
b
 + 28) >> 7);

62 
üy±o_št64
 
c0
 = 2097151 & 
	`lßd_3
(
c
);

63 
üy±o_št64
 
c1
 = 2097151 & (
	`lßd_4
(
c
 + 2) >> 5);

64 
üy±o_št64
 
c2
 = 2097151 & (
	`lßd_3
(
c
 + 5) >> 2);

65 
üy±o_št64
 
c3
 = 2097151 & (
	`lßd_4
(
c
 + 7) >> 7);

66 
üy±o_št64
 
c4
 = 2097151 & (
	`lßd_4
(
c
 + 10) >> 4);

67 
üy±o_št64
 
c5
 = 2097151 & (
	`lßd_3
(
c
 + 13) >> 1);

68 
üy±o_št64
 
c6
 = 2097151 & (
	`lßd_4
(
c
 + 15) >> 6);

69 
üy±o_št64
 
c7
 = 2097151 & (
	`lßd_3
(
c
 + 18) >> 3);

70 
üy±o_št64
 
c8
 = 2097151 & 
	`lßd_3
(
c
 + 21);

71 
üy±o_št64
 
c9
 = 2097151 & (
	`lßd_4
(
c
 + 23) >> 5);

72 
üy±o_št64
 
c10
 = 2097151 & (
	`lßd_3
(
c
 + 26) >> 2);

73 
üy±o_št64
 
c11
 = (
	`lßd_4
(
c
 + 28) >> 7);

74 
üy±o_št64
 
s0
;

75 
üy±o_št64
 
s1
;

76 
üy±o_št64
 
s2
;

77 
üy±o_št64
 
s3
;

78 
üy±o_št64
 
s4
;

79 
üy±o_št64
 
s5
;

80 
üy±o_št64
 
s6
;

81 
üy±o_št64
 
s7
;

82 
üy±o_št64
 
s8
;

83 
üy±o_št64
 
s9
;

84 
üy±o_št64
 
s10
;

85 
üy±o_št64
 
s11
;

86 
üy±o_št64
 
s12
;

87 
üy±o_št64
 
s13
;

88 
üy±o_št64
 
s14
;

89 
üy±o_št64
 
s15
;

90 
üy±o_št64
 
s16
;

91 
üy±o_št64
 
s17
;

92 
üy±o_št64
 
s18
;

93 
üy±o_št64
 
s19
;

94 
üy±o_št64
 
s20
;

95 
üy±o_št64
 
s21
;

96 
üy±o_št64
 
s22
;

97 
üy±o_št64
 
s23
;

98 
üy±o_št64
 
ÿ¼y0
;

99 
üy±o_št64
 
ÿ¼y1
;

100 
üy±o_št64
 
ÿ¼y2
;

101 
üy±o_št64
 
ÿ¼y3
;

102 
üy±o_št64
 
ÿ¼y4
;

103 
üy±o_št64
 
ÿ¼y5
;

104 
üy±o_št64
 
ÿ¼y6
;

105 
üy±o_št64
 
ÿ¼y7
;

106 
üy±o_št64
 
ÿ¼y8
;

107 
üy±o_št64
 
ÿ¼y9
;

108 
üy±o_št64
 
ÿ¼y10
;

109 
üy±o_št64
 
ÿ¼y11
;

110 
üy±o_št64
 
ÿ¼y12
;

111 
üy±o_št64
 
ÿ¼y13
;

112 
üy±o_št64
 
ÿ¼y14
;

113 
üy±o_št64
 
ÿ¼y15
;

114 
üy±o_št64
 
ÿ¼y16
;

115 
üy±o_št64
 
ÿ¼y17
;

116 
üy±o_št64
 
ÿ¼y18
;

117 
üy±o_št64
 
ÿ¼y19
;

118 
üy±o_št64
 
ÿ¼y20
;

119 
üy±o_št64
 
ÿ¼y21
;

120 
üy±o_št64
 
ÿ¼y22
;

122 
s0
 = 
c0
 + 
a0
*
b0
;

123 
s1
 = 
c1
 + 
a0
*
b1
 + 
a1
*
b0
;

124 
s2
 = 
c2
 + 
a0
*
b2
 + 
a1
*
b1
 + 
a2
*
b0
;

125 
s3
 = 
c3
 + 
a0
*
b3
 + 
a1
*
b2
 + 
a2
*
b1
 + 
a3
*
b0
;

126 
s4
 = 
c4
 + 
a0
*
b4
 + 
a1
*
b3
 + 
a2
*
b2
 + 
a3
*
b1
 + 
a4
*
b0
;

127 
s5
 = 
c5
 + 
a0
*
b5
 + 
a1
*
b4
 + 
a2
*
b3
 + 
a3
*
b2
 + 
a4
*
b1
 + 
a5
*
b0
;

128 
s6
 = 
c6
 + 
a0
*
b6
 + 
a1
*
b5
 + 
a2
*
b4
 + 
a3
*
b3
 + 
a4
*
b2
 + 
a5
*
b1
 + 
a6
*
b0
;

129 
s7
 = 
c7
 + 
a0
*
b7
 + 
a1
*
b6
 + 
a2
*
b5
 + 
a3
*
b4
 + 
a4
*
b3
 + 
a5
*
b2
 + 
a6
*
b1
 + 
a7
*
b0
;

130 
s8
 = 
c8
 + 
a0
*
b8
 + 
a1
*
b7
 + 
a2
*
b6
 + 
a3
*
b5
 + 
a4
*
b4
 + 
a5
*
b3
 + 
a6
*
b2
 + 
a7
*
b1
 + 
a8
*
b0
;

131 
s9
 = 
c9
 + 
a0
*
b9
 + 
a1
*
b8
 + 
a2
*
b7
 + 
a3
*
b6
 + 
a4
*
b5
 + 
a5
*
b4
 + 
a6
*
b3
 + 
a7
*
b2
 + 
a8
*
b1
 + 
a9
*
b0
;

132 
s10
 = 
c10
 + 
a0
*
b10
 + 
a1
*
b9
 + 
a2
*
b8
 + 
a3
*
b7
 + 
a4
*
b6
 + 
a5
*
b5
 + 
a6
*
b4
 + 
a7
*
b3
 + 
a8
*
b2
 + 
a9
*
b1
 + 
a10
*
b0
;

133 
s11
 = 
c11
 + 
a0
*
b11
 + 
a1
*
b10
 + 
a2
*
b9
 + 
a3
*
b8
 + 
a4
*
b7
 + 
a5
*
b6
 + 
a6
*
b5
 + 
a7
*
b4
 + 
a8
*
b3
 + 
a9
*
b2
 + 
a10
*
b1
 + 
a11
*
b0
;

134 
s12
 = 
a1
*
b11
 + 
a2
*
b10
 + 
a3
*
b9
 + 
a4
*
b8
 + 
a5
*
b7
 + 
a6
*
b6
 + 
a7
*
b5
 + 
a8
*
b4
 + 
a9
*
b3
 + 
a10
*
b2
 + 
a11
*
b1
;

135 
s13
 = 
a2
*
b11
 + 
a3
*
b10
 + 
a4
*
b9
 + 
a5
*
b8
 + 
a6
*
b7
 + 
a7
*
b6
 + 
a8
*
b5
 + 
a9
*
b4
 + 
a10
*
b3
 + 
a11
*
b2
;

136 
s14
 = 
a3
*
b11
 + 
a4
*
b10
 + 
a5
*
b9
 + 
a6
*
b8
 + 
a7
*
b7
 + 
a8
*
b6
 + 
a9
*
b5
 + 
a10
*
b4
 + 
a11
*
b3
;

137 
s15
 = 
a4
*
b11
 + 
a5
*
b10
 + 
a6
*
b9
 + 
a7
*
b8
 + 
a8
*
b7
 + 
a9
*
b6
 + 
a10
*
b5
 + 
a11
*
b4
;

138 
s16
 = 
a5
*
b11
 + 
a6
*
b10
 + 
a7
*
b9
 + 
a8
*
b8
 + 
a9
*
b7
 + 
a10
*
b6
 + 
a11
*
b5
;

139 
s17
 = 
a6
*
b11
 + 
a7
*
b10
 + 
a8
*
b9
 + 
a9
*
b8
 + 
a10
*
b7
 + 
a11
*
b6
;

140 
s18
 = 
a7
*
b11
 + 
a8
*
b10
 + 
a9
*
b9
 + 
a10
*
b8
 + 
a11
*
b7
;

141 
s19
 = 
a8
*
b11
 + 
a9
*
b10
 + 
a10
*
b9
 + 
a11
*
b8
;

142 
s20
 = 
a9
*
b11
 + 
a10
*
b10
 + 
a11
*
b9
;

143 
s21
 = 
a10
*
b11
 + 
a11
*
b10
;

144 
s22
 = 
a11
*
b11
;

145 
s23
 = 0;

147 
ÿ¼y0
 = (
s0
 + (1<<20)è>> 21; 
s1
 += carry0; s0 -= carry0 << 21;

148 
ÿ¼y2
 = (
s2
 + (1<<20)è>> 21; 
s3
 += carry2; s2 -= carry2 << 21;

149 
ÿ¼y4
 = (
s4
 + (1<<20)è>> 21; 
s5
 += carry4; s4 -= carry4 << 21;

150 
ÿ¼y6
 = (
s6
 + (1<<20)è>> 21; 
s7
 += carry6; s6 -= carry6 << 21;

151 
ÿ¼y8
 = (
s8
 + (1<<20)è>> 21; 
s9
 += carry8; s8 -= carry8 << 21;

152 
ÿ¼y10
 = (
s10
 + (1<<20)è>> 21; 
s11
 += carry10; s10 -= carry10 << 21;

153 
ÿ¼y12
 = (
s12
 + (1<<20)è>> 21; 
s13
 += carry12; s12 -= carry12 << 21;

154 
ÿ¼y14
 = (
s14
 + (1<<20)è>> 21; 
s15
 += carry14; s14 -= carry14 << 21;

155 
ÿ¼y16
 = (
s16
 + (1<<20)è>> 21; 
s17
 += carry16; s16 -= carry16 << 21;

156 
ÿ¼y18
 = (
s18
 + (1<<20)è>> 21; 
s19
 += carry18; s18 -= carry18 << 21;

157 
ÿ¼y20
 = (
s20
 + (1<<20)è>> 21; 
s21
 += carry20; s20 -= carry20 << 21;

158 
ÿ¼y22
 = (
s22
 + (1<<20)è>> 21; 
s23
 += carry22; s22 -= carry22 << 21;

160 
ÿ¼y1
 = (
s1
 + (1<<20)è>> 21; 
s2
 += carry1; s1 -= carry1 << 21;

161 
ÿ¼y3
 = (
s3
 + (1<<20)è>> 21; 
s4
 += carry3; s3 -= carry3 << 21;

162 
ÿ¼y5
 = (
s5
 + (1<<20)è>> 21; 
s6
 += carry5; s5 -= carry5 << 21;

163 
ÿ¼y7
 = (
s7
 + (1<<20)è>> 21; 
s8
 += carry7; s7 -= carry7 << 21;

164 
ÿ¼y9
 = (
s9
 + (1<<20)è>> 21; 
s10
 += carry9; s9 -= carry9 << 21;

165 
ÿ¼y11
 = (
s11
 + (1<<20)è>> 21; 
s12
 += carry11; s11 -= carry11 << 21;

166 
ÿ¼y13
 = (
s13
 + (1<<20)è>> 21; 
s14
 += carry13; s13 -= carry13 << 21;

167 
ÿ¼y15
 = (
s15
 + (1<<20)è>> 21; 
s16
 += carry15; s15 -= carry15 << 21;

168 
ÿ¼y17
 = (
s17
 + (1<<20)è>> 21; 
s18
 += carry17; s17 -= carry17 << 21;

169 
ÿ¼y19
 = (
s19
 + (1<<20)è>> 21; 
s20
 += carry19; s19 -= carry19 << 21;

170 
ÿ¼y21
 = (
s21
 + (1<<20)è>> 21; 
s22
 += carry21; s21 -= carry21 << 21;

172 
s11
 +ð
s23
 * 666643;

173 
s12
 +ð
s23
 * 470296;

174 
s13
 +ð
s23
 * 654183;

175 
s14
 -ð
s23
 * 997805;

176 
s15
 +ð
s23
 * 136657;

177 
s16
 -ð
s23
 * 683901;

178 
s23
 = 0;

180 
s10
 +ð
s22
 * 666643;

181 
s11
 +ð
s22
 * 470296;

182 
s12
 +ð
s22
 * 654183;

183 
s13
 -ð
s22
 * 997805;

184 
s14
 +ð
s22
 * 136657;

185 
s15
 -ð
s22
 * 683901;

186 
s22
 = 0;

188 
s9
 +ð
s21
 * 666643;

189 
s10
 +ð
s21
 * 470296;

190 
s11
 +ð
s21
 * 654183;

191 
s12
 -ð
s21
 * 997805;

192 
s13
 +ð
s21
 * 136657;

193 
s14
 -ð
s21
 * 683901;

194 
s21
 = 0;

196 
s8
 +ð
s20
 * 666643;

197 
s9
 +ð
s20
 * 470296;

198 
s10
 +ð
s20
 * 654183;

199 
s11
 -ð
s20
 * 997805;

200 
s12
 +ð
s20
 * 136657;

201 
s13
 -ð
s20
 * 683901;

202 
s20
 = 0;

204 
s7
 +ð
s19
 * 666643;

205 
s8
 +ð
s19
 * 470296;

206 
s9
 +ð
s19
 * 654183;

207 
s10
 -ð
s19
 * 997805;

208 
s11
 +ð
s19
 * 136657;

209 
s12
 -ð
s19
 * 683901;

210 
s19
 = 0;

212 
s6
 +ð
s18
 * 666643;

213 
s7
 +ð
s18
 * 470296;

214 
s8
 +ð
s18
 * 654183;

215 
s9
 -ð
s18
 * 997805;

216 
s10
 +ð
s18
 * 136657;

217 
s11
 -ð
s18
 * 683901;

218 
s18
 = 0;

220 
ÿ¼y6
 = (
s6
 + (1<<20)è>> 21; 
s7
 += carry6; s6 -= carry6 << 21;

221 
ÿ¼y8
 = (
s8
 + (1<<20)è>> 21; 
s9
 += carry8; s8 -= carry8 << 21;

222 
ÿ¼y10
 = (
s10
 + (1<<20)è>> 21; 
s11
 += carry10; s10 -= carry10 << 21;

223 
ÿ¼y12
 = (
s12
 + (1<<20)è>> 21; 
s13
 += carry12; s12 -= carry12 << 21;

224 
ÿ¼y14
 = (
s14
 + (1<<20)è>> 21; 
s15
 += carry14; s14 -= carry14 << 21;

225 
ÿ¼y16
 = (
s16
 + (1<<20)è>> 21; 
s17
 += carry16; s16 -= carry16 << 21;

227 
ÿ¼y7
 = (
s7
 + (1<<20)è>> 21; 
s8
 += carry7; s7 -= carry7 << 21;

228 
ÿ¼y9
 = (
s9
 + (1<<20)è>> 21; 
s10
 += carry9; s9 -= carry9 << 21;

229 
ÿ¼y11
 = (
s11
 + (1<<20)è>> 21; 
s12
 += carry11; s11 -= carry11 << 21;

230 
ÿ¼y13
 = (
s13
 + (1<<20)è>> 21; 
s14
 += carry13; s13 -= carry13 << 21;

231 
ÿ¼y15
 = (
s15
 + (1<<20)è>> 21; 
s16
 += carry15; s15 -= carry15 << 21;

233 
s5
 +ð
s17
 * 666643;

234 
s6
 +ð
s17
 * 470296;

235 
s7
 +ð
s17
 * 654183;

236 
s8
 -ð
s17
 * 997805;

237 
s9
 +ð
s17
 * 136657;

238 
s10
 -ð
s17
 * 683901;

239 
s17
 = 0;

241 
s4
 +ð
s16
 * 666643;

242 
s5
 +ð
s16
 * 470296;

243 
s6
 +ð
s16
 * 654183;

244 
s7
 -ð
s16
 * 997805;

245 
s8
 +ð
s16
 * 136657;

246 
s9
 -ð
s16
 * 683901;

247 
s16
 = 0;

249 
s3
 +ð
s15
 * 666643;

250 
s4
 +ð
s15
 * 470296;

251 
s5
 +ð
s15
 * 654183;

252 
s6
 -ð
s15
 * 997805;

253 
s7
 +ð
s15
 * 136657;

254 
s8
 -ð
s15
 * 683901;

255 
s15
 = 0;

257 
s2
 +ð
s14
 * 666643;

258 
s3
 +ð
s14
 * 470296;

259 
s4
 +ð
s14
 * 654183;

260 
s5
 -ð
s14
 * 997805;

261 
s6
 +ð
s14
 * 136657;

262 
s7
 -ð
s14
 * 683901;

263 
s14
 = 0;

265 
s1
 +ð
s13
 * 666643;

266 
s2
 +ð
s13
 * 470296;

267 
s3
 +ð
s13
 * 654183;

268 
s4
 -ð
s13
 * 997805;

269 
s5
 +ð
s13
 * 136657;

270 
s6
 -ð
s13
 * 683901;

271 
s13
 = 0;

273 
s0
 +ð
s12
 * 666643;

274 
s1
 +ð
s12
 * 470296;

275 
s2
 +ð
s12
 * 654183;

276 
s3
 -ð
s12
 * 997805;

277 
s4
 +ð
s12
 * 136657;

278 
s5
 -ð
s12
 * 683901;

279 
s12
 = 0;

281 
ÿ¼y0
 = (
s0
 + (1<<20)è>> 21; 
s1
 += carry0; s0 -= carry0 << 21;

282 
ÿ¼y2
 = (
s2
 + (1<<20)è>> 21; 
s3
 += carry2; s2 -= carry2 << 21;

283 
ÿ¼y4
 = (
s4
 + (1<<20)è>> 21; 
s5
 += carry4; s4 -= carry4 << 21;

284 
ÿ¼y6
 = (
s6
 + (1<<20)è>> 21; 
s7
 += carry6; s6 -= carry6 << 21;

285 
ÿ¼y8
 = (
s8
 + (1<<20)è>> 21; 
s9
 += carry8; s8 -= carry8 << 21;

286 
ÿ¼y10
 = (
s10
 + (1<<20)è>> 21; 
s11
 += carry10; s10 -= carry10 << 21;

288 
ÿ¼y1
 = (
s1
 + (1<<20)è>> 21; 
s2
 += carry1; s1 -= carry1 << 21;

289 
ÿ¼y3
 = (
s3
 + (1<<20)è>> 21; 
s4
 += carry3; s3 -= carry3 << 21;

290 
ÿ¼y5
 = (
s5
 + (1<<20)è>> 21; 
s6
 += carry5; s5 -= carry5 << 21;

291 
ÿ¼y7
 = (
s7
 + (1<<20)è>> 21; 
s8
 += carry7; s7 -= carry7 << 21;

292 
ÿ¼y9
 = (
s9
 + (1<<20)è>> 21; 
s10
 += carry9; s9 -= carry9 << 21;

293 
ÿ¼y11
 = (
s11
 + (1<<20)è>> 21; 
s12
 += carry11; s11 -= carry11 << 21;

295 
s0
 +ð
s12
 * 666643;

296 
s1
 +ð
s12
 * 470296;

297 
s2
 +ð
s12
 * 654183;

298 
s3
 -ð
s12
 * 997805;

299 
s4
 +ð
s12
 * 136657;

300 
s5
 -ð
s12
 * 683901;

301 
s12
 = 0;

303 
ÿ¼y0
 = 
s0
 >> 21; 
s1
 += carry0; s0 -= carry0 << 21;

304 
ÿ¼y1
 = 
s1
 >> 21; 
s2
 += carry1; s1 -= carry1 << 21;

305 
ÿ¼y2
 = 
s2
 >> 21; 
s3
 += carry2; s2 -= carry2 << 21;

306 
ÿ¼y3
 = 
s3
 >> 21; 
s4
 += carry3; s3 -= carry3 << 21;

307 
ÿ¼y4
 = 
s4
 >> 21; 
s5
 += carry4; s4 -= carry4 << 21;

308 
ÿ¼y5
 = 
s5
 >> 21; 
s6
 += carry5; s5 -= carry5 << 21;

309 
ÿ¼y6
 = 
s6
 >> 21; 
s7
 += carry6; s6 -= carry6 << 21;

310 
ÿ¼y7
 = 
s7
 >> 21; 
s8
 += carry7; s7 -= carry7 << 21;

311 
ÿ¼y8
 = 
s8
 >> 21; 
s9
 += carry8; s8 -= carry8 << 21;

312 
ÿ¼y9
 = 
s9
 >> 21; 
s10
 += carry9; s9 -= carry9 << 21;

313 
ÿ¼y10
 = 
s10
 >> 21; 
s11
 += carry10; s10 -= carry10 << 21;

314 
ÿ¼y11
 = 
s11
 >> 21; 
s12
 += carry11; s11 -= carry11 << 21;

316 
s0
 +ð
s12
 * 666643;

317 
s1
 +ð
s12
 * 470296;

318 
s2
 +ð
s12
 * 654183;

319 
s3
 -ð
s12
 * 997805;

320 
s4
 +ð
s12
 * 136657;

321 
s5
 -ð
s12
 * 683901;

322 
s12
 = 0;

324 
ÿ¼y0
 = 
s0
 >> 21; 
s1
 += carry0; s0 -= carry0 << 21;

325 
ÿ¼y1
 = 
s1
 >> 21; 
s2
 += carry1; s1 -= carry1 << 21;

326 
ÿ¼y2
 = 
s2
 >> 21; 
s3
 += carry2; s2 -= carry2 << 21;

327 
ÿ¼y3
 = 
s3
 >> 21; 
s4
 += carry3; s3 -= carry3 << 21;

328 
ÿ¼y4
 = 
s4
 >> 21; 
s5
 += carry4; s4 -= carry4 << 21;

329 
ÿ¼y5
 = 
s5
 >> 21; 
s6
 += carry5; s5 -= carry5 << 21;

330 
ÿ¼y6
 = 
s6
 >> 21; 
s7
 += carry6; s6 -= carry6 << 21;

331 
ÿ¼y7
 = 
s7
 >> 21; 
s8
 += carry7; s7 -= carry7 << 21;

332 
ÿ¼y8
 = 
s8
 >> 21; 
s9
 += carry8; s8 -= carry8 << 21;

333 
ÿ¼y9
 = 
s9
 >> 21; 
s10
 += carry9; s9 -= carry9 << 21;

334 
ÿ¼y10
 = 
s10
 >> 21; 
s11
 += carry10; s10 -= carry10 << 21;

336 
s
[0] = 
s0
 >> 0;

337 
s
[1] = 
s0
 >> 8;

338 
s
[2] = (
s0
 >> 16è| (
s1
 << 5);

339 
s
[3] = 
s1
 >> 3;

340 
s
[4] = 
s1
 >> 11;

341 
s
[5] = (
s1
 >> 19è| (
s2
 << 2);

342 
s
[6] = 
s2
 >> 6;

343 
s
[7] = (
s2
 >> 14è| (
s3
 << 7);

344 
s
[8] = 
s3
 >> 1;

345 
s
[9] = 
s3
 >> 9;

346 
s
[10] = (
s3
 >> 17è| (
s4
 << 4);

347 
s
[11] = 
s4
 >> 4;

348 
s
[12] = 
s4
 >> 12;

349 
s
[13] = (
s4
 >> 20è| (
s5
 << 1);

350 
s
[14] = 
s5
 >> 7;

351 
s
[15] = (
s5
 >> 15è| (
s6
 << 6);

352 
s
[16] = 
s6
 >> 2;

353 
s
[17] = 
s6
 >> 10;

354 
s
[18] = (
s6
 >> 18è| (
s7
 << 3);

355 
s
[19] = 
s7
 >> 5;

356 
s
[20] = 
s7
 >> 13;

357 
s
[21] = 
s8
 >> 0;

358 
s
[22] = 
s8
 >> 8;

359 
s
[23] = (
s8
 >> 16è| (
s9
 << 5);

360 
s
[24] = 
s9
 >> 3;

361 
s
[25] = 
s9
 >> 11;

362 
s
[26] = (
s9
 >> 19è| (
s10
 << 2);

363 
s
[27] = 
s10
 >> 6;

364 
s
[28] = (
s10
 >> 14è| (
s11
 << 7);

365 
s
[29] = 
s11
 >> 1;

366 
s
[30] = 
s11
 >> 9;

367 
s
[31] = 
s11
 >> 17;

368 
	}
}

	@plugins/auth/ref10/sc_reduce.c

1 
	~"sc.h
"

2 
	~"üy±o_št64.h
"

3 
	~"üy±o_ušt32.h
"

4 
	~"üy±o_ušt64.h
"

6 
üy±o_ušt64
 
	$lßd_3
(cÚ¡ *
š
)

8 
üy±o_ušt64
 
»suÉ
;

9 
»suÉ
 = (
üy±o_ušt64
è
š
[0];

10 
»suÉ
 |ð((
üy±o_ušt64
è
š
[1]) << 8;

11 
»suÉ
 |ð((
üy±o_ušt64
è
š
[2]) << 16;

12  
»suÉ
;

13 
	}
}

15 
üy±o_ušt64
 
	$lßd_4
(cÚ¡ *
š
)

17 
üy±o_ušt64
 
»suÉ
;

18 
»suÉ
 = (
üy±o_ušt64
è
š
[0];

19 
»suÉ
 |ð((
üy±o_ušt64
è
š
[1]) << 8;

20 
»suÉ
 |ð((
üy±o_ušt64
è
š
[2]) << 16;

21 
»suÉ
 |ð((
üy±o_ušt64
è
š
[3]) << 24;

22  
»suÉ
;

23 
	}
}

35 
	$sc_»duû
(*
s
)

37 
üy±o_št64
 
s0
 = 2097151 & 
	`lßd_3
(
s
);

38 
üy±o_št64
 
s1
 = 2097151 & (
	`lßd_4
(
s
 + 2) >> 5);

39 
üy±o_št64
 
s2
 = 2097151 & (
	`lßd_3
(
s
 + 5) >> 2);

40 
üy±o_št64
 
s3
 = 2097151 & (
	`lßd_4
(
s
 + 7) >> 7);

41 
üy±o_št64
 
s4
 = 2097151 & (
	`lßd_4
(
s
 + 10) >> 4);

42 
üy±o_št64
 
s5
 = 2097151 & (
	`lßd_3
(
s
 + 13) >> 1);

43 
üy±o_št64
 
s6
 = 2097151 & (
	`lßd_4
(
s
 + 15) >> 6);

44 
üy±o_št64
 
s7
 = 2097151 & (
	`lßd_3
(
s
 + 18) >> 3);

45 
üy±o_št64
 
s8
 = 2097151 & 
	`lßd_3
(
s
 + 21);

46 
üy±o_št64
 
s9
 = 2097151 & (
	`lßd_4
(
s
 + 23) >> 5);

47 
üy±o_št64
 
s10
 = 2097151 & (
	`lßd_3
(
s
 + 26) >> 2);

48 
üy±o_št64
 
s11
 = 2097151 & (
	`lßd_4
(
s
 + 28) >> 7);

49 
üy±o_št64
 
s12
 = 2097151 & (
	`lßd_4
(
s
 + 31) >> 4);

50 
üy±o_št64
 
s13
 = 2097151 & (
	`lßd_3
(
s
 + 34) >> 1);

51 
üy±o_št64
 
s14
 = 2097151 & (
	`lßd_4
(
s
 + 36) >> 6);

52 
üy±o_št64
 
s15
 = 2097151 & (
	`lßd_3
(
s
 + 39) >> 3);

53 
üy±o_št64
 
s16
 = 2097151 & 
	`lßd_3
(
s
 + 42);

54 
üy±o_št64
 
s17
 = 2097151 & (
	`lßd_4
(
s
 + 44) >> 5);

55 
üy±o_št64
 
s18
 = 2097151 & (
	`lßd_3
(
s
 + 47) >> 2);

56 
üy±o_št64
 
s19
 = 2097151 & (
	`lßd_4
(
s
 + 49) >> 7);

57 
üy±o_št64
 
s20
 = 2097151 & (
	`lßd_4
(
s
 + 52) >> 4);

58 
üy±o_št64
 
s21
 = 2097151 & (
	`lßd_3
(
s
 + 55) >> 1);

59 
üy±o_št64
 
s22
 = 2097151 & (
	`lßd_4
(
s
 + 57) >> 6);

60 
üy±o_št64
 
s23
 = (
	`lßd_4
(
s
 + 60) >> 3);

61 
üy±o_št64
 
ÿ¼y0
;

62 
üy±o_št64
 
ÿ¼y1
;

63 
üy±o_št64
 
ÿ¼y2
;

64 
üy±o_št64
 
ÿ¼y3
;

65 
üy±o_št64
 
ÿ¼y4
;

66 
üy±o_št64
 
ÿ¼y5
;

67 
üy±o_št64
 
ÿ¼y6
;

68 
üy±o_št64
 
ÿ¼y7
;

69 
üy±o_št64
 
ÿ¼y8
;

70 
üy±o_št64
 
ÿ¼y9
;

71 
üy±o_št64
 
ÿ¼y10
;

72 
üy±o_št64
 
ÿ¼y11
;

73 
üy±o_št64
 
ÿ¼y12
;

74 
üy±o_št64
 
ÿ¼y13
;

75 
üy±o_št64
 
ÿ¼y14
;

76 
üy±o_št64
 
ÿ¼y15
;

77 
üy±o_št64
 
ÿ¼y16
;

79 
s11
 +ð
s23
 * 666643;

80 
s12
 +ð
s23
 * 470296;

81 
s13
 +ð
s23
 * 654183;

82 
s14
 -ð
s23
 * 997805;

83 
s15
 +ð
s23
 * 136657;

84 
s16
 -ð
s23
 * 683901;

85 
s23
 = 0;

87 
s10
 +ð
s22
 * 666643;

88 
s11
 +ð
s22
 * 470296;

89 
s12
 +ð
s22
 * 654183;

90 
s13
 -ð
s22
 * 997805;

91 
s14
 +ð
s22
 * 136657;

92 
s15
 -ð
s22
 * 683901;

93 
s22
 = 0;

95 
s9
 +ð
s21
 * 666643;

96 
s10
 +ð
s21
 * 470296;

97 
s11
 +ð
s21
 * 654183;

98 
s12
 -ð
s21
 * 997805;

99 
s13
 +ð
s21
 * 136657;

100 
s14
 -ð
s21
 * 683901;

101 
s21
 = 0;

103 
s8
 +ð
s20
 * 666643;

104 
s9
 +ð
s20
 * 470296;

105 
s10
 +ð
s20
 * 654183;

106 
s11
 -ð
s20
 * 997805;

107 
s12
 +ð
s20
 * 136657;

108 
s13
 -ð
s20
 * 683901;

109 
s20
 = 0;

111 
s7
 +ð
s19
 * 666643;

112 
s8
 +ð
s19
 * 470296;

113 
s9
 +ð
s19
 * 654183;

114 
s10
 -ð
s19
 * 997805;

115 
s11
 +ð
s19
 * 136657;

116 
s12
 -ð
s19
 * 683901;

117 
s19
 = 0;

119 
s6
 +ð
s18
 * 666643;

120 
s7
 +ð
s18
 * 470296;

121 
s8
 +ð
s18
 * 654183;

122 
s9
 -ð
s18
 * 997805;

123 
s10
 +ð
s18
 * 136657;

124 
s11
 -ð
s18
 * 683901;

125 
s18
 = 0;

127 
ÿ¼y6
 = (
s6
 + (1<<20)è>> 21; 
s7
 += carry6; s6 -= carry6 << 21;

128 
ÿ¼y8
 = (
s8
 + (1<<20)è>> 21; 
s9
 += carry8; s8 -= carry8 << 21;

129 
ÿ¼y10
 = (
s10
 + (1<<20)è>> 21; 
s11
 += carry10; s10 -= carry10 << 21;

130 
ÿ¼y12
 = (
s12
 + (1<<20)è>> 21; 
s13
 += carry12; s12 -= carry12 << 21;

131 
ÿ¼y14
 = (
s14
 + (1<<20)è>> 21; 
s15
 += carry14; s14 -= carry14 << 21;

132 
ÿ¼y16
 = (
s16
 + (1<<20)è>> 21; 
s17
 += carry16; s16 -= carry16 << 21;

134 
ÿ¼y7
 = (
s7
 + (1<<20)è>> 21; 
s8
 += carry7; s7 -= carry7 << 21;

135 
ÿ¼y9
 = (
s9
 + (1<<20)è>> 21; 
s10
 += carry9; s9 -= carry9 << 21;

136 
ÿ¼y11
 = (
s11
 + (1<<20)è>> 21; 
s12
 += carry11; s11 -= carry11 << 21;

137 
ÿ¼y13
 = (
s13
 + (1<<20)è>> 21; 
s14
 += carry13; s13 -= carry13 << 21;

138 
ÿ¼y15
 = (
s15
 + (1<<20)è>> 21; 
s16
 += carry15; s15 -= carry15 << 21;

140 
s5
 +ð
s17
 * 666643;

141 
s6
 +ð
s17
 * 470296;

142 
s7
 +ð
s17
 * 654183;

143 
s8
 -ð
s17
 * 997805;

144 
s9
 +ð
s17
 * 136657;

145 
s10
 -ð
s17
 * 683901;

146 
s17
 = 0;

148 
s4
 +ð
s16
 * 666643;

149 
s5
 +ð
s16
 * 470296;

150 
s6
 +ð
s16
 * 654183;

151 
s7
 -ð
s16
 * 997805;

152 
s8
 +ð
s16
 * 136657;

153 
s9
 -ð
s16
 * 683901;

154 
s16
 = 0;

156 
s3
 +ð
s15
 * 666643;

157 
s4
 +ð
s15
 * 470296;

158 
s5
 +ð
s15
 * 654183;

159 
s6
 -ð
s15
 * 997805;

160 
s7
 +ð
s15
 * 136657;

161 
s8
 -ð
s15
 * 683901;

162 
s15
 = 0;

164 
s2
 +ð
s14
 * 666643;

165 
s3
 +ð
s14
 * 470296;

166 
s4
 +ð
s14
 * 654183;

167 
s5
 -ð
s14
 * 997805;

168 
s6
 +ð
s14
 * 136657;

169 
s7
 -ð
s14
 * 683901;

170 
s14
 = 0;

172 
s1
 +ð
s13
 * 666643;

173 
s2
 +ð
s13
 * 470296;

174 
s3
 +ð
s13
 * 654183;

175 
s4
 -ð
s13
 * 997805;

176 
s5
 +ð
s13
 * 136657;

177 
s6
 -ð
s13
 * 683901;

178 
s13
 = 0;

180 
s0
 +ð
s12
 * 666643;

181 
s1
 +ð
s12
 * 470296;

182 
s2
 +ð
s12
 * 654183;

183 
s3
 -ð
s12
 * 997805;

184 
s4
 +ð
s12
 * 136657;

185 
s5
 -ð
s12
 * 683901;

186 
s12
 = 0;

188 
ÿ¼y0
 = (
s0
 + (1<<20)è>> 21; 
s1
 += carry0; s0 -= carry0 << 21;

189 
ÿ¼y2
 = (
s2
 + (1<<20)è>> 21; 
s3
 += carry2; s2 -= carry2 << 21;

190 
ÿ¼y4
 = (
s4
 + (1<<20)è>> 21; 
s5
 += carry4; s4 -= carry4 << 21;

191 
ÿ¼y6
 = (
s6
 + (1<<20)è>> 21; 
s7
 += carry6; s6 -= carry6 << 21;

192 
ÿ¼y8
 = (
s8
 + (1<<20)è>> 21; 
s9
 += carry8; s8 -= carry8 << 21;

193 
ÿ¼y10
 = (
s10
 + (1<<20)è>> 21; 
s11
 += carry10; s10 -= carry10 << 21;

195 
ÿ¼y1
 = (
s1
 + (1<<20)è>> 21; 
s2
 += carry1; s1 -= carry1 << 21;

196 
ÿ¼y3
 = (
s3
 + (1<<20)è>> 21; 
s4
 += carry3; s3 -= carry3 << 21;

197 
ÿ¼y5
 = (
s5
 + (1<<20)è>> 21; 
s6
 += carry5; s5 -= carry5 << 21;

198 
ÿ¼y7
 = (
s7
 + (1<<20)è>> 21; 
s8
 += carry7; s7 -= carry7 << 21;

199 
ÿ¼y9
 = (
s9
 + (1<<20)è>> 21; 
s10
 += carry9; s9 -= carry9 << 21;

200 
ÿ¼y11
 = (
s11
 + (1<<20)è>> 21; 
s12
 += carry11; s11 -= carry11 << 21;

202 
s0
 +ð
s12
 * 666643;

203 
s1
 +ð
s12
 * 470296;

204 
s2
 +ð
s12
 * 654183;

205 
s3
 -ð
s12
 * 997805;

206 
s4
 +ð
s12
 * 136657;

207 
s5
 -ð
s12
 * 683901;

208 
s12
 = 0;

210 
ÿ¼y0
 = 
s0
 >> 21; 
s1
 += carry0; s0 -= carry0 << 21;

211 
ÿ¼y1
 = 
s1
 >> 21; 
s2
 += carry1; s1 -= carry1 << 21;

212 
ÿ¼y2
 = 
s2
 >> 21; 
s3
 += carry2; s2 -= carry2 << 21;

213 
ÿ¼y3
 = 
s3
 >> 21; 
s4
 += carry3; s3 -= carry3 << 21;

214 
ÿ¼y4
 = 
s4
 >> 21; 
s5
 += carry4; s4 -= carry4 << 21;

215 
ÿ¼y5
 = 
s5
 >> 21; 
s6
 += carry5; s5 -= carry5 << 21;

216 
ÿ¼y6
 = 
s6
 >> 21; 
s7
 += carry6; s6 -= carry6 << 21;

217 
ÿ¼y7
 = 
s7
 >> 21; 
s8
 += carry7; s7 -= carry7 << 21;

218 
ÿ¼y8
 = 
s8
 >> 21; 
s9
 += carry8; s8 -= carry8 << 21;

219 
ÿ¼y9
 = 
s9
 >> 21; 
s10
 += carry9; s9 -= carry9 << 21;

220 
ÿ¼y10
 = 
s10
 >> 21; 
s11
 += carry10; s10 -= carry10 << 21;

221 
ÿ¼y11
 = 
s11
 >> 21; 
s12
 += carry11; s11 -= carry11 << 21;

223 
s0
 +ð
s12
 * 666643;

224 
s1
 +ð
s12
 * 470296;

225 
s2
 +ð
s12
 * 654183;

226 
s3
 -ð
s12
 * 997805;

227 
s4
 +ð
s12
 * 136657;

228 
s5
 -ð
s12
 * 683901;

229 
s12
 = 0;

231 
ÿ¼y0
 = 
s0
 >> 21; 
s1
 += carry0; s0 -= carry0 << 21;

232 
ÿ¼y1
 = 
s1
 >> 21; 
s2
 += carry1; s1 -= carry1 << 21;

233 
ÿ¼y2
 = 
s2
 >> 21; 
s3
 += carry2; s2 -= carry2 << 21;

234 
ÿ¼y3
 = 
s3
 >> 21; 
s4
 += carry3; s3 -= carry3 << 21;

235 
ÿ¼y4
 = 
s4
 >> 21; 
s5
 += carry4; s4 -= carry4 << 21;

236 
ÿ¼y5
 = 
s5
 >> 21; 
s6
 += carry5; s5 -= carry5 << 21;

237 
ÿ¼y6
 = 
s6
 >> 21; 
s7
 += carry6; s6 -= carry6 << 21;

238 
ÿ¼y7
 = 
s7
 >> 21; 
s8
 += carry7; s7 -= carry7 << 21;

239 
ÿ¼y8
 = 
s8
 >> 21; 
s9
 += carry8; s8 -= carry8 << 21;

240 
ÿ¼y9
 = 
s9
 >> 21; 
s10
 += carry9; s9 -= carry9 << 21;

241 
ÿ¼y10
 = 
s10
 >> 21; 
s11
 += carry10; s10 -= carry10 << 21;

243 
s
[0] = 
s0
 >> 0;

244 
s
[1] = 
s0
 >> 8;

245 
s
[2] = (
s0
 >> 16è| (
s1
 << 5);

246 
s
[3] = 
s1
 >> 3;

247 
s
[4] = 
s1
 >> 11;

248 
s
[5] = (
s1
 >> 19è| (
s2
 << 2);

249 
s
[6] = 
s2
 >> 6;

250 
s
[7] = (
s2
 >> 14è| (
s3
 << 7);

251 
s
[8] = 
s3
 >> 1;

252 
s
[9] = 
s3
 >> 9;

253 
s
[10] = (
s3
 >> 17è| (
s4
 << 4);

254 
s
[11] = 
s4
 >> 4;

255 
s
[12] = 
s4
 >> 12;

256 
s
[13] = (
s4
 >> 20è| (
s5
 << 1);

257 
s
[14] = 
s5
 >> 7;

258 
s
[15] = (
s5
 >> 15è| (
s6
 << 6);

259 
s
[16] = 
s6
 >> 2;

260 
s
[17] = 
s6
 >> 10;

261 
s
[18] = (
s6
 >> 18è| (
s7
 << 3);

262 
s
[19] = 
s7
 >> 5;

263 
s
[20] = 
s7
 >> 13;

264 
s
[21] = 
s8
 >> 0;

265 
s
[22] = 
s8
 >> 8;

266 
s
[23] = (
s8
 >> 16è| (
s9
 << 5);

267 
s
[24] = 
s9
 >> 3;

268 
s
[25] = 
s9
 >> 11;

269 
s
[26] = (
s9
 >> 19è| (
s10
 << 2);

270 
s
[27] = 
s10
 >> 6;

271 
s
[28] = (
s10
 >> 14è| (
s11
 << 7);

272 
s
[29] = 
s11
 >> 1;

273 
s
[30] = 
s11
 >> 9;

274 
s
[31] = 
s11
 >> 17;

275 
	}
}

	@plugins/auth/ref10/sign.c

1 
	~<¡ršg.h
>

2 
	~"üy±o_sign.h
"

3 
	~"üy±o_hash_sha512.h
"

4 
	~"ge.h
"

5 
	~"sc.h
"

7 
	$üy±o_sign
(

8 *
sm
,

9 cÚ¡ *
m
,
mËn
,

10 cÚ¡ *
pw
,
pwËn


13 
az
[64];

14 
nÚû
[64];

15 
h¿m
[64];

16 
ge_p3
 
A
, 
R
;

18 
	`üy±o_hash_sha512
(
az
,
pw
,
pwËn
);

19 
az
[0] &= 248;

20 
az
[31] &= 63;

21 
az
[31] |= 64;

23 
	`memmove
(
sm
 + 64,
m
,
mËn
);

24 
	`memmove
(
sm
 + 32,
az
 + 32,32);

25 
	`üy±o_hash_sha512
(
nÚû
,
sm
 + 32,
mËn
 + 32);

27 
	`ge_sÿÏrmuÉ_ba£
(&
A
,
az
);

28 
	`ge_p3_toby‹s
(
sm
 + 32,&
A
);

30 
	`sc_»duû
(
nÚû
);

31 
	`ge_sÿÏrmuÉ_ba£
(&
R
,
nÚû
);

32 
	`ge_p3_toby‹s
(
sm
,&
R
);

34 
	`üy±o_hash_sha512
(
h¿m
,
sm
,
mËn
 + 64);

35 
	`sc_»duû
(
h¿m
);

36 
	`sc_muÏdd
(
sm
 + 32,
h¿m
,
az
,
nÚû
);

39 
	}
}

	@plugins/auth/ref10/sqrtm1.h

	@plugins/auth/ref10/verify.c

1 
	~"üy±o_v”ify.h
"

3 
	$üy±o_v”ify
(cÚ¡ *
x
,cÚ¡ *
y
)

5 
difã»Áb™s
 = 0;

6 
	#F
(
i
è
difã»Áb™s
 |ð
x
[i] ^ 
y
[i];

	)

7 
	`F
(0)

8 
	`F
(1)

9 
	`F
(2)

10 
	`F
(3)

11 
	`F
(4)

12 
	`F
(5)

13 
	`F
(6)

14 
	`F
(7)

15 
	`F
(8)

16 
	`F
(9)

17 
	`F
(10)

18 
	`F
(11)

19 
	`F
(12)

20 
	`F
(13)

21 
	`F
(14)

22 
	`F
(15)

23 
	`F
(16)

24 
	`F
(17)

25 
	`F
(18)

26 
	`F
(19)

27 
	`F
(20)

28 
	`F
(21)

29 
	`F
(22)

30 
	`F
(23)

31 
	`F
(24)

32 
	`F
(25)

33 
	`F
(26)

34 
	`F
(27)

35 
	`F
(28)

36 
	`F
(29)

37 
	`F
(30)

38 
	`F
(31)

39  (1 & ((
difã»Áb™s
 - 1) >> 8)) - 1;

40 
	}
}

	@plugins/auth/server_plugin.h

30 
	~<mysql/¶ugš_auth.h
>

33 
	mPLUGIN_MECH_KERBEROS
 = 0,

34 
	mPLUGIN_MECH_SPNEGO
 = 1,

35 
	mPLUGIN_MECH_DEFAULT
 = 2

36 }
	tPLUGIN_MECH
;

38 
¤v_mech
;

39 *
¤v_´šc®_Çme
;

40 *
¤v_mech_Çme
;

41 *
¤v_keyb_·th
;

48 
¶ugš_š™
();

49 
¶ugš_deš™
();

51 
auth_£rv”
(
MYSQL_PLUGIN_VIO
 *
vio
, cÚ¡ *
u£ºame
, 
size_t
 
u£ºame_Ën
, 
u£_fuÎ_Çme
);

	@plugins/auth/sha256_pw.c

19 #iâdeà
_WIN32


20 
	#_GNU_SOURCE
 1

	)

23 #ifdeà
_WIN32


24 #undeà
HAVE_GNUTLS


25 #undeà
HAVE_OPENSSL


26 
	#HAVE_WINCRYPT


	)

29 #ià
defšed
(
HAVE_OPENSSL
è|| defšed(
HAVE_WINCRYPT
)

31 
	~<ma_glob®.h
>

32 
	~<mysql.h
>

33 
	~<mysql/þ›Á_¶ugš.h
>

34 
	~<¡ršg.h
>

35 
	~<memÜy.h
>

36 
	~<”rmsg.h
>

37 
	~<ma_glob®.h
>

38 
	~<ma_sys.h
>

39 
	~<ma_commÚ.h
>

41 #iâdeà
WIN32


42 
	~<dlfú.h
>

45 #ià
defšed
(
WIN32
)

46 
	~<wšüy±.h
>

47 #–ià
defšed
(
HAVE_OPENSSL
)

48 
	~<Ý’s¦/r§.h
>

49 
	~<Ý’s¦/³m.h
>

50 
	~<Ý’s¦/”r.h
>

53 
	#MAX_PW_LEN
 1024

	)

56 
auth_sha256_þ›Á
(
MYSQL_PLUGIN_VIO
 *
vio
, 
MYSQL
 *
mysql
);

57 
auth_sha256_š™
(*
unu£d1
,

58 
size_t
 
unu£d2
,

59 
unu£d3
,

60 
va_li¡
);

63 #iâdeà
PLUGIN_DYNAMIC


64 
¡_mysql_þ›Á_¶ugš_AUTHENTICATION
 
	gsha256_·sswÜd_þ›Á_¶ugš
=

66 
¡_mysql_þ›Á_¶ugš_AUTHENTICATION
 
_mysql_þ›Á_¶ugš_deþ¬©iÚ_
 =

69 
MYSQL_CLIENT_AUTHENTICATION_PLUGIN
,

70 
MYSQL_CLIENT_AUTHENTICATION_PLUGIN_INTERFACE_VERSION
,

76 
NULL
,

77 
auth_sha256_š™
,

78 
NULL
,

79 
NULL
,

80 
auth_sha256_þ›Á


83 #ifdeà
HAVE_WINCRYPT


84 
LPBYTE
 
	$ma_lßd_³m
(cÚ¡ *
bufãr
, 
DWORD
 *
bufãr_Ën
)

86 
LPBYTE
 
d”_bufãr
ð
NULL
;

87 
DWORD
 
d”_bufãr_Ëngth
= 0;

89 ià(
bufãr_Ën
 =ð
NULL
 || *buffer_len == 0)

90  
NULL
;

92 ià(!
	`Cry±SŒšgToBš¬yA
(
bufãr
, *
bufãr_Ën
, 
CRYPT_STRING_BASE64HEADER
,

93 
NULL
, &
d”_bufãr_Ëngth
, NULL, NULL))

94 
’d
;

96 ià(!(
d”_bufãr
ð(
LPBYTE
)
	`LoÿlAÎoc
(0, 
d”_bufãr_Ëngth
)))

97 
’d
;

99 ià(!
	`Cry±SŒšgToBš¬yA
(
bufãr
, *
bufãr_Ën
, 
CRYPT_STRING_BASE64HEADER
,

100 
d”_bufãr
, &
d”_bufãr_Ëngth
, 
NULL
, NULL))

101 
’d
;

103 *
bufãr_Ën
ð
d”_bufãr_Ëngth
;

105  
d”_bufãr
;

107 
’d
:

108 ià(
d”_bufãr
)

109 
	`LoÿlF»e
(
d”_bufãr
);

110 *
bufãr_Ën
= 0;

111  
NULL
;

112 
	}
}

115 *
	$lßd_pub_key_fže
(cÚ¡ *
fž’ame
, *
pub_key_size
)

117 
FILE
 *
å
ð
NULL
;

118 *
bufãr
ð
NULL
;

119 
”rÜ
= 1;

120 
size_t
 
by‹s_»ad
= 0;

121 
fsize
= 0;

123 ià(!
pub_key_size
)

124  
NULL
;

126 ià(!(
å
ð
	`fÝ’
(
fž’ame
, "r")))

127 
’d
;

129 ià(
	`f£ek
(
å
, 0, 
SEEK_END
))

130 
’d
;

132 
fsize
ð
	`á–l
(
å
);

133 ià(
fsize
 < 0)

134 
’d
;

136 
	`»wšd
(
å
);

138 ià(!(
bufãr
ð
	`m®loc
(
fsize
 + 1)))

139 
’d
;

141 
by‹s_»ad
ð
	`ä—d
(
bufãr
, 1, (
size_t
)
fsize
, 
å
);

142 ià(
by‹s_»ad
 < (
size_t
)
fsize
)

143 
’d
;

145 *
pub_key_size
ð()
by‹s_»ad
;

147 
”rÜ
= 0;

149 
’d
:

150 ià(
å
)

151 
	`fþo£
(
å
);

152 ià(
”rÜ
 && 
bufãr
)

154 
	`ä“
(
bufãr
);

155 
bufãr
ð
NULL
;

157  
bufãr
;

158 
	}
}

161 
	$auth_sha256_þ›Á
(
MYSQL_PLUGIN_VIO
 *
vio
, 
MYSQL
 *
mysql
)

163 *
·ck‘
;

164 
·ck‘_Ëngth
;

165 
rc
ð
CR_ERROR
;

166 
·sswd
[
MAX_PW_LEN
];

167 
r§_’c_pw
[
MAX_PW_LEN
];

168 
r§_size
;

169 
pwËn
, 
i
;

171 #ià
	`defšed
(
HAVE_OPENSSL
)

172 
RSA
 *
pubkey
ð
NULL
;

173 
BIO
 *
bio
;

174 #–ià
	`defšed
(
HAVE_WINCRYPT
)

175 
HCRYPTKEY
 
pubkey
= 0;

176 
HCRYPTPROV
 
hProv
= 0;

177 
LPBYTE
 
d”_bufãr
ð
NULL
;

178 
DWORD
 
d”_bufãr_Ën
= 0;

179 
CERT_PUBLIC_KEY_INFO
 *
publicKeyInfo
ð
NULL
;

180 
DWORD
 
P¬amSize
= (DWORD);

181 
publicKeyInfoL’
= 0;

183 *
fžebufãr
ð
NULL
;

186 ià((
·ck‘_Ëngth
ð
vio
->
	`»ad_·ck‘
(vio, &
·ck‘
)) < 0)

187  
CR_ERROR
;

189 ià(
·ck‘_Ëngth
 !ð
SCRAMBLE_LENGTH
 + 1)

190  
CR_SERVER_HANDSHAKE_ERR
;

192 
	`memmove
(
mysql
->
süambË_buff
, 
·ck‘
, 
SCRAMBLE_LENGTH
);

193 
mysql
->
süambË_buff
[
SCRAMBLE_LENGTH
]= 0;

196 ià(
mysql
->
þ›Á_æag
 & 
CLIENT_SSL
)

198 ià(
vio
->
	`wr™e_·ck‘
(vio, (*)
mysql
->
·sswd
, ()
	`¡¾’
(mysql->passwd) + 1))

199  
CR_ERROR
;

200  
CR_OK
;

204 ià(!
mysql
->
·sswd
 || !mysql->passwd[0])

206 ià(
vio
->
	`wr™e_·ck‘
(vio, 0, 0))

207  
CR_ERROR
;

208  
CR_OK
;

212 ià(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
 &&

213 
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
£rv”_public_key
)

215 
fžebufãr
ð
	`lßd_pub_key_fže
(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
£rv”_public_key
,

216 &
·ck‘_Ëngth
);

221 ià(!
fžebufãr
)

223 
buf
= 1;

224 ià(
vio
->
	`wr™e_·ck‘
(vio, &
buf
, 1))

225  
CR_ERROR
;

226 ià((
·ck‘_Ëngth
=
vio
->
	`»ad_·ck‘
(vio, &
·ck‘
)) == -1)

227  
CR_ERROR
;

229 #ià
	`defšed
(
HAVE_OPENSSL
)

230 
bio
ð
	`BIO_Ãw_mem_buf
(
fžebufãr
 ? (*)fžebufã¸: 
·ck‘
,

231 
·ck‘_Ëngth
);

232 ià((
pubkey
ð
	`PEM_»ad_bio_RSA_PUBKEY
(
bio
, 
NULL
, NULL, NULL)))

233 
r§_size
ð
	`RSA_size
(
pubkey
);

234 
	`BIO_ä“
(
bio
);

235 
	`ERR_þ—r_”rÜ
();

236 #–ià
	`defšed
(
HAVE_WINCRYPT
)

237 
d”_bufãr_Ën
ð
·ck‘_Ëngth
;

240 ià(!(
d”_bufãr
ð
	`ma_lßd_³m
(
fžebufãr
 ? fžebufã¸: (*)
·ck‘
, &
d”_bufãr_Ën
)))

241 
”rÜ
;

244 ià(!
	`Cry±DecodeObjeùEx
(
X509_ASN_ENCODING
, 
X509_PUBLIC_KEY_INFO
,

245 
d”_bufãr
, 
d”_bufãr_Ën
,

246 
CRYPT_DECODE_ALLOC_FLAG
, 
NULL
,

247 &
publicKeyInfo
, (
DWORD
 *)&
publicKeyInfoL’
))

248 
”rÜ
;

249 
	`LoÿlF»e
(
d”_bufãr
);

251 ià(!
	`Cry±AcquœeCÚ‹xt
(&
hProv
, 
NULL
, NULL, 
PROV_RSA_FULL
,

252 
CRYPT_VERIFYCONTEXT
))

253 
”rÜ
;

254 ià(!
	`Cry±ImpÜtPublicKeyInfo
(
hProv
, 
X509_ASN_ENCODING
,

255 
publicKeyInfo
, &
pubkey
))

256 
”rÜ
;

259 
	`Cry±G‘KeyP¬am
(
pubkey
, 
KP_KEYLEN
, (
BYTE
 *)&
r§_size
, &
P¬amSize
, 0);

260 
r§_size
 /= 8;

262 ià(!
pubkey
)

263  
CR_ERROR
;

265 
pwËn
ð()
	`¡¾’
(
mysql
->
·sswd
) + 1;

266 ià(
pwËn
 > 
MAX_PW_LEN
)

267 
”rÜ
;

268 
	`memýy
(
·sswd
, 
mysql
->·sswd, 
pwËn
);

271 
i
=0; i < 
pwËn
; i++)

272 
·sswd
[
i
]^ð*(
mysql
->
süambË_buff
 + i % 
SCRAMBLE_LENGTH
);

275 #ià
	`defšed
(
HAVE_OPENSSL
)

276 ià(
	`RSA_public_’üy±
(
pwËn
, (*)
·sswd
, 
r§_’c_pw
, 
pubkey
, 
RSA_PKCS1_OAEP_PADDING
) < 0)

277 
”rÜ
;

278 #–ià
	`defšed
(
HAVE_WINCRYPT
)

279 ià(!
	`Cry±Enüy±
(
pubkey
, 0, 
TRUE
, 
CRYPT_OAEP
, (
BYTE
 *)
·sswd
, (
DWORD
 *)&
pwËn
, 
MAX_PW_LEN
))

280 
”rÜ
;

283 
i
ð0; i < 
r§_size
 / 2; i++)

285 
r§_’c_pw
[
i
]ð
·sswd
[
r§_size
 - 1 - i];

286 
r§_’c_pw
[
r§_size
 - 1 - 
i
]ð
·sswd
[i];

289 ià(
vio
->
	`wr™e_·ck‘
(vio, 
r§_’c_pw
, 
r§_size
))

290 
”rÜ
;

292 
rc
ð
CR_OK
;

293 
”rÜ
:

294 #ià
	`defšed
(
HAVE_OPENSSL
)

295 ià(
pubkey
)

296 
	`RSA_ä“
(
pubkey
);

297 #–ià
	`defšed
(
HAVE_WINCRYPT
)

298 
	`Cry±R–—£CÚ‹xt
(
hProv
, 0);

299 ià(
publicKeyInfo
)

300 
	`LoÿlF»e
(
publicKeyInfo
);

302 
	`ä“
(
fžebufãr
);

303  
rc
;

304 
	}
}

327 
auth_sha256_š™
(*
unu£d1
 
__©Œibu‹__
((
unu£d
)),

328 
size_t
 
unu£d2
 
__©Œibu‹__
((
unu£d
)),

329 
unu£d3
 
__©Œibu‹__
((
unu£d
)),

330 
va_li¡
 
unu£d4
 
__©Œibu‹__
((
unu£d
)))

	@plugins/auth/sspi_client.c

29 
	#SECURITY_WIN32


	)

30 
	~<wšdows.h
>

31 
	~<s¥i.h
>

32 
	~<£ûxt.h
>

33 
	~<¡d¬g.h
>

34 
	~<¡dio.h
>

35 
	~<¡dlib.h
>

37 
	~<mysql/¶ugš_auth.h
>

38 
	~<mysql.h
>

39 
	~<ma_£rv”_”rÜ.h
>

41 
	~"s¥i_commÚ.h
"

43 
log_þ›Á_”rÜ
(
MYSQL
 *
mysql
, cÚ¡ *
fmt
, ...);

44 
	$log_”rÜ
(
MYSQL
 *
mysql
, 
SECURITY_STATUS
 
”r
, cÚ¡ *
msg
)

46 ià(
”r
)

48 
buf
[1024];

49 
	`s¥i_”rmsg
(
”r
, 
buf
, (buf));

50 
	`log_þ›Á_”rÜ
(
mysql
, "SSPI cl›Áƒ¼Ü 0x%x - % - %s", 
”r
, 
msg
, 
buf
);

54 
	`log_þ›Á_”rÜ
(
mysql
, "SSPI cl›Áƒ¼Ü %s", 
msg
);

56 
	}
}

60 
	$auth_þ›Á
(*
´šc®_Çme
, *
mech
, 
MYSQL
 *
mysql
, 
MYSQL_PLUGIN_VIO
 *
vio
)

63 
»t
;

64 
C»dHªdË
 
üed
;

65 
CtxtHªdË
 
ùxt
;

66 
ULONG
 
©Œibs
 = 0;

67 
TimeSmp
 
liãtime
;

68 
SECURITY_STATUS
 
s¥i_”r
;

70 
SecBufãrDesc
 
šbuf_desc
;

71 
SecBufãr
 
šbuf
;

72 
SecBufãrDesc
 
outbuf_desc
;

73 
SecBufãr
 
outbuf
;

74 
PBYTE
 
out
 = 
NULL
;

76 
»t
ð
CR_ERROR
;

77 
	`SecInv®id©eHªdË
(&
ùxt
);

78 
	`SecInv®id©eHªdË
(&
üed
);

80 ià(!
mech
 || 
	`¡rcmp
(mech, "Negotiate") != 0)

82 
mech
= (*)"Kerberos";

85 
s¥i_”r
 = 
	`AcquœeC»d’tŸlsHªdË
(

86 
NULL
,

87 
mech
,

88 
SECPKG_CRED_OUTBOUND
,

89 
NULL
,

90 
NULL
,

91 
NULL
,

92 
NULL
,

93 &
üed
,

94 &
liãtime
);

96 ià(
	`SEC_ERROR
(
s¥i_”r
))

98 
	`log_”rÜ
(
mysql
, 
s¥i_”r
, "AcquireCredentialsHandle");

99  
CR_ERROR
;

102 
out
 = (
PBYTE
)
	`m®loc
(
SSPI_MAX_TOKEN_SIZE
);

103 ià(!
out
)

105 
	`log_”rÜ
(
mysql
, 
SEC_E_OK
, "memory‡llocationƒrror");

106 
þ—nup
;

110 
šbuf_desc
.
ulV”siÚ
 = 
SECBUFFER_VERSION
;

111 
šbuf_desc
.
cBufãrs
 = 1;

112 
šbuf_desc
.
pBufãrs
 = &
šbuf
;

113 
šbuf
.
BufãrTy³
 = 
SECBUFFER_TOKEN
;

114 
šbuf
.
cbBufãr
 = 0;

115 
šbuf
.
pvBufãr
 = 
NULL
;

117 
outbuf_desc
.
ulV”siÚ
 = 
SECBUFFER_VERSION
;

118 
outbuf_desc
.
cBufãrs
 = 1;

119 
outbuf_desc
.
pBufãrs
 = &
outbuf
;

120 
outbuf
.
BufãrTy³
 = 
SECBUFFER_TOKEN
;

121 
outbuf
.
pvBufãr
 = 
out
;

125 
outbuf
.
cbBufãr
ð
SSPI_MAX_TOKEN_SIZE
;

126 
s¥i_”r
ð
	`In™ŸlizeSecur™yCÚ‹xt
(

127 &
üed
,

128 
	`SecIsV®idHªdË
(&
ùxt
è? &ùxˆ: 
NULL
,

129 
´šc®_Çme
,

132 
SECURITY_NATIVE_DREP
,

133 
šbuf
.
cbBufãr
 ? &
šbuf_desc
 : 
NULL
,

135 &
ùxt
,

136 &
outbuf_desc
,

137 &
©Œibs
,

138 &
liãtime
);

139 ià(
	`SEC_ERROR
(
s¥i_”r
))

141 
	`log_”rÜ
(
mysql
, 
s¥i_”r
, "InitializeSecurityContext");

142 
þ—nup
;

144 ià(
s¥i_”r
 !ð
SEC_E_OK
 && s¥i_”¸!ð
SEC_I_CONTINUE_NEEDED
)

146 
	`log_”rÜ
(
mysql
, 
s¥i_”r
, "Unexpected„esponse from InitializeSecurityContext");

147 
þ—nup
;

150 ià(
outbuf
.
cbBufãr
)

153 ià(
vio
->
	`wr™e_·ck‘
(vio, (*)
outbuf
.
pvBufãr
, outbuf.
cbBufãr
))

156 
»t
ð
CR_OK_HANDSHAKE_COMPLETE
;

157 
þ—nup
;

161 ià(
s¥i_”r
 =ð
SEC_I_CONTINUE_NEEDED
)

163 
Ën
ð
vio
->
	`»ad_·ck‘
(vio, (**)&
šbuf
.
pvBufãr
);

164 ià(
Ën
 <= 0)

167 
»t
ð
CR_OK_HANDSHAKE_COMPLETE
;

168 
þ—nup
;

170 
šbuf
.
cbBufãr
ð
Ën
;

172 } 
s¥i_”r
 =ð
SEC_I_CONTINUE_NEEDED
);

174 
»t
ð
CR_OK
;

176 
þ—nup
:

178 ià(
	`SecIsV®idHªdË
(&
ùxt
))

179 
	`D–‘eSecur™yCÚ‹xt
(&
ùxt
);

180 ià(
	`SecIsV®idHªdË
(&
üed
))

181 
	`F»eC»d’tŸlsHªdË
(&
üed
);

182 
	`ä“
(
out
);

183  
»t
;

184 
	}
}

	@plugins/auth/sspi_common.h

29 
	#SECURITY_WIN32


	)

30 
	~<wšdows.h
>

31 
	~<s¥i.h
>

32 
	~<£ûxt.h
>

33 
	~<¡d¬g.h
>

34 
	~<¡dio.h
>

36 
	#SSPI_MAX_TOKEN_SIZE
 50000

	)

37 
	#SEC_ERROR
(
”r
è(Ó¼è< 0)

	)

38 
s¥i_”rmsg
(
”r
, *
buf
, 
size_t
 
size
);

	@plugins/auth/sspi_errmsg.c

29 
	~<wšdows.h
>

30 
	~<¡dio.h
>

32 #iâdeà
SEC_E_INVALID_PARAMETER


33 
	#SEC_E_INVALID_PARAMETER
 
	`_HRESULT_TYPEDEF_
(0x8009035D)

	)

35 #iâdeà
SEC_E_DELEGATION_POLICY


36 
	#SEC_E_DELEGATION_POLICY
 
	`_HRESULT_TYPEDEF_
(0x8009035E)

	)

38 #iâdeà
SEC_E_POLICY_NLTM_ONLY


39 
	#SEC_E_POLICY_NLTM_ONLY
 
	`_HRESULT_TYPEDEF_
(0x8009035F)

	)

41 #iâdeà
SEC_E_NO_CONTEXT


42 
	#SEC_E_NO_CONTEXT
 
	`_HRESULT_TYPEDEF_
(0x80090361)

	)

44 #iâdeà
SEC_E_PKU2U_CERT_FAILURE


45 
	#SEC_E_PKU2U_CERT_FAILURE
 
	`_HRESULT_TYPEDEF_
(0x80090362)

	)

47 #iâdeà
SEC_E_MUTUAL_AUTH_FAILED


48 
	#SEC_E_MUTUAL_AUTH_FAILED
 
	`_HRESULT_TYPEDEF_
(0x80090363)

	)

51 
	#ERRSYM
(
x
è{x, #x}

	)

53 
	m”rÜ
;

54 cÚ¡ *
	msym
;

55 } 
	g”rÜ_symbÞs
[] =

57 
ERRSYM
(
SEC_E_OK
),

58 
ERRSYM
(
SEC_E_INSUFFICIENT_MEMORY
),

59 
ERRSYM
(
SEC_E_INVALID_HANDLE
),

60 
ERRSYM
(
SEC_E_UNSUPPORTED_FUNCTION
),

61 
ERRSYM
(
SEC_E_TARGET_UNKNOWN
),

62 
ERRSYM
(
SEC_E_INTERNAL_ERROR
),

63 
ERRSYM
(
SEC_E_SECPKG_NOT_FOUND
),

64 
ERRSYM
(
SEC_E_NOT_OWNER
),

65 
ERRSYM
(
SEC_E_CANNOT_INSTALL
),

66 
ERRSYM
(
SEC_E_INVALID_TOKEN
),

67 
ERRSYM
(
SEC_E_CANNOT_PACK
),

68 
ERRSYM
(
SEC_E_QOP_NOT_SUPPORTED
),

69 
ERRSYM
(
SEC_E_NO_IMPERSONATION
),

70 
ERRSYM
(
SEC_E_LOGON_DENIED
),

71 
ERRSYM
(
SEC_E_UNKNOWN_CREDENTIALS
),

72 
ERRSYM
(
SEC_E_NO_CREDENTIALS
),

73 
ERRSYM
(
SEC_E_MESSAGE_ALTERED
),

74 
ERRSYM
(
SEC_E_OUT_OF_SEQUENCE
),

75 
ERRSYM
(
SEC_E_NO_AUTHENTICATING_AUTHORITY
),

76 
ERRSYM
(
SEC_E_BAD_PKGID
),

77 
ERRSYM
(
SEC_E_CONTEXT_EXPIRED
),

78 
ERRSYM
(
SEC_E_INCOMPLETE_MESSAGE
),

79 
ERRSYM
(
SEC_E_INCOMPLETE_CREDENTIALS
),

80 
ERRSYM
(
SEC_E_BUFFER_TOO_SMALL
),

81 
ERRSYM
(
SEC_E_WRONG_PRINCIPAL
),

82 
ERRSYM
(
SEC_E_TIME_SKEW
),

83 
ERRSYM
(
SEC_E_UNTRUSTED_ROOT
),

84 
ERRSYM
(
SEC_E_ILLEGAL_MESSAGE
),

85 
ERRSYM
(
SEC_E_CERT_UNKNOWN
),

86 
ERRSYM
(
SEC_E_CERT_EXPIRED
),

87 
ERRSYM
(
SEC_E_ENCRYPT_FAILURE
),

88 
ERRSYM
(
SEC_E_DECRYPT_FAILURE
),

89 
ERRSYM
(
SEC_E_ALGORITHM_MISMATCH
),

90 
ERRSYM
(
SEC_E_SECURITY_QOS_FAILED
),

91 
ERRSYM
(
SEC_E_UNFINISHED_CONTEXT_DELETED
),

92 
ERRSYM
(
SEC_E_NO_TGT_REPLY
),

93 
ERRSYM
(
SEC_E_NO_IP_ADDRESSES
),

94 
ERRSYM
(
SEC_E_WRONG_CREDENTIAL_HANDLE
),

95 
ERRSYM
(
SEC_E_CRYPTO_SYSTEM_INVALID
),

96 
ERRSYM
(
SEC_E_MAX_REFERRALS_EXCEEDED
),

97 
ERRSYM
(
SEC_E_MUST_BE_KDC
),

98 
ERRSYM
(
SEC_E_STRONG_CRYPTO_NOT_SUPPORTED
),

99 
ERRSYM
(
SEC_E_TOO_MANY_PRINCIPALS
),

100 
ERRSYM
(
SEC_E_NO_PA_DATA
),

101 
ERRSYM
(
SEC_E_PKINIT_NAME_MISMATCH
),

102 
ERRSYM
(
SEC_E_SMARTCARD_LOGON_REQUIRED
),

103 
ERRSYM
(
SEC_E_SHUTDOWN_IN_PROGRESS
),

104 
ERRSYM
(
SEC_E_KDC_INVALID_REQUEST
),

105 
ERRSYM
(
SEC_E_KDC_UNABLE_TO_REFER
),

106 
ERRSYM
(
SEC_E_KDC_UNKNOWN_ETYPE
),

107 
ERRSYM
(
SEC_E_UNSUPPORTED_PREAUTH
),

108 
ERRSYM
(
SEC_E_DELEGATION_REQUIRED
),

109 
ERRSYM
(
SEC_E_BAD_BINDINGS
),

110 
ERRSYM
(
SEC_E_MULTIPLE_ACCOUNTS
),

111 
ERRSYM
(
SEC_E_NO_KERB_KEY
),

112 
ERRSYM
(
SEC_E_CERT_WRONG_USAGE
),

113 
ERRSYM
(
SEC_E_DOWNGRADE_DETECTED
),

114 
ERRSYM
(
SEC_E_SMARTCARD_CERT_REVOKED
),

115 
ERRSYM
(
SEC_E_ISSUING_CA_UNTRUSTED
),

116 
ERRSYM
(
SEC_E_REVOCATION_OFFLINE_C
),

117 
ERRSYM
(
SEC_E_PKINIT_CLIENT_FAILURE
),

118 
ERRSYM
(
SEC_E_SMARTCARD_CERT_EXPIRED
),

119 
ERRSYM
(
SEC_E_NO_S4U_PROT_SUPPORT
),

120 
ERRSYM
(
SEC_E_CROSSREALM_DELEGATION_FAILURE
),

121 
ERRSYM
(
SEC_E_REVOCATION_OFFLINE_KDC
),

122 
ERRSYM
(
SEC_E_ISSUING_CA_UNTRUSTED_KDC
),

123 
ERRSYM
(
SEC_E_KDC_CERT_EXPIRED
),

124 
ERRSYM
(
SEC_E_KDC_CERT_REVOKED
),

125 
ERRSYM
(
SEC_E_INVALID_PARAMETER
),

126 
ERRSYM
(
SEC_E_DELEGATION_POLICY
),

127 
ERRSYM
(
SEC_E_POLICY_NLTM_ONLY
),

128 
ERRSYM
(
SEC_E_NO_CONTEXT
),

129 
ERRSYM
(
SEC_E_PKU2U_CERT_FAILURE
),

130 
ERRSYM
(
SEC_E_MUTUAL_AUTH_FAILED
),

131 
ERRSYM
(
SEC_E_NO_SPM
),

132 
ERRSYM
(
SEC_E_NOT_SUPPORTED
),

136 
	$s¥i_”rmsg
(
”r
, *
buf
, 
size_t
 
size
)

138 
size_t
 
Ën
,
i
;

140 
buf
[
size
 - 1] = 0;

141 
i
ð0; 
”rÜ_symbÞs
[i].
sym
; i++)

143 ià(
”rÜ_symbÞs
[
i
].
”rÜ
 =ð
”r
)

145 
size_t
 
Ën
ð
	`¡¾’
(
”rÜ_symbÞs
[
i
].
sym
);

146 ià(
Ën
 + 2 < 
size
)

148 
	`memýy
(
buf
, 
”rÜ_symbÞs
[
i
].
sym
, 
Ën
);

149 
buf
[
Ën
]= ' ';

150 
buf
 +ð
Ën
 + 1;

151 
size
-ð
Ën
 + 1;

157 
Ën
 = 
	`FÜm©Mes§geA
(

158 
FORMAT_MESSAGE_FROM_SYSTEM
 | 
FORMAT_MESSAGE_IGNORE_INSERTS
, 
NULL
,

159 
”r
, 
	`MAKELANGID
(
LANG_ENGLISH
, 
SUBLANG_ENGLISH_US
),

160 
buf
, (
DWORD
)
size
, 
NULL
);

162 if(
Ën
 > 0)

165 *
p
;

166 
p
ð
buf
 + 
Ën
;p > buf && (*p == '\n' || *p=='\r' || *p == 0);p--)

167 *
p
= 0;

169 
	}
}

	@plugins/connection/aurora.c

25 
	~<ma_glob®.h
>

26 
	~<ma_sys.h
>

27 
	~<”rmsg.h
>

28 
	~<ma_commÚ.h
>

29 
	~<mysql.h
>

30 
	~<mysql/þ›Á_¶ugš.h
>

31 
	~<¡ršg.h
>

32 
	~<ma_¡ršg.h
>

34 #iâdeà
WIN32


35 
	~<sys/time.h
>

39 
aurÜa_š™
(*
”rÜmsg
 
__©Œibu‹__
((
unu£d
)),

40 
size_t
 
”rÜmsg_size
 
__©Œibu‹__
((
unu£d
)),

41 
unu£d
 
__©Œibu‹__
((unused)),

42 
va_li¡
 
unu£d1
 
__©Œibu‹__
((
unu£d
)));

44 
MYSQL
 *
aurÜa_cÚÃù
(MYSQL *
mysql
, cÚ¡ *
ho¡
, cÚ¡ *
u£r
, cÚ¡ *
·sswd
,

45 cÚ¡ *
db
, 
pÜt
, cÚ¡ *
unix_sock‘
, 
þ›Áæag
);

46 
aurÜa_þo£
(
MYSQL
 *
mysql
);

47 
aurÜa_commªd
(
MYSQL
 *
mysql
,
’um_£rv”_commªd
 
commªd
, cÚ¡ *
¬g
,

48 
size_t
 
Ëngth
, 
my_boÞ
 
skp_check
, *
Ýt_¬g
);

49 
my_boÞ
 
aurÜa_»cÚÃù
(
MYSQL
 *
mysql
);

51 
	#AURORA_MAX_INSTANCES
 16

	)

53 
	#AURORA_UNKNOWN
 -1

	)

54 
	#AURORA_PRIMARY
 0

	)

55 
	#AURORA_REPLICA
 1

	)

56 
	#AURORA_UNAVAILABLE
 2

	)

58 
¡_m¬Ÿdb_­i
 *
	glibm¬Ÿdb_­i
ð
NULL
;

60 #iâdeà
PLUGIN_DYNAMIC


61 
MARIADB_CONNECTION_PLUGIN
 
	gaurÜa_þ›Á_¶ugš
 =

63 
MARIADB_CONNECTION_PLUGIN
 
_mysql_þ›Á_¶ugš_deþ¬©iÚ_
 =

66 
MARIADB_CLIENT_CONNECTION_PLUGIN
,

67 
MARIADB_CLIENT_CONNECTION_PLUGIN_INTERFACE_VERSION
,

73 
NULL
,

74 
aurÜa_š™
,

75 
NULL
,

76 
NULL
,

77 
aurÜa_cÚÃù
,

78 
aurÜa_þo£
,

79 
NULL
,

80 
aurÜa_commªd
,

81 
aurÜa_»cÚÃù
,

82 
NULL


86 
	s¡_aurÜa_š¡ªû
 {

87 *
	mho¡
;

88 
	mpÜt
;

89 
time_t
 
	mbÏckli¡ed
;

90 
	mty³
;

91 } 
	tAURORA_INSTANCE
;

93 
	s¡_cÚn_aurÜa
 {

94 
MYSQL
 *
	mmysql
[2],

95 
	m§ve_mysql
;

96 *
	mu¾
;

97 
	mnum_š¡ªûs
;

98 
AURORA_INSTANCE
 
	mš¡ªû
[
AURORA_MAX_INSTANCES
];

99 *
	mu£ºame
, *
	m·sswÜd
, *
	md©aba£
;

100 
	mpÜt
;

101 
	mþ›Á_æag
;

102 
	m´im¬y_id
[100];

103 } 
	tAURORA
;

105 
	#AURORA_BLACKLIST_TIMEOUT
 150

	)

107 
	#AURORA_IS_BLACKLISTED
(
a
, 
i
) \

108 ((
	`time
(
NULL
è- (
a
)->
š¡ªû
[(
i
)].
bÏckli¡ed
è< 
AURORA_BLACKLIST_TIMEOUT
)

	)

111 
my_boÞ
 
	$aurÜa_sw™ch_cÚÃùiÚ
(
MYSQL
 *
mysql
, 
AURORA
 *
aurÜa
, 
ty³
)

113 
ty³
)

115 
AURORA_REPLICA
:

116 ià(
aurÜa
->
mysql
[
AURORA_REPLICA
])

118 *
mysql
ð*
aurÜa
->mysql[
AURORA_REPLICA
];

121 
AURORA_PRIMARY
:

122 ià(
aurÜa
->
mysql
[
AURORA_PRIMARY
])

124 *
mysql
ð*
aurÜa
->mysql[
AURORA_PRIMARY
];

131 
	}
}

138 
aurÜa_š™
(*
”rÜmsg
 
__©Œibu‹__
((
unu£d
)),

139 
size_t
 
”rÜmsg_size
 
__©Œibu‹__
((
unu£d
)),

140 
unu£d
 
__©Œibu‹__
((unused)),

141 
va_li¡
 
unu£d1
 
__©Œibu‹__
((
unu£d
)))

144 #iâdeà
WIN32


145 
timev®
 
	g
;

146 
g‘timeofday
(&

,
NULL
);

147 
¤ªd
(

.
tv_u£c
 / 1000 +p.
tv_£c
 * 1000);

149 
¤ªd
(
G‘TickCouÁ
());

156 
	$aurÜa_þo£_memÜy
(
AURORA
 *
aurÜa
)

158 
	`ä“
(
aurÜa
->
u¾
);

159 
	`ä“
(
aurÜa
->
u£ºame
);

160 
	`ä“
(
aurÜa
->
·sswÜd
);

161 
	`ä“
(
aurÜa
->
d©aba£
);

162 
	`ä“
(
aurÜa
);

163 
	}
}

173 
my_boÞ
 
	$aurÜa_·r£_u¾
(cÚ¡ *
u¾
, 
AURORA
 *
aurÜa
)

175 *
p
, *
c
;

176 
i
;

178 ià(!
u¾
 || url[0] == 0)

181 
	`mem£t
(
aurÜa
->
š¡ªû
, 0, (
AURORA_MAX_INSTANCES
 + 1) * (*));

182 
	`mem£t
(&
aurÜa
->
pÜt
, 0, (
AURORA_MAX_INSTANCES
 + 1) * ());

184 ià(
aurÜa
->
u¾
)

185 
	`ä“
(
aurÜa
->
u¾
);

187 
aurÜa
->
u¾
ð
	`¡rdup
(url);

188 
c
ð
aurÜa
->
u¾
;

191 (
c
))

193 ià((
p
ð
	`¡rchr
(
c
, ',')))

195 *
p
= '\0';

196 
p
++;

198 ià(*
c
)

200 
aurÜa
->
š¡ªû
[aurÜa->
num_š¡ªûs
].
ho¡
ð
c
;

201 
aurÜa
->
num_š¡ªûs
++;

203 
c
ð
p
;

206 ià(!
aurÜa
->
num_š¡ªûs
)

210 
i
=0; i < 
aurÜa
->
num_š¡ªûs
 &&‡urÜa->
š¡ªû
[i].
ho¡
; i++)

212 
aurÜa
->
š¡ªû
[
i
].
ty³
ð
AURORA_UNKNOWN
;

216 ià(
aurÜa
->
š¡ªû
[
i
].
ho¡
[0]== '[' &&

217 
	`¡rchr
(
aurÜa
->
š¡ªû
[
i
].
ho¡
, ':') &&

218 (
p
ð
	`¡rchr
(
aurÜa
->
š¡ªû
[
i
].
ho¡
,']')))

221 
	`memmove
(
aurÜa
->
š¡ªû
[
i
].
ho¡
,

222 
aurÜa
->
š¡ªû
[
i
].
ho¡
+1,

223 
	`¡¾’
(
aurÜa
->
š¡ªû
[
i
].
ho¡
) - 1);

224 
p
ð
	`¡rchr
(
aurÜa
->
š¡ªû
[
i
].
ho¡
,']');

225 *
p
= 0;

226 
p
++;

229 
p
ð
aurÜa
->
š¡ªû
[
i
].
ho¡
;

230 ià(
p
 && (pð
	`¡rchr
(p, ':')))

232 *
p
= '\0';

233 
p
++;

234 
aurÜa
->
š¡ªû
[
i
].
pÜt
ð
	`©oi
(
p
);

238 
	}
}

249 
	$aurÜa_g‘_š¡ªû_ty³
(
MYSQL
 *
mysql
)

251 
rc
= -1;

252 
MA_CONNECTION_HANDLER
 *
§ve_hdÌ
ð
mysql
->
ex‹nsiÚ
->
cÚn_hdÌ
;

254 cÚ¡ *
qu”y
= "select variable_value from information_schema.global_variables where variable_name='INNODB_READ_ONLY' AND variable_value='OFF'";

256 ià(!
mysql
)

259 
mysql
->
ex‹nsiÚ
->
cÚn_hdÌ
= 0;

260 ià(!
libm¬Ÿdb_­i
->
	`mysql_qu”y
(
mysql
, 
qu”y
))

262 
MYSQL_RES
 *
»s
ð
libm¬Ÿdb_­i
->
	`mysql_¡Üe_»suÉ
(
mysql
);

263 
rc
ð
libm¬Ÿdb_­i
->
	`mysql_num_rows
(
»s
è? 
AURORA_PRIMARY
 : 
AURORA_REPLICA
;

264 
libm¬Ÿdb_­i
->
	`mysql_ä“_»suÉ
(
»s
);

266 
mysql
->
ex‹nsiÚ
->
cÚn_hdÌ
ð
§ve_hdÌ
;

267  
rc
;

268 
	}
}

284 
my_boÞ
 
	$aurÜa_g‘_´im¬y_id
(
MYSQL
 *
mysql
, 
AURORA
 *
aurÜa
)

286 
my_boÞ
 
rc
= 0;

287 
MA_CONNECTION_HANDLER
 *
§ve_hdÌ
ð
mysql
->
ex‹nsiÚ
->
cÚn_hdÌ
;

289 
mysql
->
ex‹nsiÚ
->
cÚn_hdÌ
= 0;

290 ià(!
libm¬Ÿdb_­i
->
	`mysql_qu”y
(
mysql
, "select server_id from information_schema.replica_host_status "

293 
MYSQL_RES
 *
»s
;

294 
MYSQL_ROW
 
row
;

296 ià((
»s
ð
libm¬Ÿdb_­i
->
	`mysql_¡Üe_»suÉ
(
mysql
)))

298 ià((
row
ð
libm¬Ÿdb_­i
->
	`mysql_ãtch_row
(
»s
)))

300 ià(
row
[0])

302 
	`¡rýy
(
aurÜa
->
´im¬y_id
, 
row
[0]);

303 
rc
= 1;

306 
libm¬Ÿdb_­i
->
	`mysql_ä“_»suÉ
(
»s
);

309 
mysql
->
ex‹nsiÚ
->
cÚn_hdÌ
ð
§ve_hdÌ
;

310  
rc
;

311 
	}
}

319 
	$aurÜa_g‘_v®id_š¡ªûs
(
AURORA
 *
aurÜa
, 
AURORA_INSTANCE
 **
š¡ªûs
)

321 
i
, 
v®id_š¡ªûs
= 0;

323 
	`mem£t
(
š¡ªûs
, 0, (
AURORA_INSTANCE
 *è* 
AURORA_MAX_INSTANCES
);

325 
i
=0; i < 
aurÜa
->
num_š¡ªûs
; i++)

327 ià(
aurÜa
->
š¡ªû
[
i
].
ty³
 !ð
AURORA_UNAVAILABLE
)

329 ià(
aurÜa
->
š¡ªû
[
i
].
ty³
 =ð
AURORA_PRIMARY
 &&‡urÜa->
mysql
[AURORA_PRIMARY])

331 
š¡ªûs
[
v®id_š¡ªûs
]ð&
aurÜa
->
š¡ªû
[
i
];

332 
v®id_š¡ªûs
++;

335  
v®id_š¡ªûs
;

336 
	}
}

340 
	$aurÜa_»äesh_bÏckli¡
(
AURORA
 *
aurÜa
)

342 
i
;

343 
i
=0; i < 
aurÜa
->
num_š¡ªûs
; i++)

345 ià(
aurÜa
->
š¡ªû
[
i
].
bÏckli¡ed
 &&

346 !(
	`AURORA_IS_BLACKLISTED
(
aurÜa
, 
i
)))

348 
aurÜa
->
š¡ªû
[
i
].
bÏckli¡ed
= 0;

349 
aurÜa
->
š¡ªû
[
i
].
ty³
ð
AURORA_UNKNOWN
;

352 
	}
}

356 
MYSQL
 *
	$aurÜa_cÚÃù_š¡ªû
(
AURORA
 *
aurÜa
, 
AURORA_INSTANCE
 *
š¡ªû
, 
MYSQL
 *
mysql
)

358 ià(!
libm¬Ÿdb_­i
->
	`mysql_»®_cÚÃù
(
mysql
,

359 
š¡ªû
->
ho¡
,

360 
aurÜa
->
u£ºame
,

361 
aurÜa
->
·sswÜd
,

362 
aurÜa
->
d©aba£
,

363 
š¡ªû
->
pÜt
 ? in¡ªû->pÜˆ: 
aurÜa
->port,

364 
NULL
,

365 
aurÜa
->
þ›Á_æag
 | 
CLIENT_REMEMBER_OPTIONS
))

368 
š¡ªû
->
bÏckli¡ed
ð
	`time
(
NULL
);

369 
š¡ªû
->
ty³
ð
AURORA_UNAVAILABLE
;

370  
NULL
;

374 
	`aurÜa_g‘_š¡ªû_ty³
(
mysql
))

376 
AURORA_PRIMARY
:

377 
š¡ªû
->
ty³
ð
AURORA_PRIMARY
;

378  
mysql
;

380 
AURORA_REPLICA
:

381 
š¡ªû
->
ty³
ð
AURORA_REPLICA
;

384 
š¡ªû
->
ty³
ð
AURORA_UNAVAILABLE
;

385 
š¡ªû
->
bÏckli¡ed
ð
	`time
(
NULL
);

386  
NULL
;

388 ià(!
aurÜa
->
´im¬y_id
[0])

389 ià(
	`aurÜa_g‘_´im¬y_id
(
mysql
, 
aurÜa
))

390  
NULL
;

391  
mysql
;

392 
	}
}

396 
	$aurÜa_þo£_š‹º®
(
MYSQL
 *
mysql
)

398 ià(
mysql
)

400 
mysql
->
ex‹nsiÚ
->
cÚn_hdÌ
= 0;

401 
	`mem£t
(&
mysql
->
ÝtiÚs
, 0, (
¡_mysql_ÝtiÚs
));

402 
libm¬Ÿdb_­i
->
	`mysql_þo£
(
mysql
);

404 
	}
}

408 
my_boÞ
 
	$aurÜa_fšd_»¶iÿ
(
AURORA
 *
aurÜa
)

410 
v®id_š¡ªûs
;

411 
my_boÞ
 
»¶iÿ_found
= 0;

412 
AURORA_INSTANCE
 *
š¡ªû
[
AURORA_MAX_INSTANCES
];

413 
MYSQL
 *
mysql
;

415 ià(
aurÜa
->
num_š¡ªûs
 < 2)

419 
v®id_š¡ªûs
ð
	`aurÜa_g‘_v®id_š¡ªûs
(
aurÜa
, 
š¡ªû
);

421 
v®id_š¡ªûs
 && !
»¶iÿ_found
)

423 
¿ndom_pick
ð
	`¿nd
(è% 
v®id_š¡ªûs
;

424 
mysql
ð
libm¬Ÿdb_­i
->
	`mysql_š™
(
NULL
);

425 
mysql
->
ÝtiÚs
ð
aurÜa
->
§ve_mysql
.options;

429 ià((
	`aurÜa_cÚÃù_š¡ªû
(
aurÜa
, 
š¡ªû
[
¿ndom_pick
], 
mysql
)))

431 
š¡ªû
[
¿ndom_pick
]->
ty³
) {

432 
AURORA_REPLICA
:

433 ià(!
aurÜa
->
mysql
[
AURORA_REPLICA
])

434 
aurÜa
->
mysql
[
AURORA_REPLICA
]= mysql;

437 
AURORA_PRIMARY
:

438 ià(!
aurÜa
->
mysql
[
AURORA_PRIMARY
])

439 
aurÜa
->
mysql
[
AURORA_PRIMARY
]= mysql;

441 
	`aurÜa_þo£_š‹º®
(
mysql
);

445 
	`aurÜa_þo£_š‹º®
(
mysql
);

451 
	`aurÜa_þo£_š‹º®
(
mysql
);

452 
v®id_š¡ªûs
ð
	`aurÜa_g‘_v®id_š¡ªûs
(
aurÜa
, 
š¡ªû
);

455 
	}
}

459 
AURORA_INSTANCE
 *
	$aurÜa_g‘_´im¬y_id_š¡ªû
(
AURORA
 *
aurÜa
)

461 
i
;

463 ià(!
aurÜa
->
´im¬y_id
[0])

466 
i
=0; i < 
aurÜa
->
num_š¡ªûs
; i++)

468 ià(!
	`¡ºcmp
(
aurÜa
->
š¡ªû
[
i
].
ho¡
,‡urÜa->
´im¬y_id
, 
	`¡¾’
(aurora->primary_id)))

469  &
aurÜa
->
š¡ªû
[
i
];

471  
NULL
;

472 
	}
}

476 
my_boÞ
 
	$aurÜa_fšd_´im¬y
(
AURORA
 *
aurÜa
)

478 
i
;

479 
AURORA_INSTANCE
 *
š¡ªû
ð
NULL
;

480 
MYSQL
 *
mysql
;

481 
my_boÞ
 
check_´im¬y
= 1;

487 ià(!
aurÜa
->
num_š¡ªûs
)

490 
i
=0; i < 
aurÜa
->
num_š¡ªûs
; i++)

492 
mysql
ð
libm¬Ÿdb_­i
->
	`mysql_š™
(
NULL
);

493 
mysql
->
ÝtiÚs
ð
aurÜa
->
§ve_mysql
.options;

495 ià(
check_´im¬y
 && 
aurÜa
->
´im¬y_id
[0])

497 ià((
š¡ªû
ð
	`aurÜa_g‘_´im¬y_id_š¡ªû
(
aurÜa
)) &&

498 
	`aurÜa_cÚÃù_š¡ªû
(
aurÜa
, 
š¡ªû
, 
mysql
) &&

499 
š¡ªû
->
ty³
 =ð
AURORA_PRIMARY
)

501 
aurÜa
->
´im¬y_id
[0]= 0;

502 
aurÜa
->
mysql
[
AURORA_PRIMARY
]= mysql;

506 
aurÜa
->
´im¬y_id
[0]= 0;

507 
check_´im¬y
= 0;

509 ià(
aurÜa
->
š¡ªû
[
i
].
ty³
 !ð
AURORA_UNAVAILABLE
)

511 ià(
	`aurÜa_cÚÃù_š¡ªû
(
aurÜa
, &aurÜa->
š¡ªû
[
i
], 
mysql
)

512 && 
aurÜa
->
š¡ªû
[
i
].
ty³
 =ð
AURORA_PRIMARY
)

514 
aurÜa
->
mysql
[
AURORA_PRIMARY
]= mysql;

518 
	`aurÜa_þo£_š‹º®
(
mysql
);

521 
	}
}

525 
MYSQL
 *
aurÜa_cÚÃù
(MYSQL *
mysql
, cÚ¡ *
ho¡
, cÚ¡ *
u£r
, cÚ¡ *
·sswd
,

526 cÚ¡ *
db
, 
pÜt
, cÚ¡ *
unix_sock‘
 
__©Œibu‹__
((
unu£d
)), 
þ›Á_æag
)

528 
AURORA
 *
	gaurÜa
ð
NULL
;

529 
MA_CONNECTION_HANDLER
 *
	g§ve_hdÌ
ð
mysql
->
ex‹nsiÚ
->
cÚn_hdÌ
;

531 ià(!
	glibm¬Ÿdb_­i
)

532 
	glibm¬Ÿdb_­i
ð
mysql
->
m‘hods
->
­i
;

536 ià(!(
	gaurÜa
ð(
AURORA
 *)
§ve_hdÌ
->
d©a
))

538 ià(!(
aurÜa
ð(
AURORA
 *)
ÿÎoc
(1, (AURORA))))

540 
	gmysql
->
	gm‘hods
->
£t_”rÜ
(
mysql
, 
CR_OUT_OF_MEMORY
, "HY000", 0);

541  
	gNULL
;

543 
	gaurÜa
->
	g§ve_mysql
ð*
mysql
;

545 
	g§ve_hdÌ
->
	gd©a
ð(*)
aurÜa
;

547 ià(
aurÜa_·r£_u¾
(
ho¡
, 
aurÜa
))

549 
	g”rÜ
;

553 ià(
	gu£r
)

554 
	gaurÜa
->
	gu£ºame
ð
¡rdup
(
u£r
);

555 ià(
	g·sswd
)

556 
	gaurÜa
->
	g·sswÜd
ð
¡rdup
(
·sswd
);

557 ià(
	gdb
)

558 
	gaurÜa
->
	gd©aba£
ð
¡rdup
(
db
);

559 
	gaurÜa
->
	gpÜt
ð
pÜt
;

560 
	gaurÜa
->
	gþ›Á_æag
ð
þ›Á_æag
;

566 ià(!
	gaurÜa
->
	gmysql
[
AURORA_REPLICA
])

568 ià(!
aurÜa_fšd_»¶iÿ
(
aurÜa
))

569 
	gaurÜa
->
	gmysql
[
AURORA_REPLICA
]ð
NULL
;

571 
	gaurÜa
->
	gmysql
[
AURORA_REPLICA
]->
	gex‹nsiÚ
->
	gcÚn_hdÌ
ð
§ve_hdÌ
;

574 ià(!
	gaurÜa
->
	gmysql
[
AURORA_PRIMARY
])

576 ià(!
aurÜa_fšd_´im¬y
(
aurÜa
))

577 
	gaurÜa
->
	gmysql
[
AURORA_PRIMARY
]ð
NULL
;

579 
	gaurÜa
->
	gmysql
[
AURORA_PRIMARY
]->
	gex‹nsiÚ
->
	gcÚn_hdÌ
ð
§ve_hdÌ
;

582 ià(!
	gaurÜa
->
	gmysql
[
AURORA_PRIMARY
] && !aurÜa->mysql[
AURORA_REPLICA
])

583 
	g”rÜ
;

585 ià(
	gaurÜa
->
	gmysql
[
AURORA_PRIMARY
])

586 
aurÜa_sw™ch_cÚÃùiÚ
(
mysql
, 
aurÜa
, 
AURORA_PRIMARY
);

588 
aurÜa_sw™ch_cÚÃùiÚ
(
mysql
, 
aurÜa
, 
AURORA_REPLICA
);

589 
	gmysql
->
	gex‹nsiÚ
->
	gcÚn_hdÌ
ð
§ve_hdÌ
;

590  
	gmysql
;

591 
	g”rÜ
:

592 
aurÜa_þo£_memÜy
(
aurÜa
);

593  
	gNULL
;

598 
my_boÞ
 
	$aurÜa_»cÚÃù
(
MYSQL
 *
mysql
)

600 
AURORA
 *
aurÜa
;

601 
MA_CONNECTION_HANDLER
 *
§ve_hdÌ
ð
mysql
->
ex‹nsiÚ
->
cÚn_hdÌ
;

602 
i
;

609 
aurÜa
ð(
AURORA
 *)
§ve_hdÌ
->
d©a
;

612 
i
=0; i < 
aurÜa
->
num_š¡ªûs
; i++)

613 
aurÜa
->
š¡ªû
[
i
].
ty³
ð
AURORA_UNKNOWN
;

615 ià(
aurÜa
->
mysql
[
AURORA_PRIMARY
]->
th»ad_id
 == mysql->thread_id)

618 
aurÜa
->
mysql
[
AURORA_PRIMARY
]->
Ãt
.
pvio
ð
NULL
;

619 
	`aurÜa_þo£_š‹º®
(
aurÜa
->
mysql
[
AURORA_PRIMARY
]);

620 
aurÜa
->
mysql
[
AURORA_PRIMARY
]ð
NULL
;

621 
	`aurÜa_þo£_š‹º®
(
aurÜa
->
mysql
[
AURORA_REPLICA
]);

622 
aurÜa
->
mysql
[
AURORA_REPLICA
]ð
NULL
;

624 ià(
aurÜa
->
mysql
[
AURORA_REPLICA
]->
th»ad_id
 == mysql->thread_id)

627 
aurÜa
->
mysql
[
AURORA_REPLICA
]->
Ãt
.
pvio
ð
NULL
;

628 
	`aurÜa_þo£_š‹º®
(
aurÜa
->
mysql
[
AURORA_REPLICA
]);

629 
aurÜa
->
mysql
[
AURORA_REPLICA
]ð
NULL
;

630 
	`aurÜa_þo£_š‹º®
(
aurÜa
->
mysql
[
AURORA_PRIMARY
]);

631 
aurÜa
->
mysql
[
AURORA_PRIMARY
]ð
NULL
;

635 
aurÜa
->
mysql
[
AURORA_PRIMARY
]ðaurÜa->mysql[
AURORA_REPLICA
]ð
NULL
;

637 ià(
	`aurÜa_cÚÃù
(
mysql
, 
NULL
, NULL, NULL, NULL, 0, NULL, 0))

639 ià(
aurÜa
->
mysql
[
AURORA_PRIMARY
])

640 *
mysql
ð*
aurÜa
->mysql[
AURORA_PRIMARY
];

643 ià(
aurÜa
->
mysql
[
AURORA_REPLICA
])

644 *
mysql
ð*
aurÜa
->mysql[
AURORA_REPLICA
];

646 *
mysql
ð
aurÜa
->
§ve_mysql
;

648 
	}
}

652 
	$aurÜa_þo£
(
MYSQL
 *
mysql
)

654 
MA_CONNECTION_HANDLER
 *
hdÌ
ð
mysql
->
ex‹nsiÚ
->
cÚn_hdÌ
;

655 
AURORA
 *
aurÜa
;

656 
i
;

658 ià(!
hdÌ
 || !hdÌ->
d©a
)

661 
aurÜa
ð(
AURORA
 *)
hdÌ
->
d©a
;

662 *
mysql
ð
aurÜa
->
§ve_mysql
;

664 ià(!
aurÜa
->
mysql
[
AURORA_PRIMARY
] && !aurÜa->mysql[
AURORA_REPLICA
])

665 
’d
;

667 
i
=0; i < 2; i++)

669 ià(
aurÜa
->
mysql
[
i
])

672 ià(
mysql
->
th»ad_id
 =ð
aurÜa
->mysql[
i
]->th»ad_id && !mysql->
Ãt
.
pvio
)

673 
aurÜa
->
mysql
[
i
]->
Ãt
.
pvio
= 0;

675 
	`aurÜa_þo£_š‹º®
(
aurÜa
->
mysql
[
i
]);

676 
aurÜa
->
mysql
[
i
]ð
NULL
;

680 
’d
:

681 
	`aurÜa_þo£_memÜy
(
aurÜa
);

682 
mysql
->
ex‹nsiÚ
->
cÚn_hdÌ
ð
hdÌ
;

683 
	}
}

687 
my_boÞ
 
	$is_»¶iÿ_commªd
(cÚ¡ *
bufãr
, 
size_t
 
bufãr_Ën
)

689 cÚ¡ *
bufãr_’d
ð
bufãr
 + 
bufãr_Ën
;

691 ; 
bufãr
 < 
bufãr_’d
; ++buffer)

693 
c
;

694 ià(
	`i§Íha
(
c
=*
bufãr
))

696 ià(
	`tÞow”
(
c
) == 's')

702 
	}
}

706 
my_boÞ
 
	$is_»¶iÿ_¡mt
(
MYSQL
 *
mysql
, cÚ¡ *
bufãr
)

708 
¡mt_id
ð
	`ušt4kÜr
(
bufãr
);

709 
LIST
 *
¡mt_li¡
ð
mysql
->
¡mts
;

711 ; 
¡mt_li¡
; stmt_li¡ð¡mt_li¡->
Ãxt
)

713 
MYSQL_STMT
 *
¡mt
ð(MYSQL_STMT *)
¡mt_li¡
->
d©a
;

714 ià(
¡mt
->
¡mt_id
 == stmt_id)

718 
	}
}

722 
aurÜa_commªd
(
MYSQL
 *
mysql
,
’um_£rv”_commªd
 
commªd
, cÚ¡ *
¬g
,

723 
size_t
 
Ëngth
 
__©Œibu‹__
((
unu£d
)), 
my_boÞ
 
skp_check
 __©Œibu‹__((unu£d)), *
Ýt_¬g
 __attribute__((unused)))

725 
MA_CONNECTION_HANDLER
 *
	g§ve_hdÌ
ð
mysql
->
ex‹nsiÚ
->
cÚn_hdÌ
;

726 
AURORA
 *
	gaurÜa
ð(AURORA *)
§ve_hdÌ
->
d©a
;

729 ià(!
	gaurÜa
->
	gmysql
[
AURORA_REPLICA
] || !
OPT_EXT_VAL
(
mysql
, 
»ad_Úly
))

731 ià(
	gcommªd
 !ð
COM_INIT_DB
)

733 
aurÜa_sw™ch_cÚÃùiÚ
(
mysql
, 
aurÜa
, 
AURORA_PRIMARY
);

734 
	g’d
;

738 
	gcommªd
) {

739 
	gCOM_INIT_DB
:

741 ià(
aurÜa
->
mysql
[
AURORA_REPLICA
] && mysql->
th»ad_id
 =ðaurÜa->mysql[
AURORA_PRIMARY
]->thread_id)

743 
aurÜa
->
mysql
[
AURORA_REPLICA
]->
ex‹nsiÚ
->
cÚn_hdÌ
= 0;

744 
	glibm¬Ÿdb_­i
->
mysql_£Ëù_db
(
aurÜa
->
mysql
[
AURORA_REPLICA
], 
¬g
);

745 
	gaurÜa
->
	gmysql
[
AURORA_REPLICA
]->
	gex‹nsiÚ
->
	gcÚn_hdÌ
ð
mysql
->
ex‹nsiÚ
->
cÚn_hdÌ
;

748 
	gCOM_QUERY
:

749 
COM_STMT_PREPARE
:

750 ià(
aurÜa
->
mysql
[
AURORA_REPLICA
])

751 
aurÜa_sw™ch_cÚÃùiÚ
(
mysql
, 
aurÜa
, 
AURORA_REPLICA
);

753 
	gCOM_STMT_EXECUTE
:

754 
COM_STMT_FETCH
:

755 ià(
aurÜa
->
mysql
[
AURORA_REPLICA
] &&‡urÜa->mysql[AURORA_REPLICA]->
¡mts
 &&

756 
is_»¶iÿ_¡mt
(
aurÜa
->
mysql
[
AURORA_REPLICA
], 
¬g
))

758 
aurÜa_sw™ch_cÚÃùiÚ
(
mysql
, 
aurÜa
, 
AURORA_REPLICA
);

762 
aurÜa_sw™ch_cÚÃùiÚ
(
mysql
, 
aurÜa
, 
AURORA_PRIMARY
);

766 
aurÜa_sw™ch_cÚÃùiÚ
(
mysql
, 
aurÜa
, 
AURORA_PRIMARY
);

769 
	g’d
:

770 
mysql
->
ex‹nsiÚ
->
cÚn_hdÌ
ð
§ve_hdÌ
;

	@plugins/connection/replication.c

25 
	~<ma_glob®.h
>

26 
	~<ma_sys.h
>

27 
	~<”rmsg.h
>

28 
	~<mysql.h
>

29 
	~<mysql/þ›Á_¶ugš.h
>

30 
	~<¡ršg.h
>

31 
	~<ma_¡ršg.h
>

32 
	~<ma_commÚ.h
>

34 #iâdeà
WIN32


35 
	~<sys/time.h
>

39 
MYSQL
 *
»¶_cÚÃù
(MYSQL *
mysql
, cÚ¡ *
ho¡
, cÚ¡ *
u£r
, cÚ¡ *
·sswd
,

40 cÚ¡ *
db
, 
pÜt
, cÚ¡ *
unix_sock‘
, 
þ›Áæag
);

41 
»¶_þo£
(
MYSQL
 *
mysql
);

42 
»¶_commªd
(
MYSQL
 *
mysql
,
’um_£rv”_commªd
 
commªd
, cÚ¡ *
¬g
,

43 
size_t
 
Ëngth
, 
my_boÞ
 
skp_check
, *
Ýt_¬g
);

44 
»¶_£t_ÝtiÚsv
(
MYSQL
 *
mysql
, 
ÝtiÚ
, ...);

46 
	#MARIADB_MASTER
 0

	)

47 
	#MARIADB_SLAVE
 1

	)

49 
¡_m¬Ÿdb_­i
 *
	glibm¬Ÿdb_­i
ð
NULL
;

51 #iâdeà
PLUGIN_DYNAMIC


52 
MARIADB_CONNECTION_PLUGIN
 
	g»¶iÿtiÚ_þ›Á_¶ugš
 =

54 
MARIADB_CONNECTION_PLUGIN
 
_mysql_þ›Á_¶ugš_deþ¬©iÚ_
 =

57 
MARIADB_CLIENT_CONNECTION_PLUGIN
,

58 
MARIADB_CLIENT_CONNECTION_PLUGIN_INTERFACE_VERSION
,

64 
NULL
,

65 
NULL
,

66 
NULL
,

67 
NULL
,

68 
»¶_cÚÃù
,

69 
»¶_þo£
,

70 
»¶_£t_ÝtiÚsv
,

71 
»¶_commªd
,

72 
NULL
,

73 
NULL


76 
	s¡_cÚn_»¶
 {

77 
MARIADB_PVIO
 *
	mpvio
[2];

78 
MYSQL
 *
	m¦ave_mysql
;

79 
my_boÞ
 
	m»ad_Úly
;

80 
my_boÞ
 
	mround_robš
;

81 *
	mu¾
;

82 *
	mho¡
[2];

83 
	mpÜt
[2];

84 
	mcu¼’t_ty³
;

85 } 
	tREPL_DATA
;

87 
	#SET_SLAVE
(
mysql
, 
d©a
)\

89 
mysql
->
Ãt
.
pvio
ð
d©a
->pvio[
MARIADB_SLAVE
]; \

90 
d©a
->
cu¼’t_ty³
ð
MARIADB_SLAVE
;\

91 } 0)

	)

93 
	#SET_MASTER
(
mysql
, 
d©a
)\

95 
mysql
->
Ãt
.
pvio
ð
d©a
->pvio[
MARIADB_MASTER
];\

96 
d©a
->
cu¼’t_ty³
ð
MARIADB_MASTER
;\

97 } 0)

	)

106 
my_boÞ
 
	$»¶_·r£_u¾
(cÚ¡ *
u¾
, 
REPL_DATA
 *
d©a
)

108 *
p
;

109 *
¦aves
[64];

110 
pÜt
[64], 
i
,
num_¦aves
= 0;

112 ià(!
u¾
 || url[0] == 0)

115 
	`mem£t
(
¦aves
, 0, 64 * (*));

116 
	`mem£t
(&
pÜt
, 0, 64 * ());

118 
	`mem£t
(
d©a
->
ho¡
, 0, 2 * (*));

119 
	`mem£t
(
d©a
->
pÜt
, 0, 2 * ());

121 ià(!
d©a
->
u¾
)

122 
d©a
->
u¾
ð
	`¡rdup
(url);

123 
d©a
->
ho¡
[
MARIADB_MASTER
]ð
p
ðd©a->
u¾
;

126 (
p
 && (pð
	`¡rchr
(p, ','))))

128 *
p
= '\0';

129 
p
++;

130 ià(*
p
)

132 
¦aves
[
num_¦aves
]ð
p
;

133 
num_¦aves
++;

137 ià(!
num_¦aves
)

139 ià(
num_¦aves
 == 1)

140 
d©a
->
ho¡
[
MARIADB_SLAVE
]ð
¦aves
[0];

143 
¿ndom_Ä
;

144 #iâdeà
WIN32


145 
timev®
 

;

146 
	`g‘timeofday
(&

,
NULL
);

147 
	`¤ªd
(

.
tv_u£c
 / 1000 +p.
tv_£c
 * 1000);

149 
	`¤ªd
(
	`G‘TickCouÁ
());

152 
¿ndom_Ä
ð
	`¿nd
(è% 
num_¦aves
;

153 
d©a
->
ho¡
[
MARIADB_SLAVE
]ð
¦aves
[
¿ndom_Ä
];

157 
i
=0; i < 2 && 
d©a
->
ho¡
[i]; i++)

161 ià(
d©a
->
ho¡
[
i
][0]=ð'[' && 
	`¡rchr
(d©a->ho¡[i], ':'è&& (
p
= strchr(data->host[i],']')))

164 
	`memmove
(
d©a
->
ho¡
[
i
], d©a->ho¡[i]+1, 
	`¡¾’
(data->host[i]) - 1);

165 
p
ð
	`¡rchr
(
d©a
->
ho¡
[
i
],']');

166 *
p
= 0;

167 
p
++;

170 
p
ð
d©a
->
ho¡
[
i
];

171 ià(
p
 && (pð
	`¡rchr
(p, ':')))

173 *
p
= '\0';

174 
p
++;

175 
d©a
->
pÜt
[
i
]ð
	`©oi
(
p
);

180 
	}
}

182 
MYSQL
 *
	$»¶_cÚÃù
(
MYSQL
 *
mysql
, cÚ¡ *
ho¡
, cÚ¡ *
u£r
, cÚ¡ *
·sswd
,

183 cÚ¡ *
db
, 
pÜt
, cÚ¡ *
unix_sock‘
, 
þ›Áæag
)

185 
REPL_DATA
 *
d©a
ð
NULL
;

186 
MA_CONNECTION_HANDLER
 *
hdÌ
ð
mysql
->
ex‹nsiÚ
->
cÚn_hdÌ
;

188 ià(!
libm¬Ÿdb_­i
)

189 
libm¬Ÿdb_­i
ð
mysql
->
m‘hods
->
­i
;

191 ià((
d©a
ð(
REPL_DATA
 *)
hdÌ
->data))

193 
d©a
->
pvio
[
MARIADB_MASTER
]->
m‘hods
->
	`þo£
(data->pvio[MARIADB_MASTER]);

194 
d©a
->
pvio
[
MARIADB_MASTER
]= 0;

195 
	`»¶_þo£
(
mysql
);

198 ià(!(
d©a
ð
	`ÿÎoc
(1, (
REPL_DATA
))))

200 
mysql
->
m‘hods
->
	`£t_”rÜ
(mysql, 
CR_OUT_OF_MEMORY
, "HY000", 0);

201  
NULL
;

203 
	`mem£t
(
d©a
->
pvio
, 0, 2 * (
MARIADB_PVIO
 *));

205 ià(
	`»¶_·r£_u¾
(
ho¡
, 
d©a
))

206 
”rÜ
;

209 ià(!(
libm¬Ÿdb_­i
->
	`mysql_»®_cÚÃù
(
mysql
, 
d©a
->
ho¡
[
MARIADB_MASTER
], 
u£r
, 
·sswd
, 
db
,

210 
d©a
->
pÜt
[
MARIADB_MASTER
] ? d©a->pÜt[MARIADB_MASTER] :…Üt, 
unix_sock‘
, 
þ›Áæag
)))

211 
”rÜ
;

213 
d©a
->
pvio
[
MARIADB_MASTER
]ð
mysql
->
Ãt
.pvio;

214 
hdÌ
->
d©a
= data;

215 
	`SET_MASTER
(
mysql
, 
d©a
);

221 ià(!(
d©a
->
¦ave_mysql
ð
libm¬Ÿdb_­i
->
	`mysql_š™
(
NULL
)) ||

222 !(
mysql
->
m‘hods
->
	`db_cÚÃù
(
d©a
->
¦ave_mysql
, d©a->
ho¡
[
MARIADB_SLAVE
], 
u£r
, 
·sswd
, 
db
,

223 
d©a
->
pÜt
[
MARIADB_SLAVE
] ? d©a->pÜt[MARIADB_SLAVE] :…Üt, 
unix_sock‘
, 
þ›Áæag
)))

225 ià(
d©a
->
¦ave_mysql
)

226 
libm¬Ÿdb_­i
->
	`mysql_þo£
(
d©a
->
¦ave_mysql
);

227 
d©a
->
pvio
[
MARIADB_SLAVE
]ð
NULL
;

231 
d©a
->
pvio
[
MARIADB_SLAVE
]ðd©a->
¦ave_mysql
->
Ãt
.pvio;

232 
d©a
->
¦ave_mysql
->
Ãt
.
pvio
->
mysql
= mysql;

234  
mysql
;

235 
”rÜ
:

236 ià(
d©a
)

238 ià(
d©a
->
u¾
)

239 
	`ä“
(
d©a
->
u¾
);

240 
	`ä“
(
d©a
);

242  
NULL
;

243 
	}
}

245 
	$»¶_þo£
(
MYSQL
 *
mysql
)

247 
MA_CONNECTION_HANDLER
 *
hdÌ
ð
mysql
->
ex‹nsiÚ
->
cÚn_hdÌ
;

248 
REPL_DATA
 *
d©a
ð(REPL_DATA *)
hdÌ
->data;

251 
	`SET_MASTER
(
mysql
, 
d©a
);

254 ià(
d©a
->
pvio
[
MARIADB_SLAVE
])

257 
d©a
->
pvio
[
MARIADB_SLAVE
]->
mysql
ðd©a->
¦ave_mysql
;

258 
libm¬Ÿdb_­i
->
	`mysql_þo£
(
d©a
->
¦ave_mysql
);

259 
d©a
->
pvio
[
MARIADB_SLAVE
]ð
NULL
;

260 
d©a
->
¦ave_mysql
ð
NULL
;

264 
	`ä“
(
d©a
->
u¾
);

265 
	`ä“
(
d©a
);

266 
mysql
->
ex‹nsiÚ
->
cÚn_hdÌ
->
d©a
ð
NULL
;

267 
	}
}

269 
my_boÞ
 
	$is_¦ave_commªd
(cÚ¡ *
bufãr
, 
size_t
 
bufãr_Ën
)

271 cÚ¡ *
bufãr_’d
ð
bufãr
 + 
bufãr_Ën
;

273 ; 
bufãr
 < 
bufãr_’d
; ++buffer)

275 
c
;

276 ià(
	`i§Íha
(
c
=*
bufãr
))

278 ià(
	`tÞow”
(
c
) == 's')

284 
	}
}

286 
my_boÞ
 
	$is_¦ave_¡mt
(
MYSQL
 *
mysql
, cÚ¡ *
bufãr
)

288 
¡mt_id
ð
	`ušt4kÜr
(
bufãr
);

289 
LIST
 *
¡mt_li¡
ð
mysql
->
¡mts
;

291 ; 
¡mt_li¡
; stmt_li¡ð¡mt_li¡->
Ãxt
)

293 
MYSQL_STMT
 *
¡mt
ð(MYSQL_STMT *)
¡mt_li¡
->
d©a
;

294 ià(
¡mt
->
¡mt_id
 == stmt_id)

298 
	}
}

301 
»¶_commªd
(
MYSQL
 *
mysql
,
’um_£rv”_commªd
 
commªd
, cÚ¡ *
¬g
,

302 
size_t
 
Ëngth
,

303 
my_boÞ
 
skp_check
 
__©Œibu‹__
((
unu£d
)),

304 *
Ýt_¬g
 
__©Œibu‹__
((
unu£d
)))

306 
REPL_DATA
 *
	gd©a
ð(REPL_DATA *)
mysql
->
ex‹nsiÚ
->
cÚn_hdÌ
->
d©a
;

309 ià(!
	gd©a
->
	gpvio
[
MARIADB_SLAVE
] || !d©a->
	g»ad_Úly
)

311 
SET_MASTER
(
mysql
, 
d©a
);

314 
	gcommªd
) {

315 
	gCOM_QUERY
:

316 
COM_STMT_PREPARE
:

317 ià(
is_¦ave_commªd
(
¬g
, 
Ëngth
))

318 
SET_SLAVE
(
mysql
, 
d©a
)

320 
SET_MASTER
(
mysql
,
d©a
)

322 
	gCOM_STMT_EXECUTE
:

323 
COM_STMT_FETCH
:

324 ià(
d©a
->
pvio
[
MARIADB_SLAVE
]->
mysql
->
¡mts
 && 
is_¦ave_¡mt
(d©a->pvio[MARIADB_SLAVE]->mysql, 
¬g
))

325 
SET_SLAVE
(
mysql
, 
d©a
)

327 
SET_MASTER
(
mysql
,
d©a
)

331 
SET_MASTER
(
mysql
,
d©a
)

337 
	$»¶_£t_ÝtiÚsv
(
MYSQL
 *
mysql
, 
ÝtiÚ
, ...)

339 
REPL_DATA
 *
d©a
ð(REPL_DATA *)
mysql
->
ex‹nsiÚ
->
cÚn_hdÌ
->data;

340 
va_li¡
 
­
;

341 *
¬g1
;

342 
rc
= 0;

344 
	`va_¡¬t
(
­
, 
ÝtiÚ
);

345 
¬g1
ð
	`va_¬g
(
­
, *);

347 
ÝtiÚ
) {

348 
MARIADB_OPT_CONNECTION_READ_ONLY
:

349 
d©a
->
»ad_Úly
ð*(
my_boÞ
 *)
¬g1
;

352 
rc
= -1;

355 
	`va_’d
(
­
);

356 (
rc
);

357 
	}
}

	@plugins/io/remote_io.c

46 
	~<ma_glob®.h
>

47 
	~<ma_sys.h
>

48 
	~<mysql.h
>

49 
	~<mysql/þ›Á_¶ugš.h
>

50 
	~<¡ršg.h
>

51 
	~<memÜy.h
>

53 
	~<¡dio.h
>

54 
	~<¡ršg.h
>

55 #iâdeà
WIN32


56 
	~<sys/time.h
>

58 #´agm¨
comm’t
(
lib
, "Ws2_32.lib")

60 
	~<¡dlib.h
>

61 
	~<”ºo.h
>

62 
	~<m¬Ÿdb/ma_io.h
>

66 
MA_FILE
 *
ma_rio_Ý’
(cÚ¡ *
u¾
,cÚ¡ *
Ý”©iÚ
);

67 
ma_rio_þo£
(
MA_FILE
 *
fže
);

68 
ma_rio_ãof
(
MA_FILE
 *
fže
);

69 
size_t
 
ma_rio_»ad
(*
±r
, size_ˆ
size
, size_ˆ
nmemb
, 
MA_FILE
 *
fže
);

70 * 
ma_rio_g‘s
(*
±r
, 
size_t
 
size
, 
MA_FILE
 *
fže
);

72 
ma_rio_š™
(*, 
size_t
, , 
va_li¡
);

73 
ma_rio_deš™
();

75 
¡_rio_m‘hods
 
	gma_rio_m‘hods
= {

76 
ma_rio_Ý’
,

77 
ma_rio_þo£
,

78 
ma_rio_ãof
,

79 
ma_rio_»ad
,

80 
ma_rio_g‘s


85 
CURL
 *
	mcu¾
;

86 
size_t
 
	mËngth
,

87 
	moff£t
;

88 
uch¬
 *
	mbufãr
;

89 
	mš_´og»ss
;

90 } 
	tMA_REMOTE_FILE
;

92 
CURLM
 *
	gmuÉi_hªdË
ð
NULL
;

94 #iâdeà
PLUGIN_DYNAMIC


95 
MARIADB_REMOTEIO_PLUGIN
 
	g»mÙe_io_þ›Á_¶ugš
=

97 
MARIADB_REMOTEIO_PLUGIN
 
_mysql_þ›Á_¶ugš_deþ¬©iÚ_
 =

100 
MARIADB_CLIENT_REMOTEIO_PLUGIN
,

101 
MARIADB_CLIENT_REMOTEIO_PLUGIN_INTERFACE_VERSION
,

107 
NULL
,

108 
ma_rio_š™
,

109 
ma_rio_deš™
,

110 
NULL
,

111 &
ma_rio_m‘hods


112 
mysql_’d_þ›Á_¶ugš
;

115 
ma_rio_š™
(*
unu£d1
 
__©Œibu‹__
((
unu£d
)),

116 
size_t
 
unu£d2
 
__©Œibu‹__
((
unu£d
)),

117 
unu£d3
 
__©Œibu‹__
((
unu£d
)),

118 
va_li¡
 
unu£d4
 
__©Œibu‹__
((
unu£d
)))

120 
cu¾_glob®_š™
(
CURL_GLOBAL_ALL
);

121 ià(!
	gmuÉi_hªdË
)

122 
	gmuÉi_hªdË
 = 
cu¾_muÉi_š™
();

128 
ma_rio_deš™
()

130 ià(
	gmuÉi_hªdË
)

132 
cu¾_muÉi_þ—nup
(
muÉi_hªdË
);

133 
	gmuÉi_hªdË
ð
NULL
;

135 
cu¾_glob®_þ—nup
();

141 
size_t
 
rio_wr™e_ÿÎback
(*
bufãr
,

142 
size_t
 
size
,

143 
size_t
 
n™ems
,

144 *
±r
)

146 
size_t
 
	gä“_by‹s
;

147 *
	gtmp
;

149 
MA_FILE
 *
	gfže
ð(MA_FILE *)
±r
;

150 
MA_REMOTE_FILE
 *
	gcu¾_fže
 = (MA_REMOTE_FILE *)
fže
->
±r
;

151 
	gsize
 *ð
n™ems
;

153 
	gä“_by‹s
ð
cu¾_fže
->
Ëngth
 - cu¾_fže->
off£t
;

156 ià(
	gsize
 > 
	gä“_by‹s
) {

157 
	gtmp
ð(*)
»®loc
((
g±r
)
cu¾_fže
->
bufãr
, cu¾_fže->
Ëngth
 + (
size
 - 
ä“_by‹s
));

158 ià(!
	gtmp
)

159 
	gsize
ð
ä“_by‹s
;

161 
	gcu¾_fže
->
	gËngth
+ð
size
 - 
ä“_by‹s
;

162 
	gcu¾_fže
->
	gbufãr
ð(*)
tmp
;

167 
memýy
((*)
cu¾_fže
->
bufãr
 + cu¾_fže->
off£t
, bufãr, 
size
);

168 
	gcu¾_fže
->
	goff£t
+ð
size
;

170  
	gsize
;

175 
fžl_bufãr
(
MA_FILE
 *
fže
, 
size_t
 
wªt
)

177 
fd_£t
 
	gfd»ad
;

178 
fd_£t
 
	gfdwr™e
;

179 
fd_£t
 
	gfdexûp
;

180 
timev®
 
	gtimeout
;

181 
	grc
;

182 
CURLMcode
 
	gmc
;

183 
MA_REMOTE_FILE
 *
	grf
ð(MA_REMOTE_FILE *)
fže
->
±r
;

187 ià(!
	grf
->
	gš_´og»ss
 || (rf->
	goff£t
 > 
	gwªt
))

192 
	gmaxfd
 = -1;

193 
	gcu¾_timeo
 = -1;

195 
FD_ZERO
(&
fd»ad
);

196 
FD_ZERO
(&
fdwr™e
);

197 
FD_ZERO
(&
fdexûp
);

200 
	gtimeout
.
	gtv_£c
 = 20;

201 
	gtimeout
.
	gtv_u£c
 = 0;

203 
cu¾_muÉi_timeout
(
muÉi_hªdË
, &
cu¾_timeo
);

204 if(
	gcu¾_timeo
 >= 0) {

205 
timeout
.
tv_£c
 = 
cu¾_timeo
 / 1000;

206 if(
	gtimeout
.
	gtv_£c
 > 1)

207 
	gtimeout
.
	gtv_£c
 = 1;

209 
	gtimeout
.
	gtv_u£c
 = (
cu¾_timeo
 % 1000) * 1000;

213 
	gmc
 = 
cu¾_muÉi_fd£t
(
muÉi_hªdË
, &
fd»ad
, &
fdwr™e
, &
fdexûp
, &
maxfd
);

215 if(
	gmc
 !ð
CURLM_OK
)

225 if(
	gmaxfd
 == -1) {

226 
timev®
 
wa™
 = { 0, 100 * 1000 };

227 
	grc
 = 
£Ëù
(0, 
NULL
, NULL, NULL, &
wa™
);

230 
	grc
 = 
£Ëù
(
maxfd
+1, &
fd»ad
, &
fdwr™e
, &
fdexûp
, &
timeout
);

233 
	grc
) {

241 
cu¾_muÉi_³rfÜm
(
muÉi_hªdË
, &
rf
->
š_´og»ss
);

244 } 
	grf
->
	gš_´og»ss
 && (rf->
	goff£t
 < 
	gwªt
));

249 
u£_bufãr
(
MA_FILE
 *
fže
,
wªt
)

251 
MA_REMOTE_FILE
 *
	grf
ð(MA_REMOTE_FILE *)
fže
->
±r
;

253 if((
	grf
->
	goff£t
 - 
	gwªt
) <=0) {

255 ià(
rf
->
bufãr
)

256 
ä“
(
rf
->
bufãr
);

258 
	grf
->
	gbufãr
=
NULL
;

259 
	grf
->
	goff£t
=0;

260 
	grf
->
	gËngth
=0;

264 
memmove
(
rf
->
bufãr
,

265 &
rf
->
bufãr
[
wªt
],

266 (
rf
->
off£t
 - 
wªt
));

268 
	grf
->
	goff£t
 -ð
wªt
;

273 
MA_FILE
 *
ma_rio_Ý’
(cÚ¡ *
u¾
,cÚ¡ *
Ý”©iÚ
)

278 
MA_FILE
 *
	gfže
;

279 
MA_REMOTE_FILE
 *
	grf
;

280 ()
	gÝ”©iÚ
;

282 ià(!(
	gfže
 = (
MA_FILE
 *)
ÿÎoc
((MA_FILE), 1)))

283  
	gNULL
;

285 
	gfže
->
	gty³
ð
MA_FILE_REMOTE
;

286 ià(!(
	gfže
->
	g±r
ð
rf
ð(
MA_REMOTE_FILE
 *)
ÿÎoc
((MA_REMOTE_FILE), 1)))

288 
ä“
(
fže
);

289  
	gNULL
;

291 
	grf
->
	gcu¾
 = 
cu¾_—sy_š™
();

293 ià(
cu¾_—sy_£tÝt
(
rf
->
cu¾
, 
CURLOPT_URL
, 
u¾
) ||

294 
cu¾_—sy_£tÝt
(
rf
->
cu¾
, 
CURLOPT_WRITEDATA
, 
fže
) ||

295 
cu¾_—sy_£tÝt
(
rf
->
cu¾
, 
CURLOPT_VERBOSE
, 0L) ||

296 
cu¾_—sy_£tÝt
(
rf
->
cu¾
, 
CURLOPT_WRITEFUNCTION
, 
rio_wr™e_ÿÎback
))

298 
ä“
(
fže
);

299 
ä“
(
rf
);

300  
	gNULL
;

303 
cu¾_muÉi_add_hªdË
(
muÉi_hªdË
, 
rf
->
cu¾
);

306 
cu¾_muÉi_³rfÜm
(
muÉi_hªdË
, &
rf
->
š_´og»ss
);

308 if((
	grf
->
	goff£t
 =ð0è&& (!
rf
->
š_´og»ss
)) {

312 
cu¾_muÉi_»move_hªdË
(
muÉi_hªdË
, 
rf
->
cu¾
);

315 
cu¾_—sy_þ—nup
(
rf
->
cu¾
);

317 
ä“
(
fže
);

319 
	gfže
 = 
NULL
;

321  
	gfže
;

324 
ma_rio_þo£
(
MA_FILE
 *
fže
)

326 
	g»t
=0;

327 
MA_REMOTE_FILE
 *
	grf
ð(MA_REMOTE_FILE *)
fže
->
±r
;

329 
	gfže
->
	gty³
) {

330 
	gMA_FILE_REMOTE
:

331 
cu¾_muÉi_»move_hªdË
(
muÉi_hªdË
, 
rf
->
cu¾
);

334 
cu¾_—sy_þ—nup
(
rf
->
cu¾
);

338 
»t
=
EOF
;

339 
	g”ºo
=
EBADF
;

343 if(
	grf
->
	gbufãr
)

344 
ä“
(
rf
->
bufãr
);

346 
ä“
(
rf
);

347 
ä“
(
fže
);

349  
	g»t
;

352 
ma_rio_ãof
(
MA_FILE
 *
fže
)

354 
	g»t
=0;

355 
MA_REMOTE_FILE
 *
	grf
ð(MA_REMOTE_FILE *)
fže
->
±r
;

357 
	gfže
->
	gty³
) {

358 
	gMA_FILE_REMOTE
:

359 if((
rf
->
off£t
 =ð0è&& (!rf->
š_´og»ss
))

360 
»t
 = 1;

364 
»t
=-1;

365 
	g”ºo
=
EBADF
;

368  
	g»t
;

371 
size_t
 
ma_rio_»ad
(*
±r
, size_ˆ
size
, size_ˆ
nmemb
, 
MA_FILE
 *
fže
)

373 
size_t
 
	gwªt
;

374 
MA_REMOTE_FILE
 *
	grf
ð(MA_REMOTE_FILE *)
fže
->
±r
;

376 
	gfže
->
	gty³
) {

377 
	gMA_FILE_REMOTE
:

378 
wªt
 = 
nmemb
 * 
size
;

380 
fžl_bufãr
(
fže
,
wªt
);

384 if(!
	grf
->
	goff£t
)

388 if(
	grf
->
	goff£t
 < 
	gwªt
)

389 
	gwªt
 = 
rf
->
off£t
;

392 
memýy
(
±r
, 
rf
->
bufãr
, 
wªt
);

394 
u£_bufãr
(
fže
,
wªt
);

396 
	gwªt
 = 
wªt
 / 
size
;

400 
wªt
=0;

401 
	g”ºo
=
EBADF
;

405  
	gwªt
;

408 *
ma_rio_g‘s
(*
±r
, 
size_t
 
size
, 
MA_FILE
 *
fže
)

410 
size_t
 
	gwªt
 = 
size
 - 1;

411 
size_t
 
	gloÝ
;

413 
	gfže
->
	gty³
) {

414 
	gMA_FILE_REMOTE
:

416 
MA_REMOTE_FILE
 *
rf
ð(MA_REMOTE_FILE *)
fže
->
±r
;

417 
fžl_bufãr
(
fže
,
wªt
);

421 if(!
	grf
->
	goff£t
)

422  
	gNULL
;

425 if(
	grf
->
	goff£t
 < 
	gwªt
)

426 
	gwªt
 = 
rf
->
off£t
;

430 
	gloÝ
=0;loÝ < 
	gwªt
;loop++) {

431 if(
	grf
->
	gbufãr
[
loÝ
] == '\n') {

432 
wªt
=
loÝ
+1;

438 
memýy
(
±r
, 
rf
->
bufãr
, 
wªt
);

439 
	g±r
[
wªt
]=0;

441 
u£_bufãr
(
fže
,
wªt
);

447 
±r
=
NULL
;

448 
	g”ºo
=
EBADF
;

452  
	g±r
;

	@plugins/pvio/pvio_npipe.c

23 #ifdeà
_WIN32


25 
	~<ma_glob®.h
>

26 
	~<ma_sys.h
>

27 
	~<”rmsg.h
>

28 
	~<mysql.h
>

29 
	~<mysql/þ›Á_¶ugš.h
>

30 
	~<¡ršg.h
>

31 
	~<ma_¡ršg.h
>

34 
my_boÞ
 
pvio_Åe_£t_timeout
(
MARIADB_PVIO
 *
pvio
, 
’um_pvio_timeout
 
ty³
, 
timeout
);

35 
pvio_Åe_g‘_timeout
(
MARIADB_PVIO
 *
pvio
, 
’um_pvio_timeout
 
ty³
);

36 
ssize_t
 
pvio_Åe_»ad
(
MARIADB_PVIO
 *
pvio
, 
uch¬
 *
bufãr
, 
size_t
 
Ëngth
);

37 
ssize_t
 
pvio_Åe_wr™e
(
MARIADB_PVIO
 *
pvio
, cÚ¡ 
uch¬
 *
bufãr
, 
size_t
 
Ëngth
);

39 
my_boÞ
 
pvio_Åe_cÚÃù
(
MARIADB_PVIO
 *
pvio
, 
MA_PVIO_CINFO
 *
cšfo
);

40 
my_boÞ
 
pvio_Åe_þo£
(
MARIADB_PVIO
 *
pvio
);

41 
pvio_Åe_ç¡_£nd
(
MARIADB_PVIO
 *
pvio
);

42 
pvio_Åe_k“·live
(
MARIADB_PVIO
 *
pvio
);

43 
my_boÞ
 
pvio_Åe_g‘_hªdË
(
MARIADB_PVIO
 *
pvio
, *
hªdË
);

44 
my_boÞ
 
pvio_Åe_is_blockšg
(
MARIADB_PVIO
 *
pvio
);

45 
pvio_Åe_shutdown
(
MARIADB_PVIO
 *
pvio
);

46 
my_boÞ
 
pvio_Åe_is_®ive
(
MARIADB_PVIO
 *
pvio
);

48 
¡_ma_pvio_m‘hods
 
	gpvio_Åe_m‘hods
= {

49 
pvio_Åe_£t_timeout
,

50 
pvio_Åe_g‘_timeout
,

51 
pvio_Åe_»ad
,

52 
NULL
,

53 
pvio_Åe_wr™e
,

54 
NULL
,

55 
NULL
,

56 
NULL
,

57 
pvio_Åe_cÚÃù
,

58 
pvio_Åe_þo£
,

59 
pvio_Åe_ç¡_£nd
,

60 
pvio_Åe_k“·live
,

61 
pvio_Åe_g‘_hªdË
,

62 
pvio_Åe_is_blockšg
,

63 
pvio_Åe_is_®ive
,

64 
NULL
,

65 
pvio_Åe_shutdown


68 #iâdeà
PLUGIN_DYNAMIC


69 
MARIADB_PVIO_PLUGIN
 
	gpvio_Åe_þ›Á_¶ugš
 =

71 
MARIADB_PVIO_PLUGIN
 
_mysql_þ›Á_¶ugš_deþ¬©iÚ_
 =

74 
MARIADB_CLIENT_PVIO_PLUGIN
,

75 
MARIADB_CLIENT_PVIO_PLUGIN_INTERFACE_VERSION
,

81 
NULL
,

82 
NULL
,

83 
NULL
,

84 
NULL
,

85 &
pvio_Åe_m‘hods


88 
	s¡_pvio_Åe
 {

89 
HANDLE
 
	mpe
;

90 
OVERLAPPED
 
	mov”Ïµed
;

91 
MYSQL
 *
	mmysql
;

94 
my_boÞ
 
	$pvio_Åe_£t_timeout
(
MARIADB_PVIO
 *
pvio
, 
’um_pvio_timeout
 
ty³
, 
timeout
)

96 
timeout_ms
;

98 ià(!
pvio
)

100 ià(
timeout
 > 
INT_MAX
/1000)

101 
timeout_ms
= -1;

102 ià(
timeout
 <=0)

103 
timeout_ms
= -1;

105 
timeout_ms
 = 
timeout
*1000;

107 
pvio
->
timeout
[
ty³
]ð
timeout_ms
;

109 
	}
}

111 
	$pvio_Åe_g‘_timeout
(
MARIADB_PVIO
 *
pvio
, 
’um_pvio_timeout
 
ty³
)

113 ià(!
pvio
)

115  
pvio
->
timeout
[
ty³
] / 1000;

116 
	}
}

118 
BOOL
 
	$com¶‘e_io
(
HANDLE
 
fže
, 
OVERLAPPED
 *
ov
, 
BOOL
 
»t
, 
DWORD
 
timeout
, DWORD *
size
)

120 ià(
»t
)

121 
timeout
 = 0;

124 
	`as£¹
(
timeout
);

125 ià(
	`G‘La¡E¼Ü
(è!ð
ERROR_IO_PENDING
)

126  
FALSE
;

129 ià(
timeout
)

131 
HANDLE
 
wa™_hªdË
ð
ov
->
hEv’t
;

132 
	`as£¹
(
wa™_hªdË
 && (wa™_hªdË !ð
INVALID_HANDLE_VALUE
));

134 
DWORD
 
wa™_»t
ð
	`Wa™FÜSšgËObjeù
(
wa™_hªdË
, 
timeout
);

135 
wa™_»t
)

137 
WAIT_OBJECT_0
:

139 
WAIT_TIMEOUT
:

140 
	`CªûlIoEx
(
fže
, 
ov
);

141 
	`S‘La¡E¼Ü
(
ERROR_TIMEOUT
);

142  
FALSE
;

145 
	`as£¹
(0);

146  
FALSE
;

150  
	`G‘Ov”ÏµedResuÉ
(
fže
, 
ov
, 
size
, 
FALSE
);

151 
	}
}

153 
ssize_t
 
	$pvio_Åe_»ad
(
MARIADB_PVIO
 *
pvio
, 
uch¬
 *
bufãr
, 
size_t
 
Ëngth
)

155 
BOOL
 
»t
;

156 
ssize_t
 
r
= -1;

157 
¡_pvio_Åe
 *
ýe
ð
NULL
;

158 
DWORD
 
size
;

160 ià(!
pvio
 || !pvio->
d©a
)

163 
ýe
ð(
¡_pvio_Åe
 *)
pvio
->
d©a
;

165 
»t
ð
	`R—dFže
(
ýe
->
pe
, 
bufãr
, (
DWORD
)
Ëngth
, 
NULL
, &ýe->
ov”Ïµed
);

166 
»t
ð
	`com¶‘e_io
(
ýe
->
pe
, &ýe->
ov”Ïµed
,„‘, 
pvio
->
timeout
[
PVIO_READ_TIMEOUT
], &
size
);

167 
r
ð
»t
? (
ssize_t
è
size
:-1;

169  
r
;

170 
	}
}

172 
ssize_t
 
	$pvio_Åe_wr™e
(
MARIADB_PVIO
 *
pvio
, cÚ¡ 
uch¬
 *
bufãr
, 
size_t
 
Ëngth
)

174 
ssize_t
 
r
= -1;

175 
¡_pvio_Åe
 *
ýe
ð
NULL
;

176 
BOOL
 
»t
;

177 
DWORD
 
size
;

179 ià(!
pvio
 || !pvio->
d©a
)

182 
ýe
ð(
¡_pvio_Åe
 *)
pvio
->
d©a
;

184 
»t
ð
	`Wr™eFže
(
ýe
->
pe
, 
bufãr
, (
DWORD
)
Ëngth
, 
NULL
 , &ýe->
ov”Ïµed
);

185 
»t
ð
	`com¶‘e_io
(
ýe
->
pe
, &ýe->
ov”Ïµed
,„‘, 
pvio
->
timeout
[
PVIO_WRITE_TIMEOUT
], &
size
);

186 
r
ð
»t
 ? (
ssize_t
)
size
 : -1;

187  
r
;

188 
	}
}

191 
	$pvio_Åe_k“·live
(
MARIADB_PVIO
 *
pvio
)

195 
	}
}

197 
	$pvio_Åe_ç¡_£nd
(
MARIADB_PVIO
 *
pvio
)

201 
	}
}

202 
my_boÞ
 
	$pvio_Åe_cÚÃù
(
MARIADB_PVIO
 *
pvio
, 
MA_PVIO_CINFO
 *
cšfo
)

204 
¡_pvio_Åe
 *
ýe
ð
NULL
;

206 ià(!
pvio
 || !
cšfo
)

210 ià(
pvio
->
timeout
[
PVIO_CONNECT_TIMEOUT
])

212 
pvio
->
timeout
[
PVIO_READ_TIMEOUT
]ðpvio->timeout[
PVIO_WRITE_TIMEOUT
]ðpvio->timeout[
PVIO_CONNECT_TIMEOUT
];

215 ià(!(
ýe
ð(
¡_pvio_Åe
 *)
	`LoÿlAÎoc
(
LMEM_ZEROINIT
, (st_pvio_npipe))))

217 
	`PVIO_SET_ERROR
(
cšfo
->
mysql
, 
CR_OUT_OF_MEMORY
, "HY000", 0, "");

220 
pvio
->
d©a
ð(*)
ýe
;

221 
ýe
->
pe
ð
INVALID_HANDLE_VALUE
;

222 
pvio
->
mysql
ð
cšfo
->mysql;

223 
pvio
->
ty³
ð
cšfo
->type;

225 ià(
cšfo
->
ty³
 =ð
PVIO_TYPE_NAMEDPIPE
)

227 
szPeName
[
MAX_PATH
];

228 
ULONGLONG
 
d—dlše
;

229 
LONGLONG
 
wa™_ms
;

230 
DWORD
 
backoff
= 0;

231 iàÐ! 
cšfo
->
unix_sock‘
 || (cinfo->unix_socket)[0] == 0x00)

232 
cšfo
->
unix_sock‘
 = 
MARIADB_NAMEDPIPE
;

233 ià(!
cšfo
->
ho¡
 || !
	`¡rcmp
(cšfo->ho¡,
LOCAL_HOST
))

234 
cšfo
->
ho¡
=
LOCAL_HOST_NAMEDPIPE
;

236 
szPeName
[
MAX_PATH
 - 1]= 0;

237 
	`¢´štf
(
szPeName
, 
MAX_PATH
 - 1, "\\\\%s\\pe\\%s", 
cšfo
->
ho¡
, cšfo->
unix_sock‘
);

239 ià(
pvio
->
timeout
[
PVIO_CONNECT_TIMEOUT
] > 0)

240 
d—dlše
 = 
	`G‘TickCouÁ64
(è+ 
pvio
->
timeout
[
PVIO_CONNECT_TIMEOUT
];

242 
d—dlše
 = 
INFINITE
;

246 ià((
ýe
->
pe
 = 
	`C»©eFže
(
szPeName
,

247 
GENERIC_READ
 |

248 
GENERIC_WRITE
,

250 
NULL
,

251 
OPEN_EXISTING
,

252 
FILE_FLAG_OVERLAPPED
,

253 
NULL
)è!ð
INVALID_HANDLE_VALUE
)

256 ià(
	`G‘La¡E¼Ü
(è!ð
ERROR_PIPE_BUSY
)

258 
pvio
->
	`£t_”rÜ
Õvio->
mysql
, 
CR_NAMEDPIPEOPEN_ERROR
, "HY000", 0,

259 
cšfo
->
ho¡
, cšfo->
unix_sock‘
, 
	`G‘La¡E¼Ü
());

260 
’d
;

263 
	`SË•
(
backoff
);

264 ià(!
backoff
)

265 
backoff
 = 1;

267 
wa™_ms
 = 
d—dlše
 - 
	`G‘TickCouÁ64
();

268 ià(
wa™_ms
 > 
INFINITE
)

269 
wa™_ms
 = 
INFINITE
;

271 ià((
wa™_ms
 <ð0è|| !
	`Wa™NamedPe
(
szPeName
, (
DWORD
)wait_ms))

273 
pvio
->
	`£t_”rÜ
Õvio->
mysql
, 
CR_NAMEDPIPEWAIT_ERROR
, "HY000", 0,

274 
cšfo
->
ho¡
, cšfo->
unix_sock‘
, 
ERROR_TIMEOUT
);

275 
’d
;

280 ià(!(
ýe
->
ov”Ïµed
.
hEv’t
ð
	`C»©eEv’t
(
NULL
, 
FALSE
, FALSE, NULL)))

282 
pvio
->
	`£t_”rÜ
Õvio->
mysql
, 
CR_EVENT_CREATE_FAILED
, "HY000", 0,

283 
	`G‘La¡E¼Ü
());

284 
’d
;

288 
’d
:

289 ià(
ýe
)

291 ià(
ýe
->
pe
 !ð
INVALID_HANDLE_VALUE
)

292 
	`Clo£HªdË
(
ýe
->
pe
);

293 
	`LoÿlF»e
(
ýe
);

294 
pvio
->
d©a
ð
NULL
;

297 
	}
}

299 
my_boÞ
 
	$pvio_Åe_þo£
(
MARIADB_PVIO
 *
pvio
)

301 
¡_pvio_Åe
 *
ýe
ð
NULL
;

302 
r
= 0;

304 ià(!
pvio
)

307 ià(
pvio
->
d©a
)

309 
ýe
ð(
¡_pvio_Åe
 *)
pvio
->
d©a
;

310 
	`Clo£HªdË
(
ýe
->
ov”Ïµed
.
hEv’t
);

311 ià(
ýe
->
pe
 !ð
INVALID_HANDLE_VALUE
)

313 
	`Clo£HªdË
(
ýe
->
pe
);

314 
ýe
->
pe
ð
INVALID_HANDLE_VALUE
;

316 
	`LoÿlF»e
(
pvio
->
d©a
);

317 
pvio
->
d©a
ð
NULL
;

319  
r
;

320 
	}
}

322 
my_boÞ
 
	$pvio_Åe_g‘_hªdË
(
MARIADB_PVIO
 *
pvio
, *
hªdË
)

324 ià(
pvio
 &&…vio->
d©a
)

326 *(
HANDLE
 *)
hªdË
ð((
¡_pvio_Åe
 *)
pvio
->
d©a
)->
pe
;

330 
	}
}

332 
my_boÞ
 
	$pvio_Åe_is_blockšg
(
MARIADB_PVIO
 *
pvio
)

335 
	}
}

337 
	$pvio_Åe_shutdown
(
MARIADB_PVIO
 *
pvio
)

339 
HANDLE
 
h
;

340 ià(
	`pvio_Åe_g‘_hªdË
(
pvio
, &
h
) == 0)

342 (
	`CªûlIoEx
(
h
, 
NULL
) ? 0 : 1);

345 
	}
}

347 
my_boÞ
 
	$pvio_Åe_is_®ive
(
MARIADB_PVIO
 *
pvio
)

349 
HANDLE
 
hªdË
;

350 ià(!
pvio
 || !pvio->
d©a
)

351  
FALSE
;

353 
hªdË
ð((
¡_pvio_Åe
 *)
pvio
->
d©a
)->
pe
;

355 ià(
	`P“kNamedPe
(
hªdË
, 
NULL
, 0, NULL, NULL, NULL))

356  
TRUE
;

357  
	`‹¡
(
	`G‘La¡E¼Ü
(è!ð
ERROR_BROKEN_PIPE
);

358 
	}
}

	@plugins/pvio/pvio_shmem.c

22 #ifdeà
_WIN32


24 
	~<ma_glob®.h
>

25 
	~<ma_sys.h
>

26 
	~<”rmsg.h
>

27 
	~<mysql.h
>

28 
	~<mysql/þ›Á_¶ugš.h
>

29 
	~<¡ršg.h
>

30 
	~<ma_¡ršg.h
>

32 
	#PVIO_SHM_BUFFER_SIZE
 (16000 + 4)

	)

34 
my_boÞ
 
pvio_shm_£t_timeout
(
MARIADB_PVIO
 *
pvio
, 
’um_pvio_timeout
 
ty³
, 
timeout
);

35 
pvio_shm_g‘_timeout
(
MARIADB_PVIO
 *
pvio
, 
’um_pvio_timeout
 
ty³
);

36 
ssize_t
 
pvio_shm_»ad
(
MARIADB_PVIO
 *
pvio
, 
uch¬
 *
bufãr
, 
size_t
 
Ëngth
);

37 
ssize_t
 
pvio_shm_wr™e
(
MARIADB_PVIO
 *
pvio
, cÚ¡ 
uch¬
 *
bufãr
, 
size_t
 
Ëngth
);

38 
pvio_shm_wa™_io_Ü_timeout
(
MARIADB_PVIO
 *
pvio
, 
my_boÞ
 
is_»ad
, 
timeout
);

39 
pvio_shm_blockšg
(
MARIADB_PVIO
 *
pvio
, 
my_boÞ
 
v®ue
, my_boÞ *
Þd_v®ue
);

40 
my_boÞ
 
pvio_shm_cÚÃù
(
MARIADB_PVIO
 *
pvio
, 
MA_PVIO_CINFO
 *
cšfo
);

41 
my_boÞ
 
pvio_shm_þo£
(
MARIADB_PVIO
 *
pvio
);

42 
pvio_shm_shutdown
(
MARIADB_PVIO
 *
pvio
);

43 
my_boÞ
 
pvio_shm_is_®ive
(
MARIADB_PVIO
 *
pvio
);

44 
my_boÞ
 
pvio_shm_g‘_hªdË
(
MARIADB_PVIO
 *
pvio
, *
hªdË
);

46 
¡_ma_pvio_m‘hods
 
	gpvio_shm_m‘hods
= {

47 
pvio_shm_£t_timeout
,

48 
pvio_shm_g‘_timeout
,

49 
pvio_shm_»ad
,

50 
NULL
,

51 
pvio_shm_wr™e
,

52 
NULL
,

53 
pvio_shm_wa™_io_Ü_timeout
,

54 
pvio_shm_blockšg
,

55 
pvio_shm_cÚÃù
,

56 
pvio_shm_þo£
,

57 
NULL
,

58 
NULL
,

59 
pvio_shm_g‘_hªdË
,

60 
NULL
,

61 
pvio_shm_is_®ive
,

62 
NULL
,

63 
pvio_shm_shutdown


66 #iâdeà
PLUGIN_DYNAMIC


67 
MARIADB_PVIO_PLUGIN
 
	gpvio_shmem_þ›Á_¶ugš
=

69 
MARIADB_PVIO_PLUGIN
 
_mysql_þ›Á_¶ugš_deþ¬©iÚ_
=

72 
MARIADB_CLIENT_PVIO_PLUGIN
,

73 
MARIADB_CLIENT_PVIO_PLUGIN_INTERFACE_VERSION
,

79 
NULL
,

80 
NULL
,

81 
NULL
,

82 
NULL
,

83 &
pvio_shm_m‘hods
,

87 
	e’um_shm_ev’ts


89 
	mPVIO_SHM_SERVER_WROTE
= 0,

90 
	mPVIO_SHM_SERVER_READ
,

91 
	mPVIO_SHM_CLIENT_WROTE
,

92 
	mPVIO_SHM_CLIENT_READ
,

93 
	mPVIO_SHM_CONNECTION_CLOSED


97 
HANDLE
 
	mev’t
[5];

98 
HANDLE
 
	mfže_m­
;

99 
LPVOID
 *
	mm­
;

100 *
	m»ad_pos
;

101 
size_t
 
	mbufãr_size
;

102 } 
	tPVIO_SHM
;

104 cÚ¡ *
	gSŒEv’t
[]= {"SERVER_WROTE", "SERVER_READ", "CLIENT_WROTE", "CLIENT_READ", "CONNECTION_CLOSED"};

106 
	s¡_pvio_shm
 {

107 *
	mshm_Çme
;

110 
my_boÞ
 
	$pvio_shm_£t_timeout
(
MARIADB_PVIO
 *
pvio
, 
’um_pvio_timeout
 
ty³
, 
timeout
)

112 ià(!
pvio
)

114 
pvio
->
timeout
[
ty³
]ðÑimeouˆ> 0è?imeouˆ* 1000 : 
INFINITE
;

116 
	}
}

118 
	$pvio_shm_g‘_timeout
(
MARIADB_PVIO
 *
pvio
, 
’um_pvio_timeout
 
ty³
)

120 ià(!
pvio
)

122  
pvio
->
timeout
[
ty³
] / 1000;

123 
	}
}

125 
ssize_t
 
	$pvio_shm_»ad
(
MARIADB_PVIO
 *
pvio
, 
uch¬
 *
bufãr
, 
size_t
 
Ëngth
)

127 
PVIO_SHM
 *
pvio_shm
ð(PVIO_SHM *)
pvio
->
d©a
;

128 
size_t
 
cÝy_size
ð
Ëngth
;

129 
HANDLE
 
ev’ts
[2];

131 ià(!
pvio_shm
)

135 ià(!
pvio_shm
->
bufãr_size
)

137 
ev’ts
[0]ð
pvio_shm
->
ev’t
[
PVIO_SHM_CONNECTION_CLOSED
];

138 
ev’ts
[1]ð
pvio_shm
->
ev’t
[
PVIO_SHM_SERVER_WROTE
];

140 
	`Wa™FÜMuÉËObjeùs
(2, 
ev’ts
, 0, 
pvio
->
timeout
[
PVIO_READ_TIMEOUT
]))

142 
WAIT_OBJECT_0
:

143 
	`S‘La¡E¼Ü
(
ERROR_GRACEFUL_DISCONNECT
);

145 
WAIT_OBJECT_0
 +1:

147 
WAIT_TIMEOUT
:

148 
	`S‘La¡E¼Ü
(
ETIMEDOUT
);

153 
pvio_shm
->
»ad_pos
ð(*ívio_shm->
m­
;

154 
pvio_shm
->
bufãr_size
ð
	`ušt4kÜr
Õvio_shm->
»ad_pos
);

155 
pvio_shm
->
»ad_pos
+= 4;

158 ià(
pvio_shm
->
bufãr_size
 < 
cÝy_size
)

159 
cÝy_size
ð
pvio_shm
->
bufãr_size
;

161 ià(
cÝy_size
)

163 
	`memýy
(
bufãr
, (
uch¬
 *)
pvio_shm
->
»ad_pos
,…vio_shm->
bufãr_size
);

164 
pvio_shm
->
»ad_pos
+ð
cÝy_size
;

165 
pvio_shm
->
bufãr_size
-ð
cÝy_size
;

169 ià(!
pvio_shm
->
bufãr_size
)

170 ià(!
	`S‘Ev’t
(
pvio_shm
->
ev’t
[
PVIO_SHM_CLIENT_READ
]))

173  (
ssize_t
)
cÝy_size
;

174 
	}
}

176 
ssize_t
 
	$pvio_shm_wr™e
(
MARIADB_PVIO
 *
pvio
, cÚ¡ 
uch¬
 *
bufãr
, 
size_t
 
Ëngth
)

178 
HANDLE
 
ev’ts
[2];

179 
PVIO_SHM
 *
pvio_shm
ð(PVIO_SHM *)
pvio
->
d©a
;

180 
size_t
 
by‹s_to_wr™e
ð
Ëngth
;

181 
uch¬
 *
bufãr_pos
ð(uch¬ *)
bufãr
;

183 ià(!
pvio_shm
)

186 
ev’ts
[0]ð
pvio_shm
->
ev’t
[
PVIO_SHM_CONNECTION_CLOSED
];

187 
ev’ts
[1]ð
pvio_shm
->
ev’t
[
PVIO_SHM_SERVER_READ
];

189 
by‹s_to_wr™e
)

191 
size_t
 
pkt_Ëngth
;

192 
	`Wa™FÜMuÉËObjeùs
(2, 
ev’ts
, 0, 
pvio
->
timeout
[
PVIO_WRITE_TIMEOUT
])) {

193 
WAIT_OBJECT_0
:

194 
	`S‘La¡E¼Ü
(
ERROR_GRACEFUL_DISCONNECT
);

196 
WAIT_OBJECT_0
 + 1:

198 
WAIT_TIMEOUT
:

199 
	`S‘La¡E¼Ü
(
ETIMEDOUT
);

203 
pkt_Ëngth
ð
	`MIN
(
PVIO_SHM_BUFFER_SIZE
, 
Ëngth
);

204 
	`št4¡Üe
(
pvio_shm
->
m­
, 
pkt_Ëngth
);

205 
	`memýy
((
uch¬
 *)
pvio_shm
->
m­
 + 4, 
bufãr_pos
, 
Ëngth
);

206 
bufãr_pos
+ð
Ëngth
;

207 
by‹s_to_wr™e
-ð
Ëngth
;

209 ià(!
	`S‘Ev’t
(
pvio_shm
->
ev’t
[
PVIO_SHM_CLIENT_WROTE
]))

212  (
ssize_t
)
Ëngth
;

213 
	}
}

216 
	$pvio_shm_wa™_io_Ü_timeout
(
MARIADB_PVIO
 *
pvio
, 
my_boÞ
 
is_»ad
, 
timeout
)

219 
	}
}

221 
	$pvio_shm_blockšg
(
MARIADB_PVIO
 *
pvio
, 
my_boÞ
 
block
, my_boÞ *
´evious_mode
)

225 
	}
}

227 
	$pvio_shm_k“·live
(
MARIADB_PVIO
 *
pvio
)

231 
	}
}

233 
	$pvio_shm_ç¡_£nd
(
MARIADB_PVIO
 *
pvio
)

237 
	}
}

239 
my_boÞ
 
	$pvio_shm_cÚÃù
(
MARIADB_PVIO
 *
pvio
, 
MA_PVIO_CINFO
 *
cšfo
)

241 cÚ¡ *
ba£_memÜy_Çme
;

242 *
´efixes
[]ð{"", "Glob®\\", 
NULL
};

243 *
shm_Çme
, *
shm_suffix
, *
shm_´efix
;

244 
uch¬
 
i
= 0;

245 
Ën
;

246 
cid
;

247 
DWORD
 
dwDesœedAcûss
ð
EVENT_MODIFY_STATE
 | 
SYNCHRONIZE
;

248 
HANDLE
 
hdlCÚÃùReque¡
ð
NULL
,

249 
hdlCÚÃùReque¡Answ”
ð
NULL
,

250 
fže_m­
ð
NULL
;

251 
LPVOID
 
m­
ð
NULL
;

252 
PVIO_SHM
 *
pvio_shm
ð(PVIO_SHM*)
	`LoÿlAÎoc
(
LMEM_ZEROINIT
, (PVIO_SHM));

254 ià(!
pvio_shm
)

256 
	`PVIO_SET_ERROR
(
cšfo
->
mysql
, 
CR_OUT_OF_MEMORY
, "HY000", 0, "");

266 
ba£_memÜy_Çme
ð(
cšfo
->
ho¡
è? cšfo->ho¡ : 
SHM_DEFAULT_NAME
;

268 ià(!(
shm_Çme
ð(*)
	`LoÿlAÎoc
(
LMEM_ZEROINIT
, 
	`¡¾’
(
ba£_memÜy_Çme
) + 40)))

270 
	`PVIO_SET_ERROR
(
cšfo
->
mysql
, 
CR_OUT_OF_MEMORY
, "HY000", 0, "");

271 
”rÜ
;

275 
´efixes
[
i
])

277 
Ën
ð
	`¥rštf
(
shm_Çme
, "%s%s_", 
´efixes
[
i
], 
ba£_memÜy_Çme
);

278 
shm_suffix
ð
shm_Çme
 + 
Ën
;

279 
	`¡rýy
(
shm_suffix
, "CONNECT_REQUEST");

280 ià((
hdlCÚÃùReque¡
ð
	`O³nEv’t
(
dwDesœedAcûss
, 0, 
shm_Çme
)))

283 
shm_´efix
ð
´efixes
[
i
];

286 
i
++;

288 ià(!
hdlCÚÃùReque¡
)

290 
	`PVIO_SET_ERROR
(
cšfo
->
mysql
, 
CR_SHARED_MEMORY_CONNECT_ERROR
, "HY000", 0, "O³nšg CONNECT_REQUESTƒv’ˆçžed", 
	`G‘La¡E¼Ü
());

291 
”rÜ
;

294 
	`¡rýy
(
shm_suffix
, "CONNECT_ANSWER");

295 ià(!(
hdlCÚÃùReque¡Answ”
ð
	`O³nEv’t
(
dwDesœedAcûss
, 0, 
shm_Çme
)))

297 
	`PVIO_SET_ERROR
(
cšfo
->
mysql
, 
CR_SHARED_MEMORY_CONNECT_ERROR
, "HY000", 0, "O³nšg CONNECT_ANSWERƒv’ˆçžed", 
	`G‘La¡E¼Ü
());

298 
”rÜ
;

302 
	`¡rýy
(
shm_suffix
, "CONNECT_DATA");

303 ià(!(
fže_m­
ð
	`O³nFžeM­pšg
(
FILE_MAP_WRITE
, 0, 
shm_Çme
)))

305 
	`PVIO_SET_ERROR
(
cšfo
->
mysql
, 
CR_SHARED_MEMORY_CONNECT_ERROR
, "HY000", 0, "O³nFžeM­pšg fažed", 
	`G‘La¡E¼Ü
());

306 
”rÜ
;

310 ià(!(
m­
ð
	`M­V›wOfFže
(
fže_m­
, 
FILE_MAP_WRITE
, 0, 0, (
cid
))))

312 
	`PVIO_SET_ERROR
(
cšfo
->
mysql
, 
CR_SHARED_MEMORY_CONNECT_ERROR
, "HY000", 0, "R—dšg cÚÃùiÚ_id fažed", 
	`G‘La¡E¼Ü
());

313 
”rÜ
;

317 ià(!
	`S‘Ev’t
(
hdlCÚÃùReque¡
))

319 
	`PVIO_SET_ERROR
(
cšfo
->
mysql
, 
CR_SHARED_MEMORY_CONNECT_ERROR
, "HY000", 0, "Fažed s’dšg cÚÃùiÚ„eque¡", 
	`G‘La¡E¼Ü
());

320 
”rÜ
;

324 
	`Wa™FÜSšgËObjeù
(
hdlCÚÃùReque¡Answ”
, 
pvio
->
timeout
[
PVIO_CONNECT_TIMEOUT
])) {

325 
WAIT_ABANDONED
:

326 
	`PVIO_SET_ERROR
(
cšfo
->
mysql
, 
CR_SHARED_MEMORY_CONNECT_ERROR
, "HY000", 0, "Mu‹x wa nÙ„–—£d iÀtime", 
	`G‘La¡E¼Ü
());

327 
”rÜ
;

329 
WAIT_FAILED
:

330 
	`PVIO_SET_ERROR
(
cšfo
->
mysql
, 
CR_SHARED_MEMORY_CONNECT_ERROR
, "HY000", 0, "O³¿tiÚ wa™ fažed", 
	`G‘La¡E¼Ü
());

331 
”rÜ
;

333 
WAIT_TIMEOUT
:

334 
	`PVIO_SET_ERROR
(
cšfo
->
mysql
, 
CR_SHARED_MEMORY_CONNECT_ERROR
, "HY000", 0, "O³¿tiÚimed out", 
	`G‘La¡E¼Ü
());

335 
”rÜ
;

337 
WAIT_OBJECT_0
:

340 
	`PVIO_SET_ERROR
(
cšfo
->
mysql
, 
CR_SHARED_MEMORY_CONNECT_ERROR
, "HY000", 0, "Wa™ fÜ s”v” fažed", 
	`G‘La¡E¼Ü
());

344 
cid
ð
	`ušt4kÜr
(
m­
);

346 
Ën
ð
	`¥rštf
(
shm_Çme
, "%s%s_%d_", 
shm_´efix
, 
ba£_memÜy_Çme
, 
cid
);

347 
shm_suffix
ð
shm_Çme
 + 
Ën
;

349 
	`¡rýy
(
shm_suffix
, "DATA");

350 
pvio_shm
->
fže_m­
ð
	`O³nFžeM­pšg
(
FILE_MAP_WRITE
, 0, 
shm_Çme
);

351 ià(
pvio_shm
->
fže_m­
 =ð
NULL
)

353 
	`PVIO_SET_ERROR
(
cšfo
->
mysql
, 
CR_SHARED_MEMORY_CONNECT_ERROR
, "HY000", 0, "O³nFžeM­pšg fažed", 
	`G‘La¡E¼Ü
());

354 
”rÜ
;

356 ià(!(
pvio_shm
->
m­
ð
	`M­V›wOfFže
Õvio_shm->
fže_m­
, 
FILE_MAP_WRITE
, 0, 0, 
PVIO_SHM_BUFFER_SIZE
)))

358 
	`PVIO_SET_ERROR
(
cšfo
->
mysql
, 
CR_SHARED_MEMORY_CONNECT_ERROR
, "HY000", 0, "M­V›wOfFžçžed", 
	`G‘La¡E¼Ü
());

359 
”rÜ
;

362 
i
=0; i < 5; i++)

364 
	`¡rýy
(
shm_suffix
, 
SŒEv’t
[
i
]);

365 ià(!(
pvio_shm
->
ev’t
[
i
]ð
	`O³nEv’t
(
dwDesœedAcûss
, 0, 
shm_Çme
)))

367 
	`PVIO_SET_ERROR
(
cšfo
->
mysql
, 
CR_SHARED_MEMORY_CONNECT_ERROR
, "HY000", 0, "Couldn'ˆü—‹ƒv’t", 
	`G‘La¡E¼Ü
());

368 
”rÜ
;

372 
	`S‘Ev’t
(
pvio_shm
->
ev’t
[
PVIO_SHM_SERVER_READ
]);

374 
”rÜ
:

375 ià(
hdlCÚÃùReque¡
)

376 
	`Clo£HªdË
(
hdlCÚÃùReque¡
);

377 ià(
hdlCÚÃùReque¡Answ”
)

378 
	`Clo£HªdË
(
hdlCÚÃùReque¡Answ”
);

379 ià(
shm_Çme
)

380 
	`LoÿlF»e
(
shm_Çme
);

381 ià(
m­
)

382 
	`Unm­V›wOfFže
(
m­
);

383 ià(
fže_m­
)

384 
	`Clo£HªdË
(
fže_m­
);

385 ià(
pvio_shm
)

388 ià(
pvio_shm
->
ev’t
[4])

390 
pvio
->
d©a
ð(*)
pvio_shm
;

391 
pvio
->
mysql
ð
cšfo
->mysql;

392 
pvio
->
ty³
ð
cšfo
->type;

393 
pvio_shm
->
»ad_pos
ð(*ívio_shm->
m­
;

394 
pvio
->
mysql
->
Ãt
.pvio=…vio;

397 
i
=0;i < 5; i++)

398 ià(
pvio_shm
->
ev’t
[
i
])

399 
	`Clo£HªdË
(
pvio_shm
->
ev’t
[
i
]);

400 ià(
pvio_shm
->
m­
)

401 
	`Unm­V›wOfFže
(
pvio_shm
->
m­
);

402 ià(
pvio_shm
->
fže_m­
)

403 
	`Clo£HªdË
(
pvio_shm
->
fže_m­
);

404 
	`LoÿlF»e
(
pvio_shm
);

408 
	}
}

410 
my_boÞ
 
	$pvio_shm_þo£
(
MARIADB_PVIO
 *
pvio
)

412 
PVIO_SHM
 *
pvio_shm
ð(PVIO_SHM *)
pvio
->
d©a
;

413 
i
;

415 ià(!
pvio_shm
)

419 
	`S‘Ev’t
(
pvio_shm
->
ev’t
[
PVIO_SHM_CONNECTION_CLOSED
]);

421 
	`Unm­V›wOfFže
(
pvio_shm
->
m­
);

422 
	`Clo£HªdË
(
pvio_shm
->
fže_m­
);

424 
i
=0; i < 5; i++)

425 
	`Clo£HªdË
(
pvio_shm
->
ev’t
[
i
]);

427 
	`LoÿlF»e
(
pvio_shm
);

428 
pvio
->
d©a
ð
NULL
;

430 
	}
}

432 
my_boÞ
 
	$pvio_shm_g‘_sock‘
(
MARIADB_PVIO
 *
pvio
, *
hªdË
)

435 
	}
}

437 
my_boÞ
 
	$pvio_shm_is_blockšg
(
MARIADB_PVIO
 *
pvio
)

440 
	}
}

442 
	$pvio_shm_shutdown
(
MARIADB_PVIO
 *
pvio
)

444 
PVIO_SHM
 *
pvio_shm
ð(PVIO_SHM *)
pvio
->
d©a
;

445 ià(
pvio_shm
)

446  (
	`S‘Ev’t
(
pvio_shm
->
ev’t
[
PVIO_SHM_CONNECTION_CLOSED
]) ? 0 : 1);

448 
	}
}

450 
my_boÞ
 
	$pvio_shm_is_®ive
(
MARIADB_PVIO
 *
pvio
)

452 
PVIO_SHM
 *
pvio_shm
;

453 ià(!
pvio
 || !pvio->
d©a
)

454  
FALSE
;

455 
pvio_shm
ð(
PVIO_SHM
 *)
pvio
->
d©a
;

456  
	`Wa™FÜSšgËObjeù
(
pvio_shm
->
ev’t
[
PVIO_SHM_CONNECTION_CLOSED
], 0)!=
WAIT_OBJECT_0
;

457 
	}
}

459 
my_boÞ
 
	$pvio_shm_g‘_hªdË
(
MARIADB_PVIO
 *
pvio
, *
hªdË
)

462 *(
HANDLE
 **)
hªdË
= 0;

463 ià(!
pvio
 || !pvio->
d©a
)

464  
FALSE
;

465 *(
HANDLE
 **)
hªdË
ð((
PVIO_SHM
*)
pvio
->
d©a
)->
ev’t
;

466  
TRUE
;

467 
	}
}

	@plugins/pvio/pvio_socket.c

27 
	~<ma_glob®.h
>

28 
	~<ma_sys.h
>

29 
	~<”rmsg.h
>

30 
	~<mysql.h
>

31 
	~<mysql/þ›Á_¶ugš.h
>

32 
	~<ma_cÚ‹xt.h
>

33 
	~<m¬Ÿdb_async.h
>

34 
	~<ma_commÚ.h
>

35 
	~<¡ršg.h
>

36 
	~<time.h
>

37 #iâdeà
_WIN32


38 #ifdeà
HAVE_SYS_UN_H


39 
	~<sys/un.h
>

41 #ifdeà
HAVE_POLL


42 
	~<sys/pÞl.h
>

44 #ifdeà
HAVE_SYS_IOCTL_H


45 
	~<sys/ioùl.h
>

47 #ifdeà
HAVE_FCNTL_H


48 
	~<fúŽ.h
>

50 
	~<Ãtš‘/š_sy¡m.h
>

51 
	~<Ãtš‘/š.h
>

52 
	~<Ãtš‘/.h
>

53 
	~<Ãtdb.h
>

54 
	~<Ãtš‘/tý.h
>

55 
	#IS_SOCKET_EINTR
(
”r
è(Ó¼è=ð
SOCKET_EINTR
)

	)

57 
	~<ws2tý.h
>

58 
	#O_NONBLOCK
 1

	)

59 
	#MSG_DONTWAIT
 0

	)

60 
	#IS_SOCKET_EINTR
(
”r
è0

	)

63 #iâdeà
SOCKET_ERROR


64 
	#SOCKET_ERROR
 -1

	)

67 #iâdeà
INVALID_SOCKET


68 
	#INVALID_SOCKET
 -1

	)

71 
	#DNS_TIMEOUT
 30

	)

73 #iâdeà
O_NONBLOCK


74 #ià
defšed
(
O_NDELAY
)

75 
	#O_NONBLOCK
 
O_NODELAY


	)

76 #–ià
defšed
 (
O_FNDELAY
)

77 
	#O_NONBLOCK
 
O_FNDELAY


	)

79 #”rÜ 
sock‘
 
blockšg
 
is
 
nÙ
 
suµÜ‹d
 
Ú
 
this
 
¶©fÜm


83 #ià
SOCKET_EAGAIN
 !ð
SOCKET_EWOULDBLOCK


84 
	#HAVE_SOCKET_EWOULDBLOCK
 1

	)

87 #ifdeà
_AIX


88 #iâdeà
MSG_DONTWAIT


89 
	#MSG_DONTWAIT
 0

	)

94 
my_boÞ
 
pvio_sock‘_£t_timeout
(
MARIADB_PVIO
 *
pvio
, 
’um_pvio_timeout
 
ty³
, 
timeout
);

95 
pvio_sock‘_g‘_timeout
(
MARIADB_PVIO
 *
pvio
, 
’um_pvio_timeout
 
ty³
);

96 
ssize_t
 
pvio_sock‘_»ad
(
MARIADB_PVIO
 *
pvio
, 
uch¬
 *
bufãr
, 
size_t
 
Ëngth
);

97 
ssize_t
 
pvio_sock‘_async_»ad
(
MARIADB_PVIO
 *
pvio
, 
uch¬
 *
bufãr
, 
size_t
 
Ëngth
);

98 
ssize_t
 
pvio_sock‘_async_wr™e
(
MARIADB_PVIO
 *
pvio
, cÚ¡ 
uch¬
 *
bufãr
, 
size_t
 
Ëngth
);

99 
ssize_t
 
pvio_sock‘_wr™e
(
MARIADB_PVIO
 *
pvio
, cÚ¡ 
uch¬
 *
bufãr
, 
size_t
 
Ëngth
);

100 
pvio_sock‘_wa™_io_Ü_timeout
(
MARIADB_PVIO
 *
pvio
, 
my_boÞ
 
is_»ad
, 
timeout
);

101 
pvio_sock‘_blockšg
(
MARIADB_PVIO
 *
pvio
, 
my_boÞ
 
v®ue
, my_boÞ *
Þd_v®ue
);

102 
my_boÞ
 
pvio_sock‘_cÚÃù
(
MARIADB_PVIO
 *
pvio
, 
MA_PVIO_CINFO
 *
cšfo
);

103 
my_boÞ
 
pvio_sock‘_þo£
(
MARIADB_PVIO
 *
pvio
);

104 
pvio_sock‘_ç¡_£nd
(
MARIADB_PVIO
 *
pvio
);

105 
pvio_sock‘_k“·live
(
MARIADB_PVIO
 *
pvio
);

106 
my_boÞ
 
pvio_sock‘_g‘_hªdË
(
MARIADB_PVIO
 *
pvio
, *
hªdË
);

107 
my_boÞ
 
pvio_sock‘_is_blockšg
(
MARIADB_PVIO
 *
pvio
);

108 
my_boÞ
 
pvio_sock‘_is_®ive
(
MARIADB_PVIO
 *
pvio
);

109 
my_boÞ
 
pvio_sock‘_has_d©a
(
MARIADB_PVIO
 *
pvio
, 
ssize_t
 *
d©a_Ën
);

110 
pvio_sock‘_shutdown
(
MARIADB_PVIO
 *
pvio
);

112 
pvio_sock‘_š™
(*
unu£d1
,

113 
size_t
 
unu£d2
,

114 
unu£d3
,

115 
va_li¡
);

116 
pvio_sock‘_’d
();

117 
ssize_t
 
ma_£nd
(
my_sock‘
 
sock‘
, cÚ¡ 
uch¬
 *
bufãr
, 
size_t
 
Ëngth
, 
æags
);

118 
ssize_t
 
ma_»cv
(
my_sock‘
 
sock‘
, 
uch¬
 *
bufãr
, 
size_t
 
Ëngth
, 
æags
);

120 
¡_ma_pvio_m‘hods
 
	gpvio_sock‘_m‘hods
= {

121 
pvio_sock‘_£t_timeout
,

122 
pvio_sock‘_g‘_timeout
,

123 
pvio_sock‘_»ad
,

124 
pvio_sock‘_async_»ad
,

125 
pvio_sock‘_wr™e
,

126 
pvio_sock‘_async_wr™e
,

127 
pvio_sock‘_wa™_io_Ü_timeout
,

128 
pvio_sock‘_blockšg
,

129 
pvio_sock‘_cÚÃù
,

130 
pvio_sock‘_þo£
,

131 
pvio_sock‘_ç¡_£nd
,

132 
pvio_sock‘_k“·live
,

133 
pvio_sock‘_g‘_hªdË
,

134 
pvio_sock‘_is_blockšg
,

135 
pvio_sock‘_is_®ive
,

136 
pvio_sock‘_has_d©a
,

137 
pvio_sock‘_shutdown


140 #iâdeà
PLUGIN_DYNAMIC


141 
MARIADB_PVIO_PLUGIN
 
	gpvio_sock‘_þ›Á_¶ugš
=

143 
MARIADB_PVIO_PLUGIN
 
_mysql_þ›Á_¶ugš_deþ¬©iÚ_


146 
MARIADB_CLIENT_PVIO_PLUGIN
,

147 
MARIADB_CLIENT_PVIO_PLUGIN_INTERFACE_VERSION
,

153 
NULL
,

154 &
pvio_sock‘_š™
,

155 &
pvio_sock‘_’d
,

156 
NULL
,

157 &
pvio_sock‘_m‘hods


160 
	s¡_pvio_sock‘
 {

161 
my_sock‘
 
	msock‘
;

162 
	mfúŽ_mode
;

163 
MYSQL
 *
	mmysql
;

166 
my_boÞ
 
	gpvio_sock‘_š™Ÿlized
ð
FALSE
;

168 
pvio_sock‘_š™
(*
”rmsg
 
__©Œibu‹__
((
unu£d
)),

169 
size_t
 
”rmsg_Ëngth
 
__©Œibu‹__
((
unu£d
)),

170 
unu£d
 
__©Œibu‹__
((unused)),

171 
va_li¡
 
va
 
__©Œibu‹__
((
unu£d
)))

173 
	gpvio_sock‘_š™Ÿlized
ð
TRUE
;

177 
	$pvio_sock‘_’d
()

179 ià(!
pvio_sock‘_š™Ÿlized
)

182 
	}
}

184 
my_boÞ
 
	$pvio_sock‘_chªge_timeout
(
MARIADB_PVIO
 *
pvio
, 
’um_pvio_timeout
 
ty³
, 
timeout
)

186 
timev®
 
tm
;

187 
rc
= 0;

188 
¡_pvio_sock‘
 *
csock
ð
NULL
;

189 ià(!
pvio
)

191 ià(!(
csock
ð(
¡_pvio_sock‘
 *)
pvio
->
d©a
))

193 
tm
.
tv_£c
ð
timeout
 / 1000;

194 
tm
.
tv_u£c
ð(
timeout
 % 1000) * 1000;

195 
ty³
)

197 
PVIO_WRITE_TIMEOUT
:

198 #iâdeà
_WIN32


199 
rc
ð
	`£tsockÝt
(
csock
->
sock‘
, 
SOL_SOCKET
, 
SO_SNDTIMEO
, (cÚ¡ *)&
tm
, (tm));

201 
rc
ð
	`£tsockÝt
(
csock
->
sock‘
, 
SOL_SOCKET
, 
SO_SNDTIMEO
, (cÚ¡ *)&
timeout
, ());

204 
PVIO_READ_TIMEOUT
:

205 #iâdeà
_WIN32


206 
rc
ð
	`£tsockÝt
(
csock
->
sock‘
, 
SOL_SOCKET
, 
SO_RCVTIMEO
, (cÚ¡ *)&
tm
, (tm));

208 
rc
ð
	`£tsockÝt
(
csock
->
sock‘
, 
SOL_SOCKET
, 
SO_RCVTIMEO
, (cÚ¡ *)&
timeout
, ());

214  
rc
;

215 
	}
}

236 
my_boÞ
 
	$pvio_sock‘_£t_timeout
(
MARIADB_PVIO
 *
pvio
, 
’um_pvio_timeout
 
ty³
, 
timeout
)

238 
¡_pvio_sock‘
 *
csock
ð
NULL
;

239 ià(!
pvio
)

241 
csock
ð(
¡_pvio_sock‘
 *)
pvio
->
d©a
;

242 
pvio
->
timeout
[
ty³
]= (timeout > 0) ?imeout * 1000 : -1;

243 ià(
csock
)

244  
	`pvio_sock‘_chªge_timeout
(
pvio
, 
ty³
, 
timeout
 * 1000);

246 
	}
}

267 
	$pvio_sock‘_g‘_timeout
(
MARIADB_PVIO
 *
pvio
, 
’um_pvio_timeout
 
ty³
)

269 ià(!
pvio
)

271  
pvio
->
timeout
[
ty³
] / 1000;

272 
	}
}

295 
ssize_t
 
	$pvio_sock‘_»ad
(
MARIADB_PVIO
 *
pvio
, 
uch¬
 *
bufãr
, 
size_t
 
Ëngth
)

297 
ssize_t
 
r
;

298 
»ad_æags
ð
MSG_DONTWAIT
;

299 
¡_pvio_sock‘
 *
csock
;

300 
timeout
;

302 ià(!
pvio
 || !pvio->
d©a
)

305 
csock
ð(
¡_pvio_sock‘
 *)
pvio
->
d©a
;

306 
timeout
 = 
pvio
->timeout[
PVIO_READ_TIMEOUT
];

308 (
r
 = 
	`ma_»cv
(
csock
->
sock‘
, (*)
bufãr
, 
Ëngth
, 
»ad_æags
)) == -1)

310 
”r
 = 
sock‘_”ºo
;

311 ià((
”r
 !ð
SOCKET_EAGAIN


312 #ifdeà
HAVE_SOCKET_EWOULDBLOCK


313 && 
”r
 !ð
SOCKET_EWOULDBLOCK


315 è|| 
timeout
 == 0)

316  
r
;

318 ià(
	`pvio_sock‘_wa™_io_Ü_timeout
(
pvio
, 
TRUE
, 
timeout
) < 1)

321  
r
;

322 
	}
}

345 
ssize_t
 
	$pvio_sock‘_async_»ad
(
MARIADB_PVIO
 *
pvio
, 
uch¬
 *
bufãr
, 
size_t
 
Ëngth
)

347 
ssize_t
 
r
= -1;

348 #iâdeà
_WIN32


349 
»ad_æags
ð
MSG_DONTWAIT
;

351 
¡_pvio_sock‘
 *
csock
ð
NULL
;

353 ià(!
pvio
 || !pvio->
d©a
)

356 
csock
ð(
¡_pvio_sock‘
 *)
pvio
->
d©a
;

358 #iâdeà
_WIN32


359 
r
ð
	`»cv
(
csock
->
sock‘
,(*)
bufãr
, 
Ëngth
, 
»ad_æags
);

363 
	`pvio_sock‘_blockšg
(
pvio
, 0, 0);

364 
r
ð
	`»cv
(
csock
->
sock‘
, (*)
bufãr
, ()
Ëngth
, 0);

366  
r
;

367 
	}
}

370 
ssize_t
 
	$ma_£nd
(
my_sock‘
 
sock‘
, cÚ¡ 
uch¬
 *
bufãr
, 
size_t
 
Ëngth
, 
æags
)

372 
ssize_t
 
r
;

373 #ià!
	`defšed
(
MSG_NOSIGNAL
è&& !defšed(
SO_NOSIGPIPE
è&& !defšed(
_WIN32
)

374 
sigaùiÚ
 
aù
, 
Þdaù
;

375 
aù
.
§_hªdËr
ð
SIG_IGN
;

376 
	`sigaùiÚ
(
SIGPIPE
, &
aù
, &
Þdaù
);

379 
r
 = 
	`£nd
(
sock‘
, (cÚ¡ *)
bufãr
, 
	`IF_WIN
(()
Ëngth
,Ëngth), 
æags
);

381 
r
 =ð-1 && 
	`IS_SOCKET_EINTR
(
sock‘_”ºo
));

382 #ià!
	`defšed
(
MSG_NOSIGNAL
è&& !defšed(
SO_NOSIGPIPE
è&& !defšed(
_WIN32
)

383 
	`sigaùiÚ
(
SIGPIPE
, &
Þdaù
, 
NULL
);

385  
r
;

386 
	}
}

388 
ssize_t
 
	$ma_»cv
(
my_sock‘
 
sock‘
, 
uch¬
 *
bufãr
, 
size_t
 
Ëngth
, 
æags
)

390 
ssize_t
 
r
;

392 
r
 = 
	`»cv
(
sock‘
, (*è
bufãr
, 
	`IF_WIN
(()
Ëngth
,†’gth), 
æags
);

394 
r
 =ð-1 && 
	`IS_SOCKET_EINTR
(
sock‘_”ºo
));

395  
r
;

396 
	}
}

418 
ssize_t
 
	$pvio_sock‘_async_wr™e
(
MARIADB_PVIO
 *
pvio
, cÚ¡ 
uch¬
 *
bufãr
, 
size_t
 
Ëngth
)

420 
ssize_t
 
r
= -1;

421 
¡_pvio_sock‘
 *
csock
ð
NULL
;

422 #iâdeà
_WIN32


423 
wr™e_æags
ð
MSG_DONTWAIT
;

424 #ifdeà
MSG_NOSIGNAL


425 
wr™e_æags
|ð
MSG_NOSIGNAL
;

429 ià(!
pvio
 || !pvio->
d©a
)

432 
csock
ð(
¡_pvio_sock‘
 *)
pvio
->
d©a
;

434 #iâdeà
WIN32


435 
r
ð
	`ma_£nd
(
csock
->
sock‘
, 
bufãr
, 
Ëngth
, 
wr™e_æags
);

439 
	`pvio_sock‘_blockšg
(
pvio
, 0, 0);

440 
r
ð
	`£nd
(
csock
->
sock‘
, (cÚ¡ *)
bufãr
, ()
Ëngth
, 0);

443  
r
;

444 
	}
}

467 
ssize_t
 
	$pvio_sock‘_wr™e
(
MARIADB_PVIO
 *
pvio
, cÚ¡ 
uch¬
 *
bufãr
, 
size_t
 
Ëngth
)

469 
ssize_t
 
r
;

470 
¡_pvio_sock‘
 *
csock
;

471 
timeout
;

472 
£nd_æags
ð
MSG_DONTWAIT
;

473 #ifdeà
MSG_NOSIGNAL


474 
£nd_æags
|ð
MSG_NOSIGNAL
;

476 ià(!
pvio
 || !pvio->
d©a
)

479 
csock
ð(
¡_pvio_sock‘
 *)
pvio
->
d©a
;

480 
timeout
 = 
pvio
->timeout[
PVIO_WRITE_TIMEOUT
];

482 (
r
 = 
	`ma_£nd
(
csock
->
sock‘
, (*)
bufãr
, 
Ëngth
,
£nd_æags
)) == -1)

484 
”r
 = 
sock‘_”ºo
;

485 ià((
”r
 !ð
SOCKET_EAGAIN


486 #ifdeà
HAVE_SOCKET_EWOULDBLOCK


487 && 
”r
 !ð
SOCKET_EWOULDBLOCK


489 )|| 
timeout
 == 0)

490  
r
;

491 ià(
	`pvio_sock‘_wa™_io_Ü_timeout
(
pvio
, 
FALSE
, 
timeout
) < 1)

494  
r
;

495 
	}
}

498 
	$pvio_sock‘_wa™_io_Ü_timeout
(
MARIADB_PVIO
 *
pvio
, 
my_boÞ
 
is_»ad
, 
timeout
)

500 
rc
;

501 
¡_pvio_sock‘
 *
csock
ð
NULL
;

503 #iâdeà
_WIN32


504 
pÞlfd
 
p_fd
;

506 
timev®
 
tv
= {0,0};

507 
fd_£t
 
fds
, 
exc_fds
;

510 ià(!
pvio
 || !pvio->
d©a
)

513 ià(
pvio
->
mysql
->
ÝtiÚs
.
ex‹nsiÚ
 &&

514 
pvio
->
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
io_wa™
 !ð
NULL
) {

515 
my_sock‘
 
hªdË
;

516 ià(
	`pvio_sock‘_g‘_hªdË
(
pvio
, &
hªdË
))

518  
pvio
->
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
	`io_wa™
(
hªdË
, 
is_»ad
, 
timeout
);

521 
csock
ð(
¡_pvio_sock‘
 *)
pvio
->
d©a
;

523 #iâdeà
_WIN32


524 
	`mem£t
(&
p_fd
, 0, (p_fd));

525 
p_fd
.
fd
ð
csock
->
sock‘
;

526 
p_fd
.
ev’ts
ð(
is_»ad
è? 
POLLIN
 : 
POLLOUT
;

528 ià(!
timeout
)

529 
timeout
= -1;

532 
rc
ð
	`pÞl
(&
p_fd
, 1, 
timeout
);

533 } 
rc
 =ð-1 && 
”ºo
 =ð
EINTR
);

535 ià(
rc
 == 0)

536 
”ºo
ð
ETIMEDOUT
;

538 
	`FD_ZERO
(&
fds
);

539 
	`FD_ZERO
(&
exc_fds
);

541 
	`FD_SET
(
csock
->
sock‘
, &
fds
);

542 
	`FD_SET
(
csock
->
sock‘
, &
exc_fds
);

544 ià(
timeout
 >= 0)

546 
tv
.
tv_£c
ð
timeout
 / 1000;

547 
tv
.
tv_u£c
ð(
timeout
 % 1000) * 1000;

550 
rc
ð
	`£Ëù
(0, (
is_»ad
è? &
fds
 : 
NULL
,

551 (
is_»ad
è? 
NULL
 : &
fds
,

552 &
exc_fds
,

553 (
timeout
 >ð0è? &
tv
 : 
NULL
);

555 ià(
rc
 =ð
SOCKET_ERROR
)

557 
”ºo
ð
	`WSAG‘La¡E¼Ü
();

559 ià(
rc
 == 0)

561 
rc
ð
SOCKET_ERROR
;

562 
	`WSAS‘La¡E¼Ü
(
WSAETIMEDOUT
);

563 
”ºo
ð
ETIMEDOUT
;

565 ià(
	`FD_ISSET
(
csock
->
sock‘
, &
exc_fds
))

567 
”r
;

568 
Ën
 = ();

569 ià(
	`g‘sockÝt
(
csock
->
sock‘
, 
SOL_SOCKET
, 
SO_ERROR
, (*)&
”r
, &
Ën
è!ð
SOCKET_ERROR
)

571 
	`WSAS‘La¡E¼Ü
(
”r
);

572 
”ºo
ð
”r
;

574 
rc
ð
SOCKET_ERROR
;

579  
rc
;

580 
	}
}

582 
	$pvio_sock‘_blockšg
(
MARIADB_PVIO
 *
pvio
, 
my_boÞ
 
block
, my_boÞ *
´evious_mode
)

584 
my_boÞ
 
is_blockšg
;

585 
¡_pvio_sock‘
 *
csock
;

586 
Ãw_fúŽ_mode
;

588 ià(!
pvio
 || !pvio->
d©a
)

591 
csock
 = (
¡_pvio_sock‘
 *)
pvio
->
d©a
;

593 
is_blockšg
 = !(
csock
->
fúŽ_mode
 & 
O_NONBLOCK
);

594 ià(
´evious_mode
)

595 *
´evious_mode
 = 
is_blockšg
;

597 ià(
is_blockšg
 =ð
block
)

600 ià(
block
)

601 
Ãw_fúŽ_mode
 = 
csock
->
fúŽ_mode
 & ~
O_NONBLOCK
;

603 
Ãw_fúŽ_mode
 = 
csock
->
fúŽ_mode
 | 
O_NONBLOCK
;

605 #ifdeà
_WIN32


607 
ulÚg
 
¬g
 = 
block
 ? 0 : 1;

608 ià(
	`ioùlsock‘
(
csock
->
sock‘
, 
FIONBIO
, (*)&
¬g
))

610 (
	`WSAG‘La¡E¼Ü
());

614 ià(
	`fúŽ
(
csock
->
sock‘
, 
F_SETFL
, 
Ãw_fúŽ_mode
) == -1)

616  
”ºo
;

619 
csock
->
fúŽ_mode
 = 
Ãw_fúŽ_mode
;

621 
	}
}

623 
	$pvio_sock‘_š‹º®_cÚÃù
(
MARIADB_PVIO
 *
pvio
,

624 cÚ¡ 
sockaddr
 *
Çme
,

625 
size_t
 
Çm–’
)

627 
rc
= 0;

628 
¡_pvio_sock‘
 *
csock
ð
NULL
;

629 
timeout
;

631 ià(!
pvio
 || !pvio->
d©a
)

634 
csock
ð(
¡_pvio_sock‘
 *)
pvio
->
d©a
;

635 
timeout
ð
pvio
->timeout[
PVIO_CONNECT_TIMEOUT
];

638 
	`pvio_sock‘_blockšg
(
pvio
, 0, 0);

640 #iâdeà
_WIN32


642 
rc
ð
	`cÚÃù
(
csock
->
sock‘
, (
sockaddr
*è
Çme
, ()
Çm–’
);

643 } 
rc
 =ð-1 && (
”ºo
 =ð
EINTR
 ||ƒ¼nØ=ð
EAGAIN
));

646 ià(
timeout
 !ð0 && 
rc
 =ð-1 && 
”ºo
 =ð
EINPROGRESS
)

648 
rc
ð
	`pvio_sock‘_wa™_io_Ü_timeout
(
pvio
, 
FALSE
, 
timeout
);

649 ià(
rc
 < 1)

652 
”rÜ
;

653 
sockËn_t
 
”rÜ_Ën
ð(
”rÜ
);

654 ià((
rc
 = 
	`g‘sockÝt
(
csock
->
sock‘
, 
SOL_SOCKET
, 
SO_ERROR
,

655 (*)&
”rÜ
, &
”rÜ_Ën
)) < 0)

656  
”ºo
;

657 ià(
”rÜ
)

658  
”rÜ
;

661 #ifdeà
__APPLE__


662 ià(
csock
->
sock‘
)

664 
v®
= 1;

665 
	`£tsockÝt
(
csock
->
sock‘
, 
SOL_SOCKET
, 
SO_NOSIGPIPE
, (*)&
v®
, ());

669 
rc
ð
	`cÚÃù
(
csock
->
sock‘
, (
sockaddr
*è
Çme
, ()
Çm–’
);

670 ià(
rc
 =ð
SOCKET_ERROR
)

672 ià(
	`WSAG‘La¡E¼Ü
(è=ð
WSAEWOULDBLOCK
)

674 ià(
	`pvio_sock‘_wa™_io_Ü_timeout
(
pvio
, 
FALSE
, 
timeout
) < 0)

676 
rc
= 0;

680  
rc
;

681 
	}
}

683 
	$pvio_sock‘_k“·live
(
MARIADB_PVIO
 *
pvio
)

685 
Ýt
= 1;

686 
¡_pvio_sock‘
 *
csock
ð
NULL
;

688 ià(!
pvio
 || !pvio->
d©a
)

691 
csock
ð(
¡_pvio_sock‘
 *)
pvio
->
d©a
;

693  
	`£tsockÝt
(
csock
->
sock‘
, 
SOL_SOCKET
, 
SO_KEEPALIVE
,

694 #iâdeà
_WIN32


695 (cÚ¡ *)&
Ýt
, (opt));

697 (*)&
Ýt
, ()(opt));

699 
	}
}

701 
	$pvio_sock‘_ç¡_£nd
(
MARIADB_PVIO
 *
pvio
)

703 
r
= 0;

704 
¡_pvio_sock‘
 *
csock
ð
NULL
;

706 ià(!
pvio
 || !pvio->
d©a
)

709 
csock
ð(
¡_pvio_sock‘
 *)
pvio
->
d©a
;

714 #ià!
	`defšed
(
_WIN32
è&& defšed(
IPTOS_THROUGHPUT
)

716 
tos
 = 
IPTOS_THROUGHPUT
;

717 
r
ð
	`£tsockÝt
(
csock
->
sock‘
, 
IPPROTO_IP
, 
IP_TOS
,

718 (cÚ¡ *)&
tos
, (tos));

721 ià(!
r
)

723 
Ýt
 = 1;

725 
r
ð
	`£tsockÝt
(
csock
->
sock‘
, 
IPPROTO_TCP
, 
TCP_NODELAY
,

726 #ifdeà
_WIN32


727 (cÚ¡ *)&
Ýt
, ()(opt));

729 (cÚ¡ *)&
Ýt
, (opt));

732  
r
;

733 
	}
}

736 
	$pvio_sock‘_cÚÃù_sync_Ü_async
(
MARIADB_PVIO
 *
pvio
,

737 cÚ¡ 
sockaddr
 *
Çme
, 
ušt
 
Çm–’
)

739 
MYSQL
 *
mysql
ð
pvio
->mysql;

740 ià(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
 && mysql->ÝtiÚs.ex‹nsiÚ->
async_cÚ‹xt
 &&

741 
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
async_cÚ‹xt
->
aùive
)

745 
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
async_cÚ‹xt
->
pvio
=…vio;

746 
	`pvio_sock‘_blockšg
(
pvio
, 0, 0);

747  
	`my_cÚÃù_async
(
pvio
, 
Çme
, 
Çm–’
,…vio->
timeout
[
PVIO_CONNECT_TIMEOUT
]);

750  
	`pvio_sock‘_š‹º®_cÚÃù
(
pvio
, 
Çme
, 
Çm–’
);

751 
	}
}

753 
my_boÞ
 
	$pvio_sock‘_cÚÃù
(
MARIADB_PVIO
 *
pvio
, 
MA_PVIO_CINFO
 *
cšfo
)

755 
¡_pvio_sock‘
 *
csock
ð
NULL
;

756 
MYSQL
 *
mysql
;

758 ià(!
pvio
 || !
cšfo
)

761 ià(!(
csock
ð(
¡_pvio_sock‘
 *)
	`ÿÎoc
(1, (st_pvio_socket))))

763 
	`PVIO_SET_ERROR
(
cšfo
->
mysql
, 
CR_OUT_OF_MEMORY
, 
unknown_sql¡©e
, 0, "");

766 
pvio
->
d©a
ð(*)
csock
;

767 
csock
->
sock‘
ð
INVALID_SOCKET
;

768 
mysql
ð
pvio
->mysqlð
cšfo
->mysql;

769 
pvio
->
ty³
ð
cšfo
->type;

771 ià(
cšfo
->
ty³
 =ð
PVIO_TYPE_UNIXSOCKET
)

773 #iâdeà
_WIN32


774 #ifdeà
HAVE_SYS_UN_H


775 
size_t
 
pÜt_Ëngth
;

776 
sockaddr_un
 
UNIXaddr
;

777 ià((
csock
->
sock‘
 = 
	`sock‘
(
AF_UNIX
,
SOCK_STREAM
,0)è=ð
INVALID_SOCKET
 ||

778 (
pÜt_Ëngth
=
	`¡¾’
(
cšfo
->
unix_sock‘
)è>ð((
UNIXaddr
.
sun_·th
)))

780 
	`PVIO_SET_ERROR
(
cšfo
->
mysql
, 
CR_SOCKET_CREATE_ERROR
, 
unknown_sql¡©e
, 0, 
”ºo
);

781 
”rÜ
;

783 
	`mem£t
((*è&
UNIXaddr
, 0, (UNIXaddr));

784 
UNIXaddr
.
sun_çmžy
 = 
AF_UNIX
;

785 #ià
	`defšed
(
__lšux__
)

787 ià(
cšfo
->
unix_sock‘
[0] == '@')

789 
	`¡ºýy
(
UNIXaddr
.
sun_·th
 + 1, 
cšfo
->
unix_sock‘
 + 1, 106);

790 
pÜt_Ëngth
+ð
	`off£tof
(
sockaddr_un
, 
sun_·th
);

795 
size_t
 
sun_·th_size
 = (
UNIXaddr
.
sun_·th
);

796 
	`¡ºýy
(
UNIXaddr
.
sun_·th
, 
cšfo
->
unix_sock‘
, 
sun_·th_size
 - 1);

797 ià(
sun_·th_size
 =ð
	`¡¾’
(
UNIXaddr
.
sun_·th
) + 1 && UNIXaddr.sun_path[sun_path_size - 1] != '\0')

800 
UNIXaddr
.
sun_·th
[
sun_·th_size
 - 1] = '\0';

802 
pÜt_Ëngth
ð(
UNIXaddr
);

804 ià(
	`pvio_sock‘_cÚÃù_sync_Ü_async
(
pvio
, (
sockaddr
 *è&
UNIXaddr
, 
pÜt_Ëngth
))

806 
	`PVIO_SET_ERROR
(
cšfo
->
mysql
, 
CR_CONNECTION_ERROR
, 
SQLSTATE_UNKNOWN
,

807 
	`ER
(
CR_CONNECTION_ERROR
), 
cšfo
->
unix_sock‘
, 
sock‘_”ºo
);

808 
”rÜ
;

810 ià(
	`pvio_sock‘_blockšg
(
pvio
, 1, 0è=ð
SOCKET_ERROR
)

812 
”rÜ
;

818 } ià(
cšfo
->
ty³
 =ð
PVIO_TYPE_SOCKET
)

820 
addršfo
 
hšts
, *
§ve_»s
ð0, *
bšd_»s
ð0, *
»s
ð0, *
b»s
= 0;

821 
£rv”_pÜt
[
NI_MAXSERV
];

822 
gai_rc
;

823 
rc
= 0;

824 
time_t
 
¡¬t_t
ð
	`time
(
NULL
);

825 #ifdeà
_WIN32


826 
DWORD
 
wa™_gai
;

828 
wa™_gai
;

831 
	`mem£t
(&
£rv”_pÜt
, 0, 
NI_MAXSERV
);

832 
	`¢´štf
(
£rv”_pÜt
, 
NI_MAXSERV
, "%d", 
cšfo
->
pÜt
);

835 
	`mem£t
(&
hšts
, 0, (hints));

836 
hšts
.
ai_´ÙocÞ
ð
IPPROTO_TCP
;

837 
hšts
.
ai_çmžy
ð
AF_UNSPEC
;

838 
hšts
.
ai_sockty³
ð
SOCK_STREAM
;

842 ià(
cšfo
->
mysql
->
ÝtiÚs
.
bšd_add»ss
)

844 
wa™_gai
= 1;

845 (
gai_rc
ð
	`g‘addršfo
(
cšfo
->
mysql
->
ÝtiÚs
.
bšd_add»ss
, 0,

846 &
hšts
, &
bšd_»s
)è=ð
EAI_AGAIN
)

848 
timeout
ð
mysql
->
ÝtiÚs
.
cÚÃù_timeout
 ?

849 
mysql
->
ÝtiÚs
.
cÚÃù_timeout
 : 
DNS_TIMEOUT
;

850 ià(
	`time
(
NULL
è- 
¡¬t_t
 > (
time_t
)
timeout
)

852 #iâdeà
_WIN32


853 
	`u¦“p
(
wa™_gai
);

855 
	`SË•
(
wa™_gai
);

857 
wa™_gai
*= 2;

859 ià(
gai_rc
 !ð0 || !
bšd_»s
)

861 
	`PVIO_SET_ERROR
(
cšfo
->
mysql
, 
CR_BIND_ADDR_FAILED
, 
SQLSTATE_UNKNOWN
,

862 
	`CER
(
CR_BIND_ADDR_FAILED
), 
cšfo
->
mysql
->
ÝtiÚs
.
bšd_add»ss
, 
gai_rc
);

863 
”rÜ
;

867 
wa™_gai
= 1;

868 (
gai_rc
ð
	`g‘addršfo
(
cšfo
->
ho¡
, 
£rv”_pÜt
,

869 &
hšts
, &
»s
)è=ð
EAI_AGAIN
)

871 
timeout
ð
mysql
->
ÝtiÚs
.
cÚÃù_timeout
 ?

872 
mysql
->
ÝtiÚs
.
cÚÃù_timeout
 : 
DNS_TIMEOUT
;

873 ià(
	`time
(
NULL
è- 
¡¬t_t
 > (
time_t
)
timeout
)

875 #iâdeà
_WIN32


876 
	`u¦“p
(
wa™_gai
);

878 
	`SË•
(
wa™_gai
);

880 
wa™_gai
*= 2;

882 ià(
gai_rc
 !ð0 || !
»s
)

884 
	`PVIO_SET_ERROR
(
cšfo
->
mysql
, 
CR_UNKNOWN_HOST
, 
SQLSTATE_UNKNOWN
,

885 
	`ER
(
CR_UNKNOWN_HOST
), 
cšfo
->
ho¡
, 
gai_rc
);

886 ià(
bšd_»s
)

887 
	`ä“addršfo
(
bšd_»s
);

888 
”rÜ
;

893 
§ve_»s
ð
»s
; save_»s; save_»sð§ve_»s->
ai_Ãxt
)

896 ià(
csock
->
sock‘
 !ð
INVALID_SOCKET
)

897 
	`þo£sock‘
(
csock
->
sock‘
);

898 
csock
->
sock‘
ð
	`sock‘
(
§ve_»s
->
ai_çmžy
, save_»s->
ai_sockty³
,

899 
§ve_»s
->
ai_´ÙocÞ
);

900 ià(
csock
->
sock‘
 =ð
INVALID_SOCKET
)

904 ià(
bšd_»s
)

906 
b»s
ð
bšd_»s
; b»s; b»sðb»s->
ai_Ãxt
)

908 ià(!(
rc
ð
	`bšd
(
csock
->
sock‘
, 
b»s
->
ai_addr
, ()b»s->
ai_add¾’
)))

911 ià(
rc
)

913 
	`þo£sock‘
(
csock
->
sock‘
);

914 
csock
->
sock‘
ð
INVALID_SOCKET
;

919 
rc
ð
	`pvio_sock‘_cÚÃù_sync_Ü_async
(
pvio
, 
§ve_»s
->
ai_addr
, (
ušt
)§ve_»s->
ai_add¾’
);

920 ià(!
rc
)

922 
MYSQL
 *
mysql
ð
pvio
->mysql;

923 ià(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
 && mysql->ÝtiÚs.ex‹nsiÚ->
async_cÚ‹xt
 &&

924 
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
async_cÚ‹xt
->
aùive
)

926 ià(
	`pvio_sock‘_blockšg
(
pvio
, 0, 0è=ð
SOCKET_ERROR
)

928 
	`þo£sock‘
(
csock
->
sock‘
);

929 
csock
->
sock‘
ð
INVALID_SOCKET
;

936 
	`ä“addršfo
(
»s
);

937 ià(
bšd_»s
)

938 
	`ä“addršfo
(
bšd_»s
);

940 ià(
csock
->
sock‘
 =ð
INVALID_SOCKET
)

942 
	`PVIO_SET_ERROR
(
cšfo
->
mysql
, 
CR_IPSOCK_ERROR
, 
SQLSTATE_UNKNOWN
, 
	`ER
(CR_IPSOCK_ERROR),

943 
sock‘_”ºo
);

944 
”rÜ
;

948 ià(
rc
)

950 
	`PVIO_SET_ERROR
(
cšfo
->
mysql
, 
CR_CONNECTION_ERROR
, 
SQLSTATE_UNKNOWN
,

951 
	`ER
(
CR_CONN_HOST_ERROR
), 
cšfo
->
ho¡
,

952 #ifdeà
_WIN32


953 
”ºo
);

955 
sock‘_”ºo
);

957 
”rÜ
;

959 ià(
	`pvio_sock‘_blockšg
(
pvio
, 1, 0è=ð
SOCKET_ERROR
)

960 
”rÜ
;

963 ià(
pvio
->
timeout
[
PVIO_CONNECT_TIMEOUT
] > 0)

965 ià(
	`pvio_sock‘_chªge_timeout
(
pvio
, 
PVIO_READ_TIMEOUT
,…vio->
timeout
[
PVIO_CONNECT_TIMEOUT
]) ||

966 
	`pvio_sock‘_chªge_timeout
(
pvio
, 
PVIO_WRITE_TIMEOUT
,…vio->
timeout
[
PVIO_CONNECT_TIMEOUT
]))

967 
”rÜ
;

971 ià(
pvio
->
timeout
[
PVIO_WRITE_TIMEOUT
] > 0)

972 ià(
	`pvio_sock‘_chªge_timeout
(
pvio
, 
PVIO_WRITE_TIMEOUT
,…vio->
timeout
[PVIO_WRITE_TIMEOUT]))

973 
”rÜ
;

974 ià(
pvio
->
timeout
[
PVIO_READ_TIMEOUT
] > 0)

975 ià(
	`pvio_sock‘_chªge_timeout
(
pvio
, 
PVIO_READ_TIMEOUT
,…vio->
timeout
[PVIO_READ_TIMEOUT]))

976 
”rÜ
;

979 
”rÜ
:

981 ià(
csock
->
sock‘
 !ð
INVALID_SOCKET
)

983 
	`þo£sock‘
(
csock
->
sock‘
);

984 
csock
->
sock‘
ð
INVALID_SOCKET
;

986 ià(
pvio
->
d©a
)

988 
	`ä“
((
g±r
)
pvio
->
d©a
);

989 
pvio
->
d©a
ð
NULL
;

992 
	}
}

995 
my_boÞ
 
	$pvio_sock‘_þo£
(
MARIADB_PVIO
 *
pvio
)

997 
¡_pvio_sock‘
 *
csock
ð
NULL
;

998 
r
= 0;

1000 ià(!
pvio
)

1003 ià(
pvio
->
d©a
)

1005 
csock
ð(
¡_pvio_sock‘
 *)
pvio
->
d©a
;

1006 ià(
csock
 && csock->
sock‘
 !ð
INVALID_SOCKET
)

1008 
r
ð
	`þo£sock‘
(
csock
->
sock‘
);

1009 
csock
->
sock‘
ð
INVALID_SOCKET
;

1011 
	`ä“
((
g±r
)
pvio
->
d©a
);

1012 
pvio
->
d©a
ð
NULL
;

1014  
r
;

1015 
	}
}

1019 
my_boÞ
 
	$pvio_sock‘_g‘_hªdË
(
MARIADB_PVIO
 *
pvio
, *
hªdË
)

1021 ià(
pvio
 &&…vio->
d©a
 && 
hªdË
)

1023 *(
my_sock‘
 *)
hªdË
ð((
¡_pvio_sock‘
 *)
pvio
->
d©a
)->
sock‘
;

1027 
	}
}

1031 
my_boÞ
 
	$pvio_sock‘_is_blockšg
(
MARIADB_PVIO
 *
pvio
)

1033 
¡_pvio_sock‘
 *
csock
ð
NULL
;

1034 
my_boÞ
 
r
;

1036 ià(!
pvio
 || !pvio->
d©a
)

1039 
csock
ð(
¡_pvio_sock‘
 *)
pvio
->
d©a
;

1040 
r
 = !(
csock
->
fúŽ_mode
 & 
O_NONBLOCK
);

1041  
r
;

1042 
	}
}

1046 
my_boÞ
 
	$pvio_sock‘_is_®ive
(
MARIADB_PVIO
 *
pvio
)

1048 
¡_pvio_sock‘
 *
csock
ð
NULL
;

1049 #iâdeà
_WIN32


1050 
pÞlfd
 
pÞl_fd
;

1052 
FD_SET
 
sfds
;

1053 
timev®
 
tv
= {0,0};

1055 
»s
;

1057 ià(!
pvio
 || !pvio->
d©a
)

1060 
csock
ð(
¡_pvio_sock‘
 *)
pvio
->
d©a
;

1061 #iâdeà
_WIN32


1062 
	`mem£t
(&
pÞl_fd
, 0, (
pÞlfd
));

1063 
pÞl_fd
.
ev’ts
ð
POLLPRI
 | 
POLLIN
;

1064 
pÞl_fd
.
fd
ð
csock
->
sock‘
;

1066 
»s
ð
	`pÞl
(&
pÞl_fd
, 1, 0);

1067 ià(
»s
 <= 0)

1068  
FALSE
;

1069 ià(!(
pÞl_fd
.
»v’ts
 & (
POLLIN
 | 
POLLPRI
)))

1070  
FALSE
;

1071  
TRUE
;

1079 
	`FD_ZERO
(&
sfds
);

1080 
	`FD_SET
(
csock
->
sock‘
, &
sfds
);

1082 
»s
ð
	`£Ëù
(()
csock
->
sock‘
 + 1, &
sfds
, 
NULL
, NULL, &
tv
);

1083 ià(
»s
 > 0 && 
	`FD_ISSET
(
csock
->
sock‘
, &
sfds
))

1084  
TRUE
;

1085  
FALSE
;

1087 
	}
}

1091 
my_boÞ
 
	$pvio_sock‘_has_d©a
(
MARIADB_PVIO
 *
pvio
, 
ssize_t
 *
d©a_Ën
)

1093 
¡_pvio_sock‘
 *
csock
ð
NULL
;

1094 
tmp_buf
;

1095 
ssize_t
 
Ën
;

1096 
my_boÞ
 
mode
;

1098 ià(!
pvio
 || !pvio->
d©a
)

1101 
csock
ð(
¡_pvio_sock‘
 *)
pvio
->
d©a
;

1105 
	`pvio_sock‘_blockšg
(
pvio
, 0, &
mode
);

1106 
Ën
ð
	`»cv
(
csock
->
sock‘
, &
tmp_buf
, Ñmp_buf), 
MSG_PEEK
);

1107 
	`pvio_sock‘_blockšg
(
pvio
, 
mode
, 0);

1108 ià(
Ën
 < 0)

1110 *
d©a_Ën
ð
Ën
;

1112 
	}
}

1115 
	$pvio_sock‘_shutdown
(
MARIADB_PVIO
 *
pvio
)

1117 ià(
pvio
 &&…vio->
d©a
)

1119 
my_sock‘
 
s
 = ((
¡_pvio_sock‘
 *)
pvio
->
d©a
)->
sock‘
;

1120 #ifdeà
_WIN32


1121 
	`shutdown
(
s
, 
SD_BOTH
);

1122 
	`CªûlIoEx
((
HANDLE
)
s
, 
NULL
);

1124 
	`shutdown
(
s
, 
SHUT_RDWR
);

1128 
	}
}

	@plugins/trace/trace_example.c

19 #iâdeà
_WIN32


20 
	#_GNU_SOURCE
 1

	)

23 
	~<ma_glob®.h
>

24 
	~<mysql.h
>

25 
	~<mysql/þ›Á_¶ugš.h
>

26 
	~<¡ršg.h
>

27 
	~<memÜy.h
>

29 #iâdeà
WIN32


30 
	~<dlfú.h
>

33 
	#READ
 0

	)

34 
	#WRITE
 1

	)

37 
Œaû_š™
(*
”rÜmsg
,

38 
size_t
 
”rÜmsg_size
,

39 
unu£d
 
__©Œibu‹__
((unused)),

40 
va_li¡
 
unu£d1
 
__©Œibu‹__
((
unu£d
)));

41 
Œaû_deš™
();

43 (*
»gi¡”_ÿÎback
)(
my_boÞ
„egister_callback,

44 (*
ÿÎback_funùiÚ
)(
mode
, 
MYSQL
 *
mysql
, cÚ¡ 
uch¬
 *
bufãr
, 
size_t
 
Ëngth
));

45 
	`Œaû_ÿÎback
(
mode
, 
MYSQL
 *
mysql
, cÚ¡ 
uch¬
 *
bufãr
, 
size_t
 
Ëngth
);

47 #iâdeà
HAVE_TRACE_EXAMPLE_PLUGIN_DYNAMIC


48 
¡_mysql_þ›Á_¶ugš
 
Œaû_exam¶e_¶ugš
=

50 
¡_mysql_þ›Á_¶ugš
 
_mysql_þ›Á_¶ugš_deþ¬©iÚ_
 =

53 
MARIADB_CLIENT_TRACE_PLUGIN
,

54 
MARIADB_CLIENT_TRACE_PLUGIN_INTERFACE_VERSION
,

60 
NULL
,

61 &
Œaû_š™
,

62 &
Œaû_deš™
,

63 
NULL


64 
	}
};

66 cÚ¡ *
	gcommªds
[]= {

101 
	mth»ad_id
;

102 
	mÏ¡_commªd
;

103 
	mmax_·ck‘_size
;

104 
	mnum_commªds
;

105 
size_t
 
	mtÙ®_size
[2];

106 
	mþ›Á_æags
;

107 *
	mu£ºame
;

108 *
	mdb
;

109 *
	mcommªd
;

110 *
	mfž’ame
;

111 
	m»fid
;

112 
uch¬
 
	mch¬£t
;

113 *
	mÃxt
;

114 
	mloÿl_šfže
;

115 
	mpkt_Ëngth
;

116 } 
	tTRACE_INFO
;

118 
	#TRACE_STATUS
(
a
è((!aè? "ok" : "”rÜ")

	)

120 
TRACE_INFO
 *
	gŒaû_šfo
ð
NULL
;

122 
TRACE_INFO
 *
	$g‘_Œaû_šfo
(
th»ad_id
)

124 
TRACE_INFO
 *
šfo
ð
Œaû_šfo
;

127 
šfo
)

129 ià(
šfo
->
th»ad_id
 ==hread_id)

130  
šfo
;

132 
šfo
ð(
TRACE_INFO
 *)šfo->
Ãxt
;

135 ià(!(
šfo
ð(
TRACE_INFO
 *)
	`ÿÎoc
((TRACE_INFO), 1)))

136  
NULL
;

137 
šfo
->
th»ad_id
=hread_id;

138 
šfo
->
Ãxt
ð
Œaû_šfo
;

139 
Œaû_šfo
ð
šfo
;

140  
šfo
;

141 
	}
}

143 
	$d–‘e_Œaû_šfo
(
th»ad_id
)

145 
TRACE_INFO
 *
Ï¡
ð
NULL
, *
cu¼’t
;

146 
cu¼’t
ð
Œaû_šfo
;

148 
cu¼’t
)

150 ià(
cu¼’t
->
th»ad_id
 ==hread_id)

152 
	`´štf
("d–‘šgh»ad %lu\n", 
th»ad_id
);

154 ià(
Ï¡
)

155 
Ï¡
->
Ãxt
ð
cu¼’t
->next;

157 
Œaû_šfo
ð(
TRACE_INFO
 *)
cu¼’t
->
Ãxt
;

158 ià(
cu¼’t
->
commªd
)

159 
	`ä“
(
cu¼’t
->
commªd
);

160 ià(
cu¼’t
->
db
)

161 
	`ä“
(
cu¼’t
->
db
);

162 ià(
cu¼’t
->
u£ºame
)

163 
	`ä“
(
cu¼’t
->
u£ºame
);

164 ià(
cu¼’t
->
fž’ame
)

165 
	`ä“
(
cu¼’t
->
fž’ame
);

166 
	`ä“
(
cu¼’t
);

168 
Ï¡
ð
cu¼’t
;

169 
cu¼’t
ð(
TRACE_INFO
 *)cu¼’t->
Ãxt
;

172 
	}
}

192 
Œaû_š™
(*
”rÜmsg
,

193 
size_t
 
”rÜmsg_size
,

194 
unu£d1
 
__©Œibu‹__
((
unu£d
)),

195 
va_li¡
 
unu£d2
 
__©Œibu‹__
((
unu£d
)))

197 *
	gfunc
;

199 #ifdeà
WIN32


200 ià(!(
	gfunc
ð
G‘ProcAdd»ss
(
G‘ModuËHªdË
(
NULL
), "ma_pvio_register_callback")))

202 ià(!(
	gfunc
ð
dlsym
(
RTLD_DEFAULT
, "ma_pvio_register_callback")))

205 
¡ºýy
(
”rÜmsg
, "Cª'ˆfšd ma_pvio_»gi¡”_ÿÎback funùiÚ", 
”rÜmsg_size
);

208 
	g»gi¡”_ÿÎback
ð
func
;

209 
»gi¡”_ÿÎback
(
TRUE
, 
Œaû_ÿÎback
);

215 
	$Œaû_deš™
()

218 
Œaû_šfo
)

220 
	`´štf
("W¬nšg: CÚÃùiÚ fÜh»ad %lu‚Ù…rÝ”ly clo£d\n", 
Œaû_šfo
->
th»ad_id
);

221 
Œaû_šfo
ð(
TRACE_INFO
 *é¿û_šfo->
Ãxt
;

223 
	`»gi¡”_ÿÎback
(
FALSE
, 
Œaû_ÿÎback
);

225 
	}
}

227 
	$Œaû_£t_commªd
(
TRACE_INFO
 *
šfo
, *
bufãr
, 
size_t
 
size
)

229 ià(
šfo
->
commªd
)

230 
	`ä“
(
šfo
->
commªd
);

232 
šfo
->
commªd
ð
	`ÿÎoc
(1, 
size
 + 1);

233 
	`memýy
(
šfo
->
commªd
, 
bufãr
, 
size
);

234 
	}
}

236 
	$dump_bufãr
(
uch¬
 *
bufãr
, 
size_t
 
Ën
)

238 
uch¬
 *
p
ð
bufãr
;

239 
p
 < 
bufãr
 + 
Ën
)

241 
	`´štf
("%02x ", *
p
);

242 
p
++;

244 
	`´štf
("\n");

245 
	}
}

247 
	$dump_sim¶e
(
TRACE_INFO
 *
šfo
, 
my_boÞ
 
is_”rÜ
)

249 
	`´štf
("%8lu: % %s\n", 
šfo
->
th»ad_id
, 
commªds
[šfo->
Ï¡_commªd
], 
	`TRACE_STATUS
(
is_”rÜ
));

250 
	}
}

252 
	$dump_»ã»nû
(
TRACE_INFO
 *
šfo
, 
my_boÞ
 
is_”rÜ
)

254 
	`´štf
("%8lu: %s(%luè%s\n", 
šfo
->
th»ad_id
, 
commªds
[šfo->
Ï¡_commªd
], ()šfo->
»fid
, 
	`TRACE_STATUS
(
is_”rÜ
));

255 
	}
}

257 
	$dump_commªd
(
TRACE_INFO
 *
šfo
, 
my_boÞ
 
is_”rÜ
)

259 
size_t
 
i
;

260 
	`´štf
("%8lu: %s(", 
šfo
->
th»ad_id
, 
commªds
[šfo->
Ï¡_commªd
]);

261 
i
ð0; 
šfo
->
commªd
 && i < 
	`¡¾’
(info->command); i++)

262 ià(
šfo
->
commªd
[
i
] == '\n')

263 
	`´štf
("\\n");

264 ià(
šfo
->
commªd
[
i
] == '\r')

265 
	`´štf
("\\r");

266 ià(
šfo
->
commªd
[
i
] == '\t')

267 
	`´štf
("\\t");

269 
	`´štf
("%c", 
šfo
->
commªd
[
i
]);

270 
	`´štf
("è%s\n", 
	`TRACE_STATUS
(
is_”rÜ
));

271 
	}
}

273 
	$Œaû_ÿÎback
(
mode
, 
MYSQL
 *
mysql
, cÚ¡ 
uch¬
 *
bufãr
, 
size_t
 
Ëngth
)

275 
th»ad_id
ð
mysql
->thread_id;

276 
TRACE_INFO
 *
šfo
;

280 ià(!
th»ad_id
 && 
mode
 =ð
READ
)

282 *
p
ð(*)
bufãr
;

283 
p
+= 4;

284 ià((
uch¬
)*
p
 != 0xFF)

286 
p
+ð
	`¡¾’
(p + 1) + 2;

287 
th»ad_id
ð
	`ušt4kÜr
(
p
);

289 
šfo
ð
	`g‘_Œaû_šfo
(
th»ad_id
);

290 
šfo
->
Ï¡_commªd
= -1;

294 *
p
ð(*)
bufãr
;

295 
šfo
ð
	`g‘_Œaû_šfo
(
th»ad_id
);

297 ià(
šfo
->
Ï¡_commªd
 == -1)

299 ià(
mode
 =ð
WRITE
)

316 
p
+= 4;

317 
šfo
->
þ›Á_æags
ð
	`ušt4kÜr
(
p
);

318 
p
+= 4;

319 
šfo
->
max_·ck‘_size
ð
	`ušt4kÜr
(
p
);

320 
p
+= 4;

321 
šfo
->
ch¬£t
ð*
p
;

322 
p
+= 24;

323 
šfo
->
u£ºame
ð
	`¡rdup
(
p
);

324 
p
+ð
	`¡¾’
(p) + 1;

325 ià(*
p
)

326 
p
+= *p;

327 
p
++;

328 ià(
šfo
->
þ›Á_æags
 & 
CLIENT_CONNECT_WITH_DB
)

329 
šfo
->
db
ð
	`¡rdup
(
p
);

333 
p
++;

334 ià((
uch¬
)*
p
 == 0xFF)

335 
	`´štf
("%8lu: CONNECT_ERROR(%d)\n", 
šfo
->
th»ad_id
, 
	`ušt4kÜr
(
p
+1));

337 
	`´štf
("%8lu: CONNECT_SUCCESS(ho¡=%s,u£r=%s,db=%s)\n", 
šfo
->
th»ad_id
,

338 
mysql
->
ho¡
, 
šfo
->
u£ºame
, info->
db
 ? info->db : "'none'");

339 
šfo
->
Ï¡_commªd
ð
COM_SLEEP
;

343 *
p
ð(*)
bufãr
;

344 
Ën
;

346 ià(
mode
 =ð
WRITE
)

348 ià(
šfo
->
pkt_Ëngth
 > 0)

350 
šfo
->
pkt_Ëngth
-ð
Ëngth
;

353 
Ën
ð
	`ušt3kÜr
(
p
);

354 
šfo
->
pkt_Ëngth
ð
Ën
 + 4 - 
Ëngth
;

355 
p
+= 4;

356 
šfo
->
Ï¡_commªd
ð*
p
;

357 
p
++;

359 
šfo
->
Ï¡_commªd
) {

360 
COM_INIT_DB
:

361 
COM_DROP_DB
:

362 
COM_CREATE_DB
:

363 
COM_DEBUG
:

364 
COM_QUERY
:

365 
COM_STMT_PREPARE
:

366 
	`Œaû_£t_commªd
(
šfo
, 
p
, 
Ën
 - 1);

368 
COM_PROCESS_KILL
:

369 
šfo
->
»fid
ð
	`ušt4kÜr
(
p
);

371 
COM_QUIT
:

372 
	`´štf
("%8lu: COM_QUIT\n", 
šfo
->
th»ad_id
);

373 
	`d–‘e_Œaû_šfo
(
šfo
->
th»ad_id
);

375 
COM_PING
:

376 
	`´štf
("%8lu: COM_PING\n", 
šfo
->
th»ad_id
);

378 
COM_STMT_EXECUTE
:

379 
COM_STMT_RESET
:

380 
COM_STMT_CLOSE
:

381 
šfo
->
»fid
ð
	`ušt4kÜr
(
p
);

383 
COM_CHANGE_USER
:

386 ià(
šfo
->
loÿl_šfže
 == 1)

388 
	`´štf
("%8lu: SEND_LOCAL_INFILE(%sè", 
šfo
->
th»ad_id
, info->
fž’ame
);

389 ià(
Ën
)

390 
	`´štf
("£Á %d by‹s\n", 
Ën
);

392 
	`´štf
("-ƒrror\n");

393 
šfo
->
loÿl_šfže
= 2;

396 
	`´štf
("%8lu: UNKNOWN_COMMAND: %d\n", 
šfo
->
th»ad_id
, info->
Ï¡_commªd
);

402 
my_boÞ
 
is_”rÜ
;

404 
Ën
ð
	`ušt3kÜr
(
p
);

405 
p
+= 4;

407 
is_”rÜ
ð(
Ën
 == -1);

409 
šfo
->
Ï¡_commªd
) {

410 
COM_STMT_EXECUTE
:

411 
COM_STMT_RESET
:

412 
COM_STMT_CLOSE
:

413 
COM_PROCESS_KILL
:

414 
	`dump_»ã»nû
(
šfo
, 
is_”rÜ
);

415 
šfo
->
»fid
= 0;

416 
šfo
->
Ï¡_commªd
= 0;

418 
COM_QUIT
:

419 
	`dump_sim¶e
(
šfo
, 
is_”rÜ
);

421 
COM_QUERY
:

422 
COM_INIT_DB
:

423 
COM_DROP_DB
:

424 
COM_CREATE_DB
:

425 
COM_DEBUG
:

426 
COM_CHANGE_USER
:

427 ià(
šfo
->
Ï¡_commªd
 =ð
COM_QUERY
 && (
uch¬
)*
p
 == 251)

429 
šfo
->
loÿl_šfže
= 1;

430 
p
++;

431 
šfo
->
fž’ame
ð(*)
	`m®loc
(
Ën
);

432 
	`¡ºýy
(
šfo
->
fž’ame
, (*)
p
, 
Ën
);

433 
	`dump_commªd
(
šfo
, 
is_”rÜ
);

436 
	`dump_commªd
(
šfo
, 
is_”rÜ
);

437 ià(
šfo
->
loÿl_šfže
 != 1)

439 
	`ä“
(
šfo
->
commªd
);

440 
šfo
->
commªd
ð
NULL
;

443 
COM_STMT_PREPARE
:

444 
	`´štf
("%8lu: COM_STMT_PREPARE(%sè", 
šfo
->
th»ad_id
, info->
commªd
);

445 ià(!*
p
)

447 
¡mt_id
ð
	`ušt4kÜr
(
p
+1);

448 
	`´štf
("-> stmt_id(%lu)\n", 
¡mt_id
);

451 
	`´štf
("error\n");

457 
šfo
->
tÙ®_size
[
mode
]+ð
Ëngth
;

458 
	}
}

	@unittest/libmariadb/async.c

17 
	~"my_‹¡.h
"

18 
	~"ma_commÚ.h
"

21 #iâdeà
_WIN32


22 
	~<pÞl.h
>

24 
	~<wšsock2.h
>

27 
	~<¡dlib.h
>

28 
	~<¡dio.h
>

29 
	~<mysql.h
>

31 
my_boÞ
 
	gsk_async
= 0;

33 
	$‹¡_async
(
MYSQL
 *
mysql
)

35 
ty³
;

36 
	`m¬Ÿdb_g‘_šfo
(
mysql
, 
MARIADB_CONNECTION_PVIO_TYPE
, &
ty³
);

37 ià(
ty³
 > 
MARIADB_CONNECTION_TCP
)

39 
sk_async
= 1;

40 
	`dŸg
("Asnyc IO‚ot supported");

42  
OK
;

43 
	}
}

46 
	$wa™_fÜ_mysql
(
MYSQL
 *
mysql
, 
¡©us
)

48 #ifdeà
_WIN32


49 
fd_£t
 
rs
, 
ws
, 
es
;

50 
»s
;

51 
timev®
 
tv
, *
timeout
;

52 
my_sock‘
 
s
ð
	`mysql_g‘_sock‘
(
mysql
);

53 
	`FD_ZERO
(&
rs
);

54 
	`FD_ZERO
(&
ws
);

55 
	`FD_ZERO
(&
es
);

56 ià(
¡©us
 & 
MYSQL_WAIT_READ
)

57 
	`FD_SET
(
s
, &
rs
);

58 ià(
¡©us
 & 
MYSQL_WAIT_WRITE
)

59 
	`FD_SET
(
s
, &
ws
);

60 ià(
¡©us
 & 
MYSQL_WAIT_EXCEPT
)

61 
	`FD_SET
(
s
, &
es
);

62 ià(
¡©us
 & 
MYSQL_WAIT_TIMEOUT
)

64 
tv
.
tv_£c
ð
	`mysql_g‘_timeout_v®ue
(
mysql
);

65 
tv
.
tv_u£c
= 0;

66 
timeout
ð&
tv
;

69 
timeout
ð
NULL
;

70 
»s
ð
	`£Ëù
(1, &
rs
, &
ws
, &
es
, 
timeout
);

71 ià(
»s
 == 0)

72  
MYSQL_WAIT_TIMEOUT
;

73 ià(
»s
 =ð
SOCKET_ERROR
)

78  
MYSQL_WAIT_TIMEOUT
;

82 
¡©us
= 0;

83 ià(
	`FD_ISSET
(
s
, &
rs
))

84 
¡©us
|ð
MYSQL_WAIT_READ
;

85 ià(
	`FD_ISSET
(
s
, &
ws
))

86 
¡©us
|ð
MYSQL_WAIT_WRITE
;

87 ià(
	`FD_ISSET
(
s
, &
es
))

88 
¡©us
|ð
MYSQL_WAIT_EXCEPT
;

89  
¡©us
;

92 
pÞlfd
 
pfd
;

93 
timeout
;

94 
»s
= -1;

96 
pfd
.
fd
ð
	`mysql_g‘_sock‘
(
mysql
);

97 
pfd
.
ev’ts
=

98 (
¡©us
 & 
MYSQL_WAIT_READ
 ? 
POLLIN
 : 0) |

99 (
¡©us
 & 
MYSQL_WAIT_WRITE
 ? 
POLLOUT
 : 0) |

100 (
¡©us
 & 
MYSQL_WAIT_EXCEPT
 ? 
POLLPRI
 : 0);

101 ià(
¡©us
 & 
MYSQL_WAIT_TIMEOUT
)

103 
timeout
ð
	`mysql_g‘_timeout_v®ue_ms
(
mysql
);

106 
timeout
= -1;

108 
»s
ð
	`pÞl
(&
pfd
, 1, 
timeout
);

109 } 
»s
 =ð-1 && 
”ºo
 =ð
EINTR
);

110 ià(
»s
 == 0)

111  
MYSQL_WAIT_TIMEOUT
;

112 ià(
»s
 < 0)

117  
MYSQL_WAIT_TIMEOUT
;

121 
¡©us
= 0;

122 ià(
pfd
.
»v’ts
 & 
POLLIN
)

123 
¡©us
|ð
MYSQL_WAIT_READ
;

124 ià(
pfd
.
»v’ts
 & 
POLLOUT
)

125 
¡©us
|ð
MYSQL_WAIT_WRITE
;

126 ià(
pfd
.
»v’ts
 & 
POLLPRI
)

127 
¡©us
|ð
MYSQL_WAIT_EXCEPT
;

128  
¡©us
;

131 
	}
}

133 
async1
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

135 
	g”r
ð0, 
	grc
;

136 
MYSQL
 
	gmysql
, *
	g»t
;

137 
MYSQL_RES
 *
	g»s
;

138 
MYSQL_ROW
 
	grow
;

139 
	g¡©us
;

140 
ušt
 
	gdeçuÉ_timeout
;

141 
	gi
;

143 ià(
	gsk_async
)

144  
	gSKIP
;

146 
	gi
=0; i < 100; i++)

149 
mysql_š™
(&
mysql
);

150 
	grc
ð
mysql_ÝtiÚs
(&
mysql
, 
MYSQL_OPT_NONBLOCK
, 0);

151 
check_mysql_rc
(
rc
, (
MYSQL
 *)&
mysql
);

154 
	gdeçuÉ_timeout
= 3;

155 
mysql_ÝtiÚs
(&
mysql
, 
MYSQL_OPT_READ_TIMEOUT
, &
deçuÉ_timeout
);

156 
mysql_ÝtiÚs
(&
mysql
, 
MYSQL_OPT_CONNECT_TIMEOUT
, &
deçuÉ_timeout
);

157 
mysql_ÝtiÚs
(&
mysql
, 
MYSQL_OPT_WRITE_TIMEOUT
, &
deçuÉ_timeout
);

158 
mysql_ÝtiÚs
(&
mysql
, 
MYSQL_READ_DEFAULT_GROUP
, "myapp");

159 ià(
	gfÜû_Žs
)

160 
mysql_s¦_£t
(&
mysql
, 
NULL
, NULL, NULL, NULL,NULL);

163 
	g¡©us
ð
mysql_»®_cÚÃù_¡¬t
(&
»t
, &
mysql
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
, 
schema
, 
pÜt
, 
sock‘Çme
, 0);

164 
	g¡©us
)

166 
	g¡©us
ð
wa™_fÜ_mysql
(&
mysql
, 
¡©us
);

167 
	g¡©us
ð
mysql_»®_cÚÃù_cÚt
(&
»t
, &
mysql
, 
¡©us
);

169 ià(!
	g»t
)

171 
dŸg
("E¼Ü: %s", 
mysql_”rÜ
(&
mysql
));

172 
FAIL_IF
(!
»t
, "Failedo mysql_real_connect()");

175 ià(
	gfÜû_Žs
 && !
mysql_g‘_s¦_ch”
(&
mysql
))

177 
dŸg
("Error: Nols connection");

178  
	gFAIL
;

181 
	g¡©us
ð
mysql_»®_qu”y_¡¬t
(&
”r
, &
mysql
, 
SL
("SHOW STATUS"));

182 
	g¡©us
)

184 
	g¡©us
ð
wa™_fÜ_mysql
(&
mysql
, 
¡©us
);

185 
	g¡©us
ð
mysql_»®_qu”y_cÚt
(&
”r
, &
mysql
, 
¡©us
);

187 
FAIL_IF
(
”r
, "mysql_real_query()„eturnsƒrror");

190 
	g»s
ð
mysql_u£_»suÉ
(&
mysql
);

191 
FAIL_IF
(!
»s
, "mysql_use_result()„eturnsƒrror");

195 
	g¡©us
ð
mysql_ãtch_row_¡¬t
(&
row
, 
»s
);

196 
	g¡©us
)

198 
	g¡©us
ð
wa™_fÜ_mysql
(&
mysql
, 
¡©us
);

199 
	g¡©us
ð
mysql_ãtch_row_cÚt
(&
row
, 
»s
, 
¡©us
);

201 ià(!
	grow
)

204 
FAIL_IF
(
mysql_”ºo
(&
mysql
), "Gotƒrror while„etrieving„ows");

205 
mysql_ä“_»suÉ
(
»s
);

213 
	g¡©us
ð
mysql_þo£_¡¬t
(&
mysql
);

214 
	g¡©us
)

216 
	g¡©us
ð
wa™_fÜ_mysql
(&
mysql
, 
¡©us
);

217 
	g¡©us
ð
mysql_þo£_cÚt
(&
mysql
, 
¡©us
);

220  
	gOK
;

223 
‹¡_cÚc131
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

225 
	grc
;

227 
MYSQL
 *
	gmysql
;

229 ià(
	gsk_async
)

230  
	gSKIP
;

232 
	gmysql
ð
mysql_š™
(
NULL
);

233 
	grc
ð
mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_NONBLOCK
, 0);

234 
check_mysql_rc
(
rc
, 
mysql
);

235 
mysql_þo£
(
mysql
);

236  
	gOK
;

239 
‹¡_cÚc129
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

241 
MYSQL
 *
	gmysql
;

243 ià(
	gsk_async
)

244  
	gSKIP
;

246 
	gmysql
ð
mysql_š™
(
NULL
);

247 
FAIL_IF
(
mysql_þo£_¡¬t
(
mysql
), "Noƒrrorƒxpected");

248  
	gOK
;

252 
my_‹¡s_¡
 
	gmy_‹¡s
[] = {

253 {"‹¡_async", 
‹¡_async
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

254 {"async1", 
async1
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

255 {"‹¡_cÚc131", 
‹¡_cÚc131
, 
TEST_CONNECTION_NONE
, 0, 
NULL
, NULL},

256 {"‹¡_cÚc129", 
‹¡_cÚc129
, 
TEST_CONNECTION_NONE
, 0, 
NULL
, NULL},

257 {
NULL
, NULL, 0, 0, NULL, NULL}

261 
	$maš
(
¬gc
, **
¬gv
)

263 ià(
¬gc
 > 1)

264 
	`g‘_ÝtiÚs
(
¬gc
, 
¬gv
);

266 
	`g‘_’vv¬s
();

268 
	`run_‹¡s
(
my_‹¡s
);

270 (
	`ex™_¡©us
());

271 
	}
}

	@unittest/libmariadb/basic-t.c

30 
	~"my_‹¡.h
"

31 
	~"ma_commÚ.h
"

33 
	$‹¡_cÚc75
(
MYSQL
 *
my
)

35 
rc
;

36 
MYSQL
 *
mysql
;

37 
i
;

38 
my_boÞ
 
»cÚÃù
= 1;

40 
SKIP_SKYSQL
;

41 
SKIP_MAXSCALE
;

43 
mysql
ð
	`mysql_š™
(
NULL
);

45 
	`mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_RECONNECT
, &
»cÚÃù
);

46 
	`my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
, 
schema
, 
pÜt
, 
sock‘Çme
, 0| 
CLIENT_MULTI_RESULTS
 | 
CLIENT_REMEMBER_OPTIONS
);

48 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS‡");

49 
	`check_mysql_rc
(
rc
, 
mysql
);

51 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE‡ (a varchar(200))");

52 
	`check_mysql_rc
(
rc
, 
mysql
);

54 
rc
ð
	`mysql_£t_ch¬aù”_£t
(
mysql
, "utf8");

55 
	`check_mysql_rc
(
rc
, 
mysql
);

57 
i
=0; i < 10; i++)

59 
ulÚg
 
th»ad_id
ð
	`mysql_th»ad_id
(
mysql
);

61 
	`mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_RECONNECT
, &
»cÚÃù
);

62 
	`dŸg
("killing connection");

63 
	`mysql_kžl
(
my
, 
th»ad_id
);

64 
	`mysql_pšg
(
mysql
);

65 
rc
ð
	`mysql_qu”y
(
mysql
, "load data†ocal infile './nonexistingfile.csv' intoable‡ (`a`)");

66 
	`FAIL_IF
(!
	`‹¡
(
mysql
->
ÝtiÚs
.
þ›Á_æag
 | 
CLIENT_LOCAL_FILES
), "client_flags‚ot correct");

67 
	`dŸg
("th»ad1: %ld %ld", 
th»ad_id
, 
	`mysql_th»ad_id
(
mysql
));

68 
	`FAIL_IF
(
th»ad_id
 =ð
	`mysql_th»ad_id
(
mysql
), "newhread idƒxpected");

72 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS‡");

73 
	`check_mysql_rc
(
rc
, 
mysql
);

74 
	`mysql_þo£
(
mysql
);

75  
OK
;

76 
	}
}

79 
‹¡_cÚc74
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

81 
	grc
;

82 
MYSQL
 *
	gmysql
;

84 
	gmysql
ð
mysql_š™
(
NULL
);

87 ià(!
my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
, 
schema
, 
pÜt
, 
sock‘Çme
, 0| 
CLIENT_MULTI_RESULTS
 | 
CLIENT_REMEMBER_OPTIONS
))

89 
dŸg
("E¼Ü: %s", 
mysql_”rÜ
(
mysql
));

90 
mysql_þo£
(
mysql
);

91  
	gFAIL
;

94 
	grc
ð
mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS‡");

95 
check_mysql_rc
(
rc
, 
mysql
);

97 
	grc
ð
mysql_qu”y
(
mysql
, "CREATE TABLE‡ (a varchar(200))");

98 
check_mysql_rc
(
rc
, 
mysql
);

100 
	gmysql
->
	gÝtiÚs
.
	gþ›Á_æag
&ð~
CLIENT_LOCAL_FILES
;

102 
	grc
ð
mysql_qu”y
(
mysql
, "load data†ocal infile './nonexistingfile.csv' intoable‡ (`a`)");

103 
FAIL_IF
(!
rc
, "Errorƒxpected");

105 
	grc
ð
mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS‡");

106 
check_mysql_rc
(
rc
, 
mysql
);

108 
mysql_þo£
(
mysql
);

109  
	gOK
;

113 
	$‹¡_cÚc71
(
MYSQL
 *
my
)

115 
rc
;

116 
MYSQL
 *
mysql
;

119  
SKIP
;

121 
mysql
ð
	`mysql_š™
(
NULL
);

124 
	`mysql_ÝtiÚs
(
mysql
, 
MYSQL_SET_CHARSET_NAME
, "utf8");

125 
	`mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_COMPRESS
, 0);

126 
	`mysql_ÝtiÚs
(
mysql
, 
MYSQL_INIT_COMMAND
, "/*!40101 SET SQL_MODE='' */");

127 
	`mysql_ÝtiÚs
(
mysql
, 
MYSQL_INIT_COMMAND
, "/*!40101 set @@session.wait_timeout=28800 */");

129 
	`FAIL_IF
(!
	`my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
, 
schema
,

130 
pÜt
, 
sock‘Çme
, 0), 
	`mysql_”rÜ
(
my
));

132 
	`dŸg
("kill server");

134 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT 'foo' FROM DUAL");

135 
	`check_mysql_rc
(
rc
, 
mysql
);

137 
	`mysql_þo£
(
mysql
);

138  
OK
;

139 
	}
}

141 
	$‹¡_cÚc70
(
MYSQL
 *
my
)

143 
rc
;

144 
MYSQL_RES
 *
»s
;

145 
MYSQL_ROW
 
row
;

146 
MYSQL
 *
mysql
;

148 
SKIP_CONNECTION_HANDLER
;

150 
SKIP_SKYSQL
;

151 
SKIP_MAXSCALE
;

153 
mysql
ð
	`mysql_š™
(
NULL
);

155 
rc
ð
	`mysql_qu”y
(
my
, "SET @a:=@@max_allowed_packet");

156 
	`check_mysql_rc
(
rc
, 
my
);

158 
	`mysql_qu”y
(
my
, "SET global max_allowed_packet=1024*1024*22");

159 
	`check_mysql_rc
(
rc
, 
my
);

161 
	`mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_COMPRESS
, (*)1);

162 
	`FAIL_IF
(!
	`my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
, 
schema
,

163 
pÜt
, 
sock‘Çme
, 0), 
	`mysql_”rÜ
(
my
));

165 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

166 
	`check_mysql_rc
(
rc
, 
mysql
);

168 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE1 (a LONGBLOB)ƒngine=MyISAM");

169 
	`check_mysql_rc
(
rc
, 
mysql
);

171 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTO1 VALUES (REPEAT('A', 1024 * 1024 * 20))");

172 
	`check_mysql_rc
(
rc
, 
mysql
);

174 ià(
	`mysql_w¬nšg_couÁ
(
mysql
))

176 
	`dŸg
("server doesn't‡ccept…ackage size");

177  
SKIP
;

181 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT‡ FROM1");

182 
	`check_mysql_rc
(
rc
, 
mysql
);

184 ià(!(
»s
ð
	`mysql_¡Üe_»suÉ
(
mysql
)))

186 
	`dŸg
("E¼Ü: %s", 
	`mysql_”rÜ
(
mysql
));

187  
FAIL
;

190 
row
ð
	`mysql_ãtch_row
(
»s
);

191 
	`dŸg
("L’gth: %ld", ()
	`¡¾’
(
row
[0]));

192 
	`FAIL_IF
(
	`¡¾’
(
row
[0]) != 1024 * 1024 * 20, "Wrong†ength");

194 
	`mysql_ä“_»suÉ
(
»s
);

195 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

196 
	`check_mysql_rc
(
rc
, 
mysql
);

198 
	`mysql_þo£
(
mysql
);

200 
rc
ð
	`mysql_qu”y
(
my
, "SET global max_allowed_packet=@a");

201 
	`check_mysql_rc
(
rc
, 
my
);

203  
OK
;

204 
	}
}

206 
	$‹¡_cÚc68
(
MYSQL
 *
my
)

208 
rc
;

209 
MYSQL_RES
 *
»s
;

210 
MYSQL_ROW
 
row
;

211 
MYSQL
 *
mysql
;

213 
SKIP_CONNECTION_HANDLER
;

214 
SKIP_SKYSQL
;

215 
SKIP_MAXSCALE
;

217 
mysql
ð
	`mysql_š™
(
NULL
);

219 
rc
ð
	`mysql_qu”y
(
my
, "SET @a:=@@max_allowed_packet");

220 
	`check_mysql_rc
(
rc
, 
my
);

222 
	`mysql_qu”y
(
my
, "SET global max_allowed_packet=1024*1024*22");

224 
	`FAIL_IF
(!
	`my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
, 
schema
,

225 
pÜt
, 
sock‘Çme
, 0), 
	`mysql_”rÜ
(
my
));

227 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

228 
	`check_mysql_rc
(
rc
, 
mysql
);

230 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE1 (a LONGBLOB) ENGINE=MyISAM");

231 
	`check_mysql_rc
(
rc
, 
mysql
);

233 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTO1 VALUES (REPEAT('A', 1024 * 1024 * 20))");

234 
	`check_mysql_rc
(
rc
, 
mysql
);

235 ià(
	`mysql_w¬nšg_couÁ
(
mysql
))

237 
	`dŸg
("server doesn't‡ccept…ackage size");

238  
SKIP
;

241 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT‡ FROM1");

242 
	`check_mysql_rc
(
rc
, 
mysql
);

244 ià(!(
»s
ð
	`mysql_¡Üe_»suÉ
(
mysql
)))

246 
	`dŸg
("E¼Ü: %s", 
	`mysql_”rÜ
(
mysql
));

247  
FAIL
;

250 
row
ð
	`mysql_ãtch_row
(
»s
);

251 
	`dŸg
("L’gth: %ld", ()
	`¡¾’
(
row
[0]));

252 
	`FAIL_IF
(
	`¡¾’
(
row
[0]) != 1024 * 1024 * 20, "Wrong†ength");

254 
	`mysql_ä“_»suÉ
(
»s
);

255 
	`mysql_þo£
(
mysql
);

257 
rc
ð
	`mysql_qu”y
(
my
, "SET global max_allowed_packet=@a");

258 
	`check_mysql_rc
(
rc
, 
my
);

260  
OK
;

261 
	}
}

264 
basic_cÚÃù
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

266 
MYSQL_ROW
 
	grow
;

267 
MYSQL_RES
 *
	g»s
;

268 
MYSQL_FIELD
 *
	gf›ld
;

269 
	grc
;

270 
MYSQL
 *
	gmy
;

272 
	gmy
ð
mysql_š™
(
NULL
);

273 
FAIL_IF
(!
my
, "mysql_init() failed");

275 
FAIL_IF
(!
my_‹¡_cÚÃù
(
my
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
, 
schema
,

276 
pÜt
, 
sock‘Çme
, 0), 
mysql_”rÜ
(
my
));

278 
	grc
ð
mysql_qu”y
(
my
, "SELECT @@version");

279 
check_mysql_rc
(
rc
, 
my
);

281 
	g»s
ð
mysql_¡Üe_»suÉ
(
my
);

282 
FAIL_IF
(!
»s
, 
mysql_”rÜ
(
my
));

283 
	gf›ld
ð
mysql_ãtch_f›lds
(
»s
);

284 
FAIL_IF
(!
f›ld
, "couldn't fetch field");

285 (
	grow
ð
mysql_ãtch_row
(
»s
)è!ð
NULL
)

287 
FAIL_IF
(
mysql_num_f›lds
(
»s
) != 1, "Gothe wrong‚umber of fields");

289 
FAIL_IF
(
mysql_”ºo
(
my
), 
mysql_”rÜ
(my));

291 
mysql_ä“_»suÉ
(
»s
);

292 
mysql_þo£
(
my
);

294  
	gOK
;

298 
	$u£_utf8
(
MYSQL
 *
my
)

300 
MYSQL_ROW
 
row
;

301 
MYSQL_RES
 *
»s
;

302 
rc
;

305 
rc
ð
	`mysql_qu”y
(
my
, "SELECT @@character_set_connection");

306 
	`check_mysql_rc
(
rc
, 
my
);

308 
»s
ð
	`mysql_¡Üe_»suÉ
(
my
);

309 
	`FAIL_IF
(!
»s
, 
	`mysql_”rÜ
(
my
));

311 (
row
ð
	`mysql_ãtch_row
(
»s
)è!ð
NULL
)

313 
	`FAIL_IF
(
	`¡rcmp
(
row
[0], "utf8"), "wrong character set");

315 
	`FAIL_IF
(
	`mysql_”ºo
(
my
), 
	`mysql_”rÜ
(my));

316 
	`mysql_ä“_»suÉ
(
»s
);

318  
OK
;

319 
	}
}

321 
	$þ›Á_qu”y
(
MYSQL
 *
mysql
) {

322 
rc
;

324 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

325 
	`check_mysql_rc
(
rc
, 
mysql
);

326 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE1("

329 
	`check_mysql_rc
(
rc
, 
mysql
);

330 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE1(id int,‚ame varchar(20))");

331 
	`FAIL_IF
(!
rc
, "Errorƒxpected");

332 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTO1(name) VALUES('mysql')");

333 
	`check_mysql_rc
(
rc
, 
mysql
);

334 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTO1(name) VALUES('monty')");

335 
	`check_mysql_rc
(
rc
, 
mysql
);

336 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTO1(name) VALUES('venu')");

337 
	`check_mysql_rc
(
rc
, 
mysql
);

338 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTO1(name) VALUES('deleted')");

339 
	`check_mysql_rc
(
rc
, 
mysql
);

340 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTO1(name) VALUES('deleted')");

341 
	`check_mysql_rc
(
rc
, 
mysql
);

342 
rc
ð
	`mysql_qu”y
(
mysql
, "UPDATE1 SET‚ame= 'updated' "

344 
	`check_mysql_rc
(
rc
, 
mysql
);

345 
rc
ð
	`mysql_qu”y
(
mysql
, "UPDATE1 SET id= 3 WHERE‚ame= 'updated'");

346 
	`FAIL_IF
(!
rc
, "Errorƒxpected");

347 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable1");

348 
	`check_mysql_rc
(
rc
, 
mysql
);

350  
OK
;

351 
	}
}

353 
	$‹¡_bug12001
(
MYSQL
 *
mysql
)

355 
MYSQL_RES
 *
»suÉ
;

356 cÚ¡ *
qu”y
= "DROP TABLE IF EXISTSest_table;"

362 
rc
, 
»s
;

365 
rc
ð
	`mysql_qu”y
(
mysql
, 
qu”y
);

366 
	`check_mysql_rc
(
rc
, 
mysql
);

370 ià(
	`mysql_f›ld_couÁ
(
mysql
) &&

371 (
»suÉ
ð
	`mysql_u£_»suÉ
(
mysql
)))

373 
	`mysql_ä“_»suÉ
(
»suÉ
);

376 !(
»s
ð
	`mysql_Ãxt_»suÉ
(
mysql
)));

378 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_table");

379 
	`check_mysql_rc
(
rc
, 
mysql
);

381 
	`FAIL_UNLESS
(
»s
==1, "res != 1");

383  
OK
;

384 
	}
}

388 
my_ÝtiÚ_¡
 
	gÝt_utf8
[] = {

389 {
MYSQL_SET_CHARSET_NAME
, (*)"utf8"},

390 {0, 
NULL
}

393 
	$‹¡_bad_uniÚ
(
MYSQL
 *
mysql
)

395 
MYSQL_STMT
 *
¡mt
;

396 
rc
;

397 cÚ¡ *
qu”y
= "SELECT 1, 2 union SELECT 1";

399 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

400 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

401 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

402 
	`FAIL_UNLESS
(
rc
 && 
	`mysql_”ºo
(
mysql
) == 1222, "Errorƒxpected");

404 
	`mysql_¡mt_þo£
(
¡mt
);

405  
OK
;

406 
	}
}

411 
	$‹¡_mysql_š£¹_id
(
MYSQL
 *
mysql
)

413 
»s
;

414 
rc
;

416 ià(
	`mysql_g‘_£rv”_v”siÚ
(
mysql
) < 50100) {

417 
	`dŸg
("Test„equires MySQL Server version 5.1 or‡bove");

418  
SKIP
;

421 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxists1");

422 
	`check_mysql_rc
(
rc
, 
mysql
);

423 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxists2");

424 
	`check_mysql_rc
(
rc
, 
mysql
);

425 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxists3");

426 
	`check_mysql_rc
(
rc
, 
mysql
);

427 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxists4");

428 
	`check_mysql_rc
(
rc
, 
mysql
);

430 
rc
ð
	`mysql_qu”y
(
mysql
, "createable1 (f1 int, f2 varchar(255), key(f1))");

431 
	`check_mysql_rc
(
rc
, 
mysql
);

432 
rc
ð
	`mysql_qu”y
(
mysql
, "createable2 (f1 int‚ot‚ull…rimary key‡uto_increment, f2 varchar(255))");

433 
	`check_mysql_rc
(
rc
, 
mysql
);

434 
rc
ð
	`mysql_qu”y
(
mysql
, "createable3 (f1 int‚ot‚ull…rimary key‡uto_increment, f2 varchar(255))ƒngine=MyISAM");

435 
	`check_mysql_rc
(
rc
, 
mysql
);

436 
rc
ð
	`mysql_qu”y
(
mysql
, "createable4 (f1 int‚ot‚ull…rimary key "

438 
	`check_mysql_rc
(
rc
, 
mysql
);

440 
rc
ð
	`mysql_qu”y
(
mysql
, "FLUSH TABLES");

441 
	`check_mysql_rc
(
rc
, 
mysql
);

442 
rc
ð
	`mysql_qu”y
(
mysql
, "START TRANSACTION");

443 
	`check_mysql_rc
(
rc
, 
mysql
);

445 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into1 values (1,'a')");

446 
	`check_mysql_rc
(
rc
, 
mysql
);

447 
»s
ð
	`mysql_š£¹_id
(
mysql
);

448 
	`FAIL_UNLESS
(
»s
 == 0, "");

449 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into1 values (null,'b')");

450 
	`check_mysql_rc
(
rc
, 
mysql
);

451 
»s
ð
	`mysql_š£¹_id
(
mysql
);

452 
	`FAIL_UNLESS
(
»s
 == 0, "");

453 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into1 select 5,'c'");

454 
	`check_mysql_rc
(
rc
, 
mysql
);

455 
»s
ð
	`mysql_š£¹_id
(
mysql
);

456 
	`FAIL_UNLESS
(
»s
 == 0, "");

462 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into2 values (null,'b')");

463 
	`check_mysql_rc
(
rc
, 
mysql
);

464 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into1 select 5,'c'");

465 
	`check_mysql_rc
(
rc
, 
mysql
);

466 
»s
ð
	`mysql_š£¹_id
(
mysql
);

467 
	`FAIL_UNLESS
(
»s
 == 0, "");

468 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into1 select‚ull,'d'");

469 
	`check_mysql_rc
(
rc
, 
mysql
);

470 
»s
ð
	`mysql_š£¹_id
(
mysql
);

471 
	`FAIL_UNLESS
(
»s
 == 0, "");

472 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into1 values (null,last_insert_id(300))");

473 
	`check_mysql_rc
(
rc
, 
mysql
);

474 
»s
ð
	`mysql_š£¹_id
(
mysql
);

475 
	`FAIL_UNLESS
(
»s
 == 300, "");

476 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into1 select‚ull,last_insert_id(400)");

477 
	`check_mysql_rc
(
rc
, 
mysql
);

478 
»s
ð
	`mysql_š£¹_id
(
mysql
);

484 
	`FAIL_UNLESS
(
»s
 == 400, "");

487 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into3 values (1,'a')");

488 
	`check_mysql_rc
(
rc
, 
mysql
);

489 
»s
ð
	`mysql_š£¹_id
(
mysql
);

490 
	`FAIL_UNLESS
(
»s
 == 1, "");

492 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into1 values (10,'e')");

493 
	`check_mysql_rc
(
rc
, 
mysql
);

494 
»s
ð
	`mysql_š£¹_id
(
mysql
);

495 
	`FAIL_UNLESS
(
»s
 == 0, "");

497 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into3 values (null,'b')");

498 
	`check_mysql_rc
(
rc
, 
mysql
);

499 
»s
ð
	`mysql_š£¹_id
(
mysql
);

500 
	`FAIL_UNLESS
(
»s
 == 2, "");

501 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into3 select 5,'c'");

502 
	`check_mysql_rc
(
rc
, 
mysql
);

503 
»s
ð
	`mysql_š£¹_id
(
mysql
);

509 
	`FAIL_UNLESS
(
»s
 == 5, "");

510 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into3 select‚ull,'d'");

511 
	`check_mysql_rc
(
rc
, 
mysql
);

512 
»s
ð
	`mysql_š£¹_id
(
mysql
);

513 
	`FAIL_UNLESS
(
»s
 == 6, "");

515 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into3 values (10,'a'),(11,'b')");

516 
	`check_mysql_rc
(
rc
, 
mysql
);

517 
»s
ð
	`mysql_š£¹_id
(
mysql
);

518 
	`FAIL_UNLESS
(
»s
 == 11, "");

519 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into3 select 12,'a' union select 13,'b'");

520 
	`check_mysql_rc
(
rc
, 
mysql
);

521 
»s
ð
	`mysql_š£¹_id
(
mysql
);

527 
	`FAIL_UNLESS
(
»s
 == 13, "");

528 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into3 values (null,'a'),(null,'b')");

529 
	`check_mysql_rc
(
rc
, 
mysql
);

530 
»s
ð
	`mysql_š£¹_id
(
mysql
);

531 
	`FAIL_UNLESS
(
»s
 == 14, "");

532 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into3 select‚ull,'a' union select‚ull,'b'");

533 
	`check_mysql_rc
(
rc
, 
mysql
);

534 
»s
ð
	`mysql_š£¹_id
(
mysql
);

535 
	`FAIL_UNLESS
(
»s
 == 16, "");

536 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into3 select 12,'a' union select 13,'b'");

537 
	`FAIL_IF
(!
rc
, "Errorƒxpected");

538 
rc
ð
	`mysql_qu”y
(
mysql
, "insert ignore into3 select 12,'a' union select 13,'b'");

539 
	`check_mysql_rc
(
rc
, 
mysql
);

540 
»s
ð
	`mysql_š£¹_id
(
mysql
);

541 
	`FAIL_UNLESS
(
»s
 == 0, "");

542 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into3 values (12,'a'),(13,'b')");

543 
	`FAIL_IF
(!
rc
, "Errorƒxpected");

544 
»s
ð
	`mysql_š£¹_id
(
mysql
);

545 
	`FAIL_UNLESS
(
»s
 == 0, "");

546 
rc
ð
	`mysql_qu”y
(
mysql
, "insert ignore into3 values (12,'a'),(13,'b')");

547 
	`check_mysql_rc
(
rc
, 
mysql
);

548 
»s
ð
	`mysql_š£¹_id
(
mysql
);

549 
	`FAIL_UNLESS
(
»s
 == 0, "");

551 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into3 values (null,'e'),(12,'a'),(13,'b')");

552 
	`FAIL_IF
(!
rc
, "Errorƒxpected");

553 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into3 values (null,'e'),(12,'a'),(13,'b'),(25,'g')");

554 
	`FAIL_IF
(!
rc
, "Errorƒxpected");

555 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into3 values (null,last_insert_id(300))");

556 
	`check_mysql_rc
(
rc
, 
mysql
);

557 
»s
ð
	`mysql_š£¹_id
(
mysql
);

562 
	`dŸg
("»s: %Îd", 
»s
);

563 
	`FAIL_UNLESS
(
»s
 == 20, "");

565 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into4 values (null,'e')");

566 
»s
ð
	`mysql_š£¹_id
(
mysql
);

567 
	`FAIL_UNLESS
(
»s
 == 1, "");

568 
rc
ð
	`mysql_qu”y
(
mysql
, "insert ignore into4 values (null,'e'),(null,'a'),(null,'e')");

569 
	`check_mysql_rc
(
rc
, 
mysql
);

570 
»s
ð
	`mysql_š£¹_id
(
mysql
);

571 
	`FAIL_UNLESS
(
»s
 == 2, "");

573 
rc
ð
	`mysql_qu”y
(
mysql
, "insert ignore into4 values (null,'e'),(12,'c'),(null,'d')");

574 
	`check_mysql_rc
(
rc
, 
mysql
);

575 
»s
ð
	`mysql_š£¹_id
(
mysql
);

580 
	`FAIL_UNLESS
(
»s
 == 13, "");

582 
rc
ð
	`mysql_qu”y
(
mysql
, "update4 set f1=14 where f1=12");

583 
	`check_mysql_rc
(
rc
, 
mysql
);

584 
»s
ð
	`mysql_š£¹_id
(
mysql
);

585 
	`FAIL_UNLESS
(
»s
 == 0, "");

586 
rc
ð
	`mysql_qu”y
(
mysql
, "update4 set f1=0 where f1=14");

587 
	`check_mysql_rc
(
rc
, 
mysql
);

588 
»s
ð
	`mysql_š£¹_id
(
mysql
);

589 
	`FAIL_UNLESS
(
»s
 == 0, "");

590 
rc
ð
	`mysql_qu”y
(
mysql
, "update4 set f2=last_insert_id(372) where f1=0");

591 
	`check_mysql_rc
(
rc
, 
mysql
);

592 
»s
ð
	`mysql_š£¹_id
(
mysql
);

593 
	`FAIL_UNLESS
(
»s
 == 372, "");

595 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into4 values (null,'g')");

596 
	`check_mysql_rc
(
rc
, 
mysql
);

597 
»s
ð
	`mysql_š£¹_id
(
mysql
);

598 
	`FAIL_UNLESS
(
»s
 == 15, "");

599 
rc
ð
	`mysql_qu”y
(
mysql
, "update4 set f2=(@li:=last_insert_id()) where f1=15");

600 
	`check_mysql_rc
(
rc
, 
mysql
);

601 
»s
ð
	`mysql_š£¹_id
(
mysql
);

602 
	`FAIL_UNLESS
(
»s
 == 0, "");

608 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into4 values (null,@li) on duplicate key "

610 
	`check_mysql_rc
(
rc
, 
mysql
);

611 
»s
ð
	`mysql_š£¹_id
(
mysql
);

612 
	`FAIL_UNLESS
(
»s
 == 15, "");

614 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable1,t2,t3,t4");

615 
	`check_mysql_rc
(
rc
, 
mysql
);

616  
OK
;

617 
	}
}

621 
	$‹¡_£Ëù_dœeù
(
MYSQL
 *
mysql
)

623 
rc
;

624 
MYSQL_RES
 *
»suÉ
;

627 
rc
ð
	`mysql_autocomm™
(
mysql
, 
TRUE
);

628 
	`check_mysql_rc
(
rc
, 
mysql
);

630 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_select");

631 
	`check_mysql_rc
(
rc
, 
mysql
);

633 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_select(id int, id1inyint, "

637 
	`check_mysql_rc
(
rc
, 
mysql
);

640 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTOest_select VALUES(10, 5, 2.3, 4.5, 'venu')");

641 
	`check_mysql_rc
(
rc
, 
mysql
);

643 
rc
ð
	`mysql_comm™
(
mysql
);

644 
	`check_mysql_rc
(
rc
, 
mysql
);

646 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT * FROMest_select");

647 
	`check_mysql_rc
(
rc
, 
mysql
);

650 
»suÉ
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

651 
	`FAIL_IF
(!
»suÉ
, "Invalid„esult set");

653 
	`mysql_ä“_»suÉ
(
»suÉ
);

654 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_select");

655 
	`check_mysql_rc
(
rc
, 
mysql
);

656  
OK
;

657 
	}
}

663 
	$‹¡_¡©us
(
MYSQL
 *
mysql
)

665 
	`mysql_¡©
(
mysql
);

666 
	`check_mysql_rc
(
	`mysql_”ºo
(
mysql
), mysql);

667  
OK
;

668 
	}
}

670 
	$bug_cÚc1
(
MYSQL
 *
mysql
)

672 
	`my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
, 
schema
,

673 
pÜt
, 
sock‘Çme
, 0);

674 
	`dŸg
("”ºo: %d", 
	`mysql_”ºo
(
mysql
));

675 
	`FAIL_IF
(
	`mysql_”ºo
(
mysql
è!ð
CR_ALREADY_CONNECTED
,

677  
OK
;

678 
	}
}

680 
‹¡_ÝtiÚs_š™cmd
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

682 
MYSQL
 *
	gmysql
ð
mysql_š™
(
NULL
);

683 
MYSQL_RES
 *
	g»s
;

684 
	grc
;

686 
mysql_ÝtiÚs
(
mysql
, 
MYSQL_INIT_COMMAND
, "DROP TABLE IF EXISTS1; CREATE TABLE1 (a int)");

687 
mysql_ÝtiÚs
(
mysql
, 
MYSQL_INIT_COMMAND
, "INSERT INTO1 VALUES (1),(2),(3)");

688 
FAIL_IF
(!
my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
, 
schema
,

689 
pÜt
, 
sock‘Çme
,

690 
CLIENT_MULTI_STATEMENTS
 | 
CLIENT_MULTI_RESULTS
), 
mysql_”rÜ
(
mysql
));

692 
	grc
ð
mysql_qu”y
(
mysql
, "SELECT‡ FROM1");

693 
check_mysql_rc
(
rc
, 
mysql
);

695 
	g»s
ð
mysql_¡Üe_»suÉ
(
mysql
);

696 
FAIL_IF
(
mysql_num_rows
(
»s
) != 3, "Expected 3„ows");

698 
mysql_ä“_»suÉ
(
»s
);

700 
	grc
ð
mysql_qu”y
(
mysql
, "DROP TABLE1");

701 
check_mysql_rc
(
rc
, 
mysql
);

702 
mysql_þo£
(
mysql
);

703  
	gOK
;

706 
‹¡_ex‹nded_š™_v®ues
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

708 
MYSQL
 *
	gmysql
ð
mysql_š™
(
NULL
);

710 
mysql_ÝtiÚs
(
mysql
, 
MYSQL_DEFAULT_AUTH
, "unknown");

711 
FAIL_IF
(
¡rcmp
(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
deçuÉ_auth
, "unknown"), "option‚ot set");

713 
mysql_ÝtiÚs
(
mysql
, 
MYSQL_PLUGIN_DIR
, "/tmp/foo");

714 
FAIL_IF
(
¡rcmp
(
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
¶ugš_dœ
, "/tmp/foo"), "option‚ot set");

716 
mysql_þo£
(
mysql
);

717  
	gOK
;

720 
‹¡_»cÚÃù_max·ckage
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

722 
	grc
;

723 
ulÚg
 
	gmax_·ck‘
= 0;

724 
MYSQL
 *
	gmysql
;

725 
MYSQL_RES
 *
	g»s
;

726 
MYSQL_ROW
 
	grow
;

727 *
	gqu”y
;

728 
my_boÞ
 
	g»cÚÃù
= 1;

730 
	gSKIP_CONNECTION_HANDLER
;

732 
	gmysql
ð
mysql_š™
(
NULL
);

734 
FAIL_IF
(!
my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
, 
schema
,

735 
pÜt
, 
sock‘Çme
,

736 
CLIENT_MULTI_STATEMENTS
 | 
CLIENT_MULTI_RESULTS
), 
mysql_”rÜ
(
mysql
));

737 
mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_RECONNECT
, &
»cÚÃù
);

739 
	grc
ð
mysql_qu”y
(
mysql
, "SELECT @@max_allowed_packet");

740 
check_mysql_rc
(
rc
, 
mysql
);

741 
	g»s
ð
mysql_¡Üe_»suÉ
(
mysql
);

742 
	grow
ð
mysql_ãtch_row
(
»s
);

743 
	gmax_·ck‘
ð
©Þ
(
row
[0]);

744 
dŸg
("max_®lowed_·ck‘=%lu", 
max_·ck‘
);

745 
mysql_ä“_»suÉ
(
»s
);

747 
	gqu”y
ð(*)
m®loc
(
max_·ck‘
 + 30);

748 
mem£t
(
qu”y
, 0, 
max_·ck‘
 + 30);

750 
¡rýy
(
qu”y
, "SELECT '");

751 
mem£t
(
qu”y
 + 8, 'A', 
max_·ck‘
);

752 
¡rÿt
(
qu”y
, "' FROM DUAL");

754 
	grc
ð
mysql_qu”y
(
mysql
, 
qu”y
);

755 
ä“
(
qu”y
);

756 ià(!
	grc
)

758 
dŸg
("expectedƒrror");

759 
mysql_þo£
(
mysql
);

760  
	gFAIL
;

763 
dŸg
("E¼Ü (ex³ùed): %s", 
mysql_”rÜ
(
mysql
));

765 
	grc
ð
mysql_pšg
(
mysql
);

768 ià(
	grc
)

769 
	grc
ð
mysql_pšg
(
mysql
);

770 
check_mysql_rc
(
rc
, 
mysql
);

771 
	grc
ð
mysql_qu”y
(
mysql
, "SELECT @@max_allowed_packet");

772 
check_mysql_rc
(
rc
, 
mysql
);

773 
	g»s
ð
mysql_¡Üe_»suÉ
(
mysql
);

774 
	grow
ð
mysql_ãtch_row
(
»s
);

775 
	gmax_·ck‘
ð
©Þ
(
row
[0]);

776 
dŸg
("max_®lowed_·ck‘=%lu", 
max_·ck‘
);

777 
mysql_ä“_»suÉ
(
»s
);

780 
mysql_þo£
(
mysql
);

781  
	gOK
;

784 
‹¡_com´es£d
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

786 
	grc
;

787 
MYSQL
 *
	gmysql
ð
mysql_š™
(
NULL
);

788 
MYSQL_RES
 *
	g»s
;

789 
my_boÞ
 
	g»cÚÃù
= 1;

791 
mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_COMPRESS
, (*)1);

792 
FAIL_IF
(!
my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
, 
schema
,

793 
pÜt
, 
sock‘Çme
,

794 
CLIENT_MULTI_STATEMENTS
 | 
CLIENT_MULTI_RESULTS
), 
mysql_”rÜ
(
mysql
));

795 
mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_RECONNECT
, &
»cÚÃù
);

797 
	grc
ð
mysql_qu”y
(
mysql
, "SHOW VARIABLES");

798 
check_mysql_rc
(
rc
, 
mysql
);

800 ià((
	g»s
ð
mysql_¡Üe_»suÉ
(
mysql
)))

801 
mysql_ä“_»suÉ
(
»s
);

803 
mysql_þo£
(
mysql
);

805  
	gOK
;

808 
my_‹¡s_¡
 
	gmy_‹¡s
[] = {

809 {"‹¡_cÚc75", 
‹¡_cÚc75
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

810 {"‹¡_cÚc74", 
‹¡_cÚc74
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

811 {"‹¡_cÚc71", 
‹¡_cÚc71
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

812 {"‹¡_cÚc70", 
‹¡_cÚc70
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

813 {"‹¡_cÚc68", 
‹¡_cÚc68
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

814 {"‹¡_com´es£d", 
‹¡_com´es£d
, 
TEST_CONNECTION_NONE
, 0, 
NULL
, NULL},

815 {"‹¡_»cÚÃù_max·ckage", 
‹¡_»cÚÃù_max·ckage
, 
TEST_CONNECTION_NONE
, 0, 
NULL
, NULL},

816 {"basic_cÚÃù", 
basic_cÚÃù
, 
TEST_CONNECTION_NONE
, 0, 
NULL
, NULL},

817 {"u£_utf8", 
u£_utf8
, 
TEST_CONNECTION_NEW
, 0, 
Ýt_utf8
, 
NULL
},

818 {"þ›Á_qu”y", 
þ›Á_qu”y
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

819 {"‹¡_bad_uniÚ", 
‹¡_bad_uniÚ
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

820 {"‹¡_£Ëù_dœeù", 
‹¡_£Ëù_dœeù
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

821 {"‹¡_mysql_š£¹_id", 
‹¡_mysql_š£¹_id
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

822 {"‹¡_bug12001", 
‹¡_bug12001
, 
TEST_CONNECTION_NEW
, 
CLIENT_MULTI_STATEMENTS
, 
NULL
, NULL},

823 {"‹¡_¡©us", 
‹¡_¡©us
, 
TEST_CONNECTION_NEW
, 
CLIENT_MULTI_STATEMENTS
, 
NULL
, NULL},

824 {"bug_cÚc1", 
bug_cÚc1
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

825 {"‹¡_ÝtiÚs_š™cmd", 
‹¡_ÝtiÚs_š™cmd
, 
TEST_CONNECTION_NONE
, 0, 
NULL
, NULL},

826 {"‹¡_ex‹nded_š™_v®ues", 
‹¡_ex‹nded_š™_v®ues
, 
TEST_CONNECTION_NONE
, 0, 
NULL
, NULL},

827 {
NULL
, NULL, 0, 0, NULL, NULL}

831 
	$maš
(
¬gc
, **
¬gv
)

833 ià(
¬gc
 > 1)

834 
	`g‘_ÝtiÚs
(
¬gc
, 
¬gv
);

836 
	`g‘_’vv¬s
();

838 
	`dŸg
("u£r: %s", 
u£ºame
);

840 
	`run_‹¡s
(
my_‹¡s
);

842 (
	`ex™_¡©us
());

843 
	}
}

	@unittest/libmariadb/bulk1.c

17 
	~"my_‹¡.h
"

18 
	~"ma_commÚ.h
"

20 
	#TEST_ARRAY_SIZE
 1024

	)

22 
my_boÞ
 
	gbulk_’abËd
= 0;

24 *
	$¿nd_¡r
(
size_t
 
Ëngth
) {

25 cÚ¡ 
ch¬£t
[] = "0123456789"

28 *
de¡
ð(*)
	`m®loc
(
Ëngth
+1);

29 *
p
ð
de¡
;

30 
Ëngth
-- > 0) {

31 *
de¡
++ = 
ch¬£t
[
	`¿nd
() % (charset)];

33 *
de¡
 = '\0';

34  
p
;

35 
	}
}

37 
	$check_bulk
(
MYSQL
 *
mysql
)

39 
bulk_’abËd
ð(!(
mysql
->
£rv”_ÿ·bž™›s
 & 
CLIENT_MYSQL
) &&

40 (
mysql
->
ex‹nsiÚ
->
m¬Ÿdb_£rv”_ÿ·bž™›s
 &

41 (
MARIADB_CLIENT_STMT_BULK_OPERATIONS
 >> 32)));

42 
	`dŸg
("bulk %ssuµÜ‹d", 
bulk_’abËd
 ? "" : "not ");

43  
OK
;

44 
	}
}

46 
	$bulk1
(
MYSQL
 *
mysql
)

48 
MYSQL_STMT
 *
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

49 cÚ¡ *
¡mt_¡r
= "INSERT INTO bulk1 VALUES (?,?)";

50 
¬¿y_size
ð
TEST_ARRAY_SIZE
;

51 
rc
;

52 
i
;

53 **
bufãr
;

54 *
Ëngths
;

55 *
v®s
;

56 
MYSQL_BIND
 
bšd
[2];

57 
MYSQL_RES
 *
»s
;

58 
MYSQL_ROW
 
row
;

59 
štv®
;

61 ià(!
bulk_’abËd
)

62  
SKIP
;

64 
rc
ð
	`mysql_£Ëù_db
(
mysql
, "testc");

66 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS bulk1");

67 
	`check_mysql_rc
(
rc
, 
mysql
);

69 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE bulk1 (a int , b VARCHAR(255))");

70 
	`check_mysql_rc
(
rc
, 
mysql
);

72 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_¡r
));

73 
	`check_¡mt_rc
(
rc
, 
¡mt
);

76 
bufãr
ð
	`ÿÎoc
(
TEST_ARRAY_SIZE
, (*));

77 
Ëngths
ð(*)
	`ÿÎoc
((), 
TEST_ARRAY_SIZE
);

78 
v®s
ð(*)
	`ÿÎoc
((), 
TEST_ARRAY_SIZE
);

80 
i
=0; i < 
TEST_ARRAY_SIZE
; i++)

82 
bufãr
[
i
]ð
	`¿nd_¡r
(254);

83 
Ëngths
[
i
]= -1;

84 
v®s
[
i
]= i;

87 
	`mem£t
(
bšd
, 0, (
MYSQL_BIND
) * 2);

88 
bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

89 
bšd
[0].
bufãr
ð
v®s
;

90 
bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

91 
bšd
[1].
bufãr
= (*)buffer;

92 
bšd
[1].
Ëngth
ð(*)
Ëngths
;

94 
rc
ð
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_ARRAY_SIZE
, &
¬¿y_size
);

95 
	`check_¡mt_rc
(
rc
, 
¡mt
);

97 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
bšd
);

98 
	`check_¡mt_rc
(
rc
, 
¡mt
);

100 
i
=0; i < 100; i++)

102 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

103 
	`check_¡mt_rc
(
rc
, 
¡mt
);

104 
	`FAIL_IF
(
	`mysql_¡mt_afãùed_rows
(
¡mt
è!ð
TEST_ARRAY_SIZE
, "affected_rows != TEST_ARRAY_SIZE");

107 
i
=0; i < 
¬¿y_size
; i++)

108 
	`ä“
(
bufãr
[
i
]);

110 
	`ä“
(
bufãr
);

111 
	`ä“
(
Ëngths
);

112 
	`ä“
(
v®s
);

114 
rc
ð
	`mysql_¡mt_þo£
(
¡mt
);

115 
	`check_mysql_rc
(
rc
, 
mysql
);

117 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT COUNT(*) FROM bulk1");

118 
	`check_mysql_rc
(
rc
, 
mysql
);

120 
»s
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

121 
row
ð
	`mysql_ãtch_row
(
»s
);

122 
štv®
ð
	`©oi
(
row
[0]);

123 
	`mysql_ä“_»suÉ
(
»s
);

124 
	`FAIL_IF
(
štv®
 !ð
¬¿y_size
 * 100, "Expected 102400„ows");

126 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT MAX(a) FROM bulk1");

127 
	`check_mysql_rc
(
rc
, 
mysql
);

129 
»s
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

130 
row
ð
	`mysql_ãtch_row
(
»s
);

131 
štv®
ð
	`©oi
(
row
[0]);

132 
	`mysql_ä“_»suÉ
(
»s
);

133 
	`FAIL_IF
(
štv®
 !ð
¬¿y_size
 - 1, "Expected max value 1024");

135 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS bulk1");

136 
	`check_mysql_rc
(
rc
, 
mysql
);

137  
OK
;

138 
	}
}

140 
	$bulk2
(
MYSQL
 *
mysql
)

142 
MYSQL_STMT
 *
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

143 
rc
;

144 
MYSQL_BIND
 
bšd
[2];

145 
i
;

146 
¬¿y_size
=1024;

147 
šdiÿtÜ
[1024];

148 
lv®
[1024];

150 ià(!
bulk_’abËd
)

151  
SKIP
;

152 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS bulk2");

153 
	`check_mysql_rc
(
rc
, 
mysql
);

155 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE bulk2 (a int default 4, b int default 2)");

156 
	`check_mysql_rc
(
rc
, 
mysql
);

158 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("INSERT INTO bulk2 VALUES (?,1)"));

159 
	`check_¡mt_rc
(
rc
, 
¡mt
);

161 
	`mem£t
(
bšd
, 0, 2 * (
MYSQL_BIND
));

163 
i
=0; i < 
¬¿y_size
; i++)

165 
šdiÿtÜ
[
i
]ð
STMT_INDICATOR_DEFAULT
;

166 
lv®
[
i
]= i;

169 
bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

170 
bšd
[0].
u
.
šdiÿtÜ
= indicator;

171 
bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

172 
bšd
[1].
bufãr
ð&
lv®
;

174 
rc
ð
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_ARRAY_SIZE
, &
¬¿y_size
);

175 
	`check_¡mt_rc
(
rc
, 
¡mt
);

177 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
bšd
);

178 
	`check_¡mt_rc
(
rc
, 
¡mt
);

180 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

181 
	`check_¡mt_rc
(
rc
, 
¡mt
);

183 
	`mysql_¡mt_þo£
(
¡mt
);

184 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS bulk2");

185 
	`check_mysql_rc
(
rc
, 
mysql
);

187  
OK
;

188 
	}
}

190 
	$bulk3
(
MYSQL
 *
mysql
)

192 
	s¡_bulk3
 {

193 
ch¬_v®ue
[20];

194 
Ëngth
;

195 
št_v®ue
;

198 
¡_bulk3
 
v®
[3]= {{"Row 1", 5, 1},

201 
rc
;

202 
MYSQL_BIND
 
bšd
[2];

203 
MYSQL_STMT
 *
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

204 
size_t
 
row_size
ð(
¡_bulk3
);

205 
¬¿y_size
= 3;

207 ià(!
bulk_’abËd
)

208  
SKIP
;

209 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS bulk3");

210 
	`check_mysql_rc
(
rc
,
mysql
);

211 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE bulk3 (name varchar(20),„ow int)");

212 
	`check_mysql_rc
(
rc
,
mysql
);

214 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("INSERT INTO bulk3 VALUES (?,?)"));

215 
	`check_¡mt_rc
(
rc
, 
¡mt
);

217 
	`mem£t
(
bšd
, 0, (
MYSQL_BIND
)*2);

219 
rc
ð
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_ARRAY_SIZE
, &
¬¿y_size
);

220 
	`check_¡mt_rc
(
rc
, 
¡mt
);

221 
rc
ð
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_ROW_SIZE
, &
row_size
);

222 
	`check_¡mt_rc
(
rc
, 
¡mt
);

224 
bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

225 
bšd
[0].
bufãr
ð&
v®
[0].
ch¬_v®ue
;

226 
bšd
[0].
Ëngth
ð&
v®
[0].length;

227 
bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

228 
bšd
[1].
bufãr
ð&
v®
[0].
št_v®ue
;

230 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
bšd
);

231 
	`check_¡mt_rc
(
rc
, 
¡mt
);

232 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

233 
	`check_¡mt_rc
(
rc
, 
¡mt
);

235 
	`mysql_¡mt_þo£
(
¡mt
);

236 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS bulk3");

237 
	`check_mysql_rc
(
rc
, 
mysql
);

238  
OK
;

239 
	}
}

241 
	$bulk4
(
MYSQL
 *
mysql
)

243 
	s¡_bulk4
 {

244 
ch¬_v®ue
[20];

245 
šdiÿtÜ1
;

246 
št_v®ue
;

247 
šdiÿtÜ2
;

250 
¡_bulk4
 
v®
[]ð{{"Row 1", 
STMT_INDICATOR_NTS
, 0, 
STMT_INDICATOR_DEFAULT
},

251 {"Row 2", 
STMT_INDICATOR_NTS
, 0, 
STMT_INDICATOR_DEFAULT
},

252 {"Row 3", 
STMT_INDICATOR_NTS
, 0, 
STMT_INDICATOR_DEFAULT
}};

253 
rc
;

254 
MYSQL_BIND
 
bšd
[2];

255 
MYSQL_RES
 *
»s
;

256 
MYSQL_STMT
 *
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

257 
size_t
 
row_size
ð(
¡_bulk4
);

258 
¬¿y_size
= 3;

259 
Ëngths
[3]= {-1, -1, -1};

261 ià(!
bulk_’abËd
)

262  
SKIP
;

263 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS bulk4");

264 
	`check_mysql_rc
(
rc
,
mysql
);

265 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE bulk4 (name varchar(20),„ow int‚ot‚ull default 3)");

266 
	`check_mysql_rc
(
rc
,
mysql
);

268 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("INSERT INTO bulk4 VALUES (?,?)"));

269 
	`check_¡mt_rc
(
rc
, 
¡mt
);

271 
	`mem£t
(
bšd
, 0, (
MYSQL_BIND
)*2);

273 
rc
ð
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_ARRAY_SIZE
, &
¬¿y_size
);

274 
	`check_¡mt_rc
(
rc
, 
¡mt
);

275 
rc
ð
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_ROW_SIZE
, &
row_size
);

276 
	`check_¡mt_rc
(
rc
, 
¡mt
);

278 
bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

279 
bšd
[0].
u
.
šdiÿtÜ
ð&
v®
[0].
šdiÿtÜ1
;

280 
bšd
[0].
bufãr
ð&
v®
[0].
ch¬_v®ue
;

281 
bšd
[0].
Ëngth
ð
Ëngths
;

282 
bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

283 
bšd
[1].
u
.
šdiÿtÜ
ð&
v®
[0].
šdiÿtÜ2
;

285 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
bšd
);

286 
	`check_¡mt_rc
(
rc
, 
¡mt
);

287 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

288 
	`check_¡mt_rc
(
rc
, 
¡mt
);

290 
	`mysql_¡mt_þo£
(
¡mt
);

292 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT * FROM bulk4 WHERE„ow=3");

293 
	`check_mysql_rc
(
rc
, 
mysql
);

294 
»s
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

295 
rc
ð()
	`mysql_num_rows
(
»s
);

296 
	`mysql_ä“_»suÉ
(
»s
);

297 
	`FAIL_IF
(
rc
 != 3, "expected 3„ows");

298 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS bulk4");

299 
	`check_mysql_rc
(
rc
, 
mysql
);

300  
OK
;

301 
	}
}

303 
	$bulk_nuÎ
(
MYSQL
 *
mysql
)

305 
MYSQL_STMT
 *
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

306 
rc
;

307 
MYSQL_BIND
 
bšd
[2];

308 
·¿m_couÁ
= 2;

309 
¬¿y_size
= 2;

310 
Ëngths
[2]= {-1, -1};

311 **
buf
ð
	`ÿÎoc
(1, 2 * (*));

313 ià(!
bulk_’abËd
)

315 
	`ä“
(
buf
);

316  
SKIP
;

319 
buf
[0]ð
	`¡rdup
("foo");

320 
buf
[1]ð
	`¡rdup
("foobar");

322 
rc
ð
	`m¬Ÿdb_¡mt_execu‹_dœeù
(
¡mt
, "DROP TABLE IF EXISTS bulk_null", -1);

323 
	`check_¡mt_rc
(
rc
, 
¡mt
);

325 
rc
ð
	`m¬Ÿdb_¡mt_execu‹_dœeù
(
¡mt
, "CREATE TABLE bulk_null (a int‚ot‚ull‡uto_increment…rimary key, b varchar(20))", -1);

326 
	`check_¡mt_rc
(
rc
, 
¡mt
);

328 
	`mem£t
(
bšd
, 0, 2 * (
MYSQL_BIND
));

329 
bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_NULL
;

330 
bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

331 
bšd
[1].
bufãr
ð
buf
;

332 
bšd
[1].
Ëngth
ð
Ëngths
;

334 
	`mysql_¡mt_þo£
(
¡mt
);

335 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

337 
rc
ð
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_PREBIND_PARAMS
, &
·¿m_couÁ
);

338 
	`check_¡mt_rc
(
rc
, 
¡mt
);

340 
rc
ð
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_ARRAY_SIZE
, &
¬¿y_size
);

341 
	`check_¡mt_rc
(
rc
, 
¡mt
);

343 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
bšd
);

344 
	`check_¡mt_rc
(
rc
, 
¡mt
);

346 
rc
ð
	`m¬Ÿdb_¡mt_execu‹_dœeù
(
¡mt
, "INSERT INTO bulk_null VALUES (?, ?)", -1);

347 
	`check_¡mt_rc
(
rc
, 
¡mt
);

349 
	`mysql_¡mt_þo£
(
¡mt
);

350 
	`ä“
(
buf
[0]);

351 
	`ä“
(
buf
[1]);

352 
	`ä“
(
buf
);

353 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS bulk_null");

354 
	`check_mysql_rc
(
rc
, 
mysql
);

355  
OK
;

356 
	}
}

358 
	$bulk5
(
MYSQL
 *
mysql
)

360 
MYSQL_STMT
 *
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

361 
MYSQL_BIND
 
bšd
[3];

362 
MYSQL_RES
 *
»s
;

363 
rows
;

364 
¬¿y_size
= 5;

365 
rc
;

366 
štv®
[]= {12,13,14,15,16};

367 
id
[]= {1,2,3,4,5};

369 ià(!
bulk_’abËd
)

370  
SKIP
;

372 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS bulk5");

373 
	`check_mysql_rc
(
rc
, 
mysql
);

375 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE bulk5 (a int, b int)");

376 
	`check_mysql_rc
(
rc
, 
mysql
);

378 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTO bulk5 VALUES (1,1), (2,2), (3,3), (4,4), (5,5)");

379 
	`check_mysql_rc
(
rc
, 
mysql
);

382 
	`mem£t
(
bšd
, 0, (
MYSQL_BIND
) * 3);

384 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("UPDATE bulk5 SET‡=? WHERE‡=?"));

385 
	`check_¡mt_rc
(
rc
, 
¡mt
);

387 
bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

388 
bšd
[0].
bufãr
ð&
štv®
;

389 
bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

390 
bšd
[1].
bufãr
ð&
id
;

392 
rc
ð
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_ARRAY_SIZE
, &
¬¿y_size
);

393 
	`check_¡mt_rc
(
rc
, 
¡mt
);

395 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
bšd
);

396 
	`check_¡mt_rc
(
rc
, 
¡mt
);

398 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

399 
	`check_¡mt_rc
(
rc
, 
¡mt
);

401 
	`mysql_¡mt_þo£
(
¡mt
);

403 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT * FROM bulk5 WHERE‡=b+11");

404 
	`check_mysql_rc
(
rc
, 
mysql
);

406 
»s
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

407 
rows
ð()
	`mysql_num_rows
(
»s
);

408 
	`dŸg
("rows: %lu", 
rows
);

409 
	`mysql_ä“_»suÉ
(
»s
);

411 
	`FAIL_IF
(
rows
 != 5, "expected 5„ows");

413 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS bulk5");

414 
	`check_mysql_rc
(
rc
, 
mysql
);

416  
OK
;

417 
	}
}

419 
	$bulk6
(
MYSQL
 *
mysql
)

421 
MYSQL_STMT
 *
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

422 
MYSQL_BIND
 
bšd
[3];

423 
MYSQL_RES
 *
»s
;

424 
rows
;

425 
¬¿y_size
= 5;

426 
rc
;

427 
štv®
[]= {12,13,14,15,16};

428 
id
[]= {1,2,3,4,5};

429 
šdiÿtÜ
[5];

431 ià(!
bulk_’abËd
)

432  
SKIP
;

433 
	`mem£t
(
šdiÿtÜ
, 
STMT_INDICATOR_IGNORE
, 5);

435 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS bulk6");

436 
	`check_mysql_rc
(
rc
, 
mysql
);

438 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE bulk6 (a int, b int default 4)");

439 
	`check_mysql_rc
(
rc
, 
mysql
);

441 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTO bulk6 VALUES (1,1), (2,2), (3,3), (4,4), (5,5)");

442 
	`check_mysql_rc
(
rc
, 
mysql
);

445 
	`mem£t
(
bšd
, 0, (
MYSQL_BIND
) * 3);

448 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("UPDATE bulk6 SET‡=?, b=? WHERE‡=?"));

449 
	`check_¡mt_rc
(
rc
, 
¡mt
);

451 
bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

452 
bšd
[0].
bufãr
ð&
štv®
;

453 
bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

454 
bšd
[1].
bufãr
ð&
štv®
;

455 
bšd
[1].
u
.
šdiÿtÜ
= indicator;

456 
bšd
[2].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

457 
bšd
[2].
bufãr
ð&
id
;

459 
rc
ð
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_ARRAY_SIZE
, &
¬¿y_size
);

460 
	`check_¡mt_rc
(
rc
, 
¡mt
);

462 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
bšd
);

463 
	`check_¡mt_rc
(
rc
, 
¡mt
);

465 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

466 
	`check_¡mt_rc
(
rc
, 
¡mt
);

468 
	`mysql_¡mt_þo£
(
¡mt
);

470 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT * FROM bulk6 WHERE‡=b+11");

471 
	`check_mysql_rc
(
rc
, 
mysql
);

473 
»s
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

474 
rows
ð()
	`mysql_num_rows
(
»s
);

475 
	`mysql_ä“_»suÉ
(
»s
);

477 
	`FAIL_IF
(
rows
 != 5, "expected 5„ows");

480 
rc
ð
	`mysql_qu”y
(
mysql
, "DELETE FROM bulk6");

481 
	`check_mysql_rc
(
rc
, 
mysql
);

483 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

484 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("INSERT INTO bulk6 VALUES (?,?)"));

485 
	`check_¡mt_rc
(
rc
, 
¡mt
);

487 
rc
ð
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_ARRAY_SIZE
, &
¬¿y_size
);

488 
	`check_¡mt_rc
(
rc
, 
¡mt
);

491 
	`mem£t
(
šdiÿtÜ
, 
STMT_INDICATOR_DEFAULT
, 5);

492 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
bšd
);

493 
	`check_¡mt_rc
(
rc
, 
¡mt
);

494 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

495 
	`check_¡mt_rc
(
rc
, 
¡mt
);

498 
	`mem£t
(
šdiÿtÜ
, 
STMT_INDICATOR_IGNORE
, 5);

499 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

500 
	`check_¡mt_rc
(
rc
, 
¡mt
);

502 
	`mysql_¡mt_þo£
(
¡mt
);

504 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT * FROM bulk6 WHERE b=4");

505 
	`check_mysql_rc
(
rc
, 
mysql
);

507 
»s
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

508 
rows
ð()
	`mysql_num_rows
(
»s
);

509 
	`mysql_ä“_»suÉ
(
»s
);

511 
	`FAIL_IF
(
rows
 != 10, "expected 10„ows");

512 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS bulk6");

513 
	`check_mysql_rc
(
rc
, 
mysql
);

515  
OK
;

516 
	}
}

518 
	$‹¡_cÚc243
(
MYSQL
 *
mysql
)

520 
MYSQL_STMT
 *
¡mt
;

521 
MYSQL_BIND
 
bšd
[3];

522 
MYSQL_RES
 *
»suÉ
;

523 
MYSQL_ROW
 
row
;

525 
	s¡_d©a
 {

526 
id
;

527 
id_šd
;

528 
fÜ’ame
[30];

529 
fÜ’ame_šd
;

530 
suºame
[30];

531 
suºame_šd
;

534 
¡_d©a
 
d©a
[]= {

535 {0, 
STMT_INDICATOR_NULL
, "MÚty", 
STMT_INDICATOR_NTS
, "Widenius", STMT_INDICATOR_NTS},

536 {0, 
STMT_INDICATOR_NULL
, "David", 
STMT_INDICATOR_NTS
, "Axmark", STMT_INDICATOR_NTS},

537 {0, 
STMT_INDICATOR_NULL
, "deçuÉ", 
STMT_INDICATOR_DEFAULT
, "N.N.", 
STMT_INDICATOR_NTS
},

540 
¬¿y_size
= 1;

541 
size_t
 
row_size
ð(
¡_d©a
);

542 
rc
;

544 ià(!
bulk_’abËd
)

545  
SKIP
;

546 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS bulk_example2");

547 
	`check_mysql_rc
(
rc
, 
mysql
);

549 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE bulk_example2 (id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,"\

551 
	`check_mysql_rc
(
rc
, 
mysql
);

553 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

554 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("INSERT INTO bulk_example2 VALUES (?,?,?)"));

555 
	`check_¡mt_rc
(
rc
, 
¡mt
);

557 
	`mem£t
(
bšd
, 0, (
MYSQL_BIND
) * 3);

560 
bšd
[0].
u
.
šdiÿtÜ
ð&
d©a
[0].
id_šd
;

561 
bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

563 
bšd
[1].
bufãr
ð&
d©a
[0].
fÜ’ame
;

564 
bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

565 
bšd
[1].
u
.
šdiÿtÜ
ð&
d©a
[0].
fÜ’ame_šd
;

567 
bšd
[2].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

568 
bšd
[2].
bufãr
ð&
d©a
[0].
suºame
;

569 
bšd
[2].
u
.
šdiÿtÜ
ð&
d©a
[0].
suºame_šd
;

572 
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_ARRAY_SIZE
, &
¬¿y_size
);

575 
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_ROW_SIZE
, &
row_size
);

578 
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
bšd
);

581 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

582 
	`check_¡mt_rc
(
rc
, 
¡mt
);

584 
	`mysql_¡mt_þo£
(
¡mt
);

586 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT forename, surname FROM bulk_example2");

587 
	`check_mysql_rc
(
rc
, 
mysql
);

589 
»suÉ
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

590 
	`FAIL_IF
(!
»suÉ
 || !
	`mysql_num_rows
(result), "Invalid„esultset");

591 
row
 = 
	`mysql_ãtch_row
(
»suÉ
);

592 ià(
	`¡rcmp
(
row
[0], "Monty") || strcmp(row[1], "Widenius"))

594 
	`mysql_ä“_»suÉ
(
»suÉ
);

595 
	`dŸg
("Wrong values");

596  
FAIL
;

598 
	`mysql_ä“_»suÉ
(
»suÉ
);

599 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE bulk_example2");

600 
	`check_mysql_rc
(
rc
, 
mysql
);

601  
OK
;

602 
	}
}

603 
	$bulk7
(
MYSQL
 *
mysql
)

605 
MYSQL_STMT
 *
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

606 
rc
;

607 
¬¿y_size
= 5;

609 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

610 
	`check_mysql_rc
(
rc
, 
mysql
);

611 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE1 (a int)");

612 
	`check_mysql_rc
(
rc
, 
mysql
);

613 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTO1 VALUES (1)");

614 
	`check_mysql_rc
(
rc
, 
mysql
);

616 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("UPDATE1 SET‡=a+1"));

617 
	`check_¡mt_rc
(
rc
, 
¡mt
);

619 
rc
ð
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_ARRAY_SIZE
, &
¬¿y_size
);

620 
	`check_¡mt_rc
(
rc
, 
¡mt
);

621 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

623 
	`FAIL_IF
(!
rc
, "Errorƒxpected: Bulk operation without…arameters is‚ot supported");

624 
	`dŸg
("%s", 
	`mysql_¡mt_”rÜ
(
¡mt
));

626 
	`mysql_¡mt_þo£
(
¡mt
);

627 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE1");

628 
	`check_mysql_rc
(
rc
, 
mysql
);

630  
OK
;

631 
	}
}

633 
	$‹¡_ch¬_cÚv1
(
MYSQL
 *
mysql
)

635 
MYSQL_STMT
 *
¡mt
;

636 
rc
;

637 
MYSQL_BIND
 
bšd_š
, 
bšd_out
;

638 
bufãr
[100];

639 
outbufãr
[100];

641 ià(!
bulk_’abËd
)

642  
SKIP
;

643 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

644 
	`¡rýy
 (
bufãr
, "\xC3\x82\xC3\x83\xC3\x84\x00");

646 
rc
ð
	`mysql_qu”y
(
mysql
, "SET NAMES UTF8");

647 
	`check_mysql_rc
(
rc
, 
mysql
);

648 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS char_conv");

649 
	`check_mysql_rc
(
rc
, 
mysql
);

650 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE char_conv (a varchar(20)) CHARSET=latin1");

651 
	`check_mysql_rc
(
rc
, 
mysql
);

653 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("INSERT INTO char_conv VALUES (?)"));

654 
	`check_¡mt_rc
(
rc
, 
¡mt
);

656 
	`mem£t
(&
bšd_š
, 0, (
MYSQL_BIND
));

657 
bšd_š
.
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

658 
bšd_š
.
bufãr_Ëngth
= -1;

659 
bšd_š
.
bufãr
= &buffer;

661 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, &
bšd_š
);

662 
	`check_¡mt_rc
(
rc
, 
¡mt
);

664 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

665 
	`check_¡mt_rc
(
rc
, 
¡mt
);

667 
	`mysql_¡mt_þo£
(
¡mt
);

669 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

671 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("SELECT‡ from char_conv"));

672 
	`check_¡mt_rc
(
rc
, 
¡mt
);

674 
	`mem£t
(&
bšd_out
, 0, (
MYSQL_BIND
));

675 
bšd_out
.
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

676 
bšd_out
.
bufãr_Ëngth
= 100;

677 
bšd_out
.
bufãr
ð
outbufãr
;

679 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, &
bšd_out
);

680 
	`check_¡mt_rc
(
rc
, 
¡mt
);

682 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

683 
	`check_¡mt_rc
(
rc
, 
¡mt
);

685 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

686 
	`FAIL_IF
(
rc
 =ð
MYSQL_NO_DATA
, "Error");

688 
	`mysql_¡mt_þo£
(
¡mt
);

691 ià(
	`¡rcmp
(
bufãr
, 
outbufãr
))

693 
	`dŸg
("E¼Ü: Ex³ùed '%s' in¡—d oà'%s'", 
bufãr
, 
outbufãr
);

694  
FAIL
;

697 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE char_conv");

698 
	`check_mysql_rc
(
rc
, 
mysql
);

700  
OK
;

701 
	}
}

704 
	$‹¡_ch¬_cÚv2
(
MYSQL
 *
mysql
)

706 
MYSQL_STMT
 *
¡mt
;

707 
rc
;

708 
¬¿y_size
= 1;

709 
MYSQL_BIND
 
bšd_š
, 
bšd_out
;

710 *
bufãr
[1];

711 
outbufãr
[100];

713 ià(!
bulk_’abËd
)

714  
SKIP
;

716 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

717 
bufãr
[0]ð
	`ÿÎoc
(1, 7);

718 
	`¡rýy
 (
bufãr
[0], "\xC3\x82\xC3\x83\xC3\x84\x00");

720 
rc
ð
	`mysql_qu”y
(
mysql
, "SET NAMES UTF8");

721 
	`check_mysql_rc
(
rc
, 
mysql
);

722 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS char_conv");

723 
	`check_mysql_rc
(
rc
, 
mysql
);

724 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE char_conv (a varchar(20)) CHARSET=latin1");

725 
	`check_mysql_rc
(
rc
, 
mysql
);

727 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("INSERT INTO char_conv VALUES (?)"));

728 
	`check_¡mt_rc
(
rc
, 
¡mt
);

730 
rc
ð
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_ARRAY_SIZE
, &
¬¿y_size
);

731 
	`check_¡mt_rc
(
rc
, 
¡mt
);

733 
	`mem£t
(&
bšd_š
, 0, (
MYSQL_BIND
));

734 
bšd_š
.
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

735 
bšd_š
.
bufãr_Ëngth
= -1;

736 
bšd_š
.
bufãr
= &buffer;

738 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, &
bšd_š
);

739 
	`check_¡mt_rc
(
rc
, 
¡mt
);

741 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

742 
	`check_¡mt_rc
(
rc
, 
¡mt
);

744 
	`mysql_¡mt_þo£
(
¡mt
);

746 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

748 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("SELECT‡ from char_conv"));

749 
	`check_¡mt_rc
(
rc
, 
¡mt
);

751 
	`mem£t
(&
bšd_out
, 0, (
MYSQL_BIND
));

752 
bšd_out
.
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

753 
bšd_out
.
bufãr_Ëngth
= 100;

754 
bšd_out
.
bufãr
ð
outbufãr
;

756 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, &
bšd_out
);

757 
	`check_¡mt_rc
(
rc
, 
¡mt
);

759 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

760 
	`check_¡mt_rc
(
rc
, 
¡mt
);

762 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

763 
	`FAIL_IF
(
rc
 =ð
MYSQL_NO_DATA
, "Error");

765 
	`mysql_¡mt_þo£
(
¡mt
);

768 ià(
	`¡rcmp
(
bufãr
[0], 
outbufãr
))

770 
	`dŸg
("E¼Ü: Ex³ùed '%s' in¡—d oà'%s'", 
bufãr
[0], 
outbufãr
);

771  
FAIL
;

773 
	`ä“
(
bufãr
[0]);

775 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE char_conv");

776 
	`check_mysql_rc
(
rc
, 
mysql
);

778  
OK
;

779 
	}
}

782 
	$bulk_sk_row
(
MYSQL
 *
mysql
)

784 
MYSQL_STMT
 *
¡mt
;

785 
MYSQL_BIND
 
bšd
[3];

786 
MYSQL_RES
 *
»suÉ
;

787 
MYSQL_ROW
 
row
;

789 
	s¡_d©a
 {

790 
id
;

791 
id_šd
;

792 
fÜ’ame
[30];

793 
fÜ’ame_šd
;

794 
suºame
[30];

795 
suºame_šd
;

798 
¡_d©a
 
d©a
[]={

799 { 0, 
STMT_INDICATOR_NULL
, "MÚty", 
STMT_INDICATOR_NTS
, "Wid’ius", 
STMT_INDICATOR_IGNORE_ROW
 },

800 { 0, 
STMT_INDICATOR_IGNORE_ROW
, "David", 
STMT_INDICATOR_NTS
, "Axmark", STMT_INDICATOR_NTS },

801 { 0, 
STMT_INDICATOR_NULL
, "deçuÉ", 
STMT_INDICATOR_DEFAULT
, "N.N.", 
STMT_INDICATOR_NTS
 },

804 
¬¿y_size
= 3;

805 
size_t
 
row_size
ð(
¡_d©a
);

806 
rc
;

808 ià(!
bulk_’abËd
)

809  
SKIP
;

810 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS bulk_example2");

811 
	`check_mysql_rc
(
rc
, 
mysql
);

813 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE bulk_example2 (id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,"\

815 
	`check_mysql_rc
(
rc
, 
mysql
);

817 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

818 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("INSERT INTO bulk_example2 VALUES (?,?,?)"));

819 
	`check_¡mt_rc
(
rc
, 
¡mt
);

821 
	`mem£t
(
bšd
, 0, (
MYSQL_BIND
) * 3);

824 
bšd
[0].
u
.
šdiÿtÜ
ð&
d©a
[0].
id_šd
;

825 
bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

827 
bšd
[1].
bufãr
ð&
d©a
[0].
fÜ’ame
;

828 
bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

829 
bšd
[1].
u
.
šdiÿtÜ
ð&
d©a
[0].
fÜ’ame_šd
;

831 
bšd
[2].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

832 
bšd
[2].
bufãr
ð&
d©a
[0].
suºame
;

833 
bšd
[2].
u
.
šdiÿtÜ
ð&
d©a
[0].
suºame_šd
;

836 
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_ARRAY_SIZE
, &
¬¿y_size
);

839 
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_ROW_SIZE
, &
row_size
);

842 
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
bšd
);

845 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

846 
	`check_¡mt_rc
(
rc
, 
¡mt
);

848 
	`mysql_¡mt_þo£
(
¡mt
);

850 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT forename, surname FROM bulk_example2");

851 
	`check_mysql_rc
(
rc
, 
mysql
);

853 
»suÉ
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

854 
	`FAIL_IF
(!
»suÉ
 || 
	`mysql_num_rows
(result) != 1, "Invalid„esultset");

856 
row
 = 
	`mysql_ãtch_row
(
»suÉ
);

857 ià(
	`¡rcmp
(
row
[0], "unknown") || strcmp(row[1], "N.N."))

859 
	`mysql_ä“_»suÉ
(
»suÉ
);

860 
	`dŸg
("Wrong values");

861  
FAIL
;

863 
	`mysql_ä“_»suÉ
(
»suÉ
);

864 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE bulk_example2");

865 
	`check_mysql_rc
(
rc
, 
mysql
);

866  
OK
;

867 
	}
}

869 
	$bulk_nuÎ_nuÎ
(
MYSQL
 *
mysql
)

871 
	s¡_bulk4
 {

872 
ch¬_v®ue
[20];

873 
šdiÿtÜ1
;

874 
št_v®ue
;

875 
šdiÿtÜ2
;

876 
doubË_v®ue
;

877 
šdiÿtÜ3
;

878 
time_v®ue
[20];

879 
šdiÿtÜ4
;

880 
decim®_v®ue
[4];

881 
šdiÿtÜ5
;

884 
¡_bulk4
 
v®
[]ð{{"3", 
STMT_INDICATOR_NTS
,

885 3, 
STMT_INDICATOR_NONE
,

886 3.0, 
STMT_INDICATOR_NONE
,

887 "00:00:00", 
STMT_INDICATOR_NTS
,

888 "3.0", 
STMT_INDICATOR_NTS
},

889 {"3", 
STMT_INDICATOR_NULL
,

890 3, 
STMT_INDICATOR_NULL
,

891 3.0, 
STMT_INDICATOR_NULL
,

892 "00:00:00", 
STMT_INDICATOR_NULL
,

893 "3.0", 
STMT_INDICATOR_NULL
},

894 {"3", 
STMT_INDICATOR_NTS
,

895 3, 
STMT_INDICATOR_NONE
,

896 3.0, 
STMT_INDICATOR_NONE
,

897 "00:00:00", 
STMT_INDICATOR_NTS
,

898 "3.0", 
STMT_INDICATOR_NTS
}};

899 
rc
;

900 
MYSQL_BIND
 
bšd
[5];

901 
MYSQL_RES
 *
»s
;

902 
MYSQL_STMT
 *
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

903 
size_t
 
row_size
ð(
¡_bulk4
);

904 
¬¿y_size
= 3;

905 
£rv”_v”siÚ
ð
	`mysql_g‘_£rv”_v”siÚ
(
mysql
);

906 
Ëngths
[3]= {-1, -1, -1};

908 ià(!
bulk_’abËd
)

909  
SKIP
;

911 ià(
£rv”_v”siÚ
 > 100300 &&

912 
£rv”_v”siÚ
 < 100305)

913  
SKIP
;

915 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS bulk_null");

916 
	`check_mysql_rc
(
rc
,
mysql
);

917 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE bulk_null "

923 
	`check_mysql_rc
(
rc
,
mysql
);

925 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, "INSERT INTO bulk_null VALUES (?,?,?,?,?)", -1);

926 
	`check_¡mt_rc
(
rc
, 
¡mt
);

928 
	`mem£t
(
bšd
, 0, (
MYSQL_BIND
)*2);

930 
rc
ð
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_ARRAY_SIZE
, &
¬¿y_size
);

931 
	`check_¡mt_rc
(
rc
, 
¡mt
);

932 
rc
ð
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_ROW_SIZE
, &
row_size
);

933 
	`check_¡mt_rc
(
rc
, 
¡mt
);

935 
bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

936 
bšd
[0].
u
.
šdiÿtÜ
ð&
v®
[0].
šdiÿtÜ1
;

937 
bšd
[0].
bufãr
ð&
v®
[0].
ch¬_v®ue
;

938 
bšd
[0].
Ëngth
ð
Ëngths
;

939 
bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

940 
bšd
[1].
bufãr
ð&
v®
[0].
št_v®ue
;

941 
bšd
[1].
u
.
šdiÿtÜ
ð&
v®
[0].
šdiÿtÜ2
;

942 
bšd
[2].
bufãr_ty³
ð
MYSQL_TYPE_DOUBLE
;

943 
bšd
[2].
bufãr
ð&
v®
[0].
doubË_v®ue
;

944 
bšd
[2].
u
.
šdiÿtÜ
ð&
v®
[0].
šdiÿtÜ3
;

945 
bšd
[3].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

946 
bšd
[3].
u
.
šdiÿtÜ
ð&
v®
[0].
šdiÿtÜ4
;

947 
bšd
[3].
bufãr
ð&
v®
[0].
time_v®ue
;

948 
bšd
[3].
Ëngth
ð
Ëngths
;

949 
bšd
[4].
bufãr_ty³
ð
MYSQL_TYPE_NEWDECIMAL
;

950 
bšd
[4].
u
.
šdiÿtÜ
ð&
v®
[0].
šdiÿtÜ5
;

951 
bšd
[4].
bufãr
ð&
v®
[0].
decim®_v®ue
;

952 
bšd
[4].
Ëngth
ð
Ëngths
;

954 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
bšd
);

955 
	`check_¡mt_rc
(
rc
, 
¡mt
);

956 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

957 
	`check_¡mt_rc
(
rc
, 
¡mt
);

959 
	`mysql_¡mt_þo£
(
¡mt
);

961 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT * FROM bulk_null WHERE s='3'");

962 
	`check_mysql_rc
(
rc
, 
mysql
);

963 
»s
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

964 
rc
ð()
	`mysql_num_rows
(
»s
);

965 
	`mysql_ä“_»suÉ
(
»s
);

966 
	`FAIL_IF
(
rc
 != 2, "expected 2„ows");

968 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT * FROM bulk_null WHERE i=3");

969 
	`check_mysql_rc
(
rc
, 
mysql
);

970 
»s
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

971 
rc
ð()
	`mysql_num_rows
(
»s
);

972 
	`mysql_ä“_»suÉ
(
»s
);

973 
	`FAIL_IF
(
rc
 != 2, "expected 2„ows");

975 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT * FROM bulk_null WHERE d=3.0");

976 
	`check_mysql_rc
(
rc
, 
mysql
);

977 
»s
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

978 
rc
ð()
	`mysql_num_rows
(
»s
);

979 
	`mysql_ä“_»suÉ
(
»s
);

980 
	`FAIL_IF
(
rc
 != 2, "expected 2„ows");

982 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT * FROM bulk_null WHERE='00:00:00'");

983 
	`check_mysql_rc
(
rc
, 
mysql
);

984 
»s
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

985 
rc
ð()
	`mysql_num_rows
(
»s
);

986 
	`mysql_ä“_»suÉ
(
»s
);

987 
	`FAIL_IF
(
rc
 != 2, "expected 2„ows");

989 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT * FROM bulk_null WHERE c=3.0");

990 
	`check_mysql_rc
(
rc
, 
mysql
);

991 
»s
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

992 
rc
ð()
	`mysql_num_rows
(
»s
);

993 
	`mysql_ä“_»suÉ
(
»s
);

994 
	`FAIL_IF
(
rc
 != 2, "expected 2„ows");

996 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE bulk_null");

997 
	`check_mysql_rc
(
rc
, 
mysql
);

998  
OK
;

999 
	}
}

1001 
	$‹¡_mdev16593
(
MYSQL
 *
mysql
)

1003 
i
;

1004 
rc
;

1005 
MYSQL_BIND
 
bšd
[2];

1006 
¬¿y_size
= 2;

1007 
v®_a
[2]= {1,2};

1008 
šdiÿtÜs
[2]ð{
STMT_INDICATOR_NULL
, STMT_INDICATOR_NULL};

1009 cÚ¡ *
‹¡ÿ£
[]= {"MYSQL_TYPE_LONG", "MYSQL_TYPE_NULL", "STMT_INDICATOR_NULL"};

1011 
	`dŸg
("waiting for server fix");

1012  
SKIP
;

1014 
i
=0; i < 3; i++)

1016 
MYSQL_RES
 *
»s
;

1017 
MYSQL_ROW
 
row
;

1018 
MYSQL_STMT
 *
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

1019 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE OR REPLACE TABLE1 (a int‚ot‚ull‡uto_increment…rimary key, b int)");

1020 
	`check_mysql_rc
(
rc
, 
mysql
);

1022 
	`mem£t
(&
bšd
, 0, (
MYSQL_BIND
));

1023 
i
) {

1025 
bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

1028 
bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_NULL
;

1031 
bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

1032 
bšd
[0].
u
.
šdiÿtÜ
ð
šdiÿtÜs
;

1035 
bšd
[0].
bufãr
ð
v®_a
;

1036 
bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

1037 
bšd
[1].
bufãr
ð
v®_a
;

1039 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("insert into1 values(?,?)"));

1040 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1042 
rc
ð
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_ARRAY_SIZE
, &
¬¿y_size
);

1043 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1045 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
bšd
);

1046 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1048 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1049 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1051 
rc
ð
	`mysql_qu”y
(
mysql
, "COMMIT");

1052 
	`check_mysql_rc
(
rc
, 
mysql
);

1054 
	`dŸg
("Insert id with buffer_type %s: %lld",

1055 
‹¡ÿ£
[
i
],

1056 
	`mysql_¡mt_š£¹_id
(
¡mt
));

1058 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT max(a) FROM1");

1059 
	`check_mysql_rc
(
rc
, 
mysql
);

1061 
»s
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

1062 
row
ð
	`mysql_ãtch_row
(
»s
);

1063 
	`dŸg
("Max v®ufÜ1.a=%s", 
row
[0]);

1064 
	`mysql_ä“_»suÉ
(
»s
);

1066 
	`mysql_¡mt_þo£
(
¡mt
);

1068  
OK
;

1069 
	}
}

1071 
my_‹¡s_¡
 
	gmy_‹¡s
[] = {

1072 {"check_bulk", 
check_bulk
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1073 {"‹¡_mdev16593", 
‹¡_mdev16593
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1074 {"bulk_nuÎ_nuÎ", 
bulk_nuÎ_nuÎ
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1075 {"‹¡_ch¬_cÚv1", 
‹¡_ch¬_cÚv1
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1076 {"‹¡_ch¬_cÚv2", 
‹¡_ch¬_cÚv2
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1077 {"‹¡_cÚc243", 
‹¡_cÚc243
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1078 {"upd©e_no_·¿m", 
bulk7
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1079 {"bulk5", 
bulk5
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1080 {"bulk6", 
bulk6
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1081 {"bulk1", 
bulk1
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1082 {"bulk2", 
bulk2
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1083 {"bulk3", 
bulk3
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1084 {"bulk4", 
bulk4
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1085 {"bulk_nuÎ", 
bulk_nuÎ
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1086 {"bulk_sk_row", 
bulk_sk_row
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1087 {
NULL
, NULL, 0, 0, NULL, NULL}

1090 
	$maš
(
¬gc
, **
¬gv
)

1092 ià(
¬gc
 > 1)

1093 
	`g‘_ÝtiÚs
(
¬gc
, 
¬gv
);

1095 
	`g‘_’vv¬s
();

1097 
	`run_‹¡s
(
my_‹¡s
);

1099 (
	`ex™_¡©us
());

1100 
	}
}

	@unittest/libmariadb/charset.c

25 
	~"my_‹¡.h
"

35 
	#TEST_BUG8378_IN
 "\xef\xbb\xbf\x27\xbf\x10"

	)

36 
	#TEST_BUG8378_OUT
 "\xef\xbb\x5c\xbf\x5c\x27\x5c\xbf\x10"

	)

39 
my_ÝtiÚ_¡
 
	gÝt_bug8378
[] = {

40 {
MYSQL_SET_CHARSET_NAME
, (*) "gbk"},

41 {0, 
NULL
}

44 
	$bug_8378
(
MYSQL
 *
mysql
) {

45 
rc
, 
Ën
;

46 
out
[9], 
buf
[256];

47 
MYSQL_RES
 *
»s
;

48 
MYSQL_ROW
 
row
;

50 
Ën
ð
	`mysql_»®_esÿ³_¡ršg
(
mysql
, 
out
, 
TEST_BUG8378_IN
, 4);

51 
	`FAIL_IF
(
	`memcmp
(
out
, 
TEST_BUG8378_OUT
, 
Ën
), "wrong„esult");

53 
	`¥rštf
(
buf
, "SELECT '%s' FROM DUAL", 
TEST_BUG8378_OUT
);

55 
rc
ð
	`mysql_qu”y
(
mysql
, 
buf
);

56 
	`check_mysql_rc
(
rc
, 
mysql
);

58 ià((
»s
ð
	`mysql_¡Üe_»suÉ
(
mysql
))) {

59 
row
ð
	`mysql_ãtch_row
(
»s
);

60 ià(
	`memcmp
(
row
[0], 
TEST_BUG8378_IN
, 4)) {

61 
	`mysql_ä“_»suÉ
(
»s
);

62  
FAIL
;

64 
	`mysql_ä“_»suÉ
(
»s
);

66  
FAIL
;

68  
OK
;

69 
	}
}

71 
	$‹¡_þ›Á_ch¬aù”_£t
(
MYSQL
 *
mysql
)

73 
MY_CHARSET_INFO
 
cs
;

74 *
c¢ame
= (*) "utf8";

75 *
csdeçuÉ
ð(*)
	`mysql_ch¬aù”_£t_Çme
(
mysql
);

77 
	`FAIL_IF
(
	`mysql_£t_ch¬aù”_£t
(
mysql
, 
c¢ame
), 
	`mysql_”rÜ
(mysql));

79 
	`mysql_g‘_ch¬aù”_£t_šfo
(
mysql
, &
cs
);

81 
	`FAIL_IF
(
	`¡rcmp
(
cs
.
c¢ame
, "utf8"è|| sŒcmp(cs.
Çme
, "utf8_general_ci"), "Character set != UTF8");

82 
	`FAIL_IF
(
	`mysql_£t_ch¬aù”_£t
(
mysql
, 
csdeçuÉ
), 
	`mysql_”rÜ
(mysql));

84  
OK
;

85 
	}
}

93 
	$bug_10214
(
MYSQL
 *
mysql
)

95 
Ën
, 
rc
;

96 
out
[8];

99 
rc
ð
	`mysql_qu”y
(
mysql
, "SET sql_mode=''");

100 
	`check_mysql_rc
(
rc
, 
mysql
);

102 
Ën
ð
	`mysql_»®_esÿ³_¡ršg
(
mysql
, 
out
, "a'b\\c", 5);

103 
	`FAIL_IF
(
	`memcmp
(
out
, "a\\'b\\\\c", 
Ën
), "wrong„esult");

105 
rc
ð
	`mysql_qu”y
(
mysql
, "set sql_mode='NO_BACKSLASH_ESCAPES'");

106 
	`check_mysql_rc
(
rc
, 
mysql
);

107 
	`FAIL_IF
(!(
mysql
->
£rv”_¡©us
 & 
SERVER_STATUS_NO_BACKSLASH_ESCAPES
),

110 
Ën
ð
	`mysql_»®_esÿ³_¡ršg
(
mysql
, 
out
, "a'b\\c", 5);

111 
	`FAIL_IF
(
	`memcmp
(
out
, "a''b\\c", 
Ën
), "wrong„esult");

113  
OK
;

114 
	}
}

119 
	$‹¡_esÿpšg
(
MYSQL
 *
mysql
)

121 
i
ð0, 
rc
, 
Ën
;

122 
out
[20];

123 cÚ¡ *
esÿ³_ch¬s
[] = {"'", "\x0", "\n", "\r", "\\", "\0", 
NULL
};

126 
rc
ð
	`mysql_qu”y
(
mysql
, "SET sql_mode=''");

127 
	`check_mysql_rc
(
rc
, 
mysql
);

129 
esÿ³_ch¬s
[
i
]) {

130 
Ën
ð
	`mysql_»®_esÿ³_¡ršg
(
mysql
, 
out
, 
esÿ³_ch¬s
[
i
], 1);

131 
	`FAIL_IF
(
Ën
 < 2, "Len < 2");

132 
i
++;

135  
OK
;

136 
	}
}

141 
	$bug_41785
(
MYSQL
 *
mysql
)

143 
out
[10];

144 
rc
, 
Ën
;

146 
Ën
ð
	`mysql_»®_esÿ³_¡ršg
(
mysql
, 
out
, "\\", 1);

147 
	`FAIL_IF
(
Ën
 != 2, "len != 2");

149 
rc
ð
	`mysql_qu”y
(
mysql
, "SET SQL_MODE=NO_BACKSLASH_ESCAPES");

150 
	`check_mysql_rc
(
rc
, 
mysql
);

151 
rc
ð
	`mysql_qu”y
(
mysql
, "SET sql_mode=''");

152 
	`check_mysql_rc
(
rc
, 
mysql
);

154 
	`mysql_chªge_u£r
(
mysql
, "root", "", "test");

156 
Ën
ð
	`mysql_»®_esÿ³_¡ršg
(
mysql
, 
out
, "\\", 1);

157 
	`FAIL_IF
(
Ën
 != 2, "len != 2");

159  
OK
;

160 
	}
}

162 
	$‹¡_cÚv”siÚ
(
MYSQL
 *
mysql
)

164 
MYSQL_STMT
 *
¡mt
;

165 cÚ¡ *
¡mt_‹xt
;

166 
rc
;

167 
MYSQL_BIND
 
my_bšd
[1];

168 
uch¬
 
buff
[4];

169 
ulÚg
 
Ëngth
;

171 
¡mt_‹xt
= "DROP TABLE IF EXISTS1";

172 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

173 
	`check_mysql_rc
(
rc
, 
mysql
);

174 
¡mt_‹xt
= "CREATE TABLE1 (a TEXT) DEFAULT CHARSET†atin1";

175 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

176 
	`check_mysql_rc
(
rc
, 
mysql
);

177 
¡mt_‹xt
= "SET character_set_connection=utf8, character_set_client=utf8, "

179 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

180 
	`check_mysql_rc
(
rc
, 
mysql
);

182 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

183 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

184 
¡mt_‹xt
= "INSERT INTO1 (a) VALUES (?)";

185 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

186 
	`check_¡mt_rc
(
rc
, 
¡mt
);

188 
	`mem£t
(
my_bšd
, '\0', (my_bind));

189 
my_bšd
[0].
bufãr
ð(*è
buff
;

190 
my_bšd
[0].
Ëngth
= &length;

191 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

193 
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

195 
buff
[0]ð(
uch¬
) 0xC3;

196 
buff
[1]ð(
uch¬
) 0xA0;

197 
Ëngth
= 2;

199 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

200 
	`check_¡mt_rc
(
rc
, 
¡mt
);

202 
¡mt_‹xt
= "SELECT‡ FROM1";

203 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

204 
	`check_¡mt_rc
(
rc
, 
¡mt
);

205 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

206 
	`check_¡mt_rc
(
rc
, 
¡mt
);

208 
my_bšd
[0].
bufãr_Ëngth
ð(
buff
);

209 
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

211 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

212 
	`check_¡mt_rc
(
rc
, 
¡mt
);

213 
	`FAIL_UNLESS
(
Ëngth
 == 1, "length != 1");

214 
	`FAIL_UNLESS
(
buff
[0] == 0xE0, "buff[0] != 0xE0");

215 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

216 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

218 
	`mysql_¡mt_þo£
(
¡mt
);

219 
¡mt_‹xt
= "DROP TABLE1";

220 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

221 
	`check_mysql_rc
(
rc
, 
mysql
);

222 
¡mt_‹xt
= "SET NAMES DEFAULT";

223 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

224 
	`check_mysql_rc
(
rc
, 
mysql
);

226  
OK
;

227 
	}
}

229 
	$‹¡_bug27876
(
MYSQL
 *
mysql
)

231 
rc
;

232 
MYSQL_RES
 *
»suÉ
;

234 
uch¬
 
utf8_func
[] =

242 
uch¬
 
utf8_·¿m
[] =

251 
qu”y
[500];

253 
rc
ð
	`mysql_qu”y
(
mysql
, "set‚ames utf8");

254 
	`check_mysql_rc
(
rc
, 
mysql
);

256 
rc
ð
	`mysql_qu”y
(
mysql
, "select version()");

257 
	`check_mysql_rc
(
rc
, 
mysql
);

258 
»suÉ
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

259 
	`FAIL_IF
(!
»suÉ
, "Invalid„esult set");

260 
	`mysql_ä“_»suÉ
(
»suÉ
);

262 
	`¥rštf
(
qu”y
, "DROP FUNCTION IF EXISTS %s", (*è
utf8_func
);

263 
rc
ð
	`mysql_qu”y
(
mysql
, 
qu”y
);

264 
	`check_mysql_rc
(
rc
, 
mysql
);

266 
	`¥rštf
(
qu”y
,

269 (*è
utf8_func
, (*è
utf8_·¿m
, (*) utf8_param);

270 
rc
ð
	`mysql_qu”y
(
mysql
, 
qu”y
);

271 
	`check_mysql_rc
(
rc
, 
mysql
);

272 
	`¥rštf
(
qu”y
, "SELECT %s(VERSION())", (*è
utf8_func
);

273 
rc
ð
	`mysql_qu”y
(
mysql
, 
qu”y
);

274 
	`check_mysql_rc
(
rc
, 
mysql
);

275 
»suÉ
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

276 
	`FAIL_IF
(!
»suÉ
, "Invalid„esult set");

277 
	`mysql_ä“_»suÉ
(
»suÉ
);

279 
	`¥rštf
(
qu”y
, "DROP FUNCTION %s", (*è
utf8_func
);

280 
rc
ð
	`mysql_qu”y
(
mysql
, 
qu”y
);

281 
	`check_mysql_rc
(
rc
, 
mysql
);

283 
rc
ð
	`mysql_qu”y
(
mysql
, "set‚ames default");

284 
	`check_mysql_rc
(
rc
, 
mysql
);

285  
OK
;

286 
	}
}

288 
	$‹¡_ps_i18n
(
MYSQL
 *
mysql
)

290 
MYSQL_STMT
 *
¡mt
;

291 
rc
;

292 cÚ¡ *
¡mt_‹xt
;

293 
MYSQL_BIND
 
bšd_¬¿y
[2];

296 cÚ¡ *
koi8
= "\xee\xd5\x2c\x20\xda\xc1\x20\xd2\xd9\xc2\xc1\xcc\xcb\xd5";

297 cÚ¡ *
ý1251
= "\xcd\xf3\x2c\x20\xe7\xe0\x20\xf0\xfb\xe1\xe0\xeb\xea\xf3";

298 
buf1
[16], 
buf2
[16];

299 
ulÚg
 
buf1_Ën
, 
buf2_Ën
;

301 
¡mt_‹xt
= "DROP TABLE IF EXISTS1";

302 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

303 
	`check_mysql_rc
(
rc
, 
mysql
);

311 
¡mt_‹xt
= "CREATE TABLE1 (c1 VARBINARY(255), c2 VARBINARY(255))";

312 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

313 
	`check_mysql_rc
(
rc
, 
mysql
);

315 
¡mt_‹xt
= "SET CHARACTER_SET_CLIENT=koi8r, "

319 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

320 
	`check_mysql_rc
(
rc
, 
mysql
);

322 
	`mem£t
(
bšd_¬¿y
, '\0', (bind_array));

323 
bšd_¬¿y
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

324 
bšd_¬¿y
[0].
bufãr
ð(*è
koi8
;

325 
bšd_¬¿y
[0].
bufãr_Ëngth
ð()
	`¡¾’
(
koi8
);

327 
bšd_¬¿y
[1].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

328 
bšd_¬¿y
[1].
bufãr
ð(*è
koi8
;

329 
bšd_¬¿y
[1].
bufãr_Ëngth
ð()
	`¡¾’
(
koi8
);

331 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

332 
	`check_¡mt_rc
(
rc
, 
¡mt
);

334 
¡mt_‹xt
= "INSERT INTO1 (c1, c2) VALUES (?, ?)";

336 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

337 
	`check_¡mt_rc
(
rc
, 
¡mt
);

338 
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
bšd_¬¿y
);

339 
	`check_¡mt_rc
(
rc
, 
¡mt
);

343 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

344 
	`check_¡mt_rc
(
rc
, 
¡mt
);

345 
¡mt_‹xt
= "SELECT c1, c2 FROM1";

348 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

349 
	`check_¡mt_rc
(
rc
, 
¡mt
);

350 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

351 
	`check_¡mt_rc
(
rc
, 
¡mt
);

352 
bšd_¬¿y
[0].
bufãr
ð
buf1
;

353 
bšd_¬¿y
[0].
bufãr_Ëngth
ð(
buf1
);

354 
bšd_¬¿y
[0].
Ëngth
ð&
buf1_Ën
;

356 
bšd_¬¿y
[1].
bufãr
ð
buf2
;

357 
bšd_¬¿y
[1].
bufãr_Ëngth
ð(
buf2
);

358 
bšd_¬¿y
[1].
Ëngth
ð&
buf2_Ën
;

360 
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
bšd_¬¿y
);

362 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

363 
	`check_¡mt_rc
(
rc
, 
¡mt
);

364 
	`FAIL_UNLESS
(
buf1_Ën
 =ð
	`¡¾’
(
ý1251
), "buf1_len != strlen(cp1251)");

365 
	`FAIL_UNLESS
(
buf2_Ën
 =ð
	`¡¾’
(
ý1251
), "buf2_len != strlen(cp1251)");

366 
	`FAIL_UNLESS
(!
	`memcmp
(
buf1
, 
ý1251
, 
buf1_Ën
), "buf1 != cp1251");

367 
	`FAIL_UNLESS
(!
	`memcmp
(
buf2
, 
ý1251
, 
buf1_Ën
), "buf2 != cp1251");

369 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

370 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

372 
¡mt_‹xt
= "DROP TABLE IF EXISTS1";

373 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

374 
	`check_mysql_rc
(
rc
, 
mysql
);

383 
¡mt_‹xt
= "CREATE TABLE1 (c1 VARCHAR(255) CHARACTER SET cp1251, "

386 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

387 
	`check_mysql_rc
(
rc
, 
mysql
);

389 
¡mt_‹xt
= "INSERT INTO1 (c1, c2) VALUES (?, ?)";

391 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

392 
	`check_¡mt_rc
(
rc
, 
¡mt
);

394 
bšd_¬¿y
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

395 
bšd_¬¿y
[0].
bufãr
ð(*è
koi8
;

396 
bšd_¬¿y
[0].
bufãr_Ëngth
ð()
	`¡¾’
(
koi8
);

398 
bšd_¬¿y
[1].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

399 
bšd_¬¿y
[1].
bufãr
ð(*è
koi8
;

400 
bšd_¬¿y
[1].
bufãr_Ëngth
ð()
	`¡¾’
(
koi8
);

402 
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
bšd_¬¿y
);

406 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

407 
	`check_¡mt_rc
(
rc
, 
¡mt
);

409 
bšd_¬¿y
[0].
bufãr_ty³
ð
MYSQL_TYPE_BLOB
;

410 
bšd_¬¿y
[0].
bufãr
ð(*è
ý1251
;

411 
bšd_¬¿y
[0].
bufãr_Ëngth
ð()
	`¡¾’
(
ý1251
);

413 
bšd_¬¿y
[1].
bufãr_ty³
ð
MYSQL_TYPE_BLOB
;

414 
bšd_¬¿y
[1].
bufãr
ð(*è
ý1251
;

415 
bšd_¬¿y
[1].
bufãr_Ëngth
ð()
	`¡¾’
(
ý1251
);

417 
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
bšd_¬¿y
);

421 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

422 
	`check_¡mt_rc
(
rc
, 
¡mt
);

425 
¡mt_‹xt
= "SELECT c1, c2 FROM1";

428 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

429 
	`check_¡mt_rc
(
rc
, 
¡mt
);

430 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

431 
	`check_¡mt_rc
(
rc
, 
¡mt
);

432 
bšd_¬¿y
[0].
bufãr
ð
buf1
;

433 
bšd_¬¿y
[0].
bufãr_Ëngth
ð(
buf1
);

434 
bšd_¬¿y
[0].
Ëngth
ð&
buf1_Ën
;

436 
bšd_¬¿y
[1].
bufãr
ð
buf2
;

437 
bšd_¬¿y
[1].
bufãr_Ëngth
ð(
buf2
);

438 
bšd_¬¿y
[1].
Ëngth
ð&
buf2_Ën
;

440 
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
bšd_¬¿y
);

442 (
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
)) == 0)

444 
	`FAIL_UNLESS
(
buf1_Ën
 =ð
	`¡¾’
(
koi8
), "buf1_len != strlen(koi8)");

445 
	`FAIL_UNLESS
(
buf2_Ën
 =ð
	`¡¾’
(
koi8
), "buf2_len != strlen(koi8)");

446 
	`FAIL_UNLESS
(!
	`memcmp
(
buf1
, 
koi8
, 
buf1_Ën
), "buf1 != koi8");

447 
	`FAIL_UNLESS
(!
	`memcmp
(
buf2
, 
koi8
, 
buf1_Ën
), "buf2 != koi8");

449 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

450 
	`mysql_¡mt_þo£
(
¡mt
);

452 
¡mt_‹xt
= "DROP TABLE1";

453 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

454 
	`check_mysql_rc
(
rc
, 
mysql
);

455 
¡mt_‹xt
= "SET NAMES DEFAULT";

456 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

457 
	`check_mysql_rc
(
rc
, 
mysql
);

458  
OK
;

459 
	}
}

466 
	$bug30472_»Œ›ve_ch¬£t_šfo
(
MYSQL
 *
cÚ
,

467 *
ch¬aù”_£t_Çme
,

468 *
ch¬aù”_£t_þ›Á
,

469 *
ch¬aù”_£t_»suÉs
,

470 *
cÞÏtiÚ_cÚÃùiÚ
)

472 
MYSQL_RES
 *
rs
;

473 
MYSQL_ROW
 
row
;

474 
rc
;

478 
	`¡rýy
(
ch¬aù”_£t_Çme
, 
	`mysql_ch¬aù”_£t_Çme
(
cÚ
));

482 
rc
ð
	`mysql_qu”y
(
cÚ
, "SHOW VARIABLES LIKE 'character_set_client'");

483 
	`check_mysql_rc
(
rc
, 
cÚ
);

485 
rs
ð
	`mysql_¡Üe_»suÉ
(
cÚ
);

486 
	`FAIL_IF
(!
rs
, "Invalid„esult set");

487 
row
ð
	`mysql_ãtch_row
(
rs
);

488 
	`FAIL_IF
(!
row
, "Couldn't fetch„ow");

489 
	`¡rýy
(
ch¬aù”_£t_þ›Á
, 
row
[1]);

490 
	`mysql_ä“_»suÉ
(
rs
);

492 
rc
ð
	`mysql_qu”y
(
cÚ
, "SHOW VARIABLES LIKE 'character_set_results'");

493 
	`check_mysql_rc
(
rc
, 
cÚ
);

494 
rs
ð
	`mysql_¡Üe_»suÉ
(
cÚ
);

495 
	`FAIL_IF
(!
rs
, "Invalid„esult set");

496 
row
ð
	`mysql_ãtch_row
(
rs
);

497 
	`FAIL_IF
(!
row
, "Couldn't fetch„ow");

498 
	`¡rýy
(
ch¬aù”_£t_»suÉs
, 
row
[1]);

499 
	`mysql_ä“_»suÉ
(
rs
);

501 
rc
ð
	`mysql_qu”y
(
cÚ
, "SHOW VARIABLES LIKE 'collation_connection'");

502 
	`check_mysql_rc
(
rc
, 
cÚ
);

503 
rs
ð
	`mysql_¡Üe_»suÉ
(
cÚ
);

504 
	`FAIL_IF
(!
rs
, "Invalid„esult set");

505 
row
ð
	`mysql_ãtch_row
(
rs
);

506 
	`FAIL_IF
(!
row
, "Couldn't fetch„ow");

507 
	`¡rýy
(
cÞÏtiÚ_cÚÃùiÚ
, 
row
[1]);

508 
	`mysql_ä“_»suÉ
(
rs
);

509  
OK
;

510 
	}
}

512 
	#MY_CS_NAME_SIZE
 32

	)

514 
	$‹¡_bug30472
(
MYSQL
 *
mysql
)

516 
rc
;

518 
ch¬aù”_£t_Çme_1
[
MY_CS_NAME_SIZE
];

519 
ch¬aù”_£t_þ›Á_1
[
MY_CS_NAME_SIZE
];

520 
ch¬aù”_£t_»suÉs_1
[
MY_CS_NAME_SIZE
];

521 
cÞÏtiÚ_cÚÂeùiÚ_1
[
MY_CS_NAME_SIZE
];

523 
ch¬aù”_£t_Çme_2
[
MY_CS_NAME_SIZE
];

524 
ch¬aù”_£t_þ›Á_2
[
MY_CS_NAME_SIZE
];

525 
ch¬aù”_£t_»suÉs_2
[
MY_CS_NAME_SIZE
];

526 
cÞÏtiÚ_cÚÂeùiÚ_2
[
MY_CS_NAME_SIZE
];

528 
ch¬aù”_£t_Çme_3
[
MY_CS_NAME_SIZE
];

529 
ch¬aù”_£t_þ›Á_3
[
MY_CS_NAME_SIZE
];

530 
ch¬aù”_£t_»suÉs_3
[
MY_CS_NAME_SIZE
];

531 
cÞÏtiÚ_cÚÂeùiÚ_3
[
MY_CS_NAME_SIZE
];

533 
ch¬aù”_£t_Çme_4
[
MY_CS_NAME_SIZE
];

534 
ch¬aù”_£t_þ›Á_4
[
MY_CS_NAME_SIZE
];

535 
ch¬aù”_£t_»suÉs_4
[
MY_CS_NAME_SIZE
];

536 
cÞÏtiÚ_cÚÂeùiÚ_4
[
MY_CS_NAME_SIZE
];

538 
SKIP_MAXSCALE
;

540 ià(
	`mysql_g‘_£rv”_v”siÚ
(
mysql
è< 50100 || !
is_m¬Ÿdb
)

542 
	`dŸg
("Test„equires MySQL Server version 5.1 or‡bove");

543  
SKIP
;

547 
	`mysql_£t_ch¬aù”_£t
(
mysql
, "latin1");

548 
	`bug30472_»Œ›ve_ch¬£t_šfo
(
mysql
,

549 
ch¬aù”_£t_Çme_1
,

550 
ch¬aù”_£t_þ›Á_1
,

551 
ch¬aù”_£t_»suÉs_1
,

552 
cÞÏtiÚ_cÚÂeùiÚ_1
);

556 
	`FAIL_IF
(
	`mysql_£t_ch¬aù”_£t
(
mysql
, "utf8"), "Setting cso utf8 failed");

560 
	`bug30472_»Œ›ve_ch¬£t_šfo
(
mysql
,

561 
ch¬aù”_£t_Çme_2
,

562 
ch¬aù”_£t_þ›Á_2
,

563 
ch¬aù”_£t_»suÉs_2
,

564 
cÞÏtiÚ_cÚÂeùiÚ_2
);

572 
	`FAIL_UNLESS
(
	`¡rcmp
(
ch¬aù”_£t_Çme_2
, "utf8") == 0, "cs_name != utf8");

573 
	`FAIL_UNLESS
(
	`¡rcmp
(
ch¬aù”_£t_þ›Á_2
, "utf8") == 0, "cs_client != utf8");

574 
	`FAIL_UNLESS
(
	`¡rcmp
(
ch¬aù”_£t_»suÉs_2
, "utf8") == 0, "cs_result != ut8");

575 
	`FAIL_UNLESS
(
	`¡rcmp
(
cÞÏtiÚ_cÚÂeùiÚ_2
, "utf8_general_ci") == 0, "collation != utf8_general_ci");

577 
	`dŸg
("% %s", 
ch¬aù”_£t_Çme_1
, 
ch¬aù”_£t_Çme_2
);

578 
	`FAIL_UNLESS
(
	`¡rcmp
(
ch¬aù”_£t_Çme_1
, 
ch¬aù”_£t_Çme_2
) != 0, "cs_name1 = cs_name2");

579 
	`FAIL_UNLESS
(
	`¡rcmp
(
ch¬aù”_£t_þ›Á_1
, 
ch¬aù”_£t_þ›Á_2
) != 0, "cs_client1 = cs_client2");

580 
	`FAIL_UNLESS
(
	`¡rcmp
(
ch¬aù”_£t_»suÉs_1
, 
ch¬aù”_£t_»suÉs_2
) != 0, "cs_result1 = cs_result2");

581 
	`FAIL_UNLESS
(
	`¡rcmp
(
cÞÏtiÚ_cÚÂeùiÚ_1
, 
cÞÏtiÚ_cÚÂeùiÚ_2
) != 0, "collation1 = collation2");

585 
rc
ð
	`mysql_chªge_u£r
(
mysql
, 
u£ºame
, 
·sswÜd
, (
schema
) ? schema : "test");

586 
	`mysql_£t_ch¬aù”_£t
(
mysql
, "latin1");

587 
	`check_mysql_rc
(
rc
, 
mysql
);

591 
	`bug30472_»Œ›ve_ch¬£t_šfo
(
mysql
,

592 
ch¬aù”_£t_Çme_3
,

593 
ch¬aù”_£t_þ›Á_3
,

594 
ch¬aù”_£t_»suÉs_3
,

595 
cÞÏtiÚ_cÚÂeùiÚ_3
);

599 
	`FAIL_UNLESS
(
	`¡rcmp
(
ch¬aù”_£t_Çme_1
, 
ch¬aù”_£t_Çme_3
) == 0, "cs_name1 != cs_name3");

600 
	`FAIL_UNLESS
(
	`¡rcmp
(
ch¬aù”_£t_þ›Á_1
, 
ch¬aù”_£t_þ›Á_3
) == 0, "cs_client1 != cs_client3");

601 
	`FAIL_UNLESS
(
	`¡rcmp
(
ch¬aù”_£t_»suÉs_1
, 
ch¬aù”_£t_»suÉs_3
) == 0, "cs_result1 != cs_result3");

602 
	`FAIL_UNLESS
(
	`¡rcmp
(
cÞÏtiÚ_cÚÂeùiÚ_1
, 
cÞÏtiÚ_cÚÂeùiÚ_3
) == 0, "collation1 != collation3");

606 
	`mysql_ÝtiÚs
(
mysql
, 
MYSQL_SET_CHARSET_NAME
, "utf8");

613 
rc
ð
	`mysql_chªge_u£r
(
mysql
, 
u£ºame
, 
·sswÜd
, (
schema
) ? schema : "test");

614 
	`check_mysql_rc
(
rc
, 
mysql
);

618 
	`bug30472_»Œ›ve_ch¬£t_šfo
(
mysql
,

619 
ch¬aù”_£t_Çme_4
,

620 
ch¬aù”_£t_þ›Á_4
,

621 
ch¬aù”_£t_»suÉs_4
,

622 
cÞÏtiÚ_cÚÂeùiÚ_4
);

626 
	`FAIL_UNLESS
(
	`¡rcmp
(
ch¬aù”_£t_Çme_4
, "utf8") == 0, "cs_name != utf8");

627 
	`FAIL_UNLESS
(
	`¡rcmp
(
ch¬aù”_£t_þ›Á_4
, "utf8") == 0, "cs_client != utf8");

628 
	`FAIL_UNLESS
(
	`¡rcmp
(
ch¬aù”_£t_»suÉs_4
, "utf8") == 0, "cs_result != utf8");

629 
	`FAIL_UNLESS
(
	`¡rcmp
(
cÞÏtiÚ_cÚÂeùiÚ_4
, "utf8_general_ci") == 0, "collation_connection != utf8_general_ci");

633  
OK
;

634 
	}
}

636 
	$‹¡_bug_54100
(
MYSQL
 *
mysql
)

638 
MYSQL_RES
 *
»suÉ
;

639 
MYSQL_ROW
 
row
;

640 
rc
;

642 
rc
ð
	`mysql_qu”y
(
mysql
, "SHOW CHARACTER SET");

643 
	`check_mysql_rc
(
rc
, 
mysql
);

645 
»suÉ
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

647 (
row
ð
	`mysql_ãtch_row
(
»suÉ
)))

650 ià(
	`¡rcmp
(
row
[0], "ucs2") && strcmp(row[0], "utf16le") && strcmp(row[0], "utf8mb4") &&

651 
	`¡rcmp
(
row
[0], "utf16") && strcmp(row[0], "utf32")) {

652 
rc
ð
	`mysql_£t_ch¬aù”_£t
(
mysql
, 
row
[0]);

653 
	`check_mysql_rc
(
rc
, 
mysql
);

656 
	`mysql_ä“_»suÉ
(
»suÉ
);

658  
OK
;

659 
	}
}

664 
‹¡_utf16_utf32_noboms
(
MYSQL
 *
mysql
 
__©Œibu‹__
((
unu£d
)))

666 #iâdeà
HAVE_ICONV


667 
dŸg
("MariaDB Connector/C was built without iconv support");

668  
	gSKIP
;

670 cÚ¡ *
	gc¢ame
[]= {"utf16", "utf16le", "utf32", "utf8"};

671 
MARIADB_CHARSET_INFO
 *
	gcsšfo
[(
c¢ame
)/(*)];

673 cÚ¡ 
	gUTF8
ð(
c¢ame
)/(*) - 1;

675 
	gš_¡ršg
[][8]= {"\xd8\x02\xdc\x60\0",

679 
size_t
 
	gš_où_Ën
[]= {6, 6, 8, 5};

681 
	gbufãr
[8], 
	gas_hex
[16];

682 
	gi
, 
	g”rÜ
;

683 
size_t
 
	grc
, 
	gš_Ën
, 
	gout_Ën
;

685 
	gi
ð0; i < ()((
	gc¢ame
)/(*)); ++i)

687 
	gcsšfo
[
i
]ð
m¬Ÿdb_g‘_ch¬£t_by_Çme
(
c¢ame
[i]);

689 ià(
	gcsšfo
[
i
] =ð
NULL
)

691 
dŸg
("Could‚Ù g‘ c šfØfÜ %s", 
c¢ame
[
i
]);

692  
	gFAIL
;

696 
	gi
ð0; i < 
	gUTF8
; ++i)

698 
	gš_Ën
ð
š_où_Ën
[
i
];

699 
	gout_Ën
ð(
bufãr
);

701 
dŸg
("CÚv”tšg %s->%s", 
c¢ame
[
i
], c¢ame[
UTF8
]);

702 
	grc
ð
m¬Ÿdb_cÚv”t_¡ršg
((*)
š_¡ršg
[
i
], &
š_Ën
, 
csšfo
[i], 
bufãr
, &
out_Ën
, csšfo[
UTF8
], &
”rÜ
);

704 
FAIL_IF
(
rc
 =ð(
size_t
)-1, "Conversion failed");

705 
FAIL_IF
(
rc
 !ð
š_où_Ën
[
UTF8
], "Incorrect‚umber of written bytes");

707 ià(
memcmp
(
bufãr
, 
š_¡ršg
[
UTF8
], 
rc
) != 0)

709 
mysql_hex_¡ršg
(
as_hex
, 
bufãr
, ()
rc
);

710 
dŸg
("CÚv”‹d sŒšg(%sèdÛ nÙ m©chhex³ùed oÃ", 
as_hex
);

711  
	gFAIL
;

714 
	gš_Ën
ð
š_où_Ën
[
UTF8
];

715 
	gout_Ën
ð(
bufãr
);

717 
dŸg
("CÚv”tšg %s->%s", 
c¢ame
[
UTF8
], c¢ame[
i
]);

718 
	grc
ð
m¬Ÿdb_cÚv”t_¡ršg
((*)
š_¡ršg
[
UTF8
], &
š_Ën
, 
csšfo
[UTF8], 
bufãr
, &
out_Ën
, csšfo[
i
], &
”rÜ
);

720 
FAIL_IF
(
rc
 =ð(
size_t
)-1, "Conversion failed");

721 
dŸg
("rc=%lu où_Ën: %lu", ()
rc
, ()
š_où_Ën
[
i
]);

722 
FAIL_IF
(
rc
 !ð
š_où_Ën
[
i
], "Incorrect‚umber of written bytes");

724 ià(
memcmp
(
bufãr
, 
š_¡ršg
[
i
], 
rc
) != 0)

726 
mysql_hex_¡ršg
(
as_hex
, 
bufãr
, ()
rc
);

727 
dŸg
("CÚv”‹d sŒšg(%sèdÛ nÙ m©chhex³ùed oÃ", 
as_hex
);

728  
	gFAIL
;

732  
	gOK
;

736 
ch¬£t_auto
(
MYSQL
 *
my
 
__©Œibu‹__
((
unu£d
)))

738 cÚ¡ *
	gc¢ame1
, *
	gc¢ame2
;

739 cÚ¡ *
	go¢ame
;

740 
MYSQL
 *
	gmysql
ð
mysql_š™
(
NULL
);

741 
	grc
;

743 
	go¢ame
ð
madb_g‘_os_ch¬aù”_£t
();

745 
mysql_ÝtiÚs
(
mysql
, 
MYSQL_SET_CHARSET_NAME
, "auto");

747 
FAIL_IF
(!
my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
,

748 
·sswÜd
, 
schema
, 
pÜt
, 
sock‘Çme
, 0),

749 
mysql_”rÜ
(
mysql
));

751 
	gc¢ame1
ð
mysql_ch¬aù”_£t_Çme
(
mysql
);

752 
dŸg
("Ch¬aù” s‘: % o ch¬£t: %s", 
c¢ame1
, 
o¢ame
);

754 
FAIL_IF
(
¡rcmp
(
o¢ame
, 
c¢ame1
), "character set is‚ot os character set");

756 ià(
¡rcmp
(
o¢ame
, "utf8"))

758 
	grc
ð
mysql_£t_ch¬aù”_£t
(
mysql
, "utf8");

759 
check_mysql_rc
(
rc
, 
mysql
);

761 
	gc¢ame2
ð
mysql_ch¬aù”_£t_Çme
(
mysql
);

762 
dŸg
("Ch¬aù” s‘: %s", 
c¢ame2
);

764 
FAIL_IF
(!
¡rcmp
(
c¢ame2
, 
c¢ame1
), "Wrong charset:ƒxpected utf8");

766 
	grc
ð
mysql_£t_ch¬aù”_£t
(
mysql
, "auto");

767 
check_mysql_rc
(
rc
, 
mysql
);

769 
	gc¢ame2
ð
mysql_ch¬aù”_£t_Çme
(
mysql
);

770 
dŸg
("Ch¬aù” s‘: %s", 
c¢ame2
);

771 
FAIL_IF
(
¡rcmp
(
c¢ame2
, 
o¢ame
), "Wrong charset:ƒxpected os charset");

773 
mysql_þo£
(
mysql
);

774  
	gOK
;

778 
	$‹¡_cÚc223
(
MYSQL
 *
mysql
)

780 
rc
;

781 
MYSQL_RES
 *
»s
;

782 
MYSQL_ROW
 
row
;

783 
found
= 0;

785 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT ID, CHARACTER_SET_NAME, COLLATION_NAME FROM INFORMATION_SCHEMA.COLLATIONS");

786 
	`check_mysql_rc
(
rc
, 
mysql
);

788 
»s
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

789 (
row
 = 
	`mysql_ãtch_row
(
»s
)))

791 
id
ð
	`©oi
(
row
[0]);

792 ià(!
	`m¬Ÿdb_g‘_ch¬£t_by_Ä
(
id
))

794 
	`dŸg
("%04d % %s", 
id
, 
row
[1],„ow[2]);

795 
found
++;

798 
	`mysql_ä“_»suÉ
(
»s
);

799 ià(
found
)

801 
	`dŸg
("%d ch¬aù” s‘s/cÞÏtiÚ nÙ found", 
found
);

802  
FAIL
;

804  
OK
;

805 
	}
}

807 
my_‹¡s_¡
 
	gmy_‹¡s
[] = {

808 {"‹¡_cÚc223", 
‹¡_cÚc223
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

809 {"ch¬£t_auto", 
ch¬£t_auto
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

810 {"bug_8378: mysql_»®_esÿ³ w™h gbk", 
bug_8378
, 
TEST_CONNECTION_NEW
, 0, 
Ýt_bug8378
, 
NULL
},

811 {"‹¡_þ›Á_ch¬aù”_£t", 
‹¡_þ›Á_ch¬aù”_£t
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

812 {"bug_10214: mysql_»®_esÿ³ w™h NO_BACKSLASH_ESCAPES", 
bug_10214
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

813 {"‹¡_esÿpšg", 
‹¡_esÿpšg
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

814 {"‹¡_cÚv”siÚ", 
‹¡_cÚv”siÚ
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

815 {"bug_41785", 
bug_41785
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, "not fixed yet"},

816 {"‹¡_bug27876", 
‹¡_bug27876
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

817 {"‹¡_bug30472", 
‹¡_bug30472
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

818 {"‹¡_ps_i18n", 
‹¡_ps_i18n
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

819 {"‹¡_bug_54100", 
‹¡_bug_54100
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

820 {"‹¡_utf16_utf32_noboms", 
‹¡_utf16_utf32_noboms
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

821 {
NULL
, NULL, 0, 0, NULL, 0}

825 
	$maš
(
¬gc
, **
¬gv
)

827 ià(
¬gc
 > 1)

828 
	`g‘_ÝtiÚs
(
¬gc
, 
¬gv
);

830 
	`g‘_’vv¬s
();

832 
	`run_‹¡s
(
my_‹¡s
);

834 (
	`ex™_¡©us
());

835 
	}
}

	@unittest/libmariadb/conc336.c

1 
	~"my_‹¡.h
"

3 
	#MAX_COUNT
 2000

	)

5 
	$maš
(
¬gc
, *
¬gv
[]) {

7 
MYSQL
 *
mysql
;

8 
i
;

10 ià(
¬gc
 > 1)

11 
	`g‘_ÝtiÚs
(
¬gc
, 
¬gv
);

13 
	`g‘_’vv¬s
();

15 ià(
	`IS_SKYSQL
(
ho¡Çme
))

18 
	`dŸg
("ho¡Çme: %s", 
ho¡Çme
);

20 
i
 = 0; i < 
MAX_COUNT
; ++i) {

22 ià(
	`mysql_lib¿ry_š™
(-1, 
NULL
, NULL) != 0) {

23 
	`dŸg
("mysql_library_init failed");

27 
mysql
 = 
	`mysql_š™
(
NULL
);

28 ià(!
mysql
) {

29 
	`dŸg
("mysql_init failed");

33 ià(
fÜû_Žs
)

34 
	`mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_SSL_ENFORCE
, &
fÜû_Žs
);

36 ià(!
	`mysql_»®_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
, 
schema
, 
pÜt
, 
sock‘Çme
, 0)) {

37 
	`dŸg
("mysql_»®_cÚÃù fažed: %s", 
	`mysql_”rÜ
(
mysql
));

41 ià(
	`mysql_qu”y
(
mysql
, "SELECT NULL LIMIT 0") != 0) {

42 
	`dŸg
("mysql_qu”y fažed: %s", 
	`mysql_”rÜ
(
mysql
));

46 
	`mysql_þo£
(
mysql
);

47 
	`mysql_lib¿ry_’d
();

53 
	}
}

	@unittest/libmariadb/connection.c

28 
	~"my_‹¡.h
"

30 
	$‹¡_cÚc66
(
MYSQL
 *
my
)

32 
MYSQL
 *
mysql
ð
	`mysql_š™
(
NULL
);

33 
rc
;

34 
FILE
 *
å
;

35 
qu”y
[1024];

37 
SKIP_SKYSQL
;

38 
SKIP_MAXSCALE
;

40 ià(!
is_m¬Ÿdb
)

41  
SKIP
;

43 ià(!(
å
ð
	`fÝ’
("./my-conc66-test.cnf", "w")))

44  
FAIL
;

46 
	`årštf
(
å
, "[notmygroup]\n");

47 
	`årštf
(
å
, "user=foo\n");

48 
	`årštf
(
å
, "[conc-66]\n");

49 
	`årštf
(
å
, "user=conc66\n");

50 
	`årštf
(
å
, "port=3306\n");

51 
	`årštf
(
å
, "enable-local-infile\n");

52 
	`årštf
(
å
, "password='test@A1\\\";#test'\n");

54 
	`fþo£
(
å
);

56 
rc
ð
	`mysql_ÝtiÚs
(
mysql
, 
MYSQL_READ_DEFAULT_GROUP
, "conc-66");

57 
	`check_mysql_rc
(
rc
, 
mysql
);

58 
rc
ð
	`mysql_ÝtiÚs
(
mysql
, 
MYSQL_READ_DEFAULT_FILE
, "./my-conc66-test.cnf");

59 
	`check_mysql_rc
(
rc
, 
mysql
);

61 
	`¥rštf
(
qu”y
, "GRANT ALL ON %s.* TO 'cÚc66'@'%s' IDENTIFIED BY '‹¡@A1\";#‹¡'", 
schema
, 
this_ho¡
 ?his_host : "localhost");

62 
rc
ð
	`mysql_qu”y
(
my
, 
qu”y
);

63 
	`check_mysql_rc
(
rc
, 
my
);

64 
rc
ð
	`mysql_qu”y
(
my
, "FLUSH PRIVILEGES");

65 
	`check_mysql_rc
(
rc
, 
my
);

66 ià(!
	`my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, 
NULL
,

67 
NULL
, 
schema
, 
pÜt
, 
sock‘Çme
, 0))

69 
	`dŸg
("u£r: %s", 
mysql
->
ÝtiÚs
.
u£r
);

70 
	`dŸg
("E¼Ü: %s", 
	`mysql_”rÜ
(
mysql
));

71  
FAIL
;

73 
	`dŸg
("u£r: %s", 
mysql
->
ÝtiÚs
.
u£r
);

75 
	`¥rštf
(
qu”y
, "DROP u£¸'cÚc66'@'%s'", 
this_ho¡
 ?his_host : "localhost");

76 
rc
ð
	`mysql_qu”y
(
my
, 
qu”y
);

78 
	`check_mysql_rc
(
rc
, 
my
);

79 
	`mysql_þo£
(
mysql
);

80  
OK
;

81 
	}
}

83 
	$‹¡_bug20023
(
MYSQL
 *
mysql
)

85 
sql_big_£Ëùs_Üig
;

86 
max_još_size_Üig
;

88 
sql_big_£Ëùs_2
;

89 
sql_big_£Ëùs_3
;

90 
sql_big_£Ëùs_4
;

91 
sql_big_£Ëùs_5
;

92 
rc
;

94 
SKIP_SKYSQL
;

95 
SKIP_MAXSCALE
;

97 ià(!
is_m¬Ÿdb
)

98  
SKIP
;

100 ià(
	`mysql_g‘_£rv”_v”siÚ
(
mysql
) < 50100) {

101 
	`dŸg
("Test„equires MySQL Server version 5.1 or‡bove");

102  
SKIP
;

109 
	`qu”y_št_v¬ŸbË
(
mysql
,

111 &
sql_big_£Ëùs_Üig
);

113 
	`qu”y_št_v¬ŸbË
(
mysql
,

115 &
max_još_size_Üig
);

122 
rc
ð
	`mysql_chªge_u£r
(
mysql
, 
u£ºame
, 
·sswÜd
, 
schema
);

123 
	`check_mysql_rc
(
rc
, 
mysql
);

127 
	`qu”y_št_v¬ŸbË
(
mysql
,

129 &
sql_big_£Ëùs_2
);

133 
	`FAIL_UNLESS
(
sql_big_£Ëùs_Üig
 =ð
sql_big_£Ëùs_2
, "Different value for sql_big_select");

142 
rc
ð
	`mysql_qu”y
(
mysql
, "SET @@global.max_join_size = 10000");

143 
	`check_mysql_rc
(
rc
, 
mysql
);

144 
rc
ð
	`mysql_qu”y
(
mysql
, "SET @@session.max_join_size = default");

145 
	`check_mysql_rc
(
rc
, 
mysql
);

149 
rc
ð
	`mysql_chªge_u£r
(
mysql
, 
u£ºame
, 
·sswÜd
, 
schema
);

150 
	`check_mysql_rc
(
rc
, 
mysql
);

154 
	`qu”y_št_v¬ŸbË
(
mysql
,

156 &
sql_big_£Ëùs_3
);

160 
	`FAIL_UNLESS
(
sql_big_£Ëùs_3
 == 0, "big_selects != 0");

169 
rc
ð
	`mysql_qu”y
(
mysql
, "SET @@global.max_join_size = cast(-1‡s unsigned int)");

170 
rc
ð
	`mysql_qu”y
(
mysql
, "SET @@session.max_join_size = default");

174 
rc
ð
	`mysql_chªge_u£r
(
mysql
, 
u£ºame
, 
·sswÜd
, 
schema
);

175 
	`check_mysql_rc
(
rc
, 
mysql
);

179 
	`qu”y_št_v¬ŸbË
(
mysql
,

181 &
sql_big_£Ëùs_4
);

185 
	`FAIL_UNLESS
(
sql_big_£Ëùs_4
 == 1, "sql_big_select != 1");

192 
rc
ð
	`mysql_qu”y
(
mysql
, "SET @@global.max_join_size = cast(-1‡s unsigned int)");

193 
	`check_mysql_rc
(
rc
, 
mysql
);

195 
rc
ð
	`mysql_qu”y
(
mysql
, "SET @@session.max_join_size = default");

196 
	`check_mysql_rc
(
rc
, 
mysql
);

200 
rc
ð
	`mysql_chªge_u£r
(
mysql
, 
u£ºame
, 
·sswÜd
, 
schema
);

201 
	`check_mysql_rc
(
rc
, 
mysql
);

205 
	`qu”y_št_v¬ŸbË
(
mysql
,

207 &
sql_big_£Ëùs_5
);

211 
	`FAIL_UNLESS
(
sql_big_£Ëùs_5
 =ð
sql_big_£Ëùs_Üig
, "big_select != 1");

217  
OK
;

218 
	}
}

220 
	$‹¡_chªge_u£r
(
MYSQL
 *
mysql
)

222 
buff
[256];

223 cÚ¡ *
u£r_pw
= "mysqltest_pw";

224 cÚ¡ *
u£r_no_pw
= "mysqltest_no_pw";

225 cÚ¡ *
pw
= "password";

226 cÚ¡ *
db
= "mysqltest_user_test_database";

227 
rc
;

229 
	`dŸg
("Dueo mysql_change_user security fixhisest will‚ot work‡nymore.");

230 (
SKIP
);

233 
	`¥rštf
(
buff
, "drÝ d©aba£ iàexi¡ %s", 
db
);

234 
rc
ð
	`mysql_qu”y
(
mysql
, 
buff
);

235 
	`check_mysql_rc
(
rc
, 
mysql
);

237 
	`¥rštf
(
buff
, "ü—‹ d©aba£ %s", 
db
);

238 
rc
ð
	`mysql_qu”y
(
mysql
, 
buff
);

239 
	`check_mysql_rc
(
rc
, 
mysql
);

241 
	`¥rštf
(
buff
,

243 
db
,

244 
u£r_pw
,

245 
pw
);

246 
rc
ð
	`mysql_qu”y
(
mysql
, 
buff
);

247 
	`check_mysql_rc
(
rc
, 
mysql
);

249 
	`¥rštf
(
buff
,

251 
db
,

252 
u£r_no_pw
);

253 
rc
ð
	`mysql_qu”y
(
mysql
, 
buff
);

254 
	`check_mysql_rc
(
rc
, 
mysql
);

258 
rc
ð
	`mysql_chªge_u£r
(
mysql
, 
NULL
, NULL, NULL);

259 
	`FAIL_UNLESS
(
rc
, "Errorƒxpected");

262 
rc
ð
	`mysql_chªge_u£r
(
mysql
, "", 
NULL
, NULL);

263 
	`FAIL_UNLESS
(
rc
, "Errorƒxpected");

265 
rc
ð
	`mysql_chªge_u£r
(
mysql
, "", "", 
NULL
);

266 
	`FAIL_UNLESS
(
rc
, "Errorƒxpected");

268 
rc
ð
	`mysql_chªge_u£r
(
mysql
, "", "", "");

269 
	`FAIL_UNLESS
(
rc
, "Errorƒxpected");

271 
rc
ð
	`mysql_chªge_u£r
(
mysql
, 
NULL
, "", "");

272 
	`FAIL_UNLESS
(
rc
, "Errorƒxpected");

275 
rc
ð
	`mysql_chªge_u£r
(
mysql
, 
NULL
, NULL, "");

276 
	`FAIL_UNLESS
(
rc
, "Errorƒxpected");

278 
rc
ð
	`mysql_chªge_u£r
(
mysql
, "", 
NULL
, "");

279 
	`FAIL_UNLESS
(
rc
, "Errorƒxpected");

281 
rc
ð
	`mysql_chªge_u£r
(
mysql
, 
u£r_pw
, 
NULL
, "");

282 
	`FAIL_UNLESS
(
rc
, "Errorƒxpected");

284 
rc
ð
	`mysql_chªge_u£r
(
mysql
, 
u£r_pw
, "", "");

285 
	`FAIL_UNLESS
(
rc
, "Errorƒxpected");

287 
rc
ð
	`mysql_chªge_u£r
(
mysql
, 
u£r_pw
, "", 
NULL
);

288 
	`FAIL_UNLESS
(
rc
, "Errorƒxpected");

290 
rc
ð
	`mysql_chªge_u£r
(
mysql
, 
u£r_pw
, 
NULL
, NULL);

291 
	`FAIL_UNLESS
(
rc
, "Errorƒxpected");

293 
rc
ð
	`mysql_chªge_u£r
(
mysql
, 
u£r_pw
, "", 
db
);

294 
	`FAIL_UNLESS
(
rc
, "Errorƒxpected");

296 
rc
ð
	`mysql_chªge_u£r
(
mysql
, 
u£r_pw
, 
NULL
, 
db
);

297 
	`FAIL_UNLESS
(
rc
, "Errorƒxpected");

299 
rc
ð
	`mysql_chªge_u£r
(
mysql
, 
u£r_pw
, 
pw
, 
db
);

300 
	`check_mysql_rc
(
rc
, 
mysql
);

302 
rc
ð
	`mysql_chªge_u£r
(
mysql
, 
u£r_pw
, 
pw
, 
NULL
);

303 
	`check_mysql_rc
(
rc
, 
mysql
);

305 
rc
ð
	`mysql_chªge_u£r
(
mysql
, 
u£r_pw
, 
pw
, "");

306 
	`check_mysql_rc
(
rc
, 
mysql
);

308 
rc
ð
	`mysql_chªge_u£r
(
mysql
, 
u£r_no_pw
, 
pw
, 
db
);

309 
	`FAIL_UNLESS
(
rc
, "Errorƒxpected");

311 
rc
ð
	`mysql_chªge_u£r
(
mysql
, 
u£r_no_pw
, 
pw
, "");

312 
	`FAIL_UNLESS
(
rc
, "Errorƒxpected");

314 
rc
ð
	`mysql_chªge_u£r
(
mysql
, 
u£r_no_pw
, 
pw
, 
NULL
);

315 
	`FAIL_UNLESS
(
rc
, "Errorƒxpected");

317 
rc
ð
	`mysql_chªge_u£r
(
mysql
, 
u£r_no_pw
, "", 
NULL
);

318 
	`check_mysql_rc
(
rc
, 
mysql
);

320 
rc
ð
	`mysql_chªge_u£r
(
mysql
, 
u£r_no_pw
, "", "");

321 
	`check_mysql_rc
(
rc
, 
mysql
);

323 
rc
ð
	`mysql_chªge_u£r
(
mysql
, 
u£r_no_pw
, "", 
db
);

324 
	`check_mysql_rc
(
rc
, 
mysql
);

326 
rc
ð
	`mysql_chªge_u£r
(
mysql
, 
u£r_no_pw
, 
NULL
, 
db
);

327 
	`check_mysql_rc
(
rc
, 
mysql
);

329 
rc
ð
	`mysql_chªge_u£r
(
mysql
, "", 
pw
, 
db
);

330 
	`FAIL_UNLESS
(
rc
, "Errorƒxpected");

332 
rc
ð
	`mysql_chªge_u£r
(
mysql
, "", 
pw
, "");

333 
	`FAIL_UNLESS
(
rc
, "Errorƒxpected");

335 
rc
ð
	`mysql_chªge_u£r
(
mysql
, "", 
pw
, 
NULL
);

336 
	`FAIL_UNLESS
(
rc
, "Errorƒxpected");

338 
rc
ð
	`mysql_chªge_u£r
(
mysql
, 
NULL
, 
pw
, NULL);

339 
	`FAIL_UNLESS
(
rc
, "Errorƒxpected");

341 
rc
ð
	`mysql_chªge_u£r
(
mysql
, 
NULL
, NULL, 
db
);

342 
	`FAIL_UNLESS
(
rc
, "Errorƒxpected");

344 
rc
ð
	`mysql_chªge_u£r
(
mysql
, 
NULL
, "", 
db
);

345 
	`FAIL_UNLESS
(
rc
, "Errorƒxpected");

347 
rc
ð
	`mysql_chªge_u£r
(
mysql
, "", "", 
db
);

348 
	`FAIL_UNLESS
(
rc
, "Errorƒxpected");

352 
rc
ð
	`mysql_chªge_u£r
(
mysql
, 
u£ºame
, 
·sswÜd
, 
schema
);

353 
	`check_mysql_rc
(
rc
, 
mysql
);

355 
	`¥rštf
(
buff
, "drÝ d©aba£ %s", 
db
);

356 
rc
ð
	`mysql_qu”y
(
mysql
, 
buff
);

357 
	`check_mysql_rc
(
rc
, 
mysql
);

359 
	`¥rštf
(
buff
, "drÝ u£¸%s@'%%'", 
u£r_pw
);

360 
rc
ð
	`mysql_qu”y
(
mysql
, 
buff
);

361 
	`check_mysql_rc
(
rc
, 
mysql
);

363 
	`¥rštf
(
buff
, "drÝ u£¸%s@'%%'", 
u£r_no_pw
);

364 
rc
ð
	`mysql_qu”y
(
mysql
, 
buff
);

365 
	`check_mysql_rc
(
rc
, 
mysql
);

367  
OK
;

368 
	}
}

374 
	#LARGE_BUFFER_SIZE
 2048

	)

376 
	$‹¡_bug31669
(
MYSQL
 *
mysql
)

378 
rc
;

379 
buff
[
LARGE_BUFFER_SIZE
+1];

380 
u£r
[
USERNAME_CHAR_LENGTH
+1];

381 
db
[
NAME_CHAR_LEN
+1];

382 
qu”y
[
LARGE_BUFFER_SIZE
*2];

384 
	`dŸg
("Dueo mysql_change_user security fixhisest will‚ot work‡nymore.");

385 (
SKIP
);

387 
rc
ð
	`mysql_chªge_u£r
(
mysql
, 
NULL
, NULL, NULL);

388 
	`FAIL_UNLESS
(
rc
, "Errorƒxpected");

390 
rc
ð
	`mysql_chªge_u£r
(
mysql
, "", "", "");

391 
	`FAIL_UNLESS
(
rc
, "Errorƒxpected");

393 
	`mem£t
(
buff
, 'a', (buff));

395 
rc
ð
	`mysql_chªge_u£r
(
mysql
, 
buff
, buff, buff);

396 
	`FAIL_UNLESS
(
rc
, "Errorƒxpected");

398 
rc
 = 
	`mysql_chªge_u£r
(
mysql
, 
u£ºame
, 
·sswÜd
, 
schema
);

399 
	`check_mysql_rc
(
rc
, 
mysql
);

401 
	`mem£t
(
db
, 'a', (db));

402 
db
[
NAME_CHAR_LEN
]= 0;

403 
	`¥rštf
(
qu”y
, "CREATE DATABASE IF NOT EXISTS %s", 
db
);

404 
rc
ð
	`mysql_qu”y
(
mysql
, 
qu”y
);

405 
	`check_mysql_rc
(
rc
, 
mysql
);

407 
	`mem£t
(
u£r
, 'b', (user));

408 
u£r
[
USERNAME_CHAR_LENGTH
]= 0;

409 
	`mem£t
(
buff
, 'c', (buff));

410 
buff
[
LARGE_BUFFER_SIZE
]= 0;

411 
	`¥rštf
(
qu”y
, "GRANT ALL PRIVILEGES ON *.* TO '%s'@'%%' IDENTIFIED BY '%s' WITH GRANT OPTION", 
u£r
, 
buff
);

412 
rc
ð
	`mysql_qu”y
(
mysql
, 
qu”y
);

413 
	`check_mysql_rc
(
rc
, 
mysql
);

415 
rc
ð
	`mysql_qu”y
(
mysql
, "FLUSH PRIVILEGES");

416 
	`check_mysql_rc
(
rc
, 
mysql
);

418 
rc
ð
	`mysql_chªge_u£r
(
mysql
, 
u£r
, 
buff
, 
db
);

419 
	`check_mysql_rc
(
rc
, 
mysql
);

421 
u£r
[
USERNAME_CHAR_LENGTH
-1]= 'a';

422 
rc
ð
	`mysql_chªge_u£r
(
mysql
, 
u£r
, 
buff
, 
db
);

423 
	`FAIL_UNLESS
(
rc
, "Errorƒxpected");

425 
u£r
[
USERNAME_CHAR_LENGTH
-1]= 'b';

426 
buff
[
LARGE_BUFFER_SIZE
-1]= 'd';

427 
rc
ð
	`mysql_chªge_u£r
(
mysql
, 
u£r
, 
buff
, 
db
);

428 
	`FAIL_UNLESS
(
rc
, "Errorƒxpected");

430 
buff
[
LARGE_BUFFER_SIZE
-1]= 'c';

431 
db
[
NAME_CHAR_LEN
-1]= 'e';

432 
rc
ð
	`mysql_chªge_u£r
(
mysql
, 
u£r
, 
buff
, 
db
);

433 
	`FAIL_UNLESS
(
rc
, "Errorƒxpected");

435 
db
[
NAME_CHAR_LEN
-1]= 'a';

436 
rc
ð
	`mysql_chªge_u£r
(
mysql
, 
u£r
, 
buff
, 
db
);

437 
	`FAIL_UNLESS
(!
rc
, "Errorƒxpected");

439 
rc
ð
	`mysql_chªge_u£r
(
mysql
, 
u£r
 + 1, 
buff
 + 1, 
db
 + 1);

440 
	`FAIL_UNLESS
(
rc
, "Errorƒxpected");

442 
rc
 = 
	`mysql_chªge_u£r
(
mysql
, 
u£ºame
, 
·sswÜd
, 
schema
);

443 
	`check_mysql_rc
(
rc
, 
mysql
);

445 
	`¥rštf
(
qu”y
, "DROP DATABASE %s", 
db
);

446 
rc
ð
	`mysql_qu”y
(
mysql
, 
qu”y
);

447 
	`check_mysql_rc
(
rc
, 
mysql
);

449 
	`¥rštf
(
qu”y
, "DELETE FROM mysql.u£¸WHERE U£r='%s'", 
u£r
);

450 
rc
ð
	`mysql_qu”y
(
mysql
, 
qu”y
);

451 
	`check_mysql_rc
(
rc
, 
mysql
);

452 
	`FAIL_UNLESS
(
	`mysql_afãùed_rows
(
mysql
) == 1, "");

454  
OK
;

455 
	}
}

462 
	$‹¡_bug33831
(
MYSQL
 *
mysql
)

464 
	`FAIL_IF
(
	`my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
,

465 
·sswÜd
, 
schema
, 
pÜt
, 
sock‘Çme
, 0),

468  
OK
;

469 
	}
}

473 
	$‹¡_Ýt_»cÚÃù
(
MYSQL
 *
mysql
)

475 
my_boÞ
 
my_Œue
ð
TRUE
;

476 
rc
;

477 
my_boÞ
 
»cÚÃù
;

479 
	`´štf
("Œue: %d\n", 
TRUE
);

481 
mysql
ð
	`mysql_š™
(
NULL
);

482 
	`FAIL_IF
(!
mysql
, "notƒnough memory");

484 
	`mysql_g‘_ÝtiÚ
(
mysql
, 
MYSQL_OPT_RECONNECT
, &
»cÚÃù
);

485 
	`FAIL_UNLESS
(
»cÚÃù
 == 0, "reconnect != 0");

487 
rc
ð
	`mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_RECONNECT
, &
my_Œue
);

488 
	`check_mysql_rc
(
rc
, 
mysql
);

490 
	`mysql_g‘_ÝtiÚ
(
mysql
, 
MYSQL_OPT_RECONNECT
, &
»cÚÃù
);

491 
	`FAIL_UNLESS
(
»cÚÃù
 == 1, "reconnect != 1");

493 ià(!(
	`my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
,

494 
·sswÜd
, 
schema
, 
pÜt
,

495 
sock‘Çme
, 0)))

497 
	`dŸg
("connection failed");

498 
	`mysql_þo£
(
mysql
);

499  
FAIL
;

502 
	`mysql_g‘_ÝtiÚ
(
mysql
, 
MYSQL_OPT_RECONNECT
, &
»cÚÃù
);

503 
	`FAIL_UNLESS
(
»cÚÃù
 == 1, "reconnect != 1");

505 
	`mysql_þo£
(
mysql
);

507 
mysql
ð
	`mysql_š™
(
NULL
);

508 
	`FAIL_IF
(!
mysql
, "notƒnough memory");

510 
	`mysql_g‘_ÝtiÚ
(
mysql
, 
MYSQL_OPT_RECONNECT
, &
»cÚÃù
);

511 
	`FAIL_UNLESS
(
»cÚÃù
 == 0, "reconnect != 0");

513 ià(!(
	`my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
,

514 
·sswÜd
, 
schema
, 
pÜt
,

515 
sock‘Çme
, 0)))

517 
	`dŸg
("connection failed");

518 
	`mysql_þo£
(
mysql
);

519  
FAIL
;

522 
	`mysql_g‘_ÝtiÚ
(
mysql
, 
MYSQL_OPT_RECONNECT
, &
»cÚÃù
);

523 
	`FAIL_UNLESS
(
»cÚÃù
 == 0, "reconnect != 0");

525 
	`mysql_þo£
(
mysql
);

526  
OK
;

527 
	}
}

530 
	$‹¡_com´ess
(
MYSQL
 *
mysql
)

533 
MYSQL_RES
 *
»s
;

534 
MYSQL_ROW
 
row
;

535 
rc
;

536 
SKIP_MAXSCALE
;

538 
mysql
ð
	`mysql_š™
(
NULL
);

539 
	`FAIL_IF
(!
mysql
, "notƒnough memory");

542 
rc
ð
	`mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_COMPRESS
, 
NULL
);

546 ià(!(
	`my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
,

547 
·sswÜd
, 
schema
, 
pÜt
,

548 
sock‘Çme
, 0)))

550 
	`dŸg
("connection failed");

551  
FAIL
;

554 
rc
ð
	`mysql_qu”y
(
mysql
, "SHOW STATUS LIKE 'compression'");

555 
	`check_mysql_rc
(
rc
, 
mysql
);

556 
»s
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

557 
row
ð
	`mysql_ãtch_row
(
»s
);

558 
	`FAIL_UNLESS
(
	`¡rcmp
(
row
[1], "ON") == 0, "Compression off");

559 
	`mysql_ä“_»suÉ
(
»s
);

561 
	`mysql_þo£
(
mysql
);

562  
OK
;

563 
	}
}

565 
	$‹¡_»cÚÃù
(
MYSQL
 *
mysql
)

567 
my_boÞ
 
my_Œue
ð
TRUE
;

568 
MYSQL
 *
mysql1
;

569 
rc
;

570 
my_boÞ
 
»cÚÃù
;

571 
SKIP_MAXSCALE
;

573 
mysql1
ð
	`mysql_š™
(
NULL
);

574 
	`FAIL_IF
(!
mysql1
, "notƒnough memory");

576 
	`mysql_g‘_ÝtiÚ
(
mysql1
, 
MYSQL_OPT_RECONNECT
, &
»cÚÃù
);

577 
	`FAIL_UNLESS
(
»cÚÃù
 == 0, "reconnect != 0");

579 
rc
ð
	`mysql_ÝtiÚs
(
mysql1
, 
MYSQL_OPT_RECONNECT
, &
my_Œue
);

580 
	`check_mysql_rc
(
rc
, 
mysql1
);

582 
	`mysql_g‘_ÝtiÚ
(
mysql1
, 
MYSQL_OPT_RECONNECT
, &
»cÚÃù
);

583 
	`FAIL_UNLESS
(
»cÚÃù
 == 1, "reconnect != 1");

585 ià(!(
	`my_‹¡_cÚÃù
(
mysql1
, 
ho¡Çme
, 
u£ºame
,

586 
·sswÜd
, 
schema
, 
pÜt
,

587 
sock‘Çme
, 0)))

589 
	`dŸg
("connection failed");

590  
FAIL
;

593 
	`mysql_g‘_ÝtiÚ
(
mysql1
, 
MYSQL_OPT_RECONNECT
, &
»cÚÃù
);

594 
	`FAIL_UNLESS
(
»cÚÃù
 == 1, "reconnect != 1");

596 
	`dŸg
("Th»ad_id befÜkžl: %lu", 
	`mysql_th»ad_id
(
mysql1
));

597 
	`mysql_kžl
(
mysql
, 
	`mysql_th»ad_id
(
mysql1
));

599 
	`mysql_pšg
(
mysql1
);

601 
rc
ð
	`mysql_qu”y
(
mysql1
, "SELECT 1 FROM DUAL LIMIT 0");

602 
	`check_mysql_rc
(
rc
, 
mysql1
);

603 
	`dŸg
("Th»ad_id‡á” kžl: %lu", 
	`mysql_th»ad_id
(
mysql1
));

605 
	`mysql_g‘_ÝtiÚ
(
mysql1
, 
MYSQL_OPT_RECONNECT
, &
»cÚÃù
);

606 
	`FAIL_UNLESS
(
»cÚÃù
 == 1, "reconnect != 1");

607 
	`mysql_þo£
(
mysql1
);

608  
OK
;

609 
	}
}

611 
	$‹¡_cÚc21
(
MYSQL
 *
mysql
)

613 
rc
;

614 
MYSQL_RES
 *
»s
ð
NULL
;

615 
MYSQL_ROW
 
row
;

616 
tmp
[256];

617 
check_£rv”_v”siÚ
= 0;

618 
majÜ
=0, 
mšÜ
ð0, 
·tch
=0;

619 
SKIP_MAXSCALE
;

621 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT @@version");

622 
	`check_mysql_rc
(
rc
, 
mysql
);

624 
»s
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

625 
	`FAIL_IF
(
»s
 =ð
NULL
, "invalid„esult set");

627 
row
ð
	`mysql_ãtch_row
(
»s
);

628 
	`¡rýy
(
tmp
, 
row
[0]);

629 
	`mysql_ä“_»suÉ
(
»s
);

631 
	`ssÿnf
(
tmp
, "%d.%d.%d", &
majÜ
, &
mšÜ
, &
·tch
);

633 
check_£rv”_v”siÚ
ð
majÜ
 * 10000 + 
mšÜ
 * 100 + 
·tch
;

635 
	`FAIL_IF
(
	`mysql_g‘_£rv”_v”siÚ
(
mysql
è!ð
check_£rv”_v”siÚ
, "Numeric server version mismatch");

636 
	`FAIL_IF
(
	`¡rcmp
(
	`mysql_g‘_£rv”_šfo
(
mysql
), 
tmp
) != 0, "String server version mismatch");

637  
OK
;

638 
	}
}

640 
‹¡_cÚc26
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

642 
MYSQL
 *
	gmysql
ð
mysql_š™
(
NULL
);

643 
mysql_ÝtiÚs
(
mysql
, 
MYSQL_SET_CHARSET_NAME
, "utf8");

645 
FAIL_IF
(
my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, "nÙexi¡šgu£r", "·sswÜd", 
schema
, 
pÜt
, 
NULL
, 
CLIENT_REMEMBER_OPTIONS
),

648 
FAIL_IF
(!
mysql
->
ÝtiÚs
.
ch¬£t_Çme
 || 
¡rcmp
(mysql->options.charset_name, "utf8") != 0,

650 
mysql_þo£
(
mysql
);

652 
	gmysql
ð
mysql_š™
(
NULL
);

653 
FAIL_IF
(
my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, "nÙexi¡šgu£r", "·sswÜd", 
schema
, 
pÜt
, 
NULL
, 0),

655 
FAIL_IF
(
mysql
->
ÝtiÚs
.
ch¬£t_Çme
, "Error: options‚ot freed");

656 
mysql_þo£
(
mysql
);

658  
	gOK
;

661 
‹¡_cÚÃùiÚ_timeout
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

663 
	gtimeout
= 5;

664 
time_t
 
	g¡¬t
, 
	g–­£d
;

665 
MYSQL
 *
	gmysql
ð
mysql_š™
(
NULL
);

666 
mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_CONNECT_TIMEOUT
, (*)&
timeout
);

667 
	g¡¬t
ð
time
(
NULL
);

668 ià(
my_‹¡_cÚÃù
(
mysql
, "192.168.1.101", "nÙexi¡šgu£r", "·sswÜd", 
schema
, 
pÜt
, 
NULL
, 
CLIENT_REMEMBER_OPTIONS
))

670 
dŸg
("Errorƒxpected - maybe you haveo change hostname");

671  
	gFAIL
;

673 
	g–­£d
ð
time
(
NULL
è- 
¡¬t
;

674 
dŸg
("–­£d: %lu", ()
–­£d
);

675 
mysql_þo£
(
mysql
);

676 
FAIL_IF
(()
–­£d
 > 2 * 
timeout
, "timeout ignored");

677  
	gOK
;

680 
‹¡_cÚÃùiÚ_timeout2
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

682 
	gtimeout
= 5;

683 
time_t
 
	g¡¬t
, 
	g–­£d
;

684 
MYSQL
 *
	gmysql
;

686 
	gSKIP_SKYSQL
;

687 
	gSKIP_MAXSCALE
;

689 
	gmysql
ð
mysql_š™
(
NULL
);

690 
mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_CONNECT_TIMEOUT
, (*)&
timeout
);

691 
mysql_ÝtiÚs
(
mysql
, 
MYSQL_INIT_COMMAND
, "set @a:=SLEEP(6)");

692 
	g¡¬t
ð
time
(
NULL
);

693 ià(
my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
, 
schema
, 
pÜt
, 
NULL
, 
CLIENT_REMEMBER_OPTIONS
))

695 
dŸg
("timeoutƒrrorƒxpected");

696  
	gFAIL
;

698 
	g–­£d
ð
time
(
NULL
è- 
¡¬t
;

699 
dŸg
("–­£d: %lu", ()
–­£d
);

700 
mysql_þo£
(
mysql
);

701 
FAIL_IF
(()
–­£d
 > 2 * 
timeout
, "timeout ignored");

702  
	gOK
;

705 
‹¡_cÚÃùiÚ_timeout3
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

707 
	gtimeout
= 5;

708 
	g»ad_wr™e_timeout
= 10;

709 
	grc
;

710 
time_t
 
	g¡¬t
, 
	g–­£d
;

711 
MYSQL
 *
	gmysql
ð
mysql_š™
(
NULL
);

712 
mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_CONNECT_TIMEOUT
, (*)&
timeout
);

713 
mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_READ_TIMEOUT
, (*)&
»ad_wr™e_timeout
);

714 
mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_WRITE_TIMEOUT
, (*)&
»ad_wr™e_timeout
);

715 
mysql_ÝtiÚs
(
mysql
, 
MYSQL_INIT_COMMAND
, "set @a:=SLEEP(6)");

716 
	g¡¬t
ð
time
(
NULL
);

717 ià(
my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
, 
schema
, 
pÜt
, 
sock‘Çme
, 
CLIENT_REMEMBER_OPTIONS
))

719 
dŸg
("timeoutƒrrorƒxpected");

720 
	g–­£d
ð
time
(
NULL
è- 
¡¬t
;

721 
dŸg
("–­£d: %lu", ()
–­£d
);

722  
	gFAIL
;

724 
	g–­£d
ð
time
(
NULL
è- 
¡¬t
;

725 
dŸg
("–­£d: %lu", ()
–­£d
);

726 
FAIL_IF
(()
–­£d
 > 
timeout
 + 1, "timeout ignored");

728 
mysql_þo£
(
mysql
);

729 
	gmysql
ð
mysql_š™
(
NULL
);

730 
mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_CONNECT_TIMEOUT
, (*)&
timeout
);

731 
mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_READ_TIMEOUT
, (*)&
»ad_wr™e_timeout
);

732 
mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_WRITE_TIMEOUT
, (*)&
»ad_wr™e_timeout
);

734 ià(!
my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
, 
schema
, 
pÜt
, 
sock‘Çme
, 
CLIENT_REMEMBER_OPTIONS
))

736 
dŸg
("E¼Ü: %s", 
mysql_”rÜ
(
mysql
));

737  
	gFAIL
;

740 
	g¡¬t
ð
time
(
NULL
);

741 
	grc
ð
mysql_qu”y
(
mysql
, "SET @a:=SLEEP(12)");

742 
	g–­£d
ð
time
(
NULL
è- 
¡¬t
;

743 
dŸg
("–­£d: %lu", ()
–­£d
);

744 
FAIL_IF
(!
rc
, "timeoutƒxpected");

745 
mysql_þo£
(
mysql
);

746  
	gOK
;

751 
	$‹¡_cÚc118
(
MYSQL
 *
mysql
)

753 
rc
;

754 
my_boÞ
 
»cÚÃù
= 1;

755 
SKIP_SKYSQL
;

756 
SKIP_MAXSCALE
;

758 
	`mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_RECONNECT
, &
»cÚÃù
);

760 
mysql
->
ÝtiÚs
.
unu£d_1
= 1;

762 
rc
ð
	`mysql_kžl
(
mysql
, 
	`mysql_th»ad_id
(mysql));

764 
	`mysql_pšg
(
mysql
);

766 
rc
ð
	`mysql_qu”y
(
mysql
, "SET @a:=1");

767 
	`check_mysql_rc
(
rc
, 
mysql
);

769 
	`FAIL_IF
(
mysql
->
ÝtiÚs
.
unu£d_1
 != 1, "options got†ost");

771 
rc
ð
	`mysql_kžl
(
mysql
, 
	`mysql_th»ad_id
(mysql));

773 
	`mysql_pšg
(
mysql
);

774 
rc
ð
	`mysql_qu”y
(
mysql
, "SET @a:=1");

775 
	`check_mysql_rc
(
rc
, 
mysql
);

777  
OK
;

778 
	}
}

780 
‹¡_wrÚg_bšd_add»ss
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

782 cÚ¡ *
	gbšd_addr
= "100.188.111.112";

783 
MYSQL
 *
	gmysql
;

785 ià(!
	gho¡Çme
 || !
¡rcmp
(
ho¡Çme
, "localhost"))

787 
dŸg
("test doesn't work with unix sockets");

788  
	gSKIP
;

791 
	gmysql
ð
mysql_š™
(
NULL
);

793 
mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_BIND
, 
bšd_addr
);

794 ià(
my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
,

795 
·sswÜd
, 
schema
, 
pÜt
, 
sock‘Çme
, 0))

797 
dŸg
("Errorƒxpected");

798 
mysql_þo£
(
mysql
);

799  
	gFAIL
;

801 
dŸg
("E¼Ü: %s", 
mysql_”rÜ
(
mysql
));

802 
mysql_þo£
(
mysql
);

803  
	gOK
;

806 
	$‹¡_bšd_add»ss
(
MYSQL
 *
my
)

808 
MYSQL
 *
mysql
;

809 *
bšd_addr
ð
	`g‘’v
("MYSQL_TEST_BINDADDR");

810 
qu”y
[128];

811 
rc
;

813 
SKIP_SKYSQL
;

815 ià(!
ho¡Çme
 || !
	`¡rcmp
(hostname, "localhost"))

817 
	`dŸg
("test doesn't work with unix sockets");

818  
SKIP
;

821 
	`¥rštf
(
qu”y
, "DROP USER '%s'@'%s'", 
u£ºame
, 
bšd_addr
);

822 
rc
ð
	`mysql_qu”y
(
my
, 
qu”y
);

824 
	`¥rštf
(
qu”y
, "CREATE USER '%s'@'%s' IDENTIFIED BY '%s'", 
u£ºame
, 
bšd_addr
, 
·sswÜd
);

825 
rc
ð
	`mysql_qu”y
(
my
, 
qu”y
);

826 
	`check_mysql_rc
(
rc
, 
my
);

828 
	`¥rštf
(
qu”y
, "GRANT ALL ON %s.* TO '%s'@'%s'", 
schema
, 
u£ºame
, 
bšd_addr
);

829 
rc
ð
	`mysql_qu”y
(
my
, 
qu”y
);

830 
	`check_mysql_rc
(
rc
, 
my
);

832 ià(!
bšd_addr
)

834 
	`dŸg
("No bind‡ddress specified");

835  
SKIP
;

838 
mysql
ð
	`mysql_š™
(
NULL
);

839 
	`mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_BIND
, 
bšd_addr
);

841 ià(!
	`my_‹¡_cÚÃù
(
mysql
, 
bšd_addr
, 
u£ºame
,

842 
·sswÜd
, 
schema
, 
pÜt
, 
sock‘Çme
, 0))

844 
	`dŸg
("E¼Ü: %s\n", 
	`mysql_”rÜ
(
mysql
));

845 
	`mysql_þo£
(
mysql
);

846  
FAIL
;

848 
	`dŸg
("%s", 
	`mysql_g‘_ho¡_šfo
(
mysql
));

849 
	`mysql_þo£
(
mysql
);

850  
OK
;

851 
	}
}

853 
‹¡_g‘_ÝtiÚs
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

855 
MYSQL
 *
	gmysql
ð
mysql_š™
(
NULL
);

856 
	gÝtiÚs_št
[]ð{
MYSQL_OPT_CONNECT_TIMEOUT
, 
MYSQL_OPT_LOCAL_INFILE
,

857 
MYSQL_OPT_PROTOCOL
, 
MYSQL_OPT_READ_TIMEOUT
, 
MYSQL_OPT_WRITE_TIMEOUT
, 0};

858 
my_boÞ
 
	gÝtiÚs_boÞ
[]ð{
MYSQL_OPT_RECONNECT
, 
MYSQL_REPORT_DATA_TRUNCATION
,

859 
MYSQL_OPT_COMPRESS
, 
MYSQL_OPT_SSL_VERIFY_SERVER_CERT
, 
MYSQL_SECURE_AUTH
,

860 #ifdeà
_WIN32


861 
MYSQL_OPT_NAMED_PIPE
,

864 
	gÝtiÚs_ch¬
[]ð{
MYSQL_READ_DEFAULT_FILE
, 
MYSQL_READ_DEFAULT_GROUP
, 
MYSQL_SET_CHARSET_NAME
,

865 
MYSQL_OPT_SSL_KEY
, 
MYSQL_OPT_SSL_CA
, 
MYSQL_OPT_SSL_CERT
, 
MYSQL_OPT_SSL_CAPATH
,

866 
MYSQL_OPT_SSL_CIPHER
, 
MYSQL_OPT_BIND
, 
MARIADB_OPT_SSL_FP
, 
MARIADB_OPT_SSL_FP_LIST
,

867 
MARIADB_OPT_TLS_PASSPHRASE
, 0};

869 cÚ¡ *
	gš™_commªd
[3]= {"SET @a:=1", "SET @b:=2", "SET @c:=3"};

870 
	g–em’ts
= 0;

871 **
	gcommªd
;

874 
	gštv®
[2]= {1, 0};

875 
my_boÞ
 
	gboÞv®
[2]= {1, 0};

876 cÚ¡ *
	gch¬1
= "test";

877 *
	gch¬2
;

878 
	gi
;

879 
MYSQL
 *
	gu£rd©a
;

880 cÚ¡ *
	g©Œ_key
[] = {"foo1", "foo2", "foo3"};

881 cÚ¡ *
	g©Œ_v®
[] = {"bar1", "bar2", "bar3"};

882 **
	gkey
, **
	gv®
;

884 
	gi
=0; 
	gÝtiÚs_št
[
i
]; i++)

886 
mysql_ÝtiÚs
(
mysql
, 
ÝtiÚs_št
[
i
], &
štv®
[0]);

887 
	gštv®
[1]= 0;

888 
mysql_g‘_ÝtiÚv
(
mysql
, 
ÝtiÚs_št
[
i
], &
štv®
[1]);

889 
FAIL_IF
(
štv®
[0] != intval[1], "mysql_get_optionv (int) failed");

891 
	gi
=0; 
	gÝtiÚs_boÞ
[
i
]; i++)

893 
mysql_ÝtiÚs
(
mysql
, 
ÝtiÚs_boÞ
[
i
], &
boÞv®
[0]);

894 
	gštv®
[1]= 0;

895 
mysql_g‘_ÝtiÚv
(
mysql
, 
ÝtiÚs_boÞ
[
i
], &
boÞv®
[1]);

896 
FAIL_IF
(
boÞv®
[0] != boolval[1], "mysql_get_optionv (my_bool) failed");

898 
	gi
=0; 
	gÝtiÚs_ch¬
[
i
]; i++)

900 
mysql_ÝtiÚs
(
mysql
, 
ÝtiÚs_ch¬
[
i
], 
ch¬1
);

901 
	gch¬2
ð
NULL
;

902 
mysql_g‘_ÝtiÚv
(
mysql
, 
ÝtiÚs_ch¬
[
i
], (*)&
ch¬2
);

903 ià(
	gÝtiÚs_ch¬
[
i
] !ð
MYSQL_SET_CHARSET_NAME
)

904 
FAIL_IF
(
¡rcmp
(
ch¬1
, 
ch¬2
), "mysql_get_optionv (char) failed");

907 
	gi
=0; i < 3; i++)

908 
mysql_ÝtiÚs
(
mysql
, 
MYSQL_INIT_COMMAND
, 
š™_commªd
[
i
]);

910 
mysql_g‘_ÝtiÚv
(
mysql
, 
MYSQL_INIT_COMMAND
, &
commªd
, &
–em’ts
);

911 
FAIL_IF
(
–em’ts
 != 3, "expected 3ƒlements");

912 
	gi
=0; i < 3; i++)

913 
FAIL_IF
(
¡rcmp
(
š™_commªd
[
i
], 
commªd
[i]), "wrong init command");

914 
	gi
=0; i < 3; i++)

915 
mysql_ÝtiÚsv
(
mysql
, 
MYSQL_OPT_CONNECT_ATTR_ADD
, 
©Œ_key
[
i
], 
©Œ_v®
[i]);

917 
mysql_g‘_ÝtiÚv
(
mysql
, 
MYSQL_OPT_CONNECT_ATTRS
, 
NULL
, NULL, &
–em’ts
);

918 
FAIL_IF
(
–em’ts
 != 3, "expected 3 connection‡ttributes");

920 
	gkey
ð(**)
m®loc
((*è* 
–em’ts
);

921 
	gv®
ð(**)
m®loc
((*è* 
–em’ts
);

923 
mysql_g‘_ÝtiÚv
(
mysql
, 
MYSQL_OPT_CONNECT_ATTRS
, &
key
, &
v®
, &
–em’ts
);

924 
	gi
=0; i < 
	g–em’ts
; i++)

926 
dŸg
("% => %s", 
key
[
i
], 
v®
[i]);

929 
ä“
(
key
);

930 
ä“
(
v®
);

932 
mysql_ÝtiÚsv
(
mysql
, 
MARIADB_OPT_USERDATA
, "my_app", (*)mysql);

933 
mysql_g‘_ÝtiÚv
(
mysql
, 
MARIADB_OPT_USERDATA
, (*)"my_­p", &
u£rd©a
);

935 
FAIL_IF
(
mysql
 !ð
u£rd©a
, "wrong userdata");

936 
mysql_þo£
(
mysql
);

937  
	gOK
;

940 
	$‹¡_£ss_Œack_db
(
MYSQL
 *
mysql
)

942 
rc
;

943 cÚ¡ *
d©a
;

944 
size_t
 
Ën
;

945 
tmp_¡r
[512];

948 ià(!(
mysql
->
£rv”_ÿ·bž™›s
 & 
CLIENT_SESSION_TRACKING
))

950 
	`dŸg
("S”v” dÛ¢'ˆsuµÜˆ£ssiÚ¿ckšg (ÿp=%lu)", 
mysql
->
£rv”_ÿ·bž™›s
);

951  
SKIP
;

954 
rc
ð
	`mysql_qu”y
(
mysql
, "USE mysql");

955 
	`check_mysql_rc
(
rc
, 
mysql
);

956 
	`FAIL_IF
(
	`¡rcmp
(
mysql
->
db
, "mysql"), "Expected‚ew schema 'mysql'");

958 
	`FAIL_IF
(
	`mysql_£ssiÚ_Œack_g‘_fœ¡
(
mysql
, 
SESSION_TRACK_SCHEMA
, &
d©a
, &
Ën
),

960 
	`FAIL_IF
(
	`¡ºcmp
(
d©a
, "mysql", 
Ën
), "Expected‚ew schema 'mysql'");

962 
	`¥rštf
(
tmp_¡r
, "USE %s", 
schema
);

963 
rc
ð
	`mysql_qu”y
(
mysql
, 
tmp_¡r
);

964 
	`check_mysql_rc
(
rc
, 
mysql
);

966 
	`¥rštf
(
tmp_¡r
, "Ex³ùed‚ew schem¨'%s'.", 
schema
);

968 
	`FAIL_IF
(
	`¡rcmp
(
mysql
->
db
, 
schema
), 
tmp_¡r
);

970 
	`FAIL_IF
(
	`mysql_£ssiÚ_Œack_g‘_fœ¡
(
mysql
, 
SESSION_TRACK_SCHEMA
, &
d©a
, &
Ën
),

972 
	`FAIL_IF
(
	`¡ºcmp
(
d©a
, 
schema
, 
Ën
), 
tmp_¡r
);

974 ià(
	`mysql_g‘_£rv”_v”siÚ
(
mysql
) >= 100300)

976 
	`dŸg
("ch¬£t: %s", 
mysql
->
ch¬£t
->
c¢ame
);

977 
rc
ð
	`mysql_qu”y
(
mysql
, "SET NAMES utf8");

978 
	`check_mysql_rc
(
rc
, 
mysql
);

979 ià(!
	`mysql_£ssiÚ_Œack_g‘_fœ¡
(
mysql
, 
SESSION_TRACK_SYSTEM_VARIABLES
, &
d©a
, &
Ën
))

981 
	`´štf
("# SESSION_TRACK_VARIABLES: %*.*s\n", ()
Ën
, (î’, 
d©a
);

982 } !
	`mysql_£ssiÚ_Œack_g‘_Ãxt
(
mysql
, 
SESSION_TRACK_SYSTEM_VARIABLES
, &
d©a
, &
Ën
));

983 
	`dŸg
("ch¬£t: %s", 
mysql
->
ch¬£t
->
c¢ame
);

984 
	`FAIL_IF
(
	`¡rcmp
(
mysql
->
ch¬£t
->
c¢ame
, "utf8"), "Expected charset 'utf8'");

986 
rc
ð
	`mysql_qu”y
(
mysql
, "SET NAMES†atin1");

987 
	`check_mysql_rc
(
rc
, 
mysql
);

988 
	`FAIL_IF
(
	`¡rcmp
(
mysql
->
ch¬£t
->
c¢ame
, "latin1"), "Expected charset 'latin1'");

990 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE PROCEDURE…1() "

996 
	`check_mysql_rc
(
rc
, 
mysql
);

998 
rc
ð
	`mysql_qu”y
(
mysql
, "CALL…1()");

999 
	`check_mysql_rc
(
rc
, 
mysql
);

1001 ià(!
	`mysql_£ssiÚ_Œack_g‘_fœ¡
(
mysql
, 
SESSION_TRACK_SYSTEM_VARIABLES
, &
d©a
, &
Ën
))

1003 
	`´štf
("# SESSION_TRACK_VARIABLES: %*.*s\n", ()
Ën
, (î’, 
d©a
);

1004 } !
	`mysql_£ssiÚ_Œack_g‘_Ãxt
(
mysql
, 
SESSION_TRACK_SYSTEM_VARIABLES
, &
d©a
, &
Ën
));

1006 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP PROCEDURE IF EXISTS…1");

1007 
	`check_mysql_rc
(
rc
, 
mysql
);

1009  
OK
;

1010 
	}
}

1012 
	$‹¡_cÚc496
(
MYSQL
 *
mysql
)

1014 
rc
;

1015 cÚ¡ *
d©a
;

1016 
size_t
 
Ën
;

1018 
rc
ð
	`mysql_qu”y
(
mysql
, "set @@session.session_track_transaction_info=STATE");

1020 ià(
rc
 && 
	`mysql_”ºo
(
mysql
è=ð
ER_UNKNOWN_SYSTEM_VARIABLE
)

1022 
	`dŸg
("session_track_transaction_info‚ot supported");

1023  
SKIP
;

1026 
	`check_mysql_rc
(
rc
, 
mysql
);

1028 
rc
ð
	`mysql_qu”y
(
mysql
, "BEGIN");

1029 
	`check_mysql_rc
(
rc
, 
mysql
);

1030 ià(!
	`mysql_£ssiÚ_Œack_g‘_fœ¡
(
mysql
, 
SESSION_TRACK_TRANSACTION_STATE
, &
d©a
, &
Ën
))

1032 
	`FAIL_IF
(
Ën
 != 8, "expected 8 bytes");

1033 
	`FAIL_IF
(
d©a
[0] != 'T', "expectedransaction");

1034 } !
	`mysql_£ssiÚ_Œack_g‘_Ãxt
(
mysql
, 
SESSION_TRACK_TRANSACTION_STATE
, &
d©a
, &
Ën
));

1036 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TEMPORARY TABLE1(a int) ENGINE=InnoDB");

1037 
	`check_mysql_rc
(
rc
, 
mysql
);

1038 
rc
ð
	`mysql_qu”y
(
mysql
, "COMMIT");

1040 
	`check_mysql_rc
(
rc
, 
mysql
);

1042 ià(!
	`mysql_£ssiÚ_Œack_g‘_fœ¡
(
mysql
, 
SESSION_TRACK_TRANSACTION_STATE
, &
d©a
, &
Ën
))

1044 
	`FAIL_IF
(
Ën
 != 8, "expected 8 bytes");

1045 
	`FAIL_IF
(
d©a
[0] != '_', "expected underscore");

1046 } !
	`mysql_£ssiÚ_Œack_g‘_Ãxt
(
mysql
, 
SESSION_TRACK_TRANSACTION_STATE
, &
d©a
, &
Ën
));

1048  
OK
;

1049 
	}
}

1052 
‹¡_unix_sock‘_þo£
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

1054 #ifdeà
_WIN32


1055 
dŸg
("test does‚ot„un on Windows");

1056  
	gSKIP
;

1058 
MYSQL
 *
	gmysql
ð
mysql_š™
(
NULL
);

1059 
FILE
 *
	gå
;

1060 
	gi
;

1062 
	gSKIP_SKYSQL
;

1063 
SKIP_TRAVIS
();

1065 ià(!(
	gå
ð
fÝ’
("./dummy_sock", "w")))

1067 
dŸg
("couldn't create dummy socket");

1068  
	gFAIL
;

1070 
fþo£
(
å
);

1072 
	gi
=0; i < 10000; i++)

1074 
my_‹¡_cÚÃù
(
mysql
, "loÿlho¡", "u£r", "·sswd", 
NULL
, 0, "./dummy_sock", 0);

1076 ià(
mysql_”ºo
(
mysql
) == 2001)

1078 
dŸg
("ouˆoàsock‘ aá” %d‡‰em±s", 
i
);

1079 
mysql_þo£
(
mysql
);

1080  
	gFAIL
;

1083 
mysql_þo£
(
mysql
);

1084  
	gOK
;

1089 
	$‹¡_»£t
(
MYSQL
 *
mysql
)

1091 
rc
;

1092 
MYSQL_RES
 *
»s
;

1094 ià(
	`mysql_g‘_£rv”_v”siÚ
(
mysql
) < 100200)

1095  
SKIP
;

1097 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

1098 
	`check_mysql_rc
(
rc
, 
mysql
);

1100 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE1 (a int)");

1101 
	`check_mysql_rc
(
rc
, 
mysql
);

1103 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTO1 VALUES (1),(2),(3)");

1104 
	`check_mysql_rc
(
rc
, 
mysql
);

1106 
	`FAIL_IF
(
	`mysql_afãùed_rows
(
mysql
) != 3, "Expected 3„ows");

1108 
rc
ð
	`mysql_»£t_cÚÃùiÚ
(
mysql
);

1109 
	`check_mysql_rc
(
rc
, 
mysql
);

1111 
	`FAIL_IF
(
	`mysql_afãùed_rows
(
mysql
è!ð~(
my_ulÚglÚg
)0, "Expected 0„ows");

1113 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT‡ FROM1");

1114 
	`check_mysql_rc
(
rc
, 
mysql
);

1116 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT 1 FROM DUAL");

1117 
	`FAIL_IF
(!
rc
, "Errorƒxpected");

1119 
rc
ð
	`mysql_»£t_cÚÃùiÚ
(
mysql
);

1120 
	`check_mysql_rc
(
rc
, 
mysql
);

1122 
»s
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

1123 
	`FAIL_IF
(
»s
, "expected‚o„esult");

1125 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT‡ FROM1");

1126 
	`check_mysql_rc
(
rc
, 
mysql
);

1128 
»s
ð
	`mysql_u£_»suÉ
(
mysql
);

1129 
	`FAIL_IF
(!
»s
, "expected„esult");

1131 
rc
ð
	`mysql_»£t_cÚÃùiÚ
(
mysql
);

1132 
	`check_mysql_rc
(
rc
, 
mysql
);

1134 
	`FAIL_IF
(
	`mysql_ãtch_row
(
»s
), "expectedƒrror");

1136 
	`mysql_ä“_»suÉ
(
»s
);

1138 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE1");

1139 
	`check_mysql_rc
(
rc
, 
mysql
);

1141  
OK
;

1142 
	}
}

1144 
	$‹¡_auth256
(
MYSQL
 *
my
)

1146 
MYSQL
 *
mysql
ð
	`mysql_š™
(
NULL
);

1147 
rc
;

1148 
MYSQL_RES
 *
»s
;

1149 
my_ulÚglÚg
 
num_rows
= 0;

1150 
qu”y
[1024];

1151 
SKIP_MAXSCALE
;

1153 ià(
	`IS_SKYSQL
(
ho¡Çme
))

1154  
SKIP
;

1156 ià(!
	`mysql_þ›Á_fšd_¶ugš
(
mysql
, "sha256_·sswÜd", 
MYSQL_CLIENT_AUTHENTICATION_PLUGIN
))

1158 
	`dŸg
("sha256_password…lugin‚ot‡vailable");

1159 
	`mysql_þo£
(
mysql
);

1160  
SKIP
;

1163 
rc
ð
	`mysql_qu”y
(
my
, "SELECT * FROM information_schema.plugins where…lugin_name='sha256_password'");

1164 
	`check_mysql_rc
(
rc
, 
mysql
);

1166 
»s
ð
	`mysql_¡Üe_»suÉ
(
my
);

1167 
num_rows
ð
	`mysql_num_rows
(
»s
);

1168 
	`mysql_ä“_»suÉ
(
»s
);

1170 ià(!
num_rows
)

1172 
	`dŸg
("server doesn't support sha256‡uthentication");

1173 
	`mysql_þo£
(
mysql
);

1174  
SKIP
;

1177 
rc
ð
	`mysql_qu”y
(
my
, "DROP USER IF EXISTS sha256user@localhost");

1178 
	`check_mysql_rc
(
rc
, 
mysql
);

1180 
	`¥rštf
(
qu”y
, "CREATE u£¸'sha256u£r'@'%s' id’tif›d w™h sha256_·sswÜd by 'foo'", 
this_ho¡
);

1181 
rc
ð
	`mysql_qu”y
(
my
, 
qu”y
);

1182 
	`check_mysql_rc
(
rc
, 
my
);

1184 ià(!
	`my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, "sha256u£r", "foo", 
NULL
, 
pÜt
, 
sock‘Çme
, 0))

1186 
	`dŸg
("”rÜ: %s", 
	`mysql_”rÜ
(
mysql
));

1187 
	`mysql_þo£
(
mysql
);

1188  
FAIL
;

1190 
	`mysql_þo£
(
mysql
);

1192 
mysql
ð
	`mysql_š™
(
NULL
);

1193 
	`mysql_ÝtiÚs
(
mysql
, 
MYSQL_SERVER_PUBLIC_KEY
, "rsa_public_key.pem");

1194 ià(!
	`my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, "sha256u£r", "foo", 
NULL
, 
pÜt
, 
sock‘Çme
, 0))

1196 
	`dŸg
("”rÜ: %s", 
	`mysql_”rÜ
(
mysql
));

1197 
	`mysql_þo£
(
mysql
);

1198  
FAIL
;

1200 
	`mysql_þo£
(
mysql
);

1201 
	`¥rštf
(
qu”y
, "DROP USER 'sha256u£r'@'%s'", 
this_ho¡
);

1202 
rc
ð
	`mysql_qu”y
(
my
, 
qu”y
);

1203 
	`check_mysql_rc
(
rc
, 
mysql
);

1204  
OK
;

1205 
	}
}

1207 
‹¡_mdev13100
(
MYSQL
 *
my
 
__©Œibu‹__
((
unu£d
)))

1209 
MYSQL
 *
	gmysql
ð
mysql_š™
(
NULL
);

1210 
	grc
;

1211 
FILE
 *
	gå
;

1213 ià(!(
	gå
ð
fÝ’
("./mdev13100.cnf", "w")))

1214  
	gFAIL
;

1217 
årštf
(
å
, "[client]\n");

1218 
årštf
(
å
, "default-character-set=latin2\n");

1220 
fþo£
(
å
);

1222 
	grc
ð
mysql_ÝtiÚs
(
mysql
, 
MYSQL_READ_DEFAULT_FILE
, "./mdev13100.cnf");

1223 
check_mysql_rc
(
rc
, 
mysql
);

1225 ià(!
my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
,

1226 
·sswÜd
, 
schema
, 
pÜt
, 
sock‘Çme
, 0))

1228 
dŸg
("E¼Ü: %s", 
mysql_”rÜ
(
mysql
));

1229  
	gFAIL
;

1231 
FAIL_IF
(
¡rcmp
("Ïtš2", 
mysql_ch¬aù”_£t_Çme
(
mysql
)), "Expected charset†atin2");

1232 
mysql_þo£
(
mysql
);

1235 
	gmysql
ð
mysql_š™
(
NULL
);

1236 ià(!(
	gå
ð
fÝ’
("./mdev13100.cnf", "w")))

1237  
	gFAIL
;

1239 
årštf
(
å
, "[client]\n");

1240 
årštf
(
å
, "default-character-set=latin1\n");

1241 
årštf
(
å
, "[client-server]\n");

1242 
årštf
(
å
, "default-character-set=latin2\n");

1244 
fþo£
(
å
);

1246 
	grc
ð
mysql_ÝtiÚs
(
mysql
, 
MYSQL_READ_DEFAULT_FILE
, "./mdev13100.cnf");

1247 
check_mysql_rc
(
rc
, 
mysql
);

1249 ià(!
my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
,

1250 
·sswÜd
, 
schema
, 
pÜt
, 
sock‘Çme
, 0))

1252 
dŸg
("E¼Ü: %s", 
mysql_”rÜ
(
mysql
));

1253  
	gFAIL
;

1255 
FAIL_IF
(
¡rcmp
("Ïtš2", 
mysql_ch¬aù”_£t_Çme
(
mysql
)), "Expected charset†atin2");

1256 
mysql_þo£
(
mysql
);

1259 
	gmysql
ð
mysql_š™
(
NULL
);

1261 ià(!(
	gå
ð
fÝ’
("./mdev13100.cnf", "w")))

1262  
	gFAIL
;

1264 
årštf
(
å
, "[client]\n");

1265 
årštf
(
å
, "default-character-set=latin1\n");

1266 
årštf
(
å
, "[client-server]\n");

1267 
årštf
(
å
, "default-character-set=utf8\n");

1268 
årštf
(
å
, "[client-mariadb]\n");

1269 
årštf
(
å
, "default-character-set=latin2\n");

1271 
fþo£
(
å
);

1273 
	grc
ð
mysql_ÝtiÚs
(
mysql
, 
MYSQL_READ_DEFAULT_FILE
, "./mdev13100.cnf");

1274 
check_mysql_rc
(
rc
, 
mysql
);

1276 ià(!
my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
,

1277 
·sswÜd
, 
schema
, 
pÜt
, 
sock‘Çme
, 0))

1279 
dŸg
("E¼Ü: %s", 
mysql_”rÜ
(
mysql
));

1280  
	gFAIL
;

1282 
FAIL_IF
(
¡rcmp
("Ïtš2", 
mysql_ch¬aù”_£t_Çme
(
mysql
)), "Expected charset†atin2");

1283 
mysql_þo£
(
mysql
);

1286 
	gmysql
ð
mysql_š™
(
NULL
);

1287 ià(!(
	gå
ð
fÝ’
("./mdev13100.cnf", "w")))

1288  
	gFAIL
;

1290 
årštf
(
å
, "[client]\n");

1291 
årštf
(
å
, "default-character-set=latin1\n");

1292 
årštf
(
å
, "[client-server]\n");

1293 
årštf
(
å
, "default-character-set=latin1\n");

1294 
årštf
(
å
, "[client-mariadb]\n");

1295 
årštf
(
å
, "default-character-set=utf8\n");

1296 
årštf
(
å
, "[mdev13100]\n");

1297 
årštf
(
å
, "default-character-set=latin2\n");

1299 
fþo£
(
å
);

1301 
	grc
ð
mysql_ÝtiÚs
(
mysql
, 
MYSQL_READ_DEFAULT_FILE
, "./mdev13100.cnf");

1302 
check_mysql_rc
(
rc
, 
mysql
);

1303 
	grc
ð
mysql_ÝtiÚs
(
mysql
, 
MYSQL_READ_DEFAULT_GROUP
, "mdev13100");

1304 
check_mysql_rc
(
rc
, 
mysql
);

1306 ià(!
my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
,

1307 
·sswÜd
, 
schema
, 
pÜt
, 
sock‘Çme
, 0))

1309 
dŸg
("E¼Ü: %s", 
mysql_”rÜ
(
mysql
));

1310  
	gFAIL
;

1312 
FAIL_IF
(
¡rcmp
("Ïtš2", 
mysql_ch¬aù”_£t_Çme
(
mysql
)), "Expected charset†atin2");

1313 
mysql_þo£
(
mysql
);

1316 
	gmysql
ð
mysql_š™
(
NULL
);

1317 ià(!(
	gå
ð
fÝ’
("./mdev13100.cnf", "w")))

1318  
	gFAIL
;

1320 
årštf
(
å
, "[client]\n");

1321 
årštf
(
å
, "default-character-set=utf8\n");

1322 
årštf
(
å
, "[client-server]\n");

1323 
årštf
(
å
, "default-character-set=utf8\n");

1324 
årštf
(
å
, "[client-mariadb]\n");

1325 
årštf
(
å
, "default-character-set=latin2\n");

1327 
fþo£
(
å
);

1329 
	grc
ð
mysql_ÝtiÚs
(
mysql
, 
MYSQL_READ_DEFAULT_FILE
, "./mdev13100.cnf");

1330 
check_mysql_rc
(
rc
, 
mysql
);

1331 
	grc
ð
mysql_ÝtiÚs
(
mysql
, 
MYSQL_READ_DEFAULT_GROUP
, "");

1332 
check_mysql_rc
(
rc
, 
mysql
);

1334 ià(!
my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
,

1335 
·sswÜd
, 
schema
, 
pÜt
, 
sock‘Çme
, 0))

1337 
dŸg
("E¼Ü: %s", 
mysql_”rÜ
(
mysql
));

1338  
	gFAIL
;

1340 
dŸg
("ch¬aù” s‘: %s", 
mysql_ch¬aù”_£t_Çme
(
mysql
));

1341 
FAIL_IF
(
¡rcmp
("Ïtš2", 
mysql_ch¬aù”_£t_Çme
(
mysql
)), "Expected charset†atin2");

1342 
mysql_þo£
(
mysql
);

1344 
»move
("./mdev13100.cnf");

1346  
	gOK
;

1349 
‹¡_cÚc276
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

1351 
MYSQL
 *
	gmysql
ð
mysql_š™
(
NULL
);

1352 
	grc
;

1353 
my_boÞ
 
	gv®
= 1;

1355 
mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_SSL_ENFORCE
, &
v®
);

1356 
mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_RECONNECT
, &
v®
);

1358 ià(!
my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
, 
schema
, 
pÜt
, 
sock‘Çme
, 0))

1360 
dŸg
("CÚÃùiÚ fažed. E¼Ü: %s", 
mysql_”rÜ
(
mysql
));

1361 
mysql_þo£
(
mysql
);

1362  
	gFAIL
;

1364 
dŸg
("Ch” iÀu£: %s", 
mysql_g‘_s¦_ch”
(
mysql
));

1366 
	grc
ð
m¬Ÿdb_»cÚÃù
(
mysql
);

1367 
check_mysql_rc
(
rc
, 
mysql
);

1369 
dŸg
("Ch” iÀu£: %s", 
mysql_g‘_s¦_ch”
(
mysql
));

1371 
	grc
ð
mysql_qu”y
(
mysql
, "SET @a:=1");

1372 
check_mysql_rc
(
rc
, 
mysql
);

1374 
mysql_þo£
(
mysql
);

1375  
	gOK
;

1378 
	$‹¡_expœed_pw
(
MYSQL
 *
my
)

1380 
MYSQL
 *
mysql
;

1381 
rc
;

1382 
qu”y
[512];

1383 
expœe
= 1;

1385 ià(
	`m¬Ÿdb_cÚÃùiÚ
(
my
) ||

1386 !(
my
->
£rv”_ÿ·bž™›s
 & 
CLIENT_CAN_HANDLE_EXPIRED_PASSWORDS
))

1388 
	`dŸg
("Server doesn't support…asswordƒxpiration");

1389  
SKIP
;

1391 
	`¥rštf
(
qu”y
, "DROP USER 'foo'@'%s'", 
this_ho¡
);

1392 
rc
ð
	`mysql_qu”y
(
my
, 
qu”y
);

1394 
	`¥rštf
(
qu”y
, "CREATE USER 'foo'@'%s' IDENTIFIED BY 'foo'", 
this_ho¡
);

1395 
rc
ð
	`mysql_qu”y
(
my
, 
qu”y
);

1396 
	`check_mysql_rc
(
rc
, 
my
);

1398 
	`¥rštf
(
qu”y
, "GRANT ALL ON *.* TO 'foo'@'%s'", 
this_ho¡
);

1399 
rc
ð
	`mysql_qu”y
(
my
, 
qu”y
);

1400 
	`check_mysql_rc
(
rc
, 
my
);

1402 
	`¥rštf
(
qu”y
, "ALTER USER 'foo'@'%s' PASSWORD EXPIRE", 
this_ho¡
);

1403 
rc
ð
	`mysql_qu”y
(
my
, 
qu”y
);

1404 
	`check_mysql_rc
(
rc
, 
my
);

1406 
mysql
ð
	`mysql_š™
(
NULL
);

1408 
	`my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, "foo", "foo", 
schema
,

1409 
pÜt
, 
sock‘Çme
, 0);

1411 
	`FAIL_IF
(!
	`mysql_”ºo
(
mysql
), "Errorƒxpected");

1412 
	`mysql_þo£
(
mysql
);

1414 
mysql
ð
	`mysql_š™
(
NULL
);

1415 
	`mysql_ÝtiÚsv
(
mysql
, 
MYSQL_OPT_CAN_HANDLE_EXPIRED_PASSWORDS
, &
expœe
);

1417 
	`my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, "foo", "foo", 
schema
,

1418 
pÜt
, 
sock‘Çme
, 0);

1421 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

1422 
	`FAIL_IF
(!
rc
, "Errorƒxpected (we‡re in sandbox mode");

1424 
	`dŸg
("”rÜ: %d %s", 
	`mysql_”ºo
(
mysql
), 
	`mysql_”rÜ
(mysql));

1425 
	`FAIL_IF
(
	`mysql_”ºo
(
mysql
è!ð
ER_MUST_CHANGE_PASSWORD
 &&

1426 
	`mysql_”ºo
(
mysql
è!ð
ER_MUST_CHANGE_PASSWORD_LOGIN
, "Error 1820/1862ƒxpected");

1428 
	`mysql_þo£
(
mysql
);

1430 
	`¥rštf
(
qu”y
, "DROP USER 'foo'@'%s'", 
this_ho¡
);

1431 
rc
ð
	`mysql_qu”y
(
my
, 
qu”y
);

1432 
	`check_mysql_rc
(
rc
, 
my
);

1434  
OK
;

1435 
	}
}

1437 
	$‹¡_cÚc315
(
MYSQL
 *
mysql
)

1439 
rc
;

1440 cÚ¡ *
c¢ame
;

1441 
SKIP_SKYSQL
;

1442 
SKIP_MAXSCALE
;

1444 ià(!
is_m¬Ÿdb
)

1445  
SKIP
;

1447 
	`mysql_g‘_ÝtiÚv
(
mysql
, 
MYSQL_SET_CHARSET_NAME
, (*)&
c¢ame
);

1448 
	`dŸg
("c¢ame=%s", 
c¢ame
);

1449 
	`FAIL_UNLESS
(
	`¡rcmp
(
c¢ame
, 
MARIADB_DEFAULT_CHARSET
) == 0, "Wrong default character set");

1451 
rc
ð
	`mysql_chªge_u£r
(
mysql
, 
u£ºame
, 
·sswÜd
, 
schema
);

1452 
	`check_mysql_rc
(
rc
, 
mysql
);

1453 
	`mysql_g‘_ÝtiÚv
(
mysql
, 
MYSQL_SET_CHARSET_NAME
, (*)&
c¢ame
);

1454 
	`FAIL_UNLESS
(
	`¡rcmp
(
c¢ame
, 
MARIADB_DEFAULT_CHARSET
) == 0, "Wrong default character set");

1455  
OK
;

1456 
	}
}

1457 #iâdeà
WIN32


1458 
‹¡_cÚc317
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

1460 
MYSQL
 *
	gmysql
;

1461 
my_boÞ
 
	g»cÚÃù
 = 0;

1462 
FILE
 *
	gå
ð
NULL
;

1463 cÚ¡ *
	g’v
ð
g‘’v
("MYSQL_TMP_DIR");

1464 
	gúf_fže1
[
FN_REFLEN
 + 1];

1466 
	gSKIP_SKYSQL
;

1468 ià(
	gŒavis_‹¡
)

1469  
	gSKIP
;

1471 ià(!
	g’v
)

1472 
	g’v
= "/tmp";

1474 
£‹nv
("HOME", 
’v
, 1);

1476 
¢´štf
(
úf_fže1
, 
FN_REFLEN
, "%s%c.my.úf", 
’v
, 
FN_LIBCHAR
);

1478 
FAIL_IF
(!
acûss
(
úf_fže1
, 
R_OK
), "access");

1480 
	gmysql
ð
mysql_š™
(
NULL
);

1481 
	gå
ð
fÝ’
(
úf_fže1
, "w");

1482 
FAIL_IF
(!
å
, "fopen");

1484 
årštf
(
å
, "[client]\ndefault-character-set =†atin2\nreconnect= 1\n");

1485 
fþo£
(
å
);

1487 
mysql_ÝtiÚs
(
mysql
, 
MYSQL_READ_DEFAULT_GROUP
, "");

1488 
my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
,

1489 
schema
, 0, 
sock‘Çme
, 0);

1491 
»move
(
úf_fže1
);

1493 
FAIL_IF
(
¡rcmp
(
mysql_ch¬aù”_£t_Çme
(
mysql
), "latin2"), "expected charset†atin2");

1494 
mysql_g‘_ÝtiÚv
(
mysql
, 
MYSQL_OPT_RECONNECT
, &
»cÚÃù
);

1495 
FAIL_IF
(
»cÚÃù
 != 1, "expected„econnect=1");

1496 
mysql_þo£
(
mysql
);

1497  
	gOK
;

1500 
‹¡_cÚc327
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

1502 
MYSQL
 *
	gmysql
;

1503 
my_boÞ
 
	g»cÚÃù
 = 0;

1504 
FILE
 *
	gå1
ð
NULL
, *
	gå2
= NULL;

1505 cÚ¡ *
	g’v
ð
g‘’v
("MYSQL_TMP_DIR");

1506 
	gúf_fže1
[
FN_REFLEN
 + 1];

1507 
	gúf_fže2
[
FN_REFLEN
 + 1];

1509 
	gSKIP_SKYSQL
;

1511 ià(
	gŒavis_‹¡
)

1512  
	gSKIP
;

1514 ià(!
	g’v
)

1515 
	g’v
= "/tmp";

1517 
£‹nv
("HOME", 
’v
, 1);

1519 
¢´štf
(
úf_fže1
, 
FN_REFLEN
, "%s%c.my.úf", 
’v
, 
FN_LIBCHAR
);

1520 
¢´štf
(
úf_fže2
, 
FN_REFLEN
, "%s%c.my.tmp", 
’v
, 
FN_LIBCHAR
);

1522 
FAIL_IF
(!
acûss
(
úf_fže1
, 
R_OK
), "access");

1524 
	gå1
ð
fÝ’
(
úf_fže1
, "w");

1525 
	gå2
ð
fÝ’
(
úf_fže2
, "w");

1526 
FAIL_IF
(!
å1
 || !
å2
, "fopen failed");

1528 
årštf
(
å1
, "!šþud%s\n", 
úf_fže2
);

1530 
årštf
(
å2
, "[client]\ndefault-character-set =†atin2\nreconnect= 1\n");

1531 
fþo£
(
å1
);

1532 
fþo£
(
å2
);

1534 
	gmysql
ð
mysql_š™
(
NULL
);

1535 
mysql_ÝtiÚs
(
mysql
, 
MYSQL_READ_DEFAULT_GROUP
, "");

1536 
my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
,

1537 
schema
, 0, 
sock‘Çme
, 0);

1539 
»move
(
úf_fže1
);

1540 
»move
(
úf_fže2
);

1542 
FAIL_IF
(
¡rcmp
(
mysql_ch¬aù”_£t_Çme
(
mysql
), "latin2"), "expected charset†atin2");

1543 
mysql_g‘_ÝtiÚv
(
mysql
, 
MYSQL_OPT_RECONNECT
, &
»cÚÃù
);

1544 
FAIL_IF
(
»cÚÃù
 != 1, "expected„econnect=1");

1545 
mysql_þo£
(
mysql
);

1547 
¢´štf
(
úf_fže1
, 
FN_REFLEN
, "%s%cmy.úf", 
’v
, 
FN_LIBCHAR
);

1548 
	gå1
ð
fÝ’
(
úf_fže1
, "w");

1549 
	gå2
ð
fÝ’
(
úf_fže2
, "w");

1550 
FAIL_IF
(!
å1
 || !
å2
, "fopen failed");

1552 
årštf
(
å2
, "!šþudedœ %s\n", 
’v
);

1554 
årštf
(
å1
, "[client]\ndefault-character-set =†atin2\nreconnect= 1\n");

1555 
fþo£
(
å1
);

1556 
fþo£
(
å2
);

1557 
	gmysql
ð
mysql_š™
(
NULL
);

1558 
mysql_ÝtiÚs
(
mysql
, 
MYSQL_READ_DEFAULT_FILE
, 
úf_fže2
);

1559 
my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
,

1560 
schema
, 0, 
sock‘Çme
, 0);

1562 
»move
(
úf_fže1
);

1563 
»move
(
úf_fže2
);

1565 
FAIL_IF
(
¡rcmp
(
mysql_ch¬aù”_£t_Çme
(
mysql
), "latin2"), "expected charset†atin2");

1566 
mysql_g‘_ÝtiÚv
(
mysql
, 
MYSQL_OPT_RECONNECT
, &
»cÚÃù
);

1567 
FAIL_IF
(
»cÚÃù
 != 1, "expected„econnect=1");

1568 
mysql_þo£
(
mysql
);

1570  
	gOK
;

1574 
‹¡_cÚc332
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

1576 
	grc
;

1577 
MYSQL
 *
	gmysql
ð
mysql_š™
(
NULL
);

1578 
	g£rv”_¡©us1
, 
	g£rv”_¡©us2
;

1580 
	gSKIP_SKYSQL
;

1581 
	gSKIP_MAXSCALE
;

1583 
mysql_ÝtiÚs
(
mysql
, 
MYSQL_SET_CHARSET_NAME
, "utf8mb4");

1585 
my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
, 
schema
,

1586 
pÜt
, 
sock‘Çme
, 0);

1588 
FAIL_IF
(
mysql_”ºo
(
mysql
), "Error during connect");

1590 
m¬Ÿdb_g‘_šfov
(
mysql
, 
MARIADB_CONNECTION_SERVER_STATUS
, &
£rv”_¡©us1
);

1591 
dŸg
("£rv”_¡©us: %d", 
£rv”_¡©us1
);

1593 ià(
	g£rv”_¡©us1
 & 
	gSERVER_STATUS_AUTOCOMMIT
)

1594 
	grc
ð
mysql_qu”y
(
mysql
, "SET‡utocommit= 0");

1596 
	grc
ð
mysql_qu”y
(
mysql
, "SET‡utocommit= 1");

1597 
check_mysql_rc
(
rc
, 
mysql
);

1598 
m¬Ÿdb_g‘_šfov
(
mysql
, 
MARIADB_CONNECTION_SERVER_STATUS
, &
£rv”_¡©us2
);

1599 
dŸg
("£rv”_¡©u aá” chªgšg‡utocomm™: %d", 
£rv”_¡©us2
);

1601 
	grc
ð
mysql_chªge_u£r
(
mysql
, 
u£ºame
, 
·sswÜd
, 
schema
);

1602 
check_mysql_rc
(
rc
, 
mysql
);

1604 
m¬Ÿdb_g‘_šfov
(
mysql
, 
MARIADB_CONNECTION_SERVER_STATUS
, &
£rv”_¡©us2
);

1605 
dŸg
("£rv”_¡©u aá” mysql_chªge_u£r: %d", 
£rv”_¡©us2
);

1606 ià(
	g£rv”_¡©us1
 !ð
£rv”_¡©us2
)

1608 
dŸg
("Ex³ùed s”v”_¡©u %d in¡—d oà%d", 
£rv”_¡©us1
, 
£rv”_¡©us2
);

1609 
mysql_þo£
(
mysql
);

1610  
	gFAIL
;

1612 
mysql_þo£
(
mysql
);

1613  
	gOK
;

1616 
‹¡_cÚc351
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

1618 
	grc
;

1619 cÚ¡ *
	gd©a
;

1620 
size_t
 
	gËn
;

1621 
MYSQL
 *
	gmysql
ð
mysql_š™
(
NULL
);

1622 
ulÚg
 
	gÿ·bž™›s
= 0;

1624 
my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
, 
schema
,

1625 
pÜt
, 
sock‘Çme
, 0);

1627 
FAIL_IF
(
mysql_”ºo
(
mysql
), "Error during connect");

1629 
m¬Ÿdb_g‘_šfov
(
mysql
, 
MARIADB_CONNECTION_SERVER_CAPABILITIES
, &
ÿ·bž™›s
);

1630 ià(!(
	gÿ·bž™›s
 & 
	gCLIENT_SESSION_TRACKING
))

1632 
mysql_þo£
(
mysql
);

1633 
dŸg
("S”v” dÛ¢'ˆsuµÜˆ£ssiÚ¿ckšg (ÿp=%lu)", 
mysql
->
£rv”_ÿ·bž™›s
);

1634  
	gSKIP
;

1637 
FAIL_IF
(
mysql_£ssiÚ_Œack_g‘_fœ¡
(
mysql
, 
SESSION_TRACK_SCHEMA
, &
d©a
, &
Ën
), "expected sessionrack schema");

1639 
	grc
ð
mysql_qu”y
(
mysql
, "SET @a:=1");

1640 
check_mysql_rc
(
rc
, 
mysql
);

1642 
FAIL_IF
(!
mysql_£ssiÚ_Œack_g‘_fœ¡
(
mysql
, 
SESSION_TRACK_SCHEMA
, &
d©a
, &
Ën
), "expected‚o schemaracking information");

1644 
mysql_þo£
(
mysql
);

1645  
	gOK
;

1648 
	$‹¡_cÚc312
(
MYSQL
 *
my
)

1650 
rc
;

1651 
qu”y
[1024];

1652 
MYSQL
 *
mysql
;

1654 
	`¥rštf
(
qu”y
, "DROP USER 'foo'@'%s'", 
this_ho¡
);

1655 
rc
ð
	`mysql_qu”y
(
my
, 
qu”y
);

1657 
	`¥rštf
(
qu”y
, "CREATE USER 'foo'@'%s' IDENTIFIED WITH cachšg_sha2_·sswÜd BY 'foo'", 
this_ho¡
);

1658 
rc
ð
	`mysql_qu”y
(
my
, 
qu”y
);

1660 ià(
rc
)

1662 
	`dŸg
("caching_sha256_password‚ot supported");

1663  
SKIP
;

1666 
	`¥rštf
(
qu”y
, "GRANT ALL ON %s.* TO 'foo'@'%s'", 
schema
, 
this_ho¡
);

1667 
rc
ð
	`mysql_qu”y
(
my
, 
qu”y
);

1668 
	`check_mysql_rc
(
rc
, 
my
);

1670 
mysql
ð
	`mysql_š™
(
NULL
);

1671 ià(!
	`my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, "foo", "foo", 
schema
, 
pÜt
, 
sock‘Çme
, 0))

1673 
	`dŸg
("E¼Ü: %s", 
	`mysql_”rÜ
(
mysql
));

1674  
FAIL
;

1677 
	`mysql_þo£
(
mysql
);

1679 
	`¥rštf
(
qu”y
, "DROP USER 'foo'@'%s'", 
this_ho¡
);

1680 
rc
ð
	`mysql_qu”y
(
my
, 
qu”y
);

1681 
	`check_mysql_rc
(
rc
, 
mysql
);

1683  
OK
;

1684 
	}
}

1686 
	$‹¡_cÚc366
(
MYSQL
 *
mysql
)

1688 
qu”y
[1024];

1689 
rc
;

1690 
MYSQL
 *
my
;

1692 
SKIP_SKYSQL
;

1693 
SKIP_MAXSCALE
;

1695 ià(!
is_m¬Ÿdb
)

1697 
	`dŸg
("feature‚ot supported by MySQL server");

1698  
SKIP
;

1702 ià(!
	`mysql_þ›Á_fšd_¶ugš
(
mysql
, "þ›Á_ed25519", 
MYSQL_CLIENT_AUTHENTICATION_PLUGIN
))

1704 
	`dŸg
("client_ed25519…lugin‚ot‡vailable");

1705  
SKIP
;

1708 
rc
ð
	`mysql_qu”y
(
mysql
, "INSTALL SONAME 'auth_ed25519'");

1709 ià(
rc
)

1711 
	`dŸg
("feature‚ot supported,ƒd25519…lugin‚ot‡vailable");

1712  
SKIP
;

1716 
	`¥rštf
(
qu”y
, "CREATE OR REPLACE USER 'ede'@'%s' IDENTIFIED VIAƒd25519 USING 'vubFBzI¿pbfHù1/J72dnUryz5VS7lA6XHH8sIx4TI'", 
this_ho¡
);

1717 
rc
ð
	`mysql_qu”y
(
mysql
, 
qu”y
);

1718 
	`check_mysql_rc
(
rc
, 
mysql
);

1720 
	`¥rštf
(
qu”y
, "GRANT ALL ON %s.* TO 'ede'@'%s'", 
schema
, 
this_ho¡
);

1721 
rc
ð
	`mysql_qu”y
(
mysql
, 
qu”y
);

1722 
	`check_mysql_rc
(
rc
, 
mysql
);

1724 
my
ð
	`mysql_š™
(
NULL
);

1725 ià(
¶ugšdœ
)

1726 
	`mysql_ÝtiÚs
(
my
, 
MYSQL_PLUGIN_DIR
, 
¶ugšdœ
);

1727 ià(!
	`my_‹¡_cÚÃù
(
my
, 
ho¡Çme
, "ede", "foo", 
schema
, 
pÜt
, 
sock‘Çme
, 0))

1729 
	`dŸg
("E¼Ü: %s", 
	`mysql_”rÜ
(
my
));

1730  
FAIL
;

1732 
	`mysql_þo£
(
my
);

1734 
	`¥rštf
(
qu”y
, "DROP USER 'ede'@'%s'", 
this_ho¡
);

1735 
rc
ð
	`mysql_qu”y
(
mysql
, 
qu”y
);

1736 
	`check_mysql_rc
(
rc
, 
mysql
);

1738 
	`¥rštf
(
qu”y
, "UNINSTALL SONAME 'auth_ed25519'");

1739 
rc
ð
	`mysql_qu”y
(
mysql
, 
qu”y
);

1740 
	`check_mysql_rc
(
rc
, 
mysql
);

1741  
OK
;

1742 
	}
}

1744 
	$‹¡_cÚc392
(
MYSQL
 *
mysql
)

1746 
rc
;

1747 cÚ¡ *
d©a
;

1748 
size_t
 
Ën
;

1749 
ulÚg
 
ÿ·bž™›s
= 0;

1751 
	`m¬Ÿdb_g‘_šfov
(
mysql
, 
MARIADB_CONNECTION_SERVER_CAPABILITIES
, &
ÿ·bž™›s
);

1752 ià(!(
ÿ·bž™›s
 & 
CLIENT_SESSION_TRACKING
))

1754 
	`dŸg
("S”v” dÛ¢'ˆsuµÜˆ£ssiÚ¿ckšg (ÿp=%lu)", 
mysql
->
£rv”_ÿ·bž™›s
);

1755  
SKIP
;

1758 
rc
ð
	`mysql_qu”y
(
mysql
, "set session_track_state_change=1");

1759 
	`check_mysql_rc
(
rc
, 
mysql
);

1761 ià(
	`mysql_£ssiÚ_Œack_g‘_fœ¡
(
mysql
, 
SESSION_TRACK_STATE_CHANGE
, &
d©a
, &
Ën
))

1763 
	`dŸg
("session_track_get_first failed");

1764  
FAIL
;

1767 
	`FAIL_IF
(
Ën
 != 1, "Expected†ength 1");

1768  
OK
;

1769 
	}
}

1771 
‹¡_cÚc443
(
MYSQL
 *
my
 
__©Œibu‹__
((
unu£d
)))

1773 
my_boÞ
 
	gx
= 1;

1774 
	gth»ad_id
= 0;

1775 
	gqu”y
[128];

1776 
MYSQL_RES
 *
	g»suÉ
;

1777 
MYSQL_ROW
 
	grow
;

1778 
	grc
;

1780 
MYSQL
 *
	gmysql
ð
mysql_š™
(
NULL
);

1782 
	gSKIP_MAXSCALE
;

1784 
mysql_ÝtiÚs
(
mysql
, 
MYSQL_INIT_COMMAND
, "set @a:=3");

1785 
mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_RECONNECT
, &
x
);

1787 ià(!
my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
, 
schema
, 
pÜt
, 
sock‘Çme
, 
CLIENT_REMEMBER_OPTIONS
))

1789 
dŸg
("CÚÃùiÚ fažed. E¼Ü: %s", 
mysql_”rÜ
(
mysql
));

1790 
mysql_þo£
(
mysql
);

1793 
	gth»ad_id
ð
mysql_th»ad_id
(
mysql
);

1795 
¥rštf
(
qu”y
, "KILL %lu", 
th»ad_id
);

1796 
	grc
ð
mysql_qu”y
(
mysql
, 
qu”y
);

1798 
¦“p
(3);

1800 
	grc
ð
mysql_pšg
(
mysql
);

1801 
check_mysql_rc
(
rc
, 
mysql
);

1803 
	grc
ð
mysql_qu”y
(
mysql
, "SELECT @a");

1804 
check_mysql_rc
(
rc
, 
mysql
);

1806 
FAIL_IF
(
mysql_th»ad_id
(
mysql
è=ð
th»ad_id
, "Expected differenthread id");

1808 
	g»suÉ
ð
mysql_¡Üe_»suÉ
(
mysql
);

1809 ià(!
	g»suÉ
)

1810  
	gFAIL
;

1811 
	grow
ð
mysql_ãtch_row
(
»suÉ
);

1812 
FAIL_IF
(
¡rcmp
(
row
[0],"3"), "Wrong„esult");

1814 
mysql_ä“_»suÉ
(
»suÉ
);

1815 
mysql_þo£
(
mysql
);

1817  
	gOK
;

1820 
‹¡_deçuÉ_auth
(
MYSQL
 *
my
 
__©Œibu‹__
((
unu£d
)))

1822 
MYSQL
 *
	gmysql
;

1824 
	gSKIP_SKYSQL
;

1825 
	gSKIP_MAXSCALE
;

1827 ià(!
	gis_m¬Ÿdb
)

1828  
	gSKIP
;

1830 
	gmysql
ð
mysql_š™
(
NULL
);

1831 
mysql_ÝtiÚs
(
mysql
, 
MYSQL_DEFAULT_AUTH
, "mysql_clear_password");

1833 ià(!
my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
, 
schema
, 
pÜt
, 
sock‘Çme
, 
CLIENT_REMEMBER_OPTIONS
))

1835 
dŸg
("CÚÃùiÚ fažed. E¼Ü: %s", 
mysql_”rÜ
(
mysql
));

1836 
mysql_þo£
(
mysql
);

1837  
	gFAIL
;

1839 
mysql_þo£
(
mysql
);

1841 
	gmysql
ð
mysql_š™
(
NULL
);

1842 
mysql_ÝtiÚs
(
mysql
, 
MYSQL_DEFAULT_AUTH
, "caching_sha2_password");

1844 ià(!
my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
, 
schema
, 
pÜt
, 
sock‘Çme
, 
CLIENT_REMEMBER_OPTIONS
))

1846 
dŸg
("CÚÃùiÚ fažed. E¼Ü: %s", 
mysql_”rÜ
(
mysql
));

1847 
mysql_þo£
(
mysql
);

1848  
	gFAIL
;

1851 
mysql_þo£
(
mysql
);

1852  
	gOK
;

1855 
	$‹¡_gtid
(
MYSQL
 *
mysql
)

1857 
rc
;

1858 cÚ¡ *
d©a
;

1859 
size_t
 
Ën
;

1861 ià(
is_m¬Ÿdb
)

1862  
SKIP
;

1864 
rc
ð
	`mysql_qu”y
(
mysql
, "SET @@session.session_track_state_change=1");

1865 
	`check_mysql_rc
(
rc
, 
mysql
);

1867 
rc
ð
	`mysql_qu”y
(
mysql
, "SET @@session.session_track_gtids=OWN_GTID");

1868 
	`check_mysql_rc
(
rc
, 
mysql
);

1870 
rc
ð
	`mysql_qu”y
(
mysql
, "BEGIN");

1871 
	`check_mysql_rc
(
rc
, 
mysql
);

1873 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

1874 
	`check_mysql_rc
(
rc
, 
mysql
);

1876 ià(!
	`mysql_£ssiÚ_Œack_g‘_fœ¡
(
mysql
, 
SESSION_TRACK_GTIDS
, &
d©a
, &
Ën
))

1878 
	`´štf
("# SESSION_TRACK_GTIDS: %*.*s\n", ()
Ën
, (î’, 
d©a
);

1879 } !
	`mysql_£ssiÚ_Œack_g‘_Ãxt
(
mysql
, 
SESSION_TRACK_GTIDS
, &
d©a
, &
Ën
));

1881 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE1 (a int)");

1882 
	`check_mysql_rc
(
rc
, 
mysql
);

1884 ià(!
	`mysql_£ssiÚ_Œack_g‘_fœ¡
(
mysql
, 
SESSION_TRACK_GTIDS
, &
d©a
, &
Ën
))

1886 
	`´štf
("# SESSION_TRACK_GTIDS: %*.*s\n", ()
Ën
, (î’, 
d©a
);

1887 } !
	`mysql_£ssiÚ_Œack_g‘_Ãxt
(
mysql
, 
SESSION_TRACK_GTIDS
, &
d©a
, &
Ën
));

1889 
rc
ð
	`mysql_qu”y
(
mysql
, "COMMIT");

1890 
	`check_mysql_rc
(
rc
, 
mysql
);

1892  
OK
;

1893 
	}
}

1895 
my_‹¡s_¡
 
	gmy_‹¡s
[] = {

1896 {"‹¡_gtid", 
‹¡_gtid
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1897 {"‹¡_cÚc496", 
‹¡_cÚc496
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1898 {"‹¡_deçuÉ_auth", 
‹¡_deçuÉ_auth
, 
TEST_CONNECTION_NONE
, 0, 
NULL
, NULL},

1899 {"‹¡_cÚc443", 
‹¡_cÚc443
, 
TEST_CONNECTION_NONE
, 0, 
NULL
, NULL},

1900 {"‹¡_cÚc366", 
‹¡_cÚc366
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1901 {"‹¡_cÚc392", 
‹¡_cÚc392
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1902 {"‹¡_cÚc312", 
‹¡_cÚc312
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1903 {"‹¡_cÚc351", 
‹¡_cÚc351
, 
TEST_CONNECTION_NONE
, 0, 
NULL
, NULL},

1904 {"‹¡_cÚc332", 
‹¡_cÚc332
, 
TEST_CONNECTION_NONE
, 0, 
NULL
, NULL},

1905 #iâdeà
WIN32


1906 {"‹¡_cÚc327", 
‹¡_cÚc327
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1907 {"‹¡_cÚc317", 
‹¡_cÚc317
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1909 {"‹¡_cÚc315", 
‹¡_cÚc315
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1910 {"‹¡_expœed_pw", 
‹¡_expœed_pw
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1911 {"‹¡_cÚc276", 
‹¡_cÚc276
, 
TEST_CONNECTION_NONE
, 0, 
NULL
, NULL},

1912 {"‹¡_mdev13100", 
‹¡_mdev13100
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1913 {"‹¡_auth256", 
‹¡_auth256
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1914 {"‹¡_»£t", 
‹¡_»£t
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1915 {"‹¡_unix_sock‘_þo£", 
‹¡_unix_sock‘_þo£
, 
TEST_CONNECTION_NONE
, 0, 
NULL
, NULL},

1916 {"‹¡_£ss_Œack_db", 
‹¡_£ss_Œack_db
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1917 {"‹¡_g‘_ÝtiÚs", 
‹¡_g‘_ÝtiÚs
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1918 {"‹¡_wrÚg_bšd_add»ss", 
‹¡_wrÚg_bšd_add»ss
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1919 {"‹¡_bšd_add»ss", 
‹¡_bšd_add»ss
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1920 {"‹¡_cÚc118", 
‹¡_cÚc118
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1921 {"‹¡_cÚc66", 
‹¡_cÚc66
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1922 {"‹¡_bug20023", 
‹¡_bug20023
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1923 {"‹¡_bug31669", 
‹¡_bug31669
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1924 {"‹¡_bug33831", 
‹¡_bug33831
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1925 {"‹¡_chªge_u£r", 
‹¡_chªge_u£r
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1926 {"‹¡_Ýt_»cÚÃù", 
‹¡_Ýt_»cÚÃù
, 
TEST_CONNECTION_NONE
, 0, 
NULL
, NULL},

1927 {"‹¡_com´ess", 
‹¡_com´ess
, 
TEST_CONNECTION_NONE
, 0, 
NULL
, NULL},

1928 {"‹¡_»cÚÃù", 
‹¡_»cÚÃù
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1929 {"‹¡_cÚc21", 
‹¡_cÚc21
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1930 {"‹¡_cÚc26", 
‹¡_cÚc26
, 
TEST_CONNECTION_NONE
, 0, 
NULL
, NULL},

1931 {"‹¡_cÚÃùiÚ_timeout", 
‹¡_cÚÃùiÚ_timeout
, 
TEST_CONNECTION_NONE
, 0, 
NULL
, NULL},

1932 {"‹¡_cÚÃùiÚ_timeout2", 
‹¡_cÚÃùiÚ_timeout2
, 
TEST_CONNECTION_NONE
, 0, 
NULL
, NULL},

1933 {"‹¡_cÚÃùiÚ_timeout3", 
‹¡_cÚÃùiÚ_timeout3
, 
TEST_CONNECTION_NONE
, 0, 
NULL
, NULL},

1934 {
NULL
, NULL, 0, 0, NULL, NULL}

1938 
	$maš
(
¬gc
, **
¬gv
)

1940 ià(
¬gc
 > 1)

1941 
	`g‘_ÝtiÚs
(
¬gc
, 
¬gv
);

1943 
	`g‘_’vv¬s
();

1945 
	`run_‹¡s
(
my_‹¡s
);

1947 (
	`ex™_¡©us
());

1948 
	}
}

	@unittest/libmariadb/cursor.c

24 
	~"my_‹¡.h
"

27 ’um { 
	mMAX_COLUMN_LENGTH
= 255 };

29 
	s¡_¡mt_ãtch


31 cÚ¡ *
	mqu”y
;

32 
	m¡mt_no
;

33 
MYSQL_STMT
 *
	mhªdË
;

34 
my_boÞ
 
	mis_Ý’
;

35 
MYSQL_BIND
 *
	mbšd_¬¿y
;

36 **
	mout_d©a
;

37 *
	mout_d©a_Ëngth
;

38 
	mcÞumn_couÁ
;

39 
	mrow_couÁ
;

40 } 
	tStmt_ãtch
;

42 
MYSQL_STMT
 *
	$Ý’_cursÜ
(
MYSQL
 *
mysql
, cÚ¡ *
qu”y
)

44 
rc
;

45 cÚ¡ 
ulÚg
 
ty³
ð(ulÚg)
CURSOR_TYPE_READ_ONLY
;

47 
MYSQL_STMT
 *
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

48 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

49 ià(
rc
) {

50 
	`dŸg
("E¼Ü: %s", 
	`mysql_¡mt_”rÜ
(
¡mt
));

51  
NULL
;

53 
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_CURSOR_TYPE
, (*è&
ty³
);

54  
¡mt
;

55 
	}
}

62 
	$¡mt_ãtch_š™
(
MYSQL
 *
mysql
, 
Stmt_ãtch
 *
ãtch
, 
¡mt_no_¬g
,

63 cÚ¡ *
qu”y_¬g
)

65 
ty³
ð
CURSOR_TYPE_READ_ONLY
;

66 
rc
;

67 
i
;

68 
MYSQL_RES
 *
m‘ad©a
;

71 
ãtch
->
¡mt_no
ð
¡mt_no_¬g
;

72 
ãtch
->
qu”y
ð
qu”y_¬g
;

74 
ãtch
->
hªdË
ð
	`mysql_¡mt_š™
(
mysql
);

76 
rc
ð
	`mysql_¡mt_´•¬e
(
ãtch
->
hªdË
, 
	`SL
(ãtch->
qu”y
));

77 
	`FAIL_IF
(
rc
, 
	`mysql_¡mt_”rÜ
(
ãtch
->
hªdË
));

83 
	`mysql_¡mt_©Œ_£t
(
ãtch
->
hªdË
, 
STMT_ATTR_CURSOR_TYPE
,

84 (cÚ¡ *è&
ty³
);

86 
rc
ð
	`mysql_¡mt_execu‹
(
ãtch
->
hªdË
);

87 
	`FAIL_IF
(
rc
, 
	`mysql_¡mt_”rÜ
(
ãtch
->
hªdË
));

90 
m‘ad©a
ð
	`mysql_¡mt_»suÉ_m‘ad©a
(
ãtch
->
hªdË
);

91 
ãtch
->
cÞumn_couÁ
ð
	`mysql_num_f›lds
(
m‘ad©a
);

92 
	`mysql_ä“_»suÉ
(
m‘ad©a
);

100 
ãtch
->
bšd_¬¿y
ð(
MYSQL_BIND
 *è
	`ÿÎoc
(1, (MYSQL_BIND) *

101 
ãtch
->
cÞumn_couÁ
);

102 
ãtch
->
out_d©a
ð(**è
	`ÿÎoc
(1, (*è* f‘ch->
cÞumn_couÁ
);

103 
ãtch
->
out_d©a_Ëngth
ð(
ulÚg
*è
	`ÿÎoc
(1, (ulong) *

104 
ãtch
->
cÞumn_couÁ
);

105 
i
ð0; i < 
ãtch
->
cÞumn_couÁ
; ++i)

107 
ãtch
->
out_d©a
[
i
]ð(*è
	`ÿÎoc
(1, 
MAX_COLUMN_LENGTH
);

108 
ãtch
->
bšd_¬¿y
[
i
].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

109 
ãtch
->
bšd_¬¿y
[
i
].
bufãr
ðãtch->
out_d©a
[i];

110 
ãtch
->
bšd_¬¿y
[
i
].
bufãr_Ëngth
ð
MAX_COLUMN_LENGTH
;

111 
ãtch
->
bšd_¬¿y
[
i
].
Ëngth
ðãtch->
out_d©a_Ëngth
 + i;

114 
	`mysql_¡mt_bšd_»suÉ
(
ãtch
->
hªdË
, f‘ch->
bšd_¬¿y
);

116 
ãtch
->
row_couÁ
= 0;

117 
ãtch
->
is_Ý’
ð
TRUE
;

120  
OK
;

121 
	}
}

124 
	$fžl_bËs
(
MYSQL
 *
mysql
, cÚ¡ **
qu”y_li¡
, 
qu”y_couÁ
)

126 
rc
;

127 cÚ¡ **
qu”y
;

128 
qu”y
ð
qu”y_li¡
; qu”y < qu”y_li¡ + 
qu”y_couÁ
;

129 ++
qu”y
)

131 
rc
ð
	`mysql_qu”y
(
mysql
, *
qu”y
);

132 
	`check_mysql_rc
(
rc
, 
mysql
);

134  
OK
;

135 
	}
}

137 
	$¡mt_ãtch_ãtch_row
(
Stmt_ãtch
 *
ãtch
)

139 
rc
;

140 
i
;

142 ià((
rc
ð
	`mysql_¡mt_ãtch
(
ãtch
->
hªdË
)) == 0)

144 ++
ãtch
->
row_couÁ
;

145 
i
ð0; i < 
ãtch
->
cÞumn_couÁ
; ++i)

147 
ãtch
->
out_d©a
[
i
][ãtch->
out_d©a_Ëngth
[i]]= '\0';

151 
ãtch
->
is_Ý’
ð
FALSE
;

153  
rc
;

154 
	}
}

156 
	$¡mt_ãtch_þo£
(
Stmt_ãtch
 *
ãtch
)

158 
i
;

160 
i
ð0; i < 
ãtch
->
cÞumn_couÁ
; ++i)

161 
	`ä“
(
ãtch
->
out_d©a
[
i
]);

162 
	`ä“
(
ãtch
->
out_d©a
);

163 
	`ä“
(
ãtch
->
out_d©a_Ëngth
);

164 
	`ä“
(
ãtch
->
bšd_¬¿y
);

165 
	`mysql_¡mt_þo£
(
ãtch
->
hªdË
);

166 
	}
}

170 
	eãtch_ty³
 { 
	mUSE_ROW_BY_ROW_FETCH
ð0, 
	mUSE_STORE_RESULT
= 1 };

172 
	$ãtch_n
(
MYSQL
 *
mysql
, cÚ¡ **
qu”y_li¡
, 
qu”y_couÁ
,

173 
ãtch_ty³
 fetch_type)

175 
Ý’_¡©em’ts
ð
qu”y_couÁ
;

176 
rc
, 
”rÜ_couÁ
= 0;

177 
Stmt_ãtch
 *
ãtch_¬¿y
ð(Stmt_ãtch*è
	`ÿÎoc
(1, (Stmt_fetch) *

178 
qu”y_couÁ
);

179 
Stmt_ãtch
 *
ãtch
;

181 
ãtch
ð
ãtch_¬¿y
; f‘ch < f‘ch_¬¿y + 
qu”y_couÁ
; ++fetch)

183 ià(
	`¡mt_ãtch_š™
(
mysql
, 
ãtch
, ()(ãtch - 
ãtch_¬¿y
),

184 
qu”y_li¡
[
ãtch
 - 
ãtch_¬¿y
]))

185  
FAIL
;

188 ià(
ãtch_ty³
 =ð
USE_STORE_RESULT
)

190 
ãtch
ð
ãtch_¬¿y
; f‘ch < f‘ch_¬¿y + 
qu”y_couÁ
; ++fetch)

192 
rc
ð
	`mysql_¡mt_¡Üe_»suÉ
(
ãtch
->
hªdË
);

193 
	`FAIL_IF
(
rc
, 
	`mysql_¡mt_”rÜ
(
ãtch
->
hªdË
));

197 
Ý’_¡©em’ts
)

199 
ãtch
ð
ãtch_¬¿y
; f‘ch < f‘ch_¬¿y + 
qu”y_couÁ
; ++fetch)

201 ià(
ãtch
->
is_Ý’
 && (
rc
ð
	`¡mt_ãtch_ãtch_row
(fetch)))

203 
Ý’_¡©em’ts
--;

208 ià(
rc
 !ð
MYSQL_NO_DATA
)

209 
”rÜ_couÁ
++;

213 ià(!
”rÜ_couÁ
)

215 
tÙ®_row_couÁ
= 0;

216 
ãtch
ð
ãtch_¬¿y
; f‘ch < f‘ch_¬¿y + 
qu”y_couÁ
; ++fetch)

217 
tÙ®_row_couÁ
+ð
ãtch
->
row_couÁ
;

219 
ãtch
ð
ãtch_¬¿y
; f‘ch < f‘ch_¬¿y + 
qu”y_couÁ
; ++fetch)

220 
	`¡mt_ãtch_þo£
(
ãtch
);

221 
	`ä“
(
ãtch_¬¿y
);

223  (
”rÜ_couÁ
è? 
FAIL
:
OK
;

224 
	}
}

226 
	$‹¡_basic_cursÜs
(
MYSQL
 *
mysql
)

228 cÚ¡ *
basic_bËs
[]=

255 cÚ¡ *
qu”›s
[]=

262 
	`FAIL_IF
(
	`fžl_bËs
(
mysql
, 
basic_bËs
, (basic_tables)/(*basic_tables)), "fill_tables failed");

264 
	`FAIL_IF
(
	`ãtch_n
(
mysql
, 
qu”›s
, (qu”›s)/(*qu”›s), 
USE_ROW_BY_ROW_FETCH
), "fetch_n failed");

265 
	`FAIL_IF
(
	`ãtch_n
(
mysql
, 
qu”›s
, (qu”›s)/(*qu”›s), 
USE_STORE_RESULT
), "fetch_n failed");

266  
OK
;

267 
	}
}

270 
	$‹¡_cursÜs_w™h_uniÚ
(
MYSQL
 *
mysql
)

272 cÚ¡ *
qu”›s
[]=

277 
	`FAIL_IF
(
	`ãtch_n
(
mysql
, 
qu”›s
, (qu”›s)/(*qu”›s), 
USE_ROW_BY_ROW_FETCH
), "fetch_n failed");

278 
	`FAIL_IF
(
	`ãtch_n
(
mysql
, 
qu”›s
, (qu”›s)/(*qu”›s), 
USE_STORE_RESULT
), "fetch_n failed");

280  
OK
;

281 
	}
}

284 
	$‹¡_cursÜs_w™h_´oûdu»
(
MYSQL
 *
mysql
)

286 cÚ¡ *
qu”›s
[]=

290 
	`FAIL_IF
(
	`ãtch_n
(
mysql
, 
qu”›s
, (qu”›s)/(*qu”›s), 
USE_ROW_BY_ROW_FETCH
), "fetch_n failed");

291 
	`FAIL_IF
(
	`ãtch_n
(
mysql
, 
qu”›s
, (qu”›s)/(*qu”›s), 
USE_STORE_RESULT
), "fetch_n failed");

293  
OK
;

294 
	}
}

302 
	$‹¡_bug21206
(
MYSQL
 *
mysql
)

304 
»tcode
ð
OK
;

306 cÚ¡ 
size_t
 
cursÜ_couÁ
= 1025;

308 cÚ¡ *
ü—‹_bË
[]=

314 cÚ¡ *
qu”y
= "SELECT * FROM1";

316 
Stmt_ãtch
 *
ãtch_¬¿y
=

317 (
Stmt_ãtch
*è
	`ÿÎoc
(
cursÜ_couÁ
, (Stmt_fetch));

319 
Stmt_ãtch
 *
ãtch
;

321 
	`FAIL_IF
(
	`fžl_bËs
(
mysql
, 
ü—‹_bË
, (create_table) / (*create_table)), "fill_tables failed");

323 
ãtch
ð
ãtch_¬¿y
; f‘ch < f‘ch_¬¿y + 
cursÜ_couÁ
; ++fetch)

325 ià((
»tcode
ð
	`¡mt_ãtch_š™
(
mysql
, 
ãtch
, ()(ãtch - 
ãtch_¬¿y
), 
qu”y
)))

329 
ãtch
ð
ãtch_¬¿y
; f‘ch < f‘ch_¬¿y + 
cursÜ_couÁ
; ++fetch)

330 
	`¡mt_ãtch_þo£
(
ãtch
);

332 
	`ä“
(
ãtch_¬¿y
);

334  
»tcode
;

335 
	}
}

337 
	$‹¡_bug10729
(
MYSQL
 *
mysql
)

339 
MYSQL_STMT
 *
¡mt
;

340 
MYSQL_BIND
 
my_bšd
[1];

341 
a
[21];

342 
rc
;

343 cÚ¡ *
¡mt_‹xt
;

344 
i
= 0;

345 cÚ¡ *
Çme_¬¿y
[3]= { "aaa", "bbb", "ccc" };

346 
ulÚg
 
ty³
;

348 
	`mysql_qu”y
(
mysql
, "dropable ifƒxists1");

349 
	`mysql_qu”y
(
mysql
, "createable1 (id integer‚ot‚ull…rimary key,"

351 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into1 (id,‚ame) values "

353 
	`check_mysql_rc
(
rc
, 
mysql
);

355 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

356 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

358 
ty³
ð(
ulÚg
è
CURSOR_TYPE_READ_ONLY
;

359 
rc
ð
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_CURSOR_TYPE
, (*è&
ty³
);

360 
	`check_¡mt_rc
(
rc
, 
¡mt
);

361 
¡mt_‹xt
= "select‚ame from1";

362 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

363 
	`check_¡mt_rc
(
rc
, 
¡mt
);

365 
	`mem£t
(
my_bšd
, '\0', (my_bind));

366 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

367 
my_bšd
[0].
bufãr
ð(*è
a
;

368 
my_bšd
[0].
bufãr_Ëngth
ð(
a
);

369 
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

371 
i
= 0; i < 3; i++)

373 
row_no
= 0;

374 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

375 
	`check_¡mt_rc
(
rc
, 
¡mt
);

376 (
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
)) == 0)

378 
	`FAIL_UNLESS
(
	`¡rcmp
(
a
, 
Çme_¬¿y
[
row_no
]) == 0, "a !=‚ame_array[row_no]");

379 ++
row_no
;

381 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

383 
rc
ð
	`mysql_¡mt_þo£
(
¡mt
);

385 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable1");

386 
	`check_mysql_rc
(
rc
, 
mysql
);

388  
OK
;

389 
	}
}

393 
	$‹¡_bug10736
(
MYSQL
 *
mysql
)

395 
MYSQL_STMT
 *
¡mt
;

396 
MYSQL_BIND
 
my_bšd
[1];

397 
a
[21];

398 
rc
;

399 cÚ¡ *
¡mt_‹xt
;

400 
i
= 0;

401 
ulÚg
 
ty³
;

403 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxists1");

404 
	`check_mysql_rc
(
rc
, 
mysql
);

405 
rc
ð
	`mysql_qu”y
(
mysql
, "createable1 (id integer‚ot‚ull…rimary key,"

407 
	`check_mysql_rc
(
rc
, 
mysql
);

408 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into1 (id,‚ame) values "

410 
	`check_mysql_rc
(
rc
, 
mysql
);

412 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

414 
ty³
ð(
ulÚg
è
CURSOR_TYPE_READ_ONLY
;

415 
rc
ð
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_CURSOR_TYPE
, (*è&
ty³
);

416 
	`check_¡mt_rc
(
rc
, 
¡mt
);

417 
¡mt_‹xt
= "select‚ame from1 where‚ame=(select‚ame from1 where id=2)";

418 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

419 
	`check_¡mt_rc
(
rc
, 
¡mt
);

421 
	`mem£t
(
my_bšd
, '\0', (my_bind));

422 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

423 
my_bšd
[0].
bufãr
ð(*è
a
;

424 
my_bšd
[0].
bufãr_Ëngth
ð(
a
);

425 
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

427 
i
= 0; i < 3; i++)

429 
row_no
= 0;

430 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

431 
	`check_¡mt_rc
(
rc
, 
¡mt
);

432 (
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
)) == 0)

433 ++
row_no
;

434 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

436 
rc
ð
	`mysql_¡mt_þo£
(
¡mt
);

438 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable1");

439 
	`check_mysql_rc
(
rc
, 
mysql
);

441  
OK
;

442 
	}
}

446 
	$‹¡_bug10794
(
MYSQL
 *
mysql
)

448 
MYSQL_STMT
 *
¡mt
, *
¡mt1
;

449 
MYSQL_BIND
 
my_bšd
[2];

450 
a
[21];

451 
id_v®
;

452 
ulÚg
 
a_Ën
;

453 
rc
;

454 cÚ¡ *
¡mt_‹xt
;

455 
i
= 0;

456 
ulÚg
 
ty³
;

458 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxists1");

459 
	`check_mysql_rc
(
rc
, 
mysql
);

460 
rc
ð
	`mysql_qu”y
(
mysql
, "createable1 (id integer‚ot‚ull…rimary key,"

462 
	`check_mysql_rc
(
rc
, 
mysql
);

464 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

465 
¡mt_‹xt
= "insert into1 (id,‚ame) values (?, ?)";

466 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

467 
	`check_¡mt_rc
(
rc
, 
¡mt
);

469 
	`mem£t
(
my_bšd
, '\0', (my_bind));

470 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

471 
my_bšd
[0].
bufãr
ð(*è&
id_v®
;

472 
my_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

473 
my_bšd
[1].
bufãr
ð(*è
a
;

474 
my_bšd
[1].
Ëngth
ð&
a_Ën
;

475 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

476 
	`check_¡mt_rc
(
rc
, 
¡mt
);

477 
i
= 0; i < 42; i++)

479 
id_v®
ð(
i
+1)*10;

480 
	`¥rštf
(
a
, "a%d", 
i
);

481 
a_Ën
ð()
	`¡¾’
(
a
);

482 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

483 
	`check_¡mt_rc
(
rc
, 
¡mt
);

485 
¡mt_‹xt
= "select‚ame from1";

486 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

487 
ty³
ð(
ulÚg
è
CURSOR_TYPE_READ_ONLY
;

488 
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_CURSOR_TYPE
, (cÚ¡ *è&
ty³
);

489 
¡mt1
ð
	`mysql_¡mt_š™
(
mysql
);

490 
	`mysql_¡mt_©Œ_£t
(
¡mt1
, 
STMT_ATTR_CURSOR_TYPE
, (cÚ¡ *è&
ty³
);

491 
	`mem£t
(
my_bšd
, '\0', (my_bind));

492 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

493 
my_bšd
[0].
bufãr
ð(*è
a
;

494 
my_bšd
[0].
bufãr_Ëngth
ð(
a
);

495 
my_bšd
[0].
Ëngth
ð&
a_Ën
;

496 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

497 
	`check_¡mt_rc
(
rc
, 
¡mt
);

498 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

499 
	`check_¡mt_rc
(
rc
, 
¡mt
);

500 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

501 
	`check_¡mt_rc
(
rc
, 
¡mt
);

503 
	`mysql_¡mt_ä“_»suÉ
(
¡mt
);

504 
	`mysql_¡mt_»£t
(
¡mt
);

505 
¡mt_‹xt
= "select‚ame from1 where id=10";

506 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt1
, 
	`SL
(
¡mt_‹xt
));

507 
	`check_¡mt_rc
(
rc
, 
¡mt1
);

508 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt1
, 
my_bšd
);

509 
	`check_¡mt_rc
(
rc
, 
¡mt1
);

510 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt1
);

511 
	`check_¡mt_rc
(
rc
, 
¡mt1
);

514 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt1
);

515 ià(
rc
 =ð
MYSQL_NO_DATA
)

519 
	`check_¡mt_rc
(
rc
, 
¡mt1
);

521 
	`mysql_¡mt_þo£
(
¡mt
);

522 
	`mysql_¡mt_þo£
(
¡mt1
);

524 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable1");

525 
	`check_mysql_rc
(
rc
, 
mysql
);

527  
OK
;

528 
	}
}

532 
	$‹¡_bug10760
(
MYSQL
 *
mysql
)

534 
MYSQL_STMT
 *
¡mt
;

535 
MYSQL_BIND
 
my_bšd
[1];

536 
rc
;

537 cÚ¡ *
¡mt_‹xt
;

538 
id_buf
[20];

539 
ulÚg
 
id_Ën
;

540 
i
= 0;

541 
ulÚg
 
ty³
;

543 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxists1,2");

544 
	`check_mysql_rc
(
rc
, 
mysql
);

547 
rc
ð
	`mysql_qu”y
(
mysql
, "createable1 (id integer‚ot‚ull…rimary key)"

549 
	`check_mysql_rc
(
rc
, 
mysql
);;

550 ; 
i
 < 42; ++i)

552 
buf
[100];

553 
	`¥rštf
(
buf
, "š£¹ iÁØt1 (idèv®ue (%d)", 
i
+1);

554 
rc
ð
	`mysql_qu”y
(
mysql
, 
buf
);

555 
	`check_mysql_rc
(
rc
, 
mysql
);;

557 
	`mysql_autocomm™
(
mysql
, 
FALSE
);

559 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

560 
ty³
ð(
ulÚg
è
CURSOR_TYPE_READ_ONLY
;

561 
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_CURSOR_TYPE
, (cÚ¡ *è&
ty³
);

570 
¡mt_‹xt
= "select id from1 order by 1";

571 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

572 
	`check_¡mt_rc
(
rc
, 
¡mt
);;

573 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

574 
	`check_¡mt_rc
(
rc
, 
¡mt
);;

575 
rc
ð
	`mysql_qu”y
(
mysql
, "update1 set id=id+100");

585 
rc
ð
	`mysql_rÞlback
(
mysql
);

586 
	`check_mysql_rc
(
rc
, 
mysql
);;

587 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

588 
	`check_¡mt_rc
(
rc
, 
¡mt
);;

594 ià(
	`check_v¬ŸbË
(
mysql
, "@@have_innodb", "YES"))

596 
¡mt_‹xt
= "select id from1 order by 1";

597 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

598 
	`check_¡mt_rc
(
rc
, 
¡mt
);;

600 
rc
ð
	`mysql_qu”y
(
mysql
, "alterable1ƒngine=InnoDB");

601 
	`check_mysql_rc
(
rc
, 
mysql
);;

603 
	`mem£t
(
my_bšd
, '\0', (my_bind));

604 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

605 
my_bšd
[0].
bufãr
ð(*è
id_buf
;

606 
my_bšd
[0].
bufãr_Ëngth
ð(
id_buf
);

607 
my_bšd
[0].
Ëngth
ð&
id_Ën
;

608 
	`check_¡mt_rc
(
rc
, 
¡mt
);;

609 
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

611 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

612 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

613 
	`FAIL_UNLESS
(
rc
 == 0, "rc != 0");

614 
rc
ð
	`mysql_rÞlback
(
mysql
);

617 
	`mysql_¡mt_þo£
(
¡mt
);

618 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable1");

619 
	`check_mysql_rc
(
rc
, 
mysql
);

620 
rc
ð
	`mysql_autocomm™
(
mysql
, 
TRUE
);

621 
	`check_mysql_rc
(
rc
, 
mysql
);

623  
OK
;

624 
	}
}

628 
	$‹¡_bug11172
(
MYSQL
 *
mysql
)

630 
MYSQL_STMT
 *
¡mt
;

631 
MYSQL_BIND
 
bšd_š
[1], 
bšd_out
[2];

632 
MYSQL_TIME
 
hœed
;

633 
rc
;

634 cÚ¡ *
¡mt_‹xt
;

635 
i
ð0, 
id
;

636 
ulÚg
 
ty³
;

638 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxists1");

639 
	`check_mysql_rc
(
rc
, 
mysql
);

640 
rc
ð
	`mysql_qu”y
(
mysql
, "createable1 (id integer‚ot‚ull…rimary key,"

642 
	`check_mysql_rc
(
rc
, 
mysql
);

643 
rc
ð
	`mysql_qu”y
(
mysql
,

647 
	`check_mysql_rc
(
rc
, 
mysql
);

648 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

649 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

650 
¡mt_‹xt
= "SELECT id, hired FROM1 WHERE hired=?";

651 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

652 
	`check_¡mt_rc
(
rc
, 
¡mt
);

654 
ty³
ð(
ulÚg
è
CURSOR_TYPE_READ_ONLY
;

655 
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_CURSOR_TYPE
, (cÚ¡ *è&
ty³
);

657 
	`mem£t
(
bšd_š
, '\0', (bind_in));

658 
	`mem£t
(
bšd_out
, '\0', (bind_out));

659 
	`mem£t
(&
hœed
, '\0', (hired));

660 
hœed
.
y—r
= 1965;

661 
hœed
.
mÚth
= 1;

662 
hœed
.
day
= 1;

663 
bšd_š
[0].
bufãr_ty³
ð
MYSQL_TYPE_DATE
;

664 
bšd_š
[0].
bufãr
ð(*è&
hœed
;

665 
bšd_š
[0].
bufãr_Ëngth
ð(
hœed
);

666 
bšd_out
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

667 
bšd_out
[0].
bufãr
ð(*è&
id
;

668 
bšd_out
[1]ð
bšd_š
[0];

670 
i
= 0; i < 3; i++)

672 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
bšd_š
);

673 
	`check_¡mt_rc
(
rc
, 
¡mt
);

674 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
bšd_out
);

675 
	`check_¡mt_rc
(
rc
, 
¡mt
);

676 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

677 
	`check_¡mt_rc
(
rc
, 
¡mt
);

678 (
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
)) == 0);

679 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

680 ià(!
	`mysql_¡mt_ä“_»suÉ
(
¡mt
))

681 
	`mysql_¡mt_»£t
(
¡mt
);

683 
	`mysql_¡mt_þo£
(
¡mt
);

684 
	`mysql_rÞlback
(
mysql
);

685 
	`mysql_rÞlback
(
mysql
);

687 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable1");

688 
	`check_mysql_rc
(
rc
, 
mysql
);

690  
OK
;

691 
	}
}

695 
	$‹¡_bug11656
(
MYSQL
 *
mysql
)

697 
MYSQL_STMT
 *
¡mt
;

698 
MYSQL_BIND
 
my_bšd
[2];

699 
rc
;

700 cÚ¡ *
¡mt_‹xt
;

701 
buf
[2][20];

702 
i
= 0;

703 
ulÚg
 
ty³
;

705 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxists1");

706 
	`check_mysql_rc
(
rc
, 
mysql
);

708 
rc
ð
	`mysql_qu”y
(
mysql
, "createable1 ("

713 
	`check_mysql_rc
(
rc
, 
mysql
);

715 
¡mt_‹xt
= "select distinctest_kind,est_id from1 "

717 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

718 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

719 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

720 
	`check_¡mt_rc
(
rc
, 
¡mt
);

721 
ty³
ð(
ulÚg
è
CURSOR_TYPE_READ_ONLY
;

722 
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_CURSOR_TYPE
, (cÚ¡ *è&
ty³
);

724 
	`mem£t
(
my_bšd
, '\0', (my_bind));

725 
	`¡rýy
(
buf
[0], "pcint502_MY2");

726 
	`¡rýy
(
buf
[1], "*");

727 
i
=0; i < 2; i++)

729 
my_bšd
[
i
].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

730 
my_bšd
[
i
].
bufãr
ð(
uch¬
* *)&
buf
[i];

731 
my_bšd
[
i
].
bufãr_Ëngth
ð()
	`¡¾’
(
buf
[i]);

733 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

734 
	`check_¡mt_rc
(
rc
, 
¡mt
);

736 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

737 
	`check_¡mt_rc
(
rc
, 
¡mt
);

739 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

740 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

742 
	`mysql_¡mt_þo£
(
¡mt
);

743 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable1");

744 
	`check_mysql_rc
(
rc
, 
mysql
);

746  
OK
;

747 
	}
}

751 
	$‹¡_bug11901
(
MYSQL
 *
mysql
)

753 
MYSQL_STMT
 *
¡mt
;

754 
MYSQL_BIND
 
my_bšd
[2];

755 
rc
;

756 
wÜkd•t
[20];

757 
ulÚg
 
wÜkd•t_Ën
;

758 
ušt32
 
em²o
;

759 cÚ¡ 
ulÚg
 
ty³
ð(ulÚg)
CURSOR_TYPE_READ_ONLY
;

760 cÚ¡ *
¡mt_‹xt
;

763 
¡mt_‹xt
= "dropable ifƒxists1,2";

764 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

765 
	`check_mysql_rc
(
rc
, 
mysql
);

767 
¡mt_‹xt
= "createable1 ("

774 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

775 
	`check_mysql_rc
(
rc
, 
mysql
);

777 
¡mt_‹xt
= "insert into1 values "

811 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

812 
	`check_mysql_rc
(
rc
, 
mysql
);

814 
¡mt_‹xt
= "createable2 ("

820 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

821 
	`check_mysql_rc
(
rc
, 
mysql
);

823 
¡mt_‹xt
= "insert into2 values "

833 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

834 
	`check_mysql_rc
(
rc
, 
mysql
);

836 
¡mt_‹xt
= "select1.empno,1.workdept "

843 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

844 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

845 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

846 
	`check_¡mt_rc
(
rc
, 
¡mt
);

847 
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_CURSOR_TYPE
, (*è&
ty³
);

848 
	`check_¡mt_rc
(
rc
, 
¡mt
);

851 
	`mem£t
(
my_bšd
, '\0', (my_bind));

853 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

854 
my_bšd
[0].
bufãr
ð&
em²o
;

855 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

856 
	`check_¡mt_rc
(
rc
, 
¡mt
);

858 
my_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_VAR_STRING
;

859 
my_bšd
[1].
bufãr
ð(*è
wÜkd•t
;

860 
my_bšd
[1].
bufãr_Ëngth
ð(
wÜkd•t
);

861 
my_bšd
[1].
Ëngth
ð&
wÜkd•t_Ën
;

863 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

864 
	`check_¡mt_rc
(
rc
, 
¡mt
);

866 
em²o
= 10;

869 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

870 
	`check_¡mt_rc
(
rc
, 
¡mt
);

872 
	`mysql_¡mt_þo£
(
¡mt
);

874 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable1,2");

875 
	`check_mysql_rc
(
rc
, 
mysql
);

877  
OK
;

878 
	}
}

882 
	$‹¡_bug11904
(
MYSQL
 *
mysql
)

884 
MYSQL_STMT
 *
¡mt1
;

885 
rc
;

886 cÚ¡ *
¡mt_‹xt
;

887 cÚ¡ 
ulÚg
 
ty³
ð(ulÚg)
CURSOR_TYPE_READ_ONLY
;

888 
MYSQL_BIND
 
my_bšd
[2];

889 
couÁry_id
=0;

890 
row_d©a
[11]= {0};

893 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS bug11904b");

894 
	`check_mysql_rc
(
rc
, 
mysql
);

895 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE bug11904b (id int,‚ame char(10),…rimary key(id,‚ame))");

896 
	`check_mysql_rc
(
rc
, 
mysql
);

898 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTO bug11904b VALUES (1, 'sofia'), (1,'plovdiv'),"

902 
	`check_mysql_rc
(
rc
, 
mysql
);

903 
	`mysql_comm™
(
mysql
);

905 
¡mt1
ð
	`mysql_¡mt_š™
(
mysql
);

906 
	`mysql_¡mt_©Œ_£t
(
¡mt1
, 
STMT_ATTR_CURSOR_TYPE
, (cÚ¡ *è&
ty³
);

908 
¡mt_‹xt
= "SELECT id, MIN(name) FROM bug11904b GROUP BY id ORDER BY id";

910 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt1
, 
	`SL
(
¡mt_‹xt
));

911 
	`check_¡mt_rc
(
rc
, 
¡mt1
);

913 
	`mem£t
(
my_bšd
, 0, (my_bind));

914 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

915 
my_bšd
[0].
bufãr
=& 
couÁry_id
;

916 
my_bšd
[0].
bufãr_Ëngth
= 0;

917 
my_bšd
[0].
Ëngth
= 0;

919 
my_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

920 
my_bšd
[1].
bufãr
=& 
row_d©a
;

921 
my_bšd
[1].
bufãr_Ëngth
ð(
row_d©a
) - 1;

922 
my_bšd
[1].
Ëngth
= 0;

924 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt1
, 
my_bšd
);

925 
	`check_¡mt_rc
(
rc
, 
¡mt1
);

927 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt1
);

928 
	`check_¡mt_rc
(
rc
, 
¡mt1
);

930 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt1
);

931 
	`check_¡mt_rc
(
rc
, 
¡mt1
);

932 
	`FAIL_UNLESS
(
couÁry_id
 == 1, "country_id != 1");

933 
	`FAIL_UNLESS
(
	`memcmp
(
row_d©a
, "plovdiv", 7) == 0, "row_data != 'plovdiv'");

935 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt1
);

936 
	`check_¡mt_rc
(
rc
, 
¡mt1
);

937 
	`FAIL_UNLESS
(
couÁry_id
 == 2, "country_id != 2");

938 
	`FAIL_UNLESS
(
	`memcmp
(
row_d©a
, "LA", 2) == 0, "row_data != 'LA'");

940 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt1
);

941 
	`check_¡mt_rc
(
rc
, 
¡mt1
);

942 
	`FAIL_UNLESS
(
couÁry_id
 == 3, "country_id != 3");

943 
	`FAIL_UNLESS
(
	`memcmp
(
row_d©a
, "berlin", 6) == 0, "row_data != 'Berlin'");

945 
rc
ð
	`mysql_¡mt_þo£
(
¡mt1
);

946 
	`check_¡mt_rc
(
rc
, 
¡mt1
);

948 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable bug11904b");

949 
	`check_mysql_rc
(
rc
, 
mysql
);

951  
OK
;

952 
	}
}

957 
	$‹¡_bug12243
(
MYSQL
 *
mysql
)

959 
MYSQL_STMT
 *
¡mt1
, *
¡mt2
;

960 
rc
;

961 cÚ¡ *
¡mt_‹xt
;

962 
ulÚg
 
ty³
;

964 ià(!
	`check_v¬ŸbË
(
mysql
, "@@have_innodb", "YES"))

966 
	`dŸg
("Skip -> Test„equired InnoDB");

967  
SKIP
;

971 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxists1");

972 
	`check_mysql_rc
(
rc
, 
mysql
);

973 
rc
ð
	`mysql_qu”y
(
mysql
, "createable1 (a int)ƒngine=InnoDB");

974 
	`check_mysql_rc
(
rc
, 
mysql
);

975 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into1 (a) values (1), (2)");

976 
	`check_mysql_rc
(
rc
, 
mysql
);

977 
	`mysql_autocomm™
(
mysql
, 
FALSE
);

979 
¡mt1
ð
	`mysql_¡mt_š™
(
mysql
);

980 
¡mt2
ð
	`mysql_¡mt_š™
(
mysql
);

981 
ty³
ð(
ulÚg
è
CURSOR_TYPE_READ_ONLY
;

982 
rc
ð
	`mysql_¡mt_©Œ_£t
(
¡mt1
, 
STMT_ATTR_CURSOR_TYPE
, (cÚ¡ *è&
ty³
);

983 
	`check_¡mt_rc
(
rc
, 
¡mt1
);

984 
rc
ð
	`mysql_¡mt_©Œ_£t
(
¡mt2
, 
STMT_ATTR_CURSOR_TYPE
, (cÚ¡ *è&
ty³
);

985 
	`check_¡mt_rc
(
rc
, 
¡mt1
);

987 
¡mt_‹xt
= "select‡ from1";

989 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt1
, 
	`SL
(
¡mt_‹xt
));

990 
	`check_¡mt_rc
(
rc
, 
¡mt1
);

991 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt1
);

992 
	`check_¡mt_rc
(
rc
, 
¡mt1
);

993 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt1
);

994 
	`check_¡mt_rc
(
rc
, 
¡mt1
);

996 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt2
, 
	`SL
(
¡mt_‹xt
));

997 
	`check_¡mt_rc
(
rc
, 
¡mt2
);

998 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt2
);

999 
	`check_¡mt_rc
(
rc
, 
¡mt2
);

1000 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt2
);

1001 
	`check_¡mt_rc
(
rc
, 
¡mt2
);

1003 
rc
ð
	`mysql_¡mt_þo£
(
¡mt1
);

1004 
	`check_¡mt_rc
(
rc
, 
¡mt1
);

1005 
rc
ð
	`mysql_comm™
(
mysql
);

1006 
	`check_mysql_rc
(
rc
, 
mysql
);

1007 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt2
);

1008 
	`check_¡mt_rc
(
rc
, 
¡mt2
);

1010 
	`mysql_¡mt_þo£
(
¡mt2
);

1011 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable1");

1012 
	`check_mysql_rc
(
rc
, 
mysql
);

1013 
	`mysql_autocomm™
(
mysql
, 
TRUE
);

1015  
OK
;

1016 
	}
}

1020 
	$‹¡_bug11909
(
MYSQL
 *
mysql
)

1022 
MYSQL_STMT
 *
¡mt1
, *
¡mt2
;

1023 
MYSQL_BIND
 
my_bšd
[7];

1024 
rc
;

1025 
fœ¡Çme
[20], 
midš™
[20], 
Ï¡Çme
[20], 
wÜkd•t
[20];

1026 
ulÚg
 
fœ¡Çme_Ën
, 
midš™_Ën
, 
Ï¡Çme_Ën
, 
wÜkd•t_Ën
;

1027 
ušt32
 
em²o
;

1028 
§Ïry
;

1029 
bÚus
;

1030 cÚ¡ *
¡mt_‹xt
;

1031 cÚ¡ 
ulÚg
 
ty³
ð(ulÚg)
CURSOR_TYPE_READ_ONLY
;

1034 
¡mt_‹xt
= "dropable ifƒxists1";

1035 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

1036 
	`check_mysql_rc
(
rc
, 
mysql
);

1038 
¡mt_‹xt
= "createable1 ("

1044 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

1045 
	`check_mysql_rc
(
rc
, 
mysql
);

1047 
¡mt_‹xt
= "insert into1 values "

1053 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

1054 
	`check_mysql_rc
(
rc
, 
mysql
);

1058 
¡mt_‹xt
= "SELECTƒmpno, firstname, midinit,†astname,"

1060 
¡mt1
ð
	`mysql_¡mt_š™
(
mysql
);

1061 
	`FAIL_IF
(!
¡mt1
, 
	`mysql_”rÜ
(
mysql
));

1062 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt1
, 
	`SL
(
¡mt_‹xt
));

1063 
	`check_¡mt_rc
(
rc
, 
¡mt1
);

1064 
	`mysql_¡mt_©Œ_£t
(
¡mt1
, 
STMT_ATTR_CURSOR_TYPE
,

1065 (cÚ¡ *è&
ty³
);

1067 
	`mem£t
(
my_bšd
, '\0', (my_bind));

1068 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

1069 
my_bšd
[0].
bufãr
ð(*è&
em²o
;

1071 
my_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_VAR_STRING
;

1072 
my_bšd
[1].
bufãr
ð(*è
fœ¡Çme
;

1073 
my_bšd
[1].
bufãr_Ëngth
ð(
fœ¡Çme
);

1074 
my_bšd
[1].
Ëngth
ð&
fœ¡Çme_Ën
;

1076 
my_bšd
[2].
bufãr_ty³
ð
MYSQL_TYPE_VAR_STRING
;

1077 
my_bšd
[2].
bufãr
ð(*è
midš™
;

1078 
my_bšd
[2].
bufãr_Ëngth
ð(
midš™
);

1079 
my_bšd
[2].
Ëngth
ð&
midš™_Ën
;

1081 
my_bšd
[3].
bufãr_ty³
ð
MYSQL_TYPE_VAR_STRING
;

1082 
my_bšd
[3].
bufãr
ð(*è
Ï¡Çme
;

1083 
my_bšd
[3].
bufãr_Ëngth
ð(
Ï¡Çme
);

1084 
my_bšd
[3].
Ëngth
ð&
Ï¡Çme_Ën
;

1086 
my_bšd
[4].
bufãr_ty³
ð
MYSQL_TYPE_VAR_STRING
;

1087 
my_bšd
[4].
bufãr
ð(*è
wÜkd•t
;

1088 
my_bšd
[4].
bufãr_Ëngth
ð(
wÜkd•t
);

1089 
my_bšd
[4].
Ëngth
ð&
wÜkd•t_Ën
;

1091 
my_bšd
[5].
bufãr_ty³
ð
MYSQL_TYPE_DOUBLE
;

1092 
my_bšd
[5].
bufãr
ð(*è&
§Ïry
;

1094 
my_bšd
[6].
bufãr_ty³
ð
MYSQL_TYPE_FLOAT
;

1095 
my_bšd
[6].
bufãr
ð(*è&
bÚus
;

1096 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt1
, 
my_bšd
);

1097 
	`check_¡mt_rc
(
rc
, 
¡mt1
);

1099 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt1
);

1100 
	`check_¡mt_rc
(
rc
, 
¡mt1
);

1102 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt1
);

1103 
	`FAIL_UNLESS
(
rc
 == 0, "rc != 0");

1104 
	`FAIL_UNLESS
(
em²o
 == 10, "empno != 10");

1105 
	`FAIL_UNLESS
(
	`¡rcmp
(
fœ¡Çme
, "CHRISTINE""") == 0, "firstname != 'Christine'");

1106 
	`FAIL_UNLESS
(
	`¡rcmp
(
midš™
, "I""") == 0, "");

1107 
	`FAIL_UNLESS
(
	`¡rcmp
(
Ï¡Çme
, "HAAS""") == 0, "lastname != 'HAAS'");

1108 
	`FAIL_UNLESS
(
	`¡rcmp
(
wÜkd•t
, "A00""") == 0, "workdept != 'A00'");

1109 
	`FAIL_UNLESS
(
§Ïry
 == () 52750.0, "salary != 52750");

1110 
	`FAIL_UNLESS
(
bÚus
 == () 1000.0, "bonus =! 1000");

1112 
¡mt_‹xt
 = "SELECTƒmpno, firstname FROM1";

1113 
¡mt2
ð
	`mysql_¡mt_š™
(
mysql
);

1114 
	`FAIL_IF
(!
¡mt2
, 
	`mysql_”rÜ
(
mysql
));

1115 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt2
, 
	`SL
(
¡mt_‹xt
));

1116 
	`check_¡mt_rc
(
rc
, 
¡mt2
);

1117 
	`mysql_¡mt_©Œ_£t
(
¡mt2
, 
STMT_ATTR_CURSOR_TYPE
,

1118 (cÚ¡ *è&
ty³
);

1119 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt2
, 
my_bšd
);

1120 
	`check_¡mt_rc
(
rc
, 
¡mt2
);

1122 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt2
);

1123 
	`check_¡mt_rc
(
rc
, 
¡mt2
);

1125 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt2
);

1126 
	`FAIL_UNLESS
(
rc
 == 0, "rc != 0");

1128 
	`FAIL_UNLESS
(
em²o
 == 10, "empno != 10");

1129 
	`FAIL_UNLESS
(
	`¡rcmp
(
fœ¡Çme
, "CHRISTINE""") == 0, "firstname != 'Christine'");

1131 
rc
ð
	`mysql_¡mt_»£t
(
¡mt2
);

1132 
	`check_¡mt_rc
(
rc
, 
¡mt2
);

1136 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt1
);

1137 
	`FAIL_UNLESS
(
rc
 == 0, "rc != 0");

1139 
	`mysql_¡mt_þo£
(
¡mt1
);

1140 
	`mysql_¡mt_þo£
(
¡mt2
);

1141 
rc
ð
	`mysql_rÞlback
(
mysql
);

1142 
	`check_mysql_rc
(
rc
, 
mysql
);

1144 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable1");

1145 
	`check_mysql_rc
(
rc
, 
mysql
);

1147  
OK
;

1148 
	}
}

1152 
	$‹¡_bug13488
(
MYSQL
 *
mysql
)

1154 
MYSQL_BIND
 
my_bšd
[3];

1155 
MYSQL_STMT
 *
¡mt1
;

1156 
rc
, 
f1
, 
f2
, 
f3
, 
i
;

1157 cÚ¡ 
ulÚg
 
ty³
ð
CURSOR_TYPE_READ_ONLY
;

1158 cÚ¡ *
qu”y
= "select f1, f2, f3 from1†eft join2 on f1=f2 where f1=1";

1161 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxists1,2");

1162 
	`check_mysql_rc
(
rc
, 
mysql
);

1163 
rc
ð
	`mysql_qu”y
(
mysql
, "createable1 (f1 int‚ot‚ull…rimary key)");

1164 
	`check_mysql_rc
(
rc
, 
mysql
);

1165 
rc
ð
	`mysql_qu”y
(
mysql
, "createable2 (f2 int‚ot‚ull…rimary key, "

1167 
	`check_mysql_rc
(
rc
, 
mysql
);

1168 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into1 values (1), (2)");

1169 
	`check_mysql_rc
(
rc
, 
mysql
);

1170 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into2 values (1,2), (2,4)");

1171 
	`check_mysql_rc
(
rc
, 
mysql
);

1173 
	`mem£t
(
my_bšd
, 0, (my_bind));

1174 
i
= 0; i < 3; i++)

1176 
my_bšd
[
i
].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

1177 
my_bšd
[
i
].
bufãr_Ëngth
= 4;

1178 
my_bšd
[
i
].
Ëngth
= 0;

1180 
my_bšd
[0].
bufãr
=&
f1
;

1181 
my_bšd
[1].
bufãr
=&
f2
;

1182 
my_bšd
[2].
bufãr
=&
f3
;

1184 
¡mt1
ð
	`mysql_¡mt_š™
(
mysql
);

1185 
rc
ð
	`mysql_¡mt_©Œ_£t
(
¡mt1
,
STMT_ATTR_CURSOR_TYPE
, (cÚ¡ *)&
ty³
);

1186 
	`check_¡mt_rc
(
rc
, 
¡mt1
);

1188 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt1
, 
	`SL
(
qu”y
));

1189 
	`check_¡mt_rc
(
rc
, 
¡mt1
);

1191 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt1
);

1192 
	`check_¡mt_rc
(
rc
, 
¡mt1
);

1194 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt1
, 
my_bšd
);

1195 
	`check_¡mt_rc
(
rc
, 
¡mt1
);

1197 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt1
);

1198 
	`check_¡mt_rc
(
rc
, 
¡mt1
);

1200 
rc
ð
	`mysql_¡mt_ä“_»suÉ
(
¡mt1
);

1201 
	`check_¡mt_rc
(
rc
, 
¡mt1
);

1203 
rc
ð
	`mysql_¡mt_»£t
(
¡mt1
);

1204 
	`check_¡mt_rc
(
rc
, 
¡mt1
);

1206 
rc
ð
	`mysql_¡mt_þo£
(
¡mt1
);

1207 
	`check_¡mt_rc
(
rc
, 
¡mt1
);

1209 
	`FAIL_UNLESS
(
f1
 == 1, "f1 != 1");

1210 
	`FAIL_UNLESS
(
f2
 == 1, "f2 != 1");

1211 
	`FAIL_UNLESS
(
f3
 == 2, "f3 != 2");

1212 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable1,2");

1213 
	`check_mysql_rc
(
rc
, 
mysql
);

1215  
OK
;

1216 
	}
}

1223 
	$‹¡_bug13524
(
MYSQL
 *
mysql
)

1225 
MYSQL_STMT
 *
¡mt
;

1226 
rc
;

1227 
w¬nšg_couÁ
;

1228 cÚ¡ 
ulÚg
 
ty³
ð
CURSOR_TYPE_READ_ONLY
;

1229 cÚ¡ *
qu”y
= "select * from1";

1232 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxists1,2");

1233 
	`check_mysql_rc
(
rc
, 
mysql
);

1234 
rc
ð
	`mysql_qu”y
(
mysql
, "createable1 (a int‚ot‚ull…rimary key)");

1235 
	`check_mysql_rc
(
rc
, 
mysql
);

1236 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into1 values (1), (2), (3), (4)");

1237 
	`check_mysql_rc
(
rc
, 
mysql
);

1239 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

1240 
rc
ð
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_CURSOR_TYPE
, (cÚ¡ *è&
ty³
);

1241 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1243 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

1244 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1246 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1247 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1249 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

1250 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1252 
w¬nšg_couÁ
ð
	`mysql_w¬nšg_couÁ
(
mysql
);

1253 
	`FAIL_UNLESS
(
w¬nšg_couÁ
 == 0, "warning_count != 0");

1256 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxists2");

1257 
	`check_mysql_rc
(
rc
, 
mysql
);

1258 
w¬nšg_couÁ
ð
	`mysql_w¬nšg_couÁ
(
mysql
);

1259 
	`FAIL_UNLESS
(
w¬nšg_couÁ
 == 1, "warning_count != 1");

1265 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

1266 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1267 
w¬nšg_couÁ
ð
	`mysql_w¬nšg_couÁ
(
mysql
);

1268 
	`FAIL_UNLESS
(
w¬nšg_couÁ
 == 0, "warning_count != 0");

1271 
	`mysql_¡mt_þo£
(
¡mt
);

1272 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable1");

1273 
	`check_mysql_rc
(
rc
, 
mysql
);

1275  
OK
;

1276 
	}
}

1282 
	$‹¡_bug14845
(
MYSQL
 *
mysql
)

1284 
MYSQL_STMT
 *
¡mt
;

1285 
rc
;

1286 cÚ¡ 
ulÚg
 
ty³
ð
CURSOR_TYPE_READ_ONLY
;

1287 cÚ¡ *
qu”y
= "select count(*) from1 where 1 = 0";

1290 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxists1");

1291 
	`check_mysql_rc
(
rc
, 
mysql
);

1292 
rc
ð
	`mysql_qu”y
(
mysql
, "createable1 (id int(11) default‚ull, "

1295 
	`check_mysql_rc
(
rc
, 
mysql
);

1296 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into1 values (1,'abc'),(2,'def')");

1297 
	`check_mysql_rc
(
rc
, 
mysql
);

1299 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

1300 
rc
ð
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_CURSOR_TYPE
, (cÚ¡ *è&
ty³
);

1301 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1303 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

1304 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1306 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1307 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1309 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

1310 
	`FAIL_UNLESS
(
rc
 == 0, "");

1312 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

1313 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "");

1316 
	`mysql_¡mt_þo£
(
¡mt
);

1317 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable1");

1318 
	`check_mysql_rc
(
rc
, 
mysql
);

1319  
OK
;

1320 
	}
}

1327 
	$‹¡_bug14210
(
MYSQL
 *
mysql
)

1329 
MYSQL_STMT
 *
¡mt
;

1330 
rc
, 
i
;

1331 cÚ¡ *
¡mt_‹xt
;

1332 
ulÚg
 
ty³
;

1334 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxists1");

1335 
	`check_mysql_rc
(
rc
, 
mysql
);

1341 
rc
ð
	`mysql_qu”y
(
mysql
, "createable1 (a varchar(255))ƒngine=InnoDB");

1342 
	`check_mysql_rc
(
rc
, 
mysql
);

1343 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into1 (a) values (repeat('a', 256))");

1344 
	`check_mysql_rc
(
rc
, 
mysql
);

1345 
rc
ð
	`mysql_qu”y
(
mysql
, "set @@session.max_heap_table_size=16384");

1348 
i
= 0; i < 8; i++)

1350 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into1 (a) select‡ from1");

1351 
	`check_mysql_rc
(
rc
, 
mysql
);

1354 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

1355 
ty³
ð(
ulÚg
è
CURSOR_TYPE_READ_ONLY
;

1356 
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_CURSOR_TYPE
, (cÚ¡ *è&
ty³
);

1358 
¡mt_‹xt
= "select‡ from1";

1360 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

1361 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1362 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1363 (
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
)) == 0);

1364 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

1366 
rc
ð
	`mysql_¡mt_þo£
(
¡mt
);

1368 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable1");

1369 
	`check_mysql_rc
(
rc
, 
mysql
);

1370 
rc
ð
	`mysql_qu”y
(
mysql
, "set @@session.max_heap_table_size=default");

1371 
	`check_mysql_rc
(
rc
, 
mysql
);

1373  
OK
;

1374 
	}
}

1381 
	$‹¡_bug24179
(
MYSQL
 *
mysql
)

1383 
rc
;

1384 
MYSQL_STMT
 *
¡mt
;

1386 
¡mt
ð
	`Ý’_cursÜ
(
mysql
, "select 1 into @a");

1387 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1388 
	`FAIL_UNLESS
(
rc
, "Errorƒxpected");

1389 
	`FAIL_UNLESS
(
	`mysql_¡mt_”ºo
(
¡mt
) == 1323, "stmt_errno != 1323");

1390 
	`mysql_¡mt_þo£
(
¡mt
);

1392  
OK
;

1393 
	}
}

1399 
	$‹¡_bug32265
(
MYSQL
 *
mysql
)

1401 
rc
;

1402 
MYSQL_STMT
 *
¡mt
;

1403 
MYSQL_FIELD
 *
f›ld
;

1404 
MYSQL_RES
 *
m‘ad©a
;

1406 ià(
	`mysql_g‘_£rv”_v”siÚ
(
mysql
) < 50100) {

1407 
	`dŸg
("Test„equires MySQL Server version 5.1 or‡bove");

1408  
SKIP
;

1411 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

1412 
	`check_mysql_rc
(
rc
, 
mysql
);

1413 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP VIEW IF EXISTS v1");

1414 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE1 (a INTEGER)");

1415 
	`check_mysql_rc
(
rc
, 
mysql
);

1416 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTO1 VALUES (1)");

1417 
	`check_mysql_rc
(
rc
, 
mysql
);

1418 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE VIEW v1 AS SELECT * FROM1");

1419 
	`check_mysql_rc
(
rc
, 
mysql
);

1421 
¡mt
ð
	`Ý’_cursÜ
(
mysql
, "SELECT * FROM1");

1422 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1423 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1424 
m‘ad©a
ð
	`mysql_¡mt_»suÉ_m‘ad©a
(
¡mt
);

1425 
f›ld
ð
	`mysql_ãtch_f›ld
(
m‘ad©a
);

1426 
	`FAIL_UNLESS
(
f›ld
, "couldn't fetch field");

1427 
	`FAIL_UNLESS
(
	`¡rcmp
(
f›ld
->
bË
, "t1") == 0, "table !=1");

1428 
	`FAIL_UNLESS
(
	`¡rcmp
(
f›ld
->
Üg_bË
, "t1") == 0, "org_table !=1");

1429 
	`FAIL_UNLESS
(
	`¡rcmp
(
f›ld
->
db
, 
schema
) == 0, "db != schema");

1430 
	`mysql_ä“_»suÉ
(
m‘ad©a
);

1431 
	`mysql_¡mt_þo£
(
¡mt
);

1433 
¡mt
ð
	`Ý’_cursÜ
(
mysql
, "SELECT‡ '' FROM1 ``");

1434 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1435 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1436 
m‘ad©a
ð
	`mysql_¡mt_»suÉ_m‘ad©a
(
¡mt
);

1437 
f›ld
ð
	`mysql_ãtch_f›ld
(
m‘ad©a
);

1438 
	`FAIL_UNLESS
(
	`¡rcmp
(
f›ld
->
bË
, "") == 0, "field != ''");

1439 
	`FAIL_UNLESS
(
	`¡rcmp
(
f›ld
->
Üg_bË
, "t1") == 0, "org_table !=1");

1440 
	`FAIL_UNLESS
(
	`¡rcmp
(
f›ld
->
db
, 
schema
) == 0, "db != schema");

1441 
	`mysql_ä“_»suÉ
(
m‘ad©a
);

1442 
	`mysql_¡mt_þo£
(
¡mt
);

1444 
¡mt
ð
	`Ý’_cursÜ
(
mysql
, "SELECT‡ '' FROM1 ``");

1445 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1446 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1447 
m‘ad©a
ð
	`mysql_¡mt_»suÉ_m‘ad©a
(
¡mt
);

1448 
f›ld
ð
	`mysql_ãtch_f›ld
(
m‘ad©a
);

1449 
	`FAIL_UNLESS
(
	`¡rcmp
(
f›ld
->
bË
, "") == 0, "table != ''");

1450 
	`FAIL_UNLESS
(
	`¡rcmp
(
f›ld
->
Üg_bË
, "t1") == 0, "org_table !=1");

1451 
	`FAIL_UNLESS
(
	`¡rcmp
(
f›ld
->
db
, 
schema
) == 0, "db != schema");

1452 
	`mysql_ä“_»suÉ
(
m‘ad©a
);

1453 
	`mysql_¡mt_þo£
(
¡mt
);

1455 
¡mt
ð
	`Ý’_cursÜ
(
mysql
, "SELECT * FROM v1");

1456 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1457 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1458 
m‘ad©a
ð
	`mysql_¡mt_»suÉ_m‘ad©a
(
¡mt
);

1459 
f›ld
ð
	`mysql_ãtch_f›ld
(
m‘ad©a
);

1460 
	`FAIL_UNLESS
(
	`¡rcmp
(
f›ld
->
bË
, "v1") == 0, "table != v1");

1461 
	`FAIL_UNLESS
(
	`¡rcmp
(
f›ld
->
Üg_bË
, "v1") == 0, "org_table != v1");

1462 
	`FAIL_UNLESS
(
	`¡rcmp
(
f›ld
->
db
, 
schema
) == 0, "db != schema");

1463 
	`mysql_ä“_»suÉ
(
m‘ad©a
);

1464 
	`mysql_¡mt_þo£
(
¡mt
);

1466 
¡mt
ð
	`Ý’_cursÜ
(
mysql
, "SELECT * FROM v1 /* SIC */ GROUP BY 1");

1467 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1468 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1469 
m‘ad©a
ð
	`mysql_¡mt_»suÉ_m‘ad©a
(
¡mt
);

1470 
f›ld
ð
	`mysql_ãtch_f›ld
(
m‘ad©a
);

1471 
	`FAIL_UNLESS
(
	`¡rcmp
(
f›ld
->
bË
, "v1") == 0, "table != v1");

1472 
	`FAIL_UNLESS
(
	`¡rcmp
(
f›ld
->
Üg_bË
, "v1") == 0, "org_table != v1");

1473 
	`FAIL_UNLESS
(
	`¡rcmp
(
f›ld
->
db
, 
schema
) == 0, "schema != db");

1474 
	`mysql_ä“_»suÉ
(
m‘ad©a
);

1475 
	`mysql_¡mt_þo£
(
¡mt
);

1477 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP VIEW v1");

1478 
	`check_mysql_rc
(
rc
, 
mysql
);

1479 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE1");

1480 
	`check_mysql_rc
(
rc
, 
mysql
);

1482  
OK
;

1483 
	}
}

1489 
	$‹¡_bug38486
(
MYSQL
 *
mysql
)

1491 
MYSQL_STMT
 *
¡mt
;

1492 cÚ¡ *
¡mt_‹xt
;

1493 
rc
;

1494 
ty³
ð
CURSOR_TYPE_READ_ONLY
;

1496 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

1497 
rc
ð
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_CURSOR_TYPE
, (*)&
ty³
);

1498 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1499 
¡mt_‹xt
= "CREATE TABLE1 (a INT)";

1500 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

1501 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1502 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1503 
	`mysql_¡mt_þo£
(
¡mt
);

1505 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

1506 
rc
ð
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_CURSOR_TYPE
, (*)&
ty³
);

1507 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1508 
¡mt_‹xt
= "INSERT INTO1 VALUES (1)";

1509 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

1510 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1511 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1512 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1513 
	`mysql_¡mt_þo£
(
¡mt
);

1515  
OK
;

1516 
	}
}

1518 
	$‹¡_bug8880
(
MYSQL
 *
mysql
)

1520 
MYSQL_STMT
 *
¡mt_li¡
[2], **
¡mt
;

1521 
MYSQL_STMT
 **
¡mt_li¡_’d
ð(MYSQL_STMT**è
¡mt_li¡
 + 2;

1522 
rc
;

1525 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxists1");

1526 
	`check_mysql_rc
(
rc
, 
mysql
);

1527 
rc
ð
	`mysql_qu”y
(
mysql
, "createable1 (a int‚ot‚ull…rimary key, b int)");

1528 
	`check_mysql_rc
(
rc
, 
mysql
);

1529 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into1 values (1,1)");

1530 
	`check_mysql_rc
(
rc
, 
mysql
);

1535 
¡mt
ð
¡mt_li¡
; stmˆ< 
¡mt_li¡_’d
; stmt++)

1536 *
¡mt
ð
	`Ý’_cursÜ
(
mysql
, "select‡ from1");

1537 
¡mt
ð
¡mt_li¡
; stmˆ< 
¡mt_li¡_’d
; stmt++)

1539 
rc
ð
	`mysql_¡mt_execu‹
(*
¡mt
);

1540 
	`check_¡mt_rc
(
rc
, *
¡mt
);

1542 
¡mt
ð
¡mt_li¡
; stmˆ< 
¡mt_li¡_’d
; stmt++)

1543 
	`mysql_¡mt_þo£
(*
¡mt
);

1544  
OK
;

1545 
	}
}

1547 
	$‹¡_bug9159
(
MYSQL
 *
mysql
)

1549 
MYSQL_STMT
 *
¡mt
;

1550 
rc
;

1551 cÚ¡ *
¡mt_‹xt
= "select‡, b from1";

1552 cÚ¡ 
ty³
ð
CURSOR_TYPE_READ_ONLY
;

1555 
	`mysql_qu”y
(
mysql
, "dropable ifƒxists1");

1556 
	`mysql_qu”y
(
mysql
, "createable1 (a int‚ot‚ull…rimary key, b int)");

1557 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into1 values (1,1)");

1558 
	`check_mysql_rc
(
rc
, 
mysql
);

1560 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

1561 
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

1562 
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_CURSOR_TYPE
, (cÚ¡ *)&
ty³
);

1564 
	`mysql_¡mt_execu‹
(
¡mt
);

1565 
	`mysql_¡mt_þo£
(
¡mt
);

1566 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxists1");

1567 
	`check_mysql_rc
(
rc
, 
mysql
);

1568  
OK
;

1569 
	}
}

1577 
	$‹¡_bug9478
(
MYSQL
 *
mysql
)

1579 
MYSQL_STMT
 *
¡mt
;

1580 
MYSQL_BIND
 
my_bšd
[1];

1581 
a
[6];

1582 
ulÚg
 
a_Ën
;

1583 
rc
, 
i
;

1585 
	`mysql_qu”y
(
mysql
, "dropable ifƒxists1");

1586 
	`mysql_qu”y
(
mysql
, "createable1 (id integer‚ot‚ull…rimary key, "

1588 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into1 (id,‚ame) values "

1590 
	`check_mysql_rc
(
rc
, 
mysql
);

1592 
¡mt
ð
	`Ý’_cursÜ
(
mysql
, "select‚ame from1 where id=2");

1594 
	`mem£t
(
my_bšd
, '\0', (my_bind));

1595 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

1596 
my_bšd
[0].
bufãr
ð(*è
a
;

1597 
my_bšd
[0].
bufãr_Ëngth
ð(
a
);

1598 
my_bšd
[0].
Ëngth
ð&
a_Ën
;

1599 
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

1601 
i
= 0; i < 5; i++)

1603 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1604 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1605 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

1606 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1617 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1618 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1620 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

1621 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1622 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

1623 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

1626 
buff
[8];

1628 
	`št4¡Üe
(
buff
, 
¡mt
->
¡mt_id
);

1629 
buff
[4]= 1;

1634 
	`FAIL_UNLESS
(
rc
, "errorƒxpected");

1637 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1638 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1640 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

1641 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1643 
rc
ð
	`mysql_¡mt_»£t
(
¡mt
);

1644 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1645 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

1652 
rc
ð
	`mysql_¡mt_þo£
(
¡mt
);

1653 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1656 
¡mt
ð
	`Ý’_cursÜ
(
mysql
, "select‚ame from1");

1658 
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

1660 
i
= 0; i < 5; i++)

1662 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1663 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1664 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

1665 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1666 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1667 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1669 ! (
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
)));

1670 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

1672 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1673 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1675 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

1676 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1678 
rc
ð
	`mysql_¡mt_»£t
(
¡mt
);

1679 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1680 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

1681 
	`FAIL_UNLESS
(
rc
 && 
	`mysql_¡mt_”ºo
(
¡mt
), "Errorƒxpected");

1684 
rc
ð
	`mysql_¡mt_þo£
(
¡mt
);

1685 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1687 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable1");

1688 
	`check_mysql_rc
(
rc
, 
mysql
);

1689  
OK
;

1690 
	}
}

1694 
	$‹¡_bug9520
(
MYSQL
 *
mysql
)

1696 
MYSQL_STMT
 *
¡mt
;

1697 
MYSQL_BIND
 
my_bšd
[1];

1698 
a
[6];

1699 
ulÚg
 
a_Ën
;

1700 
rc
, 
row_couÁ
= 0;

1703 
	`mysql_qu”y
(
mysql
, "dropable ifƒxists1");

1704 
	`mysql_qu”y
(
mysql
, "createable1 (a char(5), b char(5), c char(5),"

1706 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into1 values ('x', 'y', 'z'), "

1708 
	`check_mysql_rc
(
rc
, 
mysql
);

1710 
¡mt
ð
	`Ý’_cursÜ
(
mysql
, "select distinct b from1");

1717 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1718 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1720 
	`mem£t
(
my_bšd
, '\0', (my_bind));

1721 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

1722 
my_bšd
[0].
bufãr
ð(*è
a
;

1723 
my_bšd
[0].
bufãr_Ëngth
ð(
a
);

1724 
my_bšd
[0].
Ëngth
ð&
a_Ën
;

1726 
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

1728 !(
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
)))

1729 
row_couÁ
++;

1731 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

1733 
	`FAIL_UNLESS
(
row_couÁ
 == 3, "row_count != 3");

1735 
	`mysql_¡mt_þo£
(
¡mt
);

1737 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable1");

1738 
	`check_mysql_rc
(
rc
, 
mysql
);

1739  
OK
;

1740 
	}
}

1747 
	$‹¡_bug9643
(
MYSQL
 *
mysql
)

1749 
MYSQL_STMT
 *
¡mt
;

1750 
MYSQL_BIND
 
my_bšd
[1];

1751 
št32
 
a
;

1752 
rc
;

1753 cÚ¡ *
¡mt_‹xt
;

1754 
num_rows
= 0;

1755 
ulÚg
 
ty³
;

1756 
ulÚg
 
´eãtch_rows
= 5;

1759 
	`mysql_qu”y
(
mysql
, "dropable ifƒxists1");

1760 
	`mysql_qu”y
(
mysql
, "createable1 (id integer‚ot‚ull…rimary key)");

1761 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into1 (id) values "

1763 
	`check_mysql_rc
(
rc
, 
mysql
);

1765 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

1767 
ty³
ð(
ulÚg
è
CURSOR_TYPE_SCROLLABLE
;

1768 
rc
ð
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_CURSOR_TYPE
, (*è&
ty³
);

1769 
	`FAIL_UNLESS
(
rc
, "Errorƒxpected");

1771 
ty³
ð(
ulÚg
è
CURSOR_TYPE_READ_ONLY
;

1772 
rc
ð
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_CURSOR_TYPE
, (*è&
ty³
);

1773 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1774 
rc
ð
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_PREFETCH_ROWS
,

1775 (*è&
´eãtch_rows
);

1776 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1777 
¡mt_‹xt
= "select * from1";

1778 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

1779 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1781 
	`mem£t
(
my_bšd
, '\0', (my_bind));

1782 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

1783 
my_bšd
[0].
bufãr
ð(*è&
a
;

1784 
my_bšd
[0].
bufãr_Ëngth
ð(
a
);

1785 
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

1787 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1788 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1790 (
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
)) == 0)

1791 ++
num_rows
;

1792 
	`FAIL_UNLESS
(
num_rows
 == 9, "num_rows != 9");

1794 
rc
ð
	`mysql_¡mt_þo£
(
¡mt
);

1795 
	`FAIL_UNLESS
(
rc
 == 0, "");

1797 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable1");

1798 
	`check_mysql_rc
(
rc
, 
mysql
);

1799  
OK
;

1800 
	}
}

1803 
my_‹¡s_¡
 
	gmy_‹¡s
[] = {

1804 {"‹¡_basic_cursÜs", 
‹¡_basic_cursÜs
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

1805 {"‹¡_cursÜs_w™h_uniÚ", 
‹¡_cursÜs_w™h_uniÚ
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

1806 {"‹¡_cursÜs_w™h_´oûdu»", 
‹¡_cursÜs_w™h_´oûdu»
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

1807 {"‹¡_bug21206", 
‹¡_bug21206
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

1808 {"‹¡_bug10729", 
‹¡_bug10729
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

1809 {"‹¡_bug10736", 
‹¡_bug10736
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

1810 {"‹¡_bug10794", 
‹¡_bug10794
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

1811 {"‹¡_bug10760", 
‹¡_bug10760
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

1812 {"‹¡_bug11172", 
‹¡_bug11172
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

1813 {"‹¡_bug11656", 
‹¡_bug11656
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

1814 {"‹¡_bug11901", 
‹¡_bug11901
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

1815 {"‹¡_bug11904", 
‹¡_bug11904
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

1816 {"‹¡_bug12243", 
‹¡_bug12243
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

1817 {"‹¡_bug11909", 
‹¡_bug11909
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

1818 {"‹¡_bug13488", 
‹¡_bug13488
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

1819 {"‹¡_bug13524", 
‹¡_bug13524
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

1820 {"‹¡_bug14845", 
‹¡_bug14845
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

1821 {"‹¡_bug14210", 
‹¡_bug14210
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

1822 {"‹¡_bug24179", 
‹¡_bug24179
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

1823 {"‹¡_bug32265", 
‹¡_bug32265
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

1824 {"‹¡_bug38486", 
‹¡_bug38486
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

1825 {"‹¡_bug8880", 
‹¡_bug8880
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

1826 {"‹¡_bug9159", 
‹¡_bug9159
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

1827 {"‹¡_bug9478", 
‹¡_bug9478
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

1828 {"‹¡_bug9520", 
‹¡_bug9520
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

1829 {"‹¡_bug9643", 
‹¡_bug9643
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

1830 {
NULL
, NULL, 0, 0, NULL, NULL}

1833 
	$maš
(
¬gc
, **
¬gv
)

1835 ià(
¬gc
 > 1)

1836 
	`g‘_ÝtiÚs
(
¬gc
, 
¬gv
);

1838 
	`g‘_’vv¬s
();

1840 
	`run_‹¡s
(
my_‹¡s
);

1842 (
	`ex™_¡©us
());

1843 
	}
}

	@unittest/libmariadb/dyncol.c

18 
	~"my_‹¡.h
"

19 
	~"m¬Ÿdb_dyncÞ.h
"

21 
	$ü—‹_dyncÞ_Çmed
(
MYSQL
 *
mysql
)

23 
DYNAMIC_COLUMN
 
dyncÞ
;

24 
DYNAMIC_COLUMN_VALUE
 *
v®s
;

25 
ušt
 
i
, 
cÞumn_couÁ
= 6;

26 
rc
;

27 cÚ¡ *
¡rv®
[]= {"Val1", "Val2", "Val3", "Val4", "Val5", "Val6"};

28 
MYSQL_LEX_STRING
 
keys1
[]= {{(*)"key1", 4}, {(*)"key2", 4},

32 
keys2
[]= {{(*)"key1", 4}, {(*)"key1", 4},

36 
keys3
[]= {{(*)"\x70\x61\x72\x61\x00\x30", 6},

42 
MYSQL_LEX_STRING
 *
my_keys
;

43 
ušt
 
my_couÁ
;

45 
v®s
ð(
DYNAMIC_COLUMN_VALUE
 *)
	`m®loc
(
cÞumn_couÁ
 * (DYNAMIC_COLUMN_VALUE));

47 
i
=0; i < 
cÞumn_couÁ
; i++)

49 
v®s
[
i
].
ty³
ð
DYN_COL_STRING
;

50 
v®s
[
i
].
x
.
¡ršg
.
v®ue
.
¡r
ð(*)
¡rv®
[i];

51 
v®s
[
i
].
x
.
¡ršg
.
v®ue
.
Ëngth
ð
	`¡¾’
(
¡rv®
[i]);

52 
v®s
[
i
].
x
.
¡ršg
.
ch¬£t
ð(
MARIADB_CHARSET_INFO
 *)
mysql
->charset;

53 
	`dŸg
("%s", 
keys3
[
i
].
¡r
);

56 
	`m¬Ÿdb_dyncÞ_š™
(&
dyncÞ
);

57 
rc
ð
	`m¬Ÿdb_dyncÞ_ü—‹_mªy_Çmed
(&
dyncÞ
, 
cÞumn_couÁ
, 
keys1
, 
v®s
, 0);

58 
	`m¬Ÿdb_dyncÞ_ä“
(&
dyncÞ
);

59 
	`FAIL_IF
(
	`m¬Ÿdb_dyncÞ_ü—‹_mªy_Çmed
(&
dyncÞ
, 
cÞumn_couÁ
, 
keys1
, 
v®s
, 1) < 0, "Error");

60 
cÞumn_couÁ
= 0;

61 
	`FAIL_IF
(
	`m¬Ÿdb_dyncÞ_cÞumn_couÁ
(&
dyncÞ
, &
cÞumn_couÁ
) < 0, "Error");

63 
	`FAIL_IF
(
cÞumn_couÁ
 != 6, "6 columnsƒxpected");

64 
	`m¬Ÿdb_dyncÞ_ä“
(&
dyncÞ
);

66 
rc
ð
	`m¬Ÿdb_dyncÞ_ü—‹_mªy_Çmed
(&
dyncÞ
, 
cÞumn_couÁ
, 
keys3
, 
v®s
, 1);

67 ià(
rc
 < 0) {

68 
	`dŸg
("E¼Ü!!: %d", 
rc
);

69  
FAIL
;

71 
cÞumn_couÁ
= 0;

72 
	`FAIL_IF
(
	`m¬Ÿdb_dyncÞ_cÞumn_couÁ
(&
dyncÞ
, &
cÞumn_couÁ
) < 0, "Error");

74 
	`FAIL_IF
(
cÞumn_couÁ
 != 6, "6 columnsƒxpected");

76 
	`m¬Ÿdb_dyncÞ_ä“
(&
dyncÞ
);

80 
	`FAIL_IF
(
	`m¬Ÿdb_dyncÞ_ü—‹_mªy_Çmed
(&
dyncÞ
, 
cÞumn_couÁ
, 
keys2
, 
v®s
, 1) >=0, "Errorƒxpected");

81 
	`m¬Ÿdb_dyncÞ_ä“
(&
dyncÞ
);

84 
rc
ð
	`m¬Ÿdb_dyncÞ_ü—‹_mªy_Çmed
(&
dyncÞ
, 
cÞumn_couÁ
, 
keys3
, 
v®s
, 1);

85 
	`FAIL_IF
(
rc
 < 0, "binary keys failed");

88 
rc
ð
	`m¬Ÿdb_dyncÞ_li¡_Çmed
(&
dyncÞ
, &
my_couÁ
, &
my_keys
);

89 
	`FAIL_IF
(
rc
 < 0, "list‚amed failed");

91 
i
=0; i < 
my_couÁ
; i++)

93 ià(
	`memcmp
(
my_keys
[
i
].
¡r
, 
keys3
[i].¡r, keys3[i].
Ëngth
) != 0)

94 
	`dŸg
("”rÜ key %d", 
i
);

95 
v®s
[
i
].
ty³
=
DYN_COL_NULL
;

97 
rc
ð
	`m¬Ÿdb_dyncÞ_upd©e_mªy_Çmed
(&
dyncÞ
, 
cÞumn_couÁ
, 
keys3
, 
v®s
);

98 
	`FAIL_IF
(
rc
 < 0, "update failed");

99 
	`m¬Ÿdb_dyncÞ_ä“
(&
dyncÞ
);

101 
keys3
[0].
¡r
= (*)"test";

102 
i
=0; i < 
cÞumn_couÁ
; i++)

103 
	`dŸg
("%s", 
my_keys
[
i
].
¡r
);

105 
	`ä“
(
v®s
);

106 
	`ä“
(
my_keys
);

107  
OK
;

108 
	}
}

110 
mdev_4994
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

112 
DYNAMIC_COLUMN
 
	gdyncÞ
;

113 
ušt
 
	gkey
= 1;

114 
DYNAMIC_COLUMN_VALUE
 
	gv®
;

115 
	grc
;

118 
	gv®
.
	gty³
ð
DYN_COL_NULL
;

120 
m¬Ÿdb_dyncÞ_š™
(&
dyncÞ
);

121 
	grc
ð
m¬Ÿdb_dyncÞ_ü—‹_mªy_num
(&
dyncÞ
, 1, &
key
, &
v®
, 0);

122 
FAIL_IF
(
rc
 < 0, "Unexpectedƒrror");

123 
m¬Ÿdb_dyncÞ_ä“
(&
dyncÞ
);

124  
	gOK
;

127 
	$ü—‹_dyncÞ_num
(
MYSQL
 *
mysql
)

129 
DYNAMIC_COLUMN
 
dyncÞ
;

130 
DYNAMIC_COLUMN_VALUE
 
v®s
[5];

131 
ušt
 
i
, 
cÞumn_couÁ
= 5;

132 
ušt
 
my_couÁ
;

133 
MYSQL_LEX_STRING
 *
my_keys
;

134 
DYNAMIC_COLUMN_VALUE
 *
my_v®s
;

135 
rc
;

136 cÚ¡ *
¡rv®
[]= {"Val1", "Val2", "Val3", "Val4", "Val5"};

138 
ušt
 
keys1
[5]= {1,2,3,4,5},

139 
keys2
[5]= {1,2,2,4,5};

140 
MYSQL_LEX_STRING
 
key1
= {(*)"1",1};

142 
i
=0; i < 
cÞumn_couÁ
; i++)

144 
v®s
[
i
].
ty³
ð
DYN_COL_STRING
;

145 
v®s
[
i
].
x
.
¡ršg
.
v®ue
.
¡r
ð(*)
¡rv®
[i];

146 
v®s
[
i
].
x
.
¡ršg
.
v®ue
.
Ëngth
ð
	`¡¾’
(
¡rv®
[i]);

147 
v®s
[
i
].
x
.
¡ršg
.
ch¬£t
ð(
MARIADB_CHARSET_INFO
 *)
mysql
->charset;

149 
	`FAIL_IF
(
	`m¬Ÿdb_dyncÞ_ü—‹_mªy_num
(&
dyncÞ
, 
cÞumn_couÁ
, 
keys1
, 
v®s
, 1) <0, "Error (keys1)");

151 
v®s
[0].
x
.
¡ršg
.
v®ue
.
¡r
ð(*)
¡rv®
[1];

152 
rc
ð
	`m¬Ÿdb_dyncÞ_upd©e_mªy_Çmed
(&
dyncÞ
,1, &
key1
, 
v®s
);

153 
	`dŸg
("upd©e: %d", 
rc
);

155 
rc
ð
	`m¬Ÿdb_dyncÞ_uÅack
(&
dyncÞ
, &
my_couÁ
, &
my_keys
, &
my_v®s
);

156 
	`dŸg
("uÅack: %d %d", 
rc
, 
my_couÁ
);

158 
	`ä“
(
my_keys
);

159 
	`ä“
(
my_v®s
);

161 
	`FAIL_IF
(
	`m¬Ÿdb_dyncÞ_cÞumn_couÁ
(&
dyncÞ
, &
cÞumn_couÁ
) < 0, "Error");

162 
	`FAIL_IF
(
cÞumn_couÁ
 != 5, "5 columnsƒxpected");

163 
	`m¬Ÿdb_dyncÞ_ä“
(&
dyncÞ
);

164 
	`FAIL_IF
(
	`m¬Ÿdb_dyncÞ_ü—‹_mªy_num
(&
dyncÞ
, 
cÞumn_couÁ
, 
keys2
, 
v®s
, 1) >=0, "Errorƒxpected (keys2)");

165 
	`m¬Ÿdb_dyncÞ_ä“
(&
dyncÞ
);

166  
OK
;

167 
	}
}

169 
	$mdev_x1
(
MYSQL
 *
mysql
)

171 
rc
;

172 
ušt
 
i
;

173 
ušt
 
num_keys
[5]= {1,2,3,4,5};

174 cÚ¡ *
¡rv®
[]= {"Val1", "Val2", "Val3", "Val4", "Val5"};

175 
DYNAMIC_COLUMN_VALUE
 
v®s
[5];

176 
DYNAMIC_COLUMN
 
dyn¡r
;

177 
MYSQL_LEX_STRING
 
my_key
= {(*)"1", 2};

178 
ušt
 
uÅack_cÞumns
;

179 
MYSQL_LEX_STRING
 *
uÅack_keys
;

180 
DYNAMIC_COLUMN_VALUE
 *
uÅack_v®s
;

182 
i
=0; i < 5; i++)

184 
v®s
[
i
].
ty³
ð
DYN_COL_STRING
;

185 
v®s
[
i
].
x
.
¡ršg
.
v®ue
.
¡r
ð(*)
¡rv®
[i];

186 
v®s
[
i
].
x
.
¡ršg
.
v®ue
.
Ëngth
ð
	`¡¾’
(
¡rv®
[i]);

187 
v®s
[
i
].
x
.
¡ršg
.
ch¬£t
ð(
MARIADB_CHARSET_INFO
 *)
mysql
->charset;

190 
	`m¬Ÿdb_dyncÞ_š™
(&
dyn¡r
);

193 
rc
ð
	`m¬Ÿdb_dyncÞ_ü—‹_mªy_num
(&
dyn¡r
, 5, 
num_keys
, 
v®s
, 1);

194 ià(
rc
 < 0)

196 
	`dŸg
("E¼Ü: %d", 
rc
);

197  
FAIL
;

201 
rc
ð
	`m¬Ÿdb_dyncÞ_uÅack
(&
dyn¡r
, &
uÅack_cÞumns
, &
uÅack_keys
, &
uÅack_v®s
);

202 ià(
rc
 < 0)

204 
	`dŸg
("E¼Ü: %d", 
rc
);

205  
FAIL
;

208 
i
=0; i < 
uÅack_cÞumns
; i++)

209 ià(
	`memcmp
(
uÅack_v®s
[
i
].
x
.
¡ršg
.
v®ue
.
¡r
, 
v®s
[i].x.¡ršg.v®ue.¡r, v®s[i].x.¡ršg.v®ue.
Ëngth
))

210 
	`dŸg
("E¼Ü1: key: %1 v®: % %s", 
uÅack_keys
[
i
].
¡r
, 
uÅack_v®s
[i].
x
.
¡ršg
.
v®ue
.¡r, 
v®s
[i].x.string.value.str);

212 
	`ä“
(
uÅack_keys
);

213 
	`ä“
(
uÅack_v®s
);

217 
rc
ð
	`m¬Ÿdb_dyncÞ_upd©e_mªy_Çmed
(&
dyn¡r
, 1, &
my_key
, 
v®s
);

218 ià(
rc
 < 0)

220 
	`dŸg
("E¼Ü: %d", 
rc
);

221  
FAIL
;

225 
rc
ð
	`m¬Ÿdb_dyncÞ_uÅack
(&
dyn¡r
, &
uÅack_cÞumns
, &
uÅack_keys
, &
uÅack_v®s
);

226 ià(
rc
 < 0)

228 
	`dŸg
("E¼Ü: %d", 
rc
);

229  
FAIL
;

231 
	`dŸg
("CÞumns: %d", 
uÅack_cÞumns
);

233 
i
=0; i < 
uÅack_cÞumns
; i++)

234 
	`dŸg
("Key: % L’: %lu", 
uÅack_keys
[
i
].
¡r
, ()uÅack_keys[i].
Ëngth
);

237 
	`ä“
(
uÅack_keys
);

238 
	`ä“
(
uÅack_v®s
);

240 
	`m¬Ÿdb_dyncÞ_ä“
(&
dyn¡r
);

241  
OK
;

242 
	}
}

244 
dyncÞ_cÞumn_couÁ
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

246 
DYNAMIC_COLUMN
 
	gdyncÞ
;

247 
ušt
 
	gcÞumn_couÁ
= 5;

248 
	grc
;

250 
m¬Ÿdb_dyncÞ_š™
(&
dyncÞ
);

251 
	grc
ð
m¬Ÿdb_dyncÞ_cÞumn_couÁ
(&
dyncÞ
, &
cÞumn_couÁ
);

252 
dŸg
("rc=%d", 
rc
);

253 
FAIL_IF
(
rc
 < 0, "unexpectedƒrror");

254 
FAIL_IF
(
cÞumn_couÁ
 > 0, "Expected column_count=0");

255  
	gOK
;

258 
dyncÞ_Ã¡ed
(
MYSQL
 *
mysql
 
__©Œibu‹__
((
unu£d
)))

260 
DYNAMIC_COLUMN
 
	gcÞ1
, 
	gcÞ2
;

261 
DYNAMIC_COLUMN_VALUE
 
	gv®ue
[2];

262 
MYSQL_LEX_STRING
 
	gcÞs
[2]= {{(*)"0",1},{(*)"1",1}};

263 
DYNAMIC_STRING
 
	gs
;

265 
m¬Ÿdb_dyncÞ_š™
(&
cÞ1
);

266 
m¬Ÿdb_dyncÞ_š™
(&
cÞ2
);

268 
mem£t
(&
v®ue
, 0, (
DYNAMIC_COLUMN_VALUE
));

270 
	gv®ue
[0].
	gty³
ð
DYN_COL_UINT
;

271 
	gv®ue
[0].
	gx
.
	gulÚg_v®ue
 = 17;

273 
m¬Ÿdb_dyncÞ_ü—‹_mªy_Çmed
(&
cÞ1
, 1, 
cÞs
, 
v®ue
, 0);

274 ià(
m¬Ÿdb_dyncÞ_check
(&
cÞ1
è!ð
ER_DYNCOL_OK
)

276 
dŸg
("Error while creating col1");

277  
	gFAIL
;

280 
	gv®ue
[1].
	gty³
ð
DYN_COL_DYNCOL
;

281 
	gv®ue
[1].
	gx
.
	g¡ršg
.v®ue.
	g¡r
ð
cÞ1
.
¡r
;

282 
	gv®ue
[1].
	gx
.
	g¡ršg
.v®ue.
	gËngth
ð
cÞ1
.
Ëngth
;

284 
m¬Ÿdb_dyncÞ_ü—‹_mªy_Çmed
(&
cÞ2
, 2, 
cÞs
, 
v®ue
, 0);

285 ià(
m¬Ÿdb_dyncÞ_check
(&
cÞ2
è!ð
ER_DYNCOL_OK
)

287 
dŸg
("Error while creating col1");

288  
	gFAIL
;

290 
m¬Ÿdb_dyncÞ_jsÚ
(&
cÞ2
, &
s
);

291 ià(
¡rcmp
(
s
.
¡r
, "{\"0\":17,\"1\":{\"0\":17}}") != 0)

293 
dŸg
("% !ð%s", 
s
.
¡r
, "{\"0\":17,\"1\":{\"0\":17}}");

294  
	gFAIL
;

296 
ma_dyn¡r_ä“
(&
s
);

297 
m¬Ÿdb_dyncÞ_ä“
(&
cÞ1
);

298 
m¬Ÿdb_dyncÞ_ä“
(&
cÞ2
);

299  
	gOK
;

302 
my_‹¡s_¡
 
	gmy_‹¡s
[] = {

303 {"mdev_x1", 
mdev_x1
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

304 {"mdev_4994", 
mdev_4994
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

305 {"ü—‹_dyncÞ_Çmed", 
ü—‹_dyncÞ_Çmed
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

306 {"ü—‹_dyncÞ_num", 
ü—‹_dyncÞ_num
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

307 {"dyncÞ_cÞumn_couÁ", 
dyncÞ_cÞumn_couÁ
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

308 {"dyncÞ_Ã¡ed", 
dyncÞ_Ã¡ed
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

309 {
NULL
, NULL, 0, 0, NULL, 0}

313 
	$maš
(
¬gc
, **
¬gv
)

315 ià(
¬gc
 > 1)

316 
	`g‘_ÝtiÚs
(
¬gc
, 
¬gv
);

318 
	`g‘_’vv¬s
();

320 
	`run_‹¡s
(
my_‹¡s
);

322 (
	`ex™_¡©us
());

323 
	}
}

	@unittest/libmariadb/errors.c

24 
	~"my_‹¡.h
"

28 
	$‹¡_þ›Á_w¬nšgs
(
MYSQL
 *
mysql
)

30 
rc
;

32 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE ifƒxistsest_non_exists");

33 
	`check_mysql_rc
(
rc
, 
mysql
);

34 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE ifƒxistsest_non_exists");

35 
	`check_mysql_rc
(
rc
, 
mysql
);

37 
	`FAIL_IF
(!
	`mysql_w¬nšg_couÁ
(
mysql
), "Warningƒxpected");

39  
OK
;

40 
	}
}

43 
	$‹¡_ps_þ›Á_w¬nšgs
(
MYSQL
 *
mysql
)

45 
rc
;

46 
MYSQL_STMT
 *
¡mt
;

47 cÚ¡ *
qu”y
= "DROP TABLE IF EXISTSest_non_exists";

49 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE ifƒxistsest_non_exists");

50 
	`check_mysql_rc
(
rc
, 
mysql
);

52 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

53 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

54 
	`FAIL_IF
(
rc
, 
	`mysql_¡mt_”rÜ
(
¡mt
));

56 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

57 
	`FAIL_IF
(
rc
, 
	`mysql_¡mt_”rÜ
(
¡mt
));

59 
	`FAIL_IF
(!
	`mysql_w¬nšg_couÁ
(
mysql
), "Warningƒxpected");

61 
	`mysql_¡mt_þo£
(
¡mt
);

63  
OK
;

64 
	}
}

66 
	$‹¡_£rv”_w¬nšgs
(
MYSQL
 *
mysql
)

68 
rc
;

69 
MYSQL_RES
 *
»suÉ
;

71 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE ifƒxistsest_non_exists");

72 
	`check_mysql_rc
(
rc
, 
mysql
);

73 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE ifƒxistsest_non_exists");

74 
	`check_mysql_rc
(
rc
, 
mysql
);

76 
rc
ð
	`mysql_qu”y
(
mysql
, "SHOW WARNINGS");

77 
	`check_mysql_rc
(
rc
, 
mysql
);

79 
»suÉ
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

80 
	`FAIL_IF
(!
»suÉ
, 
	`mysql_”rÜ
(
mysql
));

81 
	`FAIL_IF
(!
	`mysql_num_rows
(
»suÉ
), "Empty„esultset");

83 
	`mysql_ä“_»suÉ
(
»suÉ
);

85  
OK
;

86 
	}
}

91 
	$‹¡_þ›Á_”rÜs
(
MYSQL
 *
mysql
)

93 
rc
;

95 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE ifƒxistsest_non_exists");

96 
	`check_mysql_rc
(
rc
, 
mysql
);

98 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLEest_non_exists");

99 
	`FAIL_IF
(!
rc
, "Errorƒxpected");

101 
	`FAIL_IF
(!
	`mysql_”ºo
(
mysql
), "Errorƒxpected");

102 
	`FAIL_IF
(!
	`¡¾’
(
	`mysql_”rÜ
(
mysql
)), "Emptyƒrrormsg");

103 
	`FAIL_IF
(
	`¡rcmp
(
	`mysql_sql¡©e
(
mysql
), "00000") == 0, "Invalid SQLstate");

105  
OK
;

106 
	}
}

108 
	$‹¡_ps_þ›Á_”rÜs
(
MYSQL
 *
mysql
)

110 
rc
;

111 
MYSQL_STMT
 *
¡mt
;

112 cÚ¡ *
qu”y
= "DROP TABLEest_non_exists";

114 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE ifƒxistsest_non_exists");

115 
	`check_mysql_rc
(
rc
, 
mysql
);

117 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

118 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

119 
	`FAIL_IF
(
rc
, 
	`mysql_¡mt_”rÜ
(
¡mt
));

121 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

122 
	`FAIL_IF
(!
rc
, 
	`mysql_¡mt_”rÜ
(
¡mt
));

124 
	`FAIL_IF
(!
	`mysql_¡mt_”ºo
(
¡mt
), "Errorƒxpected");

125 
	`FAIL_IF
(!
	`¡¾’
(
	`mysql_¡mt_”rÜ
(
¡mt
)), "Emptyƒrrormsg");

126 
	`FAIL_IF
(
	`¡rcmp
(
	`mysql_¡mt_sql¡©e
(
¡mt
), "00000") == 0, "Invalid SQLstate");

128 
	`mysql_¡mt_þo£
(
¡mt
);

130  
OK
;

131 
	}
}

133 
	$‹¡_£rv”_”rÜs
(
MYSQL
 *
mysql
)

135 
rc
;

136 
MYSQL_RES
 *
»suÉ
;

138 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE ifƒxistsest_non_exists");

139 
	`check_mysql_rc
(
rc
, 
mysql
);

141 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLEest_non_exists");

142 
	`check_mysql_rc
(
rc
, 
mysql
);

144 
rc
ð
	`mysql_qu”y
(
mysql
, "SHOW ERRORS");

145 
	`check_mysql_rc
(
rc
, 
mysql
);

147 
»suÉ
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

148 
	`FAIL_IF
(!
»suÉ
, 
	`mysql_”rÜ
(
mysql
));

149 
	`FAIL_IF
(!
	`mysql_num_rows
(
»suÉ
), "Empty„esultset");

150 
	`mysql_ä“_»suÉ
(
»suÉ
);

152  
OK
;

153 
	}
}

157 
	$‹¡_bug16143
(
MYSQL
 *
mysql
)

159 
MYSQL_STMT
 *
¡mt
;

160 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

161 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

163 
	`FAIL_UNLESS
(
	`¡rcmp
(
	`mysql_¡mt_sql¡©e
(
¡mt
), "00000") == 0, "Expected SQLstate 000000");

164 
	`mysql_¡mt_þo£
(
¡mt
);

165  
OK
;

166 
	}
}

170 
	$‹¡_cu‹d_rows
(
MYSQL
 *
mysql
)

172 
rc
, 
couÁ
;

173 
MYSQL_RES
 *
»suÉ
;

175 ià(!
is_m¬Ÿdb
)

176  
SKIP
;

178 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE ifƒxists1");

179 
	`check_mysql_rc
(
rc
, 
mysql
);

180 
	`mysql_qu”y
(
mysql
, "DROP TABLE ifƒxists2");

181 
	`check_mysql_rc
(
rc
, 
mysql
);

182 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE1(c1inyint)");

183 
	`check_mysql_rc
(
rc
, 
mysql
);

184 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE2(c1 int‚ot‚ull)");

185 
	`check_mysql_rc
(
rc
, 
mysql
);

186 
rc
ð
	`mysql_qu”y
(
mysql
, "FLUSH TABLES");

187 
	`check_mysql_rc
(
rc
, 
mysql
);

188 
rc
ð
	`mysql_qu”y
(
mysql
, "START TRANSACTION");

189 
	`check_mysql_rc
(
rc
, 
mysql
);

191 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTO1 values(10), (NULL), (NULL)");

192 
	`check_mysql_rc
(
rc
, 
mysql
);

194 
couÁ
ð
	`mysql_w¬nšg_couÁ
(
mysql
);

195 
	`FAIL_UNLESS
(
couÁ
 == 0, "warnings != 0");

197 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTO2 SELECT * FROM1");

198 
	`check_mysql_rc
(
rc
, 
mysql
);

200 
couÁ
ð
	`mysql_w¬nšg_couÁ
(
mysql
);

201 
	`FAIL_UNLESS
(
couÁ
 == 2, "warnings != 2");

203 
rc
ð
	`mysql_qu”y
(
mysql
, "SHOW WARNINGS");

204 
	`check_mysql_rc
(
rc
, 
mysql
);

206 
»suÉ
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

207 
	`FAIL_IF
(!
»suÉ
, "Invalid„esult set");

209 
rc
= 0;

210 
	`mysql_ãtch_row
(
»suÉ
))

211 
rc
++;

212 
	`FAIL_UNLESS
(
rc
 == 2, "rowcount != 2");

213 
	`mysql_ä“_»suÉ
(
»suÉ
);

215 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTO1 VALUES('junk'), (876789)");

216 
	`check_mysql_rc
(
rc
, 
mysql
);

218 
couÁ
ð
	`mysql_w¬nšg_couÁ
(
mysql
);

219 
	`FAIL_UNLESS
(
couÁ
 == 2, "warnings != 2");

221 
rc
ð
	`mysql_qu”y
(
mysql
, "SHOW WARNINGS");

222 
	`check_mysql_rc
(
rc
, 
mysql
);

224 
»suÉ
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

225 
	`FAIL_IF
(!
»suÉ
, "Invalid„esult set");

227 
rc
= 0;

228 
	`mysql_ãtch_row
(
»suÉ
))

229 
rc
++;

230 
	`FAIL_UNLESS
(
rc
 == 2, "rowcount != 2");

231 
	`mysql_ä“_»suÉ
(
»suÉ
);

233 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE1,2");

234 
	`check_mysql_rc
(
rc
, 
mysql
);

235  
OK
;

236 
	}
}

238 
	$‹¡_·r£_”rÜ_ªd_bad_Ëngth
(
MYSQL
 *
mysql
)

240 
MYSQL_STMT
 *
¡mt
;

241 
rc
;

242 
¡mt_¡r
[128];

246 
rc
ð
	`mysql_qu”y
(
mysql
, "SHOW DATABAAAA");

247 
	`FAIL_UNLESS
(
rc
, "Errorƒxpected");

248 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL_BIN
("SHOW DATABASES\0AAA"));

249 
	`FAIL_UNLESS
(
rc
, "Errorƒxpected");

251 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

252 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

253 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("SHOW DATABAAAA"));

254 
	`FAIL_IF
(!
rc
, "Errorƒxpected");

255 
	`mysql_¡mt_þo£
(
¡mt
);

256 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

257 
	`FAIL_UNLESS
(
¡mt
, "");

258 
	`mem£t
(
¡mt_¡r
, 0, 100);

259 
	`¡rýy
(
¡mt_¡r
, "SHOW DATABASES");

260 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
¡mt_¡r
, 99);

261 
	`FAIL_IF
(!
rc
, "Errorƒxpected");

262 
	`mysql_¡mt_þo£
(
¡mt
);

263  
OK
;

264 
	}
}

267 
my_‹¡s_¡
 
	gmy_‹¡s
[] = {

268 {"‹¡_þ›Á_w¬nšgs", 
‹¡_þ›Á_w¬nšgs
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

269 {"‹¡_ps_þ›Á_w¬nšgs", 
‹¡_ps_þ›Á_w¬nšgs
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

270 {"‹¡_£rv”_w¬nšgs", 
‹¡_£rv”_w¬nšgs
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

271 {"‹¡_þ›Á_”rÜs", 
‹¡_þ›Á_”rÜs
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

272 {"‹¡_ps_þ›Á_”rÜs", 
‹¡_ps_þ›Á_”rÜs
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

273 {"‹¡_£rv”_”rÜs", 
‹¡_£rv”_”rÜs
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , "Open bug: #42364"},

274 {"‹¡_bug16143", 
‹¡_bug16143
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

275 {"‹¡_cu‹d_rows", 
‹¡_cu‹d_rows
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

276 {"‹¡_·r£_”rÜ_ªd_bad_Ëngth", 
‹¡_·r£_”rÜ_ªd_bad_Ëngth
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

277 {
NULL
, NULL, 0, 0, NULL, NULL}

280 
	$maš
(
¬gc
, **
¬gv
)

282 ià(
¬gc
 > 1)

283 
	`g‘_ÝtiÚs
(
¬gc
, 
¬gv
);

285 
	`g‘_’vv¬s
();

287 
	`run_‹¡s
(
my_‹¡s
);

289 (
	`ex™_¡©us
());

290 
	}
}

	@unittest/libmariadb/features-10_2.c

4 
	~"my_‹¡.h
"

6 
	$execu‹_dœeù
(
MYSQL
 *
mysql
)

8 
rc
= 0;

9 
i
= 0;

10 
MYSQL_STMT
 *
¡mt
;

11 
MYSQL_BIND
 
bšd
;

12 
·¿m_couÁ
= 1;

13 
MYSQL_RES
 *
»s
ð
NULL
;

15 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

17 
rc
ð
	`m¬Ÿdb_¡mt_execu‹_dœeù
(
¡mt
, "DROP TABLE IF EXISTS1", -1);

18 
	`check_¡mt_rc
(
rc
, 
¡mt
);

20 
rc
ð
	`m¬Ÿdb_¡mt_execu‹_dœeù
(
¡mt
, "SELECT 1", -1);

21 
	`check_¡mt_rc
(
rc
, 
¡mt
);

23 !
	`mysql_¡mt_ãtch
(
¡mt
));

25 
rc
ð
	`m¬Ÿdb_¡mt_execu‹_dœeù
(
¡mt
, "SELECT 1", -1);

26 
	`check_¡mt_rc
(
rc
, 
¡mt
);

28 
rc
ð
	`m¬Ÿdb_¡mt_execu‹_dœeù
(
¡mt
, "CREATE TABLE1 (a int)", -1);

29 
	`check_¡mt_rc
(
rc
, 
¡mt
);

31 
	`mem£t
(&
bšd
, 0, (
MYSQL_BIND
));

33 
bšd
.
bufãr
ð&
i
;

34 
bšd
.
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

35 
bšd
.
bufãr_Ëngth
= ();

37 
	`mysql_¡mt_þo£
(
¡mt
);

38 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

39 
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_PREBIND_PARAMS
, &
·¿m_couÁ
);

41 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, &
bšd
);

42 
	`check_¡mt_rc
(
rc
, 
¡mt
);

43 
rc
ð
	`m¬Ÿdb_¡mt_execu‹_dœeù
(
¡mt
, "INSERT INTO1 VALUES (?)", -1);

44 
	`check_¡mt_rc
(
rc
, 
¡mt
);

46 
i
=1; i < 1000; i++)

48 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

49 
	`check_¡mt_rc
(
rc
, 
¡mt
);

51 
rc
ð
	`mysql_¡mt_þo£
(
¡mt
);

52 
	`check_mysql_rc
(
rc
, 
mysql
);

54 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT * FROM1");

55 
	`check_mysql_rc
(
rc
, 
mysql
);

57 
»s
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

58 
	`FAIL_IF
(
	`mysql_num_rows
(
»s
) != 1000, "Expected 1000„ows");

60 
	`mysql_ä“_»suÉ
(
»s
);

62 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE1");

63 
	`check_mysql_rc
(
rc
, 
mysql
);

65  
OK
;

66 
	}
}

68 
	$execu‹_dœeù_exam¶e
(
MYSQL
 *
mysql
)

70 
MYSQL_STMT
 *
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

71 
MYSQL_BIND
 
bšd
[2];

72 
štv®
= 1;

73 
·¿m_couÁ
= 2;

74 
rc
;

75 cÚ¡ *
¡rv®
= "execute_direct_example1";

78 
rc
ð
	`m¬Ÿdb_¡mt_execu‹_dœeù
(
¡mt
, "DROP TABLE IF EXISTSƒxecute_direct", -1);

79 
	`check_¡mt_rc
(
rc
, 
¡mt
);

80 
rc
ð
	`m¬Ÿdb_¡mt_execu‹_dœeù
(
¡mt
, "CREATE TABLEƒxecute_direct (a int, b varchar(20))", -1);

81 
rc
ð
	`mysql_¡mt_þo£
(
¡mt
);

82 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

83 
	`check_¡mt_rc
(
rc
, 
¡mt
);

84 
	`mem£t
(
bšd
, 0, (
MYSQL_BIND
) * 2);

85 
bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_SHORT
;

86 
bšd
[0].
bufãr
ð&
štv®
;

87 
bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

88 
bšd
[1].
bufãr
ð(*)
¡rv®
;

89 
bšd
[1].
bufãr_Ëngth
ð()
	`¡¾’
(
¡rv®
);

92 
rc
ð
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_PREBIND_PARAMS
, &
·¿m_couÁ
);

93 
	`check_¡mt_rc
(
rc
, 
¡mt
);

96 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
bšd
);

97 
	`check_¡mt_rc
(
rc
, 
¡mt
);

99 
rc
ð
	`m¬Ÿdb_¡mt_execu‹_dœeù
(
¡mt
, "INSERT INTOƒxecute_direct VALUES (?,?)", -1);

100 
	`check_¡mt_rc
(
rc
, 
¡mt
);

102 
	`mysql_¡mt_þo£
(
¡mt
);

104 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLEƒxecute_direct");

105 
	`check_mysql_rc
(
rc
, 
mysql
);

106  
OK
;

107 
	}
}

109 
	$cÚc_213
(
MYSQL
 *
mysql
)

111 
MYSQL_BIND
 
bšd
;

112 
·¿m_couÁ
= 1;

113 
id
= 1234;

114 
MYSQL_STMT
 *
¡mt
;

116 
¡mt
 = 
	`mysql_¡mt_š™
(
mysql
);

118 
	`mem£t
(&
bšd
, '\0', (bind));

120 
bšd
.
bufãr_ty³
 = 
MYSQL_TYPE_LONG
;

121 
bšd
.
bufãr
 = (*)&
id
;

122 
bšd
.
bufãr_Ëngth
 = ();

127 
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_PREBIND_PARAMS
, &
·¿m_couÁ
);

128 
	`check_¡mt_rc
(
	`mysql_¡mt_bšd_·¿m
(
¡mt
, &
bšd
), stmt);

129 
	`check_¡mt_rc
(
	`m¬Ÿdb_¡mt_execu‹_dœeù
(
¡mt
, "SELECT ?", -1), stmt);

130 
	`check_¡mt_rc
(
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
), stmt);

131 
	`check_¡mt_rc
(
	`mysql_¡mt_ä“_»suÉ
(
¡mt
), stmt);

133 
	`mysql_¡mt_þo£
(
¡mt
);

135  
OK
;

136 
	}
}

138 
	$cÚc_212
(
MYSQL
 *
mysql
)

140 
MYSQL_STMT
 *
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

141 
rc
;

143 
rc
ð
	`m¬Ÿdb_¡mt_execu‹_dœeù
(
¡mt
, "SELECT 1, 2", -1);

144 
	`check_¡mt_rc
(
rc
, 
¡mt
);

145 
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

146 
	`mysql_¡mt_ä“_»suÉ
(
¡mt
);

148 
rc
ð
	`m¬Ÿdb_¡mt_execu‹_dœeù
(
¡mt
, "SELECT 1, 2", -1);

149 
	`check_¡mt_rc
(
rc
, 
¡mt
);

150 
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

151 
	`mysql_¡mt_ä“_»suÉ
(
¡mt
);

153 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

154 
	`check_mysql_rc
(
rc
,
mysql
);

157 
rc
ð
	`mysql_¡mt_þo£
(
¡mt
);

159  
OK
;

160 
	}
}

162 
	$cÚc_218
(
MYSQL
 *
mysql
)

164 
MYSQL_STMT
 *
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

165 
MYSQL_BIND
 
bšd
[2];

166 
id
=1;

167 
my_boÞ
 
is_nuÎ
ð0, 
”rÜ
= 0;

168 
·¿m_couÁ
= 1;

170 
	`mem£t
(
bšd
, 0, 2 * (
MYSQL_BIND
));

171 
bšd
[0].
bufãr_ty³
 = 
MYSQL_TYPE_LONG
;

172 
bšd
[0].
bufãr
 = (*)&
id
;

173 
bšd
[0].
bufãr_Ëngth
 = 4;

174 
bšd
[0].
is_nuÎ
 = &is_null;

175 
bšd
[0].
”rÜ
 = &error;

177 
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_PREBIND_PARAMS
, &
·¿m_couÁ
);

178 
	`check_¡mt_rc
(
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
bšd
), stmt);

179 
	`check_¡mt_rc
(
	`m¬Ÿdb_¡mt_execu‹_dœeù
(
¡mt
, "SELECT ?", -1), stmt);

180 
	`check_¡mt_rc
(
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
), stmt);

182 
	`check_¡mt_rc
(
	`mysql_¡mt_ä“_»suÉ
(
¡mt
), stmt);

184 
·¿m_couÁ
= 1;

185 
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_PREBIND_PARAMS
, &
·¿m_couÁ
);

186 
	`check_¡mt_rc
(
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
bšd
), stmt);

187 
	`check_¡mt_rc
(
	`m¬Ÿdb_¡mt_execu‹_dœeù
(
¡mt
, "SELECT ?", -1), stmt);

188 
	`mysql_¡mt_þo£
(
¡mt
);

190  
OK
;

191 
	}
}

193 
	$‹¡_cursÜ
(
MYSQL
 *
mysql
)

195 
rc
;

196 
MYSQL_STMT
 *
¡mt
;

197 
´eãtch_rows
= 1;

198 
cursÜ_ty³
ð
CURSOR_TYPE_READ_ONLY
;

200 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

201 
rc
ð
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_CURSOR_TYPE
, &
cursÜ_ty³
);

202 
	`check_¡mt_rc
(
rc
, 
¡mt
);

203 
rc
ð
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_PREFETCH_ROWS
, &
´eãtch_rows
);

204 
	`check_¡mt_rc
(
rc
, 
¡mt
);

205 
rc
ð
	`m¬Ÿdb_¡mt_execu‹_dœeù
(
¡mt
, "SELECT 1 FROM DUAL UNION SELECT 2 FROM DUAL", -1);

206 
	`check_¡mt_rc
(
rc
, 
¡mt
);

207 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

208 
	`check_¡mt_rc
(
rc
, 
¡mt
);

209 
rc
ð
	`m¬Ÿdb_¡mt_execu‹_dœeù
(
¡mt
, "SELECT 1 FROM DUAL UNION SELECT 2 FROM DUAL", -1);

210 
	`check_¡mt_rc
(
rc
, 
¡mt
);

211 
	`mysql_¡mt_þo£
(
¡mt
);

212  
OK
;

213 
	}
}

216 
my_‹¡s_¡
 
	gmy_‹¡s
[] = {

217 {"‹¡_cursÜ", 
‹¡_cursÜ
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

218 {"cÚc_218", 
cÚc_218
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

219 {"cÚc_212", 
cÚc_212
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

220 {"cÚc_213", 
cÚc_213
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

221 {"execu‹_dœeù", 
execu‹_dœeù
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

222 {"execu‹_dœeù_exam¶e", 
execu‹_dœeù_exam¶e
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

223 {
NULL
, NULL, 0, 0, NULL, NULL}

227 
	$maš
(
¬gc
, **
¬gv
)

230 
	`mysql_lib¿ry_š™
(0,0,
NULL
);

232 ià(
¬gc
 > 1)

233 
	`g‘_ÝtiÚs
(
¬gc
, 
¬gv
);

235 
	`g‘_’vv¬s
();

237 
	`run_‹¡s
(
my_‹¡s
);

239 
	`mysql_£rv”_’d
();

240 (
	`ex™_¡©us
());

241 
	}
}

	@unittest/libmariadb/fetch.c

24 
	~"my_‹¡.h
"

28 
	$bšd_ãtch
(
MYSQL
 *
mysql
, 
row_couÁ
)

30 
MYSQL_STMT
 *
¡mt
;

31 
rc
, 
i
, 
couÁ
ð
row_couÁ
;

32 
št32
 
d©a
[10];

33 
št8
 
i8_d©a
;

34 
št16
 
i16_d©a
;

35 
i32_d©a
;

36 
lÚglÚg
 
i64_d©a
;

37 
f_d©a
;

38 
d_d©a
;

39 
s_d©a
[10];

40 
ulÚg
 
Ëngth
[10];

41 
MYSQL_BIND
 
my_bšd
[7];

42 
my_boÞ
 
is_nuÎ
[7];

43 
qu”y
[
MAX_TEST_QUERY_LENGTH
];

45 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

46 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

48 
	`¡rýy
(
qu”y
, "INSERT INTOest_bind_fetch VALUES (?, ?, ?, ?, ?, ?, ?)");

49 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

50 
	`check_¡mt_rc
(
rc
,
¡mt
);

52 
	`FAIL_UNLESS
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
) == 7, "ParamCount != 7");

54 
	`mem£t
(
my_bšd
, '\0', (my_bind));

56 
i
ð0; i < (è
	`¬¿y_–em’ts
(
my_bšd
); i++)

58 
my_bšd
[
i
].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

59 
my_bšd
[
i
].
bufãr
ð(*è&
d©a
[i];

61 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

62 
	`check_¡mt_rc
(
rc
,
¡mt
);

64 
couÁ
--)

66 
rc
ð10+
couÁ
;

67 
i
ð0; i < (è
	`¬¿y_–em’ts
(
my_bšd
); i++)

69 
d©a
[
i
]ð
rc
+i;

70 
rc
+= 12;

72 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

73 
	`check_¡mt_rc
(
rc
,
¡mt
);

76 
rc
ð
	`mysql_comm™
(
mysql
);

77 
	`check_¡mt_rc
(
rc
,
¡mt
);

79 
	`mysql_¡mt_þo£
(
¡mt
);

81 
rc
ð
	`my_¡mt_»suÉ
(
mysql
, "SELECT * FROMest_bind_fetch");

82 
	`FAIL_UNLESS
(
row_couÁ
 =ð
rc
, "Wrong‚umber of„ows");

84 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

85 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

87 
	`¡rýy
(
qu”y
, "SELECT * FROMest_bind_fetch");

88 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

89 
	`check_¡mt_rc
(
rc
,
¡mt
);

91 
i
ð0; i < (è
	`¬¿y_–em’ts
(
my_bšd
); i++)

93 
my_bšd
[
i
].
bufãr
ð(*è&
d©a
[i];

94 
my_bšd
[
i
].
Ëngth
= &length[i];

95 
my_bšd
[
i
].
is_nuÎ
= &is_null[i];

98 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_TINY
;

99 
my_bšd
[0].
bufãr
ð(*)&
i8_d©a
;

101 
my_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_SHORT
;

102 
my_bšd
[1].
bufãr
ð(*)&
i16_d©a
;

104 
my_bšd
[2].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

105 
my_bšd
[2].
bufãr
ð(*)&
i32_d©a
;

107 
my_bšd
[3].
bufãr_ty³
ð
MYSQL_TYPE_LONGLONG
;

108 
my_bšd
[3].
bufãr
ð(*)&
i64_d©a
;

110 
my_bšd
[4].
bufãr_ty³
ð
MYSQL_TYPE_FLOAT
;

111 
my_bšd
[4].
bufãr
ð(*)&
f_d©a
;

113 
my_bšd
[5].
bufãr_ty³
ð
MYSQL_TYPE_DOUBLE
;

114 
my_bšd
[5].
bufãr
ð(*)&
d_d©a
;

116 
my_bšd
[6].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

117 
my_bšd
[6].
bufãr
ð(*)&
s_d©a
;

118 
my_bšd
[6].
bufãr_Ëngth
ð(
s_d©a
);

120 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

121 
	`check_¡mt_rc
(
rc
,
¡mt
);

123 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

124 
	`check_¡mt_rc
(
rc
,
¡mt
);

126 
rc
ð
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

127 
	`check_¡mt_rc
(
rc
,
¡mt
);

129 
row_couÁ
--)

131 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

132 
	`check_¡mt_rc
(
rc
,
¡mt
);

134 
rc
ð10+
row_couÁ
;

137 
	`FAIL_UNLESS
((è
i8_d©a
 =ð
rc
, "Invalid value for i8_data");

138 
	`FAIL_UNLESS
(
Ëngth
[0] == 1, "Invalid†ength");

139 
rc
+= 13;

142 
	`FAIL_UNLESS
((è
i16_d©a
 =ð
rc
, "Invalid value for i16_data");

143 
	`FAIL_UNLESS
(
Ëngth
[1] == 2, "Invalid†ength");

144 
rc
+= 13;

147 
	`FAIL_UNLESS
((è
i32_d©a
 =ð
rc
, "Invalid value for i32_data");

148 
	`FAIL_UNLESS
(
Ëngth
[2] == 4, "Invalid†ength");

149 
rc
+= 13;

152 
	`FAIL_UNLESS
((è
i64_d©a
 =ð
rc
, "Invalid value for i64_data");

153 
	`FAIL_UNLESS
(
Ëngth
[3] == 8, "Invalid†ength");

154 
rc
+= 13;

157 
	`FAIL_UNLESS
(()
f_d©a
 =ð
rc
, "Invalid value for f_data");

158 
	`FAIL_UNLESS
(
Ëngth
[4] == 4, "Invalid†ength");

159 
rc
+= 13;

162 
	`FAIL_UNLESS
(()
d_d©a
 =ð
rc
, "Invalid value for d_data");

163 
	`FAIL_UNLESS
(
Ëngth
[5] == 8, "Invalid†ength");

164 
rc
+= 13;

168 
buff
[20];

169 
Ën
ð
	`¥rštf
(
buff
, "%d", 
rc
);

170 
	`FAIL_UNLESS
(
	`¡rcmp
(
s_d©a
, 
buff
) == 0, "Invalid value for s_data");

171 
	`FAIL_UNLESS
(
Ëngth
[6] =ð(
ulÚg
è
Ën
, "Invalid†ength");

174 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

175 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "Expected MYSQL_NO_DATA");

177 
	`mysql_¡mt_þo£
(
¡mt
);

178  
OK
;

179 
	}
}

182 
	$‹¡_ãtch_£ek
(
MYSQL
 *
mysql
)

184 
MYSQL_STMT
 *
¡mt
;

185 
MYSQL_BIND
 
my_bšd
[3];

186 
MYSQL_ROW_OFFSET
 
row
;

187 
rc
;

188 
št32
 
c1
;

189 
c2
[11], 
c3
[20];

190 cÚ¡ *
qu”y
 = "SELECT * FROM1";

192 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxists1");

193 
	`check_mysql_rc
(
rc
, 
mysql
);

194 
rc
ð
	`mysql_qu”y
(
mysql
, "createable1(c1 int…rimary key‡uto_increment, c2 char(10), c3imestamp)");

195 
	`check_mysql_rc
(
rc
, 
mysql
);

196 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into1(c2) values('venu'), ('mysql'), ('open'), ('source')");

197 
	`check_mysql_rc
(
rc
, 
mysql
);

199 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

200 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

202 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

203 
	`check_¡mt_rc
(
rc
,
¡mt
);

205 
	`mem£t
(
my_bšd
, '\0', (my_bind));

206 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

207 
my_bšd
[0].
bufãr
ð(*)&
c1
;

209 
my_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

210 
my_bšd
[1].
bufãr
ð(*)
c2
;

211 
my_bšd
[1].
bufãr_Ëngth
ð(
c2
);

213 
my_bšd
[2]= my_bind[1];

214 
my_bšd
[2].
bufãr
ð(*)
c3
;

215 
my_bšd
[2].
bufãr_Ëngth
ð(
c3
);

217 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

218 
	`check_¡mt_rc
(
rc
,
¡mt
);

220 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

221 
	`check_¡mt_rc
(
rc
,
¡mt
);

223 
rc
ð
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

224 
	`check_¡mt_rc
(
rc
,
¡mt
);

227 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

228 
	`check_¡mt_rc
(
rc
,
¡mt
);

230 
row
ð
	`mysql_¡mt_row_‹Î
(
¡mt
);

232 
row
ð
	`mysql_¡mt_row_£ek
(
¡mt
,„ow);

234 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

235 
	`check_¡mt_rc
(
rc
,
¡mt
);

237 
row
ð
	`mysql_¡mt_row_£ek
(
¡mt
,„ow);

239 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

240 
	`check_¡mt_rc
(
rc
,
¡mt
);

242 
	`mysql_¡mt_d©a_£ek
(
¡mt
, 0);

244 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

245 
	`check_¡mt_rc
(
rc
,
¡mt
);

247 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

248 
	`check_¡mt_rc
(
rc
,
¡mt
);

250 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

251 
	`check_¡mt_rc
(
rc
,
¡mt
);

253 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

254 
	`check_¡mt_rc
(
rc
,
¡mt
);

256 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

257 
	`FAIL_IF
(
rc
 !ð
MYSQL_NO_DATA
, "Expected MYSQL_NO_DATA");

259 
	`mysql_¡mt_þo£
(
¡mt
);

260 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable1");

261 
	`check_mysql_rc
(
rc
, 
mysql
);

263  
OK
;

264 
	}
}

268 
	$‹¡_ãtch_off£t
(
MYSQL
 *
mysql
)

270 
MYSQL_STMT
 *
¡mt
;

271 
MYSQL_BIND
 
my_bšd
[2];

272 
d©a
[11], 
chunk
[5];

273 
ulÚg
 
Ëngth
[2];

274 
rc
;

275 
my_boÞ
 
is_nuÎ
[2];

276 cÚ¡ *
qu”y
 = "SELECT * FROM1";

279 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxists1");

280 
	`check_mysql_rc
(
rc
, 
mysql
);

281 
rc
ð
	`mysql_qu”y
(
mysql
, "createable1(a char(10), b mediumblob)");

282 
	`check_mysql_rc
(
rc
, 
mysql
);

283 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into1 values('abcdefghij', 'klmnopqrstzy'), (null,‚ull)");

284 
	`check_mysql_rc
(
rc
, 
mysql
);

286 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

287 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

289 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

290 
	`check_¡mt_rc
(
rc
,
¡mt
);

292 
	`mem£t
(
my_bšd
, '\0', (my_bind));

293 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

294 
my_bšd
[0].
bufãr
ð(*)
d©a
;

295 
my_bšd
[0].
bufãr_Ëngth
= 11;

296 
my_bšd
[0].
is_nuÎ
= &is_null[0];

297 
my_bšd
[0].
Ëngth
= &length[0];

299 
my_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_MEDIUM_BLOB
;

300 
my_bšd
[1].
bufãr
ð
NULL
;

301 
my_bšd
[1].
bufãr_Ëngth
= 0;

302 
my_bšd
[1].
is_nuÎ
= &is_null[1];

303 
my_bšd
[1].
Ëngth
= &length[1];

305 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

306 
	`check_¡mt_rc
(
rc
,
¡mt
);

308 
rc
ð
	`mysql_¡mt_ãtch_cÞumn
(
¡mt
, 
my_bšd
, 0, 0);

309 
	`FAIL_IF
(!
rc
, "Errorƒxpected");

311 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

312 
	`check_¡mt_rc
(
rc
,
¡mt
);

314 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

315 
	`check_¡mt_rc
(
rc
,
¡mt
);

317 
rc
ð
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

318 
	`check_¡mt_rc
(
rc
,
¡mt
);

319 
	`dŸg
("ŒunÿtiÚ: %d", 
mysql
->
ÝtiÚs
.
»pÜt_d©a_ŒunÿtiÚ
);

320 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

321 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_DATA_TRUNCATED
, "rc != MYSQL_DATA_TRUNCATED");

323 
d©a
[0]= '\0';

324 
rc
ð
	`mysql_¡mt_ãtch_cÞumn
(
¡mt
, &
my_bšd
[0], 0, 0);

325 
	`check_¡mt_rc
(
rc
,
¡mt
);

328 
	`FAIL_IF
(!(
	`¡ºcmp
(
d©a
, "abcdefghij", 11è=ð0 && 
Ëngth
[0] == 10), "Wrong value");

329 
	`FAIL_IF
(
my_bšd
[0].
”rÜ_v®ue
, "Noruncation, butƒrror is set");

331 
rc
ð
	`mysql_¡mt_ãtch_cÞumn
(
¡mt
, &
my_bšd
[0], 0, 5);

332 
	`check_¡mt_rc
(
rc
,
¡mt
);

333 
	`FAIL_IF
(!(
	`¡ºcmp
(
d©a
, "fghij", 6è=ð0 && 
Ëngth
[0] == 10), "Wrong value");

334 
	`FAIL_IF
(
my_bšd
[0].
”rÜ_v®ue
, "Noruncation, butƒrror is set");

336 
rc
ð
	`mysql_¡mt_ãtch_cÞumn
(
¡mt
, &
my_bšd
[0], 0, 9);

337 
	`check_¡mt_rc
(
rc
,
¡mt
);

338 
	`FAIL_IF
(!(
	`¡ºcmp
(
d©a
, "j", 2è=ð0 && 
Ëngth
[0] == 10), "Wrong value");

339 
	`FAIL_IF
(
my_bšd
[0].
”rÜ_v®ue
, "Noruncation, butƒrror is set");

342 
my_bšd
[1].
bufãr
ð
chunk
;

343 
my_bšd
[1].
bufãr_Ëngth
ð(
chunk
);

345 
rc
ð
	`mysql_¡mt_ãtch_cÞumn
(
¡mt
, &
my_bšd
[1], 1, 0);

346 
	`check_¡mt_rc
(
rc
,
¡mt
);

348 
	`FAIL_IF
(!(
	`¡ºcmp
(
chunk
, "klmno", 5è=ð0 && 
Ëngth
[1] == 12), "Wrong value");

349 
	`FAIL_IF
(
my_bšd
[1].
”rÜ_v®ue
 == '\0', "Truncation, butƒrror is‚ot set");

351 
rc
ð
	`mysql_¡mt_ãtch_cÞumn
(
¡mt
, &
my_bšd
[1], 1, 5);

352 
	`check_¡mt_rc
(
rc
,
¡mt
);

353 
	`FAIL_IF
(!(
	`¡ºcmp
(
chunk
, "pqr¡", 5è=ð0 && 
Ëngth
[1] == 12), "Wrong value");

354 
	`FAIL_IF
(
my_bšd
[1].
”rÜ_v®ue
 == '\0', "Truncation, butƒrror is‚ot set");

356 
rc
ð
	`mysql_¡mt_ãtch_cÞumn
(
¡mt
, &
my_bšd
[1], 1, 10);

357 
	`check_¡mt_rc
(
rc
,
¡mt
);

358 
	`FAIL_IF
(!(
	`¡ºcmp
(
chunk
, "zy", 2è=ð0 && 
Ëngth
[1] == 12), "Wrong value");

359 
	`FAIL_IF
(
my_bšd
[1].
”rÜ_v®ue
, "Noruncation, butƒrror is set");

361 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

362 
	`check_¡mt_rc
(
rc
,
¡mt
);

364 
	`mem£t
(
is_nuÎ
, 0, (is_null));

366 
rc
ð
	`mysql_¡mt_ãtch_cÞumn
(
¡mt
, &
my_bšd
[0], 0, 0);

367 
	`check_¡mt_rc
(
rc
,
¡mt
);

369 
	`FAIL_IF
(
is_nuÎ
[0] != 1, "Null flag‚ot set");

371 
rc
ð
	`mysql_¡mt_ãtch_cÞumn
(
¡mt
, &
my_bšd
[1], 1, 0);

372 
	`check_¡mt_rc
(
rc
,
¡mt
);

374 
	`FAIL_IF
(
is_nuÎ
[1] != 1, "Null flag‚ot set");

376 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

377 
	`FAIL_IF
(
rc
 !ð
MYSQL_NO_DATA
, "Expected MYSQL_NO_DATA");

379 
rc
ð
	`mysql_¡mt_ãtch_cÞumn
(
¡mt
, 
my_bšd
, 1, 0);

380 
	`FAIL_IF
(!
rc
, "Errorƒxpected");

382 
	`mysql_¡mt_þo£
(
¡mt
);

384 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable1");

385 
	`check_mysql_rc
(
rc
, 
mysql
);

387  
OK
;

388 
	}
}

392 
	$‹¡_ãtch_cÞumn
(
MYSQL
 *
mysql
)

394 
MYSQL_STMT
 *
¡mt
;

395 
MYSQL_BIND
 
my_bšd
[2];

396 
c2
[20], 
bc2
[20];

397 
ulÚg
 
l1
, 
l2
, 
bl1
, 
bl2
;

398 
rc
, 
c1
, 
bc1
;

399 cÚ¡ *
qu”y
= "SELECT * FROM1 ORDER BY c2 DESC";

401 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxists1");

402 
	`check_mysql_rc
(
rc
, 
mysql
);

403 
rc
ð
	`mysql_qu”y
(
mysql
, "createable1(c1 int…rimary key‡uto_increment, c2 char(10))");

404 
	`check_mysql_rc
(
rc
, 
mysql
);

405 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into1(c2) values('venu'), ('mysql')");

406 
	`check_mysql_rc
(
rc
, 
mysql
);

408 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

409 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

411 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

412 
	`check_¡mt_rc
(
rc
,
¡mt
);

414 
	`mem£t
(
my_bšd
, '\0', (my_bind));

415 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

416 
my_bšd
[0].
bufãr
ð(*)&
bc1
;

417 
my_bšd
[0].
bufãr_Ëngth
= 0;

418 
my_bšd
[0].
is_nuÎ
= 0;

419 
my_bšd
[0].
Ëngth
ð&
bl1
;

420 
my_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

421 
my_bšd
[1].
bufãr
ð(*)
bc2
;

422 
my_bšd
[1].
bufãr_Ëngth
= 7;

423 
my_bšd
[1].
is_nuÎ
= 0;

424 
my_bšd
[1].
Ëngth
ð&
bl2
;

426 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

427 
	`check_¡mt_rc
(
rc
,
¡mt
);

429 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

430 
	`check_¡mt_rc
(
rc
,
¡mt
);

432 
rc
ð
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

433 
	`check_¡mt_rc
(
rc
,
¡mt
);

435 
rc
ð
	`mysql_¡mt_ãtch_cÞumn
(
¡mt
, 
my_bšd
, 1, 0);

436 
	`FAIL_IF
(!
rc
, "Errorƒxpected");

438 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

439 
	`check_¡mt_rc
(
rc
,
¡mt
);

441 
c2
[0]ð'\0'; 
l2
= 0;

442 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

443 
my_bšd
[0].
bufãr
ð(*)
c2
;

444 
my_bšd
[0].
bufãr_Ëngth
= 7;

445 
my_bšd
[0].
is_nuÎ
= 0;

446 
my_bšd
[0].
Ëngth
ð&
l2
;

448 
rc
ð
	`mysql_¡mt_ãtch_cÞumn
(
¡mt
, 
my_bšd
, 1, 0);

449 
	`check_¡mt_rc
(
rc
,
¡mt
);

450 
	`FAIL_IF
(!(
	`¡ºcmp
(
c2
, "v’u", 4è=ð0 && 
l2
 == 4), "Expected c2='venu'");

452 
c2
[0]ð'\0'; 
l2
= 0;

453 
rc
ð
	`mysql_¡mt_ãtch_cÞumn
(
¡mt
, 
my_bšd
, 1, 0);

454 
	`check_¡mt_rc
(
rc
,
¡mt
);

455 
	`FAIL_IF
(!(
	`¡rcmp
(
c2
, "v’u"è=ð0 && 
l2
 == 4), "Expected c2='venu'");

457 
c1
= 0;

458 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

459 
my_bšd
[0].
bufãr
ð(*)&
c1
;

460 
my_bšd
[0].
bufãr_Ëngth
= 0;

461 
my_bšd
[0].
is_nuÎ
= 0;

462 
my_bšd
[0].
Ëngth
ð&
l1
;

464 
rc
ð
	`mysql_¡mt_ãtch_cÞumn
(
¡mt
, 
my_bšd
, 0, 0);

465 
	`check_¡mt_rc
(
rc
,
¡mt
);

466 
	`FAIL_IF
(!(
c1
 =ð1 && 
l1
 == 4), "Expected c1=1");

468 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

469 
	`check_¡mt_rc
(
rc
,
¡mt
);

471 
c2
[0]ð'\0'; 
l2
= 0;

472 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

473 
my_bšd
[0].
bufãr
ð(*)
c2
;

474 
my_bšd
[0].
bufãr_Ëngth
= 7;

475 
my_bšd
[0].
is_nuÎ
= 0;

476 
my_bšd
[0].
Ëngth
ð&
l2
;

478 
rc
ð
	`mysql_¡mt_ãtch_cÞumn
(
¡mt
, 
my_bšd
, 1, 0);

479 
	`check_¡mt_rc
(
rc
,
¡mt
);

480 
	`FAIL_IF
(!(
	`¡ºcmp
(
c2
, "mysq", 4è=ð0 && 
l2
 == 5), "Expected c2='mysql'");

482 
c2
[0]ð'\0'; 
l2
= 0;

483 
rc
ð
	`mysql_¡mt_ãtch_cÞumn
(
¡mt
, 
my_bšd
, 1, 0);

484 
	`check_¡mt_rc
(
rc
,
¡mt
);

485 
	`FAIL_IF
(!(
	`¡rcmp
(
c2
, "mysql"è=ð0 && 
l2
 == 5), "Expected c2='mysql'");

487 
c1
= 0;

488 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

489 
my_bšd
[0].
bufãr
ð(*)&
c1
;

490 
my_bšd
[0].
bufãr_Ëngth
= 0;

491 
my_bšd
[0].
is_nuÎ
= 0;

492 
my_bšd
[0].
Ëngth
ð&
l1
;

494 
rc
ð
	`mysql_¡mt_ãtch_cÞumn
(
¡mt
, 
my_bšd
, 0, 0);

495 
	`check_¡mt_rc
(
rc
,
¡mt
);

496 
	`FAIL_IF
(!(
c1
 =ð2 && 
l1
 == 4), "Expected c2=2");

498 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

499 
	`FAIL_IF
(
rc
!=
MYSQL_NO_DATA
, "Expected MYSQL_NO_DATA");

501 
rc
ð
	`mysql_¡mt_ãtch_cÞumn
(
¡mt
, 
my_bšd
, 1, 0);

502 
	`FAIL_IF
(!
rc
, "Errorƒxpected");

504 
	`mysql_¡mt_þo£
(
¡mt
);

505 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable1");

506 
	`check_mysql_rc
(
rc
, 
mysql
);

508  
OK
;

509 
	}
}

513 
	$‹¡_ãtch_nobuffs
(
MYSQL
 *
mysql
)

515 
MYSQL_STMT
 *
¡mt
;

516 
MYSQL_BIND
 
my_bšd
[4];

517 
¡r
[4][50];

518 
rc
;

519 cÚ¡ *
qu”y
 = "SELECT DATABASE(), CURRENT_USER(), \
_DATE(), CURRENT_TIME()";

522 
¡mt
 = 
	`mysql_¡mt_š™
(
mysql
);

523 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

524 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

525 
	`check_¡mt_rc
(
rc
, 
¡mt
);

527 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

528 
	`check_¡mt_rc
(
rc
, 
¡mt
);

530 
rc
= 0;

531 
	`mysql_¡mt_ãtch
(
¡mt
è!ð
MYSQL_NO_DATA
)

532 
rc
++;

534 
	`FAIL_IF
(
rc
 != 1, "Expected 1„ow");

536 
	`mem£t
(
my_bšd
, '\0', (my_bind));

537 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

538 
my_bšd
[0].
bufãr
ð(*)
¡r
[0];

539 
my_bšd
[0].
bufãr_Ëngth
ð(
¡r
[0]);

540 
my_bšd
[1]= my_bind[2]= my_bind[3]= my_bind[0];

541 
my_bšd
[1].
bufãr
ð(*)
¡r
[1];

542 
my_bšd
[2].
bufãr
ð(*)
¡r
[2];

543 
my_bšd
[3].
bufãr
ð(*)
¡r
[3];

545 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

546 
	`check_¡mt_rc
(
rc
, 
¡mt
);

548 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

549 
	`check_¡mt_rc
(
rc
, 
¡mt
);

551 
rc
= 0;

552 
	`mysql_¡mt_ãtch
(
¡mt
è!ð
MYSQL_NO_DATA
)

554 
rc
++;

556 
	`FAIL_IF
(
rc
 != 1, "Expected 1„ow");

558 
	`mysql_¡mt_þo£
(
¡mt
);

560  
OK
;

561 
	}
}

565 
	$‹¡_ãtch_nuÎ
(
MYSQL
 *
mysql
)

567 
MYSQL_STMT
 *
¡mt
;

568 
rc
;

569 
i
;

570 
nD©a
= 0;

571 
MYSQL_BIND
 
my_bšd
[11];

572 
ulÚg
 
Ëngth
[11];

573 
my_boÞ
 
is_nuÎ
[11];

574 
qu”y
[
MAX_TEST_QUERY_LENGTH
];

577 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_fetch_null");

578 
	`check_mysql_rc
(
rc
, 
mysql
);

580 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_fetch_null("

588 
	`check_mysql_rc
(
rc
, 
mysql
);

590 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTOest_fetch_null (col11) "

592 
	`check_mysql_rc
(
rc
, 
mysql
);

594 
rc
ð
	`mysql_comm™
(
mysql
);

595 
	`FAIL_IF
(
rc
, 
	`mysql_”rÜ
(
mysql
));

598 
	`mem£t
(
my_bšd
, '\0', (my_bind));

599 
i
ð0; i < (è
	`¬¿y_–em’ts
(
my_bšd
); i++)

601 
my_bšd
[
i
].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

602 
my_bšd
[
i
].
is_nuÎ
= &is_null[i];

603 
my_bšd
[
i
].
Ëngth
= &length[i];

605 
my_bšd
[
i
-1].
bufãr
ð(*)&
nD©a
;

607 
	`¡rýy
((*)
qu”y
 , "SELECT * FROMest_fetch_null");

609 
rc
ð
	`my_¡mt_»suÉ
(
mysql
, 
qu”y
);

610 
	`FAIL_UNLESS
(
rc
 == 3, "Exoected 3„ows");

612 
¡mt
 = 
	`mysql_¡mt_š™
(
mysql
);

613 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

615 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

616 
	`check_¡mt_rc
(
rc
, 
¡mt
);

618 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

619 
	`check_¡mt_rc
(
rc
, 
¡mt
);

621 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

622 
	`check_¡mt_rc
(
rc
, 
¡mt
);

624 
rc
= 0;

625 
	`mysql_¡mt_ãtch
(
¡mt
è!ð
MYSQL_NO_DATA
)

627 
rc
++;

628 
i
= 0; i < 10; i++)

630 
	`FAIL_IF
(!
is_nuÎ
[
i
], "Expected is_null");

632 
	`FAIL_UNLESS
(
nD©a
 == 1000 ||‚Data == 88 ||‚Data == 389789, "Wrong value for‚Data");

633 
	`FAIL_UNLESS
(
is_nuÎ
[
i
] == 0, "Exoected !is_null");

634 
	`FAIL_UNLESS
(
Ëngth
[
i
] == 4, "Expected†ength=4");

636 
	`FAIL_UNLESS
(
rc
 == 3, "Expected 3„ows");

637 
	`mysql_¡mt_þo£
(
¡mt
);

639 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLEest_fetch_null");

640 
	`check_mysql_rc
(
rc
, 
mysql
);

642  
OK
;

643 
	}
}

647 
	$‹¡_ãtch_d©e
(
MYSQL
 *
mysql
)

649 
MYSQL_STMT
 *
¡mt
;

650 
ušt
 
i
;

651 
rc
;

652 
y—r
;

653 
d©e
[25], 
my_time
[25], 
ts
[25], 
ts_4
[25], 
ts_6
[20], 
dt
[20];

654 
ulÚg
 
d_Ëngth
, 
t_Ëngth
, 
ts_Ëngth
, 
ts4_Ëngth
, 
ts6_Ëngth
,

655 
dt_Ëngth
, 
y_Ëngth
;

656 
MYSQL_BIND
 
my_bšd
[8];

657 
my_boÞ
 
is_nuÎ
[8];

658 
ulÚg
 
Ëngth
[8];

659 cÚ¡ *
qu”y
= "SELECT * FROMest_bind_result";

661 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_bind_result");

662 
	`check_mysql_rc
(
rc
, 
mysql
);

664 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_bind_result(c1 date, c2ime, \
3imestamp, \
4 year, \
5 datetime, \
6imestamp, \
7imestamp)");

670 
	`check_mysql_rc
(
rc
, 
mysql
);

672 
rc
ð
	`mysql_qu”y
(
mysql
, "SET SQL_MODE=''");

673 
	`check_mysql_rc
(
rc
, 
mysql
);

674 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTOest_bind_result VALUES('2002-01-02', \
'12:49:00', \
'2002-01-02 17:46:59', \
2010, \
'2010-07-10', \
'2020', '1999-12-29')");

680 
	`check_mysql_rc
(
rc
, 
mysql
);

682 
rc
ð
	`mysql_comm™
(
mysql
);

683 
	`FAIL_IF
(
rc
, 
	`mysql_”rÜ
(
mysql
));

685 
	`mem£t
(
my_bšd
, '\0', (my_bind));

686 
i
ð0; i < 
	`¬¿y_–em’ts
(
my_bšd
); i++)

688 
my_bšd
[
i
].
is_nuÎ
= &is_null[i];

689 
my_bšd
[
i
].
Ëngth
= &length[i];

692 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

693 
my_bšd
[1]= my_bind[2]= my_bind[0];

695 
my_bšd
[0].
bufãr
ð(*)&
d©e
;

696 
my_bšd
[0].
bufãr_Ëngth
ð(
d©e
);

697 
my_bšd
[0].
Ëngth
ð&
d_Ëngth
;

699 
my_bšd
[1].
bufãr
ð(*)&
my_time
;

700 
my_bšd
[1].
bufãr_Ëngth
ð(
my_time
);

701 
my_bšd
[1].
Ëngth
ð&
t_Ëngth
;

703 
my_bšd
[2].
bufãr
ð(*)&
ts
;

704 
my_bšd
[2].
bufãr_Ëngth
ð(
ts
);

705 
my_bšd
[2].
Ëngth
ð&
ts_Ëngth
;

707 
my_bšd
[3].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

708 
my_bšd
[3].
bufãr
ð(*)&
y—r
;

709 
my_bšd
[3].
Ëngth
ð&
y_Ëngth
;

711 
my_bšd
[4].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

712 
my_bšd
[4].
bufãr
ð(*)&
dt
;

713 
my_bšd
[4].
bufãr_Ëngth
ð(
dt
);

714 
my_bšd
[4].
Ëngth
ð&
dt_Ëngth
;

716 
my_bšd
[5].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

717 
my_bšd
[5].
bufãr
ð(*)&
ts_4
;

718 
my_bšd
[5].
bufãr_Ëngth
ð(
ts_4
);

719 
my_bšd
[5].
Ëngth
ð&
ts4_Ëngth
;

721 
my_bšd
[6].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

722 
my_bšd
[6].
bufãr
ð(*)&
ts_6
;

723 
my_bšd
[6].
bufãr_Ëngth
ð(
ts_6
);

724 
my_bšd
[6].
Ëngth
ð&
ts6_Ëngth
;

726 
rc
ð
	`my_¡mt_»suÉ
(
mysql
, "SELECT * FROMest_bind_result");

727 
	`FAIL_UNLESS
(
rc
 == 1, "Expected 1„ow");

729 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

730 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

731 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

732 
	`check_¡mt_rc
(
rc
, 
¡mt
);

734 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

735 
	`check_¡mt_rc
(
rc
, 
¡mt
);

737 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

738 
	`check_¡mt_rc
(
rc
, 
¡mt
);

740 
ts_4
[0]= '\0';

741 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

742 
	`check_¡mt_rc
(
rc
, 
¡mt
);

744 
	`FAIL_UNLESS
(
	`¡rcmp
(
d©e
, "2002-01-02") == 0, "date != '2002-01-02'");

745 
	`FAIL_UNLESS
(
d_Ëngth
 == 10, "d_length != 10");

747 
	`FAIL_UNLESS
(
	`¡rcmp
(
my_time
, "12:49:00") == 0, "mytime != '12:49:00'");

748 
	`FAIL_UNLESS
(
t_Ëngth
 == 8, "t_length != 8");

750 
	`FAIL_UNLESS
(
	`¡rcmp
(
ts
, "2002-01-02 17:46:59") == 0, "ts != '2002-01-02 17:46:59'");

751 
	`FAIL_UNLESS
(
ts_Ëngth
 == 19, "ts_length != 19");

753 
	`FAIL_UNLESS
(
	`¡rcmp
(
dt
, "2010-07-10 00:00:00") == 0, "dt != 2010-07-10 00:00:00");

754 
	`FAIL_UNLESS
(
dt_Ëngth
 == 19, "dt_length != 19");

756 
	`FAIL_UNLESS
(
	`¡rcmp
(
ts_4
, "0000-00-00 00:00:00") == 0, "ts4 != '0000-00-00 00:00:00'");

757 
	`FAIL_UNLESS
(
ts4_Ëngth
 =ð
	`¡¾’
("0000-00-00 00:00:00"), "ts4_length != 19");

759 
	`FAIL_UNLESS
(
	`¡rcmp
(
ts_6
, "1999-12-29 00:00:00") == 0, "ts_6 != '1999-12-29 00:00:00'");

760 
	`FAIL_UNLESS
(
ts6_Ëngth
 == 19, "ts6_length != 19");

762 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

763 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

765 
	`mysql_¡mt_þo£
(
¡mt
);

766 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_bind_result");

767 
	`check_mysql_rc
(
rc
, 
mysql
);

769  
OK
;

770 
	}
}

774 
	$‹¡_ãtch_¡r
(
MYSQL
 *
mysql
)

776 
rc
;

778 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_bind_fetch");

779 
	`check_mysql_rc
(
rc
, 
mysql
);

781 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_bind_fetch(c1 char(10), \
2 char(10), \
3 char(20), \
4 char(20), \
5 char(30), \
6 char(40), \
7 char(20))");

788 
	`check_mysql_rc
(
rc
, 
mysql
);

790 
rc
ð
	`bšd_ãtch
(
mysql
, 3);

791 
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_bind_fetch");

792  
rc
;

793 
	}
}

797 
	$‹¡_ãtch_lÚg
(
MYSQL
 *
mysql
)

799 
rc
;

801 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_bind_fetch");

802 
	`check_mysql_rc
(
rc
, 
mysql
);

803 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_bind_fetch(c1 int unsigned, \
2 int unsigned, \
3 int, \
4 int, \
5 int, \
6 int unsigned, \
7 int)");

810 
	`check_mysql_rc
(
rc
, 
mysql
);

811 
rc
ð
	`bšd_ãtch
(
mysql
, 4);

812 
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_bind_fetch");

813  
rc
;

814 
	}
}

819 
	$‹¡_ãtch_shÜt
(
MYSQL
 *
mysql
)

821 
rc
;

823 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_bind_fetch");

824 
	`check_mysql_rc
(
rc
, 
mysql
);

825 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_bind_fetch(c1 smallint unsigned, \
2 smallint, \
3 smallint unsigned, \
4 smallint, \
5 smallint, \
6 smallint, \
7 smallint unsigned)");

832 
	`check_mysql_rc
(
rc
, 
mysql
);

833 
rc
ð
	`bšd_ãtch
(
mysql
, 5);

834 
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_bind_fetch");

835  
rc
;

836 
	}
}

841 
	$‹¡_ãtch_tšy
(
MYSQL
 *
mysql
)

843 
rc
;

845 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_bind_fetch");

846 
	`check_mysql_rc
(
rc
, 
mysql
);

848 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_bind_fetch(c1inyint unsigned, \
2inyint, \
3inyint unsigned, \
4inyint, \
5inyint, \
6inyint, \
7inyint unsigned)");

855 
	`check_mysql_rc
(
rc
, 
mysql
);

856 
rc
ð
	`bšd_ãtch
(
mysql
, 3);

857 
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_bind_fetch");

858  
rc
;

859 
	}
}

864 
	$‹¡_ãtch_bigšt
(
MYSQL
 *
mysql
)

866 
rc
;

868 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_bind_fetch");

869 
	`check_mysql_rc
(
rc
, 
mysql
);

871 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_bind_fetch(c1 bigint, \
2 bigint, \
3 bigint unsigned, \
4 bigint unsigned, \
5 bigint unsigned, \
6 bigint unsigned, \
7 bigint unsigned)");

878 
	`check_mysql_rc
(
rc
, 
mysql
);

879 
rc
ð
	`bšd_ãtch
(
mysql
, 2);

880 
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_bind_fetch");

881  
rc
;

882 
	}
}

887 
	$‹¡_ãtch_æßt
(
MYSQL
 *
mysql
)

889 
rc
;

891 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_bind_fetch");

892 
	`check_mysql_rc
(
rc
, 
mysql
);

894 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_bind_fetch(c1 float(3), \
2 float, \
3 float unsigned, \
4 float, \
5 float, \
6 float, \
7 float(10) unsigned)");

901 
	`check_mysql_rc
(
rc
, 
mysql
);

903 
rc
ð
	`bšd_ãtch
(
mysql
, 2);

904 
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_bind_fetch");

905  
rc
;

906 
	}
}

911 
	$‹¡_ãtch_doubË
(
MYSQL
 *
mysql
)

913 
rc
;

915 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_bind_fetch");

916 
	`check_mysql_rc
(
rc
, 
mysql
);

917 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_bind_fetch(c1 double(5, 2), "

921 
	`check_mysql_rc
(
rc
, 
mysql
);

922 
rc
ð
	`bšd_ãtch
(
mysql
, 3);

923 
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_bind_fetch");

924  
rc
;

925 
	}
}

927 
	$‹¡_cÚc281
(
MYSQL
 *
mysql
)

929 
rc
;

930 
MYSQL_STMT
 *
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

931 
MYSQL_BIND
 
bšd
[2];

932 
Ëngth
= 0;

933 
bufãr
[2048];

935 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS conc282");

936 
	`check_mysql_rc
(
rc
, 
mysql
);

938 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE conc282 (a blob, b varchar(1000), c int)");

939 
	`check_mysql_rc
(
rc
, 
mysql
);

941 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTO conc282 VALUES (REPEAT('A',2000), REPEAT('B', 999),3)");

942 
	`check_mysql_rc
(
rc
, 
mysql
);

944 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, "SELECT‡, b FROM conc282", -1);

945 
	`check_¡mt_rc
(
rc
, 
¡mt
);

947 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

948 
	`check_¡mt_rc
(
rc
, 
¡mt
);

950 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

951 
	`check_¡mt_rc
(
rc
, 
¡mt
);

953 
	`mem£t
(
bšd
, 0, (
MYSQL_BIND
) * 2);

955 
bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_BLOB
;

956 
bšd
[0].
bufãr
= buffer;

957 
bšd
[0].
bufãr_Ëngth
= 2048;

958 
bšd
[0].
Ëngth
= &length;

960 
rc
ð
	`mysql_¡mt_ãtch_cÞumn
(
¡mt
, &
bšd
[0], 0, 0);

961 
	`check_¡mt_rc
(
rc
, 
¡mt
);

963 
	`FAIL_IF
(
Ëngth
 != 2000, "Expected†ength= 2000");

964 
	`FAIL_IF
(
bufãr
[0] != 'A' || buffer[1999] != 'A', "Wrong„esult");

966 
	`mysql_¡mt_þo£
(
¡mt
);

968 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE conc282");

969 
	`check_mysql_rc
(
rc
, 
mysql
);

971  
OK
;

973 
	}
}

975 
my_‹¡s_¡
 
	gmy_‹¡s
[] = {

976 {"‹¡_cÚc281", 
‹¡_cÚc281
, 1, 0, 
NULL
, NULL},

977 {"‹¡_ãtch_£ek", 
‹¡_ãtch_£ek
, 1, 0, 
NULL
 , NULL},

978 {"‹¡_ãtch_off£t", 
‹¡_ãtch_off£t
, 1, 0, 
NULL
 , NULL},

979 {"‹¡_ãtch_cÞumn", 
‹¡_ãtch_cÞumn
, 1, 0, 
NULL
 , NULL},

980 {"‹¡_ãtch_nobuffs", 
‹¡_ãtch_nobuffs
, 1, 0, 
NULL
 , NULL},

981 {"‹¡_ãtch_nuÎ", 
‹¡_ãtch_nuÎ
, 1, 0, 
NULL
 , NULL},

982 {"‹¡_ãtch_d©e", 
‹¡_ãtch_d©e
, 1, 0, 
NULL
 , NULL},

983 {"‹¡_ãtch_¡r", 
‹¡_ãtch_¡r
, 1, 0, 
NULL
 , NULL},

984 {"‹¡_ãtch_lÚg", 
‹¡_ãtch_lÚg
, 1, 0, 
NULL
 , NULL},

985 {"‹¡_ãtch_shÜt", 
‹¡_ãtch_shÜt
, 1, 0, 
NULL
 , NULL},

986 {"‹¡_ãtch_tšy", 
‹¡_ãtch_tšy
, 1, 0, 
NULL
 , NULL},

987 {"‹¡_ãtch_bigšt", 
‹¡_ãtch_bigšt
, 1, 0, 
NULL
 , NULL},

988 {"‹¡_ãtch_æßt", 
‹¡_ãtch_æßt
, 1, 0, 
NULL
 , NULL},

989 {"‹¡_ãtch_doubË", 
‹¡_ãtch_doubË
, 1, 0, 
NULL
 , NULL},

990 {
NULL
, NULL, 0, 0, NULL, NULL}

993 
	$maš
(
¬gc
, **
¬gv
)

995 ià(
¬gc
 > 1)

996 
	`g‘_ÝtiÚs
(
¬gc
, 
¬gv
);

998 
	`g‘_’vv¬s
();

1000 
	`run_‹¡s
(
my_‹¡s
);

1002 (
	`ex™_¡©us
());

1003 
	}
}

	@unittest/libmariadb/getopt.c

33 #iâdeà
_NO_PROTO


34 
	#_NO_PROTO


	)

37 #ifdeà
HAVE_CONFIG_H


38 
	~<cÚfig.h
>

41 #ià(!
defšed
 (
__STDC__
è|| !__STDC__è&& !defšed(
MSDOS
è&& !defšed(
OS2
)

45 cÚ¡

	)

49 
	~<ma_glob®.h
>

50 
	~<ma_¡ršg.h
>

60 #ià
defšed
 (
_LIBC
è|| !defšed (
__GNU_LIBRARY__
)

65 #ifdef 
__GNU_LIBRARY__


68 
	~<¡dlib.h
>

85 
	~"ma_g‘Ýt.h
"

93 *
	gÝrg
 = 
NULL
;

108 
	gÝtšd
 = 1;

117 *
	gÃxtch¬
;

122 
	gÝ‹¼
 = 1;

128 
	gÝtÝt
 = '?';

161 
	mREQUIRE_ORDER
, 
	mPERMUTE
, 
	mRETURN_IN_ORDER


162 } 
	gÜd”šg
;

165 *
	gposixly_cÜ»ù
;

167 #ifdef 
__GNU_LIBRARY__


172 
	~<¡ršg.h
>

173 
	#my_šdex
 
¡rchr


	)

180 
	$my_šdex
 (cÚ¡ *
¡r
, 
chr
)

182 *
¡r
)

184 ià(*
¡r
 =ð
chr
)

185  (*è
¡r
;

186 
¡r
++;

189 
	}
}

193 #ifdeà
__GNUC__


196 #ià!
defšed
 (
__STDC__
) || !__STDC__

199 
¡¾’
 (const *);

211 
	gfœ¡_nÚÝt
;

212 
	gÏ¡_nÚÝt
;

224 
	$exchªge
 (**
¬gv
)

226 
bÙtom
 = 
fœ¡_nÚÝt
;

227 
middË
 = 
Ï¡_nÚÝt
;

228 
tÝ
 = 
Ýtšd
;

229 *
‹m
;

236 
tÝ
 > 
middË
 && middË > 
bÙtom
)

238 ià(
tÝ
 - 
middË
 > middË - 
bÙtom
)

241 
Ën
 = 
middË
 - 
bÙtom
;

242 
i
;

245 
i
 = 0; i < 
Ën
; i++)

247 
‹m
 = 
¬gv
[
bÙtom
 + 
i
];

248 
¬gv
[
bÙtom
 + 
i
] =‡rgv[
tÝ
 - (
middË
 - bottom) + i];

249 
¬gv
[
tÝ
 - (
middË
 - 
bÙtom
è+ 
i
] = 
‹m
;

252 
tÝ
 -ð
Ën
;

257 
Ën
 = 
tÝ
 - 
middË
;

258 
i
;

261 
i
 = 0; i < 
Ën
; i++)

263 
‹m
 = 
¬gv
[
bÙtom
 + 
i
];

264 
¬gv
[
bÙtom
 + 
i
] =‡rgv[
middË
 + i];

265 
¬gv
[
middË
 + 
i
] = 
‹m
;

268 
bÙtom
 +ð
Ën
;

274 
fœ¡_nÚÝt
 +ð(
Ýtšd
 - 
Ï¡_nÚÝt
);

275 
Ï¡_nÚÝt
 = 
Ýtšd
;

276 
	}
}

281 
	$_g‘Ýt_š™Ÿlize
 (cÚ¡ *
Ýt¡ršg
)

287 
fœ¡_nÚÝt
 = 
Ï¡_nÚÝt
 = 
Ýtšd
 = 1;

289 
Ãxtch¬
 = 
NULL
;

291 
posixly_cÜ»ù
 = 
	`g‘’v
 ("POSIXLY_CORRECT");

295 ià(
Ýt¡ršg
[0] == '-')

297 
Üd”šg
 = 
RETURN_IN_ORDER
;

298 ++
Ýt¡ršg
;

300 ià(
Ýt¡ršg
[0] == '+')

302 
Üd”šg
 = 
REQUIRE_ORDER
;

303 ++
Ýt¡ršg
;

305 ià(
posixly_cÜ»ù
 !ð
NULL
)

306 
Üd”šg
 = 
REQUIRE_ORDER
;

308 
Üd”šg
 = 
PERMUTE
;

310  
Ýt¡ršg
;

311 
	}
}

370 
	$_g‘Ýt_š‹º®
 (
¬gc
, *cÚ¡ *
¬gv
, cÚ¡ *
Ýt¡ršg
, cÚ¡ 
ÝtiÚ
 *
lÚgÝts
, *
lÚgšd
, 
lÚg_Úly
)

372 
Ýrg
 = 
NULL
;

374 ià(
Ýtšd
 == 0)

375 
Ýt¡ršg
 = 
	`_g‘Ýt_š™Ÿlize
 (optstring);

377 ià(
Ãxtch¬
 =ð
NULL
 || *nextchar == '\0')

381 ià(
Üd”šg
 =ð
PERMUTE
)

386 ià(
fœ¡_nÚÝt
 !ð
Ï¡_nÚÝt
 &&†a¡_nÚÝˆ!ð
Ýtšd
)

387 
	`exchªge
 ((**è
¬gv
);

388 ià(
Ï¡_nÚÝt
 !ð
Ýtšd
)

389 
fœ¡_nÚÝt
 = 
Ýtšd
;

394 
Ýtšd
 < 
¬gc


395 && (
¬gv
[
Ýtšd
][0] != '-' ||‡rgv[optind][1] == '\0'))

396 
Ýtšd
++;

397 
Ï¡_nÚÝt
 = 
Ýtšd
;

405 ià(
Ýtšd
 !ð
¬gc
 && !
	`¡rcmp
 (
¬gv
[optind], "--"))

407 
Ýtšd
++;

409 ià(
fœ¡_nÚÝt
 !ð
Ï¡_nÚÝt
 &&†a¡_nÚÝˆ!ð
Ýtšd
)

410 
	`exchªge
 ((**è
¬gv
);

411 ià(
fœ¡_nÚÝt
 =ð
Ï¡_nÚÝt
)

412 
fœ¡_nÚÝt
 = 
Ýtšd
;

413 
Ï¡_nÚÝt
 = 
¬gc
;

415 
Ýtšd
 = 
¬gc
;

421 ià(
Ýtšd
 =ð
¬gc
)

425 ià(
fœ¡_nÚÝt
 !ð
Ï¡_nÚÝt
)

426 
Ýtšd
 = 
fœ¡_nÚÝt
;

427  
EOF
;

433 ià((
¬gv
[
Ýtšd
][0] != '-' ||‡rgv[optind][1] == '\0'))

435 ià(
Üd”šg
 =ð
REQUIRE_ORDER
)

436  
EOF
;

437 
Ýrg
 = 
¬gv
[
Ýtšd
++];

444 
Ãxtch¬
 = (
¬gv
[
Ýtšd
] + 1

445 + (
lÚgÝts
 !ð
NULL
 && 
¬gv
[
Ýtšd
][1] == '-'));

463 ià(
lÚgÝts
 !ð
NULL


464 && (
¬gv
[
Ýtšd
][1] == '-'

465 || (
lÚg_Úly
 && (
¬gv
[
Ýtšd
][2] || !
	`my_šdex
 (
Ýt¡ršg
,‡rgv[optind][1])))))

467 *
Çm“nd
;

468 cÚ¡ 
ÝtiÚ
 *
p
;

469 cÚ¡ 
ÝtiÚ
 *
pfound
 = 
NULL
;

470 
exaù
 = 0;

471 
ambig
 = 0;

472 
šdfound
=0;

473 
ÝtiÚ_šdex
;

475 
Çm“nd
 = 
Ãxtch¬
; *nameend && *nameend != '=';‚ameend++)

480 
p
 = 
lÚgÝts
, 
ÝtiÚ_šdex
 = 0;…->
Çme
;…++, option_index++)

481 ià(!
	`¡ºcmp
 (
p
->
Çme
, 
Ãxtch¬
, 
Çm“nd
 -‚extchar))

483 ià((
size_t
è(
Çm“nd
 - 
Ãxtch¬
è=ð(size_tè
	`¡¾’
 (
p
->
Çme
))

486 
pfound
 = 
p
;

487 
šdfound
 = 
ÝtiÚ_šdex
;

488 
exaù
 = 1;

491 ià(
pfound
 =ð
NULL
)

494 
pfound
 = 
p
;

495 
šdfound
 = 
ÝtiÚ_šdex
;

499 
ambig
 = 1;

502 ià(
ambig
 && !
exaù
)

504 ià(
Ý‹¼
)

505 
	`årštf
 (
¡d”r
, "%s: option `%s' is‡mbiguous\n",

506 
¬gv
[0],‡rgv[
Ýtšd
]);

507 
Ãxtch¬
 +ð
	`¡¾’
 (nextchar);

508 
Ýtšd
++;

512 ià(
pfound
 !ð
NULL
)

514 
ÝtiÚ_šdex
 = 
šdfound
;

515 
Ýtšd
++;

516 ià(*
Çm“nd
)

520 ià(
pfound
->
has_¬g
)

521 
Ýrg
 = 
Çm“nd
 + 1;

524 ià(
Ý‹¼
)

526 ià(
¬gv
[
Ýtšd
 - 1][1] == '-')

528 
	`årštf
 (
¡d”r
,

530 
¬gv
[0], 
pfound
->
Çme
);

533 
	`årštf
 (
¡d”r
,

535 
¬gv
[0],‡rgv[
Ýtšd
 - 1][0], 
pfound
->
Çme
);

537 
Ãxtch¬
 +ð
	`¡¾’
 (nextchar);

541 ià(
pfound
->
has_¬g
 == 1)

543 ià(
Ýtšd
 < 
¬gc
)

544 
Ýrg
 = 
¬gv
[
Ýtšd
++];

547 ià(
Ý‹¼
)

548 
	`årštf
 (
¡d”r
, "%s: option `%s'„equires‡n‡rgument\n",

549 
¬gv
[0],‡rgv[
Ýtšd
 - 1]);

550 
Ãxtch¬
 +ð
	`¡¾’
 (nextchar);

551  
Ýt¡ršg
[0] == ':' ? ':' : '?';

554 
Ãxtch¬
 +ð
	`¡¾’
 (nextchar);

555 ià(
lÚgšd
 !ð
NULL
)

556 *
lÚgšd
 = 
ÝtiÚ_šdex
;

557 ià(
pfound
->
æag
)

559 *(
pfound
->
æag
èðpfound->
v®
;

562  
pfound
->
v®
;

569 ià(!
lÚg_Úly
 || 
¬gv
[
Ýtšd
][1] == '-'

570 || 
	`my_šdex
 (
Ýt¡ršg
, *
Ãxtch¬
è=ð
NULL
)

572 ià(
Ý‹¼
)

574 ià(
¬gv
[
Ýtšd
][1] == '-')

576 
	`årštf
 (
¡d”r
, "%s: unrecognized option `--%s'\n",

577 
¬gv
[0], 
Ãxtch¬
);

580 
	`årštf
 (
¡d”r
, "%s: unrecognized option `%c%s'\n",

581 
¬gv
[0],‡rgv[
Ýtšd
][0], 
Ãxtch¬
);

583 
Ãxtch¬
 = (*) "";

584 
Ýtšd
++;

592 
c
 = *
Ãxtch¬
++;

593 *
‹mp
 = 
	`my_šdex
 (
Ýt¡ršg
, 
c
);

596 ià(*
Ãxtch¬
 == '\0')

597 ++
Ýtšd
;

599 ià(
‹mp
 =ð
NULL
 || 
c
 == ':')

601 ià(
Ý‹¼
)

603 ià(
posixly_cÜ»ù
)

605 
	`årštf
 (
¡d”r
, "%s: iÎeg® o±iÚ -- %c\n", 
¬gv
[0], 
c
);

607 
	`årštf
 (
¡d”r
, "%s: inv®id o±iÚ -- %c\n", 
¬gv
[0], 
c
);

609 
ÝtÝt
 = 
c
;

612 ià(
‹mp
[1] == ':')

614 ià(
‹mp
[2] == ':')

617 ià(*
Ãxtch¬
 != '\0')

619 
Ýrg
 = 
Ãxtch¬
;

620 
Ýtšd
++;

623 
Ýrg
 = 
NULL
;

624 
Ãxtch¬
 = 
NULL
;

629 ià(*
Ãxtch¬
 != '\0')

631 
Ýrg
 = 
Ãxtch¬
;

634 
Ýtšd
++;

636 ià(
Ýtšd
 =ð
¬gc
)

638 ià(
Ý‹¼
)

641 
	`årštf
 (
¡d”r
, "%s: option„equires‡n‡rgument -- %c\n",

642 
¬gv
[0], 
c
);

644 
ÝtÝt
 = 
c
;

645 ià(
Ýt¡ršg
[0] == ':')

646 
c
 = ':';

648 
c
 = '?';

653 
Ýrg
 = 
¬gv
[
Ýtšd
++];

654 
Ãxtch¬
 = 
NULL
;

657  
c
;

659 
	}
}

662 
	$g‘Ýt
 (
¬gc
, *cÚ¡ *
¬gv
, cÚ¡ *
Ýt¡ršg
)

664  
	`_g‘Ýt_š‹º®
 (
¬gc
, 
¬gv
, 
Ýt¡ršg
,

665 (cÚ¡ 
ÝtiÚ
 *) 0,

668 
	}
}

672 #ifdeà
TEST


678 
	$maš
 (
¬gc
, 
¬gv
)

679 
¬gc
;

680 **
¬gv
;

682 
c
;

683 
dig™_Ýtšd
 = 0;

687 
this_ÝtiÚ_Ýtšd
 = 
Ýtšd
 ? optind : 1;

689 
c
 = 
	`g‘Ýt
 (
¬gc
, 
¬gv
, "abc:d:0123456789");

690 ià(
c
 =ð
EOF
)

693 
c
)

705 ià(
dig™_Ýtšd
 !ð0 && dig™_Ýtšd !ð
this_ÝtiÚ_Ýtšd
)

706 
	`´štf
 ("digits occur inwo different‡rgv-elements.\n");

707 
dig™_Ýtšd
 = 
this_ÝtiÚ_Ýtšd
;

708 
	`´štf
 ("ÝtiÚ %c\n", 
c
);

712 
	`´štf
 ("option‡\n");

716 
	`´štf
 ("option b\n");

720 
	`´štf
 ("ÝtiÚ c w™h v®u`%s'\n", 
Ýrg
);

727 
	`´štf
 ("?? g‘Ýˆ»tuºed ch¬aù” cod0%Ø??\n", 
c
);

731 ià(
Ýtšd
 < 
¬gc
)

733 
	`´štf
 ("non-option ARGV-elements: ");

734 
Ýtšd
 < 
¬gc
)

735 
	`´štf
 ("% ", 
¬gv
[
Ýtšd
++]);

736 
	`´štf
 ("\n");

739 
	`ex™
 (0);

740 
	}
}

	@unittest/libmariadb/logs.c

24 
	~"my_‹¡.h
"

26 #ifdeà
ENABLE_IF_IN_USE


27 
	$’abË_g’”®_log
(
MYSQL
 *
mysql
, 
Œunÿ‹
)

29 
rc
;

31 
rc
ð
	`mysql_qu”y
(
mysql
, "set @save_global_general_log=@@global.general_log");

32 
	`check_mysql_rc
(
rc
, 
mysql
);

34 
rc
ð
	`mysql_qu”y
(
mysql
, "set @@global.general_log=on");

35 
	`check_mysql_rc
(
rc
, 
mysql
);

37 ià(
Œunÿ‹
)

39 
rc
ð
	`mysql_qu”y
(
mysql
, "truncate mysql.general_log");

40 
	`check_mysql_rc
(
rc
, 
mysql
);

43  
OK
;

44 
	}
}

47 
	$»¡Üe_g’”®_log
(
MYSQL
 *
mysql
)

49 
rc
;

50 
rc
ð
	`mysql_qu”y
(
mysql
, "set @@global.general_log=@save_global_general_log");

51 
	`check_mysql_rc
(
rc
, 
mysql
);

53  
OK
;

54 
	}
}

59 
	$‹¡_logs
(
MYSQL
 *
mysql
)

61 
MYSQL_STMT
 *
¡mt
;

62 
MYSQL_BIND
 
my_bšd
[2];

63 
d©a
[255];

64 
size_t
 
Ëngth
;

65 
rc
;

66 
id
;

68 
rc
ð
	`mysql_qu”y
(
mysql
, "SET session sql_mode=''");

69 
	`check_mysql_rc
(
rc
, 
mysql
);

71 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_logs");

72 
	`check_mysql_rc
(
rc
, 
mysql
);

74 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_logs(id smallint,‚ame varchar(20))");

75 
	`check_mysql_rc
(
rc
, 
mysql
);

77 
	`¡rýy
((*)
d©a
, "INSERT INTOest_logs VALUES(?, ?)");

78 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

79 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

81 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
d©a
));

82 
	`check_¡mt_rc
(
rc
, 
¡mt
);

84 
	`mem£t
(
my_bšd
, '\0', (my_bind));

86 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_SHORT
;

87 
my_bšd
[0].
bufãr
ð(*)&
id
;

89 
my_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

90 
my_bšd
[1].
bufãr
ð(*)&
d©a
;

91 
my_bšd
[1].
bufãr_Ëngth
= 255;

92 
my_bšd
[1].
Ëngth
= (*)&length;

94 
id
= 9876;

95 
	`¡rýy
((*)
d©a
, "MySQL - Open Source Database");

96 
Ëngth
ð
	`¡¾’
(
d©a
);

98 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

99 
	`check_¡mt_rc
(
rc
, 
¡mt
);

101 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

102 
	`check_¡mt_rc
(
rc
, 
¡mt
);

104 
	`¡rýy
((*)
d©a
, "'");

105 
Ëngth
= 1;

107 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

108 
	`check_¡mt_rc
(
rc
, 
¡mt
);

110 
	`¡rýy
((*)
d©a
, "\"");

111 
Ëngth
= 1;

113 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

114 
	`check_¡mt_rc
(
rc
, 
¡mt
);

116 
	`¡rýy
((*)
d©a
, "my\'sql\'");

117 
Ëngth
ð
	`¡¾’
(
d©a
);

118 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

119 
	`check_¡mt_rc
(
rc
, 
¡mt
);

121 
	`¡rýy
((*)
d©a
, "my\"sql\"");

122 
Ëngth
ð
	`¡¾’
(
d©a
);

123 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

124 
	`check_¡mt_rc
(
rc
, 
¡mt
);

126 
	`mysql_¡mt_þo£
(
¡mt
);

128 
	`¡rýy
((*)
d©a
, "INSERT INTOest_logs VALUES(20, 'mysql')");

129 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

130 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

132 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
d©a
));

133 
	`check_¡mt_rc
(
rc
, 
¡mt
);

135 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

136 
	`check_¡mt_rc
(
rc
, 
¡mt
);

138 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

139 
	`check_¡mt_rc
(
rc
, 
¡mt
);

141 
	`mysql_¡mt_þo£
(
¡mt
);

143 
	`¡rýy
((*)
d©a
, "SELECT * FROMest_logs WHERE id=?");

144 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

145 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

147 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
d©a
));

148 
	`check_¡mt_rc
(
rc
, 
¡mt
);

150 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

151 
	`check_¡mt_rc
(
rc
, 
¡mt
);

153 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

154 
	`check_¡mt_rc
(
rc
, 
¡mt
);

156 
my_bšd
[1].
bufãr_Ëngth
= 255;

157 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

158 
	`check_¡mt_rc
(
rc
, 
¡mt
);

160 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

161 
	`check_¡mt_rc
(
rc
, 
¡mt
);

163 
	`FAIL_UNLESS
(
id
 == 9876, "id != 9876");

164 
	`FAIL_UNLESS
(
Ëngth
 == 19 ||†ength == 20, "Invalid Length");

165 
	`FAIL_UNLESS
(
	`¡ºcmp
(
d©a
, "MySQL - Open Source", 19) == 0, "data != 'MySQL - Open Source'");

167 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

168 
	`check_¡mt_rc
(
rc
, 
¡mt
);

170 
	`FAIL_UNLESS
(
Ëngth
 == 1, "length != 1");

171 
	`FAIL_UNLESS
(
	`¡rcmp
(
d©a
, "'") == 0, "data != '''");

173 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

174 
	`check_¡mt_rc
(
rc
, 
¡mt
);

176 
	`FAIL_UNLESS
(
Ëngth
 == 1, "length != 1");

177 
	`FAIL_UNLESS
(
	`¡rcmp
(
d©a
, "\"") == 0, "data != '\"'");

179 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

180 
	`check_¡mt_rc
(
rc
, 
¡mt
);

182 
	`FAIL_UNLESS
(
Ëngth
 == 7, "length != 7");

183 
	`FAIL_UNLESS
(
	`¡rcmp
(
d©a
, "my\'sql\'") == 0, "data != my'sql'");

185 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

186 
	`check_¡mt_rc
(
rc
, 
¡mt
);

188 
	`FAIL_UNLESS
(
Ëngth
 == 7, "length != 7");

190 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

191 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

193 
	`mysql_¡mt_þo£
(
¡mt
);

195 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLEest_logs");

196 
	`check_mysql_rc
(
rc
, 
mysql
);

198  
OK
;

199 
	}
}

202 
my_‹¡s_¡
 
	gmy_‹¡s
[] = {

203 {"‹¡_logs", 
‹¡_logs
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

204 {
NULL
, NULL, 0, 0, NULL, NULL}

207 
	$maš
(
¬gc
, **
¬gv
)

209 ià(
¬gc
 > 1)

210 
	`g‘_ÝtiÚs
(
¬gc
, 
¬gv
);

212 
	`g‘_’vv¬s
();

214 
	`run_‹¡s
(
my_‹¡s
);

216 (
	`ex™_¡©us
());

217 
	}
}

	@unittest/libmariadb/ma_getopt.c

33 #iâdeà
_NO_PROTO


34 
	#_NO_PROTO


	)

37 #ifdeà
HAVE_CONFIG_H


38 
	~<cÚfig.h
>

41 #ià(!
defšed
 (
__STDC__
è|| !__STDC__è&& !defšed(
MSDOS
è&& !defšed(
OS2
)

45 cÚ¡

	)

48 
	~<¡dlib.h
>

49 
	~<¡dio.h
>

50 
	~<¡ršg.h
>

59 #ià
defšed
 (
_LIBC
è|| !defšed (
__GNU_LIBRARY__
)

64 #ifdef 
__GNU_LIBRARY__


67 
	~<¡dlib.h
>

84 
	~"ma_g‘Ýt.h
"

92 *
	gÝrg
 = 
NULL
;

107 
	gÝtšd
 = 1;

116 *
	gÃxtch¬
;

121 
	gÝ‹¼
 = 1;

127 
	gÝtÝt
 = '?';

160 
	mREQUIRE_ORDER
, 
	mPERMUTE
, 
	mRETURN_IN_ORDER


161 } 
	gÜd”šg
;

164 *
	gposixly_cÜ»ù
;

166 #ifdef 
__GNU_LIBRARY__


171 
	~<¡ršg.h
>

172 
	#my_šdex
 
¡rchr


	)

179 
	$my_šdex
 (cÚ¡ *
¡r
, 
chr
)

181 *
¡r
)

183 ià(*
¡r
 =ð
chr
)

184  (*è
¡r
;

185 
¡r
++;

188 
	}
}

192 #ifdeà
__GNUC__


195 #ià!
defšed
 (
__STDC__
) || !__STDC__

198 
¡¾’
 (const *);

210 
	gfœ¡_nÚÝt
;

211 
	gÏ¡_nÚÝt
;

223 
	$exchªge
 (**
¬gv
)

225 
bÙtom
 = 
fœ¡_nÚÝt
;

226 
middË
 = 
Ï¡_nÚÝt
;

227 
tÝ
 = 
Ýtšd
;

228 *
‹m
;

235 
tÝ
 > 
middË
 && middË > 
bÙtom
)

237 ià(
tÝ
 - 
middË
 > middË - 
bÙtom
)

240 
Ën
 = 
middË
 - 
bÙtom
;

241 
i
;

244 
i
 = 0; i < 
Ën
; i++)

246 
‹m
 = 
¬gv
[
bÙtom
 + 
i
];

247 
¬gv
[
bÙtom
 + 
i
] =‡rgv[
tÝ
 - (
middË
 - bottom) + i];

248 
¬gv
[
tÝ
 - (
middË
 - 
bÙtom
è+ 
i
] = 
‹m
;

251 
tÝ
 -ð
Ën
;

256 
Ën
 = 
tÝ
 - 
middË
;

257 
i
;

260 
i
 = 0; i < 
Ën
; i++)

262 
‹m
 = 
¬gv
[
bÙtom
 + 
i
];

263 
¬gv
[
bÙtom
 + 
i
] =‡rgv[
middË
 + i];

264 
¬gv
[
middË
 + 
i
] = 
‹m
;

267 
bÙtom
 +ð
Ën
;

273 
fœ¡_nÚÝt
 +ð(
Ýtšd
 - 
Ï¡_nÚÝt
);

274 
Ï¡_nÚÝt
 = 
Ýtšd
;

275 
	}
}

280 
	$_g‘Ýt_š™Ÿlize
 (cÚ¡ *
Ýt¡ršg
)

286 
fœ¡_nÚÝt
 = 
Ï¡_nÚÝt
 = 
Ýtšd
 = 1;

288 
Ãxtch¬
 = 
NULL
;

290 
posixly_cÜ»ù
 = 
	`g‘’v
 ("POSIXLY_CORRECT");

294 ià(
Ýt¡ršg
[0] == '-')

296 
Üd”šg
 = 
RETURN_IN_ORDER
;

297 ++
Ýt¡ršg
;

299 ià(
Ýt¡ršg
[0] == '+')

301 
Üd”šg
 = 
REQUIRE_ORDER
;

302 ++
Ýt¡ršg
;

304 ià(
posixly_cÜ»ù
 !ð
NULL
)

305 
Üd”šg
 = 
REQUIRE_ORDER
;

307 
Üd”šg
 = 
PERMUTE
;

309  
Ýt¡ršg
;

310 
	}
}

369 
	$_g‘Ýt_š‹º®
 (
¬gc
, *cÚ¡ *
¬gv
, cÚ¡ *
Ýt¡ršg
, cÚ¡ 
ÝtiÚ
 *
lÚgÝts
, *
lÚgšd
, 
lÚg_Úly
)

371 
Ýrg
 = 
NULL
;

373 ià(
Ýtšd
 == 0)

374 
Ýt¡ršg
 = 
	`_g‘Ýt_š™Ÿlize
 (optstring);

376 ià(
Ãxtch¬
 =ð
NULL
 || *nextchar == '\0')

380 ià(
Üd”šg
 =ð
PERMUTE
)

385 ià(
fœ¡_nÚÝt
 !ð
Ï¡_nÚÝt
 &&†a¡_nÚÝˆ!ð
Ýtšd
)

386 
	`exchªge
 ((**è
¬gv
);

387 ià(
Ï¡_nÚÝt
 !ð
Ýtšd
)

388 
fœ¡_nÚÝt
 = 
Ýtšd
;

393 
Ýtšd
 < 
¬gc


394 && (
¬gv
[
Ýtšd
][0] != '-' ||‡rgv[optind][1] == '\0'))

395 
Ýtšd
++;

396 
Ï¡_nÚÝt
 = 
Ýtšd
;

404 ià(
Ýtšd
 !ð
¬gc
 && !
	`¡rcmp
 (
¬gv
[optind], "--"))

406 
Ýtšd
++;

408 ià(
fœ¡_nÚÝt
 !ð
Ï¡_nÚÝt
 &&†a¡_nÚÝˆ!ð
Ýtšd
)

409 
	`exchªge
 ((**è
¬gv
);

410 ià(
fœ¡_nÚÝt
 =ð
Ï¡_nÚÝt
)

411 
fœ¡_nÚÝt
 = 
Ýtšd
;

412 
Ï¡_nÚÝt
 = 
¬gc
;

414 
Ýtšd
 = 
¬gc
;

420 ià(
Ýtšd
 =ð
¬gc
)

424 ià(
fœ¡_nÚÝt
 !ð
Ï¡_nÚÝt
)

425 
Ýtšd
 = 
fœ¡_nÚÝt
;

426  
EOF
;

432 ià((
¬gv
[
Ýtšd
][0] != '-' ||‡rgv[optind][1] == '\0'))

434 ià(
Üd”šg
 =ð
REQUIRE_ORDER
)

435  
EOF
;

436 
Ýrg
 = 
¬gv
[
Ýtšd
++];

443 
Ãxtch¬
 = (
¬gv
[
Ýtšd
] + 1

444 + (
lÚgÝts
 !ð
NULL
 && 
¬gv
[
Ýtšd
][1] == '-'));

462 ià(
lÚgÝts
 !ð
NULL


463 && (
¬gv
[
Ýtšd
][1] == '-'

464 || (
lÚg_Úly
 && (
¬gv
[
Ýtšd
][2] || !
	`my_šdex
 (
Ýt¡ršg
,‡rgv[optind][1])))))

466 *
Çm“nd
;

467 cÚ¡ 
ÝtiÚ
 *
p
;

468 cÚ¡ 
ÝtiÚ
 *
pfound
 = 
NULL
;

469 
exaù
 = 0;

470 
ambig
 = 0;

471 
šdfound
=0;

472 
ÝtiÚ_šdex
;

474 
Çm“nd
 = 
Ãxtch¬
; *nameend && *nameend != '=';‚ameend++)

479 
p
 = 
lÚgÝts
, 
ÝtiÚ_šdex
 = 0;…->
Çme
;…++, option_index++)

480 ià(!
	`¡ºcmp
 (
p
->
Çme
, 
Ãxtch¬
, 
Çm“nd
 -‚extchar))

482 ià((
size_t
è(
Çm“nd
 - 
Ãxtch¬
è=ð(size_tè
	`¡¾’
 (
p
->
Çme
))

485 
pfound
 = 
p
;

486 
šdfound
 = 
ÝtiÚ_šdex
;

487 
exaù
 = 1;

490 ià(
pfound
 =ð
NULL
)

493 
pfound
 = 
p
;

494 
šdfound
 = 
ÝtiÚ_šdex
;

498 
ambig
 = 1;

501 ià(
ambig
 && !
exaù
)

503 ià(
Ý‹¼
)

504 
	`årštf
 (
¡d”r
, "%s: option `%s' is‡mbiguous\n",

505 
¬gv
[0],‡rgv[
Ýtšd
]);

506 
Ãxtch¬
 +ð
	`¡¾’
 (nextchar);

507 
Ýtšd
++;

511 ià(
pfound
 !ð
NULL
)

513 
ÝtiÚ_šdex
 = 
šdfound
;

514 
Ýtšd
++;

515 ià(*
Çm“nd
)

519 ià(
pfound
->
has_¬g
)

520 
Ýrg
 = 
Çm“nd
 + 1;

523 ià(
Ý‹¼
)

525 ià(
¬gv
[
Ýtšd
 - 1][1] == '-')

527 
	`årštf
 (
¡d”r
,

529 
¬gv
[0], 
pfound
->
Çme
);

532 
	`årštf
 (
¡d”r
,

534 
¬gv
[0],‡rgv[
Ýtšd
 - 1][0], 
pfound
->
Çme
);

536 
Ãxtch¬
 +ð
	`¡¾’
 (nextchar);

540 ià(
pfound
->
has_¬g
 == 1)

542 ià(
Ýtšd
 < 
¬gc
)

543 
Ýrg
 = 
¬gv
[
Ýtšd
++];

546 ià(
Ý‹¼
)

547 
	`årštf
 (
¡d”r
, "%s: option `%s'„equires‡n‡rgument\n",

548 
¬gv
[0],‡rgv[
Ýtšd
 - 1]);

549 
Ãxtch¬
 +ð
	`¡¾’
 (nextchar);

550  
Ýt¡ršg
[0] == ':' ? ':' : '?';

553 
Ãxtch¬
 +ð
	`¡¾’
 (nextchar);

554 ià(
lÚgšd
 !ð
NULL
)

555 *
lÚgšd
 = 
ÝtiÚ_šdex
;

556 ià(
pfound
->
æag
)

558 *(
pfound
->
æag
èðpfound->
v®
;

561  
pfound
->
v®
;

568 ià(!
lÚg_Úly
 || 
¬gv
[
Ýtšd
][1] == '-'

569 || 
	`my_šdex
 (
Ýt¡ršg
, *
Ãxtch¬
è=ð
NULL
)

571 ià(
Ý‹¼
)

573 ià(
¬gv
[
Ýtšd
][1] == '-')

575 
	`årštf
 (
¡d”r
, "%s: unrecognized option `--%s'\n",

576 
¬gv
[0], 
Ãxtch¬
);

579 
	`årštf
 (
¡d”r
, "%s: unrecognized option `%c%s'\n",

580 
¬gv
[0],‡rgv[
Ýtšd
][0], 
Ãxtch¬
);

582 
Ãxtch¬
 = (*) "";

583 
Ýtšd
++;

591 
c
 = *
Ãxtch¬
++;

592 *
‹mp
 = 
	`my_šdex
 (
Ýt¡ršg
, 
c
);

595 ià(*
Ãxtch¬
 == '\0')

596 ++
Ýtšd
;

598 ià(
‹mp
 =ð
NULL
 || 
c
 == ':')

600 ià(
Ý‹¼
)

602 ià(
posixly_cÜ»ù
)

604 
	`årštf
 (
¡d”r
, "%s: iÎeg® o±iÚ -- %c\n", 
¬gv
[0], 
c
);

606 
	`årštf
 (
¡d”r
, "%s: inv®id o±iÚ -- %c\n", 
¬gv
[0], 
c
);

608 
ÝtÝt
 = 
c
;

611 ià(
‹mp
[1] == ':')

613 ià(
‹mp
[2] == ':')

616 ià(*
Ãxtch¬
 != '\0')

618 
Ýrg
 = 
Ãxtch¬
;

619 
Ýtšd
++;

622 
Ýrg
 = 
NULL
;

623 
Ãxtch¬
 = 
NULL
;

628 ià(*
Ãxtch¬
 != '\0')

630 
Ýrg
 = 
Ãxtch¬
;

633 
Ýtšd
++;

635 ià(
Ýtšd
 =ð
¬gc
)

637 ià(
Ý‹¼
)

640 
	`årštf
 (
¡d”r
, "%s: option„equires‡n‡rgument -- %c\n",

641 
¬gv
[0], 
c
);

643 
ÝtÝt
 = 
c
;

644 ià(
Ýt¡ršg
[0] == ':')

645 
c
 = ':';

647 
c
 = '?';

652 
Ýrg
 = 
¬gv
[
Ýtšd
++];

653 
Ãxtch¬
 = 
NULL
;

656  
c
;

658 
	}
}

661 
	$g‘Ýt
 (
¬gc
, *cÚ¡ *
¬gv
, cÚ¡ *
Ýt¡ršg
)

663  
	`_g‘Ýt_š‹º®
 (
¬gc
, 
¬gv
, 
Ýt¡ršg
,

664 (cÚ¡ 
ÝtiÚ
 *) 0,

667 
	}
}

671 #ifdeà
TEST


677 
	$maš
 (
¬gc
, 
¬gv
)

678 
¬gc
;

679 **
¬gv
;

681 
c
;

682 
dig™_Ýtšd
 = 0;

686 
this_ÝtiÚ_Ýtšd
 = 
Ýtšd
 ? optind : 1;

688 
c
 = 
	`g‘Ýt
 (
¬gc
, 
¬gv
, "abc:d:0123456789");

689 ià(
c
 =ð
EOF
)

692 
c
)

704 ià(
dig™_Ýtšd
 !ð0 && dig™_Ýtšd !ð
this_ÝtiÚ_Ýtšd
)

705 
	`´štf
 ("digits occur inwo different‡rgv-elements.\n");

706 
dig™_Ýtšd
 = 
this_ÝtiÚ_Ýtšd
;

707 
	`´štf
 ("ÝtiÚ %c\n", 
c
);

711 
	`´štf
 ("option‡\n");

715 
	`´štf
 ("option b\n");

719 
	`´štf
 ("ÝtiÚ c w™h v®u`%s'\n", 
Ýrg
);

726 
	`´štf
 ("?? g‘Ýˆ»tuºed ch¬aù” cod0%Ø??\n", 
c
);

730 ià(
Ýtšd
 < 
¬gc
)

732 
	`´štf
 ("non-option ARGV-elements: ");

733 
Ýtšd
 < 
¬gc
)

734 
	`´štf
 ("% ", 
¬gv
[
Ýtšd
++]);

735 
	`´štf
 ("\n");

738 
	`ex™
 (0);

739 
	}
}

	@unittest/libmariadb/ma_getopt.h

22 #iâdeà
_GETOPT_H


23 
	#_GETOPT_H
 1

	)

25 #ifdef 
__ýlu¥lus


35 *
Ýrg
;

49 
Ýtšd
;

54 
Ý‹¼
;

58 
ÝtÝt
;

81 
	sÝtiÚ


83 #ià
defšed
 (
__STDC__
è&& __STDC__ || defšed(
__ýlu¥lus
)

84 cÚ¡ *
	gÇme
;

86 *
	gÇme
;

90 
	ghas_¬g
;

91 *
	gæag
;

92 
	gv®
;

97 
	#no_¬gum’t
 0

	)

98 
	#»quœed_¬gum’t
 1

	)

99 
	#ÝtiÚ®_¬gum’t
 2

	)

101 #iàÐ
defšed
 (
__STDC__
è&& __STDC__ ) || defšed(
__ýlu¥lus
è|| defšed(
MSDOS
)

102 #ifdeà
__EMX__


103 
g‘Ýt
 (, **, 
__cÚ¡__
 *);

104 #–ià
defšed
Ð
__GNU_LIBRARY__
)

108 
g‘Ýt
 (
¬gc
, *cÚ¡ *
¬gv
, cÚ¡ *
shÜtÝts
);

110 
g‘Ýt
 (
¬gc
, *cÚ¡ *
¬gv
, cÚ¡ *
Ýt¡ršg
);

112 
g‘Ýt_lÚg
 (
¬gc
, *cÚ¡ *
¬gv
, cÚ¡ *
shÜtÝts
,

113 cÚ¡ 
ÝtiÚ
 *
lÚgÝts
, *
lÚgšd
);

114 
g‘Ýt_lÚg_Úly
 (
¬gc
, *cÚ¡ *
¬gv
,

115 cÚ¡ *
shÜtÝts
,

116 cÚ¡ 
ÝtiÚ
 *
lÚgÝts
, *
lÚgšd
);

119 
_g‘Ýt_š‹º®
 (
¬gc
, *cÚ¡ *
¬gv
,

120 cÚ¡ *
shÜtÝts
,

121 cÚ¡ 
ÝtiÚ
 *
lÚgÝts
, *
lÚgšd
,

122 
lÚg_Úly
);

124 
g‘Ýt
 ();

125 
g‘Ýt_lÚg
 ();

126 
g‘Ýt_lÚg_Úly
 ();

128 
_g‘Ýt_š‹º®
 ();

131 #ifdef 
__ýlu¥lus


	@unittest/libmariadb/misc.c

24 
	~"my_‹¡.h
"

25 
	~"ma_commÚ.h
"

27 
	~<mysql/þ›Á_¶ugš.h
>

33 #ifdeà
_WIN32


34 
	#R_OK
 4

	)

37 
	$‹¡_bug28075
(
MYSQL
 *
mysql
)

39 
rc
;

41 
SKIP_SKYSQL
;

42 
SKIP_MAXSCALE
;

44 
rc
ð
	`mysql_dump_debug_šfo
(
mysql
);

45 
	`check_mysql_rc
(
rc
, 
mysql
);

47 
rc
ð
	`mysql_pšg
(
mysql
);

48 
	`check_mysql_rc
(
rc
, 
mysql
);

50  
OK
;

51 
	}
}

58 
	$‹¡_bug28505
(
MYSQL
 *
mysql
)

60 
»s
;

61 
rc
;

63 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxists1");

64 
	`check_mysql_rc
(
rc
, 
mysql
);

65 
rc
ð
	`mysql_qu”y
(
mysql
, "createable1(f1 int…rimary key)");

66 
	`check_mysql_rc
(
rc
, 
mysql
);

67 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into1 values(1)");

68 
	`check_mysql_rc
(
rc
, 
mysql
);

69 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into1 values(1) on duplicate key update f1=1");

70 
	`check_mysql_rc
(
rc
, 
mysql
);

71 
»s
ð
	`mysql_afãùed_rows
(
mysql
);

72 
	`FAIL_UNLESS
(!
»s
, "res != 0");

73 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable1");

74 
	`check_mysql_rc
(
rc
, 
mysql
);

75  
OK
;

76 
	}
}

83 
	$‹¡_bug29692
(
MYSQL
 *
mysql
)

85 
rc
;

86 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxists1");

87 
	`check_mysql_rc
(
rc
, 
mysql
);

88 
rc
ð
	`mysql_qu”y
(
mysql
, "createable1(f1 int)");

89 
	`check_mysql_rc
(
rc
, 
mysql
);

90 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into1 values(1)");

91 
	`check_mysql_rc
(
rc
, 
mysql
);

92 
	`FAIL_UNLESS
(1 =ð
	`mysql_afãùed_rows
(
mysql
), "affected_rows != 1");

93 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable1");

94 
	`check_mysql_rc
(
rc
, 
mysql
);

95  
OK
;

96 
	}
}

98 
	$bug31418_im¶
()

100 
my_boÞ
 
is_nuÎ
;

101 
MYSQL
 *
mysql
;

102 
rc
;

107 
mysql
ð
	`‹¡_cÚÃù
(
NULL
);

108 ià(!
mysql
)

109  
FAIL
;

117 
is_nuÎ
ð
	`qu”y_št_v¬ŸbË
(
mysql
,

119 &
rc
);

120 
	`FAIL_UNLESS
(!
is_nuÎ
 && 
rc
, "rc = 0");

122 
is_nuÎ
ð
	`qu”y_št_v¬ŸbË
(
mysql
,

124 &
rc
);

125 
	`FAIL_UNLESS
(
is_nuÎ
, "rc = 0");

133 
	`qu”y_št_v¬ŸbË
(
mysql
, "GET_LOCK('bug31418', 1)", &
rc
);

134 
	`FAIL_UNLESS
(
rc
, "rc = 0");

136 
is_nuÎ
ð
	`qu”y_št_v¬ŸbË
(
mysql
,

138 &
rc
);

139 
	`FAIL_UNLESS
(!
is_nuÎ
 && !
rc
, "rc = 0");

141 
is_nuÎ
ð
	`qu”y_št_v¬ŸbË
(
mysql
,

143 &
rc
);

144 
	`FAIL_UNLESS
(!
is_nuÎ
 && 
rc
, "rc = 0");

153 
rc
ð
	`mysql_chªge_u£r
(
mysql
, 
u£ºame
, 
·sswÜd
, 
schema
 ? schema : "test");

154 
	`check_mysql_rc
(
rc
, 
mysql
);

156 
is_nuÎ
ð
	`qu”y_št_v¬ŸbË
(
mysql
,

158 &
rc
);

159 
	`FAIL_UNLESS
(!
is_nuÎ
 && 
rc
, "rc = 0");

161 
is_nuÎ
ð
	`qu”y_št_v¬ŸbË
(
mysql
,

163 &
rc
);

164 
	`FAIL_UNLESS
(
is_nuÎ
, "rc = 0");

170 
	`mysql_þo£
(
mysql
);

171  
OK
;

172 
	}
}

174 
‹¡_bug31418
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

176 
	gi
;

177 
	gSKIP_MAXSCALE
;

179 ià(!
	gis_m¬Ÿdb
)

180  
	gSKIP
;

183 
	gi
=0; i < 3; i++)

184 ià(
bug31418_im¶
())

185  
	gFAIL
;

187  
	gOK
;

192 
	$‹¡_debug_exam¶e
(
MYSQL
 *
mysql
)

194 
rc
;

195 
MYSQL_RES
 *
»suÉ
;

198 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_debug_example");

199 
	`check_mysql_rc
(
rc
, 
mysql
);

201 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_debug_example("

204 
	`check_mysql_rc
(
rc
, 
mysql
);

206 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTOest_debug_example (name) "

208 
	`check_mysql_rc
(
rc
, 
mysql
);

210 
rc
ð
	`mysql_qu”y
(
mysql
, "UPDATEest_debug_example SET‚ame='updated' "

212 
	`check_mysql_rc
(
rc
, 
mysql
);

214 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT * FROMest_debug_example where‚ame='mysql'");

215 
	`check_mysql_rc
(
rc
, 
mysql
);

217 
»suÉ
ð
	`mysql_u£_»suÉ
(
mysql
);

218 
	`FAIL_IF
(!
»suÉ
, "Invalid„esult set");

220 
	`mysql_ãtch_row
(
»suÉ
));

221 
	`mysql_ä“_»suÉ
(
»suÉ
);

223 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLEest_debug_example");

224 
	`check_mysql_rc
(
rc
, 
mysql
);

225  
OK
;

226 
	}
}

234 
	$‹¡_äm_bug
(
MYSQL
 *
mysql
)

236 
MYSQL_STMT
 *
¡mt
;

237 
MYSQL_BIND
 
my_bšd
[2];

238 
MYSQL_RES
 *
»suÉ
;

239 
MYSQL_ROW
 
row
;

240 
FILE
 *
‹¡_fže
;

241 
d©a_dœ
[
FN_REFLEN
];

242 
‹¡_äm
[1024];

243 
rc
;

245 
	`mysql_autocomm™
(
mysql
, 
TRUE
);

247 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxistsest_frm_bug");

248 
	`check_mysql_rc
(
rc
, 
mysql
);

250 
rc
ð
	`mysql_qu”y
(
mysql
, "flushables");

251 
	`check_mysql_rc
(
rc
, 
mysql
);

253 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

254 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

255 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("show variables†ike 'datadir'"));

256 
	`check_¡mt_rc
(
rc
, 
¡mt
);

258 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

259 
	`check_¡mt_rc
(
rc
, 
¡mt
);

261 
	`mem£t
(
my_bšd
, '\0', (my_bind));

262 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

263 
my_bšd
[0].
bufãr
ð
d©a_dœ
;

264 
my_bšd
[0].
bufãr_Ëngth
ð
FN_REFLEN
;

265 
my_bšd
[1]= my_bind[0];

267 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

268 
	`check_¡mt_rc
(
rc
, 
¡mt
);

270 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

271 
	`check_¡mt_rc
(
rc
, 
¡mt
);

273 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

274 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

276 
	`¢´štf
(
‹¡_äm
, Ñe¡_äm)-1, "%s/%s/‹¡_äm_bug.äm", 
d©a_dœ
, 
schema
);

278 ià(!(
‹¡_fže
ð
	`fÝ’
(
‹¡_äm
, "w")))

280 
	`mysql_¡mt_þo£
(
¡mt
);

281 
	`dŸg
("Cª'ˆwr™tØfž% -> SKIP", 
‹¡_äm
);

282  
SKIP
;

285 
rc
ð
	`mysql_qu”y
(
mysql
, "SHOW TABLE STATUS†ike 'test_frm_bug'");

286 
	`check_mysql_rc
(
rc
, 
mysql
);

288 
»suÉ
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

289 
	`FAIL_IF
(!
»suÉ
, "Invalid„esult set");

291 
rc
= 0;

292 
	`mysql_ãtch_row
(
»suÉ
))

293 
rc
++;

294 
	`FAIL_UNLESS
(
rc
 == 1, "rowcount != 0");

296 
	`mysql_d©a_£ek
(
»suÉ
, 0);

298 
row
ð
	`mysql_ãtch_row
(
»suÉ
);

299 
	`FAIL_IF
(!
row
, "couldn't fetch„ow");

301 
	`FAIL_UNLESS
(
row
[17] != 0, "row[17] != 0");

303 
	`mysql_ä“_»suÉ
(
»suÉ
);

304 
	`mysql_¡mt_þo£
(
¡mt
);

306 
	`fþo£
(
‹¡_fže
);

307 
	`mysql_qu”y
(
mysql
, "dropable ifƒxistsest_frm_bug");

308 
	`uÆšk
(
‹¡_äm
);

309  
OK
;

310 
	}
}

312 
	$‹¡_wl4166_1
(
MYSQL
 *
mysql
)

314 
MYSQL_STMT
 *
¡mt
;

315 
št_d©a
;

316 
¡r_d©a
[50];

317 
tšy_d©a
;

318 
sm®l_d©a
;

319 
lÚglÚg
 
big_d©a
;

320 
»®_d©a
;

321 
doubË_d©a
;

322 
ulÚg
 
Ëngth
[7];

323 
my_boÞ
 
is_nuÎ
[7];

324 
MYSQL_BIND
 
my_bšd
[7];

325 cÚ¡ *
qu”y
;

326 
rc
;

327 
i
;

329 ià(
	`mysql_g‘_£rv”_v”siÚ
(
mysql
) < 50100) {

330 
	`dŸg
("Test„equires MySQL Server version 5.1 or‡bove");

331  
SKIP
;

333 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSable_4166");

334 
	`check_mysql_rc
(
rc
, 
mysql
);

336 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEable_4166(col1inyint NOT NULL, "

341 
	`check_mysql_rc
(
rc
, 
mysql
);

343 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

344 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

345 
qu”y
= "INSERT INTOable_4166(col1, col2, col3, col4, col5, col6, col7) "

347 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

348 
	`check_¡mt_rc
(
rc
, 
¡mt
);

350 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
) != 7, "param_count != 7");

352 
	`mem£t
(
my_bšd
, '\0', (my_bind));

354 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_TINY
;

355 
my_bšd
[0].
bufãr
ð(*)&
tšy_d©a
;

357 
my_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

358 
my_bšd
[1].
bufãr
ð(*)
¡r_d©a
;

359 
my_bšd
[1].
bufãr_Ëngth
= 1000;

361 
my_bšd
[2].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

362 
my_bšd
[2].
bufãr
ð(*)&
št_d©a
;

364 
my_bšd
[3].
bufãr_ty³
ð
MYSQL_TYPE_SHORT
;

365 
my_bšd
[3].
bufãr
ð(*)&
sm®l_d©a
;

367 
my_bšd
[4].
bufãr_ty³
ð
MYSQL_TYPE_LONGLONG
;

368 
my_bšd
[4].
bufãr
ð(*)&
big_d©a
;

370 
my_bšd
[5].
bufãr_ty³
ð
MYSQL_TYPE_FLOAT
;

371 
my_bšd
[5].
bufãr
ð(*)&
»®_d©a
;

373 
my_bšd
[6].
bufãr_ty³
ð
MYSQL_TYPE_DOUBLE
;

374 
my_bšd
[6].
bufãr
ð(*)&
doubË_d©a
;

376 
i
ð0; i < (è
	`¬¿y_–em’ts
(
my_bšd
); i++)

378 
my_bšd
[
i
].
Ëngth
= &length[i];

379 
my_bšd
[
i
].
is_nuÎ
= &is_null[i];

380 
is_nuÎ
[
i
]= 0;

383 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

384 
	`check_¡mt_rc
(
rc
, 
¡mt
);

386 
št_d©a
= 320;

387 
sm®l_d©a
= 1867;

388 
big_d©a
= 1000;

389 
»®_d©a
= 2;

390 
doubË_d©a
= 6578.001;

393 
tšy_d©a
= 0;iny_data < 10;iny_data++)

395 
Ëngth
[1]ð
	`¥rštf
(
¡r_d©a
, "MySQL%d", 
št_d©a
);

396 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

397 
	`check_¡mt_rc
(
rc
, 
¡mt
);

398 
št_d©a
 += 25;

399 
sm®l_d©a
 += 10;

400 
big_d©a
 += 100;

401 
»®_d©a
 += 1;

402 
doubË_d©a
 += 10.09;

407 
rc
ð
	`mysql_qu”y
(
mysql
,

409 
	`check_mysql_rc
(
rc
, 
mysql
);

416 
tšy_d©a
= 50;iny_data < 60;iny_data++)

418 
Ëngth
[1]ð
	`¥rštf
(
¡r_d©a
, "MySQL%d", 
št_d©a
);

419 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

420 
	`check_¡mt_rc
(
rc
, 
¡mt
);

421 
št_d©a
 += 25;

422 
sm®l_d©a
 += 10;

423 
big_d©a
 += 100;

424 
»®_d©a
 += 1;

425 
doubË_d©a
 += 10.09;

428 
	`mysql_¡mt_þo£
(
¡mt
);

430 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLEable_4166");

431 
	`check_mysql_rc
(
rc
, 
mysql
);

432  
OK
;

433 
	}
}

436 
	$‹¡_wl4166_2
(
MYSQL
 *
mysql
)

438 
MYSQL_STMT
 *
¡mt
;

439 
c_št
;

440 
MYSQL_TIME
 
d_d©e
;

441 
MYSQL_BIND
 
bšd_out
[2];

442 
rc
;

444 ià(
	`mysql_g‘_£rv”_v”siÚ
(
mysql
) < 50100) {

445 
	`dŸg
("Test„equires MySQL Server version 5.1 or‡bove");

446  
SKIP
;

449 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxists1");

450 
	`check_mysql_rc
(
rc
, 
mysql
);

451 
rc
ð
	`mysql_qu”y
(
mysql
, "createable1 (c_int int, d_date date)");

452 
	`check_mysql_rc
(
rc
, 
mysql
);

453 
rc
ð
	`mysql_qu”y
(
mysql
,

455 
	`check_mysql_rc
(
rc
, 
mysql
);

457 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

458 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

459 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("select * from1"));

460 
	`check_¡mt_rc
(
rc
, 
¡mt
);

462 
	`mem£t
(
bšd_out
, '\0', (bind_out));

463 
bšd_out
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

464 
bšd_out
[0].
bufãr
ð(*è&
c_št
;

466 
bšd_out
[1].
bufãr_ty³
ð
MYSQL_TYPE_DATE
;

467 
bšd_out
[1].
bufãr
ð(*è&
d_d©e
;

469 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
bšd_out
);

470 
	`check_¡mt_rc
(
rc
, 
¡mt
);

474 
rc
ð
	`mysql_qu”y
(
mysql
,

476 
	`check_mysql_rc
(
rc
, 
mysql
);

478 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

479 
	`check_¡mt_rc
(
rc
, 
¡mt
);

481 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

482 
	`check_¡mt_rc
(
rc
, 
¡mt
);

484 
	`FAIL_UNLESS
(
c_št
 == 42, "c_int != 42");

485 
	`FAIL_UNLESS
(
d_d©e
.
y—r
 == 1948, "y!=1948");

486 
	`FAIL_UNLESS
(
d_d©e
.
mÚth
 == 5, "m != 5");

487 
	`FAIL_UNLESS
(
d_d©e
.
day
 == 15, "d != 15");

489 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

490 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

494 
rc
ð
	`mysql_qu”y
(
mysql
, "update1 set c_int='abcde'");

495 
	`check_mysql_rc
(
rc
, 
mysql
);

497 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

498 
	`check_¡mt_rc
(
rc
, 
¡mt
);

500 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

501 
	`FAIL_IF
(!
rc
, "Errorƒxpected");

503 
	`FAIL_UNLESS
(
c_št
 == 0, "c != 0");

505 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

506 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

509 
rc
ð
	`mysql_qu”y
(
mysql
, "alterable1‡dd column d_int int");

510 
	`check_mysql_rc
(
rc
, 
mysql
);

512 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

513 
	`FAIL_IF
(!
rc
, "Errorƒxpected");

515 
rc
ð
	`mysql_¡mt_»£t
(
¡mt
);

516 
	`check_¡mt_rc
(
rc
, 
¡mt
);

519 
rc
ð
	`mysql_qu”y
(
mysql
, "alterable1 drop d_date, drop d_int");

520 
	`check_mysql_rc
(
rc
, 
mysql
);

521 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

522 
	`dŸg
("rc=%dƒ¼Ü: %d\n", 
rc
, 
	`mysql_¡mt_”ºo
(
¡mt
));

523 
	`FAIL_IF
(!
rc
, "Errorƒxpected");

525 
	`mysql_¡mt_þo£
(
¡mt
);

526 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable1");

527 
	`check_mysql_rc
(
rc
, 
mysql
);

529  
OK
;

530 
	}
}

538 
	$‹¡_wl4166_3
(
MYSQL
 *
mysql
)

540 
rc
;

541 
MYSQL_STMT
 *
¡mt
;

542 
MYSQL_BIND
 
my_bšd
[1];

543 
MYSQL_TIME
 
tm
[1];

545 ià(
	`mysql_g‘_£rv”_v”siÚ
(
mysql
) < 50100) {

546 
	`dŸg
("Test„equires MySQL Server version 5.1 or‡bove");

547  
SKIP
;

550 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxists1");

551 
	`check_mysql_rc
(
rc
, 
mysql
);

553 
rc
ð
	`mysql_qu”y
(
mysql
, "createable1 (year datetime)");

554 
	`check_mysql_rc
(
rc
, 
mysql
);

556 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

557 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

558 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("insert into1 (year) values (?)"));

559 
	`check_¡mt_rc
(
rc
, 
¡mt
);

561 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
) != 1, "param_count != 1");

563 
	`mem£t
(
my_bšd
, '\0', (my_bind));

564 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_DATETIME
;

565 
my_bšd
[0].
bufãr
ð&
tm
[0];

567 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

568 
	`check_¡mt_rc
(
rc
, 
¡mt
);

570 
tm
[0].
y—r
= 2014;

571 
tm
[0].
mÚth
ð1;m[0].
day
= 1;

572 
tm
[0].
hour
ð1;m[0].
mšu‹
ð1;m[0].
£cÚd
= 1;

573 
tm
[0].
£cÚd_·¹
ð0;m[0].
Ãg
= 0;

576 
rc
ð
	`mysql_qu”y
(
mysql
, "alterable1‡dd column c int");

577 
	`check_mysql_rc
(
rc
, 
mysql
);

579 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

580 
	`dŸg
("rc=%d %s", 
rc
, 
	`mysql_¡mt_”rÜ
(
¡mt
));

581 
	`check_¡mt_rc
(
rc
, 
¡mt
);

583 ià(
	`v”ify_cÞ_d©a
(
mysql
, "t1", "year", "2014-01-01 01:01:01")) {

584 
	`mysql_¡mt_þo£
(
¡mt
);

585 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable1");

586  
FAIL
;

589 
	`mysql_¡mt_þo£
(
¡mt
);

591 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable1");

592 
	`check_mysql_rc
(
rc
, 
mysql
);

593  
OK
;

594 
	}
}

603 
	$‹¡_wl4166_4
(
MYSQL
 *
mysql
)

605 
MYSQL_STMT
 *
¡mt
;

606 
rc
;

607 cÚ¡ *
¡mt_‹xt
;

608 
MYSQL_BIND
 
bšd_¬¿y
[2];

611 cÚ¡ *
koi8
= "\xee\xd5\x2c\x20\xda\xc1\x20\xd2\xd9\xc2\xc1\xcc\xcb\xd5";

612 cÚ¡ *
ý1251
= "\xcd\xf3\x2c\x20\xe7\xe0\x20\xf0\xfb\xe1\xe0\xeb\xea\xf3";

613 
buf1
[16], 
buf2
[16];

614 
ulÚg
 
buf1_Ën
, 
buf2_Ën
;

616 ià(
	`mysql_g‘_£rv”_v”siÚ
(
mysql
) < 50100) {

617 
	`dŸg
("Test„equires MySQL Server version 5.1 or‡bove");

618  
SKIP
;

621 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxists1");

622 
	`check_mysql_rc
(
rc
, 
mysql
);

629 
rc
ð
	`mysql_qu”y
(
mysql
,

631 
	`check_mysql_rc
(
rc
, 
mysql
);

632 
rc
ð
	`mysql_qu”y
(
mysql
, "set character_set_client=koi8r, "

635 
	`check_mysql_rc
(
rc
, 
mysql
);

637 
	`mem£t
(
bšd_¬¿y
, '\0', (bind_array));

639 
bšd_¬¿y
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

641 
bšd_¬¿y
[1].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

642 
bšd_¬¿y
[1].
bufãr
ð(*è
koi8
;

643 
bšd_¬¿y
[1].
bufãr_Ëngth
ð()
	`¡¾’
(
koi8
);

645 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

646 
	`check_¡mt_rc
(
rc
, 
¡mt
);

648 
¡mt_‹xt
= "insert into1 (c1, c2) values (?, ?)";

650 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

651 
	`check_¡mt_rc
(
rc
, 
¡mt
);

653 
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
bšd_¬¿y
);

655 
	`mysql_¡mt_£nd_lÚg_d©a
(
¡mt
, 0, 
koi8
, ()
	`¡¾’
(koi8));

658 
rc
ð
	`mysql_qu”y
(
mysql
, "alterable1‡dd column d int");

659 
	`check_mysql_rc
(
rc
, 
mysql
);

661 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

662 
	`check_¡mt_rc
(
rc
, 
¡mt
);

664 
¡mt_‹xt
= "select c1, c2 from1";

667 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

668 
	`check_¡mt_rc
(
rc
, 
¡mt
);

670 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

671 
	`check_¡mt_rc
(
rc
, 
¡mt
);

673 
bšd_¬¿y
[0].
bufãr
ð
buf1
;

674 
bšd_¬¿y
[0].
bufãr_Ëngth
ð(
buf1
);

675 
bšd_¬¿y
[0].
Ëngth
ð&
buf1_Ën
;

677 
bšd_¬¿y
[1].
bufãr
ð
buf2
;

678 
bšd_¬¿y
[1].
bufãr_Ëngth
ð(
buf2
);

679 
bšd_¬¿y
[1].
Ëngth
ð&
buf2_Ën
;

681 
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
bšd_¬¿y
);

683 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

684 
	`check_¡mt_rc
(
rc
, 
¡mt
);

686 
	`FAIL_UNLESS
(
buf1_Ën
 =ð
	`¡¾’
(
ý1251
), "");

687 
	`FAIL_UNLESS
(
buf2_Ën
 =ð
	`¡¾’
(
ý1251
), "");

688 
	`FAIL_UNLESS
(!
	`memcmp
(
buf1
, 
ý1251
, 
buf1_Ën
), "");

689 
	`FAIL_UNLESS
(!
	`memcmp
(
buf2
, 
ý1251
, 
buf1_Ën
), "");

691 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

692 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "");

694 
	`mysql_¡mt_þo£
(
¡mt
);

696 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable1");

697 
	`check_mysql_rc
(
rc
, 
mysql
);

698 
rc
ð
	`mysql_qu”y
(
mysql
, "set‚ames default");

699 
	`check_mysql_rc
(
rc
, 
mysql
);

700  
OK
;

701 
	}
}

707 
	$‹¡_wl4284_1
(
MYSQL
 *
mysql
)

709 
rc
;

710 
MYSQL_ROW
 
row
;

711 
MYSQL_RES
 *
»suÉ
;

713 
	`dŸg
("Testemporarily disabled");

714  
SKIP
;

716 ià(
	`mysql_g‘_£rv”_v”siÚ
(
mysql
) < 60000) {

717 
	`dŸg
("Test„equires MySQL Server version 6.0 or‡bove");

718  
SKIP
;

722 
rc
ð
	`mysql_autocomm™
(
mysql
, 
FALSE
);

723 
	`check_mysql_rc
(
rc
, 
mysql
);

725 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSrans");

726 
	`check_mysql_rc
(
rc
, 
mysql
);

728 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLErans (a INT) ENGINE=InnoDB");

730 ià(
	`mysql_”ºo
(
mysql
è=ð
ER_UNKNOWN_STORAGE_ENGINE
)

732 
	`dŸg
("InnoDB‚ot configured or‡vailable");

733  
SKIP
;

736 
	`check_mysql_rc
(
rc
, 
mysql
);

739 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTOrans VALUES(1)");

740 
	`check_mysql_rc
(
rc
, 
mysql
);

742 
rc
ð
	`mysql_»äesh
(
mysql
, 
REFRESH_GRANT
 | 
REFRESH_TABLES
);

743 
	`check_mysql_rc
(
rc
, 
mysql
);

745 
rc
ð
	`mysql_rÞlback
(
mysql
);

746 
	`check_mysql_rc
(
rc
, 
mysql
);

748 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT * FROMrans");

749 
	`check_mysql_rc
(
rc
, 
mysql
);

751 
»suÉ
ð
	`mysql_u£_»suÉ
(
mysql
);

752 
	`FAIL_IF
(!
»suÉ
, "Invalid„esult set");

754 
row
ð
	`mysql_ãtch_row
(
»suÉ
);

755 
	`FAIL_IF
(!
row
, "Can't fetch„ow");

757 
	`mysql_ä“_»suÉ
(
»suÉ
);

760 
rc
ð
	`mysql_autocomm™
(
mysql
, 
FALSE
);

761 
	`check_mysql_rc
(
rc
, 
mysql
);

763 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLErans");

764 
	`check_mysql_rc
(
rc
, 
mysql
);

766  
OK
;

767 
	}
}

769 
	$‹¡_bug49694
(
MYSQL
 *
mysql
)

771 
rc
;

772 
i
;

773 
FILE
 *
å
;

775 
SKIP_SKYSQL
;

777 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSƒnclist");

778 
	`check_mysql_rc
(
rc
, 
mysql
);

780 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE `enclist` ("

786 
	`check_mysql_rc
(
rc
, 
mysql
);

788 
å
ð
	`fÝ’
("data.csv", "w");

789 
	`FAIL_IF
(!
å
, "Can't open data.csv");

791 
i
=0; i < 100; i++)

792 
	`årštf
 (
å
, "%.08d,%d,%f\r\n", 100 + 
i
, i % 3 + 1, 60000.0 + i/100);

793 
	`fþo£
(
å
);

795 
rc
ð
	`mysql_qu”y
(
mysql
, "LOAD DATA LOCAL INFILE 'data.csv' INTO TABLEƒnclist "

797 
	`check_mysql_rc
(
rc
, 
mysql
);

799 
rc
ð
	`mysql_qu”y
(
mysql
, "DELETE FROMƒnclist");

800 
	`check_mysql_rc
(
rc
, 
mysql
);

802 
	`FAIL_IF
(
	`mysql_afãùed_rows
(
mysql
) != 100, "Import failure. Expected 2 imported„ows");

804 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLEƒnclist");

805 
	`check_mysql_rc
(
rc
, 
mysql
);

806  
OK
;

807 
	}
}

809 
	$‹¡_cÚc49
(
MYSQL
 *
mysql
)

811 
rc
;

812 
MYSQL_RES
 *
»s
;

813 
i
;

814 
FILE
 *
å
;

816 
SKIP_LOAD_INFILE_DISABLE
;

817 
SKIP_SKYSQL
;

819 
å
ð
	`fÝ’
("./sample.csv", "w");

820 
i
=1; i < 4; i++)

821 
	`årštf
(
å
, "\"%d\", \"%d\", \"%d\"\r\n", 
i
, i, i);

822 
	`fþo£
(
å
);

823 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS conc49");

824 
	`check_mysql_rc
(
rc
, 
mysql
);

825 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE conc49 (a int, b int, c int) Engine=InnoDB DEFAULT CHARSET=latin1");

826 
	`check_mysql_rc
(
rc
, 
mysql
);

827 
rc
ð
	`mysql_qu”y
(
mysql
, "LOAD DATA LOCAL INFILE './sample.csv' INTO TABLE conc49 FIELDS ESCAPED BY ' ' TERMINATED BY ',' ENCLOSED BY '\"' LINES TERMINATED BY '\r\n'");

828 
	`check_mysql_rc
(
rc
, 
mysql
);

830 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT‡ FROM conc49");

831 
	`check_mysql_rc
(
rc
, 
mysql
);

832 
»s
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

833 
rc
ð()
	`mysql_num_rows
(
»s
);

834 
	`mysql_ä“_»suÉ
(
»s
);

835 
	`FAIL_IF
(
rc
 != 3, "3„owsƒxpected");

836 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS conc49");

837 
	`check_mysql_rc
(
rc
, 
mysql
);

838  
OK
;

839 
	}
}

841 
	$‹¡_ldi_·th
(
MYSQL
 *
mysql
)

843 
rc
;

845 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

846 
	`check_mysql_rc
(
rc
, 
mysql
);

848 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE1 (a int)");

849 
	`check_mysql_rc
(
rc
, 
mysql
);

851 #ifdeà
_WIN32


852 
rc
ð
	`mysql_qu”y
(
mysql
, "LOAD DATA LOCAL INFILE 'X:/non_existing_path/data.csv' INTO TABLE1 "

855 
rc
ð
	`mysql_qu”y
(
mysql
, "LOAD DATA LOCAL INFILE '/non_existing_path/data.csv' INTO TABLE1 "

858 
	`FAIL_IF
(
rc
== 0, "Errorƒxpected");

859 
	`dŸg
("E¼Ü: %d", 
	`mysql_”ºo
(
mysql
));

860 
	`FAIL_IF
(
	`mysql_”ºo
(
mysql
) == 0, "Errorƒxpected");

862 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE1");

863 
	`check_mysql_rc
(
rc
, 
mysql
);

864  
OK
;

865 
	}
}

867 #ià
_WIN32


868 
	$‹¡_cÚc44
(
MYSQL
 *
mysql
)

870 
qu”y
[1024];

871 *
a_fž’ame
= "Ã¦Ã¸Ã¥.csv";

872 
rc
;

873 
i
;

874 
FILE
 *
å
;

876 
rc
ð
	`mysql_£t_ch¬aù”_£t
(
mysql
, "latin1");

877 
	`check_mysql_rc
(
rc
, 
mysql
);

879 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSƒnclist");

880 
	`check_mysql_rc
(
rc
, 
mysql
);

882 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE `enclist` ("

888 
	`check_mysql_rc
(
rc
, 
mysql
);

890 
å
ð
	`fÝ’
(
a_fž’ame
, "w");

891 
	`FAIL_IF
(!
å
, "Can't open file");

893 
i
=0; i < 100; i++)

894 
	`årštf
 (
å
, "%.08d,%d,%f\r\n", 100 + 
i
, i % 3 + 1, 60000.0 + i/100);

895 
	`fþo£
(
å
);

897 
	`¥rštf
(
qu”y
, "LOAD DATA LOCAL INFILE '%s' INTO TABLEƒnclist "

898 "FIELDS TERMINATED BY '.' LINES TERMINATED BY '\r\n'", 
a_fž’ame
);

899 
rc
ð
	`mysql_qu”y
(
mysql
, 
qu”y
);

900 
	`check_mysql_rc
(
rc
, 
mysql
);

902 
rc
ð
	`mysql_qu”y
(
mysql
, "DELETE FROMƒnclist");

903 
	`check_mysql_rc
(
rc
, 
mysql
);

905 
	`FAIL_IF
(
	`mysql_afãùed_rows
(
mysql
) != 100, "Import failure. Expected 2 imported„ows");

907 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLEƒnclist");

908 
	`check_mysql_rc
(
rc
, 
mysql
);

909  
OK
;

910 
	}
}

913 
	$‹¡_cÚÃù_©Œs
(
MYSQL
 *
my
)

915 
MYSQL
 *
mysql
;

916 
MYSQL_RES
 *
»suÉ
;

917 
rc
, 
Ën
;

919 
rc
ð
	`mysql_qu”y
(
my
, "SELECT * FROM…erformance_schema.session_connect_attrs LIMIT 1");

920 ià(
rc
 != 0)

922 
	`dŸg
("Server doesn't support connection‡ttributes");

923  
SKIP
;

926 
»suÉ
ð
	`mysql_¡Üe_»suÉ
(
my
);

929 ià(!
	`mysql_num_rows
(
»suÉ
))

931 
	`dŸg
("skip:…erformance_schema‚otƒnabled");

932 
	`mysql_ä“_»suÉ
(
»suÉ
);

933  
SKIP
;

935 
	`mysql_ä“_»suÉ
(
»suÉ
);

937 
mysql
ð
	`mysql_š™
(
NULL
);

939 
	`mysql_ÝtiÚs4
(
mysql
, 
MYSQL_OPT_CONNECT_ATTR_ADD
, "foo0", "bar0");

940 
	`mysql_ÝtiÚs4
(
mysql
, 
MYSQL_OPT_CONNECT_ATTR_ADD
, "foo1", "bar1");

941 
	`mysql_ÝtiÚs4
(
mysql
, 
MYSQL_OPT_CONNECT_ATTR_ADD
, "foo2", "bar2");

943 
	`FAIL_IF
(!
	`my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
, 
schema
,

944 
pÜt
, 
sock‘Çme
, 0), 
	`mysql_”rÜ
(
my
));

946 ià(!(
mysql
->
£rv”_ÿ·bž™›s
 & 
CLIENT_CONNECT_ATTRS
))

948 
	`dŸg
("Server doesn't support connection‡ttributes");

949  
SKIP
;

952 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT * FROM…erformance_schema.session_connect_attrs where‡ttr_name†ike 'foo%'");

953 
	`check_mysql_rc
(
rc
, 
mysql
);

954 
»suÉ
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

955 
rc
ð()
	`mysql_num_rows
(
»suÉ
);

956 
	`mysql_ä“_»suÉ
(
»suÉ
);

958 
	`mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_CONNECT_ATTR_RESET
, 
NULL
);

959 
	`mysql_ÝtiÚs4
(
mysql
, 
MYSQL_OPT_CONNECT_ATTR_ADD
, "foo0", "bar0");

960 
	`mysql_ÝtiÚs4
(
mysql
, 
MYSQL_OPT_CONNECT_ATTR_ADD
, "foo1", "bar1");

961 
	`mysql_ÝtiÚs4
(
mysql
, 
MYSQL_OPT_CONNECT_ATTR_ADD
, "foo2", "bar2");

962 
	`mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_CONNECT_ATTR_DELETE
, "foo0");

963 
	`mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_CONNECT_ATTR_DELETE
, "foo1");

964 
	`mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_CONNECT_ATTR_DELETE
, "foo2");

966 
Ën
ð()
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
cÚÃù_©Œs_Ën
;

968 
	`mysql_þo£
(
mysql
);

970 
	`FAIL_IF
(
rc
 < 3, "Expected 3 or more„ows");

971 
	`FAIL_IF
(
Ën
 != 0, "Expected connection_attr_len=0");

973  
OK
;

974 
	}
}

976 
	$‹¡_cÚc_114
(
MYSQL
 *
mysql
)

978 ià(
	`mysql_þ›Á_fšd_¶ugš
(
mysql
, "foo", 0))

980 
	`dŸg
("Null…ointerƒxpected");

981  
FAIL
;

983 
	`dŸg
("E¼Ü: %s", 
	`mysql_”rÜ
(
mysql
));

984  
OK
;

985 
	}
}

988 
‹¡_cÚc117
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

990 
my_boÞ
 
	g»cÚÃù
= 1;

991 
MYSQL
 *
	gmy
ð
mysql_š™
(
NULL
);

992 
	gSKIP_MAXSCALE
;

993 
FAIL_IF
(!
my_‹¡_cÚÃù
(
my
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
, 
schema
,

994 
pÜt
, 
sock‘Çme
, 0), 
mysql_”rÜ
(
my
));

996 
mysql_kžl
(
my
, 
mysql_th»ad_id
(my));

998 
mysql_ÝtiÚs
(
my
, 
MYSQL_OPT_RECONNECT
, &
»cÚÃù
);

1000 
mysql_qu”y
(
my
, "SET @a:=1");

1001 
mysql_þo£
(
my
);

1003  
	gOK
;

1006 
‹¡_»ad_timeout
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

1008 
	gtimeout
ð5, 
	grc
;

1009 
MYSQL
 *
	gmy
ð
mysql_š™
(
NULL
);

1010 
	gSKIP_MAXSCALE
;

1011 
mysql_ÝtiÚs
(
my
, 
MYSQL_OPT_READ_TIMEOUT
, &
timeout
);

1012 
FAIL_IF
(!
my_‹¡_cÚÃù
(
my
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
, 
schema
,

1013 
pÜt
, 
sock‘Çme
, 0), 
mysql_”rÜ
(
my
));

1015 
	grc
ð
mysql_qu”y
(
my
, "SELECT SLEEP(50)");

1017 
FAIL_IF
(
rc
 == 0, "errorƒxpected");

1018 
dŸg
("”rÜ: %s", 
mysql_”rÜ
(
my
));

1020 
mysql_þo£
(
my
);

1022  
	gOK
;

1025 #ifdeà
HAVE_REMOTEIO


1026 *
	g»mÙe_¶ugš
;

1027 
	$‹¡_»mÙe1
(
MYSQL
 *
mysql
)

1029 
rc
;

1030 
SKIP_SKYSQL
;

1032 
»mÙe_¶ugš
ð(*)
	`mysql_þ›Á_fšd_¶ugš
(
mysql
, "»mÙe_io", 
MARIADB_CLIENT_REMOTEIO_PLUGIN
);

1033 ià(!
»mÙe_¶ugš
)

1035 
	`dŸg
("skip -‚o„emote io…lugin‡vailable");

1036 
	`dŸg
("”rÜ: %s", 
	`mysql_”rÜ
(
mysql
));

1037  
SKIP
;

1040 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

1041 
	`check_mysql_rc
(
rc
, 
mysql
);

1043 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE1 (aext)");

1044 
	`check_mysql_rc
(
rc
, 
mysql
);

1046 
rc
ð
	`mysql_qu”y
(
mysql
, "LOAD DATA LOCAL INFILE 'http://www.example.com' INTO TABLE1");

1047 ià(
rc
 && 
	`mysql_”ºo
(
mysql
) == 2058)

1049 
	`dŸg
("remote_io…lugin‚ot‡vailable");

1050  
SKIP
;

1052 
	`check_mysql_rc
(
rc
, 
mysql
);

1053  
OK
;

1054 
	}
}

1056 
	$‹¡_»mÙe2
(
MYSQL
 *
my
)

1058 
MYSQL
 *
mysql
;

1060 ià(!
»mÙe_¶ugš
)

1062 
	`dŸg
("skip -‚o„emote io…lugin‡vailable");

1063  
SKIP
;

1065 
mysql
ð
	`mysql_š™
(
NULL
);

1067 
	`mysql_ÝtiÚs
(
mysql
, 
MYSQL_READ_DEFAULT_FILE
, "http://localhost/test.cnf");

1068 
	`mysql_ÝtiÚs
(
mysql
, 
MYSQL_READ_DEFAULT_GROUP
, "test");

1069 
	`my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
, 
schema
,

1070 0, 
sock‘Çme
, 0), 
	`mysql_”rÜ
(
my
);

1071 
	`dŸg
("pÜt: %d", 
mysql
->
pÜt
);

1072 
	`mysql_þo£
(
mysql
);

1073  
OK
;

1074 
	}
}

1077 #iâdeà
_WIN32


1078 
‹¡_mdev12965
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

1080 
MYSQL
 *
	gmysql
;

1081 
my_boÞ
 
	g»cÚÃù
 = 0;

1082 
FILE
 *
	gå
ð
NULL
;

1083 cÚ¡ *
	g’v
ð
g‘’v
("MYSQL_TMP_DIR");

1084 
	gúf_fže1
[
FN_REFLEN
 + 1];

1086 
	gSKIP_SKYSQL
;

1087 ià(
	gŒavis_‹¡
)

1088  
	gSKIP
;

1090 ià(!
	g’v
)

1091 
	g’v
= "/tmp";

1093 
£‹nv
("HOME", 
’v
, 1);

1095 
¢´štf
(
úf_fže1
, 
FN_REFLEN
, "%s%c.my.úf", 
’v
, 
FN_LIBCHAR
);

1097 
dŸg
("CÚfig fže: %s", 
úf_fže1
);

1099 
FAIL_IF
(!
acûss
(
úf_fže1
, 
R_OK
), "access");

1101 
	gmysql
ð
mysql_š™
(
NULL
);

1102 
	gå
ð
fÝ’
(
úf_fže1
, "w");

1103 
FAIL_IF
(!
å
, "fopen");

1105 
årštf
(
å
, "[client]\ndefault-character-set=latin2\nreconnect=1\n");

1106 
fþo£
(
å
);

1108 
mysql_ÝtiÚs
(
mysql
, 
MYSQL_READ_DEFAULT_GROUP
, "");

1109 
my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
,

1110 
schema
, 0, 
sock‘Çme
, 0);

1112 
»move
(
úf_fže1
);

1114 
FAIL_IF
(
¡rcmp
(
mysql_ch¬aù”_£t_Çme
(
mysql
), "latin2"), "expected charset†atin2");

1115 
mysql_g‘_ÝtiÚv
(
mysql
, 
MYSQL_OPT_RECONNECT
, &
»cÚÃù
);

1116 
FAIL_IF
(
»cÚÃù
 != 1, "expected„econnect=1");

1117 
mysql_þo£
(
mysql
);

1118  
	gOK
;

1122 
	$‹¡_g‘_šfo
(
MYSQL
 *
mysql
)

1124 
size_t
 
sv®
;

1125 
iv®
;

1126 *
cv®
;

1127 
rc
;

1128 
MY_CHARSET_INFO
 
cs
;

1129 
MARIADB_CHARSET_INFO
 *
ci
;

1130 **
”rÜs
;

1132 
rc
ð
	`m¬Ÿdb_g‘_šfov
(
mysql
, 
MARIADB_MAX_ALLOWED_PACKET
, &
sv®
);

1133 
	`FAIL_IF
(
rc
, "mysql_get_info failed");

1134 
	`dŸg
("max_®lowed_·ck‘: %lu", ()
sv®
);

1135 
rc
ð
	`m¬Ÿdb_g‘_šfov
(
mysql
, 
MARIADB_NET_BUFFER_LENGTH
, &
sv®
);

1136 
	`FAIL_IF
(
rc
, "mysql_get_info failed");

1137 
	`dŸg
("Ãt_bufãr_Ëngth: %lu", ()
sv®
);

1138 
rc
ð
	`m¬Ÿdb_g‘_šfov
(
mysql
, 
MARIADB_CLIENT_VERSION_ID
, &
sv®
);

1139 
	`FAIL_IF
(
rc
, "mysql_get_info failed");

1140 
	`dŸg
("þ›Á_v”siÚ_id: %lu", ()
sv®
);

1141 
rc
ð
	`m¬Ÿdb_g‘_šfov
(
mysql
, 
MARIADB_CONNECTION_SERVER_VERSION_ID
, &
sv®
);

1142 
	`FAIL_IF
(
rc
, "mysql_get_info failed");

1143 
	`dŸg
("£rv”_v”siÚ_id: %lu", ()
sv®
);

1144 
rc
ð
	`m¬Ÿdb_g‘_šfov
(
mysql
, 
MARIADB_CONNECTION_MARIADB_CHARSET_INFO
, &
cs
);

1145 
	`FAIL_IF
(
rc
, "mysql_get_info failed");

1146 
	`dŸg
("ch¬£ˆÇme: %s", 
cs
.
c¢ame
);

1147 
rc
ð
	`m¬Ÿdb_g‘_šfov
(
mysql
, 
MARIADB_CONNECTION_PVIO_TYPE
, &
iv®
);

1148 
	`FAIL_IF
(
rc
, "mysql_get_info failed");

1149 
	`dŸg
("cÚÃùiÚy³: %d", 
iv®
);

1150 
rc
ð
	`m¬Ÿdb_g‘_šfov
(
mysql
, 
MARIADB_CONNECTION_PROTOCOL_VERSION_ID
, &
iv®
);

1151 
	`FAIL_IF
(
rc
, "mysql_get_info failed");

1152 
	`dŸg
("´ÙocÞ_v”siÚ: %d", 
iv®
);

1153 
rc
ð
	`m¬Ÿdb_g‘_šfov
(
mysql
, 
MARIADB_CONNECTION_SERVER_TYPE
, &
cv®
);

1154 
	`FAIL_IF
(
rc
, "mysql_get_info failed");

1155 
	`dŸg
("£rv”_ty³: %s", 
cv®
);

1156 
rc
ð
	`m¬Ÿdb_g‘_šfov
(
mysql
, 
MARIADB_CONNECTION_SERVER_VERSION
, &
cv®
);

1157 
	`FAIL_IF
(
rc
, "mysql_get_info failed");

1158 
	`dŸg
("£rv”_v”siÚ: %s", 
cv®
);

1159 
rc
ð
	`m¬Ÿdb_g‘_šfov
(
mysql
, 
MARIADB_CLIENT_VERSION
, &
cv®
);

1160 
	`FAIL_IF
(
rc
, "mysql_get_info failed");

1161 
	`dŸg
("þ›Á_v”siÚ: %s", 
cv®
);

1162 
rc
ð
	`m¬Ÿdb_g‘_šfov
(
mysql
, 
MARIADB_CHARSET_NAME
, &
ci
, "utf8");

1163 
	`FAIL_IF
(
rc
, "mysql_get_info failed");

1164 
	`dŸg
("ch¬£t_Çme: %s", 
ci
->
c¢ame
);

1165 
	`dŸg
("ch¬£t_Ä: %d", 
ci
->
Ä
);

1166 
rc
ð
	`m¬Ÿdb_g‘_šfov
(
mysql
, 
MARIADB_CHARSET_ID
, &
ci
, 63);

1167 
	`FAIL_IF
(
rc
, "mysql_get_info failed");

1168 
	`dŸg
("ch¬£t_Çme: %s", 
ci
->
c¢ame
);

1169 
rc
ð
	`m¬Ÿdb_g‘_šfov
(
mysql
, 
MARIADB_CLIENT_ERRORS
, &
”rÜs
);

1170 
	`FAIL_IF
(
rc
, "mysql_get_info failed");

1171 
	`dŸg
("”rÜ[0]: %s", 
”rÜs
[0]);

1172 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IFƒxists1");

1173 
	`check_mysql_rc
(
rc
, 
mysql
);

1174 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE1 (a int)");

1175 
	`check_mysql_rc
(
rc
, 
mysql
);

1176 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTO1 VALUES (1),(2)");

1177 
	`check_mysql_rc
(
rc
, 
mysql
);

1178 
rc
ð
	`m¬Ÿdb_g‘_šfov
(
mysql
, 
MARIADB_CONNECTION_INFO
, &
cv®
);

1179 
	`FAIL_IF
(
rc
, "mysql_get_info failed");

1180 
	`dŸg
("m¬Ÿdb_šfo: %s", 
cv®
);

1181  
OK
;

1182 
	}
}

1184 
	$‹¡_z”ofžl
(
MYSQL
 *
mysql
)

1186 
rc
;

1187 
MYSQL_ROW
 
row
;

1188 
MYSQL_RES
 *
»s
;

1190 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

1191 
	`check_mysql_rc
(
rc
, 
mysql
);

1193 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE1 (a int(10) zerofill)");

1194 
	`check_mysql_rc
(
rc
, 
mysql
);

1196 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTO1 VALUES (1)");

1197 
	`check_mysql_rc
(
rc
, 
mysql
);

1199 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT‡ FROM1");

1200 
	`check_mysql_rc
(
rc
, 
mysql
);

1202 ià((
»s
ð
	`mysql_¡Üe_»suÉ
(
mysql
)))

1204 
row
ð
	`mysql_ãtch_row
(
»s
);

1205 
	`dŸg
("z”ofžl: %s", 
row
[0]);

1206 
	`mysql_ä“_»suÉ
(
»s
);

1208  
OK
;

1209 
	}
}

1211 
	$‹¡_£rv”_¡©us
(
MYSQL
 *
mysql
)

1213 
rc
;

1214 
£rv”_¡©us
;

1217 ià(
	`mysql_g‘_£rv”_v”siÚ
(
mysql
) < 100200)

1218  
SKIP
;

1222 
rc
ð
	`mysql_autocomm™
(
mysql
, 1);

1223 
	`m¬Ÿdb_g‘_šfov
(
mysql
, 
MARIADB_CONNECTION_SERVER_STATUS
, &
£rv”_¡©us
);

1224 
	`FAIL_IF
(!(
£rv”_¡©us
 & 
SERVER_STATUS_AUTOCOMMIT
),

1227 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

1228 
	`check_mysql_rc
(
rc
, 
mysql
);

1230 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE1 (a int, b int)");

1231 
	`check_mysql_rc
(
rc
, 
mysql
);

1233 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTO1 (a) VALUES (1),(2),(3),(4),(5)");

1234 
	`check_mysql_rc
(
rc
, 
mysql
);

1236 
rc
ð
	`mysql_qu”y
(
mysql
, "UPDATE1 SET‡=9 WHERE‡=8");

1237 
	`check_mysql_rc
(
rc
, 
mysql
);

1239 
	`m¬Ÿdb_g‘_šfov
(
mysql
, 
MARIADB_CONNECTION_SERVER_STATUS
, &
£rv”_¡©us
);

1240 
	`FAIL_IF
(!(
£rv”_¡©us
 & 
SERVER_QUERY_NO_INDEX_USED
), "autocommit flag‚ot set");

1242 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE SCHEMAest_tmp");

1243 
	`check_mysql_rc
(
rc
, 
mysql
);

1245 
rc
ð
	`mysql_£Ëù_db
(
mysql
, "test_tmp");

1246 
	`check_mysql_rc
(
rc
, 
mysql
);

1248 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP SCHEMAest_tmp");

1249 
	`check_mysql_rc
(
rc
, 
mysql
);

1251 
	`m¬Ÿdb_g‘_šfov
(
mysql
, 
MARIADB_CONNECTION_SERVER_STATUS
, &
£rv”_¡©us
);

1252 
	`FAIL_IF
(!(
£rv”_¡©us
 & 
SERVER_STATUS_DB_DROPPED
),

1255 
	`FAIL_IF
(!(
£rv”_¡©us
 & 
SERVER_SESSION_STATE_CHANGED
),

1258 
rc
ð
	`mysql_£Ëù_db
(
mysql
, 
schema
);

1259 
	`check_mysql_rc
(
rc
, 
mysql
);

1263  
OK
;

1264 
	}
}

1266 
	$‹¡_wl6797
(
MYSQL
 *
mysql
)

1268 
MYSQL_STMT
 *
¡mt
;

1269 
rc
;

1270 cÚ¡ *
¡mt_‹xt
;

1271 
my_ulÚglÚg
 
»s
;

1273 ià(
	`mysql_g‘_£rv”_v”siÚ
(
mysql
) < 50703 ||

1274 (
	`m¬Ÿdb_cÚÃùiÚ
(
mysql
è&& 
	`mysql_g‘_£rv”_v”siÚ
(mysql) < 100203))

1276 
	`dŸg
("Skippingest_wl6797: "

1278  
OK
;

1281 
rc
ð
	`mysql_»£t_cÚÃùiÚ
(
mysql
);

1282 
	`FAIL_UNLESS
(
rc
 == 0, "");

1285 
	`mysql_qu”y
(
mysql
, "useest");

1286 
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

1287 
	`mysql_qu”y
(
mysql
, "CREATE TABLE1 (a int)");

1289 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

1290 
¡mt_‹xt
= "INSERT INTO1 VALUES (1), (2)";

1292 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

1293 
	`check_mysql_rc
(
rc
, 
mysql
);

1296 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1297 
	`check_mysql_rc
(
rc
, 
mysql
);

1303 
rc
ð
	`mysql_»£t_cÚÃùiÚ
(
mysql
);

1304 
	`FAIL_UNLESS
(
rc
 == 0, "");

1307 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1308 
	`FAIL_IF
(
rc
 == 0, "");

1314 
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS2");

1315 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE2 (a int NOT NULL PRIMARY KEY"\

1317 
	`check_mysql_rc
(
rc
, 
mysql
);

1318 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTO2 VALUES (null)");

1319 
	`check_mysql_rc
(
rc
, 
mysql
);

1320 
»s
ð
	`mysql_š£¹_id
(
mysql
);

1321 
	`FAIL_UNLESS
(
»s
 == 1, "");

1322 
rc
ð
	`mysql_»£t_cÚÃùiÚ
(
mysql
);

1323 
	`FAIL_UNLESS
(
rc
 == 0, "");

1324 
»s
ð
	`mysql_š£¹_id
(
mysql
);

1325 
	`FAIL_UNLESS
(
»s
 == 0, "");

1327 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTO2 VALUES (last_insert_id(100))");

1328 
	`check_mysql_rc
(
rc
, 
mysql
);

1329 
»s
ð
	`mysql_š£¹_id
(
mysql
);

1330 
	`FAIL_UNLESS
(
»s
 == 100, "");

1331 
rc
ð
	`mysql_»£t_cÚÃùiÚ
(
mysql
);

1332 
	`FAIL_UNLESS
(
rc
 == 0, "");

1333 
»s
ð
	`mysql_š£¹_id
(
mysql
);

1334 
	`FAIL_UNLESS
(
»s
 == 0, "");

1336 
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

1337 
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS2");

1338 
	`mysql_¡mt_þo£
(
¡mt
);

1339  
OK
;

1340 
	}
}

1342 
‹¡_cÚc384
(
MYSQL
 *
my
 
__©Œibu‹__
((
unu£d
)))

1344 
	gv®ue
[1000];

1345 
	gËn
;

1346 
MYSQL
 *
	gmysql
ð
mysql_š™
(
NULL
);

1348 
mem£t
(&
v®ue
, 'A', 999);

1349 
	gv®ue
[999]= 0;

1351 
mysql_ÝtiÚsv
(
mysql
, 
MYSQL_OPT_CONNECT_ATTR_ADD
, "foo", 
v®ue
);

1352 
	gËn
ð()
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
cÚÃù_©Œs_Ën
;

1354 
FAIL_IF
(
Ën
 != 1006, "Wrong†ength");

1355 
mysql_ÝtiÚsv
(
mysql
, 
MYSQL_OPT_CONNECT_ATTR_DELETE
, "foo");

1356 
	gËn
ð()
mysql
->
ÝtiÚs
.
ex‹nsiÚ
->
cÚÃù_©Œs_Ën
;

1358 
FAIL_IF
(
Ën
 != 0, "Wrong†ength");

1359 
mysql_þo£
(
mysql
);

1360  
	gOK
;

1363 #iâdeà
_WIN32


1364 
‹¡_cÚc395
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

1366 
MYSQL
 *
	gmysql
;

1367 
FILE
 *
	gå
ð
NULL
;

1368 cÚ¡ *
	g’v
ð
g‘’v
("MYSQL_TMP_DIR");

1369 
	gúf_fže1
[
FN_REFLEN
 + 1];

1371 
	gSKIP_SKYSQL
;

1372 ià(
	gŒavis_‹¡
)

1373  
	gSKIP
;

1375 ià(!
	g’v
)

1376 
	g’v
= "/tmp";

1378 
£‹nv
("HOME", 
’v
, 1);

1380 
¢´štf
(
úf_fže1
, 
FN_REFLEN
, "%s%c.my.úf", 
’v
, 
FN_LIBCHAR
);

1382 
FAIL_IF
(!
acûss
(
úf_fže1
, 
R_OK
), "access");

1384 
	gmysql
ð
mysql_š™
(
NULL
);

1385 
	gå
ð
fÝ’
(
úf_fže1
, "w");

1386 
FAIL_IF
(!
å
, "fopen");

1389 
årštf
(
å
, "[client]\ndefault_character-set=latin2\n");

1390 
fþo£
(
å
);

1392 
mysql_ÝtiÚs
(
mysql
, 
MYSQL_READ_DEFAULT_GROUP
, "");

1393 
my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
,

1394 
schema
, 0, 
sock‘Çme
, 0);

1396 
»move
(
úf_fže1
);

1398 
FAIL_IF
(
¡rcmp
(
mysql_ch¬aù”_£t_Çme
(
mysql
), "latin2"), "expected charset†atin2");

1399 
mysql_þo£
(
mysql
);

1400  
	gOK
;

1403 
‹¡_s¦’fÜû
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

1405 
MYSQL
 *
	gmysql
;

1406 
FILE
 *
	gå
ð
NULL
;

1407 cÚ¡ *
	g’v
ð
g‘’v
("MYSQL_TMP_DIR");

1408 
	gúf_fže1
[
FN_REFLEN
 + 1];

1410 
	gSKIP_NOTLS
;

1411 
	gSKIP_SKYSQL
;

1413 ià(
	gŒavis_‹¡
)

1414  
	gSKIP
;

1416 ià(!
	g’v
)

1417 
	g’v
= "/tmp";

1418 
£‹nv
("HOME", 
’v
, 1);

1420 
¢´štf
(
úf_fže1
, 
FN_REFLEN
, "%s%c.my.úf", 
’v
, 
FN_LIBCHAR
);

1422 
FAIL_IF
(!
acûss
(
úf_fže1
, 
R_OK
), "access");

1424 
	gmysql
ð
mysql_š™
(
NULL
);

1425 
	gå
ð
fÝ’
(
úf_fže1
, "w");

1426 
FAIL_IF
(!
å
, "fopen");

1429 
årštf
(
å
, "[client]\nssl_enforce=1\n");

1430 
fþo£
(
å
);

1432 
mysql_ÝtiÚs
(
mysql
, 
MYSQL_READ_DEFAULT_GROUP
, "");

1433 
my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
,

1434 
schema
, 0, 
sock‘Çme
, 0);

1436 
»move
(
úf_fže1
);

1438 
FAIL_IF
(!
mysql_g‘_s¦_ch”
(
mysql
), "no secure connection");

1439 
mysql_þo£
(
mysql
);

1440  
	gOK
;

1444 
	$‹¡_cÚc457
(
MYSQL
 *
mysql
)

1446 
MYSQL_RES
 *
»suÉ
;

1448 
	`SKIP_MYSQL
(
mysql
);

1450 
»suÉ
ð
	`mysql_li¡_´oûs£s
(
mysql
);

1452 
	`FAIL_IF
(
	`mysql_f›ld_couÁ
(
mysql
) != 9, "expected 9 columns");

1453 
	`mysql_ä“_»suÉ
(
»suÉ
);

1454  
OK
;

1455 
	}
}

1457 
‹¡_cÚc458
(
MYSQL
 *
my
 
__©Œibu‹__
((
unu£d
)))

1459 
MYSQL
 *
	gmysql
ð
mysql_š™
(
NULL
);

1460 
FAIL_IF
(
mysql_g‘_timeout_v®ue
(
mysql
) != 0, "expectedimeout 0");

1461 
mysql_þo£
(
mysql
);

1462  
	gOK
;

1466 
my_‹¡s_¡
 
	gmy_‹¡s
[] = {

1467 {"‹¡_cÚc458", 
‹¡_cÚc458
, 
TEST_CONNECTION_NONE
, 0, 
NULL
, NULL},

1468 {"‹¡_cÚc457", 
‹¡_cÚc457
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1469 {"‹¡_cÚc384", 
‹¡_cÚc384
, 
TEST_CONNECTION_NONE
, 0, 
NULL
, NULL},

1470 #iâdeà
_WIN32


1471 {"‹¡_mdev12965", 
‹¡_mdev12965
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1472 {"‹¡_cÚc395", 
‹¡_cÚc395
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1473 {"‹¡_s¦’fÜû", 
‹¡_s¦’fÜû
, 
TEST_CONNECTION_NONE
, 0, 
NULL
, NULL},

1475 {"‹¡_wl6797", 
‹¡_wl6797
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1476 {"‹¡_£rv”_¡©us", 
‹¡_£rv”_¡©us
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1477 {"‹¡_»ad_timeout", 
‹¡_»ad_timeout
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1478 {"‹¡_z”ofžl", 
‹¡_z”ofžl
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1479 #ifdeà
HAVE_REMOTEIO


1480 {"‹¡_»mÙe1", 
‹¡_»mÙe1
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1481 {"‹¡_»mÙe2", 
‹¡_»mÙe2
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1483 {"‹¡_g‘_šfo", 
‹¡_g‘_šfo
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1484 {"‹¡_cÚc117", 
‹¡_cÚc117
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1485 {"‹¡_cÚc_114", 
‹¡_cÚc_114
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1486 {"‹¡_cÚÃù_©Œs", 
‹¡_cÚÃù_©Œs
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1487 {"‹¡_cÚc49", 
‹¡_cÚc49
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1488 {"‹¡_bug28075", 
‹¡_bug28075
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1489 {"‹¡_bug28505", 
‹¡_bug28505
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1490 {"‹¡_debug_exam¶e", 
‹¡_debug_exam¶e
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1491 {"‹¡_bug29692", 
‹¡_bug29692
, 
TEST_CONNECTION_NEW
, 
CLIENT_FOUND_ROWS
, 
NULL
, NULL},

1492 {"‹¡_bug31418", 
‹¡_bug31418
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1493 {"‹¡_äm_bug", 
‹¡_äm_bug
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1494 {"‹¡_wl4166_1", 
‹¡_wl4166_1
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1495 {"‹¡_wl4166_2", 
‹¡_wl4166_2
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1496 {"‹¡_wl4166_3", 
‹¡_wl4166_3
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1497 {"‹¡_wl4166_4", 
‹¡_wl4166_4
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1498 {"‹¡_wl4284_1", 
‹¡_wl4284_1
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1499 {"‹¡_bug49694", 
‹¡_bug49694
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1500 {"‹¡_ldi_·th", 
‹¡_ldi_·th
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1501 #ifdeà
_WIN32


1502 {"‹¡_cÚc44", 
‹¡_cÚc44
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1504 {
NULL
, NULL, 0, 0, NULL, 0}

1508 
	$maš
(
¬gc
, **
¬gv
)

1510 ià(
¬gc
 > 1)

1511 
	`g‘_ÝtiÚs
(
¬gc
, 
¬gv
);

1513 
	`g‘_’vv¬s
();

1515 
	`run_‹¡s
(
my_‹¡s
);

1517 (
	`ex™_¡©us
());

1518 
	}
}

	@unittest/libmariadb/my_test.h

24 
	~<ma_glob®.h
>

25 
	~<ma_sys.h
>

26 
	~<mysql.h
>

27 
	~<p.h
>

28 
	~"ma_g‘Ýt.h
"

29 
	~<memÜy.h
>

30 
	~<¡ršg.h
>

31 
	~<”rmsg.h
>

32 
	~<¡dlib.h
>

33 
	~<ma_£rv”_”rÜ.h
>

34 
	~<mysql/þ›Á_¶ugš.h
>

36 #iâdeà
WIN32


37 
	~<±h»ad.h
>

39 
	~<io.h
>

42 #iâdeà
OK


43 
	#OK
 0

	)

45 #iâdeà
FAIL


46 
	#FAIL
 1

	)

48 #iâdeà
SKIP


49 
	#SKIP
 -1

	)

51 #iâdeà
FALSE


52 
	#FALSE
 0

	)

54 #iâdeà
TRUE


55 
	#TRUE
 1

	)

58 
	#IS_SKYSQL
(
a
è(×è&& 
	`¡r¡r
(×), "db.skysql.Ãt"))

	)

59 
	#SKIP_SKYSQL
 \

60 ià(
	`IS_SKYSQL
(
ho¡Çme
)) \

62 
	`dŸg
("Not supported by SkySQL"); \

63  
SKIP
; \

64 }

	)

66 #iâdeà
HAVE_SSL


67 
	#SKIP_NOTLS
 \

69 
	`dŸg
("TLS‚ot supported"); \

70  
SKIP
;\

71 }

	)

73 
	#SKIP_NOTLS


	)

76 
	#IS_MAXSCALE
(è(
	`g‘’v
("MAXSCALE_TEST_DISABLE")!=
NULL
)

	)

77 
	#SKIP_MAXSCALE
 \

78 ià(
	`IS_MAXSCALE
()) \

80 
	`dŸg
("test disabled with maxscale"); \

81  
SKIP
; \

82 }

	)

84 
	#SKIP_LOAD_INFILE_DISABLE
 \

85 ià(!((
mysql
->
£rv”_ÿ·bž™›s
 & 
CLIENT_LOCAL_FILES
) && \

86 (
mysql
->
ÝtiÚs
.
þ›Á_æag
 & 
CLIENT_LOCAL_FILES
))) { \

87 
	`dŸg
("Load†ocal infile‚ot supported"); \

88  
SKIP
; \

89 }

	)

91 
	#MAX_KEY
 
MAX_INDEXES


	)

92 
	#MAX_KEY_LENGTH_DECIMAL_WIDTH
 4

	)

94 
	#SL
(
s
è(s), ()
	`¡¾’
((s))

	)

95 
	#SL_BIN
(
s
è(s), ()((s))

	)

97 
	#MAX_TEST_QUERY_LENGTH
 300

	)

100 
	#STMT_LEN
(
A
è(()
	`¡¾’
((A)))

	)

102 
	#SKIP_TRAVIS
()\

104 ià(
	`g‘’v
("TRAVIS"))\

106 
	`dŸg
("Skipest on Travis CI");\

107  
SKIP
;\

109 }0)

	)

111 
	#SKIP_MYSQL
(
mysql
)\

113 ià(!
	`m¬Ÿdb_cÚÃùiÚ
(
mysql
))\

115 
	`dŸg
("Skipest for‚on MariaDB server");\

116  
OK
;\

118 } 0)

	)

120 
	#check_mysql_rc
(
rc
, 
mysql
) \

122 ià(
rc
)\

124 
	`dŸg
("E¼Ü (%d): % (%dèš % lš%d", 
rc
, 
	`mysql_”rÜ
(
mysql
), \

125 
	`mysql_”ºo
(
mysql
), 
__FILE__
, 
__LINE__
);\

126 (
FAIL
);\

128 } 0)

	)

130 
	#check_¡mt_rc
(
rc
, 
¡mt
) \

132 ià(
rc
)\

134 
	`dŸg
("E¼Ü: % (%s: %d)", 
	`mysql_¡mt_”rÜ
(
¡mt
), 
__FILE__
, 
__LINE__
);\

135 (
FAIL
);\

137 } 0)

	)

139 
	#FAIL_IF
(
ex´
, 
»asÚ
)\

141 ià(
ex´
)\

143 
	`dŸg
("E¼Ü: % (%s: %d)", 
»asÚ
, 
__FILE__
, 
__LINE__
);\

144  
FAIL
;\

146 } 0)

	)

148 
	#FAIL_UNLESS
(
ex´
, 
»asÚ
)\

150 ià(!(
ex´
))\

152 
	`dŸg
("E¼Ü: % (%s: %d)", 
»asÚ
, 
__FILE__
, 
__LINE__
);\

153  
FAIL
;\

155 } 0)

	)

157 
	#SKIP_CONNECTION_HANDLER
 \

159 ià(
ho¡Çme
 && 
	`¡r¡r
(hostname, "://"))\

161 
	`dŸg
("Test skipped (connection handler)");\

162  
SKIP
;\

164 } 0)

	)

167 
	#TEST_CONNECTION_DEFAULT
 1

	)

168 
	#TEST_CONNECTION_NONE
 2

	)

169 
	#TEST_CONNECTION_NEW
 4

	)

170 
	#TEST_CONNECTION_DONT_CLOSE
 8

	)

172 
	smy_ÝtiÚ_¡


174 
mysql_ÝtiÚ
 
	mÝtiÚ
;

175 *
	mv®ue
;

178 
	smy_‹¡s_¡


180 cÚ¡ *
	mÇme
;

181 (*
	mfunùiÚ
)(
	mMYSQL
 *);

182 
	mcÚÃùiÚ
;

183 
ulÚg
 
	mcÚÃù_æags
;

184 
my_ÝtiÚ_¡
 *
	mÝtiÚs
;

185 cÚ¡ *
	mskmsg
;

188 
MYSQL
 *
my_‹¡_cÚÃù
(MYSQL *
mysql
,

189 cÚ¡ *
ho¡
,

190 cÚ¡ *
u£r
,

191 cÚ¡ *
·sswd
,

192 cÚ¡ *
db
,

193 
pÜt
,

194 cÚ¡ *
unix_sock‘
,

195 
þ›Áæag
);

197 cÚ¡ *
	gschema
 = 0;

198 *
	gho¡Çme
 = 0;

199 *
	g·sswÜd
 = 0;

200 
	gpÜt
 = 0;

201 
	gs¦_pÜt
 = 0;

202 *
	gsock‘Çme
 = 0;

203 *
	gu£ºame
 = 0;

204 
	gfÜû_Žs
= 0;

205 
uch¬
 
	gis_m¬Ÿdb
= 0;

206 *
	gthis_ho¡
= 0;

207 *
	g¶ugšdœ
= 0;

208 
	gŒavis_‹¡
= 0;

237 
	#v”ify_´•¬e_f›ld
(
»suÉ
,
no
,
Çme
,
Üg_Çme
,
ty³
,
bË
,\

238 
Üg_bË
,
db
,
Ëngth
,
def
) \

239 
	`do_v”ify_´•¬e_f›ld
((
»suÉ
),(
no
),(
Çme
),(
Üg_Çme
),(
ty³
), \

240 (
bË
),(
Üg_bË
),(
db
),(
Ëngth
),(
def
), \

241 
__FILE__
, 
__LINE__
)

	)

243 
do_v”ify_´•¬e_f›ld
(
MYSQL_RES
 *
»suÉ
,

244 
no
, cÚ¡ *
Çme
,

245 cÚ¡ *
Üg_Çme
,

246 
’um_f›ld_ty³s
 
ty³
 
__©Œibu‹__
((
unu£d
)),

247 cÚ¡ *
bË
,

248 cÚ¡ *
Üg_bË
, cÚ¡ *
db
,

249 
Ëngth
 
__©Œibu‹__
((
unu£d
)),

250 cÚ¡ *
def
 
__©Œibu‹__
((
unu£d
)),

251 cÚ¡ *
fže
 
__©Œibu‹__
((
unu£d
)),

252 
lše
 
__©Œibu‹__
((
unu£d
)))

254 
MYSQL_FIELD
 *
	gf›ld
;

257 
FAIL_IF
(!(
f›ld
ð
mysql_ãtch_f›ld_dœeù
(
»suÉ
, 
no
)), "FAILEDo get„esult");

260 
FAIL_UNLESS
(
¡rcmp
(
f›ld
->
Çme
,‚ame) == 0, "field->name differs");

261 
FAIL_UNLESS
(
¡rcmp
(
f›ld
->
Üg_Çme
, org_name) == 0, "field->org_name differs");

275 ià(
	gbË
)

276 
FAIL_UNLESS
(
¡rcmp
(
f›ld
->
bË
,able) == 0, "field->table differs");

277 ià(
	gÜg_bË
)

278 
FAIL_UNLESS
(
¡rcmp
(
f›ld
->
Üg_bË
, org_table) == 0, "field->org_table differs");

279 ià(
¡rcmp
(
f›ld
->
db
,db))

280 
dŸg
("% / %s", 
f›ld
->
db
, db);

281 
FAIL_UNLESS
(
¡rcmp
(
f›ld
->
db
, db) == 0, "field->db differs");

288  
	gOK
;

291 
	$g‘_this_ho¡
(
MYSQL
 *
mysql
)

293 
MYSQL_RES
 *
»s
;

294 
MYSQL_ROW
 
row
;

296 ià(
	`mysql_qu”y
(
mysql
, "select substr(current_user(),†ocate('@', current_user())+1)"))

299 ià((
»s
ð
	`mysql_¡Üe_»suÉ
(
mysql
)))

301 ià((
row
ð
	`mysql_ãtch_row
(
»s
)))

302 
this_ho¡
ð
	`¡rdup
(
row
[0]);

303 
	`mysql_ä“_»suÉ
(
»s
);

305 
	}
}

309 
	$my_¡mt_»suÉ
(
MYSQL
 *
mysql
, cÚ¡ *
buff
)

311 
MYSQL_STMT
 *
¡mt
;

312 
row_couÁ
= 0;

313 
rc
;

315 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

317 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
buff
, ()
	`¡¾’
(buff));

318 
	`FAIL_IF
(
rc
, 
	`mysql_¡mt_”rÜ
(
¡mt
));

320 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

321 
	`FAIL_IF
(
rc
, 
	`mysql_¡mt_”rÜ
(
¡mt
));

323 
	`mysql_¡mt_ãtch
(
¡mt
è!ð
MYSQL_NO_DATA
)

324 
row_couÁ
++;

326 
	`mysql_¡mt_þo£
(
¡mt
);

328  
row_couÁ
;

329 
	}
}

347 
	$v”ify_cÞ_d©a
(
MYSQL
 *
mysql
, cÚ¡ *
bË
, cÚ¡ *
cÞ
,

348 cÚ¡ *
exp_d©a
)

350 
qu”y
[
MAX_TEST_QUERY_LENGTH
];

351 
MYSQL_RES
 *
»suÉ
;

352 
MYSQL_ROW
 
row
;

353 
rc
;

355 ià(
bË
 && 
cÞ
)

357 
	`¥rštf
(
qu”y
, "SELECT % FROM % LIMIT 1", 
cÞ
, 
bË
);

358 
rc
ð
	`mysql_qu”y
(
mysql
, 
qu”y
);

359 
	`check_mysql_rc
(
rc
, 
mysql
);

361 
»suÉ
ð
	`mysql_u£_»suÉ
(
mysql
);

362 
	`FAIL_IF
(!
»suÉ
, "Invalid„esult set");

364 ià(!(
row
ð
	`mysql_ãtch_row
(
»suÉ
)) || !row[0]) {

365 
	`dŸg
("Failedo gethe„esult");

366 
”rÜ
;

368 if(
	`¡rcmp
(
row
[0], 
exp_d©a
)) {

369 
	`dŸg
("Ex³ùed %s, gÙ %s", 
exp_d©a
, 
row
[0]);

370 
”rÜ
;

372 
	`mysql_ä“_»suÉ
(
»suÉ
);

374  
OK
;

376 
”rÜ
:

377 
	`mysql_ä“_»suÉ
(
»suÉ
);

378  
FAIL
;

379 
	}
}

381 
my_boÞ
 
	$qu”y_št_v¬ŸbË
(
MYSQL
 *
cÚ
, cÚ¡ *
v¬_Çme
, *
v¬_v®ue
)

383 
MYSQL_RES
 *
rs
;

384 
MYSQL_ROW
 
row
;

386 
qu”y_bufãr
[
MAX_TEST_QUERY_LENGTH
];

388 
my_boÞ
 
is_nuÎ
;

390 
	`¥rštf
(
qu”y_bufãr
,

392 (cÚ¡ *è
v¬_Çme
);

394 
	`FAIL_IF
(
	`mysql_qu”y
(
cÚ
, 
qu”y_bufãr
), "Query failed");

395 
	`FAIL_UNLESS
(
rs
ð
	`mysql_¡Üe_»suÉ
(
cÚ
), "Invaliid„esult set");

396 
	`FAIL_UNLESS
(
row
ð
	`mysql_ãtch_row
(
rs
), "Nothingo fetch");

398 
is_nuÎ
ð
row
[0] =ð
NULL
;

400 ià(!
is_nuÎ
)

401 *
v¬_v®ue
ð
	`©oi
(
row
[0]);

403 
	`mysql_ä“_»suÉ
(
rs
);

405  
is_nuÎ
;

406 
	}
}

408 
	$u§ge
()

410 
	`´štf
("Executeest withhe following options:\n");

411 
	`´štf
("-h hostname\n");

412 
	`´štf
("-u username\n");

413 
	`´štf
("-p…assword\n");

414 
	`´štf
("-d database\n");

415 
	`´štf
("-S socketname\n");

416 
	`´štf
("-t force use of TLS\n");

417 
	`´štf
("-P…ort‚umber\n");

418 
	`´štf
("? displayshis help‡ndƒxits\n");

419 
	}
}

421 
	$g‘_ÝtiÚs
(
¬gc
, **
¬gv
)

423 
c
= 0;

425 (
c
=
	`g‘Ýt
(
¬gc
,
¬gv
, "h:u:p:d:w:P:S:t:?")) >= 0)

427 
c
) {

429 
ho¡Çme
ð
Ýrg
;

432 
u£ºame
ð
Ýrg
;

435 
·sswÜd
ð
Ýrg
;

438 
schema
ð
Ýrg
;

441 
pÜt
ð
	`©oi
(
Ýrg
);

442 
s¦_pÜt
=
pÜt
;

445 
sock‘Çme
ð
Ýrg
;

448 
fÜû_Žs
= 1;

451 
	`u§ge
();

452 
	`ex™
(0);

455 
	`u§ge
();

456 
	`BAIL_OUT
("UnknowÀÝtiÚ %c\n", 
c
);

459 
	}
}

462 
	$check_v¬ŸbË
(
MYSQL
 *
mysql
, cÚ¡ *
v¬ŸbË
, cÚ¡ *
v®ue
)

464 
qu”y
[
MAX_TEST_QUERY_LENGTH
];

465 
MYSQL_RES
 *
»suÉ
;

466 
MYSQL_ROW
 
row
;

468 
	`¥rštf
(
qu”y
, "SELECT %s", 
v¬ŸbË
);

469 
»suÉ
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

470 ià(!
»suÉ
)

471  
FAIL
;

473 ià((
row
 = 
	`mysql_ãtch_row
(
»suÉ
)))

474 ià(
	`¡rcmp
(
row
[0], 
v®ue
) == 0) {

475 
	`mysql_ä“_»suÉ
(
»suÉ
);

476  
OK
;

478 
	`mysql_ä“_»suÉ
(
»suÉ
);

479  
FAIL
;

480 
	}
}

488 
MYSQL
 *
	$‹¡_cÚÃù
(
my_‹¡s_¡
 *
‹¡
)

490 
MYSQL
 *
mysql
;

491 
i
ð0, 
rc
;

492 
timeout
= 10;

493 
my_boÞ
 
ŒunÿtiÚ_»pÜt
= 1;

494 ià(!(
mysql
 = 
	`mysql_š™
(
NULL
))) {

495 
	`BAIL_OUT
("Notƒnough memory‡vailable - mysql_init failed");

497 
	`mysql_ÝtiÚs
(
mysql
, 
MYSQL_REPORT_DATA_TRUNCATION
, &
ŒunÿtiÚ_»pÜt
);

498 
	`mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_CONNECT_TIMEOUT
, &
timeout
);

501 ià(
‹¡
 &&e¡->
ÝtiÚs
) {

503 
‹¡
->
ÝtiÚs
[
i
].
ÝtiÚ
)

505 ià(
	`mysql_ÝtiÚs
(
mysql
, 
‹¡
->
ÝtiÚs
[
i
].
ÝtiÚ
,e¡->ÝtiÚs[i].
v®ue
)) {

506 
	`dŸg
("Couldn'ˆ£ˆÝtiÚ %d. E¼Ü (%dè%s", 
‹¡
->
ÝtiÚs
[
i
].
ÝtiÚ
,

507 
	`mysql_”ºo
(
mysql
), 
	`mysql_”rÜ
(mysql));

508 
	`mysql_þo£
(
mysql
);

509 (
NULL
);

511 
i
++;

514 ià(!(
	`my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
,

515 
schema
, 
pÜt
, 
sock‘Çme
, (
‹¡
è?e¡->
cÚÃù_æags
:0)))

517 
	`dŸg
("Couldn'tƒstablish connectiono server %s. Error (%d): %s",

518 
ho¡Çme
, 
	`mysql_”ºo
(
mysql
), 
	`mysql_”rÜ
(mysql));

519 
	`mysql_þo£
(
mysql
);

520 (
NULL
);

524 
rc
ð
	`mysql_qu”y
(
mysql
, "SET sql_mode=''");

525 ià(
rc
)

527 
	`dŸg
("E¼Ü (%d): % (%dèš % lš%d", 
rc
, 
	`mysql_”rÜ
(
mysql
),

528 
	`mysql_”ºo
(
mysql
), 
__FILE__
, 
__LINE__
);

529 (
NULL
);

532 (
mysql
);

533 
	}
}

535 
	$»£t_cÚÃùiÚ
(
MYSQL
 *
mysql
) {

536 
rc
;

538 ià(
is_m¬Ÿdb
 && !
	`IS_MAXSCALE
())

539 
rc
ð
	`mysql_chªge_u£r
(
mysql
, 
u£ºame
, 
·sswÜd
, 
schema
);

541 
rc
ð
	`mysql_»£t_cÚÃùiÚ
(
mysql
);

542 
	`check_mysql_rc
(
rc
, 
mysql
);

543 
rc
ð
	`mysql_qu”y
(
mysql
, "SET sql_mode=''");

544 
	`check_mysql_rc
(
rc
, 
mysql
);

546  
OK
;

547 
	}
}

554 
	$g‘_’vv¬s
() {

555 *
’vv¬
;

557 ià(
	`g‘’v
("MYSQL_TEST_TRAVIS"))

558 
Œavis_‹¡
= 1;

560 ià(!
ho¡Çme
 && (
’vv¬
ð
	`g‘’v
("MYSQL_TEST_HOST")))

561 
ho¡Çme
ð
’vv¬
;

564 ià(!
u£ºame
)

566 ià((
’vv¬
ð
	`g‘’v
("MYSQL_TEST_USER")))

567 
u£ºame
ð
’vv¬
;

569 
u£ºame
= (*)"root";

571 ià(!
·sswÜd
 && (
’vv¬
ð
	`g‘’v
("MYSQL_TEST_PASSWD")))

572 
·sswÜd
ð
’vv¬
;

573 ià(!
schema
 && (
’vv¬
ð
	`g‘’v
("MYSQL_TEST_DB")))

574 
schema
ð
’vv¬
;

575 ià(!
schema
)

576 
schema
= "test";

577 ià(!
pÜt
)

579 ià((
’vv¬
ð
	`g‘’v
("MYSQL_TEST_PORT")))

580 
pÜt
ð
	`©oi
(
’vv¬
);

581 ià((
’vv¬
ð
	`g‘’v
("MASTER_MYPORT")))

582 
pÜt
ð
	`©oi
(
’vv¬
);

583 
	`dŸg
("pÜt: %d", 
pÜt
);

585 ià(!
s¦_pÜt
)

587 ià((
’vv¬
ð
	`g‘’v
("MYSQL_TEST_SSL_PORT")))

588 
s¦_pÜt
ð
	`©oi
(
’vv¬
);

590 
s¦_pÜt
 = 
pÜt
;

591 
	`dŸg
("s¦_pÜt: %d", 
s¦_pÜt
);

594 ià(!
fÜû_Žs
 && (
’vv¬
ð
	`g‘’v
("MYSQL_TEST_TLS")))

595 
fÜû_Žs
ð
	`©oi
(
’vv¬
);

596 ià(!
sock‘Çme
)

598 ià((
’vv¬
ð
	`g‘’v
("MYSQL_TEST_SOCKET")))

599 
sock‘Çme
ð
’vv¬
;

600 ià((
’vv¬
ð
	`g‘’v
("MASTER_MYSOCK")))

601 
sock‘Çme
ð
’vv¬
;

602 
	`dŸg
("sock‘Çme: %s", 
sock‘Çme
);

604 ià((
’vv¬
ð
	`g‘’v
("MYSQL_TEST_PLUGINDIR")))

605 
¶ugšdœ
ð
’vv¬
;

606 
	}
}

608 
MYSQL
 *
	$my_‹¡_cÚÃù
(
MYSQL
 *
mysql
,

609 cÚ¡ *
ho¡
,

610 cÚ¡ *
u£r
,

611 cÚ¡ *
·sswd
,

612 cÚ¡ *
db
,

613 
pÜt
,

614 cÚ¡ *
unix_sock‘
,

615 
þ›Áæag
)

617 ià(
fÜû_Žs
)

618 
	`mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_SSL_ENFORCE
, &
fÜû_Žs
);

619 ià(!
	`mysql_»®_cÚÃù
(
mysql
, 
ho¡
, 
u£r
, 
·sswd
, 
db
, 
pÜt
, 
unix_sock‘
, 
þ›Áæag
))

621 
	`dŸg
("”rÜ: %s", 
	`mysql_”rÜ
(
mysql
));

622  
NULL
;

625 ià(
mysql
 && 
fÜû_Žs
 && !
	`mysql_g‘_s¦_ch”
(mysql))

627 
	`dŸg
("Error: TLS connection‚otƒstablished");

628  
NULL
;

630 ià(!
this_ho¡
)

631 
	`g‘_this_ho¡
(
mysql
);

632  
mysql
;

633 
	}
}

636 
	$run_‹¡s
(
my_‹¡s_¡
 *
‹¡
) {

637 
i
, 
rc
, 
tÙ®
=0;

638 
MYSQL
 *
mysql
, *
mysql_deçuÉ
ð
NULL
;

640 
‹¡
[
tÙ®
].
funùiÚ
)

641 
tÙ®
++;

642 
	`¶ª
(
tÙ®
);

644 ià((
mysql_deçuÉ
ð
	`‹¡_cÚÃù
(
NULL
)))

646 
	`dŸg
("Te¡šg‡gaš¡ MySQL S”v” %s", 
	`mysql_g‘_£rv”_šfo
(
mysql_deçuÉ
));

647 
	`dŸg
("Ho¡: %s", 
	`mysql_g‘_ho¡_šfo
(
mysql_deçuÉ
));

648 
	`dŸg
("Cl›Á†ib¿ry: %s", 
	`mysql_g‘_þ›Á_šfo
());

649 
is_m¬Ÿdb
ð
	`m¬Ÿdb_cÚÃùiÚ
(
mysql_deçuÉ
);

653 
	`BAIL_OUT
("Can't connecto‡ server. Aborting....");

656 
i
=0; i < 
tÙ®
; i++) {

657 ià(!
mysql_deçuÉ
 && (
‹¡
[
i
].
cÚÃùiÚ
 & 
TEST_CONNECTION_DEFAULT
))

659 
	`dŸg
("MySQL server‚ot„unning");

660 
	`sk
(1, "%s", 
‹¡
[
i
].
Çme
);

661 } ià(!
‹¡
[
i
].
skmsg
) {

662 
mysql
ð
mysql_deçuÉ
;

663 ià(
‹¡
[
i
].
cÚÃùiÚ
 & 
TEST_CONNECTION_NEW
)

664 
mysql
ð
	`‹¡_cÚÃù
(&
‹¡
[
i
]);

665 ià(
‹¡
[
i
].
cÚÃùiÚ
 & 
TEST_CONNECTION_NONE
)

666 
mysql
ð
NULL
;

669 
rc
ð
‹¡
[
i
].
	`funùiÚ
(
mysql
);

671 ià(
rc
 =ð
SKIP
)

672 
	`sk
(1, "%s", 
‹¡
[
i
].
Çme
);

674 
	`ok
(
rc
 =ð
OK
, "%s", 
‹¡
[
i
].
Çme
);

678 ià((
rc
 =ð
FAIL
 || 
	`mysql_”ºo
(
mysql_deçuÉ
)è&& (
‹¡
[
i
].
cÚÃùiÚ
 & 
TEST_CONNECTION_DEFAULT
)) {

679 
	`mysql_þo£
(
mysql_deçuÉ
);

680 
mysql_deçuÉ
ð
	`‹¡_cÚÃù
(&
‹¡
[
i
]);

683 ià(
mysql_deçuÉ
 && (
‹¡
[
i
].
cÚÃùiÚ
 & 
TEST_CONNECTION_DEFAULT
)) {

684 ià(
	`»£t_cÚÃùiÚ
(
mysql
))

687 ià(
mysql
 && !(
‹¡
[
i
].
cÚÃùiÚ
 & 
TEST_CONNECTION_DONT_CLOSE
))

689 
	`mysql_þo£
(
mysql
);

692 
	`sk
(1, "%s", 
‹¡
[
i
].
skmsg
);

695 ià(
this_ho¡
)

696 
	`ä“
(
this_ho¡
);

698 ià(
mysql_deçuÉ
) {

699 
	`dŸg
("close default");

700 
	`mysql_þo£
(
mysql_deçuÉ
);

702 
	}
}

	@unittest/libmariadb/performance.c

23 
	~"my_‹¡.h
"

24 
	~"ma_commÚ.h
"

26 
	$³rf1
(
MYSQL
 *
mysql
)

28 
rc
;

29 
MYSQL_STMT
 *
¡mt
;

30 cÚ¡ *
¡mt¡r
= "SELECT s.emp_no, s.salary,ƒ.emp_no,ƒ.first_name,ƒ.last_name,ƒ.gender FROM salaries s,ƒmployeesƒ WHERE s.emp_no =ƒ.emp_no";

32 
rc
ð
	`mysql_£Ëù_db
(
mysql
, "employees");

33 ià(
rc
)

35 
	`dŸg
("Employees database‚ot installed");

36  
SKIP
;

39 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

41 
	`dŸg
("prepare");

42 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt¡r
));

43 
	`check_¡mt_rc
(
rc
, 
¡mt
);

45 
	`dŸg
("execute");

46 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

47 
	`check_¡mt_rc
(
rc
, 
¡mt
);

49 
	`dŸg
("store");

50 
rc
ð
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

51 
	`check_¡mt_rc
(
rc
, 
¡mt
);

53 
	`dŸg
("fetch");

54 !
	`mysql_¡mt_ãtch
(
¡mt
));

56 
	`mysql_¡mt_þo£
(
¡mt
);

57  
OK
;

58 
	}
}

60 
my_‹¡s_¡
 
	gmy_‹¡s
[] = {

61 {"³rf1", 
³rf1
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

62 {
NULL
, NULL, 0, 0, NULL, NULL}

66 
	$maš
(
¬gc
, **
¬gv
)

68 ià(
¬gc
 > 1)

69 
	`g‘_ÝtiÚs
(
¬gc
, 
¬gv
);

71 
	`g‘_’vv¬s
();

73 
	`run_‹¡s
(
my_‹¡s
);

75 (
	`ex™_¡©us
());

76 
	}
}

	@unittest/libmariadb/ps.c

24 
	~"my_‹¡.h
"

28 
	$‹¡_cÚc97
(
MYSQL
 *
mysql
)

30 
MYSQL_STMT
 *
¡mt
;

31 
rc
;

33 
	`dŸg
("Please„unhisest manually");

34  
SKIP
;

35 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

37 
	`mysql_þo£
(
mysql
);

39 
rc
ð
	`mysql_¡mt_»£t
(
¡mt
);

40 
	`FAIL_IF
(!
rc
, "Errorƒxpected while„esetting stmt");

42 
rc
ð
	`mysql_¡mt_þo£
(
¡mt
);

43 
	`check_¡mt_rc
(
rc
, 
¡mt
);

45 
mysql
ð
	`mysql_š™
(
NULL
);

47  
OK
;

48 
	}
}

50 
‹¡_cÚc83
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

52 
MYSQL_STMT
 *
	g¡mt
;

53 
	grc
;

54 
MYSQL
 *
	gmysql
ð
mysql_š™
(
NULL
);

55 
my_boÞ
 
	g»cÚÃù
= 1;

57 cÚ¡ *
	gqu”y
= "SELECT 1,2,3 FROM DUAL";

59 
	gSKIP_MAXSCALE
;

61 
	g¡mt
ð
mysql_¡mt_š™
(
mysql
);

63 
mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_RECONNECT
, &
»cÚÃù
);

64 
FAIL_IF
(!(
my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
,

65 
schema
, 
pÜt
, 
sock‘Çme
, 0)), "my_test_connect failed");

69 
	grc
ð
mysql_kžl
(
mysql
, 
mysql_th»ad_id
(mysql));

71 
	grc
ð
mysql_pšg
(
mysql
);

72 
check_mysql_rc
(
rc
, 
mysql
);

74 
	grc
ð
mysql_¡mt_´•¬e
(
¡mt
, 
SL
(
qu”y
));

75 
check_¡mt_rc
(
rc
, 
¡mt
);

76 
dŸg
("Ok");

79 
	grc
ð
mysql_kžl
(
mysql
, 
mysql_th»ad_id
(mysql));

81 
	grc
ð
mysql_¡mt_execu‹
(
¡mt
);

82 
FAIL_IF
(!
rc
, "Errorƒxpected");

84 
mysql_¡mt_þo£
(
¡mt
);

85 
mysql_þo£
(
mysql
);

86  
	gOK
;

90 
	$‹¡_cÚc60
(
MYSQL
 *
mysql
)

92 
MYSQL_STMT
 *
¡mt
;

93 
rc
;

94 cÚ¡ *
qu”y
= "SELECT * FROM‡gendas";

95 
my_boÞ
 
x
= 1;

97 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

99 
rc
ð
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_UPDATE_MAX_LENGTH
, (*)&
x
);

101 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

102 ià(
rc
 && 
	`mysql_¡mt_”ºo
(
¡mt
) == 1146) {

103 
	`dŸg
("Internalest - customer data‚ot‡vailable");

104 
	`mysql_¡mt_þo£
(
¡mt
);

105  
SKIP
;

107 
	`check_¡mt_rc
(
rc
, 
¡mt
);

109 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

110 
	`check_¡mt_rc
(
rc
, 
¡mt
);

112 
rc
ð
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

113 
	`check_¡mt_rc
(
rc
, 
¡mt
);

115 
rc
ð
	`mysql_¡mt_ä“_»suÉ
(
¡mt
);

116 
	`check_¡mt_rc
(
rc
, 
¡mt
);

118 
	`mysql_¡mt_þo£
(
¡mt
);

120  
OK
;

121 
	}
}

123 
	$‹¡_´•¬e_š£¹_upd©e
(
MYSQL
 *
mysql
)

125 
MYSQL_STMT
 *
¡mt
;

126 
rc
;

127 
i
;

128 cÚ¡ *
‹¡ÿ£
[]= {

136 
NULL
};

137 cÚ¡ **
cur_qu”y
;

139 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

140 
	`check_mysql_rc
(
rc
, 
mysql
);

142 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

143 
	`check_mysql_rc
(
rc
, 
mysql
);

145 
cur_qu”y
ð
‹¡ÿ£
; *cur_query; cur_query++)

147 
qu”y
[
MAX_TEST_QUERY_LENGTH
];

148 
	`¡rýy
(
qu”y
, *
cur_qu”y
);

149 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

150 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

151 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

152 
	`check_¡mt_rc
(
rc
, 
¡mt
);

154 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
) != 0, "Paramcount is‚ot 0");

155 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

156 
	`check_¡mt_rc
(
rc
, 
¡mt
);

159 ià(!
cur_qu”y
[1])

161 
i
=0; i < 3;i++)

163 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

164 
	`check_¡mt_rc
(
rc
, 
¡mt
);

165 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

166 
	`check_¡mt_rc
(
rc
, 
¡mt
);

169 
	`mysql_¡mt_þo£
(
¡mt
);

172 
rc
ð
	`mysql_comm™
(
mysql
);

173 
	`check_mysql_rc
(
rc
, 
mysql
);

175  
OK
;

176 
	}
}

183 
	$‹¡_bšd_d©e_cÚv
(
MYSQL
 *
mysql
, 
ušt
 
row_couÁ
)

185 
MYSQL_STMT
 *
¡mt
= 0;

186 
ušt
 
rc
, 
i
, 
couÁ
ð
row_couÁ
;

187 
MYSQL_BIND
 
my_bšd
[4];

188 
my_boÞ
 
is_nuÎ
[4]= {0,0,0,0};

189 
MYSQL_TIME
 
tm
[4];

190 
ulÚg
 
£cÚd_·¹
;

191 
ušt
 
y—r
, 
mÚth
, 
day
, 
hour
, 
mšu‹
, 
£c
;

193 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

194 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

195 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("INSERT INTOest_date VALUES(?, ?, ?, ?)"));

196 
	`check_¡mt_rc
(
rc
, 
¡mt
);

198 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
) != 4, "param_count != 4");

204 
	`mem£t
(
my_bšd
, '\0', (my_bind));

206 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_TIMESTAMP
;

207 
my_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_TIME
;

208 
my_bšd
[2].
bufãr_ty³
ð
MYSQL_TYPE_DATETIME
;

209 
my_bšd
[3].
bufãr_ty³
ð
MYSQL_TYPE_DATETIME
;

211 
i
ð0; i < (è
	`¬¿y_–em’ts
(
my_bšd
); i++)

213 
my_bšd
[
i
].
bufãr
ð(*è&
tm
[i];

214 
my_bšd
[
i
].
is_nuÎ
= &is_null[i];

215 
my_bšd
[
i
].
bufãr_Ëngth
ð(
MYSQL_TIME
);

218 
£cÚd_·¹
= 0;

220 
y—r
= 2000;

221 
mÚth
= 01;

222 
day
= 10;

224 
hour
= 11;

225 
mšu‹
= 16;

226 
£c
= 20;

228 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

229 
	`check_¡mt_rc
(
rc
, 
¡mt
);

231 
couÁ
ð0; couÁ < 
row_couÁ
; count++)

233 
i
ð0; i < (è
	`¬¿y_–em’ts
(
my_bšd
); i++)

235 
	`mem£t
(&
tm
[
i
], 0, (
MYSQL_TIME
));

236 
tm
[
i
].
Ãg
= 0;

237 
tm
[
i
].
£cÚd_·¹
ð£cÚd_·¹+
couÁ
;

238 ià(
my_bšd
[
i
].
bufãr_ty³
 !ð
MYSQL_TYPE_TIME
)

240 
tm
[
i
].
y—r
ðy—r+
couÁ
;

241 
tm
[
i
].
mÚth
ðmÚth+
couÁ
;

242 
tm
[
i
].
day
ðday+
couÁ
;

245 
tm
[
i
].
y—r
ðtm[i].
mÚth
ðtm[i].
day
= 0;

246 ià(
my_bšd
[
i
].
bufãr_ty³
 !ð
MYSQL_TYPE_DATE
)

248 
tm
[
i
].
hour
ðhour+
couÁ
;

249 
tm
[
i
].
mšu‹
ðmšu‹+
couÁ
;

250 
tm
[
i
].
£cÚd
ð
£c
+
couÁ
;

253 
tm
[
i
].
hour
ðtm[i].
mšu‹
ðtm[i].
£cÚd
= 0;

255 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

256 
	`check_¡mt_rc
(
rc
, 
¡mt
);

259 
rc
ð
	`mysql_comm™
(
mysql
);

260 
	`check_mysql_rc
(
rc
, 
mysql
);

262 
	`mysql_¡mt_þo£
(
¡mt
);

264 
rc
ð
	`my_¡mt_»suÉ
(
mysql
, "SELECT * FROMest_date");

265 
	`FAIL_UNLESS
(
row_couÁ
 =ð
rc
, "rowcount !=„c");

267 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

268 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

269 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("SELECT * FROMest_date"));

270 
	`check_¡mt_rc
(
rc
, 
¡mt
);

272 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

273 
	`check_¡mt_rc
(
rc
, 
¡mt
);

275 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

276 
	`check_¡mt_rc
(
rc
, 
¡mt
);

278 
rc
ð
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

279 
	`check_¡mt_rc
(
rc
, 
¡mt
);

281 
couÁ
ð0; couÁ < 
row_couÁ
; count++)

283 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

284 
	`FAIL_UNLESS
(
rc
 =ð0 ||„ø=ð
MYSQL_DATA_TRUNCATED
, "rc != 0 |„c != MYSQL_DATA_TRUNCATED");

286 
i
ð0; i < 
	`¬¿y_–em’ts
(
my_bšd
); i++)

288 
	`FAIL_UNLESS
(
tm
[
i
].
y—r
 =ð0 ||m[i].y—¸=ðy—r+
couÁ
, "wrong value for year");

289 
	`FAIL_UNLESS
(
tm
[
i
].
mÚth
 =ð0 ||m[i].mÚth =ðmÚth+
couÁ
, "wrong value for month");

290 
	`FAIL_UNLESS
(
tm
[
i
].
day
 =ð0 ||m[i].day =ðday+
couÁ
, "wrong value for day");

291 
	`FAIL_UNLESS
(
tm
[
i
].
hour
 =ð0 ||m[i].hou¸% 24 =ð0 ||m[i].hou¸% 24 =ðhour+
couÁ
, "wrong value for hour");

292 
	`FAIL_UNLESS
(
tm
[
i
].
mšu‹
 =ð0 ||m[i].mšu‹ =ðmšu‹+
couÁ
, "wrong value for minute");

293 
	`FAIL_UNLESS
(
tm
[
i
].
£cÚd
 =ð0 ||m[i].£cÚd =ð
£c
+
couÁ
, "wrong value for second");

294 
	`FAIL_UNLESS
(
tm
[
i
].
£cÚd_·¹
 == 0 ||

295 
tm
[
i
].
£cÚd_·¹
 =ð£cÚd_·¹+
couÁ
, "wrong value for second_part");

298 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

299 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

301 
	`mysql_¡mt_þo£
(
¡mt
);

302  
OK
;

303 
	}
}

308 
	$‹¡_´•¬e_sim¶e
(
MYSQL
 *
mysql
)

310 
MYSQL_STMT
 *
¡mt
;

311 
rc
;

312 
qu”y
[
MAX_TEST_QUERY_LENGTH
];

314 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_prepare_simple");

315 
	`check_mysql_rc
(
rc
, 
mysql
);

317 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_prepare_simple("

319 
	`check_mysql_rc
(
rc
, 
mysql
);

322 
	`¡rýy
(
qu”y
, "INSERT INTOest_prepare_simple VALUES(?, ?)");

323 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

324 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

325 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

326 
	`check_¡mt_rc
(
rc
, 
¡mt
);

328 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
) != 2, "Paramcount is‚ot 2");

329 
	`mysql_¡mt_þo£
(
¡mt
);

332 
	`¡rýy
(
qu”y
, "UPDATEest_prepare_simple SET id=? "

334 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

335 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

336 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

337 
	`check_¡mt_rc
(
rc
, 
¡mt
);

339 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
) != 3, "Paramcount is‚ot 3");

340 
	`mysql_¡mt_þo£
(
¡mt
);

343 
	`¡rýy
(
qu”y
, "DELETE FROMest_prepare_simple WHERE id=10");

344 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

345 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

346 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

347 
	`check_¡mt_rc
(
rc
, 
¡mt
);

349 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
) != 0, "Paramcount is‚ot 0");

351 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

352 
	`check_¡mt_rc
(
rc
, 
¡mt
);

353 
	`mysql_¡mt_þo£
(
¡mt
);

356 
	`¡rýy
(
qu”y
, "DELETE FROMest_prepare_simple WHERE id=?");

357 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

358 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

359 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

360 
	`check_¡mt_rc
(
rc
, 
¡mt
);

362 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
) != 1, "Paramcount != 1");

364 
	`mysql_¡mt_þo£
(
¡mt
);

367 
	`¡rýy
(
qu”y
, "SELECT * FROMest_prepare_simple WHERE id=? "

369 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

370 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

371 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

372 
	`check_¡mt_rc
(
rc
, 
¡mt
);

374 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
) != 2, "Paramcount != 2");

376 
	`mysql_¡mt_þo£
(
¡mt
);

379 
rc
ð
	`mysql_comm™
(
mysql
);

380 
	`check_mysql_rc
(
rc
, 
mysql
);

381 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_prepare_simple");

382 
	`check_mysql_rc
(
rc
, 
mysql
);

384  
OK
;

385 
	}
}

387 
	$‹¡_´•¬e_f›ld_»suÉ
(
MYSQL
 *
mysql
)

389 
MYSQL_STMT
 *
¡mt
;

390 
MYSQL_RES
 *
»suÉ
;

391 
rc
;

392 
qu”y
[
MAX_TEST_QUERY_LENGTH
];

394 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_prepare_field_result");

395 
	`check_mysql_rc
(
rc
, 
mysql
);

397 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_prepare_field_result(int_c int, "

400 
	`check_mysql_rc
(
rc
, 
mysql
);

403 
	`¡rýy
(
qu”y
, "SELECT int_c, var_c, date_c‡s date,s_c, char_c FROM "

405 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

406 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

407 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

408 
	`check_¡mt_rc
(
rc
, 
¡mt
);

410 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
) != 1, "Paramcount != 1");

412 
»suÉ
ð
	`mysql_¡mt_»suÉ_m‘ad©a
(
¡mt
);

413 
	`FAIL_IF
(!
»suÉ
, 
	`mysql_¡mt_”rÜ
(
¡mt
));

415 ià(
	`v”ify_´•¬e_f›ld
(
»suÉ
, 0, "št_c", "št_c", 
MYSQL_TYPE_LONG
,

416 "t1", "‹¡_´•¬e_f›ld_»suÉ", 
schema
, 11, 0))

417 
”rÜ
;

418 ià(
	`v”ify_´•¬e_f›ld
(
»suÉ
, 1, "v¬_c", "v¬_c", 
MYSQL_TYPE_VAR_STRING
,

419 "t1", "‹¡_´•¬e_f›ld_»suÉ", 
schema
, 50, 0))

420 
”rÜ
;

421 ià(
	`v”ify_´•¬e_f›ld
(
»suÉ
, 2, "d©e", "d©e_c", 
MYSQL_TYPE_DATE
,

422 "t1", "‹¡_´•¬e_f›ld_»suÉ", 
schema
, 10, 0))

423 
”rÜ
;

424 ià(
	`v”ify_´•¬e_f›ld
(
»suÉ
, 3, "ts_c", "ts_c", 
MYSQL_TYPE_TIMESTAMP
,

425 "t1", "‹¡_´•¬e_f›ld_»suÉ", 
schema
, 19, 0))

426 
”rÜ
;

427 ià(
	`v”ify_´•¬e_f›ld
(
»suÉ
, 4, "char_c", "char_c",

428 (
	`mysql_g‘_£rv”_v”siÚ
(
mysql
) <= 50000 ?

429 
MYSQL_TYPE_VAR_STRING
 : 
MYSQL_TYPE_STRING
),

430 "t1", "‹¡_´•¬e_f›ld_»suÉ", 
schema
, 4, 0))

431 
”rÜ
;

433 
	`FAIL_IF
(
	`mysql_num_f›lds
(
»suÉ
) != 5, "Paramcount != 5");

434 
	`mysql_ä“_»suÉ
(
»suÉ
);

435 
	`mysql_¡mt_þo£
(
¡mt
);

436 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_prepare_field_result");

437 
	`check_mysql_rc
(
rc
, 
mysql
);

439  
OK
;

441 
”rÜ
:

442 
	`mysql_ä“_»suÉ
(
»suÉ
);

443 
	`mysql_¡mt_þo£
(
¡mt
);

444  
FAIL
;

445 
	}
}

450 
	$‹¡_´•¬e_syÁax
(
MYSQL
 *
mysql
)

452 
MYSQL_STMT
 *
¡mt
;

453 
rc
;

454 
qu”y
[
MAX_TEST_QUERY_LENGTH
];

456 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_prepare_syntax");

457 
	`check_mysql_rc
(
rc
, 
mysql
);

459 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_prepare_syntax("

461 
	`check_mysql_rc
(
rc
, 
mysql
);

463 
rc
ð
	`mysql_qu”y
(
mysql
, "FLUSH TABLES");

464 
	`check_mysql_rc
(
rc
, 
mysql
);

466 
rc
ð
	`mysql_qu”y
(
mysql
, "START TRANSACTION");

467 
	`check_mysql_rc
(
rc
, 
mysql
);

469 
	`¡rýy
(
qu”y
, "INSERT INTOest_prepare_syntax VALUES(?");

470 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

471 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

472 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

473 
	`FAIL_IF
(!
rc
, "errorƒxpected");

475 
	`¡rýy
(
qu”y
, "SELECT id,‚ame FROMest_prepare_syntax WHERE id=? AND WHERE");

476 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

477 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

478 
	`FAIL_IF
(!
rc
, "errorƒxpected");

481 
rc
ð
	`mysql_comm™
(
mysql
);

482 
	`check_mysql_rc
(
rc
, 
mysql
);

484 
	`mysql_¡mt_þo£
(
¡mt
);

485 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_prepare_syntax");

486 
	`check_mysql_rc
(
rc
, 
mysql
);

488  
OK
;

489 
	}
}

491 
	$‹¡_´•¬e
(
MYSQL
 *
mysql
)

493 
MYSQL_STMT
 *
¡mt
;

494 
rc
, 
i
;

495 
št_d©a
, 
o_št_d©a
;

496 
¡r_d©a
[50], 
d©a
[50];

497 
tšy_d©a
, 
o_tšy_d©a
;

498 
sm®l_d©a
, 
o_sm®l_d©a
;

499 
lÚglÚg
 
big_d©a
, 
o_big_d©a
;

500 
»®_d©a
, 
o_»®_d©a
;

501 
doubË_d©a
, 
o_doubË_d©a
;

502 
ulÚg
 
Ëngth
[7], 
Ën
;

503 
my_boÞ
 
is_nuÎ
[7];

504 
MYSQL_BIND
 
my_bšd
[7];

505 
qu”y
[
MAX_TEST_QUERY_LENGTH
];

507 
rc
ð
	`mysql_autocomm™
(
mysql
, 
TRUE
);

508 
	`check_mysql_rc
(
rc
, 
mysql
);

510 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS my_prepare");

511 
	`check_mysql_rc
(
rc
, 
mysql
);

513 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE my_prepare(col1inyint, "

517 
	`check_mysql_rc
(
rc
, 
mysql
);

520 
	`¡rýy
(
qu”y
, "INSERT INTO my_prepare VALUES(?, ?, ?, ?, ?, ?, ?)");

521 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

522 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

523 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

524 
	`check_¡mt_rc
(
rc
, 
¡mt
);

526 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
) != 7, "Paramcount != 7");

528 
	`mem£t
(
my_bšd
, '\0', (my_bind));

531 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_TINY
;

532 
my_bšd
[0].
bufãr
ð(*)&
tšy_d©a
;

534 
my_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

535 
my_bšd
[1].
bufãr
ð(*)
¡r_d©a
;

536 
my_bšd
[1].
bufãr_Ëngth
= 1000;

538 
my_bšd
[2].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

539 
my_bšd
[2].
bufãr
ð(*)&
št_d©a
;

541 
my_bšd
[3].
bufãr_ty³
ð
MYSQL_TYPE_SHORT
;

542 
my_bšd
[3].
bufãr
ð(*)&
sm®l_d©a
;

544 
my_bšd
[4].
bufãr_ty³
ð
MYSQL_TYPE_LONGLONG
;

545 
my_bšd
[4].
bufãr
ð(*)&
big_d©a
;

547 
my_bšd
[5].
bufãr_ty³
ð
MYSQL_TYPE_FLOAT
;

548 
my_bšd
[5].
bufãr
ð(*)&
»®_d©a
;

550 
my_bšd
[6].
bufãr_ty³
ð
MYSQL_TYPE_DOUBLE
;

551 
my_bšd
[6].
bufãr
ð(*)&
doubË_d©a
;

553 
i
ð0; i < (è
	`¬¿y_–em’ts
(
my_bšd
); i++)

555 
my_bšd
[
i
].
Ëngth
= &length[i];

556 
my_bšd
[
i
].
is_nuÎ
= &is_null[i];

557 
is_nuÎ
[
i
]= 0;

560 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

561 
	`check_¡mt_rc
(
rc
, 
¡mt
);

563 
št_d©a
= 320;

564 
sm®l_d©a
= 1867;

565 
big_d©a
= 1000;

566 
»®_d©a
= 2;

567 
doubË_d©a
= 6578.001;

570 
tšy_d©a
= 0;iny_data < 100;iny_data++)

572 
Ëngth
[1]ð
	`¥rštf
(
¡r_d©a
, "MySQL%d", 
št_d©a
);

573 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

574 
	`check_¡mt_rc
(
rc
, 
¡mt
);

575 
št_d©a
 += 25;

576 
sm®l_d©a
 += 10;

577 
big_d©a
 += 100;

578 
»®_d©a
 += 1;

579 
doubË_d©a
 += 10.09;

582 
	`mysql_¡mt_þo£
(
¡mt
);

585 
rc
ð
	`mysql_comm™
(
mysql
);

586 
	`check_mysql_rc
(
rc
, 
mysql
);

589 
rc
ð
	`my_¡mt_»suÉ
(
mysql
, "SELECT * FROM my_prepare");

590 
	`FAIL_UNLESS
(
rc
 != 1, "rowcount != 1");

592 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

593 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

594 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, "SELECT * FROM my_prepare", 25);

595 
	`check_¡mt_rc
(
rc
, 
¡mt
);

597 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

598 
	`check_¡mt_rc
(
rc
, 
¡mt
);

601 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

602 
	`check_¡mt_rc
(
rc
, 
¡mt
);

604 
o_št_d©a
= 320;

605 
o_sm®l_d©a
= 1867;

606 
o_big_d©a
= 1000;

607 
o_»®_d©a
= 2;

608 
o_doubË_d©a
= 6578.001;

611 
o_tšy_d©a
= 0; o_tiny_data < 100; o_tiny_data++)

613 
Ën
ð
	`¥rštf
(
d©a
, "MySQL%d", 
o_št_d©a
);

615 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

616 
	`check_¡mt_rc
(
rc
, 
¡mt
);

618 
	`FAIL_UNLESS
(
tšy_d©a
 =ð
o_tšy_d©a
, "Wrong value foriny_data");

619 
	`FAIL_UNLESS
(
is_nuÎ
[0] == 0, "Wrong value for is_null");

620 
	`FAIL_UNLESS
(
Ëngth
[0] == 1, "length != 0");

622 
	`FAIL_UNLESS
(
št_d©a
 =ð
o_št_d©a
, "Wrong value for int_data");

623 
	`FAIL_UNLESS
(
Ëngth
[2] == 4, "length != 4");

625 
	`FAIL_UNLESS
(
sm®l_d©a
 =ð
o_sm®l_d©a
, "Wrong value for small_data");

626 
	`FAIL_UNLESS
(
Ëngth
[3] == 2, "length != 2");

628 
	`FAIL_UNLESS
(
big_d©a
 =ð
o_big_d©a
, "Wrong value for big_data");

629 
	`FAIL_UNLESS
(
Ëngth
[4] == 8, "length != 8");

631 
	`FAIL_UNLESS
(
»®_d©a
 =ð
o_»®_d©a
, "Wrong value for„eal_data");

632 
	`FAIL_UNLESS
(
Ëngth
[5] == 4, "length != 4");

634 
	`FAIL_UNLESS
(
doubË_d©a
 =ð
o_doubË_d©a
, "Wrong value for double_data");

635 
	`FAIL_UNLESS
(
Ëngth
[6] == 8, "length != 8");

637 
	`FAIL_UNLESS
(
	`¡rcmp
(
d©a
, 
¡r_d©a
) == 0, "Wrong value for data");

638 
	`FAIL_UNLESS
(
Ëngth
[1] =ð
Ën
, "length !=†en");

640 
o_št_d©a
 += 25;

641 
o_sm®l_d©a
 += 10;

642 
o_big_d©a
 += 100;

643 
o_»®_d©a
 += 1;

644 
o_doubË_d©a
 += 10.09;

647 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

648 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "MYSQL_NO_DATAƒxpected");

650 
	`mysql_¡mt_þo£
(
¡mt
);

651 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS my_prepare");

652 
	`check_mysql_rc
(
rc
, 
mysql
);

654  
OK
;

655 
	}
}

657 
	$‹¡_´•¬e_muÉi_¡©em’ts
(
MYSQL
 *
mysql
)

659 
MYSQL_STMT
 *
¡mt
;

660 
qu”y
[
MAX_TEST_QUERY_LENGTH
];

661 
rc
;

663 
	`¡rýy
(
qu”y
, "select 1; select 'another value'");

665 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

666 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

667 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

668 
	`FAIL_IF
(!
rc
, "Errorƒxpected");

670 
	`mysql_¡mt_þo£
(
¡mt
);

672  
OK
;

673 
	}
}

675 
	$‹¡_´•¬e_ext
(
MYSQL
 *
mysql
)

677 
MYSQL_STMT
 *
¡mt
;

678 
rc
;

679 *
sql
;

680 
nD©a
= 1;

681 
tD©a
= 1;

682 
sD©a
= 10;

683 
lÚglÚg
 
bD©a
= 20;

684 
rowcouÁ
= 0;

685 
MYSQL_BIND
 
my_bšd
[6];

686 
qu”y
[
MAX_TEST_QUERY_LENGTH
];

688 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_prepare_ext");

689 
	`check_mysql_rc
(
rc
, 
mysql
);

691 
sql
= (*)"CREATE TABLEest_prepare_ext"

726 
rc
ð
	`mysql_qu”y
(
mysql
, 
sql
);

727 
	`check_mysql_rc
(
rc
, 
mysql
);

730 
	`¡rýy
(
qu”y
, "INSERT INTOest_prepare_ext(c1, c2, c3, c4, c5, c6) VALUES(?, ?, ?, ?, ?, ?)");

731 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

732 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

733 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

734 
	`check_¡mt_rc
(
rc
, 
¡mt
);

736 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
) != 6, "Paramcount != 6");

738 
	`mem£t
(
my_bšd
, '\0', (my_bind));

741 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_TINY
;

742 
my_bšd
[0].
bufãr
ð(*)&
tD©a
;

745 
my_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_SHORT
;

746 
my_bšd
[1].
bufãr
ð(*)&
sD©a
;

749 
my_bšd
[2].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

750 
my_bšd
[2].
bufãr
ð(*)&
nD©a
;

753 
my_bšd
[3].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

754 
my_bšd
[3].
bufãr
ð(*)&
nD©a
;

757 
my_bšd
[4].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

758 
my_bšd
[4].
bufãr
ð(*)&
nD©a
;

761 
my_bšd
[5].
bufãr_ty³
ð
MYSQL_TYPE_LONGLONG
;

762 
my_bšd
[5].
bufãr
ð(*)&
bD©a
;

764 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

765 
	`check_¡mt_rc
(
rc
, 
¡mt
);

770 
nD©a
ð0;‚D©a<10;‚D©a++, 
tD©a
++, 
sD©a
++, 
bD©a
++)

772 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

773 
	`check_¡mt_rc
(
rc
, 
¡mt
);

775 
	`mysql_¡mt_þo£
(
¡mt
);

779 
	`¡rýy
(
qu”y
, "SELECT c1, c2, c3, c4, c5, c6 FROMest_prepare_ext");

780 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

781 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

782 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

783 
	`check_¡mt_rc
(
rc
, 
¡mt
);

786 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

787 
	`check_¡mt_rc
(
rc
, 
¡mt
);

789 
	`mysql_¡mt_ãtch
(
¡mt
è!ð
MYSQL_NO_DATA
)

790 
rowcouÁ
++;

792 
	`FAIL_UNLESS
(
nD©a
 =ð
rowcouÁ
, "Invalid„owcount");

794 
	`mysql_¡mt_þo£
(
¡mt
);

795 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_prepare_ext");

796 
	`check_mysql_rc
(
rc
, 
mysql
);

798  
OK
;

799 
	}
}

801 
	$‹¡_´•¬e_®‹r
(
MYSQL
 *
mysql
)

803 
MYSQL_STMT
 *
¡mt
;

804 
MYSQL
 *
mysql_Ãw
;

805 
rc
, 
id
;

806 
MYSQL_BIND
 
my_bšd
[1];

807 
my_boÞ
 
is_nuÎ
;

808 
qu”y
[
MAX_TEST_QUERY_LENGTH
];

810 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_prep_alter");

811 
	`check_mysql_rc
(
rc
, 
mysql
);

813 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_prep_alter(id int,‚ame char(20))");

814 
	`check_mysql_rc
(
rc
, 
mysql
);

816 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTOest_prep_alter values(10, 'venu'), (20, 'mysql')");

817 
	`check_mysql_rc
(
rc
, 
mysql
);

819 
	`¡rýy
(
qu”y
, "INSERT INTOest_prep_alter VALUES(?, 'monty')");

820 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

821 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

822 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

823 
	`check_¡mt_rc
(
rc
, 
¡mt
);

825 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
) != 1, "Paramcount != 1");

827 
	`mem£t
(
my_bšd
, '\0', (my_bind));

829 
is_nuÎ
= 0;

830 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_SHORT
;

831 
my_bšd
[0].
bufãr
ð(*)&
id
;

832 
my_bšd
[0].
is_nuÎ
= &is_null;

834 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

835 
	`check_¡mt_rc
(
rc
, 
¡mt
);

837 
id
= 30;

838 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

839 
	`check_¡mt_rc
(
rc
, 
¡mt
);

841 
mysql_Ãw
ð
	`mysql_š™
(
NULL
);

842 
	`FAIL_IF
(!
mysql_Ãw
, "mysql_init failed");

843 
	`FAIL_IF
(!(
	`my_‹¡_cÚÃù
(
mysql_Ãw
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
,

844 
schema
, 
pÜt
, 
sock‘Çme
, 0)), "my_test_connect failed");

845 
rc
ð
	`mysql_qu”y
(
mysql_Ãw
, "ALTER TABLEest_prep_alter change id id_new varchar(20)");

846 
	`dŸg
("E¼Ü: %d %s", 
	`mysql_”ºo
(
mysql_Ãw
), 
	`mysql_”rÜ
(mysql_new));

847 
	`check_mysql_rc
(
rc
, 
mysql_Ãw
);

848 
	`mysql_þo£
(
mysql_Ãw
);

850 
is_nuÎ
= 1;

851 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

852 
	`check_¡mt_rc
(
rc
, 
¡mt
);

854 
rc
ð
	`my_¡mt_»suÉ
(
mysql
, "SELECT * FROMest_prep_alter");

855 
	`FAIL_UNLESS
(
rc
 == 4, "rowcount != 4");

857 
	`mysql_¡mt_þo£
(
¡mt
);

858 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_prep_alter");

859 
	`check_mysql_rc
(
rc
, 
mysql
);

861  
OK
;

862 
	}
}

864 
	$‹¡_´•¬e_»suÉ£t
(
MYSQL
 *
mysql
)

866 
MYSQL_STMT
 *
¡mt
;

867 
rc
;

868 
MYSQL_RES
 *
»suÉ
;

869 
qu”y
[
MAX_TEST_QUERY_LENGTH
];

871 
rc
ð
	`mysql_autocomm™
(
mysql
, 
TRUE
);

872 
	`check_mysql_rc
(
rc
, 
mysql
);

874 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_prepare_resultset");

875 
	`check_mysql_rc
(
rc
, 
mysql
);

877 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_prepare_resultset(id int, \
 varchar(50),ƒxtra double)");

879 
	`check_mysql_rc
(
rc
, 
mysql
);

881 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

882 
	`¡rýy
(
qu”y
, "SELECT * FROMest_prepare_resultset");

883 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

884 
	`check_¡mt_rc
(
rc
, 
¡mt
);

886 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
), "Paramcount != 0");

888 
»suÉ
ð
	`mysql_¡mt_»suÉ_m‘ad©a
(
¡mt
);

889 
	`FAIL_IF
(!
»suÉ
, "Invalid„esultset");

890 
	`mysql_ä“_»suÉ
(
»suÉ
);

891 
	`mysql_¡mt_þo£
(
¡mt
);

892 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_prepare_resultset");

893 
	`check_mysql_rc
(
rc
, 
mysql
);

895  
OK
;

896 
	}
}

900 
	$‹¡_Ý’_dœeù
(
MYSQL
 *
mysql
)

902 
MYSQL_STMT
 *
¡mt
;

903 
MYSQL_RES
 *
»suÉ
;

904 
rc
;

905 
qu”y
[
MAX_TEST_QUERY_LENGTH
];

907 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_open_direct");

908 
	`check_mysql_rc
(
rc
, 
mysql
);

910 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_open_direct(id int,‚ame char(6))");

911 
	`check_mysql_rc
(
rc
, 
mysql
);

913 
	`¡rýy
(
qu”y
, "INSERT INTOest_open_direct values(10, 'mysql')");

914 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

915 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

916 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

917 
	`check_¡mt_rc
(
rc
, 
¡mt
);

919 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT * FROMest_open_direct");

921 
»suÉ
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

922 
	`FAIL_IF
(!
»suÉ
, "invalid„esultset");

924 
	`FAIL_IF
(
	`mysql_num_rows
(
»suÉ
), "rowcount != 0");

925 
	`mysql_ä“_»suÉ
(
»suÉ
);

927 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

928 
	`check_¡mt_rc
(
rc
, 
¡mt
);

930 
	`FAIL_IF
(
	`mysql_¡mt_afãùed_rows
(
¡mt
) != 1, "affected„ows != 1");

932 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT * FROMest_open_direct");

933 
	`check_mysql_rc
(
rc
, 
mysql
);

935 
»suÉ
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

936 
	`FAIL_IF
(!
»suÉ
, "invalid„esultset");

938 
	`FAIL_IF
(
	`mysql_num_rows
(
»suÉ
) != 1, "rowcount != 1");

939 
	`mysql_ä“_»suÉ
(
»suÉ
);

941 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

942 
	`check_¡mt_rc
(
rc
, 
¡mt
);

944 
	`FAIL_IF
(
	`mysql_¡mt_afãùed_rows
(
¡mt
) != 1, "affected„ows != 1");

946 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT * FROMest_open_direct");

947 
	`check_mysql_rc
(
rc
, 
mysql
);

949 
»suÉ
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

950 
	`FAIL_IF
(!
»suÉ
, "Invalid„esultset");

951 
	`FAIL_IF
(
	`mysql_num_rows
(
»suÉ
) != 2, "rowcount != 2");

953 
	`mysql_ä“_»suÉ
(
»suÉ
);

955 
	`mysql_¡mt_þo£
(
¡mt
);

959 
	`¡rýy
(
qu”y
, "SELECT * FROMest_open_direct");

960 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

961 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

962 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

963 
	`check_¡mt_rc
(
rc
, 
¡mt
);

965 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

966 
	`check_¡mt_rc
(
rc
, 
¡mt
);

968 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

969 
	`check_¡mt_rc
(
rc
, 
¡mt
);

971 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTOest_open_direct(id) VALUES(20)");

972 
	`FAIL_IF
(!
rc
, "Errorƒxpected");

974 
rc
ð
	`mysql_¡mt_þo£
(
¡mt
);

975 
	`check_¡mt_rc
(
rc
, 
¡mt
);

977 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTOest_open_direct(id) VALUES(20)");

978 
	`check_mysql_rc
(
rc
, 
mysql
);

981 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

982 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

983 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

984 
	`check_¡mt_rc
(
rc
, 
¡mt
);

986 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

987 
	`check_¡mt_rc
(
rc
, 
¡mt
);

989 
rc
ð
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

990 
	`check_¡mt_rc
(
rc
, 
¡mt
);

992 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

993 
	`check_¡mt_rc
(
rc
, 
¡mt
);

995 
rc
ð
	`mysql_qu”y
(
mysql
, "dropableest_open_direct");

996 
	`check_mysql_rc
(
rc
, 
mysql
);

998 
rc
ð
	`mysql_¡mt_þo£
(
¡mt
);

999 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1001  
OK
;

1002 
	}
}

1004 
	$‹¡_£Ëù_show
(
MYSQL
 *
mysql
)

1006 
MYSQL_STMT
 *
¡mt
;

1007 
rc
;

1008 
qu”y
[
MAX_TEST_QUERY_LENGTH
];

1009 
rowcouÁ
;

1011 
rc
ð
	`mysql_autocomm™
(
mysql
, 
TRUE
);

1012 
	`check_mysql_rc
(
rc
, 
mysql
);

1014 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_show");

1015 
	`check_mysql_rc
(
rc
, 
mysql
);

1017 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_show(id int(4) NOT NULL…rimary "

1019 
	`check_mysql_rc
(
rc
, 
mysql
);

1021 
	`¡rýy
(
qu”y
, "show columns fromest_show");

1022 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

1023 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

1024 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

1025 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1027 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
) != 0, "Paramcount != 0");

1029 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1030 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1032 
rowcouÁ
= 0;

1033 
	`mysql_¡mt_ãtch
(
¡mt
è!ð
MYSQL_NO_DATA
)

1034 
rowcouÁ
++;

1035 
	`FAIL_IF
(
rowcouÁ
 != 2, "rowcount != 2");

1037 
	`mysql_¡mt_þo£
(
¡mt
);

1039 
	`¡rýy
(
qu”y
, "showables from mysql†ike ?");

1040 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

1041 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

1042 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

1043 
	`FAIL_IF
(!
rc
, "Errorƒxpected");

1045 
	`¡rýy
(
qu”y
, "showables†ike \'test_show\'");

1046 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

1047 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

1048 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1050 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1051 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1053 
rowcouÁ
= 0;

1054 
	`mysql_¡mt_ãtch
(
¡mt
è!ð
MYSQL_NO_DATA
)

1055 
rowcouÁ
++;

1056 
	`FAIL_IF
(
rowcouÁ
 != 1, "rowcount != 1");

1057 
	`mysql_¡mt_þo£
(
¡mt
);

1059 
	`¡rýy
(
qu”y
, "describeest_show");

1060 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

1061 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

1062 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

1063 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1065 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1066 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1068 
rowcouÁ
= 0;

1069 
	`mysql_¡mt_ãtch
(
¡mt
è!ð
MYSQL_NO_DATA
)

1070 
rowcouÁ
++;

1071 
	`FAIL_IF
(
rowcouÁ
 != 2, "rowcount != 2");

1072 
	`mysql_¡mt_þo£
(
¡mt
);

1074 
	`¡rýy
(
qu”y
, "show keys fromest_show");

1075 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

1076 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

1077 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

1078 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1080 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1081 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1083 
rowcouÁ
= 0;

1084 
	`mysql_¡mt_ãtch
(
¡mt
è!ð
MYSQL_NO_DATA
)

1085 
rowcouÁ
++;

1086 
	`FAIL_IF
(
rowcouÁ
 != 1, "rowcount != 1");

1088 
	`mysql_¡mt_þo£
(
¡mt
);

1089 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_show");

1090 
	`check_mysql_rc
(
rc
, 
mysql
);

1092  
OK
;

1093 
	}
}

1095 
	$‹¡_sim¶e_upd©e
(
MYSQL
 *
mysql
)

1097 
MYSQL_STMT
 *
¡mt
;

1098 
rc
;

1099 
szD©a
[25];

1100 
nD©a
= 1;

1101 
MYSQL_RES
 *
»suÉ
;

1102 
MYSQL_BIND
 
my_bšd
[2];

1103 
ulÚg
 
Ëngth
[2];

1104 
rowcouÁ
= 0;

1105 
qu”y
[
MAX_TEST_QUERY_LENGTH
];

1107 
rc
ð
	`mysql_autocomm™
(
mysql
, 
TRUE
);

1108 
	`check_mysql_rc
(
rc
, 
mysql
);

1110 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_update");

1111 
	`check_mysql_rc
(
rc
, 
mysql
);

1113 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_update(col1 int, "

1115 
	`check_mysql_rc
(
rc
, 
mysql
);

1117 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTOest_update VALUES(1, 'MySQL', 100)");

1118 
	`check_mysql_rc
(
rc
, 
mysql
);

1120 
	`FAIL_IF
(
	`mysql_afãùed_rows
(
mysql
) != 1, "Affected„ows != 1");

1122 
rc
ð
	`mysql_comm™
(
mysql
);

1123 
	`check_mysql_rc
(
rc
, 
mysql
);

1126 
	`¡rýy
(
qu”y
, "UPDATEest_update SET col2= ? WHERE col1= ?");

1127 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

1128 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

1129 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

1130 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1132 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
) != 2, "Paramcount != 2");

1134 
	`mem£t
(
my_bšd
, '\0', (my_bind));

1136 
nD©a
= 1;

1137 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

1138 
my_bšd
[0].
bufãr
ð
szD©a
;

1139 
my_bšd
[0].
bufãr_Ëngth
ð(
szD©a
);

1140 
my_bšd
[0].
Ëngth
= &length[0];

1141 
Ëngth
[0]ð
	`¥rštf
(
szD©a
, "updated-data");

1143 
my_bšd
[1].
bufãr
ð(*è&
nD©a
;

1144 
my_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

1146 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

1147 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1149 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1150 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1151 
	`FAIL_IF
(
	`mysql_¡mt_afãùed_rows
(
¡mt
) != 1, "Affected_rows != 1");

1153 
	`mysql_¡mt_þo£
(
¡mt
);

1156 
rc
ð
	`mysql_comm™
(
mysql
);

1157 
	`check_mysql_rc
(
rc
, 
mysql
);

1160 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT * FROMest_update");

1161 
	`check_mysql_rc
(
rc
, 
mysql
);

1164 
»suÉ
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

1165 
	`FAIL_IF
(!
»suÉ
, "Invalid„esultset");

1167 
	`mysql_ãtch_row
(
»suÉ
))

1168 
rowcouÁ
++;

1170 
	`FAIL_IF
(
rowcouÁ
 != 1, "rowcount != 1");

1172 
	`mysql_ä“_»suÉ
(
»suÉ
);

1173 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_update");

1174 
	`check_mysql_rc
(
rc
, 
mysql
);

1176  
OK
;

1177 
	}
}

1182 
	$‹¡_lÚg_d©a
(
MYSQL
 *
mysql
)

1184 
MYSQL_STMT
 *
¡mt
;

1185 
rc
, 
št_d©a
;

1186 *
d©a
ð
NuÎS
;

1187 
MYSQL_RES
 *
»suÉ
;

1188 
MYSQL_BIND
 
my_bšd
[3];

1189 
rowcouÁ
;

1190 
qu”y
[
MAX_TEST_QUERY_LENGTH
];

1192 
rc
ð
	`mysql_autocomm™
(
mysql
, 
TRUE
);

1193 
	`check_mysql_rc
(
rc
, 
mysql
);

1195 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_long_data");

1196 
	`check_mysql_rc
(
rc
, 
mysql
);

1198 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_long_data(col1 int, "

1200 
	`check_mysql_rc
(
rc
, 
mysql
);

1202 
	`¡rýy
(
qu”y
, "INSERT INTOest_long_data(col1, col2) VALUES(?)");

1203 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

1204 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

1205 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

1206 
	`FAIL_IF
(!
rc
, "Errorƒxpected");

1207 
rc
ð
	`mysql_¡mt_þo£
(
¡mt
);

1208 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1210 
	`¡rýy
(
qu”y
, "INSERT INTOest_long_data(col1, col2, col3) VALUES(?, ?, ?)");

1211 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

1212 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

1213 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

1214 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1216 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
) != 3, "Paramcount != 3");

1218 
	`mem£t
(
my_bšd
, '\0', (my_bind));

1220 
my_bšd
[0].
bufãr
ð(*)&
št_d©a
;

1221 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

1223 
my_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

1225 
my_bšd
[2]= my_bind[1];

1226 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

1227 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1229 
št_d©a
= 999;

1230 
d©a
= (*)"Michael";

1233 
rc
ð
	`mysql_¡mt_£nd_lÚg_d©a
(
¡mt
, 1, 
	`SL
(
d©a
));

1234 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1235 
d©a
= (*)" 'Monty' Widenius";

1236 
rc
ð
	`mysql_¡mt_£nd_lÚg_d©a
(
¡mt
, 1, 
	`SL
(
d©a
));

1237 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1238 
rc
ð
	`mysql_¡mt_£nd_lÚg_d©a
(
¡mt
, 2, "Venu (venu@mysql.com)", 4);

1239 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1242 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1243 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1245 
rc
ð
	`mysql_comm™
(
mysql
);

1246 
	`check_mysql_rc
(
rc
, 
mysql
);

1249 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT * FROMest_long_data");

1250 
	`check_mysql_rc
(
rc
, 
mysql
);

1253 
»suÉ
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

1254 
	`FAIL_IF
(!
»suÉ
, "Invalid„esult set");

1256 
rowcouÁ
= 0;

1257 
	`mysql_ãtch_row
(
»suÉ
))

1258 
rowcouÁ
++;

1259 
	`FAIL_IF
(
rowcouÁ
 != 1, "rowcount != 1");

1260 
	`mysql_ä“_»suÉ
(
»suÉ
);

1262 ià(
	`v”ify_cÞ_d©a
(
mysql
, "test_long_data", "col1", "999"))

1263 
”rÜ
;

1264 ià(
	`v”ify_cÞ_d©a
(
mysql
, "test_long_data", "col2", "Michael 'Monty' Widenius"))

1265 
”rÜ
;

1266 ià(
	`v”ify_cÞ_d©a
(
mysql
, "test_long_data", "col3", "Venu"))

1267 
”rÜ
;

1269 
	`mysql_¡mt_þo£
(
¡mt
);

1270 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_long_data");

1271 
	`check_mysql_rc
(
rc
, 
mysql
);

1272  
OK
;

1274 
”rÜ
:

1275 
	`mysql_¡mt_þo£
(
¡mt
);

1276  
FAIL
;

1277 
	}
}

1282 
	$‹¡_lÚg_d©a_¡r
(
MYSQL
 *
mysql
)

1284 
MYSQL_STMT
 *
¡mt
;

1285 
rc
, 
i
, 
rowcouÁ
= 0;

1286 
d©a
[255];

1287 
Ëngth
;

1288 
ulÚg
 
Ëngth1
;

1289 
MYSQL_RES
 *
»suÉ
;

1290 
MYSQL_BIND
 
my_bšd
[2];

1291 
my_boÞ
 
is_nuÎ
[2];

1292 
qu”y
[
MAX_TEST_QUERY_LENGTH
];

1294 
rc
ð
	`mysql_autocomm™
(
mysql
, 
TRUE
);

1295 
	`check_mysql_rc
(
rc
, 
mysql
);

1297 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_long_data_str");

1298 
	`check_mysql_rc
(
rc
, 
mysql
);

1300 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_long_data_str(id int,†ongstr†ong varchar)");

1301 
	`check_mysql_rc
(
rc
, 
mysql
);

1303 
	`¡rýy
(
qu”y
, "INSERT INTOest_long_data_str VALUES(?, ?)");

1304 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

1305 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

1306 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

1307 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1309 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
) != 2, "Paramcount != 2");

1311 
	`mem£t
(
my_bšd
, '\0', (my_bind));

1313 
my_bšd
[0].
bufãr
ð(*)&
Ëngth
;

1314 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

1315 
my_bšd
[0].
is_nuÎ
= &is_null[0];

1316 
is_nuÎ
[0]= 0;

1317 
Ëngth
= 0;

1319 
my_bšd
[1].
bufãr
ð
d©a
;

1320 
my_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

1321 
my_bšd
[1].
Ëngth
ð&
Ëngth1
;

1322 
my_bšd
[1].
is_nuÎ
= &is_null[1];

1323 
is_nuÎ
[1]= 0;

1324 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

1325 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1327 
Ëngth
= 40;

1328 
	`¡rýy
(
d©a
, "MySQL AB");

1331 
i
= 0; i < 4; i++)

1333 
rc
ð
	`mysql_¡mt_£nd_lÚg_d©a
(
¡mt
, 1, (*)
d©a
, 5);

1334 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1337 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1338 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1340 
	`mysql_¡mt_þo£
(
¡mt
);

1342 
rc
ð
	`mysql_comm™
(
mysql
);

1343 
	`check_mysql_rc
(
rc
, 
mysql
);

1346 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT LENGTH(longstr),†ongstr FROMest_long_data_str");

1347 
	`check_mysql_rc
(
rc
, 
mysql
);

1350 
»suÉ
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

1351 
	`FAIL_IF
(!
»suÉ
, "Invalid„esult set");

1353 
	`mysql_ãtch_row
(
»suÉ
))

1354 
rowcouÁ
++;

1355 
	`FAIL_IF
(
rowcouÁ
 != 1, "rowcount != 1");

1357 
	`mysql_ä“_»suÉ
(
»suÉ
);

1359 
	`¥rštf
(
d©a
, "%d", 
i
*5);

1360 ià(
	`v”ify_cÞ_d©a
(
mysql
, "‹¡_lÚg_d©a_¡r", "LENGTHÖÚg¡r)", 
d©a
))

1361 
”rÜ
;

1362 
	`¡rýy
(
d©a
, "MySQLMySQLMySQLMySQL");

1363 ià(
	`v”ify_cÞ_d©a
(
mysql
, "‹¡_lÚg_d©a_¡r", "lÚg¡r", 
d©a
))

1364 
”rÜ
;

1366 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLEest_long_data_str");

1367 
	`check_mysql_rc
(
rc
, 
mysql
);

1369  
OK
;

1371 
”rÜ
:

1372 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLEest_long_data_str");

1373 
	`check_mysql_rc
(
rc
, 
mysql
);

1374  
FAIL
;

1375 
	}
}

1380 
	$‹¡_lÚg_d©a_¡r1
(
MYSQL
 *
mysql
)

1382 
MYSQL_STMT
 *
¡mt
;

1383 
rc
, 
i
, 
rowcouÁ
= 0;

1384 
d©a
[255];

1385 
Ëngth
;

1386 
max_blob_Ëngth
, 
blob_Ëngth
, 
Ëngth1
;

1387 
my_boÞ
 
Œue_v®ue
;

1388 
MYSQL_RES
 *
»suÉ
;

1389 
MYSQL_BIND
 
my_bšd
[2];

1390 
MYSQL_FIELD
 *
f›ld
;

1391 
qu”y
[
MAX_TEST_QUERY_LENGTH
];

1393 
rc
ð
	`mysql_autocomm™
(
mysql
, 
TRUE
);

1394 
	`check_mysql_rc
(
rc
, 
mysql
);

1396 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_long_data_str");

1397 
	`check_mysql_rc
(
rc
, 
mysql
);

1399 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_long_data_str(longstr†ong varchar, blb†ong varbinary)");

1400 
	`check_mysql_rc
(
rc
, 
mysql
);

1402 
	`¡rýy
(
qu”y
, "INSERT INTOest_long_data_str VALUES(?, ?)");

1403 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

1404 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

1405 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

1406 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1408 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
) != 2, "Paramcount != 2");

1410 
	`mem£t
(
my_bšd
, '\0', (my_bind));

1412 
my_bšd
[0].
bufãr
ð
d©a
;

1413 
my_bšd
[0].
bufãr_Ëngth
ð(
d©a
);

1414 
my_bšd
[0].
Ëngth
ð(*)&
Ëngth1
;

1415 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

1416 
Ëngth1
= 0;

1418 
my_bšd
[1]= my_bind[0];

1419 
my_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_BLOB
;

1421 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

1422 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1423 
Ëngth
ð
	`¥rštf
(
d©a
, "MySQL AB");

1426 
i
= 0; i < 3; i++)

1428 
rc
ð
	`mysql_¡mt_£nd_lÚg_d©a
(
¡mt
, 0, 
d©a
, 
Ëngth
);

1429 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1431 
rc
ð
	`mysql_¡mt_£nd_lÚg_d©a
(
¡mt
, 1, 
d©a
, 2);

1432 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1436 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1437 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1439 
	`mysql_¡mt_þo£
(
¡mt
);

1441 
rc
ð
	`mysql_comm™
(
mysql
);

1442 
	`check_mysql_rc
(
rc
, 
mysql
);

1445 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT LENGTH(longstr),†ongstr, LENGTH(blb), blb FROMest_long_data_str");

1446 
	`check_mysql_rc
(
rc
, 
mysql
);

1449 
»suÉ
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

1451 
	`mysql_f›ld_£ek
(
»suÉ
, 1);

1452 
f›ld
ð
	`mysql_ãtch_f›ld
(
»suÉ
);

1453 
max_blob_Ëngth
ð
f›ld
->
max_Ëngth
;

1455 
	`FAIL_IF
(!
»suÉ
, "Invalid„esult set");

1457 
	`mysql_ãtch_row
(
»suÉ
))

1458 
rowcouÁ
++;

1460 
	`FAIL_IF
(
rowcouÁ
 != 1, "rowcount != 1");

1461 
	`mysql_ä“_»suÉ
(
»suÉ
);

1463 
	`¥rštf
(
d©a
, "%ld", ()
i
*
Ëngth
);

1464 ià(
	`v”ify_cÞ_d©a
(
mysql
, "‹¡_lÚg_d©a_¡r", "ËngthÖÚg¡r)", 
d©a
))

1465  
FAIL
;

1467 
	`¥rštf
(
d©a
, "%d", 
i
*2);

1468 ià(
	`v”ify_cÞ_d©a
(
mysql
, "‹¡_lÚg_d©a_¡r", "Ëngth(blb)", 
d©a
))

1469  
FAIL
;

1472 
	`¡rýy
(
qu”y
, "SELECT * fromest_long_data_str");

1473 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

1474 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

1475 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

1476 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1478 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
) != 0, "Paramcount != 0");

1480 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1481 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1483 
rc
ð
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

1484 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1486 
»suÉ
ð
	`mysql_¡mt_»suÉ_m‘ad©a
(
¡mt
);

1487 
f›ld
ð
	`mysql_ãtch_f›lds
(
»suÉ
);

1490 
	`FAIL_IF
(
f›ld
->
max_Ëngth
 != 0, "field->max_length != 0");

1491 
	`mysql_ä“_»suÉ
(
»suÉ
);

1494 
Œue_v®ue
= 1;

1495 
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_UPDATE_MAX_LENGTH
, (*è&
Œue_v®ue
);

1496 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1497 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1499 
rc
ð
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

1500 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1502 
»suÉ
ð
	`mysql_¡mt_»suÉ_m‘ad©a
(
¡mt
);

1503 
f›ld
ð
	`mysql_ãtch_f›lds
(
»suÉ
);

1505 
	`dŸg
("max_Ëngth: %lu max_blob_Ëngth: %lu", ()
f›ld
->
max_Ëngth
, ()
max_blob_Ëngth
);

1506 
	`FAIL_UNLESS
(
f›ld
->
max_Ëngth
 =ð
max_blob_Ëngth
, "field->max_length != max_blob_length");

1509 
	`mem£t
(
my_bšd
, '\0', (*my_bind));

1510 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_BLOB
;

1511 
my_bšd
[0].
bufãr
ð(*è&
d©a
;

1512 
my_bšd
[0].
bufãr_Ëngth
= 16;

1513 
my_bšd
[0].
Ëngth
ð(*)&
blob_Ëngth
;

1514 
my_bšd
[0].
”rÜ
ð&my_bšd[0].
”rÜ_v®ue
;

1515 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

1516 
d©a
[16]= 0;

1518 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

1519 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_DATA_TRUNCATED
, "truncationƒxpected");

1520 
	`FAIL_UNLESS
(
my_bšd
[0].
”rÜ_v®ue
, "Noƒrror value");

1521 
	`FAIL_UNLESS
(
	`¡¾’
(
d©a
) == 16, "Invalid string†ength");

1522 
	`FAIL_UNLESS
(
blob_Ëngth
 =ð
max_blob_Ëngth
, "blob_length != max_blob_length");

1525 
	`mem£t
((
my_bšd
+1), '\0', (*my_bind));

1526 
my_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_BLOB
;

1527 
my_bšd
[1].
bufãr
ð(*è&
d©a
;

1528 
my_bšd
[1].
bufãr_Ëngth
ð(
d©a
);

1529 
my_bšd
[1].
Ëngth
ð(*)&
blob_Ëngth
;

1530 
	`mem£t
(
d©a
, '\0', (data));

1531 
	`mysql_¡mt_ãtch_cÞumn
(
¡mt
, 
my_bšd
+1, 0, 0);

1532 
	`FAIL_UNLESS
(
	`¡¾’
(
d©a
è=ð
max_blob_Ëngth
, "strlen(data) != max_blob_length");

1534 
	`mysql_ä“_»suÉ
(
»suÉ
);

1535 
	`mysql_¡mt_þo£
(
¡mt
);

1538 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLEest_long_data_str");

1539 
	`check_mysql_rc
(
rc
, 
mysql
);

1541  
OK
;

1542 
	}
}

1547 
	$‹¡_lÚg_d©a_bš
(
MYSQL
 *
mysql
)

1549 
MYSQL_STMT
 *
¡mt
;

1550 
rc
, 
rowcouÁ
= 0;

1551 
d©a
[255];

1552 
Ëngth
;

1553 
MYSQL_RES
 *
»suÉ
;

1554 
MYSQL_BIND
 
my_bšd
[2];

1555 
qu”y
[
MAX_TEST_QUERY_LENGTH
];

1558 
rc
ð
	`mysql_autocomm™
(
mysql
, 
TRUE
);

1559 
	`check_mysql_rc
(
rc
, 
mysql
);

1561 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_long_data_bin");

1562 
	`check_mysql_rc
(
rc
, 
mysql
);

1564 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_long_data_bin(id int,†ongbin†ong varbinary)");

1565 
	`check_mysql_rc
(
rc
, 
mysql
);

1567 
	`¡rýy
(
qu”y
, "INSERT INTOest_long_data_bin VALUES(?, ?)");

1568 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

1569 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

1570 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

1571 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1573 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
) != 2, "Paramcount != 2");

1575 
	`mem£t
(
my_bšd
, '\0', (my_bind));

1577 
my_bšd
[0].
bufãr
ð(*)&
Ëngth
;

1578 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

1579 
Ëngth
= 0;

1581 
my_bšd
[1].
bufãr
ð
d©a
;

1582 
my_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_LONG_BLOB
;

1583 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

1584 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1586 
Ëngth
= 10;

1587 
	`¡rýy
(
d©a
, "MySQL AB");

1591 
i
;

1592 
i
= 0; i < 100; i++)

1594 
rc
ð
	`mysql_¡mt_£nd_lÚg_d©a
(
¡mt
, 1, (*)
d©a
, 4);

1595 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1599 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1600 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1602 
	`mysql_¡mt_þo£
(
¡mt
);

1604 
rc
ð
	`mysql_comm™
(
mysql
);

1605 
	`check_mysql_rc
(
rc
, 
mysql
);

1608 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT LENGTH(longbin),†ongbin FROMest_long_data_bin");

1609 
	`check_mysql_rc
(
rc
, 
mysql
);

1612 
»suÉ
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

1613 
	`FAIL_IF
(!
»suÉ
, "Invalid„esult set");

1615 
	`mysql_ãtch_row
(
»suÉ
))

1616 
rowcouÁ
++;

1618 
	`FAIL_IF
(
rowcouÁ
 != 1, "rowcount != 1");

1619 
	`mysql_ä“_»suÉ
(
»suÉ
);

1621 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_long_data_bin");

1622 
	`check_mysql_rc
(
rc
, 
mysql
);

1623  
OK
;

1624 
	}
}

1629 
	$‹¡_sim¶e_d–‘e
(
MYSQL
 *
mysql
)

1631 
MYSQL_STMT
 *
¡mt
;

1632 
rc
, 
rowcouÁ
= 0;

1633 
szD©a
[30]= {0};

1634 
nD©a
= 1;

1635 
MYSQL_RES
 *
»suÉ
;

1636 
MYSQL_BIND
 
my_bšd
[2];

1637 
ulÚg
 
Ëngth
[2];

1638 
qu”y
[
MAX_TEST_QUERY_LENGTH
];

1640 
rc
ð
	`mysql_autocomm™
(
mysql
, 
TRUE
);

1641 
	`check_mysql_rc
(
rc
, 
mysql
);

1643 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_simple_delete");

1644 
	`check_mysql_rc
(
rc
, 
mysql
);

1646 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_simple_delete(col1 int, \
2 varchar(50), col3 int )");

1648 
	`check_mysql_rc
(
rc
, 
mysql
);

1650 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTOest_simple_delete VALUES(1, 'MySQL', 100)");

1651 
	`check_mysql_rc
(
rc
, 
mysql
);

1653 
	`FAIL_IF
(
	`mysql_afãùed_rows
(
mysql
) != 1, "Affected„ows != 1");

1655 
rc
ð
	`mysql_comm™
(
mysql
);

1656 
	`check_mysql_rc
(
rc
, 
mysql
);

1659 
	`¡rýy
(
qu”y
, "DELETE FROMest_simple_delete WHERE col1= ? AND "

1661 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

1662 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

1663 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

1664 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1666 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
) != 2, "Paramcount != 2");

1668 
	`mem£t
(
my_bšd
, '\0', (my_bind));

1670 
nD©a
= 1;

1671 
	`¡rýy
(
szD©a
, "MySQL");

1672 
my_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

1673 
my_bšd
[1].
bufãr
ð
szD©a
;

1674 
my_bšd
[1].
bufãr_Ëngth
ð(
szD©a
);

1675 
my_bšd
[1].
Ëngth
= &length[1];

1676 
Ëngth
[1]= 5;

1678 
my_bšd
[0].
bufãr
ð(*)&
nD©a
;

1679 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

1681 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

1682 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1684 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1685 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1687 
	`FAIL_IF
(
	`mysql_¡mt_afãùed_rows
(
¡mt
) != 1, "Affected„ows != 1");

1689 
	`mysql_¡mt_þo£
(
¡mt
);

1692 
rc
ð
	`mysql_comm™
(
mysql
);

1693 
	`check_mysql_rc
(
rc
, 
mysql
);

1696 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT * FROMest_simple_delete");

1697 
	`check_mysql_rc
(
rc
, 
mysql
);

1700 
»suÉ
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

1701 
	`FAIL_IF
(!
»suÉ
, "Invalid„esult set");

1703 
	`mysql_ãtch_row
(
»suÉ
))

1704 
rowcouÁ
++;

1706 
	`FAIL_IF
(
rowcouÁ
, "rowcount > 0");

1707 
	`mysql_ä“_»suÉ
(
»suÉ
);

1708 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_simple_delete");

1709 
	`check_mysql_rc
(
rc
, 
mysql
);

1711  
OK
;

1712 
	}
}

1714 
	$‹¡_upd©e
(
MYSQL
 *
mysql
)

1716 
MYSQL_STMT
 *
¡mt
;

1717 
rc
;

1718 
szD©a
[25];

1719 
nD©a
ð1, 
rowcouÁ
= 0;

1720 
MYSQL_RES
 *
»suÉ
;

1721 
MYSQL_BIND
 
my_bšd
[2];

1722 
ulÚg
 
Ëngth
[2];

1723 
qu”y
[
MAX_TEST_QUERY_LENGTH
];

1725 
rc
ð
	`mysql_autocomm™
(
mysql
, 
TRUE
);

1726 
	`check_mysql_rc
(
rc
, 
mysql
);

1728 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_update");

1729 
	`check_mysql_rc
(
rc
, 
mysql
);

1731 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_update("

1734 
	`check_mysql_rc
(
rc
, 
mysql
);

1736 
	`¡rýy
(
qu”y
, "INSERT INTOest_update(col2, col3) VALUES(?, ?)");

1737 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

1738 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

1739 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

1740 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1742 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
) != 2, "Paramcount != 2");

1744 
	`mem£t
(
my_bšd
, '\0', (my_bind));

1747 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

1748 
my_bšd
[0].
bufãr
ð
szD©a
;

1749 
my_bšd
[0].
bufãr_Ëngth
ð(
szD©a
);

1750 
my_bšd
[0].
Ëngth
= &length[0];

1751 
Ëngth
[0]ð
	`¥rštf
(
szD©a
, "inserted-data");

1753 
my_bšd
[1].
bufãr
ð(*)&
nD©a
;

1754 
my_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

1756 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

1757 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1759 
nD©a
= 100;

1760 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1761 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1763 
	`FAIL_IF
(
	`mysql_¡mt_afãùed_rows
(
¡mt
) != 1, "Affected„ows != 1");

1764 
	`mysql_¡mt_þo£
(
¡mt
);

1766 
	`¡rýy
(
qu”y
, "UPDATEest_update SET col2= ? WHERE col3= ?");

1767 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

1768 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

1769 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

1770 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1772 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
) != 2, "Paramcount != 2");

1773 
nD©a
= 100;

1775 
	`mem£t
(
my_bšd
, '\0', (my_bind));

1777 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

1778 
my_bšd
[0].
bufãr
ð
szD©a
;

1779 
my_bšd
[0].
bufãr_Ëngth
ð(
szD©a
);

1780 
my_bšd
[0].
Ëngth
= &length[0];

1781 
Ëngth
[0]ð
	`¥rštf
(
szD©a
, "updated-data");

1783 
my_bšd
[1].
bufãr
ð(*)&
nD©a
;

1784 
my_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

1786 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

1787 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1789 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1790 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1791 
	`FAIL_IF
(
	`mysql_¡mt_afãùed_rows
(
¡mt
) != 1, "Affected„ows != 1");

1794 
	`mysql_¡mt_þo£
(
¡mt
);

1797 
rc
ð
	`mysql_comm™
(
mysql
);

1798 
	`check_mysql_rc
(
rc
, 
mysql
);

1801 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT * FROMest_update");

1802 
	`check_mysql_rc
(
rc
, 
mysql
);

1805 
»suÉ
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

1806 
	`FAIL_IF
(!
»suÉ
, "Invalid„esult set");

1808 
	`mysql_ãtch_row
(
»suÉ
))

1809 
rowcouÁ
++;

1810 
	`FAIL_IF
(
rowcouÁ
 != 1, "rowcount != 1");

1811 
	`mysql_ä“_»suÉ
(
»suÉ
);

1812 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_update");

1813 
	`check_mysql_rc
(
rc
, 
mysql
);

1815  
OK
;

1816 
	}
}

1821 
	$‹¡_´•¬e_nÝ¬am
(
MYSQL
 *
mysql
)

1823 
MYSQL_STMT
 *
¡mt
;

1824 
rc
, 
rowcouÁ
= 0;

1825 
MYSQL_RES
 *
»suÉ
;

1826 
qu”y
[
MAX_TEST_QUERY_LENGTH
];

1828 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS my_prepare");

1829 
	`check_mysql_rc
(
rc
, 
mysql
);

1832 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE my_prepare(col1 int, col2 varchar(50))");

1833 
	`check_mysql_rc
(
rc
, 
mysql
);

1836 
	`¡rýy
(
qu”y
, "INSERT INTO my_prepare VALUES(10, 'venu')");

1837 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

1838 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

1839 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

1840 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1842 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
) != 0, "Paramcount != 0");

1844 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1845 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1847 
	`mysql_¡mt_þo£
(
¡mt
);

1850 
rc
ð
	`mysql_comm™
(
mysql
);

1851 
	`check_mysql_rc
(
rc
, 
mysql
);

1854 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT * FROM my_prepare");

1855 
	`check_mysql_rc
(
rc
, 
mysql
);

1858 
»suÉ
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

1859 
	`FAIL_IF
(!
»suÉ
, "Invalid„esult set");

1861 
	`mysql_ãtch_row
(
»suÉ
))

1862 
rowcouÁ
++;

1864 
	`FAIL_IF
(
rowcouÁ
 != 1, "rowcount != 1");

1865 
	`mysql_ä“_»suÉ
(
»suÉ
);

1866 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS my_prepare");

1867 
	`check_mysql_rc
(
rc
, 
mysql
);

1869  
OK
;

1870 
	}
}

1875 
	$‹¡_bšd_»suÉ
(
MYSQL
 *
mysql
)

1877 
MYSQL_STMT
 *
¡mt
;

1878 
rc
;

1879 
nD©a
;

1880 
ulÚg
 
Ëngth1
;

1881 
szD©a
[100];

1882 
MYSQL_BIND
 
my_bšd
[2];

1883 
my_boÞ
 
is_nuÎ
[2];

1884 
qu”y
[
MAX_TEST_QUERY_LENGTH
];

1886 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_bind_result");

1887 
	`check_mysql_rc
(
rc
, 
mysql
);

1889 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_bind_result(col1 int , col2 varchar(50))");

1890 
	`check_mysql_rc
(
rc
, 
mysql
);

1892 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTOest_bind_result VALUES(10, 'venu')");

1893 
	`check_mysql_rc
(
rc
, 
mysql
);

1895 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTOest_bind_result VALUES(20, 'MySQL')");

1896 
	`check_mysql_rc
(
rc
, 
mysql
);

1898 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTOest_bind_result(col2) VALUES('monty')");

1899 
	`check_mysql_rc
(
rc
, 
mysql
);

1901 
rc
ð
	`mysql_comm™
(
mysql
);

1902 
	`check_mysql_rc
(
rc
, 
mysql
);

1906 
	`mem£t
(
my_bšd
, '\0', (my_bind));

1907 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

1908 
my_bšd
[0].
bufãr
ð(*è&
nD©a
;

1909 
my_bšd
[0].
is_nuÎ
= &is_null[0];

1911 
my_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

1912 
my_bšd
[1].
bufãr
ð
szD©a
;

1913 
my_bšd
[1].
bufãr_Ëngth
ð(
szD©a
);

1914 
my_bšd
[1].
Ëngth
ð&
Ëngth1
;

1915 
my_bšd
[1].
is_nuÎ
= &is_null[1];

1917 
	`¡rýy
(
qu”y
, "SELECT * FROMest_bind_result");

1918 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

1919 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

1920 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

1921 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1923 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

1924 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1926 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1927 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1929 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

1930 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1932 
	`FAIL_UNLESS
(
nD©a
 == 10, "nData != 10");

1933 
	`FAIL_UNLESS
(
	`¡rcmp
(
szD©a
, "venu") == 0, "szData != 'Venu'");

1934 
	`FAIL_UNLESS
(
Ëngth1
 == 4, "length1 != 4");

1936 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

1937 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1939 
	`FAIL_UNLESS
(
nD©a
 == 20, "nData != 20");

1940 
	`FAIL_UNLESS
(
	`¡rcmp
(
szD©a
, "MySQL") == 0, "szData != 'MySQL'");

1941 
	`FAIL_UNLESS
(
Ëngth1
 == 5, "length1 != 5");

1943 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

1944 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1946 
	`FAIL_UNLESS
(
is_nuÎ
[0], "null flag‚ot set");

1947 
	`FAIL_UNLESS
(
	`¡rcmp
(
szD©a
, "monty") == 0, "szData != 'Monty'");

1948 
	`FAIL_UNLESS
(
Ëngth1
 == 5, "length1 != 5");

1950 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

1951 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "MYSQL_NO_DATAƒxpected");

1953 
	`mysql_¡mt_þo£
(
¡mt
);

1954 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_bind_result");

1955 
	`check_mysql_rc
(
rc
, 
mysql
);

1957  
OK
;

1958 
	}
}

1960 
	$‹¡_bšd_»suÉ_ext
(
MYSQL
 *
mysql
)

1962 
MYSQL_STMT
 *
¡mt
;

1963 
rc
, 
i
;

1964 
uch¬
 
t_d©a
;

1965 
s_d©a
;

1966 
i_d©a
;

1967 
lÚglÚg
 
b_d©a
;

1968 
f_d©a
;

1969 
d_d©a
;

1970 
szD©a
[20], 
bD©a
[20];

1971 
ulÚg
 
szL’gth
, 
bL’gth
;

1972 
MYSQL_BIND
 
my_bšd
[8];

1973 
ulÚg
 
Ëngth
[8];

1974 
my_boÞ
 
is_nuÎ
[8];

1975 
qu”y
[
MAX_TEST_QUERY_LENGTH
];

1977 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_bind_result");

1978 
	`check_mysql_rc
(
rc
, 
mysql
);

1980 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_bind_result(c1inyint, "

1986 
	`check_mysql_rc
(
rc
, 
mysql
);

1988 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTOest_bind_result "

1991 
	`check_mysql_rc
(
rc
, 
mysql
);

1993 
rc
ð
	`mysql_comm™
(
mysql
);

1994 
	`check_mysql_rc
(
rc
, 
mysql
);

1996 
	`mem£t
(
my_bšd
, '\0', (my_bind));

1997 
i
ð0; i < (è
	`¬¿y_–em’ts
(
my_bšd
); i++)

1999 
my_bšd
[
i
].
Ëngth
= &length[i];

2000 
my_bšd
[
i
].
is_nuÎ
= &is_null[i];

2003 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_TINY
;

2004 
my_bšd
[0].
bufãr
ð(*)&
t_d©a
;

2006 
my_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_SHORT
;

2007 
my_bšd
[2].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

2009 
my_bšd
[3].
bufãr_ty³
ð
MYSQL_TYPE_LONGLONG
;

2010 
my_bšd
[1].
bufãr
ð(*)&
s_d©a
;

2012 
my_bšd
[2].
bufãr
ð(*)&
i_d©a
;

2013 
my_bšd
[3].
bufãr
ð(*)&
b_d©a
;

2015 
my_bšd
[4].
bufãr_ty³
ð
MYSQL_TYPE_FLOAT
;

2016 
my_bšd
[4].
bufãr
ð(*)&
f_d©a
;

2018 
my_bšd
[5].
bufãr_ty³
ð
MYSQL_TYPE_DOUBLE
;

2019 
my_bšd
[5].
bufãr
ð(*)&
d_d©a
;

2021 
my_bšd
[6].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

2022 
my_bšd
[6].
bufãr
ð(*)
szD©a
;

2023 
my_bšd
[6].
bufãr_Ëngth
ð(
szD©a
);

2024 
my_bšd
[6].
Ëngth
ð&
szL’gth
;

2026 
my_bšd
[7].
bufãr_ty³
ð
MYSQL_TYPE_TINY_BLOB
;

2027 
my_bšd
[7].
bufãr
ð(*)&
bD©a
;

2028 
my_bšd
[7].
Ëngth
ð&
bL’gth
;

2029 
my_bšd
[7].
bufãr_Ëngth
ð(
bD©a
);

2031 
	`¡rýy
(
qu”y
, "select * fromest_bind_result");

2032 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

2033 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

2034 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

2035 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2037 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

2038 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2040 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

2041 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2043 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

2044 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2046 
	`FAIL_UNLESS
(
t_d©a
 == 19, "tdata != 19");

2047 
	`FAIL_UNLESS
(
s_d©a
 == 2999, "s_data != 2999");

2048 
	`FAIL_UNLESS
(
i_d©a
 == 3999, "i_data != 3999");

2049 
	`FAIL_UNLESS
(
b_d©a
 == 4999999, "b_data != 4999999");

2050 
	`FAIL_UNLESS
(
	`¡rcmp
(
szD©a
, "venu") == 0, "szData != 'Venu'");

2051 
	`FAIL_UNLESS
(
	`¡ºcmp
(
bD©a
, "mysql", 5) == 0, "nData != 'mysql'");

2052 
	`FAIL_UNLESS
(
szL’gth
 == 4, "szLength != 4");

2053 
	`FAIL_UNLESS
(
bL’gth
 == 5, "bLength != 5");

2055 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

2056 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "MYSQL_NO_DATAƒxpected");

2058 
	`mysql_¡mt_þo£
(
¡mt
);

2059 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_bind_result");

2060 
	`check_mysql_rc
(
rc
, 
mysql
);

2061  
OK
;

2062 
	}
}

2067 
	$‹¡_bšd_»suÉ_ext1
(
MYSQL
 *
mysql
)

2069 
MYSQL_STMT
 *
¡mt
;

2070 
ušt
 
i
;

2071 
rc
;

2072 
t_d©a
[20];

2073 
s_d©a
;

2074 
i_d©a
;

2075 
uch¬
 
b_d©a
;

2076 
f_d©a
;

2077 
bD©a
;

2078 
d_d©a
[20];

2079 
szD©a
;

2080 
MYSQL_BIND
 
my_bšd
[8];

2081 
ulÚg
 
Ëngth
[8];

2082 
my_boÞ
 
is_nuÎ
[8];

2083 
qu”y
[
MAX_TEST_QUERY_LENGTH
];

2085 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_bind_result");

2086 
	`check_mysql_rc
(
rc
, 
mysql
);

2088 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_bind_result(c1inyint, c2 smallint, \
3 int, c4 bigint, \
5 float, c6 double, \
7 varbinary(10), \
8 varchar(10))");

2093 
	`check_mysql_rc
(
rc
, 
mysql
);

2095 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTOest_bind_result VALUES(120, 2999, 3999, 54, \
2.6, 58.89, \
'206', '6.7')");

2098 
	`check_mysql_rc
(
rc
, 
mysql
);

2100 
rc
ð
	`mysql_comm™
(
mysql
);

2101 
	`check_mysql_rc
(
rc
, 
mysql
);

2103 
	`mem£t
(
my_bšd
, '\0', (my_bind));

2104 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

2105 
my_bšd
[0].
bufãr
ð(*è
t_d©a
;

2106 
my_bšd
[0].
bufãr_Ëngth
ð(
t_d©a
);

2107 
my_bšd
[0].
”rÜ
ð&my_bšd[0].
”rÜ_v®ue
;

2109 
my_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_FLOAT
;

2110 
my_bšd
[1].
bufãr
ð(*)&
s_d©a
;

2111 
my_bšd
[1].
bufãr_Ëngth
= 0;

2112 
my_bšd
[1].
”rÜ
ð&my_bšd[1].
”rÜ_v®ue
;

2114 
my_bšd
[2].
bufãr_ty³
ð
MYSQL_TYPE_SHORT
;

2115 
my_bšd
[2].
bufãr
ð(*)&
i_d©a
;

2116 
my_bšd
[2].
bufãr_Ëngth
= 0;

2117 
my_bšd
[2].
”rÜ
ð&my_bšd[2].
”rÜ_v®ue
;

2119 
my_bšd
[3].
bufãr_ty³
ð
MYSQL_TYPE_TINY
;

2120 
my_bšd
[3].
bufãr
ð(*)&
b_d©a
;

2121 
my_bšd
[3].
bufãr_Ëngth
= 0;

2122 
my_bšd
[3].
”rÜ
ð&my_bšd[3].
”rÜ_v®ue
;

2124 
my_bšd
[4].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

2125 
my_bšd
[4].
bufãr
ð(*)&
f_d©a
;

2126 
my_bšd
[4].
bufãr_Ëngth
= 0;

2127 
my_bšd
[4].
”rÜ
ð&my_bšd[4].
”rÜ_v®ue
;

2129 
my_bšd
[5].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

2130 
my_bšd
[5].
bufãr
ð(*)
d_d©a
;

2131 
my_bšd
[5].
bufãr_Ëngth
ð(
d_d©a
);

2132 
my_bšd
[5].
”rÜ
ð&my_bšd[5].
”rÜ_v®ue
;

2134 
my_bšd
[6].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

2135 
my_bšd
[6].
bufãr
ð(*)&
bD©a
;

2136 
my_bšd
[6].
bufãr_Ëngth
= 0;

2137 
my_bšd
[6].
”rÜ
ð&my_bšd[6].
”rÜ_v®ue
;

2139 
my_bšd
[7].
bufãr_ty³
ð
MYSQL_TYPE_DOUBLE
;

2140 
my_bšd
[7].
bufãr
ð(*)&
szD©a
;

2141 
my_bšd
[7].
bufãr_Ëngth
= 0;

2142 
my_bšd
[7].
”rÜ
ð&my_bšd[7].
”rÜ_v®ue
;

2144 
i
ð0; i < 
	`¬¿y_–em’ts
(
my_bšd
); i++)

2146 
my_bšd
[
i
].
is_nuÎ
= &is_null[i];

2147 
my_bšd
[
i
].
Ëngth
= &length[i];

2150 
	`¡rýy
(
qu”y
, "select * fromest_bind_result");

2151 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

2152 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

2153 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

2154 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2156 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

2157 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2159 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

2160 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2162 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

2163 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2165 
	`FAIL_UNLESS
(
	`¡rcmp
(
t_d©a
, "120") == 0, "t_data != 120");

2166 
	`FAIL_UNLESS
(
i_d©a
 == 3999, "i_data != 3999");

2167 
	`FAIL_UNLESS
(
f_d©a
 == 2, "f_data != 2");

2168 
	`FAIL_UNLESS
(
	`¡rcmp
(
d_d©a
, "58.89") == 0, "d_data != 58.89");

2169 
	`FAIL_UNLESS
(
b_d©a
 == 54, "b_data != 54");

2171 
	`FAIL_UNLESS
(
Ëngth
[0] == 3, "Wrong†ength");

2172 
	`FAIL_UNLESS
(
Ëngth
[1] == 4, "Wrong†ength");

2173 
	`FAIL_UNLESS
(
Ëngth
[2] == 2, "Wrong†ength");

2174 
	`FAIL_UNLESS
(
Ëngth
[3] == 1, "Wrong†ength");

2175 
	`FAIL_UNLESS
(
Ëngth
[4] == 4, "Wrong†ength");

2176 
	`FAIL_UNLESS
(
Ëngth
[5] == 5, "Wrong†ength");

2177 
	`FAIL_UNLESS
(
Ëngth
[6] == 4, "Wrong†ength");

2178 
	`FAIL_UNLESS
(
Ëngth
[7] == 8, "Wrong†ength");

2180 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

2181 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "MYSQL_NO_DATAƒxpected");

2183 
	`mysql_¡mt_þo£
(
¡mt
);

2184 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_bind_result");

2185 
	`check_mysql_rc
(
rc
, 
mysql
);

2186  
OK
;

2187 
	}
}

2189 
	$‹¡_bšd_Ãg©ive
(
MYSQL
 *
mysql
)

2191 
MYSQL_STMT
 *
¡mt
;

2192 *
qu”y
;

2193 
rc
;

2194 
MYSQL_BIND
 
my_bšd
[1];

2195 
št32
 
my_v®
= 0;

2196 
ulÚg
 
my_Ëngth
= 0L;

2197 
my_boÞ
 
my_nuÎ
ð
FALSE
;

2199 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

2200 
	`check_mysql_rc
(
rc
, 
mysql
);

2202 
rc
ð
	`mysql_qu”y
(
mysql
, "createemporaryable1 (c1 int)");

2203 
	`check_mysql_rc
(
rc
, 
mysql
);

2205 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTO1 VALUES (1), (-1)");

2206 
	`check_mysql_rc
(
rc
, 
mysql
);

2208 
qu”y
= (*)"INSERT INTO1 VALUES (?)";

2209 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

2210 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

2211 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

2212 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2215 
	`mem£t
(
my_bšd
, '\0', (my_bind));

2217 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

2218 
my_bšd
[0].
bufãr
ð(*)&
my_v®
;

2219 
my_bšd
[0].
Ëngth
ð&
my_Ëngth
;

2220 
my_bšd
[0].
is_nuÎ
ð&
my_nuÎ
;

2222 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

2223 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2225 
my_v®
= -1;

2226 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

2227 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2229 
	`mysql_¡mt_þo£
(
¡mt
);

2230 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable1");

2231 
	`check_mysql_rc
(
rc
, 
mysql
);

2233  
OK
;

2234 
	}
}

2236 
	$‹¡_bufãrs
(
MYSQL
 *
mysql
)

2238 
MYSQL_STMT
 *
¡mt
;

2239 
MYSQL_BIND
 
my_bšd
[1];

2240 
rc
;

2241 
ulÚg
 
Ëngth
;

2242 
my_boÞ
 
is_nuÎ
;

2243 
bufãr
[20];

2244 
qu”y
[
MAX_TEST_QUERY_LENGTH
];

2246 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_buffer");

2247 
	`check_mysql_rc
(
rc
, 
mysql
);

2249 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_buffer(str varchar(20))");

2250 
	`check_mysql_rc
(
rc
, 
mysql
);

2252 
rc
ð
	`mysql_qu”y
(
mysql
, "insert intoest_buffer values('MySQL')\
, ('Database'), ('Open-Source'), ('Popular')");

2254 
	`check_mysql_rc
(
rc
, 
mysql
);

2256 
	`¡rýy
(
qu”y
, "select str fromest_buffer");

2257 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

2258 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

2259 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

2260 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2262 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

2263 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2265 
	`mem£t
(
bufãr
, '\0', (buffer));

2267 
	`mem£t
(
my_bšd
, '\0', (my_bind));

2268 
my_bšd
[0].
Ëngth
= &length;

2269 
my_bšd
[0].
is_nuÎ
= &is_null;

2270 
my_bšd
[0].
bufãr_Ëngth
= 1;

2271 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

2272 
my_bšd
[0].
bufãr
= (*)buffer;

2273 
my_bšd
[0].
”rÜ
ð&my_bšd[0].
”rÜ_v®ue
;

2275 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

2276 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2278 
rc
ð
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

2279 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2281 
bufãr
[1]= 'X';

2282 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

2284 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_DATA_TRUNCATED
, "rc != MYSQL_DATA_TRUNCATED");

2285 
	`FAIL_UNLESS
(
my_bšd
[0].
”rÜ_v®ue
, "Errorflag‚ot set");

2286 
	`FAIL_UNLESS
(
bufãr
[0] == 'M', "buffer[0] != M");

2287 
	`FAIL_UNLESS
(
bufãr
[1] == 'X', "buffer[1] != X");

2288 
	`FAIL_UNLESS
(
Ëngth
 == 5, "length != 5");

2290 
my_bšd
[0].
bufãr_Ëngth
= 8;

2291 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

2292 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2294 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

2295 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2296 
	`FAIL_UNLESS
(
	`¡ºcmp
(
bufãr
, "Database", 8) == 0, "buffer != 'Database'");

2297 
	`FAIL_UNLESS
(
Ëngth
 == 8, "length != 8");

2299 
my_bšd
[0].
bufãr_Ëngth
= 12;

2300 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

2301 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2303 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

2304 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2305 
	`FAIL_UNLESS
(
	`¡rcmp
(
bufãr
, "Open-Source") == 0, "buffer != 'Open-Source'");

2306 
	`FAIL_UNLESS
(
Ëngth
 == 11, "Length != 11");

2308 
my_bšd
[0].
bufãr_Ëngth
= 6;

2309 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

2310 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2312 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

2313 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_DATA_TRUNCATED
, "rc != MYSQL_DATA_TRUNCATED");

2314 
	`FAIL_UNLESS
(
my_bšd
[0].
”rÜ_v®ue
, "Errorflag‚ot set");

2315 
	`FAIL_UNLESS
(
	`¡ºcmp
(
bufãr
, "Popula", 6) == 0, "buffer != 'Popula'");

2316 
	`FAIL_UNLESS
(
Ëngth
 == 7, "length != 7");

2318 
	`mysql_¡mt_þo£
(
¡mt
);

2319 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_buffer");

2320 
	`check_mysql_rc
(
rc
, 
mysql
);

2322  
OK
;

2323 
	}
}

2325 
	$‹¡_xjoš
(
MYSQL
 *
mysql
)

2327 
MYSQL_STMT
 *
¡mt
;

2328 
rc
, 
i
;

2329 cÚ¡ *
qu”y
=

2333 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1,2,3,4");

2334 
	`check_mysql_rc
(
rc
, 
mysql
);

2336 
rc
ð
	`mysql_qu”y
(
mysql
, "createable3 (id int(8),…aram1_id int(8),…aram2_id int(8)) ENGINE=InnoDB DEFAULT CHARSET=utf8");

2337 
	`check_mysql_rc
(
rc
, 
mysql
);

2339 
rc
ð
	`mysql_qu”y
(
mysql
, "createable1 ( id int(8),‚ame_id int(8), value varchar(10)) ENGINE=InnoDB DEFAULT CHARSET=utf8");

2340 
	`check_mysql_rc
(
rc
, 
mysql
);

2342 
rc
ð
	`mysql_qu”y
(
mysql
, "createable2 (id int(8),‚ame_id int(8), value varchar(10)) ENGINE=InnoDB DEFAULT CHARSET=utf8;");

2343 
	`check_mysql_rc
(
rc
, 
mysql
);

2345 
rc
ð
	`mysql_qu”y
(
mysql
, "createable4(id int(8), value varchar(10)) ENGINE=InnoDB DEFAULT CHARSET=utf8");

2346 
	`check_mysql_rc
(
rc
, 
mysql
);

2348 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into3 values (1, 1, 1), (2, 2,‚ull)");

2349 
	`check_mysql_rc
(
rc
, 
mysql
);

2351 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into1 values (1, 1, 'aaa'), (2,‚ull, 'bbb')");

2352 
	`check_mysql_rc
(
rc
, 
mysql
);

2354 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into2 values (1, 2, 'ccc')");

2355 
	`check_mysql_rc
(
rc
, 
mysql
);

2357 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into4 values (1, 'Name1'), (2,‚ull)");

2358 
	`check_mysql_rc
(
rc
, 
mysql
);

2360 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

2361 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

2362 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

2363 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2365 
i
= 0; i < 3; i++)

2367 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

2368 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2369 
rc
= 0;

2370 
	`mysql_¡mt_ãtch
(
¡mt
è!ð
MYSQL_NO_DATA
)

2371 
rc
++;

2372 
	`FAIL_UNLESS
(
rc
 == 1, "rowcount != 1");

2374 
	`mysql_¡mt_þo£
(
¡mt
);

2376 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE1,2,3,4");

2377 
	`check_mysql_rc
(
rc
, 
mysql
);

2379  
OK
;

2380 
	}
}

2382 
	$‹¡_uniÚ_·¿m
(
MYSQL
 *
mysql
)

2384 
MYSQL_STMT
 *
¡mt
;

2385 *
qu”y
;

2386 
rc
, 
i
;

2387 
MYSQL_BIND
 
my_bšd
[2];

2388 
my_v®
[4];

2389 
ulÚg
 
my_Ëngth
= 3L;

2390 
my_boÞ
 
my_nuÎ
ð
FALSE
;

2392 
	`¡rýy
(
my_v®
, "abc");

2394 
qu”y
= (*)"select ?‡s my_col union distinct select ?";

2395 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

2396 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

2397 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

2398 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2404 
	`mem£t
(
my_bšd
, '\0', (my_bind));

2407 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

2408 
my_bšd
[0].
bufãr
ð(*è&
my_v®
;

2409 
my_bšd
[0].
bufãr_Ëngth
= 4;

2410 
my_bšd
[0].
Ëngth
ð&
my_Ëngth
;

2411 
my_bšd
[0].
is_nuÎ
ð&
my_nuÎ
;

2412 
my_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

2413 
my_bšd
[1].
bufãr
ð(*è&
my_v®
;

2414 
my_bšd
[1].
bufãr_Ëngth
= 4;

2415 
my_bšd
[1].
Ëngth
ð&
my_Ëngth
;

2416 
my_bšd
[1].
is_nuÎ
ð&
my_nuÎ
;

2418 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

2419 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2421 
i
= 0; i < 3; i++)

2423 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

2424 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2425 
rc
= 0;

2426 
	`mysql_¡mt_ãtch
(
¡mt
è!ð
MYSQL_NO_DATA
)

2427 
rc
++;

2428 
	`FAIL_UNLESS
(
rc
 == 1, "rowcount != 1");

2431 
	`mysql_¡mt_þo£
(
¡mt
);

2433  
OK
;

2434 
	}
}

2436 
	$‹¡_uniÚ
(
MYSQL
 *
mysql
)

2438 
MYSQL_STMT
 *
¡mt
;

2439 
rc
;

2440 cÚ¡ *
qu”y
= "SELECT1.name FROM1 UNION "

2443 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1,2");

2444 
	`check_mysql_rc
(
rc
, 
mysql
);

2446 
rc
ð
	`mysql_qu”y
(
mysql
,

2450 
	`check_mysql_rc
(
rc
, 
mysql
);

2451 
rc
ð
	`mysql_qu”y
(
mysql
,

2458 
	`check_mysql_rc
(
rc
, 
mysql
);

2459 
rc
ð
	`mysql_qu”y
(
mysql
,

2463 
	`check_mysql_rc
(
rc
, 
mysql
);

2464 
rc
ð
	`mysql_qu”y
(
mysql
,

2471 
	`check_mysql_rc
(
rc
, 
mysql
);

2473 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

2474 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

2475 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

2476 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2478 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

2479 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2480 
rc
= 0;

2481 
	`mysql_¡mt_ãtch
(
¡mt
è!ð
MYSQL_NO_DATA
)

2482 
rc
++;

2483 
	`FAIL_UNLESS
(
rc
 == 20, "rc != 20");

2484 
	`mysql_¡mt_þo£
(
¡mt
);

2486 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE1,2");

2487 
	`check_mysql_rc
(
rc
, 
mysql
);

2489  
OK
;

2490 
	}
}

2492 
	$‹¡_uniÚ2
(
MYSQL
 *
mysql
)

2494 
MYSQL_STMT
 *
¡mt
;

2495 
rc
, 
i
;

2496 cÚ¡ *
qu”y
= "select col1 FROM1 where col1=1 union distinct "

2500 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

2501 
	`check_mysql_rc
(
rc
, 
mysql
);

2503 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE1(col1 INT, \
2 VARCHAR(40), \
3 SMALLINT, \
4 TIMESTAMP)");

2507 
	`check_mysql_rc
(
rc
, 
mysql
);

2509 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

2510 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

2511 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

2512 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2514 
i
= 0; i < 3; i++)

2516 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

2517 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2518 
rc
= 0;

2519 
	`mysql_¡mt_ãtch
(
¡mt
è!ð
MYSQL_NO_DATA
)

2520 
rc
++;

2521 
	`FAIL_UNLESS
(
rc
 == 0, "rowcount != 0");

2524 
	`mysql_¡mt_þo£
(
¡mt
);

2526 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE1");

2527 
	`check_mysql_rc
(
rc
, 
mysql
);

2529  
OK
;

2530 
	}
}

2534 
	$‹¡_pu»_cov”age
(
MYSQL
 *
mysql
)

2536 
MYSQL_STMT
 *
¡mt
;

2537 
MYSQL_BIND
 
my_bšd
[1];

2538 
rc
;

2539 
ulÚg
 
Ëngth
;

2542 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_pure");

2543 
	`check_mysql_rc
(
rc
, 
mysql
);

2545 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_pure(c1 int, c2 varchar(20))");

2546 
	`check_mysql_rc
(
rc
, 
mysql
);

2548 
rc
ð
	`mysql_qu”y
(
mysql
, "FLUSH TABLES");

2549 
	`check_mysql_rc
(
rc
, 
mysql
);

2551 
rc
ð
	`mysql_qu”y
(
mysql
, "START TRANSACTION");

2552 
	`check_mysql_rc
(
rc
, 
mysql
);

2554 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

2555 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

2556 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("insert intoest_pure(c67788) values(10)"));

2557 
	`FAIL_IF
(!
rc
, "Errorƒxpected");

2558 
	`mysql_¡mt_þo£
(
¡mt
);

2561 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

2562 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

2563 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("insert intoest_pure(c2) values(10)"));

2564 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2566 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, (
MYSQL_BIND
*)0);

2567 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2568 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

2569 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2570 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, (
MYSQL_BIND
*)0);

2571 
	`FAIL_UNLESS
(
rc
 == 1, "");

2573 
	`mysql_¡mt_þo£
(
¡mt
);

2575 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

2576 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

2577 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("insert intoest_pure(c2) values(?)"));

2578 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2584 
	`mem£t
(
my_bšd
, '\0', (my_bind));

2585 
my_bšd
[0].
Ëngth
= &length;

2586 
my_bšd
[0].
is_nuÎ
= 0;

2587 
my_bšd
[0].
bufãr_Ëngth
= 0;

2589 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_GEOMETRY
;

2590 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

2591 
	`FAIL_IF
(!
rc
, "Errorƒxpected");

2593 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

2594 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

2595 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2596 
rc
ð
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

2597 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2598 
	`mysql_¡mt_þo£
(
¡mt
);

2600 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

2601 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

2602 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("select * fromest_pure"));

2603 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2604 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

2605 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2606 
	`mysql_¡mt_þo£
(
¡mt
);

2608 
	`mysql_qu”y
(
mysql
, "DROP TABLEest_pure");

2609  
OK
;

2610 
	}
}

2612 
	$‹¡_š£¹_£Ëù
(
MYSQL
 *
mysql
)

2614 
MYSQL_STMT
 *
¡mt_š£¹
, *
¡mt_£Ëù
;

2615 *
qu”y
;

2616 
rc
;

2617 
ušt
 
i
;

2619 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1,2");

2620 
	`check_mysql_rc
(
rc
, 
mysql
);

2622 
rc
ð
	`mysql_qu”y
(
mysql
, "createable1 (a int)");

2623 
	`check_mysql_rc
(
rc
, 
mysql
);

2625 
rc
ð
	`mysql_qu”y
(
mysql
, "createable2 (a int)");

2626 
	`check_mysql_rc
(
rc
, 
mysql
);

2628 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into2 values (1)");

2629 
	`check_mysql_rc
(
rc
, 
mysql
);

2631 
qu”y
= (*)"insert into1 select‡ from2";

2632 
¡mt_š£¹
ð
	`mysql_¡mt_š™
(
mysql
);

2633 
	`FAIL_IF
(!
¡mt_š£¹
, 
	`mysql_”rÜ
(
mysql
));

2634 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt_š£¹
, 
	`SL
(
qu”y
));

2635 
	`check_¡mt_rc
(
rc
, 
¡mt_š£¹
);

2637 
qu”y
= (*)"select * from1";

2638 
¡mt_£Ëù
ð
	`mysql_¡mt_š™
(
mysql
);

2639 
	`FAIL_IF
(!
¡mt_£Ëù
, 
	`mysql_”rÜ
(
mysql
));

2640 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt_£Ëù
, 
	`SL
(
qu”y
));

2641 
	`check_¡mt_rc
(
rc
, 
¡mt_£Ëù
);

2643 
i
= 0; i < 3; i++)

2645 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt_š£¹
);

2646 
	`check_¡mt_rc
(
rc
, 
¡mt_š£¹
);

2648 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt_£Ëù
);

2649 
	`check_¡mt_rc
(
rc
, 
¡mt_£Ëù
);

2650 
rc
= 0;

2651 
	`mysql_¡mt_ãtch
(
¡mt_£Ëù
è!ð
MYSQL_NO_DATA
)

2652 
rc
++;

2653 
	`FAIL_UNLESS
(
rc
 =ð()(
i
+1), "rc != i+1");

2656 
	`mysql_¡mt_þo£
(
¡mt_š£¹
);

2657 
	`mysql_¡mt_þo£
(
¡mt_£Ëù
);

2658 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable1,2");

2659 
	`check_mysql_rc
(
rc
, 
mysql
);

2660  
OK
;

2661 
	}
}

2665 
	$‹¡_š£¹
(
MYSQL
 *
mysql
)

2667 
MYSQL_STMT
 *
¡mt
;

2668 
rc
;

2669 
¡r_d©a
[50];

2670 
tšy_d©a
;

2671 
MYSQL_RES
 *
»suÉ
;

2672 
MYSQL_BIND
 
my_bšd
[2];

2673 
ulÚg
 
Ëngth
;

2676 
rc
ð
	`mysql_autocomm™
(
mysql
, 
TRUE
);

2677 
	`check_mysql_rc
(
rc
, 
mysql
);

2679 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_prep_insert");

2680 
	`check_mysql_rc
(
rc
, 
mysql
);

2682 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_prep_insert(col1inyint, \
2 varchar(50))");

2684 
	`check_mysql_rc
(
rc
, 
mysql
);

2687 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

2688 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

2689 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("INSERT INTOest_prep_insert VALUES(?, ?)"));

2690 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2692 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
) != 2, "Param_count != 2");

2698 
	`mem£t
(
my_bšd
, '\0', (my_bind));

2701 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_TINY
;

2702 
my_bšd
[0].
bufãr
ð(*)&
tšy_d©a
;

2705 
my_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

2706 
my_bšd
[1].
bufãr
ð
¡r_d©a
;

2707 
my_bšd
[1].
bufãr_Ëngth
ð(
¡r_d©a
);;

2708 
my_bšd
[1].
Ëngth
= &length;

2710 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

2711 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2714 
tšy_d©a
= 0;iny_data < 3;iny_data++)

2716 
Ëngth
ð
	`¥rštf
(
¡r_d©a
, "MySQL%d", 
tšy_d©a
);

2717 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

2718 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2721 
	`mysql_¡mt_þo£
(
¡mt
);

2724 
rc
ð
	`mysql_comm™
(
mysql
);

2725 
	`check_mysql_rc
(
rc
, 
mysql
);

2728 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT * FROMest_prep_insert");

2729 
	`check_mysql_rc
(
rc
, 
mysql
);

2732 
»suÉ
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

2733 
	`FAIL_IF
(!
»suÉ
, "Invalid„esult set");

2735 
rc
= 0;

2736 
	`mysql_ãtch_row
(
»suÉ
))

2737 
rc
++;

2738 
	`FAIL_UNLESS
((è
tšy_d©a
 =ð
rc
, "rowcount !=inydata");

2739 
	`mysql_ä“_»suÉ
(
»suÉ
);

2741 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_prep_insert");

2742 
	`check_mysql_rc
(
rc
, 
mysql
);

2744  
OK
;

2745 
	}
}

2747 
	$‹¡_još
(
MYSQL
 *
mysql
)

2749 
MYSQL_STMT
 *
¡mt
;

2750 
rc
, 
i
, 
j
;

2751 cÚ¡ *
qu”y
[]= {"SELECT * FROM2 join1 on (t1.a=t2.a)",

2762 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1,2");

2763 
	`check_mysql_rc
(
rc
, 
mysql
);

2765 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE1 (a int , b int);");

2766 
	`check_mysql_rc
(
rc
, 
mysql
);

2768 
rc
ð
	`mysql_qu”y
(
mysql
,

2770 
	`check_mysql_rc
(
rc
, 
mysql
);

2772 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE2 (a int , c int);");

2773 
	`check_mysql_rc
(
rc
, 
mysql
);

2775 
rc
ð
	`mysql_qu”y
(
mysql
,

2777 
	`check_mysql_rc
(
rc
, 
mysql
);

2779 
j
= 0; j < 9; j++)

2781 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

2782 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

2783 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
[
j
]));

2784 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2785 
i
= 0; i < 3; i++)

2787 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

2788 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2789 
rc
= 0;

2790 
	`mysql_¡mt_ãtch
(
¡mt
è!ð
MYSQL_NO_DATA
)

2791 
rc
++;

2792 
	`FAIL_UNLESS
(
rc
 == 5, "rowcount != 5");

2794 
	`mysql_¡mt_þo£
(
¡mt
);

2797 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE1,2");

2798 
	`check_mysql_rc
(
rc
, 
mysql
);

2799  
OK
;

2800 
	}
}

2802 
	$‹¡_Ëá_još_v›w
(
MYSQL
 *
mysql
)

2804 
MYSQL_STMT
 *
¡mt
;

2805 
rc
, 
i
;

2806 cÚ¡ *
qu”y
=

2810 
rc
 = 
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1,v1");

2811 
	`check_mysql_rc
(
rc
, 
mysql
);

2813 
rc
 = 
	`mysql_qu”y
(
mysql
, "DROP VIEW IF EXISTS v1,t1");

2814 
	`check_mysql_rc
(
rc
, 
mysql
);

2815 
rc
ð
	`mysql_qu”y
(
mysql
,"CREATE TABLE1 (a int)");

2816 
	`check_mysql_rc
(
rc
, 
mysql
);

2817 
rc
ð
	`mysql_qu”y
(
mysql
,"insert into1 values (1), (2), (3)");

2818 
	`check_mysql_rc
(
rc
, 
mysql
);

2819 
rc
ð
	`mysql_qu”y
(
mysql
,"create view v1 (x)‡s select‡ from1 where‡ > 1");

2820 
	`check_mysql_rc
(
rc
, 
mysql
);

2821 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

2822 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

2823 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2825 
i
= 0; i < 3; i++)

2827 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

2828 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2829 
rc
= 0;

2830 
	`mysql_¡mt_ãtch
(
¡mt
è!ð
MYSQL_NO_DATA
)

2831 
rc
++;

2832 
	`FAIL_UNLESS
(
rc
 == 3, "rowcount != 3");

2834 
	`mysql_¡mt_þo£
(
¡mt
);

2836 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP VIEW v1");

2837 
	`check_mysql_rc
(
rc
, 
mysql
);

2838 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE1");

2839 
	`check_mysql_rc
(
rc
, 
mysql
);

2840  
OK
;

2841 
	}
}

2845 
	$‹¡_mªu®_§m¶e
(
MYSQL
 *
mysql
)

2847 
·¿m_couÁ
;

2848 
MYSQL_STMT
 *
¡mt
;

2849 
sm®l_d©a
;

2850 
št_d©a
;

2851 
rc
;

2852 
¡r_d©a
[50];

2853 
ulÚglÚg
 
afãùed_rows
;

2854 
MYSQL_BIND
 
my_bšd
[3];

2855 
my_boÞ
 
is_nuÎ
;

2856 
qu”y
[
MAX_TEST_QUERY_LENGTH
];

2864 
	`mem£t
(
¡r_d©a
, 0, (str_data));

2865 
	`mysql_autocomm™
(
mysql
, 1);

2866 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_table");

2867 
	`check_mysql_rc
(
rc
, 
mysql
);

2868 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_table(col1 int, col2 varchar(50), \
3 smallint, \
4imestamp)");

2871 
	`check_mysql_rc
(
rc
, 
mysql
);

2874 
	`¡rýy
(
qu”y
, "INSERT INTOest_table(col1, col2, col3) values(?, ?, ?)");

2875 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

2876 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

2877 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

2878 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2881 
·¿m_couÁ
ð
	`mysql_¡mt_·¿m_couÁ
(
¡mt
);

2882 
	`FAIL_IF
(
·¿m_couÁ
 != 3, "param_count != 3");

2884 
	`mem£t
(
my_bšd
, '\0', (my_bind));

2887 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

2888 
my_bšd
[0].
bufãr
ð(*)&
št_d©a
;

2891 
my_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_VAR_STRING
;

2892 
my_bšd
[1].
bufãr
ð(*)
¡r_d©a
;

2893 
my_bšd
[1].
bufãr_Ëngth
ð(
¡r_d©a
);

2896 
my_bšd
[2].
bufãr_ty³
ð
MYSQL_TYPE_SHORT
;

2897 
my_bšd
[2].
bufãr
ð(*)&
sm®l_d©a
;

2898 
my_bšd
[2].
is_nuÎ
= &is_null;

2899 
is_nuÎ
= 0;

2902 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

2903 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2906 
št_d©a
= 10;

2907 
	`¡rýy
(
¡r_d©a
, "MySQL");

2910 
is_nuÎ
= 1;

2913 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

2914 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2917 
afãùed_rows
ð
	`mysql_¡mt_afãùed_rows
(
¡mt
);

2918 
	`FAIL_IF
(
afãùed_rows
 != 1, "affected-rows != 1");

2921 
št_d©a
= 1000;

2922 
	`¡rýy
(
¡r_d©a
, "The most…opular open source database");

2923 
sm®l_d©a
= 1000;

2924 
is_nuÎ
= 0;

2927 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

2928 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2931 
afãùed_rows
ð
	`mysql_¡mt_afãùed_rows
(
¡mt
);

2933 
	`FAIL_IF
(
afãùed_rows
 != 1, "affected_rows != 1");

2936 
rc
ð
	`mysql_¡mt_þo£
(
¡mt
);

2937 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2940 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLEest_table");

2941 
	`check_mysql_rc
(
rc
, 
mysql
);

2942  
OK
;

2943 
	}
}

2945 
	$‹¡_ü—‹_drÝ
(
MYSQL
 *
mysql
)

2947 
MYSQL_STMT
 *
¡mt_ü—‹
, *
¡mt_drÝ
, *
¡mt_£Ëù
, *
¡mt_ü—‹_£Ëù
;

2948 *
qu”y
;

2949 
rc
, 
i
;

2951 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1,2");

2952 
	`check_mysql_rc
(
rc
, 
mysql
);

2954 
rc
ð
	`mysql_qu”y
(
mysql
, "createable2 (a int);");

2955 
	`check_mysql_rc
(
rc
, 
mysql
);

2957 
rc
ð
	`mysql_qu”y
(
mysql
, "createable1 (a int);");

2958 
	`check_mysql_rc
(
rc
, 
mysql
);

2960 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into2 values (3), (2), (1);");

2961 
	`check_mysql_rc
(
rc
, 
mysql
);

2963 
qu”y
= (*)"createable1 (a int)";

2964 
¡mt_ü—‹
ð
	`mysql_¡mt_š™
(
mysql
);

2965 
	`FAIL_IF
(!
¡mt_ü—‹
, 
	`mysql_”rÜ
(
mysql
));

2966 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt_ü—‹
, 
	`SL
(
qu”y
));

2967 
	`check_¡mt_rc
(
rc
, 
¡mt_ü—‹
);

2969 
qu”y
= (*)"dropable1";

2970 
¡mt_drÝ
ð
	`mysql_¡mt_š™
(
mysql
);

2971 
	`FAIL_IF
(!
¡mt_drÝ
, 
	`mysql_”rÜ
(
mysql
));

2972 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt_drÝ
, 
	`SL
(
qu”y
));

2973 
	`check_¡mt_rc
(
rc
, 
¡mt_drÝ
);

2975 
qu”y
= (*)"select‡ in (select‡ from2) from1";

2976 
¡mt_£Ëù
ð
	`mysql_¡mt_š™
(
mysql
);

2977 
	`FAIL_IF
(!
¡mt_£Ëù
, 
	`mysql_”rÜ
(
mysql
));

2978 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt_£Ëù
, 
	`SL
(
qu”y
));

2979 
	`check_¡mt_rc
(
rc
, 
¡mt_£Ëù
);

2981 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE1");

2982 
	`check_mysql_rc
(
rc
, 
mysql
);

2984 
qu”y
= (*)"createable1 select‡ from2";

2985 
¡mt_ü—‹_£Ëù
ð
	`mysql_¡mt_š™
(
mysql
);

2986 
	`FAIL_IF
(!
¡mt_ü—‹_£Ëù
, 
	`mysql_”rÜ
(
mysql
));

2987 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt_ü—‹_£Ëù
, 
	`SL
(
qu”y
));

2988 
	`check_¡mt_rc
(
rc
, 
¡mt_ü—‹_£Ëù
);

2990 
i
= 0; i < 3; i++)

2992 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt_ü—‹
);

2993 
	`check_¡mt_rc
(
rc
, 
¡mt_ü—‹
);

2995 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt_£Ëù
);

2996 
	`check_¡mt_rc
(
rc
, 
¡mt_£Ëù
);

2998 
rc
= 0;

2999 
	`mysql_¡mt_ãtch
(
¡mt_£Ëù
è!ð
MYSQL_NO_DATA
)

3000 
rc
++;

3001 
	`FAIL_UNLESS
(
rc
 == 0, "rowcount != 0");

3003 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt_drÝ
);

3004 
	`check_¡mt_rc
(
rc
, 
¡mt_drÝ
);

3006 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt_ü—‹_£Ëù
);

3007 
	`check_¡mt_rc
(
rc
, 
¡mt_ü—‹
);

3009 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt_£Ëù
);

3010 
	`check_¡mt_rc
(
rc
, 
¡mt_£Ëù
);

3011 
rc
= 0;

3012 
	`mysql_¡mt_ãtch
(
¡mt_£Ëù
è!ð
MYSQL_NO_DATA
)

3013 
rc
++;

3014 
	`FAIL_UNLESS
(
rc
 == 3, "rowcount != 3");

3016 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt_drÝ
);

3017 
	`check_¡mt_rc
(
rc
, 
¡mt_drÝ
);

3020 
	`mysql_¡mt_þo£
(
¡mt_ü—‹
);

3021 
	`mysql_¡mt_þo£
(
¡mt_drÝ
);

3022 
	`mysql_¡mt_þo£
(
¡mt_£Ëù
);

3023 
	`mysql_¡mt_þo£
(
¡mt_ü—‹_£Ëù
);

3025 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE2");

3026 
	`check_mysql_rc
(
rc
, 
mysql
);

3027  
OK
;

3028 
	}
}

3032 
	$‹¡_d©e
(
MYSQL
 *
mysql
)

3034 
rc
;

3036 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_date");

3037 
	`check_mysql_rc
(
rc
, 
mysql
);

3039 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_date(c1 TIMESTAMP, \
2 TIME, \
3 DATETIME, \
4 DATE)");

3044 
	`check_mysql_rc
(
rc
, 
mysql
);

3046 
rc
ð
	`‹¡_bšd_d©e_cÚv
(
mysql
, 5);

3047 
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_date");

3048  
rc
;

3049 
	}
}

3054 
	$‹¡_d©e_d©e
(
MYSQL
 *
mysql
)

3056 
rc
;

3059 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_date");

3060 
	`check_mysql_rc
(
rc
, 
mysql
);

3062 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_date(c1 DATE, \
2 DATE, \
3 DATE, \
4 DATE)");

3067 
	`check_mysql_rc
(
rc
, 
mysql
);

3069 
rc
ð
	`‹¡_bšd_d©e_cÚv
(
mysql
, 3);

3070 
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_date");

3071  
rc
;

3072 
	}
}

3076 
	$‹¡_d©e_ts
(
MYSQL
 *
mysql
)

3078 
rc
;

3081 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_date");

3082 
	`check_mysql_rc
(
rc
, 
mysql
);

3084 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_date(c1 TIMESTAMP, \
2 TIMESTAMP, \
3 TIMESTAMP, \
4 TIMESTAMP)");

3089 
	`check_mysql_rc
(
rc
, 
mysql
);

3091 
rc
ð
	`‹¡_bšd_d©e_cÚv
(
mysql
, 2);

3092 
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_date");

3093  
rc
;

3094 
	}
}

3099 
	$‹¡_d©e_dt
(
MYSQL
 *
mysql
)

3101 
rc
;

3104 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_date");

3105 
	`check_mysql_rc
(
rc
, 
mysql
);

3107 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_date(c1 datetime, "

3109 
	`check_mysql_rc
(
rc
, 
mysql
);

3111 
rc
ð
	`‹¡_bšd_d©e_cÚv
(
mysql
, 2);

3112 
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_date");

3113  
rc
;

3114 
	}
}

3118 
	$‹¡_d©e_time
(
MYSQL
 *
mysql
)

3120 
rc
;

3123 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_date");

3124 
	`check_mysql_rc
(
rc
, 
mysql
);

3126 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_date(c1 TIME, \
2 TIME, \
3 TIME, \
4 TIME)");

3131 
	`check_mysql_rc
(
rc
, 
mysql
);

3133 
rc
ð
	`‹¡_bšd_d©e_cÚv
(
mysql
, 3);

3134 
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_date");

3135  
rc
;

3136 
	}
}

3143 
	$‹¡_d©‘ime_¿nges
(
MYSQL
 *
mysql
)

3145 cÚ¡ *
¡mt_‹xt
;

3146 
rc
, 
i
;

3147 
MYSQL_STMT
 *
¡mt
;

3148 
MYSQL_BIND
 
my_bšd
[6];

3149 
MYSQL_TIME
 
tm
[6];

3151 ià(!
is_m¬Ÿdb
)

3152  
SKIP
;

3154 
¡mt_‹xt
= "dropable ifƒxists1";

3155 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

3156 
	`check_mysql_rc
(
rc
, 
mysql
);

3158 
¡mt_‹xt
= "createable1 (year datetime, month datetime, day datetime, "

3160 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

3161 
	`check_mysql_rc
(
rc
, 
mysql
);

3163 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

3164 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

3165 
¡mt_‹xt
= "INSERT INTO1 VALUES (?, ?, ?, ?, ?, ?)";

3166 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

3167 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3168 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
) != 6, "param_count != 6");

3170 
	`mem£t
(
my_bšd
, '\0', (my_bind));

3171 
i
= 0; i < 6; i++)

3173 
my_bšd
[
i
].
bufãr_ty³
ð
MYSQL_TYPE_DATETIME
;

3174 
my_bšd
[
i
].
bufãr
ð&
tm
[i];

3176 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

3177 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3179 
tm
[0].
y—r
ð2004;m[0].
mÚth
ð11;m[0].
day
= 10;

3180 
tm
[0].
hour
ð12;m[0].
mšu‹
ð30;m[0].
£cÚd
= 30;

3181 
tm
[0].
£cÚd_·¹
ð0;m[0].
Ãg
= 0;

3183 
tm
[5]=m[4]=m[3]=m[2]=m[1]=m[0];

3184 
tm
[0].
y—r
ð10000;m[1].
mÚth
ð13;m[2].
day
= 32;

3185 
tm
[3].
hour
ð24;m[4].
mšu‹
ð60;m[5].
£cÚd
= 60;

3187 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

3188 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3190 
	`FAIL_IF
(!
	`mysql_w¬nšg_couÁ
(
mysql
), "warningsƒxpected");

3192 ià(
	`v”ify_cÞ_d©a
(
mysql
, "t1", "year", "0000-00-00 00:00:00"))

3193 
”rÜ
;

3194 ià(
	`v”ify_cÞ_d©a
(
mysql
, "t1", "month", "0000-00-00 00:00:00"))

3195 
”rÜ
;

3196 ià(
	`v”ify_cÞ_d©a
(
mysql
, "t1", "day", "0000-00-00 00:00:00"))

3197 
”rÜ
;

3198 ià(
	`v”ify_cÞ_d©a
(
mysql
, "t1", "hour", "0000-00-00 00:00:00"))

3199 
”rÜ
;

3200 ià(
	`v”ify_cÞ_d©a
(
mysql
, "t1", "min", "0000-00-00 00:00:00"))

3201 
”rÜ
;

3202 ià(
	`v”ify_cÞ_d©a
(
mysql
, "t1", "sec", "0000-00-00 00:00:00"))

3203 
”rÜ
;

3205 
	`mysql_¡mt_þo£
(
¡mt
);

3207 
¡mt_‹xt
= "delete from1";

3208 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

3209 
	`check_mysql_rc
(
rc
, 
mysql
);

3211 
¡mt_‹xt
= "INSERT INTO1 (year, month, day) VALUES (?, ?, ?)";

3212 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

3213 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

3214 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

3215 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3220 
i
= 0; i < 3; i++)

3221 
my_bšd
[
i
].
bufãr_ty³
ð
MYSQL_TYPE_DATE
;

3223 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

3224 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3226 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

3227 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3228 
	`FAIL_IF
(!
	`mysql_w¬nšg_couÁ
(
mysql
), "warningsƒxpected");

3230 ià(
	`v”ify_cÞ_d©a
(
mysql
, "t1", "year", "0000-00-00 00:00:00"))

3231 
”rÜ
;

3232 ià(
	`v”ify_cÞ_d©a
(
mysql
, "t1", "month", "0000-00-00 00:00:00"))

3233 
”rÜ
;

3234 ià(
	`v”ify_cÞ_d©a
(
mysql
, "t1", "day", "0000-00-00 00:00:00"))

3235 
”rÜ
;

3237 
	`mysql_¡mt_þo£
(
¡mt
);

3239 
¡mt_‹xt
= "dropable1";

3240 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

3241 
	`check_mysql_rc
(
rc
, 
mysql
);

3243 
¡mt_‹xt
= "createable1 (day_ovflime, dayime, hourime, minime, secime)";

3244 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

3245 
	`check_mysql_rc
(
rc
, 
mysql
);

3247 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

3248 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

3249 
¡mt_‹xt
= "INSERT INTO1 VALUES (?,?,?,?,?)";

3250 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

3251 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3252 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
) != 5, "param_count != 5");

3257 
i
= 0; i < 5; i++)

3258 
my_bšd
[
i
].
bufãr_ty³
ð
MYSQL_TYPE_TIME
;

3260 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

3261 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3263 
tm
[0].
y—r
ð0;m[0].
mÚth
ð0;m[0].
day
= 10;

3264 
tm
[0].
hour
ð12;m[0].
mšu‹
ð30;m[0].
£cÚd
= 30;

3265 
tm
[0].
£cÚd_·¹
ð0;m[0].
Ãg
= 0;

3267 
tm
[4]=m[3]=m[2]=m[1]=m[0];

3268 
tm
[0].
day
ð35;m[1].dayð34;m[2].
hour
ð30;m[3].
mšu‹
ð60;m[4].
£cÚd
= 60;

3270 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

3271 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3272 
	`FAIL_IF
(
	`mysql_w¬nšg_couÁ
(
mysql
) != 2, "warning_count != 2");

3274 ià(
	`v”ify_cÞ_d©a
(
mysql
, "t1", "day_ovfl", "838:59:59"))

3275 
”rÜ
;

3276 ià(
	`v”ify_cÞ_d©a
(
mysql
, "t1", "day", "828:30:30"))

3277 
”rÜ
;

3278 ià(
	`v”ify_cÞ_d©a
(
mysql
, "t1", "hour", "270:30:30"))

3279 
”rÜ
;

3280 ià(
	`v”ify_cÞ_d©a
(
mysql
, "t1", "min", "00:00:00"))

3281 
”rÜ
;

3282 ià(
	`v”ify_cÞ_d©a
(
mysql
, "t1", "sec", "00:00:00"))

3283 
”rÜ
;

3285 
	`mysql_¡mt_þo£
(
¡mt
);

3286 
¡mt_‹xt
= "dropable1";

3287 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

3288 
	`check_mysql_rc
(
rc
, 
mysql
);

3289  
OK
;

3290 
”rÜ
:

3291 
	`mysql_¡mt_þo£
(
¡mt
);

3292 
¡mt_‹xt
= "dropable1";

3293 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

3294 
	`check_mysql_rc
(
rc
, 
mysql
);

3295  
OK
;

3296 
	}
}

3298 
	$‹¡_d”ived
(
MYSQL
 *
mysql
)

3300 
MYSQL_STMT
 *
¡mt
;

3301 
rc
, 
i
;

3302 
MYSQL_BIND
 
my_bšd
[1];

3303 
št32
 
my_v®
= 0;

3304 
ulÚg
 
my_Ëngth
= 0L;

3305 
my_boÞ
 
my_nuÎ
ð
FALSE
;

3306 cÚ¡ *
qu”y
=

3310 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

3311 
	`check_mysql_rc
(
rc
, 
mysql
);

3313 
rc
ð
	`mysql_qu”y
(
mysql
, "createable1 (id int(8),…rimary key (id)) \
=InnoDB DEFAULT CHARSET=utf8");

3315 
	`check_mysql_rc
(
rc
, 
mysql
);

3317 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into1 values (1)");

3318 
	`check_mysql_rc
(
rc
, 
mysql
);

3320 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

3321 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

3322 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

3323 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3325 
	`mem£t
(
my_bšd
, '\0', (my_bind));

3327 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

3328 
my_bšd
[0].
bufãr
ð(*)&
my_v®
;

3329 
my_bšd
[0].
Ëngth
ð&
my_Ëngth
;

3330 
my_bšd
[0].
is_nuÎ
ð&
my_nuÎ
;

3331 
my_v®
= 1;

3332 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

3333 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3335 
i
= 0; i < 3; i++)

3337 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

3338 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3339 
rc
= 0;

3340 !
	`mysql_¡mt_ãtch
(
¡mt
))

3341 
rc
++;

3342 
	`FAIL_UNLESS
(
rc
 == 1, "rowcount != 1");

3344 
	`mysql_¡mt_þo£
(
¡mt
);

3346 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE1");

3347 
	`check_mysql_rc
(
rc
, 
mysql
);

3348  
OK
;

3349 
	}
}

3351 
	$‹¡_di¡šù
(
MYSQL
 *
mysql
)

3353 
MYSQL_STMT
 *
¡mt
;

3354 
rc
, 
i
;

3355 cÚ¡ *
qu”y
=

3359 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

3360 
	`check_mysql_rc
(
rc
, 
mysql
);

3362 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE1 (a int , b int);");

3363 
	`check_mysql_rc
(
rc
, 
mysql
);

3365 
rc
ð
	`mysql_qu”y
(
mysql
,

3368 
	`check_mysql_rc
(
rc
, 
mysql
);

3370 
i
= 0; i < 3; i++)

3372 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

3373 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

3374 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

3375 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3376 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

3377 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3379 
rc
= 0;

3380 !
	`mysql_¡mt_ãtch
(
¡mt
))

3381 
rc
++;

3382 
	`FAIL_UNLESS
(
rc
 == 5, "rowcount != 5");

3383 
	`mysql_¡mt_þo£
(
¡mt
);

3386 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE1");

3387 
	`check_mysql_rc
(
rc
, 
mysql
);

3388  
OK
;

3389 
	}
}

3391 
	$‹¡_do_£t
(
MYSQL
 *
mysql
)

3393 
MYSQL_STMT
 *
¡mt_do
, *
¡mt_£t
;

3394 *
qu”y
;

3395 
rc
, 
i
;

3397 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

3398 
	`check_mysql_rc
(
rc
, 
mysql
);

3400 
rc
ð
	`mysql_qu”y
(
mysql
, "createable1 (a int)");

3401 
	`check_mysql_rc
(
rc
, 
mysql
);

3403 
qu”y
= (*)"do @var:=(1 in (select * from1))";

3404 
¡mt_do
ð
	`mysql_¡mt_š™
(
mysql
);

3405 
	`FAIL_IF
(!
¡mt_do
, 
	`mysql_”rÜ
(
mysql
));

3406 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt_do
, 
	`SL
(
qu”y
));

3407 
	`check_¡mt_rc
(
rc
, 
¡mt_do
);

3409 
qu”y
= (*)"set @var=(1 in (select * from1))";

3410 
¡mt_£t
ð
	`mysql_¡mt_š™
(
mysql
);

3411 
	`FAIL_IF
(!
¡mt_£t
, 
	`mysql_”rÜ
(
mysql
));

3412 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt_£t
, 
	`SL
(
qu”y
));

3413 
	`check_¡mt_rc
(
rc
, 
¡mt_£t
);

3415 
i
= 0; i < 3; i++)

3417 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt_do
);

3418 
	`check_¡mt_rc
(
rc
, 
¡mt_do
);

3419 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt_£t
);

3420 
	`check_¡mt_rc
(
rc
, 
¡mt_£t
);

3423 
	`mysql_¡mt_þo£
(
¡mt_do
);

3424 
	`mysql_¡mt_þo£
(
¡mt_£t
);

3425  
OK
;

3426 
	}
}

3428 
	$‹¡_doubË_com·»
(
MYSQL
 *
mysql
)

3430 
MYSQL_STMT
 *
¡mt
;

3431 
rc
;

3432 
»®_d©a
[10], 
tšy_d©a
;

3433 
doubË_d©a
;

3434 
MYSQL_RES
 *
»suÉ
;

3435 
MYSQL_BIND
 
my_bšd
[3];

3436 
ulÚg
 
Ëngth
[3];

3437 
qu”y
[
MAX_TEST_QUERY_LENGTH
];

3440 
rc
ð
	`mysql_autocomm™
(
mysql
, 
TRUE
);

3441 
	`check_mysql_rc
(
rc
, 
mysql
);

3443 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_double_compare");

3444 
	`check_mysql_rc
(
rc
, 
mysql
);

3446 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_double_compare(col1inyint, "

3448 
	`check_mysql_rc
(
rc
, 
mysql
);

3450 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTOest_double_compare "

3452 
	`check_mysql_rc
(
rc
, 
mysql
);

3454 
	`¡rýy
(
qu”y
, "UPDATEest_double_compare SET col1=100 "

3456 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

3457 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

3458 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

3459 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3461 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
) != 3, "param_count != 3");

3463 
	`mem£t
(
my_bšd
, '\0', (my_bind));

3466 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_TINY
;

3467 
my_bšd
[0].
bufãr
ð(*)&
tšy_d©a
;

3470 
my_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

3471 
my_bšd
[1].
bufãr
ð(*)&
»®_d©a
;

3472 
my_bšd
[1].
bufãr_Ëngth
ð(
»®_d©a
);

3473 
my_bšd
[1].
Ëngth
= &length[1];

3476 
my_bšd
[2].
bufãr_ty³
ð
MYSQL_TYPE_DOUBLE
;

3477 
my_bšd
[2].
bufãr
ð(*)&
doubË_d©a
;

3479 
tšy_d©a
= 1;

3480 
	`¡rýy
(
»®_d©a
, "10.2");

3481 
Ëngth
[1]ð(
ulÚg
)
	`¡¾’
(
»®_d©a
);

3482 
doubË_d©a
= 34.5;

3483 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

3484 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3486 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

3487 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3489 
	`FAIL_IF
(
	`mysql_¡mt_afãùed_rows
(
¡mt
), "affected_rows != 0");

3491 
	`mysql_¡mt_þo£
(
¡mt
);

3494 
rc
ð
	`mysql_comm™
(
mysql
);

3495 
	`check_mysql_rc
(
rc
, 
mysql
);

3498 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT * FROMest_double_compare");

3499 
	`check_mysql_rc
(
rc
, 
mysql
);

3502 
»suÉ
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

3503 
	`FAIL_IF
(!
»suÉ
, "Invalid„esult set");

3505 
rc
= 0;

3506 
	`mysql_ãtch_row
(
»suÉ
))

3507 
rc
++;

3508 
	`FAIL_UNLESS
(()
tšy_d©a
 =ð
rc
, "rowcount !=inydata");

3509 
	`mysql_ä“_»suÉ
(
»suÉ
);

3510 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_double_compare");

3511 
	`check_mysql_rc
(
rc
, 
mysql
);

3512  
OK
;

3513 
	}
}

3515 
	$‹¡_muÉi
(
MYSQL
 *
mysql
)

3517 
MYSQL_STMT
 *
¡mt_d–‘e
, *
¡mt_upd©e
, *
¡mt_£Ëù1
, *
¡mt_£Ëù2
;

3518 *
qu”y
;

3519 
MYSQL_BIND
 
my_bšd
[1];

3520 
rc
, 
i
;

3521 
št32
 
·¿m
= 1;

3522 
ulÚg
 
Ëngth
= 1;

3528 
	`mem£t
(
my_bšd
, '\0', (my_bind));

3530 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

3531 
my_bšd
[0].
bufãr
ð(*)&
·¿m
;

3532 
my_bšd
[0].
Ëngth
= &length;

3534 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1,2");

3535 
	`check_mysql_rc
(
rc
, 
mysql
);

3537 
rc
ð
	`mysql_qu”y
(
mysql
, "createable1 (a int, b int)");

3538 
	`check_mysql_rc
(
rc
, 
mysql
);

3540 
rc
ð
	`mysql_qu”y
(
mysql
, "createable2 (a int, b int)");

3541 
	`check_mysql_rc
(
rc
, 
mysql
);

3543 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into1 values (3, 3), (2, 2), (1, 1)");

3544 
	`check_mysql_rc
(
rc
, 
mysql
);

3546 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into2 values (3, 3), (2, 2), (1, 1)");

3547 
	`check_mysql_rc
(
rc
, 
mysql
);

3549 
qu”y
= (*)"delete1,2 from1,2 where1.a=t2.a‡nd1.b=10";

3550 
¡mt_d–‘e
ð
	`mysql_¡mt_š™
(
mysql
);

3551 
	`FAIL_IF
(!
¡mt_d–‘e
, 
	`mysql_”rÜ
(
mysql
));

3552 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt_d–‘e
, 
	`SL
(
qu”y
));

3553 
	`check_¡mt_rc
(
rc
, 
¡mt_d–‘e
);

3555 
qu”y
= (*)"update1,2 set1.b=10,2.b=10 where1.a=t2.a‡nd1.b=?";

3556 
¡mt_upd©e
ð
	`mysql_¡mt_š™
(
mysql
);

3557 
	`FAIL_IF
(!
¡mt_upd©e
, 
	`mysql_”rÜ
(
mysql
));

3558 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt_upd©e
, 
	`SL
(
qu”y
));

3559 
	`check_¡mt_rc
(
rc
, 
¡mt_upd©e
);

3561 
qu”y
= (*)"select * from1";

3562 
¡mt_£Ëù1
ð
	`mysql_¡mt_š™
(
mysql
);

3563 
	`FAIL_IF
(!
¡mt_£Ëù1
, 
	`mysql_”rÜ
(
mysql
));

3564 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt_£Ëù1
, 
	`SL
(
qu”y
));

3565 
	`check_¡mt_rc
(
rc
, 
¡mt_£Ëù1
);

3567 
qu”y
= (*)"select * from2";

3568 
¡mt_£Ëù2
ð
	`mysql_¡mt_š™
(
mysql
);

3569 
	`FAIL_IF
(!
¡mt_£Ëù2
, 
	`mysql_”rÜ
(
mysql
));

3570 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt_£Ëù2
, 
	`SL
(
qu”y
));

3571 
	`check_¡mt_rc
(
rc
, 
¡mt_£Ëù2
);

3573 
i
= 0; i < 3; i++)

3575 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt_upd©e
, 
my_bšd
);

3576 
	`check_¡mt_rc
(
rc
, 
¡mt_upd©e
);

3578 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt_upd©e
);

3579 
	`check_¡mt_rc
(
rc
, 
¡mt_upd©e
);

3581 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt_d–‘e
);

3582 
	`check_¡mt_rc
(
rc
, 
¡mt_d–‘e
);

3584 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt_£Ëù1
);

3585 
	`check_¡mt_rc
(
rc
, 
¡mt_£Ëù1
);

3586 
rc
= 0;

3587 !
	`mysql_¡mt_ãtch
(
¡mt_£Ëù1
))

3588 
rc
++;

3589 
	`FAIL_UNLESS
(
rc
 =ð3-
·¿m
, "rc != 3 -…aram");

3591 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt_£Ëù2
);

3592 
	`check_¡mt_rc
(
rc
, 
¡mt_£Ëù2
);

3593 
rc
= 0;

3594 !
	`mysql_¡mt_ãtch
(
¡mt_£Ëù2
))

3595 
rc
++;

3596 
	`FAIL_UNLESS
(
rc
 =ð3-
·¿m
, "rc != 3 -…aram");

3598 
·¿m
++;

3601 
	`mysql_¡mt_þo£
(
¡mt_d–‘e
);

3602 
	`mysql_¡mt_þo£
(
¡mt_upd©e
);

3603 
	`mysql_¡mt_þo£
(
¡mt_£Ëù1
);

3604 
	`mysql_¡mt_þo£
(
¡mt_£Ëù2
);

3605 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable1,2");

3606 
	`check_mysql_rc
(
rc
, 
mysql
);

3608  
OK
;

3609 
	}
}

3613 
	$‹¡_muÉi_¡mt
(
MYSQL
 *
mysql
)

3616 
MYSQL_STMT
 *
¡mt
, *
¡mt1
, *
¡mt2
;

3617 
rc
;

3618 
ušt32
 
id
;

3619 
Çme
[50];

3620 
MYSQL_BIND
 
my_bšd
[2];

3621 
ulÚg
 
Ëngth
[2];

3622 
my_boÞ
 
is_nuÎ
[2];

3623 cÚ¡ *
qu”y
;

3625 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_multi_table");

3626 
	`check_mysql_rc
(
rc
, 
mysql
);

3628 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_multi_table(id int,‚ame char(20))");

3629 
	`check_mysql_rc
(
rc
, 
mysql
);

3631 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTOest_multi_table values(10, 'mysql')");

3632 
	`check_mysql_rc
(
rc
, 
mysql
);

3634 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

3635 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

3636 
qu”y
= "SELECT * FROMest_multi_table WHERE id=?";

3637 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

3638 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3640 
¡mt2
ð
	`mysql_¡mt_š™
(
mysql
);

3641 
	`FAIL_IF
(!
¡mt2
, 
	`mysql_”rÜ
(
mysql
));

3642 
qu”y
= "UPDATEest_multi_table SET‚ame='updated' WHERE id=10";

3643 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt2
, 
	`SL
(
qu”y
));

3644 
	`check_¡mt_rc
(
rc
, 
¡mt2
);

3646 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
) != 1, "param_count != 1");

3648 
	`mem£t
(
my_bšd
, '\0', (my_bind));

3650 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

3651 
my_bšd
[0].
bufãr
ð(*)&
id
;

3652 
my_bšd
[0].
is_nuÎ
= &is_null[0];

3653 
my_bšd
[0].
Ëngth
= &length[0];

3654 
is_nuÎ
[0]= 0;

3655 
Ëngth
[0]= 0;

3657 
my_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

3658 
my_bšd
[1].
bufãr
ð(*)
Çme
;

3659 
my_bšd
[1].
bufãr_Ëngth
ð(
Çme
);

3660 
my_bšd
[1].
Ëngth
= &length[1];

3661 
my_bšd
[1].
is_nuÎ
= &is_null[1];

3663 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

3664 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3666 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

3667 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3669 
id
= 10;

3670 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

3671 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3673 
id
= 999;

3674 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

3675 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3677 
	`FAIL_UNLESS
(
id
 == 10, "id != 10");

3678 
	`FAIL_UNLESS
(
	`¡rcmp
(
Çme
, "mysql") == 0, "name != 'mysql'");

3680 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

3681 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "");

3684 
¡mt1
ð
	`mysql_¡mt_š™
(
mysql
);

3685 
	`FAIL_IF
(!
¡mt1
, 
	`mysql_”rÜ
(
mysql
));

3686 
qu”y
= "DELETE FROMest_multi_table WHERE id=? AND CONVERT(name USING utf8)=?";

3687 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt1
, 
	`SL
(
qu”y
));

3688 
	`check_¡mt_rc
(
rc
, 
¡mt1
);

3690 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt1
) != 2, "param_count != 2");

3692 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt1
, 
my_bšd
);

3693 
	`check_¡mt_rc
(
rc
, 
¡mt1
);

3695 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt2
);

3696 
	`check_¡mt_rc
(
rc
, 
¡mt2
);

3698 
	`FAIL_IF
(
	`mysql_¡mt_afãùed_rows
(
¡mt2
) != 1, "affected_rows != 1");

3700 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

3701 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3703 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

3704 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3706 
	`FAIL_UNLESS
(
id
 == 10, "id != 10");

3707 
	`FAIL_UNLESS
(
	`¡rcmp
(
Çme
, "updated") == 0, "name != 'updated'");

3709 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

3710 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

3712 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt1
);

3713 
	`check_¡mt_rc
(
rc
, 
¡mt1
);

3715 
	`FAIL_IF
(
	`mysql_¡mt_afãùed_rows
(
¡mt1
) != 1, "affected_rows != 1");

3717 
	`mysql_¡mt_þo£
(
¡mt1
);

3719 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

3720 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3722 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

3723 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

3725 
rc
ð
	`my_¡mt_»suÉ
(
mysql
, "SELECT * FROMest_multi_table");

3726 
	`FAIL_UNLESS
(
rc
 == 0, "rc != 0");

3728 
	`mysql_¡mt_þo£
(
¡mt
);

3729 
	`mysql_¡mt_þo£
(
¡mt2
);

3730 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_multi_table");

3731 
	`check_mysql_rc
(
rc
, 
mysql
);

3733  
OK
;

3734 
	}
}

3738 
	$‹¡_n¡mts
(
MYSQL
 *
mysql
)

3740 
MYSQL_STMT
 *
¡mt
;

3741 
qu”y
[255];

3742 
rc
;

3743 
ušt
 
i
, 
tÙ®_¡mts
= 2000;

3744 
MYSQL_BIND
 
my_bšd
[1];

3746 
SKIP_SKYSQL
;

3748 
	`mysql_autocomm™
(
mysql
, 
TRUE
);

3750 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_nstmts");

3751 
	`check_mysql_rc
(
rc
, 
mysql
);

3753 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_nstmts(id int)");

3754 
	`check_mysql_rc
(
rc
, 
mysql
);

3756 
	`mem£t
(
my_bšd
, '\0', (my_bind));

3758 
my_bšd
[0].
bufãr
ð(*)&
i
;

3759 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

3761 
i
ð0; i < 
tÙ®_¡mts
; i++)

3763 
	`¡rýy
(
qu”y
, "insert intoest_nstmts values(?)");

3764 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

3765 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

3766 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

3767 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3769 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

3770 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3772 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

3773 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3775 
	`mysql_¡mt_þo£
(
¡mt
);

3778 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

3779 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

3780 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(" select count(*) fromest_nstmts"));

3781 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3783 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

3784 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3786 
i
= 0;

3787 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

3788 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3790 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

3791 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3792 
	`FAIL_UNLESS
Ð
i
 =ð
tÙ®_¡mts
, "total_stmts != i");

3794 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

3795 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

3797 
	`mysql_¡mt_þo£
(
¡mt
);

3799 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLEest_nstmts");

3800 
	`check_mysql_rc
(
rc
, 
mysql
);

3801  
OK
;

3802 
	}
}

3806 
	$‹¡_nuÎ
(
MYSQL
 *
mysql
)

3808 
MYSQL_STMT
 *
¡mt
;

3809 
rc
;

3810 
ušt
 
nD©a
;

3811 
MYSQL_BIND
 
my_bšd
[2];

3812 
my_boÞ
 
is_nuÎ
[2];

3813 
qu”y
[
MAX_TEST_QUERY_LENGTH
];

3816 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_null");

3817 
	`check_mysql_rc
(
rc
, 
mysql
);

3819 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_null(col1 int, col2 varchar(50))");

3820 
	`check_mysql_rc
(
rc
, 
mysql
);

3822 
rc
ð
	`mysql_qu”y
(
mysql
, "FLUSH TABLES");

3823 
	`check_mysql_rc
(
rc
, 
mysql
);

3825 
rc
ð
	`mysql_qu”y
(
mysql
, "START TRANSACTION");

3826 
	`check_mysql_rc
(
rc
, 
mysql
);

3829 
	`¡rýy
(
qu”y
, "INSERT INTOest_null(col3, col2) VALUES(?, ?)");

3830 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

3831 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

3832 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

3833 
	`FAIL_IF
(!
rc
, "Errorƒxpected");

3834 
	`mysql_¡mt_þo£
(
¡mt
);

3836 
	`¡rýy
(
qu”y
, "INSERT INTOest_null(col1, col2) VALUES(?, ?)");

3837 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

3838 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

3839 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

3840 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3842 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
) != 2, "param_count != 2");

3844 
	`mem£t
(
my_bšd
, '\0', (my_bind));

3846 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

3847 
my_bšd
[0].
is_nuÎ
= &is_null[0];

3848 
is_nuÎ
[0]= 1;

3849 
my_bšd
[1]= my_bind[0];

3851 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

3852 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3855 
nD©a
= 0;‚Data<10;‚Data++)

3857 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

3858 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3862 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_NULL
;

3863 
is_nuÎ
[0]= 0;

3864 
my_bšd
[1]= my_bind[0];

3866 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

3867 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3869 
nD©a
= 0;‚Data<10;‚Data++)

3871 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

3872 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3875 
	`mysql_¡mt_þo£
(
¡mt
);

3878 
rc
ð
	`mysql_comm™
(
mysql
);

3879 
	`check_mysql_rc
(
rc
, 
mysql
);

3881 
nD©a
*= 2;

3882 
rc
ð
	`my_¡mt_»suÉ
(
mysql
, "SELECT * FROMest_null");;

3883 
	`FAIL_UNLESS
((è
nD©a
 =ð
rc
, "rc !=‚data");

3886 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

3887 
my_bšd
[0].
bufãr
ð(*)&
nD©a
;

3888 
my_bšd
[0].
Ëngth
= 0;

3889 
my_bšd
[1]= my_bind[0];

3890 
my_bšd
[0].
is_nuÎ
= &is_null[0];

3891 
my_bšd
[1].
is_nuÎ
= &is_null[1];

3893 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

3894 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

3895 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("SELECT * FROMest_null"));

3896 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3898 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

3899 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3901 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

3902 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3904 
rc
= 0;

3905 
is_nuÎ
[0]= is_null[1]= 0;

3906 
	`mysql_¡mt_ãtch
(
¡mt
è!ð
MYSQL_NO_DATA
)

3908 
	`FAIL_UNLESS
(
is_nuÎ
[0], "!is_null");

3909 
	`FAIL_UNLESS
(
is_nuÎ
[1], "!is_null");

3910 
rc
++;

3911 
is_nuÎ
[0]= is_null[1]= 0;

3913 
	`FAIL_UNLESS
(
rc
 =ð(è
nD©a
, "rc !=‚Data");

3914 
	`mysql_¡mt_þo£
(
¡mt
);

3915 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_null");

3916 
	`check_mysql_rc
(
rc
, 
mysql
);

3917  
OK
;

3918 
	}
}

3920 
	$‹¡_Üd”_·¿m
(
MYSQL
 *
mysql
)

3922 
MYSQL_STMT
 *
¡mt
;

3923 
rc
;

3924 cÚ¡ *
qu”y
;

3926 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

3927 
	`check_mysql_rc
(
rc
, 
mysql
);

3929 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE1(a INT, b char(10))");

3930 
	`check_mysql_rc
(
rc
, 
mysql
);

3932 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

3933 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

3934 
qu”y
= "select sum(a) + 200, 1 from1 "

3937 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

3938 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3939 
	`mysql_¡mt_þo£
(
¡mt
);

3941 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

3942 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

3943 
qu”y
= "select sum(a) + 200, ? from1 group by b "

3946 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

3947 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3948 
	`mysql_¡mt_þo£
(
¡mt
);

3950 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

3951 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

3952 
qu”y
= "select sum(a) + 200, ? from1 "

3955 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

3956 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3957 
	`mysql_¡mt_þo£
(
¡mt
);

3959 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE1");

3960 
	`check_mysql_rc
(
rc
, 
mysql
);

3961  
OK
;

3962 
	}
}

3964 
	$‹¡_»Çme
(
MYSQL
 *
mysql
)

3966 
MYSQL_STMT
 *
¡mt
;

3967 cÚ¡ *
qu”y
= "renameable1o2,3o4";

3968 
rc
;

3970 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1,2,3,4");

3971 
	`check_mysql_rc
(
rc
, 
mysql
);

3973 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

3974 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

3975 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

3976 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3978 
rc
ð
	`mysql_qu”y
(
mysql
, "createable1 (a int)");

3979 
	`check_mysql_rc
(
rc
, 
mysql
);

3981 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

3982 
	`FAIL_IF
(!
rc
, "Errorƒxpected");

3984 
rc
ð
	`mysql_qu”y
(
mysql
, "createable3 (a int)");

3985 
	`check_mysql_rc
(
rc
, 
mysql
);

3987 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

3988 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3990 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

3991 
	`FAIL_IF
(!
rc
, "Errrƒxpected");

3993 
rc
ð
	`mysql_qu”y
(
mysql
, "renameable2o1,4o3");

3994 
	`check_mysql_rc
(
rc
, 
mysql
);

3996 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

3997 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3999 
	`mysql_¡mt_þo£
(
¡mt
);

4001 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE2,4");

4002 
	`check_mysql_rc
(
rc
, 
mysql
);

4003  
OK
;

4004 
	}
}

4006 
	$‹¡_»wšd
(
MYSQL
 *
mysql
)

4008 
MYSQL_STMT
 *
¡mt
;

4009 
MYSQL_BIND
 
my_bšd
;

4010 
rc
 = 0;

4011 cÚ¡ *
¡mt_‹xt
;

4012 
Ëngth
=4, 
D©a
=0;

4013 
my_boÞ
 
i¢uÎ
=0;

4016 
¡mt_‹xt
= "CREATE TABLE1 (a int)";

4017 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

4018 
	`check_mysql_rc
(
rc
, 
mysql
);

4019 
¡mt_‹xt
= "INSERT INTO1 VALUES(2),(3),(4)";

4020 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

4021 
	`check_mysql_rc
(
rc
, 
mysql
);

4023 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

4024 
¡mt_‹xt
= "SELECT * FROM1";

4025 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

4026 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4028 
	`mem£t
(&
my_bšd
, '\0', (
MYSQL_BIND
));

4029 
my_bšd
.
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

4030 
my_bšd
.
bufãr
ð(*)&
D©a
;

4031 
my_bšd
.
Ëngth
= &length;

4032 
my_bšd
.
is_nuÎ
ð&
i¢uÎ
;

4034 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

4035 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4037 
rc
ð
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

4038 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4040 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, &
my_bšd
);

4041 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4044 !(
rc
=
	`mysql_¡mt_ãtch
(
¡mt
)));

4045 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

4048 
	`mysql_¡mt_d©a_£ek
(
¡mt
, 0);

4052 !(
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
)));

4054 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

4056 
¡mt_‹xt
= "DROP TABLE1";

4057 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

4058 
	`check_mysql_rc
(
rc
, 
mysql
);

4059 
rc
ð
	`mysql_¡mt_ä“_»suÉ
(
¡mt
);

4060 
rc
ð
	`mysql_¡mt_þo£
(
¡mt
);

4061  
OK
;

4062 
	}
}

4066 
	$‹¡_£Ëù
(
MYSQL
 *
mysql
)

4068 
MYSQL_STMT
 *
¡mt
;

4069 
rc
;

4070 
szD©a
[25];

4071 
nD©a
= 1;

4072 
MYSQL_BIND
 
my_bšd
[2];

4073 
ulÚg
 
Ëngth
[2];

4074 
qu”y
[
MAX_TEST_QUERY_LENGTH
];

4077 
rc
ð
	`mysql_autocomm™
(
mysql
, 
TRUE
);

4078 
	`check_mysql_rc
(
rc
, 
mysql
);

4080 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_select");

4081 
	`check_mysql_rc
(
rc
, 
mysql
);

4083 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_select(id int,‚ame varchar(50))");

4084 
	`check_mysql_rc
(
rc
, 
mysql
);

4087 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTOest_select VALUES(10, 'venu')");

4088 
	`check_mysql_rc
(
rc
, 
mysql
);

4091 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTOest_select VALUES(20, 'mysql')");

4092 
	`check_mysql_rc
(
rc
, 
mysql
);

4094 
rc
ð
	`mysql_comm™
(
mysql
);

4095 
	`check_mysql_rc
(
rc
, 
mysql
);

4097 
	`¡rýy
(
qu”y
, "SELECT * FROMest_select WHERE id= ? "

4099 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

4100 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

4101 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

4102 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4104 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
) != 2, "param_count != 2");

4106 
	`mem£t
(
my_bšd
, '\0', (my_bind));

4109 
nD©a
= 10;

4110 
	`¡rýy
(
szD©a
, (*)"venu");

4111 
my_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

4112 
my_bšd
[1].
bufãr
ð(*)
szD©a
;

4113 
my_bšd
[1].
bufãr_Ëngth
= 4;

4114 
my_bšd
[1].
Ëngth
= &length[1];

4115 
Ëngth
[1]= 4;

4117 
my_bšd
[0].
bufãr
ð(*)&
nD©a
;

4118 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

4120 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

4121 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4123 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

4124 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4126 
rc
= 0;

4127 !
	`mysql_¡mt_ãtch
(
¡mt
))

4128 
rc
++;

4129 
	`FAIL_UNLESS
(
rc
 == 1, "rc != 1");

4131 
	`mysql_¡mt_þo£
(
¡mt
);

4132 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_select");

4133 
	`check_mysql_rc
(
rc
, 
mysql
);

4134  
OK
;

4135 
	}
}

4139 
	$‹¡_£Ëù_´•¬e
(
MYSQL
 *
mysql
)

4141 
rc
;

4142 
MYSQL_STMT
 *
¡mt
;

4145 
rc
ð
	`mysql_autocomm™
(
mysql
, 
TRUE
);

4146 
	`check_mysql_rc
(
rc
, 
mysql
);

4148 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_select");

4149 
	`check_mysql_rc
(
rc
, 
mysql
);

4151 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_select(id int,‚ame varchar(50))");

4152 
	`check_mysql_rc
(
rc
, 
mysql
);

4155 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTOest_select VALUES(10, 'venu')");

4156 
	`check_mysql_rc
(
rc
, 
mysql
);

4158 
rc
ð
	`mysql_comm™
(
mysql
);

4159 
	`check_mysql_rc
(
rc
, 
mysql
);

4161 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

4162 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

4163 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("SELECT * FROMest_select"));

4164 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4166 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

4167 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4169 
rc
= 0;

4170 !
	`mysql_¡mt_ãtch
(
¡mt
))

4171 
rc
++;

4172 
	`FAIL_UNLESS
(
rc
 == 1, "rowcount != 1");

4173 
	`mysql_¡mt_þo£
(
¡mt
);

4175 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLEest_select");

4176 
	`check_mysql_rc
(
rc
, 
mysql
);

4178 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_select(idinyint, id1 int, "

4181 
	`check_mysql_rc
(
rc
, 
mysql
);

4184 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTOest_select(id, id1, id2,‚ame) VALUES(10, 5, 2.3, 'venu')");

4185 
	`check_mysql_rc
(
rc
, 
mysql
);

4187 
rc
ð
	`mysql_comm™
(
mysql
);

4188 
	`check_mysql_rc
(
rc
, 
mysql
);

4190 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

4191 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

4192 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("SELECT * FROMest_select"));

4193 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4195 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

4196 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4198 
rc
= 0;

4199 !
	`mysql_¡mt_ãtch
(
¡mt
))

4200 
rc
++;

4201 
	`FAIL_UNLESS
(
rc
 == 1, "rowcount != 1");

4202 
	`mysql_¡mt_þo£
(
¡mt
);

4203 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_select");

4204 
	`check_mysql_rc
(
rc
, 
mysql
);

4205  
OK
;

4206 
	}
}

4210 
	$‹¡_£Ëù_show_bË
(
MYSQL
 *
mysql
)

4212 
MYSQL_STMT
 *
¡mt
;

4213 
rc
, 
i
;

4215 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

4216 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

4217 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("SHOW TABLES FROM mysql"));

4218 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4220 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
), "param_count != 0");

4222 
i
= 1; i < 3; i++)

4224 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

4225 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4228 !
	`mysql_¡mt_ãtch
(
¡mt
));

4229 
	`mysql_¡mt_þo£
(
¡mt
);

4230  
OK
;

4231 
	}
}

4235 
	$‹¡_£Ëù_v”siÚ
(
MYSQL
 *
mysql
)

4237 
MYSQL_STMT
 *
¡mt
;

4238 
rc
;

4241 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

4242 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

4243 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("SELECT @@version"));

4244 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4246 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
), "param_count != 0");

4248 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

4249 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4251 !
	`mysql_¡mt_ãtch
(
¡mt
));

4252 
	`mysql_¡mt_þo£
(
¡mt
);

4253  
OK
;

4254 
	}
}

4256 
	$‹¡_£Ëùtmp
(
MYSQL
 *
mysql
)

4258 
MYSQL_STMT
 *
¡mt
;

4259 
rc
, 
i
;

4260 cÚ¡ *
qu”y
= "select‡, (select count(distinct1.b)‡s sum from1,2 where1.a=t2.a‡nd2.b > 0‡nd1.a <=3.b group by1.a order by sum†imit 1) from3";

4263 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1,2,3");

4264 
	`check_mysql_rc
(
rc
, 
mysql
);

4266 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE1 (a int , b int);");

4267 
	`check_mysql_rc
(
rc
, 
mysql
);

4269 
rc
ð
	`mysql_qu”y
(
mysql
, "createable2 (a int, b int);");

4270 
	`check_mysql_rc
(
rc
, 
mysql
);

4272 
rc
ð
	`mysql_qu”y
(
mysql
, "createable3 (a int, b int);");

4273 
	`check_mysql_rc
(
rc
, 
mysql
);

4275 
rc
ð
	`mysql_qu”y
(
mysql
,

4278 
	`check_mysql_rc
(
rc
, 
mysql
);

4279 
rc
ð
	`mysql_qu”y
(
mysql
,

4281 
	`check_mysql_rc
(
rc
, 
mysql
);

4282 
rc
ð
	`mysql_qu”y
(
mysql
,

4284 
	`check_mysql_rc
(
rc
, 
mysql
);

4286 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

4287 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

4288 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

4289 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4290 
i
= 0; i < 3; i++)

4292 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

4293 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4294 
rc
= 0;

4295 !
	`mysql_¡mt_ãtch
(
¡mt
))

4296 
rc
++;

4297 
	`FAIL_UNLESS
(
rc
 == 3, "rowcount != 3");

4299 
	`mysql_¡mt_þo£
(
¡mt
);

4301 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE1,2,3");

4302 
	`check_mysql_rc
(
rc
, 
mysql
);

4303  
OK
;

4304 
	}
}

4306 
	$‹¡_£t_ÝtiÚ
(
MYSQL
 *
mysql
)

4308 
MYSQL_STMT
 *
¡mt
;

4309 
MYSQL_RES
 *
»suÉ
;

4310 
rc
;

4313 
	`mysql_autocomm™
(
mysql
, 
TRUE
);

4316 
rc
ð
	`mysql_qu”y
(
mysql
, "SET SQL_SELECT_LIMIT= 2");

4317 
	`check_mysql_rc
(
rc
, 
mysql
);

4319 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_limit");

4320 
	`check_mysql_rc
(
rc
, 
mysql
);

4322 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_limit(ainyint)");

4323 
	`check_mysql_rc
(
rc
, 
mysql
);

4325 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTOest_limit VALUES(10), (20), (30), (40)");

4326 
	`check_mysql_rc
(
rc
, 
mysql
);

4328 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT * FROMest_limit");

4329 
	`check_mysql_rc
(
rc
, 
mysql
);

4331 
»suÉ
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

4332 
	`FAIL_IF
(!
»suÉ
, "Invalid„esult set");

4334 
rc
= 0;

4335 
	`mysql_ãtch_row
(
»suÉ
))

4336 
rc
++;

4337 
	`FAIL_UNLESS
(
rc
 == 2, "rowcunt != 2");

4338 
	`mysql_ä“_»suÉ
(
»suÉ
);

4340 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

4341 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

4342 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("SELECT * FROMest_limit"));

4343 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4345 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

4346 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4348 
rc
= 0;

4349 !
	`mysql_¡mt_ãtch
(
¡mt
))

4350 
rc
++;

4351 
	`FAIL_UNLESS
(
rc
 == 2, "");

4353 
	`mysql_¡mt_þo£
(
¡mt
);

4356 
rc
ð
	`mysql_qu”y
(
mysql
, "SET SQL_SELECT_LIMIT=DEFAULT");

4357 
	`check_mysql_rc
(
rc
, 
mysql
);

4359 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

4360 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

4361 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("SELECT * FROMest_limit"));

4362 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4364 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

4365 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4367 
rc
= 0;

4368 !
	`mysql_¡mt_ãtch
(
¡mt
))

4369 
rc
++;

4370 
	`FAIL_UNLESS
(
rc
 == 4, "rowcount != 4");

4372 
	`mysql_¡mt_þo£
(
¡mt
);

4373 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_limit");

4374 
	`check_mysql_rc
(
rc
, 
mysql
);

4375  
OK
;

4376 
	}
}

4380 
	$‹¡_£t_v¬ŸbË
(
MYSQL
 *
mysql
)

4382 
MYSQL_STMT
 *
¡mt
, *
¡mt1
;

4383 
rc
;

4384 
£t_couÁ
, 
def_couÁ
, 
g‘_couÁ
;

4385 
ulÚg
 
Ëngth
;

4386 
v¬
[
NAME_LEN
+1];

4387 
MYSQL_BIND
 
£t_bšd
[1], 
g‘_bšd
[2];

4390 
	`mysql_autocomm™
(
mysql
, 
TRUE
);

4392 
¡mt1
ð
	`mysql_¡mt_š™
(
mysql
);

4393 
	`FAIL_IF
(!
¡mt1
, 
	`mysql_”rÜ
(
mysql
));

4394 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt1
, 
	`SL
("show variables†ike 'max_error_count'"));

4395 
	`check_¡mt_rc
(
rc
, 
¡mt1
);

4397 
	`mem£t
(
g‘_bšd
, '\0', (get_bind));

4399 
g‘_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

4400 
g‘_bšd
[0].
bufãr
ð(*)
v¬
;

4401 
g‘_bšd
[0].
Ëngth
= &length;

4402 
g‘_bšd
[0].
bufãr_Ëngth
ð()
NAME_LEN
;

4403 
Ëngth
ð
NAME_LEN
;

4405 
g‘_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

4406 
g‘_bšd
[1].
bufãr
ð(*)&
g‘_couÁ
;

4408 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt1
);

4409 
	`check_¡mt_rc
(
rc
, 
¡mt1
);

4411 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt1
, 
g‘_bšd
);

4412 
	`check_¡mt_rc
(
rc
, 
¡mt1
);

4414 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt1
);

4415 
	`check_¡mt_rc
(
rc
, 
¡mt1
);

4417 
def_couÁ
ð
g‘_couÁ
;

4419 
	`FAIL_UNLESS
(
	`¡rcmp
(
v¬
, "max_error_count") == 0, "var != max_error_count");

4420 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt1
);

4421 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

4423 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

4424 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

4425 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("set max_error_count=?"));

4426 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4428 
	`mem£t
(
£t_bšd
, '\0', (set_bind));

4430 
£t_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

4431 
£t_bšd
[0].
bufãr
ð(*)&
£t_couÁ
;

4433 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
£t_bšd
);

4434 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4436 
£t_couÁ
= 31;

4437 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

4438 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4440 
	`mysql_comm™
(
mysql
);

4442 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt1
);

4443 
	`check_¡mt_rc
(
rc
, 
¡mt1
);

4445 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt1
);

4446 
	`check_¡mt_rc
(
rc
, 
¡mt1
);

4448 
	`FAIL_UNLESS
(
g‘_couÁ
 =ð
£t_couÁ
, "get_count != set_count");

4450 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt1
);

4451 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

4454 
£t_couÁ
ð
def_couÁ
;

4455 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

4456 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4458 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt1
);

4459 
	`check_¡mt_rc
(
rc
, 
¡mt1
);

4461 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt1
);

4462 
	`check_¡mt_rc
(
rc
, 
¡mt1
);

4464 
	`FAIL_UNLESS
(
g‘_couÁ
 =ð
£t_couÁ
, "get_count != set_count");

4466 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt1
);

4467 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

4469 
	`mysql_¡mt_þo£
(
¡mt
);

4470 
	`mysql_¡mt_þo£
(
¡mt1
);

4471  
OK
;

4472 
	}
}

4476 
	$‹¡_sqlmode
(
MYSQL
 *
mysql
)

4478 
MYSQL_STMT
 *
¡mt
;

4479 
MYSQL_BIND
 
my_bšd
[2];

4480 
c1
[5], 
c2
[5];

4481 
rc
;

4482 
ignÜe_¥aû
= 0;

4483 
qu”y
[
MAX_TEST_QUERY_LENGTH
];

4486 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_piping");

4487 
	`check_mysql_rc
(
rc
, 
mysql
);

4489 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_piping(name varchar(10))");

4490 
	`check_mysql_rc
(
rc
, 
mysql
);

4493 
	`¡rýy
(
qu”y
, "SET SQL_MODE= \"PIPES_AS_CONCAT\"");

4494 
rc
ð
	`mysql_qu”y
(
mysql
, 
qu”y
);

4495 
	`check_mysql_rc
(
rc
, 
mysql
);

4497 
	`¡rýy
(
qu”y
, "INSERT INTOest_piping VALUES(?||?)");

4498 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

4499 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

4500 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

4501 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4503 
	`mem£t
(
my_bšd
, '\0', (my_bind));

4505 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

4506 
my_bšd
[0].
bufãr
ð(*)
c1
;

4507 
my_bšd
[0].
bufãr_Ëngth
= 2;

4509 
my_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

4510 
my_bšd
[1].
bufãr
ð(*)
c2
;

4511 
my_bšd
[1].
bufãr_Ëngth
= 3;

4513 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

4514 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4516 
	`¡rýy
(
c1
, "My"); sŒýy(
c2
, "SQL");

4517 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

4518 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4519 
	`mysql_¡mt_þo£
(
¡mt
);

4521 ià(
	`v”ify_cÞ_d©a
(
mysql
, "test_piping", "name", "MySQL"))

4522  
FAIL
;

4524 
rc
ð
	`mysql_qu”y
(
mysql
, "DELETE FROMest_piping");

4525 
	`check_mysql_rc
(
rc
, 
mysql
);

4527 
	`¡rýy
(
qu”y
, "SELECT connection_id ()");

4528 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

4529 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

4530 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

4531 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4532 
	`mysql_¡mt_þo£
(
¡mt
);

4535 
	`¡rýy
(
qu”y
, "SET SQL_MODE= \"ANSI\"");

4536 
rc
ð
	`mysql_qu”y
(
mysql
, 
qu”y
);

4537 
	`check_mysql_rc
(
rc
, 
mysql
);

4539 
	`¡rýy
(
qu”y
, "INSERT INTOest_piping VALUES(?||?)");

4540 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

4541 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

4542 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

4543 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4545 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

4546 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4548 
	`¡rýy
(
c1
, "My"); sŒýy(
c2
, "SQL");

4549 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

4550 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4552 
	`mysql_¡mt_þo£
(
¡mt
);

4553 ià(
	`v”ify_cÞ_d©a
(
mysql
, "test_piping", "name", "MySQL"))

4554  
FAIL
;

4559 
	`qu”y_št_v¬ŸbË
(
mysql
, "@@sql_modLIKE '%IGNORE_SPACE%'", &
ignÜe_¥aû
);

4561 ià(!
ignÜe_¥aû
)

4563 
	`¡rýy
(
qu”y
, "SELECT connection_id ()");

4564 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

4565 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

4566 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

4567 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4569 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

4570 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4572 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

4573 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4575 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

4576 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

4578 
	`mysql_¡mt_þo£
(
¡mt
);

4581 
	`¡rýy
(
qu”y
, "SET SQL_MODE= \"IGNORE_SPACE\"");

4582 
rc
ð
	`mysql_qu”y
(
mysql
, 
qu”y
);

4583 
	`check_mysql_rc
(
rc
, 
mysql
);

4585 
	`¡rýy
(
qu”y
, "SELECT connection_id ()");

4586 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

4587 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

4588 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

4589 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4591 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

4592 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4594 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

4595 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4597 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

4598 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

4600 
	`mysql_¡mt_þo£
(
¡mt
);

4601 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_piping");

4602 
	`check_mysql_rc
(
rc
, 
mysql
);

4603  
OK
;

4604 
	}
}

4608 
	$‹¡_¡mt_þo£
(
MYSQL
 *
mysql
)

4610 
MYSQL_STMT
 *
¡mt1
, *
¡mt2
, *
¡mt3
, *
¡mt_x
;

4611 
MYSQL_BIND
 
my_bšd
[1];

4612 
MYSQL_RES
 *
»suÉ
;

4613 
couÁ
;

4614 
rc
;

4615 
qu”y
[
MAX_TEST_QUERY_LENGTH
];

4616 
my_boÞ
 
»cÚÃù
= 1;

4618 
	`mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_RECONNECT
, &
»cÚÃù
);

4621 
	`mysql_autocomm™
(
mysql
, 
TRUE
);

4623 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_stmt_close");

4624 
	`check_mysql_rc
(
rc
, 
mysql
);

4626 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_stmt_close(id int)");

4627 
	`check_mysql_rc
(
rc
, 
mysql
);

4629 
	`¡rýy
(
qu”y
, "DO \"nothing\"");

4630 
¡mt1
ð
	`mysql_¡mt_š™
(
mysql
);

4631 
	`FAIL_IF
(!
¡mt1
, 
	`mysql_”rÜ
(
mysql
));

4632 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt1
, 
	`SL
(
qu”y
));

4633 
	`check_¡mt_rc
(
rc
, 
¡mt1
);

4635 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt1
), "param_count != 0");

4637 
	`¡rýy
(
qu”y
, "INSERT INTOest_stmt_close(id) VALUES(?)");

4638 
¡mt_x
ð
	`mysql_¡mt_š™
(
mysql
);

4639 
	`FAIL_IF
(!
¡mt_x
, 
	`mysql_”rÜ
(
mysql
));

4640 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt_x
, 
	`SL
(
qu”y
));

4641 
	`check_¡mt_rc
(
rc
, 
¡mt_x
);

4643 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt_x
) != 1, "param_count != 1");

4645 
	`¡rýy
(
qu”y
, "UPDATEest_stmt_close SET id= ? WHERE id= ?");

4646 
¡mt3
ð
	`mysql_¡mt_š™
(
mysql
);

4647 
	`FAIL_IF
(!
¡mt3
, 
	`mysql_”rÜ
(
mysql
));

4648 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt3
, 
	`SL
(
qu”y
));

4649 
	`check_¡mt_rc
(
rc
, 
¡mt3
);

4651 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt3
) != 2, "param_count != 2");

4653 
	`¡rýy
(
qu”y
, "SELECT * FROMest_stmt_close WHERE id= ?");

4654 
¡mt2
ð
	`mysql_¡mt_š™
(
mysql
);

4655 
	`FAIL_IF
(!
¡mt2
, 
	`mysql_”rÜ
(
mysql
));

4656 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt2
, 
	`SL
(
qu”y
));

4657 
	`check_¡mt_rc
(
rc
, 
¡mt2
);

4659 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt2
) != 1, "param_count != 1");

4661 
rc
ð
	`mysql_¡mt_þo£
(
¡mt1
);

4671 
	`mysql_¡mt_þo£
(
¡mt2
);

4672 
	`mysql_¡mt_þo£
(
¡mt3
);

4678 
	`mem£t
(
my_bšd
, '\0', (my_bind));

4680 
my_bšd
[0].
bufãr
ð(*)&
couÁ
;

4681 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

4682 
couÁ
= 100;

4684 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt_x
, 
my_bšd
);

4685 
	`check_¡mt_rc
(
rc
, 
¡mt_x
);

4687 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt_x
);

4688 
	`check_¡mt_rc
(
rc
, 
¡mt_x
);

4690 
	`FAIL_IF
(
	`mysql_¡mt_afãùed_rows
(
¡mt_x
) != 1, "affected_rows != 1");

4692 
rc
ð
	`mysql_¡mt_þo£
(
¡mt_x
);

4693 
	`check_¡mt_rc
(
rc
, 
¡mt_x
);

4695 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT id FROMest_stmt_close");

4696 
	`check_mysql_rc
(
rc
, 
mysql
);

4698 
»suÉ
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

4699 
	`FAIL_IF
(!
»suÉ
, "Invalid„esult set");

4701 
rc
= 0;

4702 
	`mysql_ãtch_row
(
»suÉ
))

4703 
rc
++;

4704 
	`FAIL_UNLESS
(
rc
 == 1, "rwcount != 1");

4705 
	`mysql_ä“_»suÉ
(
»suÉ
);

4706 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_stmt_close");

4707 
	`check_mysql_rc
(
rc
, 
mysql
);

4708  
OK
;

4709 
	}
}

4711 
	$‹¡_Ãw_d©e
(
MYSQL
 *
mysql
)

4713 
MYSQL_STMT
 *
¡mt
;

4714 
MYSQL_BIND
 
bšd
[1];

4715 
rc
;

4716 
bufãr
[50];

4717 
my_boÞ
 
»cÚÃù
= 1;

4718 
	`mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_RECONNECT
, &
»cÚÃù
);

4721 
	`mysql_autocomm™
(
mysql
, 
TRUE
);

4723 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

4724 
	`check_mysql_rc
(
rc
, 
mysql
);

4726 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE1 (a date, b date)");

4727 
	`check_mysql_rc
(
rc
, 
mysql
);

4729 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTO1 VALUES (now(),‚ow() + INTERVAL 1 day)");

4730 
	`check_mysql_rc
(
rc
, 
mysql
);

4732 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

4733 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, "SELECT if(1,‡, b) FROM1", 26);

4734 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4736 
	`mem£t
(
bšd
, 0, (
MYSQL_BIND
));

4737 
bšd
[0].
bufãr_Ëngth
= 50;

4738 
bšd
[0].
bufãr
= (*)buffer;

4739 
bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

4741 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

4742 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4744 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
bšd
);

4745 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4747 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

4748 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4750 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

4751 
	`FAIL_IF
(
rc
 !ð
MYSQL_NO_DATA
, "NO DATAƒxpected");

4753 
	`mysql_¡mt_þo£
(
¡mt
);

4754 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

4755 
	`check_mysql_rc
(
rc
, 
mysql
);

4756  
OK
;

4757 
	}
}

4759 
	$‹¡_lÚg_d©a1
(
MYSQL
 *
mysql
)

4761 
MYSQL_STMT
 *
¡mt
;

4762 
rc
;

4763 
MYSQL_BIND
 
bšd
[1];

4764 
qu”y
[
MAX_TEST_QUERY_LENGTH
];

4765 cÚ¡ *
d©a
= "12345";

4767 
rc
ð
	`mysql_autocomm™
(
mysql
, 
TRUE
);

4768 
	`check_mysql_rc
(
rc
, 
mysql
);

4770 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSld");

4771 
	`check_mysql_rc
(
rc
, 
mysql
);

4773 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEld (col1 int, "

4775 
	`check_mysql_rc
(
rc
, 
mysql
);

4776 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTOld VALUES (1,'test')");

4777 
	`check_mysql_rc
(
rc
, 
mysql
);

4779 
	`¡rýy
(
qu”y
, "UPDATEld SET col2=? WHERE col1=1");

4780 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

4781 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

4782 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

4783 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4784 
	`mem£t
(
bšd
, 0, (
MYSQL_BIND
));

4785 
bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

4786 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
bšd
);

4787 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4788 
rc
ð
	`mysql_¡mt_£nd_lÚg_d©a
(
¡mt
, 0, 
d©a
, 6);

4789 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4790 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

4791 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4792 
rc
ð
	`mysql_¡mt_þo£
(
¡mt
);

4793 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4794 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSld");

4795 
	`check_mysql_rc
(
rc
, 
mysql
);

4796  
OK
;

4797 
	}
}

4799 
	$‹¡_blob_9000
(
MYSQL
 *
mysql
)

4801 
MYSQL_BIND
 
bšd
[1];

4802 
MYSQL_STMT
 *
¡mt
;

4803 
rc
;

4804 
bufãr
[9200];

4805 cÚ¡ *
qu”y
= "INSERT INTOb9000 VALUES (?)";

4807 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSb9000");

4808 
	`check_mysql_rc
(
rc
, 
mysql
);

4809 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEb9000 (a blob)");

4810 
	`check_mysql_rc
(
rc
, 
mysql
);

4812 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

4813 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

4815 
	`mem£t
(
bšd
, 0, (
MYSQL_BIND
));

4816 
	`mem£t
(
bufãr
, 'C', 9200);

4817 
bšd
[0].
bufãr
= buffer;

4818 
bšd
[0].
bufãr_Ëngth
= 9200;

4819 
bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

4820 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
bšd
);

4821 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4822 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

4823 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4825 
	`mysql_¡mt_þo£
(
¡mt
);

4826 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSb9000");

4827 
	`check_mysql_rc
(
rc
, 
mysql
);

4828  
OK
;

4829 
	}
}

4831 
	$‹¡_äac£cÚds
(
MYSQL
 *
mysql
)

4833 
MYSQL_STMT
 *
¡mt
;

4834 
rc
;

4835 cÚ¡ *
¡r
= "SELECT NOW(6)";

4836 
bufãr
[60], 
bufãr1
[60];

4837 
MYSQL_BIND
 
bšd
[2];

4839 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

4840 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡r
));

4841 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4843 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

4844 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4846 
	`mem£t
(&
bšd
, 0, (
MYSQL_BIND
));

4847 
bšd
[0].
bufãr
= buffer;

4848 
bšd
[0].
bufãr_Ëngth
=60;

4849 
bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

4851 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
bšd
);

4852 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4854 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

4855 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4857 
	`FAIL_IF
(
	`¡¾’
(
bufãr
) != 26, "Expectedimestamp with†ength of 26");

4859 
rc
ð
	`mysql_¡mt_þo£
(
¡mt
);

4860 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4862 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

4863 
	`check_mysql_rc
(
rc
, 
mysql
);

4865 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE1 (aimestamp(6), bime(6))");

4866 
	`check_mysql_rc
(
rc
, 
mysql
);

4868 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTO1 VALUES ('2012-04-25 10:20:49.0194','10:20:49.0194' )");

4869 
	`check_mysql_rc
(
rc
, 
mysql
);

4871 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

4872 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, "SELECT‡,b FROM1", 18);

4873 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4875 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

4876 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4878 
	`mem£t
(
bšd
, 0, 2 * (
MYSQL_BIND
));

4879 
bšd
[0].
bufãr
= buffer;

4880 
bšd
[1].
bufãr
ð
bufãr1
;

4881 
bšd
[0].
bufãr_Ëngth
= bind[1].buffer_length= 60;

4882 
bšd
[0].
bufãr_ty³
ðbšd[1].bufãr_ty³ð
MYSQL_TYPE_STRING
;

4884 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
bšd
);

4885 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4887 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

4888 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4889 
	`FAIL_IF
(
	`¡rcmp
(
bufãr
, "2012-04-25 10:20:49.019400") != 0, "Wrong„esult");

4890 
	`FAIL_IF
(
	`¡rcmp
(
bufãr1
, "10:20:49.019400") != 0, "Wrong„esult");

4892 
rc
ð
	`mysql_¡mt_þo£
(
¡mt
);

4893 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4895 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE1");

4897  
OK
;

4898 
	}
}

4900 
	$‹¡_nÙrunc
(
MYSQL
 *
mysql
)

4902 
MYSQL_STMT
 *
¡mt
;

4903 
my_boÞ
 
Œunc
= 1;

4904 
MYSQL_BIND
 
bšd
[2];

4905 
bufãr
[5], 
bufãr2
[5];

4906 
rc
;

4907 
my_boÞ
 
”rÜ
= 0;

4908 
Ën
= 1;

4910 cÚ¡ *
qu”y
= "SELECT '1234567890', 'foo' FROM DUAL";

4912 
	`mysql_ÝtiÚs
(
mysql
, 
MYSQL_REPORT_DATA_TRUNCATION
, &
Œunc
);

4914 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

4916 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

4917 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4919 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

4920 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4922 
	`¡rýy
(
bufãr
, "bar");

4924 
	`mem£t
(
bšd
, 0, (
MYSQL_BIND
) * 2);

4925 
bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_NULL
;

4926 
bšd
[0].
bufãr
= buffer;

4927 
bšd
[0].
bufãr_Ëngth
= 1;

4928 
bšd
[0].
Ëngth
ð&
Ën
;

4929 
bšd
[0].
æags
|ð
MADB_BIND_DUMMY
;

4930 
bšd
[0].
”rÜ
= &error;

4931 
bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

4932 
bšd
[1].
bufãr
ð
bufãr2
;

4933 
bšd
[1].
bufãr_Ëngth
= 5;

4935 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
bšd
);

4936 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4937 
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

4939 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

4940 
	`mysql_¡mt_þo£
(
¡mt
);

4942 
	`FAIL_IF
(
rc
!= 0, "expected„c= 0");

4943 
	`FAIL_IF
(
	`¡rcmp
(
bufãr
, "bar"), "Bind dummy failed");

4944 
	`FAIL_IF
(
	`¡rcmp
(
bufãr2
, "foo"), "Invalid second buffer");

4946  
OK
;

4947 
	}
}

4949 
	$‹¡_b™2tšy
(
MYSQL
 *
mysql
)

4951 
MYSQL_BIND
 
bšd
[2];

4952 
d©a
[11];

4953 
Ëngth
[2];

4954 
my_boÞ
 
is_nuÎ
[2], 
”rÜ
[2];

4955 cÚ¡ *
qu”y
 = "SELECT val FROM justbit";

4956 
MYSQL_STMT
 *
¡mt
;

4957 
rc
;

4959 
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS justbit");

4960 
	`mysql_qu”y
(
mysql
, "CREATE TABLE justbit(val bit(1)‚ot‚ull)");

4961 
	`mysql_qu”y
(
mysql
, "INSERT INTO justbit values (1)");

4963 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

4964 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

4965 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4967 
	`mem£t
(
bšd
, '\0', (bind));

4969 
bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_TINY
;

4970 
bšd
[0].
bufãr
ð&
d©a
[0];

4971 
bšd
[0].
bufãr_Ëngth
= 1;

4972 
bšd
[0].
is_nuÎ
= &is_null[0];

4973 
bšd
[0].
Ëngth
= &length[0];

4974 
bšd
[0].
”rÜ
= &error[0];

4976 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

4977 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4979 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
bšd
);

4980 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4982 
rc
ð
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

4983 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4985 
	`mysql_¡mt_ãtch
(
¡mt
);

4987 
	`FAIL_IF
(
d©a
[0] != 1, "Value should be 1");

4989 
	`mysql_¡mt_ä“_»suÉ
(
¡mt
);

4990 
	`mysql_¡mt_þo£
(
¡mt
);

4991 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS justbit");

4992 
	`check_mysql_rc
(
rc
, 
mysql
);

4993  
OK
;

4994 
	}
}

4996 
	$‹¡_»execu‹
(
MYSQL
 *
mysql
)

4998 
MYSQL_STMT
 *
¡mt
;

4999 
MYSQL_BIND
 
ps_·¿ms
[3];

5000 
št_d©a
[3];

5001 
rc
;

5003 ià(!
	`m¬Ÿdb_cÚÃùiÚ
(
mysql
))

5004  
SKIP
;

5007 
rc
 = 
	`mysql_qu”y
(
mysql
, "DROP PROCEDURE IF EXISTS…1");

5008 
	`check_mysql_rc
(
rc
, 
mysql
);

5010 
rc
 = 
	`mysql_qu”y
(
mysql
,

5020 
	`check_mysql_rc
(
rc
, 
mysql
);

5023 
¡mt
 = 
	`mysql_¡mt_š™
(
mysql
);

5024 ià(!
¡mt
)

5026 
	`dŸg
("Could‚ot initialize statement");

5027 
	`ex™
(1);

5029 
rc
 = 
	`mysql_¡mt_´•¬e
(
¡mt
, "CALL…1(?, ?, ?)", 16);

5030 
	`check_¡mt_rc
(
rc
, 
¡mt
);

5033 
	`mem£t
(
ps_·¿ms
, 0,  (ps_params));

5035 
ps_·¿ms
[0].
bufãr_ty³
 = 
MYSQL_TYPE_LONG
;

5036 
ps_·¿ms
[0].
bufãr
 = (*è&
št_d©a
[0];

5037 
ps_·¿ms
[0].
Ëngth
 = 0;

5038 
ps_·¿ms
[0].
is_nuÎ
 = 0;

5040 
ps_·¿ms
[1].
bufãr_ty³
 = 
MYSQL_TYPE_LONG
;

5041 
ps_·¿ms
[1].
bufãr
 = (*è&
št_d©a
[1];

5042 
ps_·¿ms
[1].
Ëngth
 = 0;

5043 
ps_·¿ms
[1].
is_nuÎ
 = 0;

5045 
ps_·¿ms
[2].
bufãr_ty³
 = 
MYSQL_TYPE_LONG
;

5046 
ps_·¿ms
[2].
bufãr
 = (*è&
št_d©a
[2];

5047 
ps_·¿ms
[2].
Ëngth
 = 0;

5048 
ps_·¿ms
[2].
is_nuÎ
 = 0;

5051 
rc
 = 
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
ps_·¿ms
);

5052 
	`check_¡mt_rc
(
rc
, 
¡mt
);

5055 
št_d©a
[0]= 10;

5056 
št_d©a
[1]= 20;

5057 
št_d©a
[2]= 30;

5059 
rc
 = 
	`mysql_¡mt_execu‹
(
¡mt
);

5060 
	`check_¡mt_rc
(
rc
, 
¡mt
);

5062 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

5063 
	`check_¡mt_rc
(
rc
, 
¡mt
);

5065 
	`mysql_¡mt_þo£
(
¡mt
);

5067 
rc
 = 
	`mysql_qu”y
(
mysql
, "DROP PROCEDURE IF EXISTS…1");

5068 
	`check_mysql_rc
(
rc
, 
mysql
);

5069  
OK
;

5070 
	}
}

5072 
	$‹¡_´•¬e_”rÜ
(
MYSQL
 *
mysql
)

5074 
MYSQL_STMT
 *
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

5075 
rc
;

5077 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("SELECT 1 FROMbl_not_exists"));

5078 
	`FAIL_IF
(!
rc
, "Expectedƒrror");

5080 
rc
ð
	`mysql_¡mt_»£t
(
¡mt
);

5081 
	`check_¡mt_rc
(
rc
, 
¡mt
);

5083 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("SELECT 1 FROMbl_not_exists"));

5084 
	`FAIL_IF
(!
rc
, "Expectedƒrror");

5086 
rc
ð
	`mysql_¡mt_»£t
(
¡mt
);

5087 
	`check_¡mt_rc
(
rc
, 
¡mt
);

5089 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("SET @a:=1"));

5090 
	`check_¡mt_rc
(
rc
, 
¡mt
);

5092 
	`mysql_¡mt_þo£
(
¡mt
);

5093  
OK
;

5094 
	}
}

5096 
	$‹¡_cÚc349
(
MYSQL
 *
mysql
)

5098 
MYSQL_STMT
 *
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

5099 
rc
;

5100 
mysql_¡mt_¡©e
 
¡©e
;

5102 
rc
ð
	`mysql_¡mt_©Œ_g‘
(
¡mt
, 
STMT_ATTR_STATE
, &
¡©e
);

5103 
	`FAIL_IF
(
¡©e
 !ð
MYSQL_STMT_INITTED
, "expected status MYSQL_STMT_INITTED");

5105 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("SET @a:=1"));

5106 
	`check_¡mt_rc
(
rc
, 
¡mt
);

5108 
rc
ð
	`mysql_¡mt_©Œ_g‘
(
¡mt
, 
STMT_ATTR_STATE
, &
¡©e
);

5109 
	`FAIL_IF
(
¡©e
 !ð
MYSQL_STMT_PREPARED
, "expected status MYSQL_STMT_PREPARED");

5111 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

5112 
	`check_¡mt_rc
(
rc
, 
¡mt
);

5114 
rc
ð
	`mysql_¡mt_©Œ_g‘
(
¡mt
, 
STMT_ATTR_STATE
, &
¡©e
);

5115 
	`FAIL_IF
(
¡©e
 !ð
MYSQL_STMT_EXECUTED
, "expected status MYSQL_STMT_EXECUTED");

5117 
	`mysql_¡mt_þo£
(
¡mt
);

5118  
OK
;

5119 
	}
}

5121 
my_‹¡s_¡
 
	gmy_‹¡s
[] = {

5122 {"‹¡_cÚc349", 
‹¡_cÚc349
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

5123 {"‹¡_´•¬e_”rÜ", 
‹¡_´•¬e_”rÜ
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

5124 {"‹¡_»execu‹", 
‹¡_»execu‹
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

5125 {"‹¡_b™2tšy", 
‹¡_b™2tšy
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

5126 {"‹¡_cÚc97", 
‹¡_cÚc97
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

5127 {"‹¡_cÚc83", 
‹¡_cÚc83
, 
TEST_CONNECTION_NONE
, 0, 
NULL
, NULL},

5128 {"‹¡_cÚc60", 
‹¡_cÚc60
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

5129 {"‹¡_nÙrunc", 
‹¡_nÙrunc
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

5130 {"‹¡_äac£cÚds", 
‹¡_äac£cÚds
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

5131 {"‹¡_blob_9000", 
‹¡_blob_9000
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5132 {"‹¡_lÚg_d©a1", 
‹¡_lÚg_d©a1
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5133 {"‹¡_´•¬e_š£¹_upd©e", 
‹¡_´•¬e_š£¹_upd©e
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5134 {"‹¡_´•¬e_sim¶e", 
‹¡_´•¬e_sim¶e
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5135 {"‹¡_´•¬e_syÁax", 
‹¡_´•¬e_syÁax
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5136 {"‹¡_´•¬e_f›ld_»suÉ", 
‹¡_´•¬e_f›ld_»suÉ
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5137 {"‹¡_´•¬e", 
‹¡_´•¬e
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5138 {"‹¡_´•¬e_ext", 
‹¡_´•¬e_ext
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5139 {"‹¡_´•¬e_muÉi_¡©em’ts", 
‹¡_´•¬e_muÉi_¡©em’ts
, 
TEST_CONNECTION_NEW
, 0, 
NULL
 , NULL},

5140 {"‹¡_´•¬e_®‹r", 
‹¡_´•¬e_®‹r
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5141 {"‹¡_´•¬e_»suÉ£t", 
‹¡_´•¬e_»suÉ£t
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5142 {"‹¡_Ý’_dœeù", 
‹¡_Ý’_dœeù
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5143 {"‹¡_£Ëù_show", 
‹¡_£Ëù_show
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5144 {"‹¡_£Ëù", 
‹¡_£Ëù
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5145 {"‹¡_lÚg_d©a", 
‹¡_lÚg_d©a
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5146 {"‹¡_lÚg_d©a_¡r", 
‹¡_lÚg_d©a_¡r
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5147 {"‹¡_lÚg_d©a_¡r1", 
‹¡_lÚg_d©a_¡r1
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5148 {"‹¡_lÚg_d©a_bš", 
‹¡_lÚg_d©a_bš
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5149 {"‹¡_sim¶e_upd©e", 
‹¡_sim¶e_upd©e
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5150 {"‹¡_sim¶e_d–‘e", 
‹¡_sim¶e_d–‘e
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5151 {"‹¡_upd©e", 
‹¡_upd©e
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5152 {"‹¡_´•¬e_nÝ¬am", 
‹¡_´•¬e_nÝ¬am
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5153 {"‹¡_bšd_»suÉ", 
‹¡_bšd_»suÉ
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5154 {"‹¡_bšd_»suÉ_ext", 
‹¡_bšd_»suÉ_ext
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5155 {"‹¡_bšd_»suÉ_ext1", 
‹¡_bšd_»suÉ_ext1
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5156 {"‹¡_bšd_Ãg©ive", 
‹¡_bšd_Ãg©ive
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5157 {"‹¡_bufãrs", 
‹¡_bufãrs
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5158 {"‹¡_xjoš", 
‹¡_xjoš
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5159 {"‹¡_uniÚ", 
‹¡_uniÚ
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5160 {"‹¡_uniÚ2", 
‹¡_uniÚ2
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5161 {"‹¡_uniÚ_·¿m", 
‹¡_uniÚ_·¿m
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5162 {"‹¡_pu»_cov”age", 
‹¡_pu»_cov”age
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5163 {"‹¡_š£¹_£Ëù", 
‹¡_š£¹_£Ëù
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5164 {"‹¡_š£¹", 
‹¡_š£¹
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5165 {"‹¡_još", 
‹¡_još
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5166 {"‹¡_Ëá_još_v›w", 
‹¡_Ëá_još_v›w
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5167 {"‹¡_mªu®_§m¶e", 
‹¡_mªu®_§m¶e
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5168 {"‹¡_ü—‹_drÝ", 
‹¡_ü—‹_drÝ
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5169 {"‹¡_d©e", 
‹¡_d©e
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5170 {"‹¡_d©e_ts", 
‹¡_d©e_ts
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5171 {"‹¡_d©e_dt", 
‹¡_d©e_dt
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5172 {"‹¡_d©e_d©e", 
‹¡_d©e_d©e
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5173 {"‹¡_d©e_time", 
‹¡_d©e_time
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5174 {"‹¡_d©‘ime_¿nges", 
‹¡_d©‘ime_¿nges
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5175 {"‹¡_d”ived", 
‹¡_d”ived
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5176 {"‹¡_di¡šù", 
‹¡_di¡šù
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5177 {"‹¡_do_£t", 
‹¡_do_£t
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5178 {"‹¡_doubË_com·»", 
‹¡_doubË_com·»
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5179 {"‹¡_muÉi", 
‹¡_muÉi
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5180 {"‹¡_muÉi_¡mt", 
‹¡_muÉi_¡mt
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5181 {"‹¡_n¡mts", 
‹¡_n¡mts
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5182 {"‹¡_nuÎ", 
‹¡_nuÎ
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5183 {"‹¡_Üd”_·¿m", 
‹¡_Üd”_·¿m
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5184 {"‹¡_»Çme", 
‹¡_»Çme
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5185 {"‹¡_»wšd", 
‹¡_»wšd
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5186 {"‹¡_£Ëù_´•¬e", 
‹¡_£Ëù_´•¬e
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5187 {"‹¡_£Ëù_show_bË", 
‹¡_£Ëù_show_bË
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5188 {"‹¡_£Ëù_v”siÚ", 
‹¡_£Ëù_v”siÚ
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5189 {"‹¡_£Ëùtmp", 
‹¡_£Ëùtmp
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5190 {"‹¡_£t_ÝtiÚ", 
‹¡_£t_ÝtiÚ
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5191 {"‹¡_£t_v¬ŸbË", 
‹¡_£t_v¬ŸbË
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5192 {"‹¡_sqlmode", 
‹¡_sqlmode
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5193 {"‹¡_¡mt_þo£", 
‹¡_¡mt_þo£
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5194 {"‹¡_Ãw_d©e", 
‹¡_Ãw_d©e
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

5195 {
NULL
, NULL, 0, 0, NULL, NULL}

5198 
	$maš
(
¬gc
, **
¬gv
)

5200 ià(
¬gc
 > 1)

5201 
	`g‘_ÝtiÚs
(
¬gc
, 
¬gv
);

5203 
	`g‘_’vv¬s
();

5205 
	`run_‹¡s
(
my_‹¡s
);

5207 (
	`ex™_¡©us
());

5208 
	}
}

	@unittest/libmariadb/ps_bugs.c

24 
	~"my_‹¡.h
"

26 
	#MY_INT64_NUM_DECIMAL_DIGITS
 21

	)

27 
	#MAX_INDEXES
 64

	)

31 
	$cmp_doubË
(*
a
, *
b
)

33  *
a
 =ð*
b
;

34  
OK
;

35 
	}
}

39 
	$‹¡_cÚc67
(
MYSQL
 *
mysql
)

41 
MYSQL_STMT
 *
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

42 cÚ¡ *
qu”y
= "SELECT‡,b FROM conc67 WHERE‡=?";

43 
rc
, 
i
;

44 
MYSQL_BIND
 
bšd
[2];

45 
v®
[20];

46 
MYSQL_BIND
 
rbšd
;

47 
MYSQL_RES
 *
»s
;

48 
ulÚg
 
´eãtch_rows
= 1000;

49 
ulÚg
 
cursÜ_ty³
ð
CURSOR_TYPE_READ_ONLY
;

51 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS conc67");

52 
	`check_mysql_rc
(
rc
, 
mysql
);

54 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE conc67 (a int, bext)");

55 
	`check_mysql_rc
(
rc
, 
mysql
);

57 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTO conc67 VALUES (1, 'foo')");

58 
	`check_mysql_rc
(
rc
, 
mysql
);

60 
rc
ð
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_CURSOR_TYPE
, &
cursÜ_ty³
);

61 
	`check_¡mt_rc
(
rc
, 
¡mt
);

62 
rc
ð
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_PREFETCH_ROWS
, &
´eãtch_rows
);

63 
	`check_¡mt_rc
(
rc
, 
¡mt
);

65 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

66 
	`check_¡mt_rc
(
rc
, 
¡mt
);

68 
	`mem£t
(&
rbšd
, 0, (
MYSQL_BIND
));

69 
i
= 1;

70 
rbšd
.
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

71 
rbšd
.
bufãr
ð&
i
;

72 
rbšd
.
bufãr_Ëngth
= 4;

73 
	`mysql_¡mt_bšd_·¿m
(
¡mt
, &
rbšd
);

75 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

76 
	`check_¡mt_rc
(
rc
, 
¡mt
);

78 
»s
ð
	`mysql_¡mt_»suÉ_m‘ad©a
(
¡mt
);

79 
	`mysql_ä“_»suÉ
(
»s
);

81 
	`mem£t
(
bšd
, 0, 2 * (
MYSQL_BIND
));

83 
i
= 0;

84 
bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

85 
bšd
[0].
bufãr
ð&
i
;

86 
bšd
[0].
bufãr_Ëngth
= 4;

87 
bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

88 
bšd
[1].
bufãr
ð&
v®
;

89 
bšd
[1].
bufãr_Ëngth
= 20;

91 
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
bšd
);

93 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

94 
	`check_¡mt_rc
(
rc
, 
¡mt
);

96 
	`FAIL_IF
(
i
 != 1, "expected value 1 for first„ow");

98 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

99 
	`FAIL_IF
(
rc
 !ð
MYSQL_NO_DATA
, "Eofƒxpected");

101 
	`mysql_¡mt_þo£
(
¡mt
);

102 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS conc67");

103 
	`check_mysql_rc
(
rc
, 
mysql
);

104  
OK
;

105 
	}
}

107 
	$‹¡_bug1115
(
MYSQL
 *
mysql
)

109 
MYSQL_STMT
 *
¡mt
;

110 
rc
, 
rowcouÁ
;

111 
MYSQL_BIND
 
my_bšd
[1];

112 
ulÚg
 
Ëngth
[1];

113 
szD©a
[11];

114 
qu”y
[
MAX_TEST_QUERY_LENGTH
];

116 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_select");

117 
	`check_mysql_rc
(
rc
, 
mysql
);

119 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_select(\
_id char(9) NOT NULL, \
 int(8) unsigned NOT NULL, \
 int(5) NOT NULL, \
 int(5) NOT NULL, \
 datetime NOT NULL)");

125 
	`check_mysql_rc
(
rc
, 
mysql
);

126 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTOest_select VALUES "

136 
	`check_mysql_rc
(
rc
, 
mysql
);

137 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTOest_select VALUES "

149 
	`check_mysql_rc
(
rc
, 
mysql
);

151 
	`¡rýy
(
qu”y
, "SELECT * FROMest_select WHERE "

153 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

154 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

155 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

156 
	`check_¡mt_rc
(
rc
, 
¡mt
);

158 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
) != 1, "Paramcount != 1");

160 
	`mem£t
(
my_bšd
, '\0', (
MYSQL_BIND
));

162 
	`¡rýy
(
szD©a
, (*)"abc");

163 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

164 
my_bšd
[0].
bufãr
ð(*)
szD©a
;

165 
my_bšd
[0].
bufãr_Ëngth
= 10;

166 
my_bšd
[0].
Ëngth
= &length[0];

167 
Ëngth
[0]= 3;

169 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

170 
	`check_¡mt_rc
(
rc
, 
¡mt
);

172 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

173 
	`check_¡mt_rc
(
rc
, 
¡mt
);

175 
rowcouÁ
= 0;

176 
	`mysql_¡mt_ãtch
(
¡mt
è!ð
MYSQL_NO_DATA
)

177 
rowcouÁ
++;

178 
	`FAIL_IF
(
rowcouÁ
 != 1, "rowcount=%d != 1");

180 
	`¡rýy
(
szD©a
, (*)"venu");

181 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

182 
my_bšd
[0].
bufãr
ð(*)
szD©a
;

183 
my_bšd
[0].
bufãr_Ëngth
= 10;

184 
my_bšd
[0].
Ëngth
= &length[0];

185 
Ëngth
[0]= 4;

186 
my_bšd
[0].
is_nuÎ
= 0;

188 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

189 
	`check_¡mt_rc
(
rc
, 
¡mt
);

191 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

192 
	`check_¡mt_rc
(
rc
, 
¡mt
);

194 
rowcouÁ
= 0;

195 
	`mysql_¡mt_ãtch
(
¡mt
è!ð
MYSQL_NO_DATA
)

196 
rowcouÁ
++;

197 
	`FAIL_IF
(
rowcouÁ
 != 0, "rowcount != 0");

199 
	`¡rýy
(
szD©a
, (*)"abc");

200 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

201 
my_bšd
[0].
bufãr
ð(*)
szD©a
;

202 
my_bšd
[0].
bufãr_Ëngth
= 10;

203 
my_bšd
[0].
Ëngth
= &length[0];

204 
Ëngth
[0]= 3;

205 
my_bšd
[0].
is_nuÎ
= 0;

207 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

208 
	`check_¡mt_rc
(
rc
, 
¡mt
);

210 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

211 
	`check_¡mt_rc
(
rc
, 
¡mt
);

213 
rowcouÁ
= 0;

214 
	`mysql_¡mt_ãtch
(
¡mt
è!ð
MYSQL_NO_DATA
)

215 
rowcouÁ
++;

216 
	`FAIL_IF
(
rowcouÁ
 != 1, "rowcount != 1");

218 
	`mysql_¡mt_þo£
(
¡mt
);

219 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_select");

220 
	`check_mysql_rc
(
rc
, 
mysql
);

222  
OK
;

223 
	}
}

226 
	$‹¡_bug1180
(
MYSQL
 *
mysql
)

228 
MYSQL_STMT
 *
¡mt
;

229 
rc
, 
rowcouÁ
;

230 
MYSQL_BIND
 
my_bšd
[1];

231 
ulÚg
 
Ëngth
[1];

232 
szD©a
[11];

233 
qu”y
[
MAX_TEST_QUERY_LENGTH
];

235 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_select");

236 
	`check_mysql_rc
(
rc
, 
mysql
);

238 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_select(session_id char(9) NOT NULL)");

239 
	`check_mysql_rc
(
rc
, 
mysql
);

240 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTOest_select VALUES (\"abc\")");

241 
	`check_mysql_rc
(
rc
, 
mysql
);

243 
	`¡rýy
(
qu”y
, "SELECT * FROMest_select WHERE ?= \"1111\"‡nd "

245 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

246 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

247 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

248 
	`check_¡mt_rc
(
rc
, 
¡mt
);

250 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
) != 1, "Paramcount != 1");

252 
	`mem£t
(
my_bšd
, '\0', (
MYSQL_BIND
));

254 
	`¡rýy
(
szD©a
, (*)"abc");

255 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

256 
my_bšd
[0].
bufãr
ð(*)
szD©a
;

257 
my_bšd
[0].
bufãr_Ëngth
= 10;

258 
my_bšd
[0].
Ëngth
= &length[0];

259 
Ëngth
[0]= 3;

260 
my_bšd
[0].
is_nuÎ
= 0;

262 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

263 
	`check_¡mt_rc
(
rc
, 
¡mt
);

265 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

266 
	`check_¡mt_rc
(
rc
, 
¡mt
);

269 
rowcouÁ
= 0;

270 
	`mysql_¡mt_ãtch
(
¡mt
è!ð
MYSQL_NO_DATA
)

271 
rowcouÁ
++;

272 
	`FAIL_IF
(
rowcouÁ
 != 0, "rowcount != 0");

274 
	`¡rýy
(
szD©a
, (*)"1111");

275 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

276 
my_bšd
[0].
bufãr
ð(*)
szD©a
;

277 
my_bšd
[0].
bufãr_Ëngth
= 10;

278 
my_bšd
[0].
Ëngth
= &length[0];

279 
Ëngth
[0]= 4;

280 
my_bšd
[0].
is_nuÎ
= 0;

282 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

283 
	`check_¡mt_rc
(
rc
, 
¡mt
);

285 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

286 
	`check_¡mt_rc
(
rc
, 
¡mt
);

288 
rowcouÁ
= 0;

289 
	`mysql_¡mt_ãtch
(
¡mt
è!ð
MYSQL_NO_DATA
)

290 
rowcouÁ
++;

291 
	`FAIL_IF
(
rowcouÁ
 != 1, "rowcount != 1");

293 
	`¡rýy
(
szD©a
, (*)"abc");

294 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

295 
my_bšd
[0].
bufãr
ð(*)
szD©a
;

296 
my_bšd
[0].
bufãr_Ëngth
= 10;

297 
my_bšd
[0].
Ëngth
= &length[0];

298 
Ëngth
[0]= 3;

299 
my_bšd
[0].
is_nuÎ
= 0;

301 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

302 
	`check_¡mt_rc
(
rc
, 
¡mt
);

304 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

305 
	`check_¡mt_rc
(
rc
, 
¡mt
);

307 
rowcouÁ
= 0;

308 
	`mysql_¡mt_ãtch
(
¡mt
è!ð
MYSQL_NO_DATA
)

309 
rowcouÁ
++;

310 
	`FAIL_IF
(
rowcouÁ
 != 0, "rowcount != 0");

312 
	`mysql_¡mt_þo£
(
¡mt
);

313 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_select");

314 
	`check_mysql_rc
(
rc
, 
mysql
);

316  
OK
;

317 
	}
}

325 
	$‹¡_bug1644
(
MYSQL
 *
mysql
)

327 
MYSQL_STMT
 *
¡mt
;

328 
MYSQL_RES
 *
»suÉ
;

329 
MYSQL_ROW
 
row
;

330 
MYSQL_BIND
 
my_bšd
[4];

331 
num
;

332 
my_boÞ
 
i¢uÎ
;

333 
rc
, 
i
;

334 
qu”y
[
MAX_TEST_QUERY_LENGTH
];

336 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS foo_dfr");

337 
	`check_mysql_rc
(
rc
, 
mysql
);

339 
rc
ð
	`mysql_qu”y
(
mysql
,

341 
	`check_mysql_rc
(
rc
, 
mysql
);

343 
	`¡rýy
(
qu”y
, "INSERT INTO foo_dfr VALUES (?, ?, ?, ? )");

344 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

345 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

346 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

347 
	`check_¡mt_rc
(
rc
, 
¡mt
);

349 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
) != 4, "Paramcount != 4");

351 
	`mem£t
(
my_bšd
, '\0', (
MYSQL_BIND
) * 4);

353 
num
= 22;

354 
i¢uÎ
= 0;

355 
i
= 0 ; i < 4 ; i++)

357 
my_bšd
[
i
].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

358 
my_bšd
[
i
].
bufãr
ð(*)&
num
;

359 
my_bšd
[
i
].
is_nuÎ
ð&
i¢uÎ
;

362 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

363 
	`check_¡mt_rc
(
rc
, 
¡mt
);

365 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

366 
	`check_¡mt_rc
(
rc
, 
¡mt
);

368 
i¢uÎ
= 1;

369 
i
= 0 ; i < 4 ; i++)

370 
my_bšd
[
i
].
is_nuÎ
ð&
i¢uÎ
;

372 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

373 
	`check_¡mt_rc
(
rc
, 
¡mt
);

375 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

376 
	`check_¡mt_rc
(
rc
, 
¡mt
);

378 
i¢uÎ
= 0;

379 
num
= 88;

380 
i
= 0 ; i < 4 ; i++)

381 
my_bšd
[
i
].
is_nuÎ
ð&
i¢uÎ
;

383 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

384 
	`check_¡mt_rc
(
rc
, 
¡mt
);

386 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

387 
	`check_¡mt_rc
(
rc
, 
¡mt
);

389 
	`mysql_¡mt_þo£
(
¡mt
);

391 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT * FROM foo_dfr");

392 
	`check_mysql_rc
(
rc
, 
mysql
);

394 
»suÉ
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

395 
	`FAIL_IF
(!
»suÉ
, "Invalid„esultset");

397 
	`FAIL_IF
(
	`mysql_num_rows
(
»suÉ
) != 3, "rowcount != 3");

399 
	`mysql_d©a_£ek
(
»suÉ
, 0);

401 
row
ð
	`mysql_ãtch_row
(
»suÉ
);

402 
	`FAIL_IF
(!
row
, "row = NULL");

403 
i
= 0 ; i < 4 ; i++)

405 
	`FAIL_UNLESS
(
	`¡rcmp
(
row
[
i
], "22") == 0, "Wrong value");

407 
row
ð
	`mysql_ãtch_row
(
»suÉ
);

408 
	`FAIL_IF
(!
row
, "Invalid„ow");

409 
i
= 0 ; i < 4 ; i++)

411 
	`FAIL_UNLESS
(
row
[
i
] == 0, "row[i] != 0");

413 
row
ð
	`mysql_ãtch_row
(
»suÉ
);

414 
	`FAIL_IF
(!
row
, "Invalid„ow");

415 
i
= 0 ; i < 4 ; i++)

417 
	`FAIL_UNLESS
(
	`¡rcmp
(
row
[
i
], "88") == 0, "row[i] != 88");

419 
row
ð
	`mysql_ãtch_row
(
»suÉ
);

420 
	`FAIL_IF
(
row
, "row != NULL");

422 
	`mysql_ä“_»suÉ
(
»suÉ
);

423 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS foo_dfr");

424 
	`check_mysql_rc
(
rc
, 
mysql
);

426  
OK
;

427 
	}
}

429 
	$‹¡_bug11037
(
MYSQL
 *
mysql
)

431 
MYSQL_STMT
 *
¡mt
;

432 
rc
;

433 cÚ¡ *
¡mt_‹xt
;

435 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxists1");

436 
	`check_mysql_rc
(
rc
, 
mysql
);

438 
rc
ð
	`mysql_qu”y
(
mysql
, "createable1 (id int‚ot‚ull)");

439 
	`check_mysql_rc
(
rc
, 
mysql
);

441 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into1 values (1)");

442 
	`check_mysql_rc
(
rc
, 
mysql
);

444 
¡mt_‹xt
= "select id FROM1";

445 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

446 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

447 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

448 
	`check_¡mt_rc
(
rc
, 
¡mt
);

451 
rc
 = 
	`mysql_¡mt_ãtch
(
¡mt
);

452 
	`FAIL_UNLESS
(
rc
==1, "Errorƒxpedted");

454 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

455 
	`check_¡mt_rc
(
rc
, 
¡mt
);

457 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

458 
	`check_¡mt_rc
(
rc
, 
¡mt
);

460 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

461 
	`FAIL_UNLESS
(
rc
==
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

463 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

464 
	`FAIL_UNLESS
(
rc
==
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

466 
	`mysql_¡mt_þo£
(
¡mt
);

467 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable1");

468 
	`check_mysql_rc
(
rc
, 
mysql
);

470  
OK
;

471 
	}
}

475 
	$‹¡_bug11183
(
MYSQL
 *
mysql
)

477 
rc
;

478 
MYSQL_STMT
 *
¡mt
;

479 
bug_¡©em’t
[]= "insert into1 values (1)";

481 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxists1");

482 
	`check_mysql_rc
(
rc
, 
mysql
);

483 
rc
ð
	`mysql_qu”y
(
mysql
, "createable1 (a int)");

484 
	`check_mysql_rc
(
rc
, 
mysql
);

486 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

487 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

489 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
bug_¡©em’t
));

490 
	`check_¡mt_rc
(
rc
, 
¡mt
);

492 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable1");

493 
	`check_mysql_rc
(
rc
, 
mysql
);

496 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

497 
	`FAIL_IF
(!
rc
, "Errorƒxpected");

499 
	`mysql_¡mt_»£t
(
¡mt
);

500 
	`FAIL_IF
(
	`mysql_¡mt_”ºo
(
¡mt
) != 0, "stmt->error != 0");

502 
rc
ð
	`mysql_qu”y
(
mysql
, "createable1 (a int)");

503 
	`check_mysql_rc
(
rc
, 
mysql
);

506 ià(
	`mysql_¡mt_execu‹
(
¡mt
))

508 
	`mysql_¡mt_»£t
(
¡mt
);

509 
	`FAIL_IF
(
	`mysql_¡mt_”ºo
(
¡mt
) == 0, "stmt->error != 0");

512 
	`mysql_¡mt_þo£
(
¡mt
);

514 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable1");

515 
	`check_mysql_rc
(
rc
, 
mysql
);

517  
OK
;

518 
	}
}

520 
	$‹¡_bug12744
(
MYSQL
 *
mysql
)

522 
MYSQL_STMT
 *
¡mt
 = 
NULL
;

523 
rc
;

525 
SKIP_MAXSCALE
;

527 
¡mt
 = 
	`mysql_¡mt_š™
(
mysql
);

528 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

529 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, "SET @a:=1", 9);

530 
	`check_¡mt_rc
(
rc
, 
¡mt
);

532 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

533 
	`check_¡mt_rc
(
rc
, 
¡mt
);

536 
rc
ð
	`mysql_qu”y
(
mysql
, "SET @a:=1");

537 
	`check_mysql_rc
(
rc
, 
mysql
);

538 
rc
ð
	`mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_RECONNECT
, "1");

539 
	`check_mysql_rc
(
rc
, 
mysql
);

540 
rc
ð
	`mysql_kžl
(
mysql
, 
	`mysql_th»ad_id
(mysql));

542 
rc
ð
	`mysql_pšg
(
mysql
);

543 
	`check_mysql_rc
(
rc
, 
mysql
);

545 
rc
ð
	`mysql_¡mt_þo£
(
¡mt
);

546 
	`check_mysql_rc
(
rc
, 
mysql
);

548  
OK
;

549 
	}
}

551 
	$‹¡_bug1500
(
MYSQL
 *
mysql
)

553 
MYSQL_STMT
 *
¡mt
;

554 
MYSQL_BIND
 
my_bšd
[3];

555 
rc
= 0;

556 
št32
 
št_d©a
[3]= {2, 3, 4};

557 cÚ¡ *
d©a
;

558 cÚ¡ *
qu”y
;

561 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_bg1500");

562 
	`check_mysql_rc
(
rc
, 
mysql
);

564 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_bg1500 (i INT)");

565 
	`check_mysql_rc
(
rc
, 
mysql
);

567 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTOest_bg1500 VALUES (1), (2)");

568 
	`check_mysql_rc
(
rc
, 
mysql
);

570 
rc
ð
	`mysql_comm™
(
mysql
);

571 
	`check_mysql_rc
(
rc
, 
mysql
);

573 
qu”y
= "SELECT i FROMest_bg1500 WHERE i IN (?, ?, ?)";

574 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

575 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

576 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

577 
	`check_¡mt_rc
(
rc
, 
¡mt
);

579 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
) != 3, "paramcount != 3");

581 
	`mem£t
(
my_bšd
, '\0', (my_bind));

583 
my_bšd
[0].
bufãr
ð(*)
št_d©a
;

584 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

585 
my_bšd
[2]= my_bind[1]= my_bind[0];

586 
my_bšd
[1].
bufãr
ð(*)(
št_d©a
 + 1);

587 
my_bšd
[2].
bufãr
ð(*)(
št_d©a
 + 2);

589 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

590 
	`check_¡mt_rc
(
rc
, 
¡mt
);

592 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

593 
	`check_¡mt_rc
(
rc
, 
¡mt
);

595 
rc
= 0;

596 
	`mysql_¡mt_ãtch
(
¡mt
è!ð
MYSQL_NO_DATA
)

597 
rc
++;

598 
	`FAIL_UNLESS
(
rc
 == 1, "rowcount != 1");

600 
	`mysql_¡mt_þo£
(
¡mt
);

602 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLEest_bg1500");

603 
	`check_mysql_rc
(
rc
, 
mysql
);

605 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_bg1500 (s VARCHAR(25), FULLTEXT(s))ƒngine=MyISAM");

606 
	`check_mysql_rc
(
rc
, 
mysql
);

608 
rc
ð
	`mysql_qu”y
(
mysql
,

610 
	`check_mysql_rc
(
rc
, 
mysql
);

612 
rc
ð
	`mysql_comm™
(
mysql
);

613 
	`check_mysql_rc
(
rc
, 
mysql
);

615 
qu”y
= "SELECT s FROMest_bg1500 WHERE MATCH (s) AGAINST (?)";

616 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

617 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

618 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

619 
	`check_¡mt_rc
(
rc
, 
¡mt
);

621 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
) != 1, "paramcount != 1");

623 
d©a
= "Dogs";

624 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

625 
my_bšd
[0].
bufãr
ð(*è
d©a
;

626 
my_bšd
[0].
bufãr_Ëngth
ð()
	`¡¾’
(
d©a
);

627 
my_bšd
[0].
is_nuÎ
= 0;

628 
my_bšd
[0].
Ëngth
= 0;

630 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

631 
	`check_¡mt_rc
(
rc
, 
¡mt
);

633 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

634 
	`check_¡mt_rc
(
rc
, 
¡mt
);

636 
rc
= 0;

637 
	`mysql_¡mt_ãtch
(
¡mt
è!ð
MYSQL_NO_DATA
)

638 
rc
++;

639 
	`FAIL_UNLESS
(
rc
 == 1, "rowcount != 1");

641 
	`mysql_¡mt_þo£
(
¡mt
);

644 
qu”y
= "SELECT s FROMest_bg1500 WHERE MATCH (s) AGAINST (CONCAT(?, 'digger'))";

645 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

646 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

647 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

648 
	`check_¡mt_rc
(
rc
, 
¡mt
);

650 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
) != 1, "paramcount != 1");

652 
d©a
= "Grave";

653 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

654 
my_bšd
[0].
bufãr
ð(*è
d©a
;

655 
my_bšd
[0].
bufãr_Ëngth
ð()
	`¡¾’
(
d©a
);

657 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

658 
	`check_¡mt_rc
(
rc
, 
¡mt
);

660 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

661 
	`check_¡mt_rc
(
rc
, 
¡mt
);

663 
rc
= 0;

664 
	`mysql_¡mt_ãtch
(
¡mt
è!ð
MYSQL_NO_DATA
)

665 
rc
++;

666 
	`FAIL_UNLESS
(
rc
 == 1, "rowcount != 1");

668 
	`mysql_¡mt_þo£
(
¡mt
);

669 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_bg1500");

670 
	`check_mysql_rc
(
rc
, 
mysql
);

672  
OK
;

673 
	}
}

675 
	$‹¡_bug15510
(
MYSQL
 *
mysql
)

677 
MYSQL_STMT
 *
¡mt
;

678 
rc
;

679 cÚ¡ *
qu”y
= "select 1 from dual where 1/0";

682 
rc
ð
	`mysql_qu”y
(
mysql
, "set @@sql_mode='ERROR_FOR_DIVISION_BY_ZERO'");

683 
	`check_mysql_rc
(
rc
, 
mysql
);

685 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

687 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

688 
	`check_¡mt_rc
(
rc
, 
¡mt
);

690 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

691 
	`check_¡mt_rc
(
rc
, 
¡mt
);

693 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

694 
	`FAIL_UNLESS
(
	`mysql_w¬nšg_couÁ
(
mysql
), "Warningƒxpected");

697 
	`mysql_¡mt_þo£
(
¡mt
);

698 
rc
ð
	`mysql_qu”y
(
mysql
, "set @@sql_mode=''");

699 
	`check_mysql_rc
(
rc
, 
mysql
);

701  
OK
;

702 
	}
}

709 
	$‹¡_bug15518
(
MYSQL
 *
mysql
)

711 
MYSQL_STMT
 *
¡mt
;

712 
rc
;

714 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

720 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, "foo", 3);

721 
	`FAIL_UNLESS
(
rc
 && 
	`mysql_¡mt_”ºo
(
¡mt
è&& 
	`mysql_”ºo
(
mysql
), "Errorƒxpected");

727 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, "SHOW STATUS", 12);

728 
	`FAIL_UNLESS
(!
rc
 || 
	`mysql_¡mt_”ºo
(
¡mt
è|| 
	`mysql_”ºo
(
mysql
), "Errorƒxpected");

730 
rc
ð
	`mysql_¡mt_þo£
(
¡mt
);

731 
	`check_mysql_rc
(
rc
, 
mysql
);

736 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

737 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, "foo", 3);

738 
	`FAIL_UNLESS
(
rc
 && 
	`mysql_¡mt_”ºo
(
¡mt
è&& 
	`mysql_”ºo
(
mysql
), "Errorƒxpected");

741 
	`mysql_þo£
(
mysql
);

748 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, "SHOW STATUS", 12);

749 
	`FAIL_UNLESS
(
rc
 && 
	`mysql_¡mt_”ºo
(
¡mt
), "Errorƒxpected");

751 
	`mysql_¡mt_þo£
(
¡mt
);

753  
OK
;

754 
	}
}

761 
	$‹¡_bug15613
(
MYSQL
 *
mysql
)

763 
MYSQL_STMT
 *
¡mt
;

764 cÚ¡ *
¡mt_‹xt
;

765 
MYSQL_RES
 *
m‘ad©a
;

766 
MYSQL_FIELD
 *
f›ld
;

767 
rc
;

770 
rc
ð
	`mysql_qu”y
(
mysql
, "set‚ames†atin1");

771 
	`check_mysql_rc
(
rc
, 
mysql
);

772 
	`mysql_qu”y
(
mysql
, "dropable ifƒxists1");

773 
rc
ð
	`mysql_qu”y
(
mysql
,

781 
	`check_mysql_rc
(
rc
, 
mysql
);

783 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

786 
¡mt_‹xt
= ("select,t, mt,†t, vl, vb, vu from1");

787 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

788 
m‘ad©a
ð
	`mysql_¡mt_»suÉ_m‘ad©a
(
¡mt
);

789 
f›ld
ð
	`mysql_ãtch_f›lds
(
m‘ad©a
);

790 
	`FAIL_UNLESS
(
f›ld
[0].
Ëngth
 == 65535, "length != 65535");

791 
	`FAIL_UNLESS
(
f›ld
[1].
Ëngth
 == 255, "length != 244");

792 
	`FAIL_UNLESS
(
f›ld
[2].
Ëngth
 == 16777215, "length != 166777215");

793 
	`FAIL_UNLESS
(
f›ld
[3].
Ëngth
 == 4294967295UL, "length != 4294967295UL");

794 
	`FAIL_UNLESS
(
f›ld
[4].
Ëngth
 == 255, "length != 255");

795 
	`FAIL_UNLESS
(
f›ld
[5].
Ëngth
 == 255, "length != 255");

796 
	`FAIL_UNLESS
(
f›ld
[6].
Ëngth
 == 255, "length != 255");

797 
	`mysql_ä“_»suÉ
(
m‘ad©a
);

798 
	`mysql_¡mt_ä“_»suÉ
(
¡mt
);

801 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable1");

802 
	`check_mysql_rc
(
rc
, 
mysql
);

803 
rc
ð
	`mysql_qu”y
(
mysql
, "set‚ames default");

804 
	`check_mysql_rc
(
rc
, 
mysql
);

805 
	`mysql_¡mt_þo£
(
¡mt
);

807  
OK
;

808 
	}
}

810 
	$‹¡_bug16144
(
MYSQL
 *
mysql
)

812 cÚ¡ 
my_boÞ
 
æag_Üig
= (my_bool) 0xde;

813 
my_boÞ
 
æag
ð
æag_Üig
;

814 
MYSQL_STMT
 *
¡mt
;

817 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

818 
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_UPDATE_MAX_LENGTH
, (cÚ¡ *è&
æag
);

819 
	`mysql_¡mt_©Œ_g‘
(
¡mt
, 
STMT_ATTR_UPDATE_MAX_LENGTH
, (*è&
æag
);

820 
	`FAIL_UNLESS
(
æag
 =ð
æag_Üig
, "flag != flag_orig");

822 
	`mysql_¡mt_þo£
(
¡mt
);

824  
OK
;

825 
	}
}

831 
	$‹¡_bug1664
(
MYSQL
 *
mysql
)

833 
MYSQL_STMT
 *
¡mt
;

834 
rc
, 
št_d©a
;

835 cÚ¡ *
d©a
;

836 cÚ¡ *
¡r_d©a
= "Simple string";

837 
MYSQL_BIND
 
my_bšd
[2];

838 cÚ¡ *
qu”y
= "INSERT INTOest_long_data(col2, col1) VALUES(?, ?)";

841 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_long_data");

842 
	`check_mysql_rc
(
rc
, 
mysql
);

844 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_long_data(col1 int, col2†ong varchar)");

845 
	`check_mysql_rc
(
rc
, 
mysql
);

847 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

848 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

849 
	`check_¡mt_rc
(
rc
, 
¡mt
);

851 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
) != 2, "Param count != 2");

853 
	`mem£t
(
my_bšd
, '\0', (my_bind));

855 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

856 
my_bšd
[0].
bufãr
ð(*)
¡r_d©a
;

857 
my_bšd
[0].
bufãr_Ëngth
ð()
	`¡¾’
(
¡r_d©a
);

859 
my_bšd
[1].
bufãr
ð(*)&
št_d©a
;

860 
my_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

862 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

863 
	`check_¡mt_rc
(
rc
, 
¡mt
);

865 
št_d©a
= 1;

871 
d©a
= "";

872 
rc
ð
	`mysql_¡mt_£nd_lÚg_d©a
(
¡mt
, 0, 
	`SL
(
d©a
));

873 
	`check_¡mt_rc
(
rc
, 
¡mt
);

875 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

876 
	`check_¡mt_rc
(
rc
, 
¡mt
);

877 ià(
	`v”ify_cÞ_d©a
(
mysql
, "test_long_data", "col1", "1"))

878 
”rÜ
;

879 ià(
	`v”ify_cÞ_d©a
(
mysql
, "test_long_data", "col2", ""))

880 
”rÜ
;

881 
rc
ð
	`mysql_qu”y
(
mysql
, "DELETE FROMest_long_data");

882 
	`check_mysql_rc
(
rc
, 
mysql
);

885 
d©a
= (*)"Data";

886 
rc
ð
	`mysql_¡mt_£nd_lÚg_d©a
(
¡mt
, 0, 
	`SL
(
d©a
));

887 
	`check_¡mt_rc
(
rc
, 
¡mt
);

889 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

890 
	`check_¡mt_rc
(
rc
, 
¡mt
);

892 ià(
	`v”ify_cÞ_d©a
(
mysql
, "test_long_data", "col1", "1"))

893 
”rÜ
;

894 ià(
	`v”ify_cÞ_d©a
(
mysql
, "test_long_data", "col2", "Data"))

895 
”rÜ
;

898 
rc
ð
	`mysql_qu”y
(
mysql
, "DELETE FROMest_long_data");

899 
	`check_mysql_rc
(
rc
, 
mysql
);

907 
št_d©a
= 2;

909 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

910 
	`check_¡mt_rc
(
rc
, 
¡mt
);

912 ià(
	`v”ify_cÞ_d©a
(
mysql
, "test_long_data", "col1", "2"))

913 
”rÜ
;

914 ià(
	`v”ify_cÞ_d©a
(
mysql
, "‹¡_lÚg_d©a", "cÞ2", 
¡r_d©a
))

915 
”rÜ
;

918 
rc
ð
	`mysql_qu”y
(
mysql
, "DELETE FROMest_long_data");

919 
	`check_mysql_rc
(
rc
, 
mysql
);

926 
d©a
= (*)"SomeOtherData";

927 
rc
ð
	`mysql_¡mt_£nd_lÚg_d©a
(
¡mt
, 0, 
	`SL
(
d©a
));

928 
	`check_¡mt_rc
(
rc
, 
¡mt
);

930 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

931 
	`check_¡mt_rc
(
rc
, 
¡mt
);

933 ià(
	`v”ify_cÞ_d©a
(
mysql
, "test_long_data", "col1", "2"))

934 
”rÜ
;

935 ià(
	`v”ify_cÞ_d©a
(
mysql
, "test_long_data", "col2", "SomeOtherData"))

936 
”rÜ
;

938 
	`mysql_¡mt_þo£
(
¡mt
);

941 
rc
ð
	`mysql_qu”y
(
mysql
, "DELETE FROMest_long_data");

942 
	`check_mysql_rc
(
rc
, 
mysql
);

945 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

946 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

947 
	`check_¡mt_rc
(
rc
, 
¡mt
);

948 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

949 
	`check_¡mt_rc
(
rc
, 
¡mt
);

951 
d©a
= (*)"SomeData";

952 
rc
ð
	`mysql_¡mt_£nd_lÚg_d©a
(
¡mt
, 0, 
	`SL
(
d©a
));

953 
	`check_¡mt_rc
(
rc
, 
¡mt
);

955 
rc
ð
	`mysql_¡mt_»£t
(
¡mt
);

956 
	`check_¡mt_rc
(
rc
, 
¡mt
);

958 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

959 
	`check_¡mt_rc
(
rc
, 
¡mt
);

961 ià(
	`v”ify_cÞ_d©a
(
mysql
, "test_long_data", "col1", "2"))

962 
”rÜ
;

963 ià(
	`v”ify_cÞ_d©a
(
mysql
, "‹¡_lÚg_d©a", "cÞ2", 
¡r_d©a
))

964 
”rÜ
;

966 
	`mysql_¡mt_þo£
(
¡mt
);

969 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLEest_long_data");

970 
	`check_mysql_rc
(
rc
, 
mysql
);

972  
OK
;

974 
”rÜ
:

975 
	`mysql_¡mt_þo£
(
¡mt
);

976 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLEest_long_data");

977  
FAIL
;

978 
	}
}

981 
	$‹¡_ushÜt_bug
(
MYSQL
 *
mysql
)

983 
MYSQL_STMT
 *
¡mt
;

984 
MYSQL_BIND
 
my_bšd
[4];

985 
ushÜt
 
shÜt_v®ue
;

986 
ušt32
 
lÚg_v®ue
;

987 
ulÚg
 
s_Ëngth
, 
l_Ëngth
, 
Î_Ëngth
, 
t_Ëngth
;

988 
ulÚglÚg
 
lÚglÚg_v®ue
;

989 
rc
;

990 
uch¬
 
tšy_v®ue
;

991 cÚ¡ *
qu”y
= "SELECT * FROMest_ushort";

993 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_ushort");

994 
	`check_mysql_rc
(
rc
, 
mysql
);

996 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_ushort(a smallint unsigned, \
 smallint unsigned, \
 smallint unsigned, \
 smallint unsigned)");

1000 
	`check_mysql_rc
(
rc
, 
mysql
);

1002 
rc
ð
	`mysql_qu”y
(
mysql
,

1004 
	`check_mysql_rc
(
rc
, 
mysql
);

1006 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

1007 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

1008 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

1009 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1011 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1012 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1014 
	`mem£t
(
my_bšd
, '\0', (my_bind));

1015 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_SHORT
;

1016 
my_bšd
[0].
bufãr
ð(*)&
shÜt_v®ue
;

1017 
my_bšd
[0].
is_unsigÃd
ð
TRUE
;

1018 
my_bšd
[0].
Ëngth
ð&
s_Ëngth
;

1020 
my_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

1021 
my_bšd
[1].
bufãr
ð(*)&
lÚg_v®ue
;

1022 
my_bšd
[1].
Ëngth
ð&
l_Ëngth
;

1024 
my_bšd
[2].
bufãr_ty³
ð
MYSQL_TYPE_LONGLONG
;

1025 
my_bšd
[2].
bufãr
ð(*)&
lÚglÚg_v®ue
;

1026 
my_bšd
[2].
Ëngth
ð&
Î_Ëngth
;

1028 
my_bšd
[3].
bufãr_ty³
ð
MYSQL_TYPE_TINY
;

1029 
my_bšd
[3].
bufãr
ð(*)&
tšy_v®ue
;

1030 
my_bšd
[3].
is_unsigÃd
ð
TRUE
;

1031 
my_bšd
[3].
Ëngth
ð&
t_Ëngth
;

1033 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

1034 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1036 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

1037 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1039 
	`FAIL_UNLESS
(
shÜt_v®ue
 == 35999, "short_value != 35999");

1040 
	`FAIL_UNLESS
(
s_Ëngth
 == 2, "length != 2");

1042 
	`FAIL_UNLESS
(
lÚg_v®ue
 == 35999, "long_value != 35999");

1043 
	`FAIL_UNLESS
(
l_Ëngth
 == 4, "length != 4");

1045 
	`FAIL_UNLESS
(
lÚglÚg_v®ue
 == 35999, "longlong_value != 35999");

1046 
	`FAIL_UNLESS
(
Î_Ëngth
 == 8, "length != 8");

1048 
	`FAIL_UNLESS
(
tšy_v®ue
 == 200, "tiny_value != 200");

1049 
	`FAIL_UNLESS
(
t_Ëngth
 == 1, "length != 1");

1051 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

1052 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

1054 
	`mysql_¡mt_þo£
(
¡mt
);

1055 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_ushort");

1056 
	`check_mysql_rc
(
rc
, 
mysql
);

1058  
OK
;

1059 
	}
}

1061 
	$‹¡_bug1946
(
MYSQL
 *
mysql
)

1063 
MYSQL_STMT
 *
¡mt
;

1064 
rc
;

1065 cÚ¡ *
qu”y
= "INSERT INTO…repare_command VALUES (?)";

1068 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS…repare_command");

1069 
	`check_mysql_rc
(
rc
, 
mysql
);

1071 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE…repare_command(ID INT)");

1072 
	`check_mysql_rc
(
rc
, 
mysql
);

1074 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

1075 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

1076 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

1077 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1079 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
qu”y
));

1080 
	`FAIL_IF
(!
rc
, "Errorƒxpected");

1082 
	`mysql_¡mt_þo£
(
¡mt
);

1083 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE…repare_command");

1084 
	`check_mysql_rc
(
rc
, 
mysql
);

1085  
OK
;

1086 
	}
}

1088 
	$‹¡_bug20152
(
MYSQL
 *
mysql
)

1090 
MYSQL_BIND
 
my_bšd
[1];

1091 
MYSQL_STMT
 *
¡mt
;

1092 
MYSQL_TIME
 
tm
;

1093 
rc
;

1094 cÚ¡ *
qu”y
= "INSERT INTO1 (f1) VALUES (?)";

1097 
	`mem£t
(
my_bšd
, '\0', (my_bind));

1098 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_DATE
;

1099 
my_bšd
[0].
bufãr
ð(*)&
tm
;

1101 
	`mem£t
(&
tm
, 0, (
MYSQL_TIME
));

1103 
tm
.
y—r
 = 2006;

1104 
tm
.
mÚth
 = 6;

1105 
tm
.
day
 = 18;

1106 
tm
.
hour
 = 14;

1107 
tm
.
mšu‹
 = 9;

1108 
tm
.
£cÚd
 = 42;

1110 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

1111 
	`check_mysql_rc
(
rc
, 
mysql
);

1112 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE1 (f1 DATE)");

1113 
	`check_mysql_rc
(
rc
, 
mysql
);

1115 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

1116 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

1117 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1118 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

1119 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1120 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1121 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1122 
rc
ð
	`mysql_¡mt_þo£
(
¡mt
);

1123 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1124 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE1");

1125 
	`check_mysql_rc
(
rc
, 
mysql
);

1126 
	`FAIL_UNLESS
(
tm
.
hour
 =ð14 &&m.
mšu‹
 =ð9 &&m.
£cÚd
 == 42, "time != 14:09:42");

1127  
OK
;

1128 
	}
}

1130 
	$‹¡_bug2247
(
MYSQL
 *
mysql
)

1132 
MYSQL_STMT
 *
¡mt
;

1133 
MYSQL_RES
 *
»s
;

1134 
rc
;

1135 
i
;

1136 cÚ¡ *
ü—‹
= "CREATE TABLE bug2247(id INT UNIQUE AUTO_INCREMENT)";

1137 cÚ¡ *
š£¹
= "INSERT INTO bug2247 VALUES (NULL)";

1138 cÚ¡ *
SELECT
= "SELECT id FROM bug2247";

1139 cÚ¡ *
upd©e
= "UPDATE bug2247 SET id=id+10";

1140 cÚ¡ *
drÝ
= "DROP TABLE IF EXISTS bug2247";

1141 
ulÚglÚg
 
exp_couÁ
;

1142 ’um { 
NUM_ROWS
= 5 };

1146 
rc
ð
	`mysql_qu”y
(
mysql
, 
drÝ
);

1147 
	`check_mysql_rc
(
rc
, 
mysql
);

1149 
rc
ð
	`mysql_qu”y
(
mysql
, 
ü—‹
);

1150 
	`check_mysql_rc
(
rc
, 
mysql
);

1152 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

1153 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

1154 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
š£¹
));

1155 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1156 
i
ð0; i < 
NUM_ROWS
; ++i)

1158 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1159 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1161 
exp_couÁ
ð
	`mysql_¡mt_afãùed_rows
(
¡mt
);

1162 
	`FAIL_UNLESS
(
exp_couÁ
 == 1, "exp_count != 1");

1164 
rc
ð
	`mysql_qu”y
(
mysql
, 
SELECT
);

1165 
	`check_mysql_rc
(
rc
, 
mysql
);

1171 
»s
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

1172 
	`FAIL_IF
(!
»s
, "Invalid„esult set");

1174 
	`FAIL_UNLESS
(
	`mysql_afãùed_rows
(
mysql
è=ð
NUM_ROWS
, "affected_rows != NUM_ROWS");

1175 
	`FAIL_UNLESS
(
exp_couÁ
 =ð
	`mysql_¡mt_afãùed_rows
(
¡mt
), "affected_rows !=ƒxp_count");

1177 
rc
ð
	`mysql_qu”y
(
mysql
, 
upd©e
);

1178 
	`check_mysql_rc
(
rc
, 
mysql
);

1179 
	`FAIL_UNLESS
(
	`mysql_afãùed_rows
(
mysql
è=ð
NUM_ROWS
, "affected_rows != NUM_ROWS");

1180 
	`FAIL_UNLESS
(
exp_couÁ
 =ð
	`mysql_¡mt_afãùed_rows
(
¡mt
), "affected_rows !=ƒxp_count");

1182 
	`mysql_ä“_»suÉ
(
»s
);

1183 
	`mysql_¡mt_þo£
(
¡mt
);

1186 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

1187 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

1188 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
SELECT
));

1189 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1191 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1192 
	`check_¡mt_rc
(
rc
, 
¡mt
);„cð
	`mysql_¡mt_¡Üe_»suÉ
(stmt);

1193 
	`check_¡mt_rc
(
rc
, 
¡mt
); 
exp_couÁ
ð
	`mysql_¡mt_afãùed_rows
(stmt);

1194 
	`FAIL_UNLESS
(
exp_couÁ
 =ð
NUM_ROWS
, "exp_count != NUM_ROWS");

1196 
rc
ð
	`mysql_qu”y
(
mysql
, 
š£¹
);

1197 
	`check_mysql_rc
(
rc
, 
mysql
);

1198 
	`FAIL_UNLESS
(
	`mysql_afãùed_rows
(
mysql
) == 1, "affected_rows != 1");

1199 
	`FAIL_UNLESS
(
exp_couÁ
 =ð
	`mysql_¡mt_afãùed_rows
(
¡mt
), "affected_rows !=ƒxp_count");

1201 
	`mysql_¡mt_þo£
(
¡mt
);

1202 
rc
ð
	`mysql_qu”y
(
mysql
, 
drÝ
);

1203 
	`check_mysql_rc
(
rc
, 
mysql
);

1204  
OK
;

1205 
	}
}

1211 
	$‹¡_bug2248
(
MYSQL
 *
mysql
)

1213 
MYSQL_STMT
 *
¡mt
;

1214 
rc
;

1215 cÚ¡ *
qu”y1
= "SELECT DATABASE()";

1216 cÚ¡ *
qu”y2
= "INSERT INTOest_bug2248 VALUES (10)";

1219 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_bug2248");

1220 
	`check_mysql_rc
(
rc
, 
mysql
);

1222 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_bug2248 (id int)");

1223 
	`check_mysql_rc
(
rc
, 
mysql
);

1225 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

1226 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

1227 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y1
));

1228 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1231 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

1232 
	`FAIL_IF
(!
rc
, "Errorƒxpected");

1235 
rc
ð
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

1236 
	`FAIL_IF
(!
rc
, "Errorƒxpected");

1238 
	`mysql_¡mt_þo£
(
¡mt
);

1240 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

1241 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

1242 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y2
));

1243 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1245 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1246 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1248 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

1249 
	`FAIL_UNLESS
(
rc
 == 1, "rc != 1");

1252 
rc
ð
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

1253 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1255 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

1256 
	`FAIL_UNLESS
(
rc
 == 1, "rc != 1");

1258 
	`mysql_¡mt_þo£
(
¡mt
);

1260 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLEest_bug2248");

1261 
	`check_mysql_rc
(
rc
, 
mysql
);

1262  
OK
;

1263 
	}
}

1273 
	$‹¡_bug23383
(
MYSQL
 *
mysql
)

1275 cÚ¡ *
š£¹_qu”y
= "INSERT INTO1 VALUES (1), (2)";

1276 cÚ¡ *
upd©e_qu”y
= "UPDATE1 SET i= 4 WHERE i = 3";

1277 
MYSQL_STMT
 *
¡mt
;

1278 
row_couÁ
;

1279 
rc
;

1281 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

1282 
	`check_mysql_rc
(
rc
, 
mysql
);

1284 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE1 (i INT UNIQUE)");

1285 
	`check_mysql_rc
(
rc
, 
mysql
);

1287 
rc
ð
	`mysql_qu”y
(
mysql
, 
š£¹_qu”y
);

1288 
	`check_mysql_rc
(
rc
, 
mysql
);

1289 
row_couÁ
ð
	`mysql_afãùed_rows
(
mysql
);

1290 
	`FAIL_UNLESS
(
row_couÁ
 == 2, "row_count != 2");

1292 
rc
ð
	`mysql_qu”y
(
mysql
, 
š£¹_qu”y
);

1293 
	`FAIL_IF
(!
rc
, "Errorƒxpected");

1294 
row_couÁ
ð
	`mysql_afãùed_rows
(
mysql
);

1295 
	`FAIL_UNLESS
(
row_couÁ
 == ()-1, "rowcount != -1");

1297 
rc
ð
	`mysql_qu”y
(
mysql
, 
upd©e_qu”y
);

1298 
	`check_mysql_rc
(
rc
, 
mysql
);

1299 
row_couÁ
ð
	`mysql_afãùed_rows
(
mysql
);

1300 
	`FAIL_UNLESS
(
row_couÁ
 == 0, "");

1302 
rc
ð
	`mysql_qu”y
(
mysql
, "DELETE FROM1");

1303 
	`check_mysql_rc
(
rc
, 
mysql
);

1305 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

1306 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

1308 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
š£¹_qu”y
));

1309 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1310 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1311 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1312 
row_couÁ
ð
	`mysql_¡mt_afãùed_rows
(
¡mt
);

1313 
	`FAIL_UNLESS
(
row_couÁ
 == 2, "row_count != 2");

1315 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1316 
	`FAIL_UNLESS
(
rc
 != 0, "");

1317 
row_couÁ
ð
	`mysql_¡mt_afãùed_rows
(
¡mt
);

1318 
	`FAIL_UNLESS
(
row_couÁ
 == ()-1, "rowcount != -1");

1320 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
upd©e_qu”y
));

1321 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1322 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1323 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1324 
row_couÁ
ð
	`mysql_¡mt_afãùed_rows
(
¡mt
);

1325 
	`FAIL_UNLESS
(
row_couÁ
 == 0, "rowcount != 0");

1327 
rc
ð
	`mysql_¡mt_þo£
(
¡mt
);

1328 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1329 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE1");

1330 
	`check_mysql_rc
(
rc
, 
mysql
);

1332  
OK
;

1333 
	}
}

1339 
	$‹¡_bug27592
(
MYSQL
 *
mysql
)

1341 cÚ¡ 
NUM_ITERATIONS
= 40;

1342 
i
;

1343 
rc
;

1344 
MYSQL_STMT
 *
¡mt
ð
NULL
;

1345 
MYSQL_BIND
 
bšd
[1];

1346 
MYSQL_TIME
 
time_v®
;

1348 
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

1349 
	`mysql_qu”y
(
mysql
, "CREATE TABLE1(c2 DATETIME)");

1351 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

1352 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

1353 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("INSERT INTO1 VALUES (?)"));

1354 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1356 
	`mem£t
(
bšd
, '\0', (bind));

1358 
bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_DATETIME
;

1359 
bšd
[0].
bufãr
ð(*è&
time_v®
;

1360 
bšd
[0].
Ëngth
ð
NULL
;

1362 
i
ð0; i < 
NUM_ITERATIONS
; i++)

1364 
time_v®
.
y—r
= 2007;

1365 
time_v®
.
mÚth
= 6;

1366 
time_v®
.
day
= 7;

1367 
time_v®
.
hour
= 18;

1368 
time_v®
.
mšu‹
= 41;

1369 
time_v®
.
£cÚd
= 3;

1371 
time_v®
.
£cÚd_·¹
=0;

1372 
time_v®
.
Ãg
=0;

1374 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
bšd
);

1375 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1376 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1377 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1380 
	`mysql_¡mt_þo£
(
¡mt
);

1381 
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

1383  
OK
;

1384 
	}
}

1390 
	$‹¡_bug28934
(
MYSQL
 *
mysql
)

1392 
my_boÞ
 
”rÜ
= 0;

1393 
MYSQL_BIND
 
bšd
[5];

1394 
MYSQL_STMT
 *
¡mt
;

1395 
rc
, 
út
;

1397 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxists1");

1398 
	`check_mysql_rc
(
rc
, 
mysql
);

1399 
rc
ð
	`mysql_qu”y
(
mysql
, "createable1(id int)");

1400 
	`check_mysql_rc
(
rc
, 
mysql
);

1402 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into1 values(1),(2),(3),(4),(5)");

1403 
	`check_mysql_rc
(
rc
, 
mysql
);

1405 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

1406 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

1407 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("select * from1 where id in(?,?,?,?,?)"));

1408 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1410 
	`mem£t
 (&
bšd
, '\0',  (bind));

1411 
út
= 0; cnt < 5; cnt++)

1413 
bšd
[
út
].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

1414 
bšd
[
út
].
bufãr
= (*)&cnt;

1415 
bšd
[
út
].
bufãr_Ëngth
= 0;

1417 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
bšd
);

1418 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1420 
¡mt
->
·¿m_couÁ
=2;

1421 
”rÜ
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1422 
	`FAIL_UNLESS
(
”rÜ
 != 0, "Errorƒxpected");

1423 
	`mysql_¡mt_þo£
(
¡mt
);

1425 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable1");

1426 
	`check_mysql_rc
(
rc
, 
mysql
);

1427  
OK
;

1428 
	}
}

1430 
	$‹¡_bug3035
(
MYSQL
 *
mysql
)

1432 
MYSQL_STMT
 *
¡mt
;

1433 
rc
;

1434 
MYSQL_BIND
 
bšd_¬¿y
[12], *
my_bšd
ðbšd_¬¿y, *
bšd_’d
= my_bind + 12;

1435 
št8
 
št8_v®
;

1436 
ušt8
 
ušt8_v®
;

1437 
št16
 
št16_v®
;

1438 
ušt16
 
ušt16_v®
;

1439 
št32
 
št32_v®
;

1440 
ušt32
 
ušt32_v®
;

1441 
lÚglÚg
 
št64_v®
;

1442 
ulÚglÚg
 
ušt64_v®
;

1443 
doubË_v®
, 
udoubË_v®
, 
doubË_tmp
;

1444 
lÚglÚg_as_¡ršg
[22], 
ulÚglÚg_as_¡ršg
[22];

1447 cÚ¡ 
št8
 
št8_mš
= -128;

1448 cÚ¡ 
št8
 
št8_max
= 127;

1449 cÚ¡ 
ušt8
 
ušt8_mš
= 0;

1450 cÚ¡ 
ušt8
 
ušt8_max
= 255;

1452 cÚ¡ 
št16
 
št16_mš
= -32768;

1453 cÚ¡ 
št16
 
št16_max
= 32767;

1454 cÚ¡ 
ušt16
 
ušt16_mš
= 0;

1455 cÚ¡ 
ušt16
 
ušt16_max
= 65535;

1457 cÚ¡ 
št32
 
št32_max
= 2147483647L;

1458 cÚ¡ 
št32
 
št32_mš
ð-
št32_max
 - 1;

1459 cÚ¡ 
ušt32
 
ušt32_mš
= 0;

1460 cÚ¡ 
ušt32
 
ušt32_max
= 4294967295U;

1463 cÚ¡ 
lÚglÚg
 
št64_max
= 9223372036854775807LL;

1464 cÚ¡ 
lÚglÚg
 
št64_mš
ð-
št64_max
 - 1;

1466 cÚ¡ 
ulÚglÚg
 
ušt64_mš
= 0U;

1467 cÚ¡ 
ulÚglÚg
 
ušt64_max
= 18446744073709551615ULL;

1469 cÚ¡ *
¡mt_‹xt
;

1472 
¡mt_‹xt
= "DROP TABLE IF EXISTS1";

1473 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

1474 
	`check_mysql_rc
(
rc
, 
mysql
);

1476 
¡mt_‹xt
= "CREATE TABLE1 (i8 TINYINT, ui8 TINYINT UNSIGNED, "

1481 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

1482 
	`check_mysql_rc
(
rc
, 
mysql
);

1484 
	`mem£t
(
bšd_¬¿y
, '\0', (bind_array));

1485 
my_bšd
ð
bšd_¬¿y
; my_bšd < 
bšd_’d
; my_bind++)

1486 
my_bšd
->
”rÜ
ð&my_bšd->
”rÜ_v®ue
;

1488 
bšd_¬¿y
[0].
bufãr_ty³
ð
MYSQL_TYPE_TINY
;

1489 
bšd_¬¿y
[0].
bufãr
ð(*è&
št8_v®
;

1491 
bšd_¬¿y
[1].
bufãr_ty³
ð
MYSQL_TYPE_TINY
;

1492 
bšd_¬¿y
[1].
bufãr
ð(*è&
ušt8_v®
;

1493 
bšd_¬¿y
[1].
is_unsigÃd
= 1;

1495 
bšd_¬¿y
[2].
bufãr_ty³
ð
MYSQL_TYPE_SHORT
;

1496 
bšd_¬¿y
[2].
bufãr
ð(*è&
št16_v®
;

1498 
bšd_¬¿y
[3].
bufãr_ty³
ð
MYSQL_TYPE_SHORT
;

1499 
bšd_¬¿y
[3].
bufãr
ð(*è&
ušt16_v®
;

1500 
bšd_¬¿y
[3].
is_unsigÃd
= 1;

1502 
bšd_¬¿y
[4].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

1503 
bšd_¬¿y
[4].
bufãr
ð(*è&
št32_v®
;

1505 
bšd_¬¿y
[5].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

1506 
bšd_¬¿y
[5].
bufãr
ð(*è&
ušt32_v®
;

1507 
bšd_¬¿y
[5].
is_unsigÃd
= 1;

1509 
bšd_¬¿y
[6].
bufãr_ty³
ð
MYSQL_TYPE_LONGLONG
;

1510 
bšd_¬¿y
[6].
bufãr
ð(*è&
št64_v®
;

1512 
bšd_¬¿y
[7].
bufãr_ty³
ð
MYSQL_TYPE_LONGLONG
;

1513 
bšd_¬¿y
[7].
bufãr
ð(*è&
ušt64_v®
;

1514 
bšd_¬¿y
[7].
is_unsigÃd
= 1;

1516 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

1517 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1519 
¡mt_‹xt
= "INSERT INTO1 (i8, ui8, i16, ui16, i32, ui32, i64, ui64) "

1521 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

1522 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1523 
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
bšd_¬¿y
);

1525 
št8_v®
ð
št8_mš
;

1526 
ušt8_v®
ð
ušt8_mš
;

1527 
št16_v®
ð
št16_mš
;

1528 
ušt16_v®
ð
ušt16_mš
;

1529 
št32_v®
ð
št32_mš
;

1530 
ušt32_v®
ð
ušt32_mš
;

1531 
št64_v®
ð
št64_mš
;

1532 
ušt64_v®
ð
ušt64_mš
;

1534 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1535 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1536 
št8_v®
ð
št8_max
;

1537 
ušt8_v®
ð
ušt8_max
;

1538 
št16_v®
ð
št16_max
;

1539 
ušt16_v®
ð
ušt16_max
;

1540 
št32_v®
ð
št32_max
;

1541 
ušt32_v®
ð
ušt32_max
;

1542 
št64_v®
ð
št64_max
;

1543 
ušt64_v®
ð
ušt64_max
;

1545 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1546 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1547 
¡mt_‹xt
= "SELECT i8, ui8, i16, ui16, i32, ui32, i64, ui64, ui64, "

1551 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

1552 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1553 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1554 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1555 
bšd_¬¿y
[8].
bufãr_ty³
ð
MYSQL_TYPE_DOUBLE
;

1556 
bšd_¬¿y
[8].
bufãr
ð(*è&
udoubË_v®
;

1558 
bšd_¬¿y
[9].
bufãr_ty³
ð
MYSQL_TYPE_DOUBLE
;

1559 
bšd_¬¿y
[9].
bufãr
ð(*è&
doubË_v®
;

1561 
bšd_¬¿y
[10].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

1562 
bšd_¬¿y
[10].
bufãr
ð(*è&
ulÚglÚg_as_¡ršg
;

1563 
bšd_¬¿y
[10].
bufãr_Ëngth
ð(
ulÚglÚg_as_¡ršg
);

1565 
bšd_¬¿y
[11].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

1566 
bšd_¬¿y
[11].
bufãr
ð(*è&
lÚglÚg_as_¡ršg
;

1567 
bšd_¬¿y
[11].
bufãr_Ëngth
ð(
lÚglÚg_as_¡ršg
);

1569 
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
bšd_¬¿y
);

1571 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

1572 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1573 
	`FAIL_UNLESS
(
št8_v®
 =ð
št8_mš
, "int8_val != int8_min");

1574 
	`FAIL_UNLESS
(
ušt8_v®
 =ð
ušt8_mš
, "uint8_val != uint8_min");

1575 
	`FAIL_UNLESS
(
št16_v®
 =ð
št16_mš
, "int16_val != int16_min");

1576 
	`FAIL_UNLESS
(
ušt16_v®
 =ð
ušt16_mš
, "uint16_val != uint16_min");

1577 
	`FAIL_UNLESS
(
št32_v®
 =ð
št32_mš
, "int32_val != int32_min");

1578 
	`FAIL_UNLESS
(
ušt32_v®
 =ð
ušt32_mš
, "uint32_val != uint32_min");

1579 
	`FAIL_UNLESS
(
št64_v®
 =ð
št64_mš
, "int64_val != int64_min");

1580 
	`FAIL_UNLESS
(
ušt64_v®
 =ð
ušt64_mš
, "uint64_val != uint64_min");

1581 
	`FAIL_UNLESS
(
doubË_v®
 =ð(
lÚglÚg
è
ušt64_mš
, "double_val != uint64_min");

1582 
doubË_tmp
ð
	`ulÚglÚg2doubË
(
ušt64_v®
);

1583 
	`FAIL_UNLESS
(
	`cmp_doubË
(&
udoubË_v®
,&
doubË_tmp
), "udouble_val != double_tmp");

1584 
	`FAIL_UNLESS
(!
	`¡rcmp
(
lÚglÚg_as_¡ršg
, "0"), "longlong_as_string != '0'");

1585 
	`FAIL_UNLESS
(!
	`¡rcmp
(
ulÚglÚg_as_¡ršg
, "0"), "ulonglong_as_string != '0'");

1587 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

1589 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_DATA_TRUNCATED
 ||„c == 0, "rc != 0,MYSQL_DATA_TRUNCATED");

1591 
	`FAIL_UNLESS
(
št8_v®
 =ð
št8_max
, "int8_val != int8_max");

1592 
	`FAIL_UNLESS
(
ušt8_v®
 =ð
ušt8_max
, "uint8_val != uint8_max");

1593 
	`FAIL_UNLESS
(
št16_v®
 =ð
št16_max
, "int16_val != int16_max");

1594 
	`FAIL_UNLESS
(
ušt16_v®
 =ð
ušt16_max
, "uint16_val != uint16_max");

1595 
	`FAIL_UNLESS
(
št32_v®
 =ð
št32_max
, "int32_val != int32_max");

1596 
	`FAIL_UNLESS
(
ušt32_v®
 =ð
ušt32_max
, "uint32_val != uint32_max");

1597 
	`FAIL_UNLESS
(
št64_v®
 =ð
št64_max
, "int64_val != int64_max");

1598 
	`FAIL_UNLESS
(
ušt64_v®
 =ð
ušt64_max
, "uint64_val != uint64_max");

1599 
	`FAIL_UNLESS
(
doubË_v®
 =ð(
lÚglÚg
è
ušt64_v®
, "double_val != uint64_val");

1600 
doubË_tmp
ð
	`ulÚglÚg2doubË
(
ušt64_v®
);

1601 
	`FAIL_UNLESS
(
	`cmp_doubË
(&
udoubË_v®
,&
doubË_tmp
), "udouble_val != double_tmp");

1602 
	`FAIL_UNLESS
(!
	`¡rcmp
(
lÚglÚg_as_¡ršg
, "-1"), "longlong_as_string != '-1'");

1603 
	`FAIL_UNLESS
(!
	`¡rcmp
(
ulÚglÚg_as_¡ršg
, "18446744073709551615"), "ulonglong_as_string != '18446744073709551615'");

1605 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

1606 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "");

1608 
	`mysql_¡mt_þo£
(
¡mt
);

1610 
¡mt_‹xt
= "DROP TABLE1";

1611 
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

1612  
OK
;

1613 
	}
}

1620 
	$‹¡_ps_cÚj_£Ëù
(
MYSQL
 *
mysql
)

1622 
MYSQL_STMT
 *
¡mt
;

1623 
rc
;

1624 
MYSQL_BIND
 
my_bšd
[2];

1625 
št32
 
št_d©a
;

1626 
¡r_d©a
[32];

1627 
¡r_Ëngth
;

1628 
qu”y
[
MAX_TEST_QUERY_LENGTH
];

1630 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxists1");

1631 
	`check_mysql_rc
(
rc
, 
mysql
);

1633 
rc
ð
	`mysql_qu”y
(
mysql
, "createable1 (id1 int(11) NOT NULL default '0', "

1635 
	`check_mysql_rc
(
rc
, 
mysql
);

1637 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into1 values (1, 'hh', 'hh'), "

1639 
	`check_mysql_rc
(
rc
, 
mysql
);

1641 
	`¡rýy
(
qu”y
, "select id1, value1 from1 where id1= ? or "

1643 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

1644 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

1645 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

1646 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1648 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
) != 2, "param_count != 2");

1651 
	`mem£t
(
my_bšd
, '\0', (my_bind));

1652 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

1653 
my_bšd
[0].
bufãr
ð(*)&
št_d©a
;

1655 
my_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_VAR_STRING
;

1656 
my_bšd
[1].
bufãr
ð(*)
¡r_d©a
;

1657 
my_bšd
[1].
bufãr_Ëngth
ð
	`¬¿y_–em’ts
(
¡r_d©a
);

1658 
my_bšd
[1].
Ëngth
ð&
¡r_Ëngth
;

1660 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

1661 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1662 
št_d©a
= 1;

1663 
	`¡rýy
(
¡r_d©a
, "hh");

1664 
¡r_Ëngth
ð()
	`¡¾’
(
¡r_d©a
);

1666 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1667 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1669 
rc
=0;

1670 
	`mysql_¡mt_ãtch
(
¡mt
è!ð
MYSQL_NO_DATA
)

1671 
rc
++;

1672 
	`FAIL_UNLESS
(
rc
 == 3, "rc != 3");

1674 
	`mysql_¡mt_þo£
(
¡mt
);

1675 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxists1");

1676 
	`check_mysql_rc
(
rc
, 
mysql
);

1677  
OK
;

1678 
	}
}

1682 
	$‹¡_ps_nuÎ_·¿m
(
MYSQL
 *
mysql
)

1684 
MYSQL_STMT
 *
¡mt
;

1685 
rc
;

1687 
MYSQL_BIND
 
š_bšd
;

1688 
my_boÞ
 
š_is_nuÎ
;

1689 
š_lÚg
;

1691 
MYSQL_BIND
 
out_bšd
;

1692 
ulÚg
 
out_Ëngth
;

1693 
my_boÞ
 
out_is_nuÎ
;

1694 
out_¡r_d©a
[20];

1696 cÚ¡ *
qu”›s
[]= {"select ?", "select ?+1",

1698 
NULL


1700 cÚ¡ **
cur_qu”y
ð
qu”›s
;

1703 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_ps_nulls");

1704 
	`check_mysql_rc
(
rc
, 
mysql
);

1706 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_ps_nulls(col1 int)");

1707 
	`check_mysql_rc
(
rc
, 
mysql
);

1709 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTOest_ps_nulls values (1), (null)");

1710 
	`check_mysql_rc
(
rc
, 
mysql
);

1713 
	`mem£t
(&
š_bšd
, '\0', (in_bind));

1714 
	`mem£t
(&
out_bšd
, '\0', (out_bind));

1715 
š_bšd
.
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

1716 
š_bšd
.
is_nuÎ
ð&
š_is_nuÎ
;

1717 
š_bšd
.
Ëngth
= 0;

1718 
š_bšd
.
bufãr
ð(*)&
š_lÚg
;

1719 
š_is_nuÎ
= 1;

1720 
š_lÚg
= 1;

1722 
out_bšd
.
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

1723 
out_bšd
.
is_nuÎ
ð&
out_is_nuÎ
;

1724 
out_bšd
.
Ëngth
ð&
out_Ëngth
;

1725 
out_bšd
.
bufãr
ð
out_¡r_d©a
;

1726 
out_bšd
.
bufãr_Ëngth
ð
	`¬¿y_–em’ts
(
out_¡r_d©a
);

1729 
cur_qu”y
ð
qu”›s
; *cur_query; cur_query++)

1731 
qu”y
[
MAX_TEST_QUERY_LENGTH
];

1732 
	`¡rýy
(
qu”y
, *
cur_qu”y
);

1733 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

1734 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

1735 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

1736 
	`dŸg
("¡©em’t: %s", 
qu”y
);

1737 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1738 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
) != 1, "param_count != 1");

1740 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, &
š_bšd
);

1741 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1742 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, &
out_bšd
);

1743 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1744 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1745 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1746 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

1747 
	`FAIL_UNLESS
(
rc
 !ð
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

1748 
	`FAIL_UNLESS
(
out_is_nuÎ
, "!out_is_null");

1749 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

1750 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

1751 
	`mysql_¡mt_þo£
(
¡mt
);

1753 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_ps_nulls");

1754 
	`check_mysql_rc
(
rc
, 
mysql
);

1755  
OK
;

1756 
	}
}

1762 
	#‹¡_ps_qu”y_ÿche_»suÉ
(
i1
,
s1
,
l1
,
i2
,
s2
,
l2
,
i3
,
s3
,
l3
) \

1763 
r_m‘ad©a
ð
	`mysql_¡mt_»suÉ_m‘ad©a
(
¡mt
); \

1764 
	`FAIL_UNLESS
(
r_m‘ad©a
 !ð
NULL
, ""); \

1765 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
); \

1766 
	`check_¡mt_rc
(
rc
,
¡mt
); \

1767 
	`FAIL_UNLESS
((
r_št_d©a
 =ð
i1
è&& (
r_¡r_Ëngth
 =ð
l1
) && \

1768 (
	`¡rcmp
(
r_¡r_d©a
, 
s1
) == 0), "test_ps_query_cache_result failure"); \

1769 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
); \

1770 
	`check_¡mt_rc
(
rc
,
¡mt
); \

1771 
	`FAIL_UNLESS
((
r_št_d©a
 =ð
i2
è&& (
r_¡r_Ëngth
 =ð
l2
) && \

1772 (
	`¡rcmp
(
r_¡r_d©a
, 
s2
) == 0), "test_ps_query_cache_result failure"); \

1773 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
); \

1774 
	`check_¡mt_rc
(
rc
,
¡mt
); \

1775 
	`FAIL_UNLESS
((
r_št_d©a
 =ð
i3
è&& (
r_¡r_Ëngth
 =ð
l3
) && \

1776 (
	`¡rcmp
(
r_¡r_d©a
, 
s3
) == 0), "test_ps_query_cache_result failure"); \

1777 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
); \

1778 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA"); \

1779 
	`mysql_ä“_»suÉ
(
r_m‘ad©a
);

	)

1782 
	$qu”y_ÿche_h™s
(
MYSQL
 *
mysql
)

1784 
MYSQL_RES
 *
»s
;

1785 
MYSQL_ROW
 
row
;

1786 
rc
;

1787 
ušt
 
»suÉ
;

1789 
rc
ð
	`mysql_qu”y
(
mysql
, "show status†ike 'qcache_hits'");

1790 
	`check_mysql_rc
(
rc
, 
mysql
);

1791 
»s
ð
	`mysql_u£_»suÉ
(
mysql
);

1793 
row
ð
	`mysql_ãtch_row
(
»s
);

1795 
»suÉ
ð
	`©oi
(
row
[1]);

1796 
	`mysql_ä“_»suÉ
(
»s
);

1797  
»suÉ
;

1798 
	}
}

1805 
	$‹¡_ps_qu”y_ÿche
(
MYSQL
 *
mysql
)

1807 
MYSQL
 *
lmysql
ð
mysql
;

1808 
MYSQL_STMT
 *
¡mt
;

1809 
rc
;

1810 
MYSQL_BIND
 
p_bšd
[2],
r_bšd
[2];

1811 
št32
 
p_št_d©a
, 
r_št_d©a
;

1812 
p_¡r_d©a
[32], 
r_¡r_d©a
[32];

1813 
p_¡r_Ëngth
, 
r_¡r_Ëngth
;

1814 
MYSQL_RES
 *
r_m‘ad©a
;

1815 
qu”y
[
MAX_TEST_QUERY_LENGTH
];

1816 
ušt
 
h™s1
, 
h™s2
;

1817 
	e’um_‹¡_ps_qu”y_ÿche


1824 
TEST_QCACHE_ON
= 0,

1829 
TEST_QCACHE_ON_WITH_OTHER_CONN
,

1834 
TEST_QCACHE_OFF_ON
,

1839 
TEST_QCACHE_ON_OFF


1841 
’um_‹¡_ps_qu”y_ÿche
 
™”©iÚ
;

1843 
	`dŸg
("test‚eedso be fixed");

1844  
SKIP
;

1847 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxists1");

1848 
	`check_mysql_rc
(
rc
, 
mysql
);

1850 
rc
ð
	`mysql_qu”y
(
mysql
, "createable1 (id1 int(11) NOT NULL default '0', "

1852 
	`check_mysql_rc
(
rc
, 
mysql
);

1854 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into1 values (1, 'hh', 'hh'), "

1856 
	`check_mysql_rc
(
rc
, 
mysql
);

1858 
™”©iÚ
ð
TEST_QCACHE_ON
; i‹¿tiÚ <ð
TEST_QCACHE_ON_OFF
; iteration++)

1860 
™”©iÚ
) {

1861 
TEST_QCACHE_ON
:

1862 
TEST_QCACHE_ON_OFF
:

1863 
rc
ð
	`mysql_qu”y
(
lmysql
, "set global query_cache_size=1000000");

1864 
	`check_mysql_rc
(
rc
, 
mysql
);

1866 
TEST_QCACHE_OFF_ON
:

1867 
rc
ð
	`mysql_qu”y
(
lmysql
, "set global query_cache_size=0");

1868 
	`check_mysql_rc
(
rc
, 
mysql
);

1870 
TEST_QCACHE_ON_WITH_OTHER_CONN
:

1871 
lmysql
ð
	`‹¡_cÚÃù
(
NULL
);

1872 
	`FAIL_IF
(!
lmysql
, "Opening‚ew connection failed");

1876 
	`¡rýy
(
qu”y
, "select id1, value1 from1 where id1= ? or "

1878 
¡mt
ð
	`mysql_¡mt_š™
(
lmysql
);

1879 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
lmysql
));

1880 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

1881 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1883 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
) != 2, "param_count != 2");

1885 
™”©iÚ
) {

1886 
TEST_QCACHE_OFF_ON
:

1887 
rc
ð
	`mysql_qu”y
(
lmysql
, "set global query_cache_size=1000000");

1888 
	`check_mysql_rc
(
rc
, 
mysql
);

1890 
TEST_QCACHE_ON_OFF
:

1891 
rc
ð
	`mysql_qu”y
(
lmysql
, "set global query_cache_size=0");

1892 
	`check_mysql_rc
(
rc
, 
mysql
);

1897 
	`mem£t
(
p_bšd
, '\0', (p_bind));

1898 
p_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

1899 
p_bšd
[0].
bufãr
ð(*)&
p_št_d©a
;

1900 
p_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_VAR_STRING
;

1901 
p_bšd
[1].
bufãr
ð(*)
p_¡r_d©a
;

1902 
p_bšd
[1].
bufãr_Ëngth
ð
	`¬¿y_–em’ts
(
p_¡r_d©a
);

1903 
p_bšd
[1].
Ëngth
ð&
p_¡r_Ëngth
;

1905 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
p_bšd
);

1906 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1907 
p_št_d©a
= 1;

1908 
	`¡rýy
(
p_¡r_d©a
, "hh");

1909 
p_¡r_Ëngth
ð()
	`¡¾’
(
p_¡r_d©a
);

1911 
	`mem£t
(
r_bšd
, '\0', (r_bind));

1912 
r_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

1913 
r_bšd
[0].
bufãr
ð(*)&
r_št_d©a
;

1914 
r_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_VAR_STRING
;

1915 
r_bšd
[1].
bufãr
ð(*)
r_¡r_d©a
;

1916 
r_bšd
[1].
bufãr_Ëngth
ð
	`¬¿y_–em’ts
(
r_¡r_d©a
);

1917 
r_bšd
[1].
Ëngth
ð&
r_¡r_Ëngth
;

1919 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
r_bšd
);

1920 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1921 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1922 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1923 
	`‹¡_ps_qu”y_ÿche_»suÉ
(1, "hh", 2, 2, "hh", 2, 1, "ii", 2);

1924 
r_m‘ad©a
ð
	`mysql_¡mt_»suÉ_m‘ad©a
(
¡mt
);

1925 
	`FAIL_UNLESS
(
r_m‘ad©a
 !ð
NULL
, "");

1926 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

1927 
	`check_¡mt_rc
(
rc
,
¡mt
);

1928 
	`FAIL_UNLESS
((
r_št_d©a
 =ð1è&& (
r_¡r_Ëngth
 == 2) &&

1929 (
	`¡rcmp
(
r_¡r_d©a
, "hh") == 0), "test_ps_query_cache_result failure"); \

1930 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

1931 
	`check_¡mt_rc
(
rc
,
¡mt
);

1932 
	`FAIL_UNLESS
((
r_št_d©a
 =ð2è&& (
r_¡r_Ëngth
 == 2) &&

1933 (
	`¡rcmp
(
r_¡r_d©a
, "hh") == 0), "test_ps_query_cache_result failure"); \

1934 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

1935 
	`check_¡mt_rc
(
rc
,
¡mt
);

1936 
	`FAIL_UNLESS
((
r_št_d©a
 =ð1è&& (
r_¡r_Ëngth
 == 2) &&

1937 (
	`¡rcmp
(
r_¡r_d©a
, "ii") == 0), "test_ps_query_cache_result failure"); \

1938 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

1939 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

1940 
	`mysql_ä“_»suÉ
(
r_m‘ad©a
);

1944 
h™s1
ð
	`qu”y_ÿche_h™s
(
lmysql
);

1945 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1946 
	`check_¡mt_rc
(
rc
, 
¡mt
); 
	`‹¡_ps_qu”y_ÿche_»suÉ
(1, "hh", 2, 2, "hh", 2, 1, "ii", 2);

1947 
h™s2
ð
	`qu”y_ÿche_h™s
(
lmysql
);

1948 
™”©iÚ
) {

1949 
TEST_QCACHE_ON_WITH_OTHER_CONN
:

1950 
TEST_QCACHE_ON
:

1951 
	`FAIL_UNLESS
(
h™s2
-
h™s1
 == 1, "hits2 != hits1 + 1");

1953 
TEST_QCACHE_OFF_ON
:

1954 
TEST_QCACHE_ON_OFF
:

1955 
	`FAIL_UNLESS
(
h™s2
-
h™s1
 == 0, "hits2 != hits1");

1960 
	`¡rýy
(
p_¡r_d©a
, "ii");

1961 
p_¡r_Ëngth
ð()
	`¡¾’
(
p_¡r_d©a
);

1962 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1963 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1964 
	`‹¡_ps_qu”y_ÿche_»suÉ
(1, "hh", 2, 1, "ii", 2, 2, "ii", 2);

1965 
h™s1
ð
	`qu”y_ÿche_h™s
(
lmysql
);

1967 
™”©iÚ
) {

1968 
TEST_QCACHE_ON
:

1969 
TEST_QCACHE_OFF_ON
:

1970 
TEST_QCACHE_ON_OFF
:

1971 
	`FAIL_UNLESS
(
h™s2
-
h™s1
 == 0, "hits2 != hits1");

1973 
TEST_QCACHE_ON_WITH_OTHER_CONN
:

1974 
	`FAIL_UNLESS
(
h™s1
-
h™s2
 == 1, "hits2 != hits1+1");

1978 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

1979 
	`check_¡mt_rc
(
rc
, 
¡mt
);

1980 
	`‹¡_ps_qu”y_ÿche_»suÉ
(1, "hh", 2, 1, "ii", 2, 2, "ii", 2);

1981 
h™s2
ð
	`qu”y_ÿche_h™s
(
lmysql
);

1983 
	`mysql_¡mt_þo£
(
¡mt
);

1985 
™”©iÚ
) {

1986 
TEST_QCACHE_ON
:

1987 
	`FAIL_UNLESS
(
h™s2
-
h™s1
 == 1, "hits2 != hits1+1");

1989 
TEST_QCACHE_OFF_ON
:

1990 
TEST_QCACHE_ON_OFF
:

1991 
	`FAIL_UNLESS
(
h™s2
-
h™s1
 == 0, "hits2 != hits1");

1993 
TEST_QCACHE_ON_WITH_OTHER_CONN
:

1994 
	`FAIL_UNLESS
(
h™s2
-
h™s1
 == 1, "hits2 != hits1+1");

2000 ià(
lmysql
 !ð
mysql
)

2001 
	`mysql_þo£
(
lmysql
);

2003 
rc
ð
	`mysql_qu”y
(
mysql
, "set global query_cache_size=0");

2004 
	`check_mysql_rc
(
rc
, 
mysql
);

2005  
OK
;

2006 
	}
}

2008 
	$‹¡_bug3117
(
MYSQL
 *
mysql
)

2010 
MYSQL_STMT
 *
¡mt
;

2011 
MYSQL_BIND
 
bufãr
;

2012 
lÚglÚg
 
lii
;

2013 
ulÚg
 
Ëngth
;

2014 
my_boÞ
 
is_nuÎ
;

2015 
rc
;

2017 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

2018 
	`check_mysql_rc
(
rc
, 
mysql
);

2020 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE1 (id int‡uto_increment…rimary key)");

2021 
	`check_mysql_rc
(
rc
, 
mysql
);

2023 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

2024 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

2025 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("SELECT LAST_INSERT_ID()"));

2026 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2028 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTO1 VALUES (NULL)");

2029 
	`check_mysql_rc
(
rc
, 
mysql
);

2031 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

2032 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2033 
	`mem£t
(&
bufãr
, '\0', (buffer));

2034 
bufãr
.
bufãr_ty³
ð
MYSQL_TYPE_LONGLONG
;

2035 
bufãr
.
bufãr_Ëngth
ð(
lii
);

2036 
bufãr
.bufãrð(*)&
lii
;

2037 
bufãr
.
Ëngth
= &length;

2038 
bufãr
.
is_nuÎ
= &is_null;

2040 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, &
bufãr
);

2041 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2042 
rc
ð
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

2043 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2044 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

2045 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2046 
	`FAIL_UNLESS
(
is_nuÎ
 =ð0 && 
lii
 == 1, "is_null != 0 ||†ii != 1");

2048 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTO1 VALUES (NULL)");

2049 
	`check_mysql_rc
(
rc
, 
mysql
);

2051 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

2052 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2053 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

2054 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2055 
	`FAIL_UNLESS
(
is_nuÎ
 =ð0 && 
lii
 == 2, "is_null != 0 ||†ii != 2");

2057 
	`mysql_¡mt_þo£
(
¡mt
);

2059 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE1");

2060 
	`check_mysql_rc
(
rc
, 
mysql
);

2061  
OK
;

2062 
	}
}

2068 
	$‹¡_bug36004
(
MYSQL
 *
mysql
)

2070 
rc
, 
w¬nšg_couÁ
= 0;

2071 
MYSQL_STMT
 *
¡mt
;

2072 
SKIP_MAXSCALE
;

2075 ià(
	`mysql_g‘_£rv”_v”siÚ
(
mysql
) < 60000) {

2076 
	`dŸg
("Test„equires MySQL Server version 6.0 or‡bove");

2077  
SKIP
;

2080 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxists inexistant");

2081 
	`check_mysql_rc
(
rc
, 
mysql
);

2083 
	`FAIL_UNLESS
(
	`mysql_w¬nšg_couÁ
(
mysql
) == 1, "");

2084 
	`qu”y_št_v¬ŸbË
(
mysql
, "@@w¬nšg_couÁ", &
w¬nšg_couÁ
);

2085 
	`FAIL_UNLESS
(
w¬nšg_couÁ
, "Warningƒxpected");

2087 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

2088 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

2089 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("select 1"));

2090 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2092 
	`FAIL_UNLESS
(
	`mysql_w¬nšg_couÁ
(
mysql
) == 0, "No warningƒxpected");

2093 
	`qu”y_št_v¬ŸbË
(
mysql
, "@@w¬nšg_couÁ", &
w¬nšg_couÁ
);

2094 
	`FAIL_UNLESS
(
w¬nšg_couÁ
, "warningƒxpected");

2096 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

2097 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2098 
	`FAIL_UNLESS
(
	`mysql_w¬nšg_couÁ
(
mysql
) == 0, "No warningƒxpected");

2099 
	`mysql_¡mt_þo£
(
¡mt
);

2101 
	`qu”y_št_v¬ŸbË
(
mysql
, "@@w¬nšg_couÁ", &
w¬nšg_couÁ
);

2102 
	`FAIL_UNLESS
(
w¬nšg_couÁ
, "Warningƒxpected");

2104 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

2105 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

2106 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("dropable ifƒxists inexistant"));

2107 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2109 
	`qu”y_št_v¬ŸbË
(
mysql
, "@@w¬nšg_couÁ", &
w¬nšg_couÁ
);

2110 
	`FAIL_UNLESS
(
w¬nšg_couÁ
 == 0, "No warningƒxpected");

2111 
	`mysql_¡mt_þo£
(
¡mt
);

2113  
OK
;

2114 
	}
}

2116 
	$‹¡_bug3796
(
MYSQL
 *
mysql
)

2118 
MYSQL_STMT
 *
¡mt
;

2119 
MYSQL_BIND
 
my_bšd
[1];

2120 cÚ¡ *
cÚÿt_¬g0
= "concat_with_";

2121 ’um { 
OUT_BUFF_SIZE
= 30 };

2122 
out_buff
[
OUT_BUFF_SIZE
];

2123 
ÿnÚiÿl_buff
[
OUT_BUFF_SIZE
];

2124 
ulÚg
 
out_Ëngth
;

2125 cÚ¡ *
¡mt_‹xt
;

2126 
rc
;

2130 
¡mt_‹xt
= "DROP TABLE IF EXISTS1";

2131 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

2132 
	`check_mysql_rc
(
rc
, 
mysql
);

2134 
¡mt_‹xt
= "CREATE TABLE1 (a INT, b VARCHAR(30))";

2135 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

2136 
	`check_mysql_rc
(
rc
, 
mysql
);

2138 
¡mt_‹xt
= "INSERT INTO1 VALUES(1, 'ONE'), (2, 'TWO')";

2139 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

2140 
	`check_mysql_rc
(
rc
, 
mysql
);

2143 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

2144 
¡mt_‹xt
= "SELECT concat(?, b) FROM1";

2146 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

2147 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2149 
	`mem£t
(
my_bšd
, '\0', (my_bind));

2150 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

2151 
my_bšd
[0].
bufãr
ð(*è
cÚÿt_¬g0
;

2152 
my_bšd
[0].
bufãr_Ëngth
ð()
	`¡¾’
(
cÚÿt_¬g0
);

2154 
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

2157 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

2158 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2159 
my_bšd
[0].
bufãr
ð(*è
out_buff
;

2160 
my_bšd
[0].
bufãr_Ëngth
ð
OUT_BUFF_SIZE
;

2161 
my_bšd
[0].
Ëngth
ð&
out_Ëngth
;

2163 
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

2165 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

2166 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2167 
	`¡rýy
(
ÿnÚiÿl_buff
, 
cÚÿt_¬g0
);

2168 
	`¡rÿt
(
ÿnÚiÿl_buff
, "ONE");

2169 
	`FAIL_UNLESS
(
	`¡¾’
(
ÿnÚiÿl_buff
è=ð
out_Ëngth
 &&

2170 
	`¡ºcmp
(
out_buff
, 
ÿnÚiÿl_buff
, 
out_Ëngth
) == 0, "");

2172 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

2173 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2174 
	`¡rýy
(
ÿnÚiÿl_buff
 + 
	`¡¾’
(
cÚÿt_¬g0
), "TWO");

2175 
	`FAIL_UNLESS
(
	`¡¾’
(
ÿnÚiÿl_buff
è=ð
out_Ëngth
 &&

2176 
	`¡ºcmp
(
out_buff
, 
ÿnÚiÿl_buff
, 
out_Ëngth
) == 0, "");

2178 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

2179 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

2181 
	`mysql_¡mt_þo£
(
¡mt
);

2183 
¡mt_‹xt
= "DROP TABLE IF EXISTS1";

2184 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

2185 
	`check_mysql_rc
(
rc
, 
mysql
);

2186  
OK
;

2187 
	}
}

2189 
	$‹¡_bug4026
(
MYSQL
 *
mysql
)

2191 
MYSQL_STMT
 *
¡mt
;

2192 
MYSQL_BIND
 
my_bšd
[2];

2193 
MYSQL_TIME
 
time_š
, 
time_out
;

2194 
MYSQL_TIME
 
d©‘ime_š
, 
d©‘ime_out
;

2195 cÚ¡ *
¡mt_‹xt
;

2196 
rc
;

2202 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

2203 
¡mt_‹xt
= "SELECT ?, ?";

2205 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

2206 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2208 
	`mem£t
(
my_bšd
, '\0', (
MYSQL_BIND
) * 2);

2209 
	`mem£t
(&
time_š
, '\0', (
MYSQL_TIME
));

2210 
	`mem£t
(&
time_out
, '\0', (
MYSQL_TIME
));

2211 
	`mem£t
(&
d©‘ime_š
, '\0', (
MYSQL_TIME
));

2212 
	`mem£t
(&
d©‘ime_out
, '\0', (
MYSQL_TIME
));

2213 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_TIME
;

2214 
my_bšd
[0].
bufãr
ð(*è&
time_š
;

2215 
my_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_DATETIME
;

2216 
my_bšd
[1].
bufãr
ð(*è&
d©‘ime_š
;

2218 
time_š
.
hour
= 23;

2219 
time_š
.
mšu‹
= 59;

2220 
time_š
.
£cÚd
= 59;

2221 
time_š
.
£cÚd_·¹
= 123456;

2226 
time_š
.
time_ty³
ð
MYSQL_TIMESTAMP_TIME
;

2228 
d©‘ime_š
ð
time_š
;

2229 
d©‘ime_š
.
y—r
= 2003;

2230 
d©‘ime_š
.
mÚth
= 12;

2231 
d©‘ime_š
.
day
= 31;

2232 
d©‘ime_š
.
time_ty³
ð
MYSQL_TIMESTAMP_DATETIME
;

2234 
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

2237 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

2238 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2239 
my_bšd
[0].
bufãr
ð(*è&
time_out
;

2240 
my_bšd
[1].
bufãr
ð(*è&
d©‘ime_out
;

2242 
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

2244 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

2245 
	`FAIL_UNLESS
(
rc
 == 0, "rc != 0");

2246 
	`FAIL_UNLESS
(
	`memcmp
(&
time_š
, &
time_out
, (time_in)) == 0, "time_in !=ime_out");

2247 
	`FAIL_UNLESS
(
	`memcmp
(&
d©‘ime_š
, &
d©‘ime_out
, (datetime_in)) == 0, "datetime_in != datetime_out");

2248 
	`mysql_¡mt_þo£
(
¡mt
);

2250  
OK
;

2251 
	}
}

2253 
	$‹¡_bug4030
(
MYSQL
 *
mysql
)

2255 
MYSQL_STMT
 *
¡mt
;

2256 
MYSQL_BIND
 
my_bšd
[3];

2257 
MYSQL_TIME
 
time_ÿnÚiÿl
, 
time_out
;

2258 
MYSQL_TIME
 
d©e_ÿnÚiÿl
, 
d©e_out
;

2259 
MYSQL_TIME
 
d©‘ime_ÿnÚiÿl
, 
d©‘ime_out
;

2260 cÚ¡ *
¡mt_‹xt
;

2261 
rc
;

2267 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

2268 
¡mt_‹xt
= "SELECT '23:59:59.123456', '2003-12-31', "

2270 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

2271 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2272 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

2273 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2275 
	`mem£t
(
my_bšd
, '\0', (my_bind));

2276 
	`mem£t
(&
time_ÿnÚiÿl
, '\0', (time_canonical));

2277 
	`mem£t
(&
time_out
, '\0', (time_out));

2278 
	`mem£t
(&
d©e_ÿnÚiÿl
, '\0', (date_canonical));

2279 
	`mem£t
(&
d©e_out
, '\0', (date_out));

2280 
	`mem£t
(&
d©‘ime_ÿnÚiÿl
, '\0', (datetime_canonical));

2281 
	`mem£t
(&
d©‘ime_out
, '\0', (datetime_out));

2282 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_TIME
;

2283 
my_bšd
[0].
bufãr
ð(*è&
time_out
;

2284 
my_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_DATE
;

2285 
my_bšd
[1].
bufãr
ð(*è&
d©e_out
;

2286 
my_bšd
[2].
bufãr_ty³
ð
MYSQL_TYPE_DATETIME
;

2287 
my_bšd
[2].
bufãr
ð(*è&
d©‘ime_out
;

2289 
time_ÿnÚiÿl
.
hour
= 23;

2290 
time_ÿnÚiÿl
.
mšu‹
= 59;

2291 
time_ÿnÚiÿl
.
£cÚd
= 59;

2292 
time_ÿnÚiÿl
.
£cÚd_·¹
= 123456;

2293 
time_ÿnÚiÿl
.
time_ty³
ð
MYSQL_TIMESTAMP_TIME
;

2295 
d©e_ÿnÚiÿl
.
y—r
= 2003;

2296 
d©e_ÿnÚiÿl
.
mÚth
= 12;

2297 
d©e_ÿnÚiÿl
.
day
= 31;

2298 
d©e_ÿnÚiÿl
.
time_ty³
ð
MYSQL_TIMESTAMP_DATE
;

2300 
d©‘ime_ÿnÚiÿl
ð
time_ÿnÚiÿl
;

2301 
d©‘ime_ÿnÚiÿl
.
y—r
= 2003;

2302 
d©‘ime_ÿnÚiÿl
.
mÚth
= 12;

2303 
d©‘ime_ÿnÚiÿl
.
day
= 31;

2304 
d©‘ime_ÿnÚiÿl
.
time_ty³
ð
MYSQL_TIMESTAMP_DATETIME
;

2306 
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

2308 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

2309 
	`FAIL_UNLESS
(
rc
 == 0, "rc != 0");

2310 
	`FAIL_UNLESS
(
	`memcmp
(&
time_ÿnÚiÿl
, &
time_out
, (time_out)) == 0, "time_canonical !=ime_out");

2311 
	`FAIL_UNLESS
(
	`memcmp
(&
d©e_ÿnÚiÿl
, &
d©e_out
, (date_out)) == 0, "date_canoncical != date_out");

2312 
	`FAIL_UNLESS
(
	`memcmp
(&
d©‘ime_ÿnÚiÿl
, &
d©‘ime_out
, (datetime_out)) == 0, "datetime_canonical != datetime_out");

2313 
	`mysql_¡mt_þo£
(
¡mt
);

2314  
OK
;

2315 
	}
}

2317 
	$‹¡_bug4079
(
MYSQL
 *
mysql
)

2319 
MYSQL_STMT
 *
¡mt
;

2320 
MYSQL_BIND
 
my_bšd
[1];

2321 cÚ¡ *
¡mt_‹xt
;

2322 
ušt32
 
»s
;

2323 
rc
;

2326 
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

2327 
	`mysql_qu”y
(
mysql
, "CREATE TABLE1 (a int)");

2328 
	`mysql_qu”y
(
mysql
, "INSERT INTO1 VALUES (1), (2)");

2331 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

2332 
¡mt_‹xt
= "SELECT 1 < (SELECT‡ FROM1)";

2334 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

2335 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2337 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

2338 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2340 
	`mem£t
(
my_bšd
, '\0', (my_bind));

2341 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

2342 
my_bšd
[0].
bufãr
ð(*è&
»s
;

2344 
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

2346 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

2347 
	`FAIL_UNLESS
(
rc
 == 1, "rc != 1");

2349 
	`mysql_¡mt_þo£
(
¡mt
);

2350  
OK
;

2351 
	}
}

2353 
	$‹¡_bug4172
(
MYSQL
 *
mysql
)

2355 
MYSQL_STMT
 *
¡mt
;

2356 
MYSQL_BIND
 
my_bšd
[3];

2357 cÚ¡ *
¡mt_‹xt
;

2358 
MYSQL_RES
 *
»s
;

2359 
MYSQL_ROW
 
row
;

2360 
rc
;

2361 
f
[100], 
d
[100], 
e
[100];

2362 
ulÚg
 
f_Ën
, 
d_Ën
, 
e_Ën
;

2364 
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

2365 
	`mysql_qu”y
(
mysql
, "CREATE TABLE1 (f float, d double,ƒ decimal(10,4))");

2366 
	`mysql_qu”y
(
mysql
, "INSERT INTO1 VALUES (12345.1234, 123456.123456, "

2369 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

2370 
¡mt_‹xt
= "SELECT f, d,ƒ FROM1";

2372 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

2373 
	`check_¡mt_rc
(
rc
, 
¡mt
);„cð
	`mysql_¡mt_execu‹
(stmt);

2374 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2375 
	`mem£t
(
my_bšd
, '\0', (my_bšd)); my_bšd[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

2376 
my_bšd
[0].
bufãr
ð
f
;

2377 
my_bšd
[0].
bufãr_Ëngth
ð(
f
);

2378 
my_bšd
[0].
Ëngth
ð&
f_Ën
;

2379 
my_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

2380 
my_bšd
[1].
bufãr
ð
d
;

2381 
my_bšd
[1].
bufãr_Ëngth
ð(
d
);

2382 
my_bšd
[1].
Ëngth
ð&
d_Ën
;

2383 
my_bšd
[2].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

2384 
my_bšd
[2].
bufãr
ð
e
;

2385 
my_bšd
[2].
bufãr_Ëngth
ð(
e
);

2386 
my_bšd
[2].
Ëngth
ð&
e_Ën
;

2388 
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

2390 
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

2391 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

2392 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2393 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

2394 
	`check_mysql_rc
(
rc
, 
mysql
);

2395 
»s
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

2396 
row
ð
	`mysql_ãtch_row
(
»s
);

2398 
	`dŸg
("ex³ùed % % %s", 
row
[0],„ow[1],„ow[2]);

2399 
	`dŸg
("ãtched % % %s", 
f
, 
d
, 
e
);

2400 
	`FAIL_UNLESS
(!
	`¡rcmp
(
f
, 
row
[0]è&& !¡rcmp(
d
,„ow[1]è&& !¡rcmp(
e
,„ow[2]), "");

2402 
	`mysql_ä“_»suÉ
(
»s
);

2403 
	`mysql_¡mt_þo£
(
¡mt
);

2404  
OK
;

2405 
	}
}

2407 
	$‹¡_bug4231
(
MYSQL
 *
mysql
)

2409 
MYSQL_STMT
 *
¡mt
;

2410 
MYSQL_BIND
 
my_bšd
[2];

2411 
MYSQL_TIME
 
tm
[2];

2412 cÚ¡ *
¡mt_‹xt
;

2413 
rc
;

2416 
¡mt_‹xt
= "DROP TABLE IF EXISTS1";

2417 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

2418 
	`check_mysql_rc
(
rc
, 
mysql
);

2420 
¡mt_‹xt
= "CREATE TABLE1 (a int)";

2421 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

2422 
	`check_mysql_rc
(
rc
, 
mysql
);

2424 
¡mt_‹xt
= "INSERT INTO1 VALUES (1)";

2425 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

2426 
	`check_mysql_rc
(
rc
, 
mysql
);

2428 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

2429 
¡mt_‹xt
= "SELECT‡ FROM1 WHERE ? = ?";

2430 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

2431 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2433 
	`mem£t
(
my_bšd
, '\0', (my_bšd)); mem£t(
tm
, '\0', (tm));

2434 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_DATE
;

2435 
my_bšd
[0].
bufãr
ð&
tm
[0];

2436 
my_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_DATE
;

2437 
my_bšd
[1].
bufãr
ð&
tm
[1];

2439 
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

2440 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2446 
tm
[0].
time_ty³
 = 
MYSQL_TIMESTAMP_DATE
;

2447 
tm
[0].
y—r
 = 2000;

2448 
tm
[0].
mÚth
 = 1;

2449 
tm
[0].
day
 = 1;

2450 
tm
[1]=m[0];

2451 --
tm
[1].
y—r
;

2453 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

2454 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2455 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

2458 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

2461 
tm
[0].
y—r
ðtm[0].
mÚth
ðtm[0].
day
= 0;

2462 
tm
[1]=m[0];

2463 
	`mysql_¡mt_execu‹
(
¡mt
);

2464 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

2465 
	`FAIL_UNLESS
(
rc
 == 0, "rc != 0");

2467 
	`mysql_¡mt_þo£
(
¡mt
);

2468 
¡mt_‹xt
= "DROP TABLE1";

2469 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

2470 
	`check_mysql_rc
(
rc
, 
mysql
);

2471  
OK
;

2472 
	}
}

2474 
	$‹¡_bug4236
(
MYSQL
 *
mysql
)

2476 
MYSQL_STMT
 *
¡mt
, *
¡mt1
;

2477 cÚ¡ *
¡mt_‹xt
;

2478 
rc
;

2479 
MYSQL_STMT
 
backup
;

2480 
MYSQL
 *
mysql1
;

2483 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

2486 
¡mt_‹xt
= "SELECT 1";

2488 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

2489 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2490 
backup
.
¡mt_id
ð
¡mt
->stmt_id;

2491 
¡mt
->
¡mt_id
= 0;

2492 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

2493 
	`FAIL_IF
(!
rc
, "Errorƒxpected");

2496 
mysql1
ð
	`‹¡_cÚÃù
(
NULL
);

2497 
¡mt1
ð
	`mysql_¡mt_š™
(
mysql1
);

2498 
¡mt_‹xt
= "SELECT 2";

2499 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt1
, 
	`SL
(
¡mt_‹xt
));

2500 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2502 
¡mt
->
¡mt_id
ð
¡mt1
->stmt_id;

2503 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

2504 
	`FAIL_IF
(!
rc
, "Errorƒxpected");

2506 
	`mysql_¡mt_þo£
(
¡mt1
);

2507 
	`mysql_þo£
(
mysql1
);

2510 
¡mt
->
¡mt_id
ð
backup
.stmt_id;

2512 
	`mysql_¡mt_þo£
(
¡mt
);

2513  
OK
;

2514 
	}
}

2516 
	$‹¡_bug5126
(
MYSQL
 *
mysql
)

2518 
MYSQL_STMT
 *
¡mt
;

2519 
MYSQL_BIND
 
my_bšd
[2];

2520 
št32
 
c1
, 
c2
;

2521 cÚ¡ *
¡mt_‹xt
;

2522 
rc
;

2525 
¡mt_‹xt
= "DROP TABLE IF EXISTS1";

2526 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

2527 
	`check_mysql_rc
(
rc
, 
mysql
);

2529 
¡mt_‹xt
= "CREATE TABLE1 (a mediumint, b int)";

2530 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

2531 
	`check_mysql_rc
(
rc
, 
mysql
);

2533 
¡mt_‹xt
= "INSERT INTO1 VALUES (8386608, 1)";

2534 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

2535 
	`check_mysql_rc
(
rc
, 
mysql
);

2537 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

2538 
¡mt_‹xt
= "SELECT‡, b FROM1";

2539 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

2540 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2541 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

2542 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2544 
	`mem£t
(
my_bšd
, '\0', (my_bind));

2545 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

2546 
my_bšd
[0].
bufãr
ð&
c1
;

2547 
my_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

2548 
my_bšd
[1].
bufãr
ð&
c2
;

2550 
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

2552 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

2553 
	`FAIL_UNLESS
(
rc
 == 0, "rc != 0");

2554 
	`FAIL_UNLESS
(
c1
 =ð8386608 && 
c2
 == 1, "c1 != 8386608 || c2 != 1");

2555 
	`mysql_¡mt_þo£
(
¡mt
);

2556  
OK
;

2557 
	}
}

2559 
	$‹¡_bug5194
(
MYSQL
 *
mysql
)

2561 
MYSQL_STMT
 *
¡mt
;

2562 
MYSQL_BIND
 *
my_bšd
;

2563 *
qu”y
;

2564 *
·¿m_¡r
;

2565 
·¿m_¡r_Ëngth
;

2566 cÚ¡ *
¡mt_‹xt
;

2567 
rc
;

2568 
æßt_¬¿y
[250] =

2596 *
ç_±r
ð
æßt_¬¿y
;

2598 cÚ¡ 
COLUMN_COUNT
ð(
æßt_¬¿y
)/(*float_array);

2600 cÚ¡ 
MIN_ROWS_PER_INSERT
= 262;

2602 cÚ¡ 
MAX_ROWS_PER_INSERT
= 300;

2603 cÚ¡ 
MAX_PARAM_COUNT
ð
COLUMN_COUNT
*
MAX_ROWS_PER_INSERT
;

2604 cÚ¡ *
qu”y_‹m¶©e
= "insert into1 values %s";

2605 cÚ¡ 
CHARS_PER_PARAM
= 5;

2606 cÚ¡ 
ušt16_max
= 65535;

2607 
Äows
, 
i
;

2610 
¡mt_‹xt
= "dropable ifƒxists1";

2611 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

2613 
¡mt_‹xt
= "createable if‚otƒxists1"

2656 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

2657 
	`check_mysql_rc
(
rc
, 
mysql
);

2659 
my_bšd
ð(
MYSQL_BIND
*è
	`m®loc
(
MAX_PARAM_COUNT
 * (MYSQL_BIND));

2660 
qu”y
ð(*è
	`m®loc
(
	`¡¾’
(
qu”y_‹m¶©e
) +

2661 
MAX_PARAM_COUNT
 * 
CHARS_PER_PARAM
 + 1);

2662 
·¿m_¡r
ð(*è
	`m®loc
(
COLUMN_COUNT
 * 
CHARS_PER_PARAM
);

2664 
	`FAIL_IF
(
my_bšd
 =ð0 || 
qu”y
 =ð0 || 
·¿m_¡r
 == 0, "Notƒnough memory");

2666 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

2669 
	`¥rštf
(
·¿m_¡r
, "(");

2670 
i
ð1; i < 
COLUMN_COUNT
; ++i)

2671 
	`¡rÿt
(
·¿m_¡r
, "?, ");

2672 
	`¡rÿt
(
·¿m_¡r
, "?)");

2673 
·¿m_¡r_Ëngth
ð()
	`¡¾’
(
·¿m_¡r
);

2676 
	`mem£t
(
my_bšd
, '\0', 
MAX_PARAM_COUNT
 * (
MYSQL_BIND
));

2677 
i
ð0; i < 
MAX_PARAM_COUNT
; ++i)

2679 
my_bšd
[
i
].
bufãr_ty³
ð
MYSQL_TYPE_FLOAT
;

2680 
my_bšd
[
i
].
bufãr
ð
ç_±r
;

2681 ià(++
ç_±r
 =ð
æßt_¬¿y
 + 
COLUMN_COUNT
)

2682 
ç_±r
ð
æßt_¬¿y
;

2689 
Äows
ð
MIN_ROWS_PER_INSERT
;‚row <ð
MAX_ROWS_PER_INSERT
; ++nrows)

2691 *
qu”y_±r
;

2693 
	`¥rštf
(
qu”y
, 
qu”y_‹m¶©e
, 
·¿m_¡r
);

2694 
qu”y_±r
ð
qu”y
 + ()
	`¡¾’
(query);

2695 
i
ð1; i < 
Äows
; ++i)

2697 
	`memýy
(
qu”y_±r
, ", ", 2);

2698 
qu”y_±r
+= 2;

2699 
	`memýy
(
qu”y_±r
, 
·¿m_¡r
, 
·¿m_¡r_Ëngth
);

2700 
qu”y_±r
+ð
·¿m_¡r_Ëngth
;

2702 *
qu”y_±r
= '\0';

2704 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
qu”y
, (
ulÚg
)(
qu”y_±r
 - query));

2706 ià(
rc
 && 
Äows
 * 
COLUMN_COUNT
 > 
ušt16_max
)

2709 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2712 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

2713 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2714 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

2715 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2716 
rc
ð
	`mysql_¡mt_»£t
(
¡mt
);

2719 
	`ä“
(
·¿m_¡r
);

2720 
	`ä“
(
qu”y
);

2721 
rc
ð
	`mysql_¡mt_þo£
(
¡mt
);

2722 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2723 
	`ä“
(
my_bšd
);

2724 
¡mt_‹xt
= "dropable1";

2725 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

2726 
	`check_mysql_rc
(
rc
, 
mysql
);

2727  
OK
;

2728 
	}
}

2730 
	$‹¡_bug5315
(
MYSQL
 *
mysql
)

2732 
MYSQL_STMT
 *
¡mt
;

2733 cÚ¡ *
¡mt_‹xt
;

2734 
rc
;

2735 
SKIP_MAXSCALE
;

2737 ià(!
is_m¬Ÿdb
)

2738  
SKIP
;

2740 
¡mt_‹xt
= "SELECT 1";

2741 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

2742 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

2743 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2744 
rc
ð
	`mysql_chªge_u£r
(
mysql
, 
u£ºame
, 
·sswÜd
, 
schema
);

2745 
	`check_mysql_rc
(
rc
, 
mysql
);

2747 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

2748 
	`FAIL_UNLESS
(
rc
 != 0, "Errorƒxpected");

2750 
rc
ð
	`mysql_¡mt_þo£
(
¡mt
);

2751 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2753 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

2754 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

2755 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2756 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

2757 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2758 
	`mysql_¡mt_þo£
(
¡mt
);

2759  
OK
;

2760 
	}
}

2762 
	$‹¡_bug5399
(
MYSQL
 *
mysql
)

2768 
	#NUM_OF_USED_STMT
 97

	)

2769 
MYSQL_STMT
 *
¡mt_li¡
[
NUM_OF_USED_STMT
];

2770 
MYSQL_STMT
 **
¡mt
;

2771 
MYSQL_BIND
 
my_bšd
[1];

2772 
buff
[600];

2773 
rc
;

2774 
št32
 
no
;

2777 
	`mem£t
(
my_bšd
, '\0', (my_bšd)); my_bšd[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

2778 
my_bšd
[0].
bufãr
ð&
no
;

2780 
¡mt
ð
¡mt_li¡
; stmˆ!ð¡mt_li¡ + 
NUM_OF_USED_STMT
; ++stmt)

2782 
	`¥rštf
(
buff
, "£Ëù %d", (è(
¡mt
 - 
¡mt_li¡
));

2783 *
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

2784 
rc
ð
	`mysql_¡mt_´•¬e
(*
¡mt
, 
	`SL
(
buff
));

2785 
	`check_¡mt_rc
(
rc
, *
¡mt
); 
	`mysql_¡mt_bšd_»suÉ
(*¡mt, 
my_bšd
);

2788 
¡mt
ð
¡mt_li¡
; stmˆ!ð¡mt_li¡ + 
NUM_OF_USED_STMT
; ++stmt)

2790 
rc
ð
	`mysql_¡mt_execu‹
(*
¡mt
);

2791 
	`check_¡mt_rc
(
rc
, *
¡mt
);

2792 
rc
ð
	`mysql_¡mt_¡Üe_»suÉ
(*
¡mt
);

2793 
	`check_¡mt_rc
(
rc
, *
¡mt
);

2794 
rc
ð
	`mysql_¡mt_ãtch
(*
¡mt
);

2795 
	`FAIL_UNLESS
((
št32
è(
¡mt
 - 
¡mt_li¡
è=ð
no
, "");

2798 
¡mt
ð
¡mt_li¡
; stmˆ!ð¡mt_li¡ + 
NUM_OF_USED_STMT
; ++stmt)

2799 
	`mysql_¡mt_þo£
(*
¡mt
);

2800 #undeà
NUM_OF_USED_STMT


2801  
OK
;

2802 
	}
}

2804 
	$‹¡_bug6046
(
MYSQL
 *
mysql
)

2806 
MYSQL_STMT
 *
¡mt
;

2807 cÚ¡ *
¡mt_‹xt
;

2808 
rc
;

2809 
b
= 1;

2810 
MYSQL_BIND
 
my_bšd
[1];

2813 
¡mt_‹xt
= "DROP TABLE IF EXISTS1";

2814 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

2815 
	`check_mysql_rc
(
rc
, 
mysql
);

2816 
¡mt_‹xt
= "CREATE TABLE1 (a int, b int)";

2817 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

2818 
	`check_mysql_rc
(
rc
, 
mysql
);

2819 
¡mt_‹xt
= "INSERT INTO1 VALUES (1,1),(2,2),(3,1),(4,2)";

2820 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

2821 
	`check_mysql_rc
(
rc
, 
mysql
);

2823 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

2825 
¡mt_‹xt
= "SELECT1.a FROM1 NATURAL JOIN1‡s X1 "

2828 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

2829 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2830 
b
= 1;

2831 
	`mem£t
(
my_bšd
, '\0', (my_bšd)); my_bšd[0].
bufãr
ð&
b
;

2832 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_SHORT
;

2834 
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

2836 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

2837 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2838 
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

2840 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

2841 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2842 
	`mysql_¡mt_þo£
(
¡mt
);

2843  
OK
;

2844 
	}
}

2846 
	$‹¡_bug6049
(
MYSQL
 *
mysql
)

2848 
MYSQL_STMT
 *
¡mt
;

2849 
MYSQL_BIND
 
my_bšd
[1];

2850 
MYSQL_RES
 *
»s
;

2851 
MYSQL_ROW
 
row
;

2852 cÚ¡ *
¡mt_‹xt
;

2853 
bufãr
[30];

2854 
ulÚg
 
Ëngth
;

2855 
rc
;

2858 
¡mt_‹xt
= "SELECT MAKETIME(-25, 12, 12)";

2860 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

2861 
	`check_mysql_rc
(
rc
, 
mysql
);

2862 
»s
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

2863 
row
ð
	`mysql_ãtch_row
(
»s
);

2865 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

2866 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

2867 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2868 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

2869 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2870 
	`mem£t
(
my_bšd
, '\0', (my_bind));

2871 
my_bšd
[0].
bufãr_ty³
 = 
MYSQL_TYPE_STRING
;

2872 
my_bšd
[0].
bufãr
 = &buffer;

2873 
my_bšd
[0].
bufãr_Ëngth
 = (
bufãr
);

2874 
my_bšd
[0].
Ëngth
 = &length;

2876 
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

2877 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

2878 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2880 
	`FAIL_UNLESS
(
	`¡rcmp
(
row
[0], (*è
bufãr
) == 0, "row[0] != buffer");

2882 
	`mysql_ä“_»suÉ
(
»s
);

2883 
	`mysql_¡mt_þo£
(
¡mt
);

2884  
OK
;

2885 
	}
}

2887 
	$‹¡_bug6058
(
MYSQL
 *
mysql
)

2889 
MYSQL_STMT
 *
¡mt
;

2890 
MYSQL_BIND
 
my_bšd
[1];

2891 
MYSQL_RES
 *
»s
;

2892 
MYSQL_ROW
 
row
;

2893 cÚ¡ *
¡mt_‹xt
;

2894 
bufãr
[30];

2895 
ulÚg
 
Ëngth
;

2896 
rc
;

2899 
¡mt_‹xt
= "SELECT CAST('0000-00-00' AS DATE)";

2901 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

2902 
	`check_mysql_rc
(
rc
, 
mysql
);

2903 
»s
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

2904 
row
ð
	`mysql_ãtch_row
(
»s
);

2906 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

2907 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

2908 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2909 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

2910 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2911 
	`mem£t
(
my_bšd
, '\0', (my_bind));

2912 
my_bšd
[0].
bufãr_ty³
 = 
MYSQL_TYPE_STRING
;

2913 
my_bšd
[0].
bufãr
 = &buffer;

2914 
my_bšd
[0].
bufãr_Ëngth
 = (
bufãr
);

2915 
my_bšd
[0].
Ëngth
 = &length;

2917 
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

2918 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

2919 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2921 
	`FAIL_UNLESS
(
	`¡rcmp
(
row
[0], 
bufãr
) == 0, "row[0] != buffer");

2923 
	`mysql_ä“_»suÉ
(
»s
);

2924 
	`mysql_¡mt_þo£
(
¡mt
);

2925  
OK
;

2926 
	}
}

2929 
	$‹¡_bug6059
(
MYSQL
 *
mysql
)

2931 
MYSQL_STMT
 *
¡mt
;

2932 cÚ¡ *
¡mt_‹xt
;

2933 
rc
;

2935 
SKIP_SKYSQL
;

2937 
¡mt_‹xt
= "SELECT 'foo' INTO OUTFILE 'x.3'";

2939 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

2940 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

2941 
	`check_¡mt_rc
(
rc
, 
¡mt
);

2942 
	`FAIL_UNLESS
(
	`mysql_¡mt_f›ld_couÁ
(
¡mt
) == 0, "");

2943 
	`mysql_¡mt_þo£
(
¡mt
);

2944  
OK
;

2945 
	}
}

2947 
	$‹¡_bug6096
(
MYSQL
 *
mysql
)

2949 
MYSQL_STMT
 *
¡mt
;

2950 
MYSQL_RES
 *
qu”y_»suÉ
, *
¡mt_m‘ad©a
;

2951 cÚ¡ *
¡mt_‹xt
;

2952 
MYSQL_BIND
 
my_bšd
[12];

2953 
MYSQL_FIELD
 *
qu”y_f›ld_li¡
, *
¡mt_f›ld_li¡
;

2954 
ulÚg
 
qu”y_f›ld_couÁ
, 
¡mt_f›ld_couÁ
;

2955 
rc
;

2956 
my_boÞ
 
upd©e_max_Ëngth
ð
TRUE
;

2957 
ušt
 
i
;

2960 
¡mt_‹xt
= "dropable ifƒxists1";

2961 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

2962 
	`check_mysql_rc
(
rc
, 
mysql
);

2964 
	`mysql_qu”y
(
mysql
, "set sql_mode=''");

2965 
¡mt_‹xt
= "createable1 (c_tinyintinyint, c_smallint smallint, "

2971 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

2972 
	`check_mysql_rc
(
rc
, 
mysql
);

2973 
¡mt_‹xt
= "insert into1 values (-100, -20000, 30000000, 4, 8, 1.0, "

2975 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

2976 
	`check_mysql_rc
(
rc
, 
mysql
);

2978 
¡mt_‹xt
= "select * from1";

2981 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

2982 
	`check_mysql_rc
(
rc
, 
mysql
);

2983 
qu”y_»suÉ
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

2984 
qu”y_f›ld_li¡
ð
	`mysql_ãtch_f›lds
(
qu”y_»suÉ
);

2985 
	`FAIL_IF
(!
qu”y_f›ld_li¡
, "fetch_fields failed");

2986 
qu”y_f›ld_couÁ
ð
	`mysql_num_f›lds
(
qu”y_»suÉ
);

2988 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

2989 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

2990 
	`check_¡mt_rc
(
rc
, 
¡mt
);„cð
	`mysql_¡mt_execu‹
(stmt);

2991 
	`check_¡mt_rc
(
rc
, 
¡mt
); 
	`mysql_¡mt_©Œ_£t
(¡mt, 
STMT_ATTR_UPDATE_MAX_LENGTH
,

2992 (*è&
upd©e_max_Ëngth
);

2993 
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

2994 
¡mt_m‘ad©a
ð
	`mysql_¡mt_»suÉ_m‘ad©a
(
¡mt
);

2995 
¡mt_f›ld_li¡
ð
	`mysql_ãtch_f›lds
(
¡mt_m‘ad©a
);

2996 
¡mt_f›ld_couÁ
ð
	`mysql_num_f›lds
(
¡mt_m‘ad©a
);

2997 
	`FAIL_UNLESS
(
¡mt_f›ld_couÁ
 =ð
qu”y_f›ld_couÁ
, "");

3002 
	`mem£t
(
my_bšd
, '\0', (my_bind));

3003 
i
ð0; i < 
¡mt_f›ld_couÁ
; ++i)

3005 
my_bšd
[
i
].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

3006 
my_bšd
[
i
].
bufãr_Ëngth
ð
¡mt_f›ld_li¡
[i].
max_Ëngth
 + 1;

3007 
my_bšd
[
i
].
bufãr
ð
	`m®loc
(my_bšd[i].
bufãr_Ëngth
);

3009 
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

3010 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

3011 
	`dŸg
("rc=%d", 
rc
);

3012 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3013 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

3014 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

3018 
i
ð0; i < 
¡mt_f›ld_couÁ
; ++i)

3019 
	`ä“
(
my_bšd
[
i
].
bufãr
);

3020 
	`mysql_¡mt_þo£
(
¡mt
);

3021 
	`mysql_ä“_»suÉ
(
qu”y_»suÉ
);

3022 
	`mysql_ä“_»suÉ
(
¡mt_m‘ad©a
);

3023 
¡mt_‹xt
= "dropable1";

3024 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

3025 
	`check_mysql_rc
(
rc
, 
mysql
);

3026  
OK
;

3027 
	}
}

3031 
	$‹¡_bug7990
(
MYSQL
 *
mysql
)

3033 
MYSQL_STMT
 *
¡mt
;

3034 
rc
;

3036 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

3037 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, "foo", 3);

3042 
	`FAIL_UNLESS
(
rc
 && 
	`mysql_¡mt_”ºo
(
¡mt
è&& 
	`mysql_”ºo
(
mysql
), "Errorƒxpected");

3043 
	`mysql_¡mt_þo£
(
¡mt
);

3044  
OK
;

3045 
	}
}

3049 
	$‹¡_bug8330
(
MYSQL
 *
mysql
)

3051 cÚ¡ *
¡mt_‹xt
;

3052 
MYSQL_STMT
 *
¡mt
[2];

3053 
i
, 
rc
;

3054 cÚ¡ *
qu”y
= "select‡,b from1 where‡=?";

3055 
MYSQL_BIND
 
my_bšd
[2];

3056 
lv®
[2]= {1,2};

3058 
¡mt_‹xt
= "dropable ifƒxists1";

3060 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

3061 
	`check_mysql_rc
(
rc
, 
mysql
);

3062 
¡mt_‹xt
= "createable1 (a int, b int)";

3063 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

3064 
	`check_mysql_rc
(
rc
, 
mysql
);

3066 
	`mem£t
(
my_bšd
, '\0', (my_bind));

3067 
i
=0; i < 2; i++)

3069 
¡mt
[
i
]ð
	`mysql_¡mt_š™
(
mysql
);

3070 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
[
i
], 
	`SL
(
qu”y
));

3071 
	`check_¡mt_rc
(
rc
, 
¡mt
[
i
]);

3072 
my_bšd
[
i
].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

3073 
my_bšd
[
i
].
bufãr
ð(*è&
lv®
[i];

3074 
my_bšd
[
i
].
is_nuÎ
= 0;

3075 
	`mysql_¡mt_bšd_·¿m
(
¡mt
[
i
], &
my_bšd
[i]);

3078 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
[0]);

3079 
	`check_¡mt_rc
(
rc
, 
¡mt
[0]);

3080 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
[1]);

3081 
	`FAIL_UNLESS
(
rc
 && 
	`mysql_¡mt_”ºo
(
¡mt
[1]è=ð
CR_COMMANDS_OUT_OF_SYNC
, "Errorƒxpected");

3082 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
[0]);

3083 
	`check_¡mt_rc
(
rc
, 
¡mt
[0]);

3084 
	`mysql_¡mt_þo£
(
¡mt
[0]);

3085 
	`mysql_¡mt_þo£
(
¡mt
[1]);

3087 
¡mt_‹xt
= "dropable1";

3088 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

3089 
	`check_mysql_rc
(
rc
, 
mysql
);

3090  
OK
;

3091 
	}
}

3095 
	$‹¡_f›ld_misc
(
MYSQL
 *
mysql
)

3097 
MYSQL_STMT
 *
¡mt
;

3098 
MYSQL_RES
 *
»suÉ
;

3099 
rc
;

3102 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT @@autocommit");

3103 
	`check_mysql_rc
(
rc
, 
mysql
);

3105 
»suÉ
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

3106 
	`FAIL_IF
(!
»suÉ
, "Invalid„esult set");

3108 
rc
= 0;

3109 
	`mysql_ãtch_row
(
»suÉ
))

3110 
rc
++;

3111 
	`FAIL_UNLESS
(
rc
 == 1, "rowcount != 1");

3113 
	`v”ify_´•¬e_f›ld
(
»suÉ
, 0,

3115 
MYSQL_TYPE_LONGLONG
,

3119 
	`mysql_ä“_»suÉ
(
»suÉ
);

3121 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

3122 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

3123 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("SELECT @@autocommit"));

3124 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3126 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

3127 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3129 
»suÉ
ð
	`mysql_¡mt_»suÉ_m‘ad©a
(
¡mt
);

3130 
	`FAIL_IF
(!
»suÉ
, "Invalid„esult set");

3132 
rc
= 0;

3133 
	`mysql_¡mt_ãtch
(
¡mt
è!ð
MYSQL_NO_DATA
)

3134 
rc
++;

3135 
	`FAIL_UNLESS
(
rc
 == 1, "rowcount != 1");

3137 
	`v”ify_´•¬e_f›ld
(
»suÉ
, 0,

3139 
MYSQL_TYPE_LONGLONG
,

3143 
	`mysql_ä“_»suÉ
(
»suÉ
);

3144 
	`mysql_¡mt_þo£
(
¡mt
);

3146 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

3147 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

3148 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("SELECT @@max_error_count"));

3149 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3151 
»suÉ
ð
	`mysql_¡mt_»suÉ_m‘ad©a
(
¡mt
);

3152 
	`FAIL_IF
(!
»suÉ
, "Invalid„esult set");

3154 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

3155 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3157 
rc
= 0;

3158 
	`mysql_¡mt_ãtch
(
¡mt
è!ð
MYSQL_NO_DATA
)

3159 
rc
++;

3160 
	`FAIL_UNLESS
(
rc
 == 1, "rowcount != 1");

3162 ià(
	`v”ify_´•¬e_f›ld
(
»suÉ
, 0,

3164 
MYSQL_TYPE_LONGLONG
,

3167 "", 
MY_INT64_NUM_DECIMAL_DIGITS
 , 0))

3168 
”rÜ
;

3170 
	`mysql_ä“_»suÉ
(
»suÉ
);

3171 
	`mysql_¡mt_þo£
(
¡mt
);

3173 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

3174 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

3175 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("SELECT @@max_allowed_packet"));

3176 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3178 
»suÉ
ð
	`mysql_¡mt_»suÉ_m‘ad©a
(
¡mt
);

3179 
	`FAIL_IF
(!
»suÉ
, "Invalid„esult set");

3181 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

3182 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3184 
rc
= 0;

3185 
	`mysql_¡mt_ãtch
(
¡mt
è!ð
MYSQL_NO_DATA
)

3186 
rc
++;

3187 
	`FAIL_UNLESS
(
rc
 == 1, "rowcount != 1");

3189 ià(
	`v”ify_´•¬e_f›ld
(
»suÉ
, 0,

3191 
MYSQL_TYPE_LONGLONG
,

3194 "", 
MY_INT64_NUM_DECIMAL_DIGITS
, 0))

3195 
”rÜ
;

3197 
	`mysql_ä“_»suÉ
(
»suÉ
);

3198 
	`mysql_¡mt_þo£
(
¡mt
);

3200 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

3201 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

3202 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("SELECT @@sql_warnings"));

3203 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3205 
»suÉ
ð
	`mysql_¡mt_»suÉ_m‘ad©a
(
¡mt
);

3206 
	`FAIL_IF
(!
»suÉ
, "Invalid„esult set");

3208 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

3209 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3211 
rc
= 0;

3212 
	`mysql_¡mt_ãtch
(
¡mt
è!ð
MYSQL_NO_DATA
)

3213 
rc
++;

3214 
	`FAIL_UNLESS
(
rc
 == 1, "rowcount != 1");

3216 ià(
	`v”ify_´•¬e_f›ld
(
»suÉ
, 0,

3218 
MYSQL_TYPE_LONGLONG
,

3221 
”rÜ
;

3223 
	`mysql_ä“_»suÉ
(
»suÉ
);

3224 
	`mysql_¡mt_þo£
(
¡mt
);

3225  
OK
;

3227 
”rÜ
:

3228 
	`mysql_ä“_»suÉ
(
»suÉ
);

3229 
	`mysql_¡mt_þo£
(
¡mt
);

3230  
FAIL
;

3231 
	}
}

3235 
	$‹¡_mem_ov”un
(
MYSQL
 *
mysql
)

3237 
bufãr
[10000], 
f›ld
[12];

3238 
MYSQL_STMT
 *
¡mt
;

3239 
MYSQL_RES
 *
f›ld_»s
, *
»s
;

3240 
rc
, 
i
, 
Ëngth
;

3246 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxists_mem_overun");

3247 
	`check_mysql_rc
(
rc
, 
mysql
);

3249 
	`¡rýy
(
bufãr
, "createable_mem_overun(");

3250 
i
= 0; i < 1000; i++)

3252 
	`¥rštf
(
f›ld
, "c%d iÁ, ", 
i
);

3253 
	`¡rÿt
(
bufãr
, 
f›ld
);

3255 
Ëngth
ð()
	`¡¾’
(
bufãr
);

3256 
bufãr
[
Ëngth
-2]= ')';

3257 
bufãr
[--
Ëngth
]= '\0';

3259 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
bufãr
, 
Ëngth
);

3260 
	`check_mysql_rc
(
rc
, 
mysql
);

3262 
	`¡rýy
(
bufãr
, "insert into_mem_overun values(");

3263 
i
= 0; i < 1000; i++)

3265 
	`¡rÿt
(
bufãr
, "1, ");

3267 
Ëngth
ð()
	`¡¾’
(
bufãr
);

3268 
bufãr
[
Ëngth
-2]= ')';

3269 
bufãr
[--
Ëngth
]= '\0';

3271 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
bufãr
, 
Ëngth
);

3272 
	`check_mysql_rc
(
rc
, 
mysql
);

3274 
rc
ð
	`mysql_qu”y
(
mysql
, "select * from_mem_overun");

3275 
	`check_mysql_rc
(
rc
, 
mysql
);

3277 
»s
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

3278 
rc
= 0;

3279 
	`mysql_ãtch_row
(
»s
))

3280 
rc
++;

3281 
	`FAIL_UNLESS
(
rc
 == 1, "rowcount != 1");

3282 
	`mysql_ä“_»suÉ
(
»s
);

3284 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

3285 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

3286 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("select * from_mem_overun"));

3287 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3289 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

3290 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3292 
f›ld_»s
ð
	`mysql_¡mt_»suÉ_m‘ad©a
(
¡mt
);

3293 
	`FAIL_IF
(!
f›ld_»s
, "Invalid„esult set");

3295 
	`FAIL_UNLESS
Ð1000 =ð
	`mysql_num_f›lds
(
f›ld_»s
), "fields != 1000");

3297 
rc
ð
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

3298 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3300 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

3301 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3303 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

3304 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "");

3306 
	`mysql_ä“_»suÉ
(
f›ld_»s
);

3308 
	`mysql_¡mt_þo£
(
¡mt
);

3309 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxists_mem_overun");

3310 
	`check_mysql_rc
(
rc
, 
mysql
);

3311  
OK
;

3312 
	}
}

3314 
	$‹¡_bug8722
(
MYSQL
 *
mysql
)

3316 
MYSQL_STMT
 *
¡mt
;

3317 
rc
;

3318 cÚ¡ *
¡mt_‹xt
;

3321 
¡mt_‹xt
= "dropable ifƒxists1";

3322 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

3323 
	`check_mysql_rc
(
rc
, 
mysql
);

3324 
¡mt_‹xt
= "drop view ifƒxists v1";

3325 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

3326 
	`check_mysql_rc
(
rc
, 
mysql
);

3327 
¡mt_‹xt
= "CREATE TABLE1 (c1 varchar(10), c2 varchar(10), c3 varchar(10),"

3331 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

3332 
	`check_mysql_rc
(
rc
, 
mysql
);

3333 
¡mt_‹xt
= "INSERT INTO1 VALUES (1,2,3,4,5,6,7,8,9,10)";

3334 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

3335 
	`check_mysql_rc
(
rc
, 
mysql
);

3336 
¡mt_‹xt
= "CREATE VIEW v1 AS SELECT * FROM1";

3337 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
¡mt_‹xt
));

3338 
	`check_mysql_rc
(
rc
, 
mysql
);

3340 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

3341 
¡mt_‹xt
= "select * from v1";

3342 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_‹xt
));

3343 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3344 
	`mysql_¡mt_þo£
(
¡mt
);

3345 
¡mt_‹xt
= "dropable ifƒxists1, v1";

3346 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE1");

3347 
	`check_mysql_rc
(
rc
, 
mysql
);

3348 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP VIEW v1");

3349 
	`check_mysql_rc
(
rc
, 
mysql
);

3350  
OK
;

3351 
	}
}

3355 
	$‹¡_decim®_bug
(
MYSQL
 *
mysql
)

3357 
MYSQL_STMT
 *
¡mt
;

3358 
MYSQL_BIND
 
my_bšd
[1];

3359 
d©a
[30];

3360 
rc
;

3361 
my_boÞ
 
is_nuÎ
;

3363 
	`mysql_autocomm™
(
mysql
, 
TRUE
);

3365 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxistsest_decimal_bug");

3366 
	`check_mysql_rc
(
rc
, 
mysql
);

3368 
rc
ð
	`mysql_qu”y
(
mysql
, "createableest_decimal_bug(c1 decimal(10, 2))");

3369 
	`check_mysql_rc
(
rc
, 
mysql
);

3371 
rc
ð
	`mysql_qu”y
(
mysql
, "insert intoest_decimal_bug value(8), (10.22), (5.61)");

3372 
	`check_mysql_rc
(
rc
, 
mysql
);

3374 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

3375 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

3376 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("select c1 fromest_decimal_bug where c1=?"));

3377 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3383 
	`mem£t
(
my_bšd
, '\0', (my_bind));

3385 
	`mem£t
(
d©a
, 0, (data));

3386 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_NEWDECIMAL
;

3387 
my_bšd
[0].
bufãr
ð(*)
d©a
;

3388 
my_bšd
[0].
bufãr_Ëngth
= 25;

3389 
my_bšd
[0].
is_nuÎ
= &is_null;

3391 
is_nuÎ
= 0;

3392 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

3393 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3395 
	`¡rýy
(
d©a
, "8.0");

3396 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

3397 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3399 
d©a
[0]= 0;

3400 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

3401 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3403 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

3404 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3406 
	`FAIL_UNLESS
(
	`¡rcmp
(
d©a
, "8.00") == 0, "data != '8.00'");

3408 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

3409 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

3411 
	`¡rýy
(
d©a
, "5.61");

3412 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

3413 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3415 
d©a
[0]= 0;

3416 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

3417 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3419 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

3420 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3422 
	`FAIL_UNLESS
(
	`¡rcmp
(
d©a
, "5.61") == 0, "data != '5.61'");

3424 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

3425 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

3427 
is_nuÎ
= 1;

3428 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

3429 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3431 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

3432 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

3434 
	`¡rýy
(
d©a
, "10.22"); 
is_nuÎ
= 0;

3435 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

3436 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3438 
d©a
[0]= 0;

3439 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

3440 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3442 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

3443 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3445 
	`FAIL_UNLESS
(
	`¡rcmp
(
d©a
, "10.22") == 0, "data != '10.22'");

3447 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

3448 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

3450 
	`mysql_¡mt_þo£
(
¡mt
);

3451 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxistsest_decimal_bug");

3452 
	`check_mysql_rc
(
rc
, 
mysql
);

3453  
OK
;

3454 
	}
}

3458 
	$‹¡_ex¶aš_bug
(
MYSQL
 *
mysql
)

3460 
MYSQL_STMT
 *
¡mt
;

3461 
MYSQL_RES
 *
»suÉ
;

3462 
rc
;

3464 ià(!
is_m¬Ÿdb
)

3465  
SKIP
;

3467 
	`mysql_autocomm™
(
mysql
, 
TRUE
);

3469 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_explain");

3470 
	`check_mysql_rc
(
rc
, 
mysql
);

3472 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_explain(id int,‚ame char(2))");

3473 
	`check_mysql_rc
(
rc
, 
mysql
);

3475 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

3476 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

3477 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("explainest_explain"));

3478 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3480 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

3481 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3483 
rc
= 0;

3484 !
	`mysql_¡mt_ãtch
(
¡mt
))

3485 
rc
++;

3486 
	`FAIL_UNLESS
(
rc
 == 2, "rowcount != 2");

3488 
»suÉ
ð
	`mysql_¡mt_»suÉ_m‘ad©a
(
¡mt
);

3489 
	`FAIL_IF
(!
»suÉ
, "Invalid„esult set");

3491 
	`FAIL_UNLESS
(6 =ð
	`mysql_num_f›lds
(
»suÉ
), "fields != 6");

3493 ià(
	`v”ify_´•¬e_f›ld
(
»suÉ
, 0, "Field", "COLUMN_NAME",

3494 
	`mysql_g‘_£rv”_v”siÚ
(
mysql
) <= 50000 ?

3495 
MYSQL_TYPE_STRING
 : 
MYSQL_TYPE_VAR_STRING
,

3497 
	`mysql_g‘_£rv”_v”siÚ
(
mysql
) <= 50400 ? "" : "information_schema",

3499 
”rÜ
;

3501 ià(
	`v”ify_´•¬e_f›ld
(
»suÉ
, 1, "Ty³", "COLUMN_TYPE", 
MYSQL_TYPE_BLOB
,

3503 
	`mysql_g‘_£rv”_v”siÚ
(
mysql
) <= 50400 ? "" : "information_schema",

3505 
”rÜ
;

3507 ià(
	`v”ify_´•¬e_f›ld
(
»suÉ
, 2, "Null", "IS_NULLABLE",

3508 
	`mysql_g‘_£rv”_v”siÚ
(
mysql
) <= 50000 ?

3509 
MYSQL_TYPE_STRING
 : 
MYSQL_TYPE_VAR_STRING
,

3511 
	`mysql_g‘_£rv”_v”siÚ
(
mysql
) <= 50400 ? "" : "information_schema",

3513 
”rÜ
;

3515 ià(
	`v”ify_´•¬e_f›ld
(
»suÉ
, 3, "Key", "COLUMN_KEY",

3516 
	`mysql_g‘_£rv”_v”siÚ
(
mysql
) <= 50000 ?

3517 
MYSQL_TYPE_STRING
 : 
MYSQL_TYPE_VAR_STRING
,

3519 
	`mysql_g‘_£rv”_v”siÚ
(
mysql
) <= 50400 ? "" : "information_schema",

3521 
”rÜ
;

3523 iàÐ
	`mysql_g‘_£rv”_v”siÚ
(
mysql
) >= 50027 )

3526 ià(
	`v”ify_´•¬e_f›ld
(
»suÉ
, 4, "Default", "COLUMN_DEFAULT",

3527 
MYSQL_TYPE_BLOB
, 0, 0,

3528 
	`mysql_g‘_£rv”_v”siÚ
(
mysql
) <= 50400 ? "" : "information_schema",

3530 
”rÜ
;

3534 ià(
	`v”ify_´•¬e_f›ld
(
»suÉ
, 4, "Default", "COLUMN_DEFAULT",

3535 
	`mysql_g‘_£rv”_v”siÚ
(
mysql
) >= 50027 ?

3536 
MYSQL_TYPE_BLOB
 :

3537 
	`mysql_g‘_£rv”_v”siÚ
(
mysql
) <= 50000 ?

3538 
MYSQL_TYPE_STRING
 : 
MYSQL_TYPE_VAR_STRING
,

3540 
	`mysql_g‘_£rv”_v”siÚ
(
mysql
) <= 50400 ? "" : "information_schema",

3541 
	`mysql_g‘_£rv”_v”siÚ
(
mysql
) >= 50027 ? 0 :64, 0))

3542 
”rÜ
;

3545 ià(
	`v”ify_´•¬e_f›ld
(
»suÉ
, 5, "Extra", "EXTRA",

3546 
	`mysql_g‘_£rv”_v”siÚ
(
mysql
) <= 50000 ?

3547 
MYSQL_TYPE_STRING
 : 
MYSQL_TYPE_VAR_STRING
,

3549 
	`mysql_g‘_£rv”_v”siÚ
(
mysql
) <= 50400 ? "" : "information_schema",

3551 
”rÜ
;

3553 
	`mysql_ä“_»suÉ
(
»suÉ
);

3554 
	`mysql_¡mt_þo£
(
¡mt
);

3556 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

3557 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

3558 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("explain select id,‚ame FROMest_explain"));

3559 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3561 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

3562 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3564 
rc
= 0;

3565 !
	`mysql_¡mt_ãtch
(
¡mt
))

3566 
rc
++;

3567 
	`FAIL_UNLESS
(
rc
 == 1, "rowcount != 1");

3569 
»suÉ
ð
	`mysql_¡mt_»suÉ_m‘ad©a
(
¡mt
);

3570 
	`FAIL_IF
(!
»suÉ
, "Invalid„esult set");

3572 
	`FAIL_UNLESS
(10 =ð
	`mysql_num_f›lds
(
»suÉ
), "fields != 10");

3574 ià(
	`v”ify_´•¬e_f›ld
(
»suÉ
, 0, "id", "", 
MYSQL_TYPE_LONGLONG
, "", "", "", 3, 0))

3575 
”rÜ
;

3577 ià(
	`v”ify_´•¬e_f›ld
(
»suÉ
, 1, "£Ëù_ty³", "", 
MYSQL_TYPE_VAR_STRING
, "", "", "", 19, 0))

3578 
”rÜ
;

3580 ià(
	`v”ify_´•¬e_f›ld
(
»suÉ
, 2, "bË", "", 
MYSQL_TYPE_VAR_STRING
, "", "", "", 
NAME_CHAR_LEN
, 0))

3581 
”rÜ
;

3583 ià(
	`v”ify_´•¬e_f›ld
(
»suÉ
, 3, "ty³", "", 
MYSQL_TYPE_VAR_STRING
, "", "", "", 10, 0))

3584 
”rÜ
;

3586 ià(
	`v”ify_´•¬e_f›ld
(
»suÉ
, 4, "possibË_keys", "", 
MYSQL_TYPE_VAR_STRING
, "", "", "", 
NAME_CHAR_LEN
*
MAX_KEY
, 0))

3587 
”rÜ
;

3589 iàÐ
	`v”ify_´•¬e_f›ld
(
»suÉ
, 5, "key", "", 
MYSQL_TYPE_VAR_STRING
, "", "", "", 
NAME_CHAR_LEN
, 0))

3590 
”rÜ
;

3592 ià(
	`mysql_g‘_£rv”_v”siÚ
(
mysql
) <= 50000)

3594 ià(
	`v”ify_´•¬e_f›ld
(
»suÉ
, 6, "key_Ën", "", 
MYSQL_TYPE_LONGLONG
, "", "", "", 3, 0))

3595 
”rÜ
;

3597 ià(
	`mysql_g‘_£rv”_v”siÚ
(
mysql
) <= 60000)

3599 ià(
	`v”ify_´•¬e_f›ld
(
»suÉ
, 6, "key_Ën", "", 
MYSQL_TYPE_VAR_STRING
, "", "", "", 
NAME_CHAR_LEN
*
MAX_KEY
, 0))

3600 
”rÜ
;

3604 ià(
	`v”ify_´•¬e_f›ld
(
»suÉ
, 6, "key_Ën", "", 
MYSQL_TYPE_VAR_STRING
, "", "", "", (
MAX_KEY_LENGTH_DECIMAL_WIDTH
 + 1è* 
MAX_KEY
, 0))

3605 
”rÜ
;

3608 ià(
	`v”ify_´•¬e_f›ld
(
»suÉ
, 7, "»f", "", 
MYSQL_TYPE_VAR_STRING
, "", "", "",

3609 
NAME_CHAR_LEN
*16, 0))

3610 
”rÜ
;

3612 ià(
	`v”ify_´•¬e_f›ld
(
»suÉ
, 8, "rows", "", 
MYSQL_TYPE_LONGLONG
, "", "", "", 10, 0))

3613 
”rÜ
;

3615 ià(
	`v”ify_´•¬e_f›ld
(
»suÉ
, 9, "ExŒa", "", 
MYSQL_TYPE_VAR_STRING
, "", "", "", 255, 0))

3616 
”rÜ
;

3618 
	`mysql_ä“_»suÉ
(
»suÉ
);

3619 
	`mysql_¡mt_þo£
(
¡mt
);

3620 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_explain");

3621 
	`check_mysql_rc
(
rc
, 
mysql
);

3622  
OK
;

3623 
”rÜ
:

3624 
	`mysql_ä“_»suÉ
(
»suÉ
);

3625 
	`mysql_¡mt_þo£
(
¡mt
);

3626  
FAIL
;

3627 
	}
}

3629 
	$‹¡_sshÜt_bug
(
MYSQL
 *
mysql
)

3631 
MYSQL_STMT
 *
¡mt
;

3632 
MYSQL_BIND
 
my_bšd
[4];

3633 
shÜt_v®ue
;

3634 
št32
 
lÚg_v®ue
;

3635 
ulÚg
 
s_Ëngth
, 
l_Ëngth
, 
Î_Ëngth
, 
t_Ëngth
;

3636 
ulÚglÚg
 
lÚglÚg_v®ue
;

3637 
rc
;

3638 
uch¬
 
tšy_v®ue
;

3640 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_sshort");

3641 
	`check_mysql_rc
(
rc
, 
mysql
);

3643 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_sshort(a smallint signed, \
 smallint signed, \
 smallint unsigned, \
 smallint unsigned)");

3647 
	`check_mysql_rc
(
rc
, 
mysql
);

3649 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTOest_sshort VALUES(-5999, -5999, 35999, 200)");

3650 
	`check_mysql_rc
(
rc
, 
mysql
);

3653 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

3654 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

3655 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("SELECT * FROMest_sshort"));

3656 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3658 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

3659 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3661 
	`mem£t
(
my_bšd
, '\0', (my_bind));

3662 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_SHORT
;

3663 
my_bšd
[0].
bufãr
ð(*)&
shÜt_v®ue
;

3664 
my_bšd
[0].
Ëngth
ð&
s_Ëngth
;

3666 
my_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

3667 
my_bšd
[1].
bufãr
ð(*)&
lÚg_v®ue
;

3668 
my_bšd
[1].
Ëngth
ð&
l_Ëngth
;

3670 
my_bšd
[2].
bufãr_ty³
ð
MYSQL_TYPE_LONGLONG
;

3671 
my_bšd
[2].
bufãr
ð(*)&
lÚglÚg_v®ue
;

3672 
my_bšd
[2].
Ëngth
ð&
Î_Ëngth
;

3674 
my_bšd
[3].
bufãr_ty³
ð
MYSQL_TYPE_TINY
;

3675 
my_bšd
[3].
bufãr
ð(*)&
tšy_v®ue
;

3676 
my_bšd
[3].
is_unsigÃd
ð
TRUE
;

3677 
my_bšd
[3].
Ëngth
ð&
t_Ëngth
;

3679 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

3680 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3682 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

3683 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3685 
	`FAIL_UNLESS
(
shÜt_v®ue
 == -5999, "sv != -5999");

3686 
	`FAIL_UNLESS
(
s_Ëngth
 == 2, "s_length != 2");

3688 
	`FAIL_UNLESS
(
lÚg_v®ue
 == -5999, "l_v != -5999");

3689 
	`FAIL_UNLESS
(
l_Ëngth
 == 4, "l_length != 4");

3691 
	`FAIL_UNLESS
(
lÚglÚg_v®ue
 == 35999, "llv != 35999");

3692 
	`FAIL_UNLESS
(
Î_Ëngth
 == 8, "ll_length != 8");

3694 
	`FAIL_UNLESS
(
tšy_v®ue
 == 200, "t_v != 200");

3695 
	`FAIL_UNLESS
(
t_Ëngth
 == 1, "t_length != 1");

3697 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

3698 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

3700 
	`mysql_¡mt_þo£
(
¡mt
);

3701 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_sshort");

3702 
	`check_mysql_rc
(
rc
, 
mysql
);

3703  
OK
;

3704 
	}
}

3709 
	$‹¡_¡šy_bug
(
MYSQL
 *
mysql
)

3711 
MYSQL_STMT
 *
¡mt
;

3712 
MYSQL_BIND
 
my_bšd
[4];

3713 
shÜt_v®ue
;

3714 
št32
 
lÚg_v®ue
;

3715 
ulÚg
 
s_Ëngth
, 
l_Ëngth
, 
Î_Ëngth
, 
t_Ëngth
;

3716 
ulÚglÚg
 
lÚglÚg_v®ue
;

3717 
rc
;

3718 
uch¬
 
tšy_v®ue
;

3720 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_stiny");

3721 
	`check_mysql_rc
(
rc
, 
mysql
);

3723 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_stiny(ainyint signed, \
inyint signed, \
inyint unsigned, \
inyint unsigned)");

3727 
	`check_mysql_rc
(
rc
, 
mysql
);

3729 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTOest_stiny VALUES(-128, -127, 255, 0)");

3730 
	`check_mysql_rc
(
rc
, 
mysql
);

3733 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

3734 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

3735 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("SELECT * FROMest_stiny"));

3736 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3738 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

3739 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3741 
	`mem£t
(
my_bšd
, '\0', (my_bind));

3742 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_SHORT
;

3743 
my_bšd
[0].
bufãr
ð(*)&
shÜt_v®ue
;

3744 
my_bšd
[0].
Ëngth
ð&
s_Ëngth
;

3746 
my_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

3747 
my_bšd
[1].
bufãr
ð(*)&
lÚg_v®ue
;

3748 
my_bšd
[1].
Ëngth
ð&
l_Ëngth
;

3750 
my_bšd
[2].
bufãr_ty³
ð
MYSQL_TYPE_LONGLONG
;

3751 
my_bšd
[2].
bufãr
ð(*)&
lÚglÚg_v®ue
;

3752 
my_bšd
[2].
Ëngth
ð&
Î_Ëngth
;

3754 
my_bšd
[3].
bufãr_ty³
ð
MYSQL_TYPE_TINY
;

3755 
my_bšd
[3].
bufãr
ð(*)&
tšy_v®ue
;

3756 
my_bšd
[3].
Ëngth
ð&
t_Ëngth
;

3758 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

3759 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3761 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

3762 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3764 
	`FAIL_UNLESS
(
shÜt_v®ue
 == -128, "s_v != -128");

3765 
	`FAIL_UNLESS
(
s_Ëngth
 == 2, "s_length != 2");

3767 
	`FAIL_UNLESS
(
lÚg_v®ue
 == -127, "l_v != -127");

3768 
	`FAIL_UNLESS
(
l_Ëngth
 == 4, "l_length != 4");

3770 
	`FAIL_UNLESS
(
lÚglÚg_v®ue
 == 255, "llv != 255");

3771 
	`FAIL_UNLESS
(
Î_Ëngth
 == 8, "ll_length != 8");

3773 
	`FAIL_UNLESS
(
tšy_v®ue
 == 0, "t_v != 0");

3774 
	`FAIL_UNLESS
(
t_Ëngth
 == 1, "t_length != 1");

3776 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

3777 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

3779 
	`mysql_¡mt_þo£
(
¡mt
);

3780 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_stiny");

3781 
	`check_mysql_rc
(
rc
, 
mysql
);

3782  
OK
;

3783 
	}
}

3785 
	$‹¡_bug53311
(
MYSQL
 *
mysql
)

3787 
rc
;

3788 
MYSQL_STMT
 *
¡mt
;

3789 
i
;

3790 cÚ¡ *
qu”y
= "INSERT INTO bug53311 VALUES (1)";

3791 
SKIP_MAXSCALE
;

3793 
rc
ð
	`mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_RECONNECT
, "1");

3794 
	`check_mysql_rc
(
rc
, 
mysql
);

3796 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS bug53311");

3797 
	`check_mysql_rc
(
rc
, 
mysql
);

3799 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE bug53311 (a int)");

3800 
	`check_mysql_rc
(
rc
, 
mysql
);

3802 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

3803 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

3804 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3806 
i
=0; i < 2; i++)

3808 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

3809 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3813 
rc
ð
	`mysql_kžl
(
mysql
, 
	`mysql_th»ad_id
(mysql));

3815 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

3816 
	`FAIL_IF
(
rc
 == 0, "Errorƒxpected");

3817 
	`FAIL_IF
(
	`mysql_¡mt_”ºo
(
¡mt
) == 0, "Errno != 0ƒxpected");

3818 
rc
ð
	`mysql_¡mt_þo£
(
¡mt
);

3819 
	`check_mysql_rc
(
rc
, 
mysql
);

3820 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS bug53311");

3821 
	`check_mysql_rc
(
rc
, 
mysql
);

3823  
OK
;

3824 
	}
}

3825 
	#PREPARE_SQL
 "EXPLAIN SELECT1.*,2.* FROMe¡ AS1,e¡ AS2"

	)

3827 #ifdeà
NOT_IN_USE


3828 
	$‹¡_m‘ad©a
(
MYSQL
 *
mysql
)

3830 
rc
;

3832 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest");

3833 
	`check_mysql_rc
(
rc
, 
mysql
);

3834 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest(id INT,†abel CHAR(1), PRIMARY KEY(id)) ENGINE=MYISAM");

3835 
	`check_mysql_rc
(
rc
, 
mysql
);

3837 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTOest(id,†abel) VALUES (1, 'a'), (2, 'b'), (3, 'c'), (4, 'd'), (5, 'e'), (6, 'f')");

3838 
	`check_mysql_rc
(
rc
, 
mysql
);

3839 
	`´štf
("Cl›Á=%s\n", 
	`mysql_g‘_þ›Á_šfo
());

3840 
	`´štf
("S”v”=%s\n", 
	`mysql_g‘_£rv”_šfo
(
mysql
));

3843 
MYSQL_STMT
 * 
¡mt
 = 
	`mysql_¡mt_š™
(
mysql
);

3844 ià(!
¡mt
) {

3845 
	`årštf
(
¡d”r
, "FažedØš™ stmt: E¼Ü: %s\n", 
	`mysql_”rÜ
(
mysql
));

3846 
’d
;

3848 ià(
	`mysql_¡mt_´•¬e
(
¡mt
, 
PREPARE_SQL
, (PREPARE_SQL) - 1)) {

3849 
	`årštf
(
¡d”r
, "FažedØ´•¬¡mt: E¼Ü: %s\n", 
	`mysql_¡mt_”rÜ
(
¡mt
));

3850 
’d2
;

3852 ià(
	`mysql_¡mt_execu‹
(
¡mt
)) {

3853 
	`årštf
(
¡d”r
, "FažedØexecu‹ stmt: E¼Ü: %s\n", 
	`mysql_¡mt_”rÜ
(
¡mt
));

3854 
’d2
;

3857 
MYSQL_FIELD
 * 
f›ld
 = 
NULL
;

3858 
MYSQL_RES
 * 
»s
 = 
	`mysql_¡mt_»suÉ_m‘ad©a
(
¡mt
);

3859 ià(!
»s
) {

3860 
	`årštf
(
¡d”r
, "FažedØg‘ m‘ad©a: E¼Ü: %s\n", 
	`mysql_¡mt_”rÜ
(
¡mt
));

3861 
’d2
;

3863 (
f›ld
 = 
	`mysql_ãtch_f›ld
(
»s
))) {

3864 
	`´štf
("Çme=%s\n", 
f›ld
->
Çme
);

3865 
	`´štf
("ÿlog=%s\n", 
f›ld
->
ÿlog
);

3867 
	`mysql_ä“_»suÉ
(
»s
);

3870 
’d2
:

3871 
	`mysql_¡mt_þo£
(
¡mt
);

3873 
’d
:

3875 
	}
}

3878 
	$‹¡_cÚc_5
(
MYSQL
 *
mysql
)

3880 cÚ¡ *
qu”y
= "SELECT‡ FROM1";

3881 
MYSQL_RES
 *
»s
;

3882 
MYSQL_STMT
 *
¡mt
;

3883 
MYSQL_FIELD
 *
f›lds
;

3884 
rc
;

3886 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

3887 
	`check_mysql_rc
(
rc
, 
mysql
);

3888 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE1 (a int)");

3889 
	`check_mysql_rc
(
rc
, 
mysql
);

3890 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTO1 VALUES (1)");

3891 
	`check_mysql_rc
(
rc
, 
mysql
);

3893 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

3894 
	`FAIL_IF
(!
¡mt
, "couldn't‡llocate memory");

3896 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

3897 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3898 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

3899 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3901 
»s
ð
	`mysql_¡mt_»suÉ_m‘ad©a
(
¡mt
);

3902 
	`FAIL_IF
(!
»s
, "Can't obtain„esultset");

3904 
f›lds
ð
	`mysql_ãtch_f›lds
(
»s
);

3905 
	`FAIL_IF
(!
f›lds
, "Can't obtain fields");

3907 
	`FAIL_IF
(
	`¡rcmp
("def", 
f›lds
[0].
ÿlog
), "unexpected value for field->catalog");

3909 
	`mysql_ä“_»suÉ
(
»s
);

3910 
	`mysql_¡mt_þo£
(
¡mt
);

3911  
OK
;

3912 
	}
}

3914 
	$‹¡_cÚc141
(
MYSQL
 *
mysql
)

3916 
rc
;

3917 cÚ¡ *
qu”y
= "CALL…_conc141";

3918 
MYSQL_STMT
 *
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

3920 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS conc141");

3921 
	`check_mysql_rc
(
rc
, 
mysql
);

3922 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE conc141 (KeyVal int‚ot‚ull…rimary key)");

3923 
	`check_mysql_rc
(
rc
, 
mysql
);

3924 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTO conc141 VALUES(1)");

3925 
	`check_mysql_rc
(
rc
, 
mysql
);

3926 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP PROCEDURE IF EXISTS…_conc141");

3927 
	`check_mysql_rc
(
rc
, 
mysql
);

3928 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE PROCEDURE…_conc141()\n"

3933 
	`check_mysql_rc
(
rc
, 
mysql
);

3935 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

3936 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3938 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

3939 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3941 
rc
ð
	`mysql_¡mt_Ãxt_»suÉ
(
¡mt
);

3942 
	`FAIL_IF
(
rc
==-1, "No more„esults‡ndƒrrorƒxpected");

3943 
	`mysql_¡mt_ä“_»suÉ
(
¡mt
);

3944 
	`FAIL_IF
(
	`mysql_¡mt_”ºo
(
¡mt
), "No Errorƒxpected");

3945 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

3946 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3947 
	`mysql_¡mt_þo£
(
¡mt
);

3948 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS conc141");

3949 
	`check_mysql_rc
(
rc
, 
mysql
);

3950 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP PROCEDURE IF EXISTS…_conc141");

3951 
	`check_mysql_rc
(
rc
, 
mysql
);

3952  
OK
;

3953 
	}
}

3955 
	$‹¡_cÚc154
(
MYSQL
 *
mysql
)

3957 
MYSQL_STMT
 *
¡mt
;

3958 cÚ¡ *
¡mt¡r
= "SELECT * FROM1";

3959 
rc
;

3962 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

3963 
	`check_mysql_rc
(
rc
, 
mysql
);

3964 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE1 (a varchar(20))");

3965 
	`check_mysql_rc
(
rc
, 
mysql
);

3967 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

3968 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt¡r
));

3969 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3971 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

3972 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3974 
rc
ð
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

3975 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3977 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

3978 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3980 
rc
ð
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

3981 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3983 
	`mysql_¡mt_þo£
(
¡mt
);

3986 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

3987 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt¡r
));

3988 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3990 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

3991 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3993 
rc
ð
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

3994 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3996 
rc
ð
	`mysql_¡mt_ä“_»suÉ
(
¡mt
);

3997 
	`check_¡mt_rc
(
rc
, 
¡mt
);

3999 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

4000 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4002 
rc
ð
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

4003 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4004 
rc
ð
	`mysql_¡mt_ä“_»suÉ
(
¡mt
);

4005 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4007 
	`mysql_¡mt_þo£
(
¡mt
);

4010 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTO1 VALUES ('test_conc154')");

4011 
	`check_mysql_rc
(
rc
, 
mysql
);

4013 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

4014 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt¡r
));

4015 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4017 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

4018 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4020 
rc
ð
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

4021 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4023 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

4024 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4026 
rc
ð
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

4027 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4029 
	`mysql_¡mt_þo£
(
¡mt
);

4032 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

4033 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt¡r
));

4034 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4036 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

4037 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4039 
rc
ð
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

4040 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4042 
rc
ð
	`mysql_¡mt_ä“_»suÉ
(
¡mt
);

4043 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4045 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

4046 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4048 
rc
ð
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

4049 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4050 
rc
ð
	`mysql_¡mt_ä“_»suÉ
(
¡mt
);

4051 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4053 
	`mysql_¡mt_þo£
(
¡mt
);

4054 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

4055 
	`check_mysql_rc
(
rc
, 
mysql
);

4057  
OK
;

4058 
	}
}

4060 
	$‹¡_cÚc155
(
MYSQL
 *
mysql
)

4062 
MYSQL_STMT
 *
¡mt
;

4063 
MYSQL_BIND
 
bšd
;

4064 
bufãr
[50];

4065 
rc
;

4067 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

4068 
	`check_mysql_rc
(
rc
, 
mysql
);

4069 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE1 (a TEXT)");

4070 
	`check_mysql_rc
(
rc
, 
mysql
);

4071 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTO1 VALUES ('zeroerminated string')");

4072 
	`check_mysql_rc
(
rc
, 
mysql
);

4074 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

4075 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("SELECT‡ FROM1"));

4076 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4078 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

4079 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4081 
	`mem£t
(
bufãr
, 'X', 50);

4082 
	`mem£t
(&
bšd
, 0, (
MYSQL_BIND
));

4084 
bšd
.
bufãr
= buffer;

4085 
bšd
.
bufãr_Ëngth
= 50;

4086 
bšd
.
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

4088 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, &
bšd
);

4089 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4091 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

4092 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4094 ià(
	`¡¾’
(
bufãr
) != strlen("zeroerminated string"))

4096 
	`dŸg
("Wrong buffer†ength");

4097  
FAIL
;

4100 
	`mysql_¡mt_þo£
(
¡mt
);

4101 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

4102 
	`check_mysql_rc
(
rc
, 
mysql
);

4103  
OK
;

4104 
	}
}

4106 
	$‹¡_cÚc168
(
MYSQL
 *
mysql
)

4108 
MYSQL_STMT
 *
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

4110 
MYSQL_BIND
 
bšd
;

4111 
bufãr
[100];

4112 
rc
;

4114 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS conc168");

4115 
	`check_mysql_rc
(
rc
, 
mysql
);

4116 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE conc168(a datetime(3))");

4117 
	`check_mysql_rc
(
rc
, 
mysql
);

4118 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTO conc168 VALUES ('2016-03-09 07:51:49.000'),('2016-03-09 07:51:49.001'),('2016-03-09 07:51:49.010')");

4119 
	`check_mysql_rc
(
rc
, 
mysql
);

4121 
	`mem£t
(&
bšd
, 0, (
MYSQL_BIND
));

4122 
bšd
.
bufãr
= buffer;

4123 
bšd
.
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

4124 
bšd
.
bufãr_Ëngth
= 100;

4126 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("SELECT‡ FROM conc168"));

4127 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4129 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

4130 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4132 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, &
bšd
);

4133 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4135 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

4136 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4137 
	`FAIL_IF
(
	`¡rcmp
(
bufãr
, "2016-03-09 07:51:49.000"), "expected: 2016-03-09 07:51:49.000");

4139 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

4140 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4141 
	`FAIL_IF
(
	`¡rcmp
(
bufãr
, "2016-03-09 07:51:49.001"), "expected: 2016-03-09 07:51:49.001");

4143 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

4144 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4145 
	`FAIL_IF
(
	`¡rcmp
(
bufãr
, "2016-03-09 07:51:49.010"), "expected: 2016-03-09 07:51:49.010");

4147 
	`mysql_¡mt_þo£
(
¡mt
);

4148 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS conc168");

4149 
	`check_mysql_rc
(
rc
, 
mysql
);

4150  
OK
;

4151 
	}
}

4153 
	$‹¡_cÚc167
(
MYSQL
 *
mysql
)

4155 
MYSQL_STMT
 *
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

4157 
MYSQL_BIND
 
bšd
[3];

4158 
bufãr
[100];

4159 
b™1
=0, 
b™2
=0;

4160 
rc
;

4161 cÚ¡ *
¡mt_¡r
= "SELECT‡,b,c FROM conc168";

4163 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS conc168");

4164 
	`check_mysql_rc
(
rc
, 
mysql
);

4165 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE conc168(a bit, b bit, c varchar(10))");

4166 
	`check_mysql_rc
(
rc
, 
mysql
);

4167 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTO conc168 VALUES (1,0, 'test12345')");

4168 
	`check_mysql_rc
(
rc
, 
mysql
);

4170 
	`mem£t
(
bšd
, 0, 3 * (
MYSQL_BIND
));

4171 
bšd
[0].
bufãr
ð&
b™1
;

4172 
bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_BIT
;

4173 
bšd
[0].
bufãr_Ëngth
= ();

4174 
bšd
[1].
bufãr
ð&
b™2
;

4175 
bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_BIT
;

4176 
bšd
[1].
bufãr_Ëngth
= ();

4177 
bšd
[2].
bufãr
= buffer;

4178 
bšd
[2].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

4179 
bšd
[2].
bufãr_Ëngth
= 100;

4181 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_¡r
));

4182 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4184 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

4185 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4187 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
bšd
);

4188 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4190 
rc
ð
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

4191 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4193 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

4194 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4196 
	`dŸg
("b™=%d %d ch¬=%s", 
b™1
, 
b™2
, 
bufãr
);

4198 
	`mysql_¡mt_þo£
(
¡mt
);

4199  
OK
;

4200 
	}
}

4202 
	$‹¡_cÚc177
(
MYSQL
 *
mysql
)

4204 
MYSQL_STMT
 *
¡mt
;

4205 
rc
;

4206 
MYSQL_BIND
 
bšd
[2];

4207 cÚ¡ *
¡mt_¡r
= "SELECT‡,b FROM1";

4208 
buf1
[128], 
buf2
[128];

4210 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

4211 
	`check_mysql_rc
(
rc
, 
mysql
);

4213 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE1 (a double zerofill default 8.8,b float zerofill default 8.8)");

4214 
	`check_mysql_rc
(
rc
, 
mysql
);

4215 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTO1 VALUES (DEFAULT, DEFAULT)");

4216 
	`check_mysql_rc
(
rc
, 
mysql
);

4218 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

4219 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_¡r
));

4220 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4221 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

4222 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4224 
	`mem£t
(
bšd
, 0, 2 * (
MYSQL_BIND
));

4225 
bšd
[0].
bufãr
ð&
buf1
;

4226 
bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

4227 
bšd
[0].
bufãr_Ëngth
= 128;

4228 
bšd
[1].
bufãr
ð&
buf2
;

4229 
bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

4230 
bšd
[1].
bufãr_Ëngth
= 128;

4232 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
bšd
);

4233 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4235 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

4236 
	`mysql_¡mt_þo£
(
¡mt
);

4238 
	`dŸg
("buf1 %s\nbuf2 %s", 
buf1
, 
buf2
);

4240 
	`FAIL_IF
(
	`¡rcmp
(
buf1
, "00000000000000000008.8"), "Expected 00000000000000000008.8");

4241 
	`FAIL_IF
(
	`¡rcmp
(
buf2
, "0000000008.8"), "Expected 0000000008.8");

4243 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

4244 
	`check_mysql_rc
(
rc
, 
mysql
);

4246 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE1 (a int(8) zerofill default 1, b int(4) zerofill default 1)");

4247 
	`check_mysql_rc
(
rc
, 
mysql
);

4248 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTO1 VALUES (DEFAULT, DEFAULT)");

4249 
	`check_mysql_rc
(
rc
, 
mysql
);

4251 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

4252 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_¡r
));

4253 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4254 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

4255 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4257 
	`mem£t
(
bšd
, 0, 2 * (
MYSQL_BIND
));

4258 
bšd
[0].
bufãr
ð&
buf1
;

4259 
bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

4260 
bšd
[0].
bufãr_Ëngth
= 128;

4261 
bšd
[1].
bufãr
ð&
buf2
;

4262 
bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

4263 
bšd
[1].
bufãr_Ëngth
= 128;

4265 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
bšd
);

4266 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4268 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

4269 
	`mysql_¡mt_þo£
(
¡mt
);

4271 
	`dŸg
("buf1 %s\nbuf2 %s", 
buf1
, 
buf2
);

4273 
	`FAIL_IF
(
	`¡rcmp
(
buf1
, "00000001"), "Expected 00000001");

4274 
	`FAIL_IF
(
	`¡rcmp
(
buf2
, "0001"), "Expected 0001");

4275 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

4276 
	`check_mysql_rc
(
rc
, 
mysql
);

4277  
OK
;

4278 
	}
}

4280 
	$‹¡_cÚc179
(
MYSQL
 *
mysql
)

4282 
MYSQL_STMT
 *
¡mt
;

4283 
rc
;

4284 cÚ¡ *
¡mt¡r
= "select 1‡s ' '";

4286 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

4287 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt¡r
));

4288 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4290 ià(
	`mysql_g‘_£rv”_v”siÚ
(
mysql
) >= 100100)

4292 
	`FAIL_IF
(
	`mysql_w¬nšg_couÁ
(
mysql
) < 1, "expected 1 or more warnings");

4293 
	`FAIL_IF
(
	`mysql_¡mt_w¬nšg_couÁ
(
¡mt
) < 1, "expected 1 or more warnings");

4296 
	`mysql_¡mt_þo£
(
¡mt
);

4297 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

4298 
	`check_mysql_rc
(
rc
, 
mysql
);

4300  
OK
;

4301 
	}
}

4303 
	$‹¡_cÚc182
(
MYSQL
 *
mysql
)

4305 
MYSQL_STMT
 *
¡mt
;

4306 
rc
;

4307 
MYSQL_BIND
 
bšd
[2];

4308 
buf1
[22];

4309 
MYSQL_RES
 *
»suÉ
;

4310 
MYSQL_ROW
 
row
;

4312 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

4313 
rc
ð
	`m¬Ÿdb_¡mt_execu‹_dœeù
(
¡mt
, "DROP TABLE IF EXISTS1", -1);

4314 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4315 
rc
ð
	`m¬Ÿdb_¡mt_execu‹_dœeù
(
¡mt
, "DROP TABLE IF EXISTS1", -1);

4316 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4317 
rc
ð
	`m¬Ÿdb_¡mt_execu‹_dœeù
(
¡mt
, "SELECT 1", -1);

4318 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4319 
rc
ð
	`m¬Ÿdb_¡mt_execu‹_dœeù
(
¡mt
, "SELECT 1", -1);

4320 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4322 
rc
ð
	`mysql_¡mt_þo£
(
¡mt
);

4323 
	`check_mysql_rc
(
rc
, 
mysql
);

4325 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT„ow_count()");

4326 
»suÉ
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

4327 
row
ð
	`mysql_ãtch_row
(
»suÉ
);

4328 
	`dŸg
("buf: %s", 
row
[0]);

4329 
	`mysql_ä“_»suÉ
(
»suÉ
);

4332 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

4333 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, "SELECT„ow_count()", -1);

4334 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4335 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

4337 
	`mem£t
(
bšd
, 0, 2 * (
MYSQL_BIND
));

4338 
bšd
[0].
bufãr
ð&
buf1
;

4339 
bšd
[0].
bufãr_Ëngth
= bind[1].buffer_length= 20;

4340 
bšd
[0].
bufãr_ty³
ðbšd[1].bufãr_ty³ð
MYSQL_TYPE_STRING
;

4342 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
bšd
);

4344 !
	`mysql_¡mt_ãtch
(
¡mt
))

4345 
	`dŸg
("b1: %s", 
buf1
);

4346 
rc
ð
	`mysql_¡mt_þo£
(
¡mt
);

4347 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

4348 
	`check_mysql_rc
(
rc
, 
mysql
);

4349  
OK
;

4350 
	}
}

4352 
	$‹¡_cÚc181
(
MYSQL
 *
mysql
)

4354 
MYSQL_STMT
 *
¡mt
;

4355 
rc
;

4356 
MYSQL_BIND
 
bšd
;

4357 cÚ¡ *
¡mt_¡r
= "SELECT‡ FROM1";

4358 
f
=1;

4359 
my_boÞ
 
”r
= 0;

4361 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

4362 
	`check_mysql_rc
(
rc
, 
mysql
);

4363 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE1 (a int)");

4364 
	`check_mysql_rc
(
rc
, 
mysql
);

4365 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTO1 VALUES(1073741825)");

4366 
	`check_mysql_rc
(
rc
, 
mysql
);

4368 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

4369 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
¡mt_¡r
));

4370 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4372 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

4373 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4375 
	`mem£t
(&
bšd
, 0, (
MYSQL_BIND
));

4376 
bšd
.
bufãr
ð&
f
;

4377 
bšd
.
”rÜ
ð&
”r
;

4378 
bšd
.
bufãr_ty³
ð
MYSQL_TYPE_FLOAT
;

4379 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, &
bšd
);

4380 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4382 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

4383 
	`dŸg
("rc=%dƒ¼=%d flßt=%f, %d", 
rc
, 
”r
, 
f
, 
MYSQL_DATA_TRUNCATED
);

4385 
rc
ð
	`mysql_¡mt_þo£
(
¡mt
);

4386 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

4387 
	`check_mysql_rc
(
rc
, 
mysql
);

4388  
OK
;

4389 
	}
}

4391 
	$‹¡_cÚc198
(
MYSQL
 *
mysql
)

4393 
MYSQL_STMT
 *
¡mt1
, *
¡mt2
;

4394 
MYSQL_BIND
 
my_bšd
[1];

4395 
št32
 
a
;

4396 
rc
;

4397 
num_rows
= 0;

4398 
ulÚg
 
ty³
;

4399 
ulÚg
 
´eãtch_rows
= 3;

4402 
	`mysql_qu”y
(
mysql
, "dropable ifƒxists1");

4403 
	`mysql_qu”y
(
mysql
, "createable1 (id integer‚ot‚ull…rimary key)");

4404 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into1 (id) values "

4406 
	`check_mysql_rc
(
rc
, 
mysql
);

4408 
¡mt1
ð
	`mysql_¡mt_š™
(
mysql
);

4409 
¡mt2
ð
	`mysql_¡mt_š™
(
mysql
);

4411 
ty³
ð(
ulÚg
è
CURSOR_TYPE_SCROLLABLE
;

4412 
rc
ð
	`mysql_¡mt_©Œ_£t
(
¡mt1
, 
STMT_ATTR_CURSOR_TYPE
, (*è&
ty³
);

4413 
	`FAIL_UNLESS
(
rc
, "Errorƒxpected");

4414 
rc
ð
	`mysql_¡mt_©Œ_£t
(
¡mt2
, 
STMT_ATTR_CURSOR_TYPE
, (*è&
ty³
);

4415 
	`FAIL_UNLESS
(
rc
, "Errorƒxpected");

4417 
ty³
ð(
ulÚg
è
CURSOR_TYPE_READ_ONLY
;

4418 
rc
ð
	`mysql_¡mt_©Œ_£t
(
¡mt1
, 
STMT_ATTR_CURSOR_TYPE
, (*è&
ty³
);

4419 
	`check_¡mt_rc
(
rc
, 
¡mt1
);

4420 
rc
ð
	`mysql_¡mt_©Œ_£t
(
¡mt2
, 
STMT_ATTR_CURSOR_TYPE
, (*è&
ty³
);

4421 
	`check_¡mt_rc
(
rc
, 
¡mt2
);

4422 
rc
ð
	`mysql_¡mt_©Œ_£t
(
¡mt1
, 
STMT_ATTR_PREFETCH_ROWS
,

4423 (*è&
´eãtch_rows
);

4424 
	`check_¡mt_rc
(
rc
, 
¡mt1
);

4425 
rc
ð
	`mysql_¡mt_©Œ_£t
(
¡mt2
, 
STMT_ATTR_PREFETCH_ROWS
,

4426 (*è&
´eãtch_rows
);

4427 
	`check_¡mt_rc
(
rc
, 
¡mt2
);

4428 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt1
, "SELECT * FROM1 ORDER by id ASC" , -1);

4429 
	`check_¡mt_rc
(
rc
, 
¡mt1
);

4430 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt2
, "SELECT * FROM1 ORDER by id DESC", -1);

4431 
	`check_¡mt_rc
(
rc
, 
¡mt2
);

4433 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt1
);

4434 
	`check_¡mt_rc
(
rc
, 
¡mt1
);

4435 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt2
);

4436 
	`check_¡mt_rc
(
rc
, 
¡mt2
);

4438 
	`mem£t
(
my_bšd
, '\0', (my_bind));

4439 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

4440 
my_bšd
[0].
bufãr
ð(*è&
a
;

4441 
my_bšd
[0].
bufãr_Ëngth
ð(
a
);

4442 
	`mysql_¡mt_bšd_»suÉ
(
¡mt1
, 
my_bšd
);

4443 
	`mysql_¡mt_bšd_»suÉ
(
¡mt2
, 
my_bšd
);

4445 (
rc
ð
	`mysql_¡mt_ãtch
(
¡mt1
)) == 0)

4446 ++
num_rows
;

4447 
	`FAIL_UNLESS
(
num_rows
 == 9, "num_rows != 9");

4449 
num_rows
= 0;

4450 (
rc
ð
	`mysql_¡mt_ãtch
(
¡mt2
)) == 0)

4451 ++
num_rows
;

4452 
	`FAIL_UNLESS
(
num_rows
 == 9, "num_rows != 9");

4454 
rc
ð
	`mysql_¡mt_þo£
(
¡mt1
);

4455 
rc
ð
	`mysql_¡mt_þo£
(
¡mt2
);

4456 
	`FAIL_UNLESS
(
rc
 == 0, "");

4458 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable1");

4459 
	`check_mysql_rc
(
rc
, 
mysql
);

4460  
OK
;

4461 
	}
}

4463 
	$‹¡_cÚc205
(
MYSQL
 *
mysql
)

4465 
MYSQL_STMT
 *
¡mt
;

4466 
MYSQL_BIND
 
my_bšd
[3];

4467 
d©a
[8];

4468 
ulÚg
 
Ëngth
[3];

4469 
rc
, 
št_cÞ
;

4470 
smšt_cÞ
;

4471 
my_boÞ
 
is_nuÎ
[3];

4472 cÚ¡ *
qu”y
 = "SELECText_col, smint_col, int_col FROMest_conc205";

4474 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxistsest_conc205");

4475 
	`check_mysql_rc
(
rc
, 
mysql
);

4476 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_conc205 (text_col TEXT, smint_col SMALLINT, int_col INT)");

4477 
	`check_mysql_rc
(
rc
, 
mysql
);

4478 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTOest_conc205 VALUES('data01', 21893, 1718038908), ('data2', -25734, -1857802040)");

4479 
	`check_mysql_rc
(
rc
, 
mysql
);

4481 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

4482 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

4484 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

4485 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4487 
	`mem£t
(
my_bšd
, '\0', (my_bind));

4488 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

4489 
my_bšd
[0].
bufãr
ð(*)
d©a
;

4490 
my_bšd
[0].
bufãr_Ëngth
ð(
d©a
);

4491 
my_bšd
[0].
is_nuÎ
= &is_null[0];

4492 
my_bšd
[0].
Ëngth
= &length[0];

4494 
my_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_SHORT
;

4495 
my_bšd
[1].
bufãr
ð&
smšt_cÞ
;

4496 
my_bšd
[1].
bufãr_Ëngth
= 2;

4497 
my_bšd
[1].
is_nuÎ
= &is_null[1];

4498 
my_bšd
[1].
Ëngth
= &length[1];

4500 
my_bšd
[2].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

4501 
my_bšd
[2].
bufãr
ð&
št_cÞ
;

4502 
my_bšd
[2].
bufãr_Ëngth
= 4;

4503 
my_bšd
[2].
is_nuÎ
= &is_null[2];

4504 
my_bšd
[2].
Ëngth
= &length[2];

4506 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

4507 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4509 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

4510 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4512 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

4513 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4515 
	`FAIL_IF
(
Ëngth
[0] != 6, "Wrong fetched string†ength");

4516 
	`FAIL_IF
(
Ëngth
[1] != 2, "Wrong fetched short†ength");

4517 
	`FAIL_IF
(
Ëngth
[2] != 4, "Wrong fetched int†ength");

4519 
	`FAIL_IF
(
	`¡ºcmp
(
d©a
, "d©a01", 
Ëngth
[0] + 1) != 0, "Wrong string value");

4520 
	`FAIL_IF
(
smšt_cÞ
 != 21893, "Expected 21893");

4521 
	`FAIL_IF
(
št_cÞ
 != 1718038908, "Expected 1718038908");

4523 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

4524 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4526 
	`FAIL_IF
(
Ëngth
[0] != 5, "Wrong fetched string†ength");

4527 
	`FAIL_IF
(
Ëngth
[1] != 2, "Wrong fetched short†ength");

4528 
	`FAIL_IF
(
Ëngth
[2] != 4, "Wrong fetched int†ength");

4530 
	`FAIL_IF
(
	`¡ºcmp
(
d©a
, "d©a2", 
Ëngth
[0] + 1) != 0, "Wrong string value");

4531 
	`FAIL_IF
(
smšt_cÞ
 != -25734, "Expected 21893");

4532 
	`FAIL_IF
(
št_cÞ
 != -1857802040, "Expected 1718038908");

4534 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

4535 
	`FAIL_IF
(
rc
 !ð
MYSQL_NO_DATA
, "Expected MYSQL_NO_DATA");

4537 
	`mysql_¡mt_þo£
(
¡mt
);

4539 
rc
ð
	`mysql_qu”y
(
mysql
, "dropableest_conc205");

4540 
	`check_mysql_rc
(
rc
, 
mysql
);

4542  
OK
;

4543 
	}
}

4545 
	$‹¡_cÚc217
(
MYSQL
 *
mysql
)

4547 
MYSQL_STMT
 *
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

4548 
rc
;

4550 
rc
ð
	`m¬Ÿdb_¡mt_execu‹_dœeù
(
¡mt
, "SELECT 1 FROM‚onexisting_table", -1);

4551 
	`FAIL_IF
(
rc
==0, "Expectedƒrror\n");

4552 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxists_count");

4553 
	`check_mysql_rc
(
rc
, 
mysql
);

4554 
	`mysql_¡mt_þo£
(
¡mt
);

4555 
	`check_mysql_rc
(
rc
, 
mysql
);

4556  
OK
;

4557 
	}
}

4559 
	$‹¡_cÚc208
(
MYSQL
 *
mysql
)

4561 
MYSQL_STMT
 *
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

4562 
rc
;

4563 
d©a
;

4564 
MYSQL_BIND
 
bšd
;

4566 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, "SELECT \"100\" UNION SELECT \"88\" UNION SELECT \"389789\"", -1);

4567 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4569 
	`mem£t
(&
bšd
, 0, (
MYSQL_BIND
));

4570 
bšd
.
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

4571 
bšd
.
bufãr
ð(*)&
d©a
;

4573 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

4574 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4576 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, &
bšd
);

4578 
	`mysql_¡mt_ãtch
(
¡mt
è!ð
MYSQL_NO_DATA
)

4580 
	`dŸg
("d©a=%d", 
d©a
);

4581 
	`FAIL_IF
(
d©a
 != 100 && data != 88 && data != 389789, "Wrong value");

4583 
	`mysql_¡mt_þo£
(
¡mt
);

4584  
OK
;

4585 
	}
}

4587 
	$‹¡_mdev14165
(
MYSQL
 *
mysql
)

4589 
rc
;

4590 
MYSQL_STMT
 *
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

4591 
MYSQL_FIELD
 *
f›lds
;

4592 
MYSQL_RES
 *
»suÉ
;

4593 
my_boÞ
 
v®
= 1;

4594 
MYSQL_BIND
 
bšd
[1];

4595 
buf1
[52];

4597 
rc
ð
	`mysql_ÝtiÚs
(
mysql
, 
MYSQL_REPORT_DATA_TRUNCATION
, &
v®
);

4599 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

4600 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE1 (i INT(20) ZEROFILL)");

4601 
	`check_mysql_rc
(
rc
, 
mysql
);

4602 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTO1 VALUES (2),(1)");

4603 
	`check_mysql_rc
(
rc
, 
mysql
);

4604 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, "SELECT i FROM1", -1);

4605 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4607 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

4608 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4610 
	`mem£t
(
bšd
, 0, (
MYSQL_BIND
));

4611 
bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

4612 
bšd
[0].
bufãr_Ëngth
= 51;

4613 
bšd
[0].
bufãr
ð
buf1
;

4615 
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
bšd
);

4617 
rc
ð
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_UPDATE_MAX_LENGTH
, &
v®
);

4618 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4619 
rc
ð
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

4620 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4622 
»suÉ
ð
	`mysql_¡mt_»suÉ_m‘ad©a
(
¡mt
);

4624 
f›lds
ð
	`mysql_ãtch_f›lds
(
»suÉ
);

4626 
	`FAIL_IF
(
f›lds
[0].
Ëngth
 < 20, "Expected†ength=20");

4627 
	`FAIL_IF
(
f›lds
[0].
max_Ëngth
 < 20, "Expected max_length=20");

4629 
	`mysql_¡mt_ãtch
(
¡mt
);

4631 
	`FAIL_UNLESS
(
	`¡rcmp
(
buf1
, "00000000000000000002") == 0, "Wrong„esult");

4632 
	`mysql_ä“_»suÉ
(
»suÉ
);

4634 
	`mysql_¡mt_þo£
(
¡mt
);

4636 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE1");

4637 
	`check_mysql_rc
(
rc
, 
mysql
);

4638  
OK
;

4639 
	}
}

4641 
	$‹¡_com´ess
(
MYSQL
 *
mysql
)

4643 
MYSQL_STMT
 *
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

4644 
rc
;

4646 
rc
ð
	`m¬Ÿdb_¡mt_execu‹_dœeù
(
¡mt
, 
	`SL
("SELECT 1 FROM DUAL"));

4647 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4649 
	`mysql_¡mt_þo£
(
¡mt
);

4651  
OK
;

4652 
	}
}

4654 
	$equ®_MYSQL_TIME
(
MYSQL_TIME
 *
tm1
, MYSQL_TIME *
tm2
)

4656  
tm1
->
day
==
tm2
->day &&m1->
hour
=ñm2->hou¸&&m1->
mšu‹
==tm2->minute &&

4657 
tm1
->
mÚth
==
tm2
->mÚth &&m1->
Ãg
=ñm2->Ãg &&m1->
£cÚd
==tm2->second &&

4658 
tm1
->
£cÚd_·¹
==
tm2
->£cÚd_·¹ &&m1->
time_ty³
=ñm2->time_ty³ &&m1->
y—r
==tm2->year;

4659 
	}
}

4661 
	$‹¡_¡r_to_št
(
MYSQL
 *
mysql
)

4663 
i
;

4664 
	s¡_©oi_‹¡
{

4665 cÚ¡ *
¡r_v®ue
;

4666 
št_v®ue
;

4667 
rc
;

4668 } 
©oi_‹¡s
[]=

4673 {"10.2",10, 
MYSQL_DATA_TRUNCATED
},

4674 {"a", 0, 
MYSQL_DATA_TRUNCATED
},

4675 {"1 2 3", 1, 
MYSQL_DATA_TRUNCATED
},

4676 {
NULL
, 0, 0}

4679 
i
=0; 
©oi_‹¡s
[i].
¡r_v®ue
; i++)

4681 
rc
;

4682 
MYSQL_STMT
 *
¡mt
;

4683 
MYSQL_BIND
 
bšd
[1];

4684 
¡_©oi_‹¡
 *
‹¡
ð&
©oi_‹¡s
[
i
];

4685 
sql
[256];

4686 
št_v®ue
;

4688 
	`¢´štf
(
sql
, (sql), "SELECT '%s'",
‹¡
->
¡r_v®ue
);

4690 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

4692 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
sql
, (
ulÚg
)
	`¡¾’
(sql));

4693 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4694 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

4695 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4696 
rc
ð
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

4698 
	`mem£t
(
bšd
, 0, (
MYSQL_BIND
));

4699 
bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

4700 
bšd
[0].
bufãr
ð&
št_v®ue
;

4701 
bšd
[0].
bufãr_Ëngth
ð(
št_v®ue
);

4703 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
bšd
);

4704 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4705 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

4707 
	`dŸg
("test: str='%s',ƒxpected/returned value =%d/%d,ƒxpected/returned„c=%d/%d",

4708 
‹¡
->
¡r_v®ue
,e¡->
št_v®ue
, iÁ_v®ue,e¡->
rc
,„c);

4709 
	`FAIL_UNLESS
(
rc
 =ð
‹¡
->rc, "unexpected„eturn code");

4710 
	`FAIL_UNLESS
(
št_v®ue
 =ð
‹¡
->int_value, "unexpected int value");

4711 
	`mysql_¡mt_þo£
(
¡mt
);

4713  
OK
;

4714 
	}
}

4717 
	$‹¡_codbc138
(
MYSQL
 *
mysql
)

4719 
rc
;

4720 
MYSQL_STMT
 *
¡mt
;

4721 
MYSQL_BIND
 
bšd
[1];

4722 
MYSQL_TIME
 
tm
;

4723 
i
= 0;

4725 
	s¡_time_‹¡
 {

4726 cÚ¡ *
¡©em’t
;

4727 
MYSQL_TIME
 
tm
;

4728 } 
time_‹¡
[]={

4730 { 2017,7,28,0,0,0,0L,0, 
MYSQL_TIMESTAMP_DATE
 }

4733 { 2001,2,3,11,12,13,123456L,0, 
MYSQL_TIMESTAMP_DATETIME
 }

4736 { 2001,2,3,11,12,13,123000L,0, 
MYSQL_TIMESTAMP_DATETIME
 }

4739 { 0,0,0,11,12,13,0,1, 
MYSQL_TIMESTAMP_TIME
 }

4742 { 0,0,0,0,0,0,0,0, 
MYSQL_TIMESTAMP_ERROR
 }

4745 { 0,0,0,0,0,0,0,0, 
MYSQL_TIMESTAMP_ERROR
 }

4748 { 0,0,0,0,0,0,0,0, 
MYSQL_TIMESTAMP_ERROR
 }

4751 { 0,0,0,0,0,0,0,0, 
MYSQL_TIMESTAMP_ERROR
 }

4754 {1972,4,22, 0,0,0, 0,0,
MYSQL_TIMESTAMP_DATE
}

4757 {1972,4,22, 0,0,0, 0,0,
MYSQL_TIMESTAMP_DATE
}

4760 {1972,4,22, 0,0,0, 0,0,
MYSQL_TIMESTAMP_DATE
}

4763 {0,0,0, 0,0,0 ,0,0,
MYSQL_TIMESTAMP_DATE
}

4766 {1970,1,0, 0,0,0, 0,0, 
MYSQL_TIMESTAMP_DATE
}

4769 {69,12,31, 0,0,0, 0,0, 
MYSQL_TIMESTAMP_DATE
}

4772 {2069,12,31, 0,0,0, 0,0, 
MYSQL_TIMESTAMP_DATE
}

4775 {2068,12,31, 0,0,0, 0,0, 
MYSQL_TIMESTAMP_DATE
}

4778 {1970,1,1, 0,0,0, 0,0, 
MYSQL_TIMESTAMP_DATE
}

4781 {2010,1,1, 0,0,0, 0,0, 
MYSQL_TIMESTAMP_DATE
}

4785 {0,0,0, 0,0,0, 0,0, 
MYSQL_TIMESTAMP_ERROR
}

4788 {0,0,0, 0,0,0, 0,0, 
MYSQL_TIMESTAMP_ERROR
}

4791 {0,0,0, 0,0,0, 0,0, 
MYSQL_TIMESTAMP_ERROR
}

4794 {0,0,0, 0,0,0, 0,0, 
MYSQL_TIMESTAMP_ERROR
}

4797 {0,0,0, 0,0,0, 0,0, 
MYSQL_TIMESTAMP_ERROR
}

4800 {0,0,0, 0,0,0, 0,0, 
MYSQL_TIMESTAMP_ERROR
}

4803 {0,0,0, 0,0,0, 0,0, 
MYSQL_TIMESTAMP_ERROR
}

4806 {0,0,0, 0,0,0, 0,0,
MYSQL_TIMESTAMP_ERROR
}

4809 {0,0,0, 0,0,0, 0,0, 
MYSQL_TIMESTAMP_ERROR
}

4812 {0,0,0, 0,0,0, 0,0, 
MYSQL_TIMESTAMP_ERROR
}

4816 {0,0,0, 10,15,0, 0,0, 
MYSQL_TIMESTAMP_TIME
}

4819 {0,0,0, 10,15,1, 0,0, 
MYSQL_TIMESTAMP_TIME
}

4822 {0,0,0, 0,0,0, 0,0, 
MYSQL_TIMESTAMP_TIME
}

4825 {0,0,0, 0,0,0, 0,0, 
MYSQL_TIMESTAMP_TIME
}

4828 {0,0,0, 10,15,1, 0,0, 
MYSQL_TIMESTAMP_TIME
},

4831 {0,0,0, 25,59,59, 0,0, 
MYSQL_TIMESTAMP_TIME
},

4834 {0,0,0, 838,59,59, 0,0, 
MYSQL_TIMESTAMP_TIME
},

4837 {0,0,0, 838,59,59, 0, 1, 
MYSQL_TIMESTAMP_TIME
},

4841 {0,0,0, 0,0,0, 0,0, 
MYSQL_TIMESTAMP_ERROR
},

4844 {0,0,0, 0,0,0, 0,0, 
MYSQL_TIMESTAMP_ERROR
},

4847 {0,0,0, 0,0,0, 0,0, 
MYSQL_TIMESTAMP_ERROR
},

4850 {0,0,0, 0,0,0, 0,0, 
MYSQL_TIMESTAMP_ERROR
},

4853 { 0,0,0, 0,0,0, 0,0, 
MYSQL_TIMESTAMP_ERROR
 },

4856 {1999,12,31, 23,59,59, 999999, 0, 
MYSQL_TIMESTAMP_DATETIME
},

4859 {2000,8,11, 8,46,40, 0,0, 
MYSQL_TIMESTAMP_DATETIME
},

4862 {0,0,0, 0,0,0, 0,0, 
MYSQL_TIMESTAMP_ERROR
 },

4864 { 
NULL
,{ 0 } }

4867 
time_‹¡
[
i
].
¡©em’t
)

4869 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

4870 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
time_‹¡
[
i
].
¡©em’t
));

4871 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4872 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

4873 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4874 
rc
ð
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

4876 
	`mem£t
(
bšd
, 0, (
MYSQL_BIND
));

4877 
bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_DATETIME
;

4878 
bšd
[0].
bufãr
ð&
tm
;

4879 
bšd
[0].
bufãr_Ëngth
ð(
MYSQL_TIME
);

4881 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
bšd
);

4882 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4883 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

4884 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4885 
	`dŸg
("‹¡: % %d %d", 
time_‹¡
[
i
].
¡©em’t
, 
tm
.
time_ty³
,ime_test[i].tm.time_type);

4886 ià(
time_‹¡
[
i
].
tm
.
time_ty³
 =ð
MYSQL_TIMESTAMP_ERROR
)

4888 
	`FAIL_UNLESS
(
tm
.
time_ty³
 =ð
MYSQL_TIMESTAMP_ERROR
, "MYSQL_TIMESTAMP_ERRORƒxpected");

4891 
	`FAIL_UNLESS
(
	`equ®_MYSQL_TIME
(&
tm
, &
time_‹¡
[
i
].tm), "time_in !=ime_out");

4892 
	`mysql_¡mt_þo£
(
¡mt
);

4893 
i
++;

4896  
OK
;

4897 
	}
}

4899 
	$‹¡_cÚc334
(
MYSQL
 *
mysql
)

4901 
MYSQL_STMT
 *
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

4902 
MYSQL_RES
 *
»suÉ
;

4903 
MYSQL_FIELD
 *
f›ld
;

4904 
rc
;

4906 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("SHOW ENGINES"));

4907 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4909 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

4910 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4912 
»suÉ
ð
	`mysql_¡mt_»suÉ_m‘ad©a
(
¡mt
);

4913 ià(!
»suÉ
)

4915 
	`dŸg
("Couldn't„etrieve„esult set");

4916 
	`mysql_¡mt_þo£
(
¡mt
);

4917  
FAIL
;

4920 
	`mysql_f›ld_£ek
(
»suÉ
, 0);

4922 (
f›ld
ð
	`mysql_ãtch_f›ld
(
»suÉ
)))

4924 
	`FAIL_IF
(
f›ld
->
Çme_Ëngth
 == 0, "Invalid‚ame†ength (0)");

4925 
	`FAIL_IF
(
f›ld
->
bË_Ëngth
 == 0, "Invalid‚ame†ength (0)");

4927 
	`mysql_ä“_»suÉ
(
»suÉ
);

4928 
	`mysql_¡mt_þo£
(
¡mt
);

4930  
OK
;

4931 
	}
}

4932 
	$‹¡_cÚc344
(
MYSQL
 *
mysql
)

4934 
MYSQL_STMT
 *
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

4935 
rc
;

4937 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

4938 
	`check_mysql_rc
(
rc
, 
mysql
);

4940 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE1 (a int, b int)");

4941 
	`check_mysql_rc
(
rc
, 
mysql
);

4942 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTO1 VALUES (1,1), (2,2),(3,3),(4,4),(5,5)");

4943 
	`check_mysql_rc
(
rc
, 
mysql
);

4945 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("SELECT * FROM1 ORDER BY‡"));

4946 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4948 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

4949 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4951 !
	`mysql_¡mt_ãtch
(
¡mt
));

4952 
	`FAIL_IF
(
	`mysql_¡mt_num_rows
(
¡mt
) != 5, "expected 5„ows");

4953 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

4954 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4955 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

4956 
	`dŸg
("num_rows: %Îd", 
	`mysql_¡mt_num_rows
(
¡mt
));

4957 
	`FAIL_IF
(
	`mysql_¡mt_num_rows
(
¡mt
) != 1, "expected 1„ow");

4959 
	`mysql_¡mt_þo£
(
¡mt
);

4960  
OK
;

4961 
	}
}

4964 
	$‹¡_cÚc_äaùiÚ
(
MYSQL
 *
mysql
)

4966 
MYSQL_TIME
 
tm
;

4967 
MYSQL_BIND
 
bšd
[1];

4968 
qu”y
[1024];

4969 
i
;

4970 
MYSQL_STMT
 *
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

4971 
rc
;

4972 
äac
= 0;

4974 
i
=0; i < 10; i++, 
äac
=frac*10+i)

4976 
ex³ùed
= 0;

4977 
	`¥rštf
(
qu”y
, "SELECT '2018-11-05 22:25:59.%ld'", 
äac
);

4979 
	`dŸg
("%d: %s", 
i
, 
qu”y
);

4981 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

4982 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4984 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

4985 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4987 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4988 
rc
ð
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

4990 
	`mem£t
(
bšd
, 0, (
MYSQL_BIND
));

4991 
bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_DATETIME
;

4992 
bšd
[0].
bufãr
ð&
tm
;

4993 
bšd
[0].
bufãr_Ëngth
ð(
MYSQL_TIME
);

4995 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
bšd
);

4996 
	`check_¡mt_rc
(
rc
, 
¡mt
);

4997 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

4998 
	`check_¡mt_rc
(
rc
, 
¡mt
);

5000 
	`dŸg
("£cÚd_·¹: %ld", 
tm
.
£cÚd_·¹
);

5002 
ex³ùed
ð
i
 > 6 ? 123456 : 
äac
 * ()
	`powl
(10, (6 - i));

5004 
	`dŸg
("tm.£cÚd_·¹=%ldƒx³ùed=%ld", 
tm
.
£cÚd_·¹
, 
ex³ùed
);

5005 
	`FAIL_IF
(
tm
.
£cÚd_·¹
 !ð
ex³ùed
, "expected fractional…arto be 900000");

5008 
	`mysql_¡mt_þo£
(
¡mt
);

5009  
OK
;

5010 
	}
}

5012 
	$‹¡_z”ofžl_1by‹
(
MYSQL
 *
mysql
)

5014 
MYSQL_STMT
 *
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

5015 
rc
;

5016 
MYSQL_BIND
 
bšd
;

5017 
bufãr
[3];

5019 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

5020 
	`check_mysql_rc
(
rc
, 
mysql
);

5022 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE1 (a int zerofill)");

5023 
	`check_mysql_rc
(
rc
, 
mysql
);

5025 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTO1 VALUES(1)");

5026 
	`check_mysql_rc
(
rc
, 
mysql
);

5028 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("SELECT‡ FROM1"));

5029 
	`check_¡mt_rc
(
rc
, 
¡mt
);

5031 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

5032 
	`check_¡mt_rc
(
rc
, 
¡mt
);

5034 
	`mem£t
(&
bšd
, 0, (
MYSQL_BIND
));

5035 
bšd
.
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

5036 
bšd
.
bufãr
= buffer;

5037 
bšd
.
bufãr_Ëngth
= 1;

5039 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, &
bšd
);

5041 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

5042 
	`FAIL_IF
(
rc
 != 101, "expectedruncation warning");

5044 
	`mysql_¡mt_þo£
(
¡mt
);

5045 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE1");

5046 
	`check_mysql_rc
(
rc
, 
mysql
);

5048  
OK
;

5049 
	}
}

5051 
	$‹¡_cÚc424
(
MYSQL
 *
mysql
)

5053 
rc
;

5054 
MYSQL_STMT
 *
¡mt
;

5055 
my_boÞ
 
max_Ën
= 1;

5057 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_table1");

5058 
	`check_mysql_rc
(
rc
, 
mysql
);

5059 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_table1 (test_int INT, b int)");

5060 
	`check_mysql_rc
(
rc
, 
mysql
);

5061 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTOest_table1 values(10,11),(11,12)");

5062 
	`check_mysql_rc
(
rc
, 
mysql
);

5064 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP PROCEDURE IF EXISTSestCursor");

5065 
	`check_mysql_rc
(
rc
, 
mysql
);

5067 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE PROCEDUREestCursor()\n"

5087 
	`check_mysql_rc
(
rc
, 
mysql
);

5089 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

5090 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("CALLestCursor()"));

5091 
	`check_¡mt_rc
(
rc
, 
¡mt
);

5093 
rc
ð
	`mysql_¡mt_©Œ_£t
(
¡mt
, 
STMT_ATTR_UPDATE_MAX_LENGTH
, &
max_Ën
);

5094 
	`check_¡mt_rc
(
rc
, 
¡mt
);

5096 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

5097 
	`check_¡mt_rc
(
rc
, 
¡mt
);

5100 ià(
	`mysql_¡mt_f›ld_couÁ
(
¡mt
))

5102 
MYSQL_RES
 *
»s
ð
	`mysql_¡mt_»suÉ_m‘ad©a
(
¡mt
);

5103 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

5104 
	`FAIL_IF
(
rc
, "Wrong„eturn code");

5105 
	`mysql_ä“_»suÉ
(
»s
);

5107 
rc
ð
	`mysql_¡mt_Ãxt_»suÉ
(
¡mt
);

5109 } !
rc
);

5111 
	`mysql_¡mt_þo£
(
¡mt
);

5112 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP PROCEDUREestCursor");

5113 
	`check_mysql_rc
(
rc
, 
mysql
);

5115 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLEest_table1");

5116 
	`check_mysql_rc
(
rc
, 
mysql
);

5118  
OK
;

5119 
	}
}

5121 
	$‹¡_max·¿m
(
MYSQL
 *
mysql
)

5123 cÚ¡ *
qu”y
= "INSERT INTO1 VALUES (?)";

5124 
rc
;

5125 *
bufãr
;

5126 
i
;

5127 
v®
= 1;

5128 
size_t
 
mem
ð
	`¡¾’
(
qu”y
) + 1 + 4 * 65535 + 1;

5129 
MYSQL_STMT
 *
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

5130 
MYSQL_BIND
* 
bšd
;

5132 
bšd
 = 
	`ÿÎoc
((
MYSQL_BIND
), 65535);

5134 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

5135 
	`check_mysql_rc
(
rc
, 
mysql
);

5137 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE1 (a int)");

5138 
	`check_mysql_rc
(
rc
, 
mysql
);

5140 
bufãr
ð
	`ÿÎoc
(1, 
mem
);

5141 
	`¡rýy
(
bufãr
, 
qu”y
);

5142 
i
=0; i < 65534.; i++)

5143 
	`¡rÿt
(
bufãr
, ",(?)");

5144 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
bufãr
));

5145 
	`check_¡mt_rc
(
rc
, 
¡mt
);

5147 
i
=0; i < 65534; i++)

5149 
bšd
[
i
].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

5150 
bšd
[
i
].
bufãr
ð&
v®
;

5153 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
bšd
);

5154 
	`check_¡mt_rc
(
rc
, 
¡mt
);

5156 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

5157 
	`check_¡mt_rc
(
rc
, 
¡mt
);

5159 
	`FAIL_IF
(
	`mysql_¡mt_afãùed_rows
(
¡mt
) != 65535, "Expected‡ffected_rows=65535");

5161 
	`¡rÿt
(
bufãr
, ",(?)");

5162 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
bufãr
));

5163 
	`ä“
(
bufãr
);

5164 
	`FAIL_IF
(!
rc
, "Errorƒxpected");

5165 
	`FAIL_IF
(
	`mysql_¡mt_”ºo
(
¡mt
è!ð
ER_PS_MANY_PARAM
, "Expected ER_PS_MANY_PARAMƒrror");

5167 
	`mysql_¡mt_þo£
(
¡mt
);

5168 
	`ä“
(
bšd
);

5169  
OK
;

5170 
	}
}

5172 
	$‹¡_mdev_21920
(
MYSQL
 *
mysql
)

5174 
MYSQL_STMT
 *
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

5175 
MYSQL_BIND
 
bšd
[1];

5176 
rc
;

5177 
bufãr
[128];

5179 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("SELECT ''"));

5180 
	`check_¡mt_rc
(
rc
, 
¡mt
);

5182 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

5183 
	`check_¡mt_rc
(
rc
, 
¡mt
);

5185 
bufãr
[0]= 1;

5187 
	`mem£t
(
bšd
, 0, (
MYSQL_BIND
));

5188 
bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

5189 
bšd
[0].
bufãr
= buffer;

5190 
bšd
[0].
bufãr_Ëngth
= 127;

5192 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
bšd
);

5193 
	`check_¡mt_rc
(
rc
, 
¡mt
);

5195 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

5196 
	`check_¡mt_rc
(
rc
, 
¡mt
);

5198 
	`FAIL_IF
(
bufãr
[0] != 0, "Expectedƒmpty string");

5201 
	`mysql_¡mt_þo£
(
¡mt
);

5203  
OK
;

5204 
	}
}

5206 
	$‹¡_»tuºšg
(
MYSQL
 *
mysql
)

5208 
MYSQL_STMT
 *
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

5209 
MYSQL_RES
 *
»suÉ
;

5210 
rc
;

5212 
	`dŸg
("MDEV-23768‚ot fixed yet");

5213 
	`mysql_¡mt_þo£
(
¡mt
);

5214  
SKIP
;

5216 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TEMPORARY TABLE1 (a int‚ot‚ull‡uto_increment…rimary key, b json)");

5217 
	`check_mysql_rc
(
rc
, 
mysql
);

5219 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTO1 (a,b) VALUES (NULL, '[incorrect json]') RETURNING‡");

5220 
	`check_mysql_rc
(
rc
, 
mysql
);

5222 ià(!
rc
è
	`dŸg
("should have fail");

5224 
»suÉ
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

5225 
	`mysql_ä“_»suÉ
(
»suÉ
);

5227 
	`dŸg
("E¼Ü: %s", 
	`mysql_”rÜ
(
mysql
));

5229 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("INSERT INTO1 (a,b) VALUES (NULL, '[incorrect json]') RETURNING‡"));

5230 
	`check_¡mt_rc
(
rc
, 
¡mt
);

5232 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

5233 
	`check_¡mt_rc
(
rc
, 
¡mt
);

5235 
rc
ð
	`mysql_¡mt_þo£
(
¡mt
);

5237  
OK
;

5238 
	}
}

5240 
	$‹¡_cÚc504
(
MYSQL
 *
mysql
)

5242 
rc
;

5243 
MYSQL_STMT
 *
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

5244 cÚ¡ *
¥
= "CREATE PROCEDURE…1()\n" \

5251 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP PROCEDURE IF EXISTS…1");

5252 
	`check_mysql_rc
(
rc
, 
mysql
);

5254 
rc
ð
	`mysql_qu”y
(
mysql
, 
¥
);

5255 
	`check_mysql_rc
(
rc
, 
mysql
);

5257 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("CALL…1()"));

5258 
	`check_¡mt_rc
(
rc
, 
¡mt
);

5260 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

5261 
	`check_¡mt_rc
(
rc
, 
¡mt
);

5263 
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

5264 
	`FAIL_IF
(
	`mysql_¡mt_num_rows
(
¡mt
) != 1, "Expected 1„ow");

5266 
	`mysql_¡mt_Ãxt_»suÉ
(
¡mt
);

5267 
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

5268 
	`FAIL_IF
(
	`mysql_¡mt_num_rows
(
¡mt
) != 1, "Expected 1„ow");

5270 
	`mysql_¡mt_Ãxt_»suÉ
(
¡mt
);

5271 
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

5272 
	`FAIL_IF
(
	`mysql_¡mt_num_rows
(
¡mt
) != 1, "Expected 1„ow");

5274 
	`mysql_¡mt_þo£
(
¡mt
);

5276 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP PROCEDURE…1");

5277 
	`check_mysql_rc
(
rc
, 
mysql
);

5279  
OK
;

5280 
	}
}

5282 
	$‹¡_cÚc512
(
MYSQL
 *
mysql
)

5284 
rc
;

5285 
MYSQL_STMT
 *
¡mt
;

5286 
MYSQL_BIND
 
bšd
;

5287 
f
;

5289 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxists1");

5291 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
("CREATE TABLE1 (a int)"));

5293 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
("INSERT INTO1 VALUES (1073741825)"));

5295 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

5296 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
("SELECT‡ FROM1"));

5297 
	`check_¡mt_rc
(
rc
, 
¡mt
);

5299 
	`mem£t
(&
bšd
, 0, (
MYSQL_BIND
));

5300 
bšd
.
bufãr
ð&
f
;

5301 
bšd
.
bufãr_ty³
ð
MYSQL_TYPE_FLOAT
;

5303 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

5304 
	`check_¡mt_rc
(
rc
, 
¡mt
);

5306 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, &
bšd
);

5307 
	`check_¡mt_rc
(
rc
, 
¡mt
);

5309 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

5310 
	`FAIL_IF
(
rc
 != 101, "Truncationƒxpected");

5312 
	`mysql_¡mt_þo£
(
¡mt
);

5314 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE1");

5315 
	`check_mysql_rc
(
rc
, 
mysql
);

5316  
OK
;

5317 
	}
}

5319 
my_‹¡s_¡
 
	gmy_‹¡s
[] = {

5320 {"‹¡_cÚc512", 
‹¡_cÚc512
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

5321 {"‹¡_cÚc504", 
‹¡_cÚc504
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

5322 {"‹¡_»tuºšg", 
‹¡_»tuºšg
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

5323 {"‹¡_mdev_21920", 
‹¡_mdev_21920
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

5324 {"‹¡_max·¿m", 
‹¡_max·¿m
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

5325 {"‹¡_cÚc424", 
‹¡_cÚc424
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

5326 {"‹¡_cÚc344", 
‹¡_cÚc344
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

5327 {"‹¡_cÚc334", 
‹¡_cÚc334
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

5328 {"‹¡_com´ess", 
‹¡_com´ess
, 
TEST_CONNECTION_NEW
, 
CLIENT_COMPRESS
, 
NULL
, NULL},

5329 {"‹¡_z”ofžl_1by‹", 
‹¡_z”ofžl_1by‹
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

5330 {"‹¡_codbc138", 
‹¡_codbc138
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

5331 {"‹¡_cÚc208", 
‹¡_cÚc208
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

5332 {"‹¡_mdev14165", 
‹¡_mdev14165
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

5333 {"‹¡_cÚc208", 
‹¡_cÚc208
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

5334 {"‹¡_cÚc217", 
‹¡_cÚc217
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

5335 {"‹¡_cÚc205", 
‹¡_cÚc205
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

5336 {"‹¡_cÚc198", 
‹¡_cÚc198
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

5337 {"‹¡_cÚc182", 
‹¡_cÚc182
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

5338 {"‹¡_cÚc181", 
‹¡_cÚc181
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

5339 {"‹¡_cÚc179", 
‹¡_cÚc179
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

5340 {"‹¡_cÚc177", 
‹¡_cÚc177
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

5341 {"‹¡_cÚc167", 
‹¡_cÚc167
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

5342 {"‹¡_cÚc168", 
‹¡_cÚc168
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

5343 {"‹¡_cÚc155", 
‹¡_cÚc155
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

5344 {"‹¡_cÚc154", 
‹¡_cÚc154
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5345 {"‹¡_cÚc141", 
‹¡_cÚc141
, 
TEST_CONNECTION_NEW
, 0, 
NULL
 , NULL},

5346 {"‹¡_cÚc67", 
‹¡_cÚc67
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5347 {"‹¡_cÚc_5", 
‹¡_cÚc_5
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5348 {"‹¡_bug1115", 
‹¡_bug1115
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5349 {"‹¡_bug1180", 
‹¡_bug1180
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5350 {"‹¡_bug1644", 
‹¡_bug1644
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5351 {"‹¡_bug11037", 
‹¡_bug11037
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5352 {"‹¡_bug11183", 
‹¡_bug11183
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5353 {"‹¡_bug12744", 
‹¡_bug12744
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5354 {"‹¡_bug1500", 
‹¡_bug1500
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5355 {"‹¡_bug15510", 
‹¡_bug15510
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5356 {"‹¡_bug15518", 
‹¡_bug15518
, 
TEST_CONNECTION_NEW
 | 
TEST_CONNECTION_DONT_CLOSE
, 
CLIENT_MULTI_STATEMENTS
, 
NULL
 , NULL},

5357 {"‹¡_bug15613", 
‹¡_bug15613
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5358 {"‹¡_bug16144", 
‹¡_bug16144
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5359 {"‹¡_bug1664", 
‹¡_bug1664
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5360 {"‹¡_bug1946", 
‹¡_bug1946
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5361 {"‹¡_bug2247", 
‹¡_bug2247
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5362 {"‹¡_bug2248", 
‹¡_bug2248
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5363 {"‹¡_bug20152", 
‹¡_bug20152
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5364 {"‹¡_bug23383", 
‹¡_bug23383
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5365 {"‹¡_bug27592", 
‹¡_bug27592
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5366 {"‹¡_bug28934", 
‹¡_bug28934
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5367 {"‹¡_bug36004", 
‹¡_bug36004
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5368 {"‹¡_bug3035", 
‹¡_bug3035
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5369 {"‹¡_bug3117", 
‹¡_bug3117
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5370 {"‹¡_bug3796", 
‹¡_bug3796
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5371 {"‹¡_bug4026", 
‹¡_bug4026
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5372 {"‹¡_bug4030", 
‹¡_bug4030
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5373 {"‹¡_bug4079", 
‹¡_bug4079
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5374 {"‹¡_bug4172", 
‹¡_bug4172
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5375 {"‹¡_bug4231", 
‹¡_bug4231
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5376 {"‹¡_bug4236", 
‹¡_bug4236
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5377 {"‹¡_bug5126", 
‹¡_bug5126
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5378 {"‹¡_bug5194", 
‹¡_bug5194
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5379 {"‹¡_bug5315", 
‹¡_bug5315
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5380 {"‹¡_bug5399", 
‹¡_bug5399
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5381 {"‹¡_bug6046", 
‹¡_bug6046
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5382 {"‹¡_bug6049", 
‹¡_bug6049
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5383 {"‹¡_bug6058", 
‹¡_bug6058
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5384 {"‹¡_bug6059", 
‹¡_bug6059
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5385 {"‹¡_bug6096", 
‹¡_bug6096
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5386 {"‹¡_bug7990", 
‹¡_bug7990
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5387 {"‹¡_bug8330", 
‹¡_bug8330
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5388 {"‹¡_bug8722", 
‹¡_bug8722
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5389 {"‹¡_ps_cÚj_£Ëù", 
‹¡_ps_cÚj_£Ëù
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5390 {"‹¡_ps_nuÎ_·¿m", 
‹¡_ps_nuÎ_·¿m
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5391 {"‹¡_ps_qu”y_ÿche", 
‹¡_ps_qu”y_ÿche
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5392 {"‹¡_ushÜt_bug", 
‹¡_ushÜt_bug
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5393 {"‹¡_f›ld_misc", 
‹¡_f›ld_misc
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5394 {"‹¡_mem_ov”un", 
‹¡_mem_ov”un
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5395 {"‹¡_decim®_bug", 
‹¡_decim®_bug
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5396 {"‹¡_ex¶aš_bug", 
‹¡_ex¶aš_bug
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5397 {"‹¡_sshÜt_bug", 
‹¡_sshÜt_bug
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5398 {"‹¡_¡šy_bug", 
‹¡_¡šy_bug
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5399 {"‹¡_bug53311", 
‹¡_bug53311
, 
TEST_CONNECTION_NEW
, 0, 
NULL
 , NULL},

5400 {"‹¡_cÚc_äaùiÚ", 
‹¡_cÚc_äaùiÚ
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

5401 {"‹¡_¡r_to_št", 
‹¡_¡r_to_št
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

5402 {
NULL
, NULL, 0, 0, NULL, NULL}

5405 
	$maš
(
¬gc
, **
¬gv
)

5407 ià(
¬gc
 > 1)

5408 
	`g‘_ÝtiÚs
(
¬gc
, 
¬gv
);

5410 
	`g‘_’vv¬s
();

5412 
	`run_‹¡s
(
my_‹¡s
);

5414 (
	`ex™_¡©us
());

5415 
	}
}

	@unittest/libmariadb/ps_new.c

20 
	~"my_‹¡.h
"

25 
	$‹¡_muÉi_»suÉ
(
MYSQL
 *
mysql
)

27 
MYSQL_STMT
 *
¡mt
;

28 
MYSQL_BIND
 
ps_·¿ms
[3];

29 
MYSQL_BIND
 
rs_bšd
[3];

30 
št_d©a
[3];

31 
my_boÞ
 
is_nuÎ
[3];

32 
rc
, 
i
;

35 
rc
 = 
	`mysql_qu”y
(
mysql
, "DROP PROCEDURE IF EXISTS…1");

36 
	`check_mysql_rc
(
rc
, 
mysql
);

38 
rc
 = 
	`mysql_qu”y
(
mysql
,

48 
	`check_mysql_rc
(
rc
, 
mysql
);

51 
¡mt
 = 
	`mysql_¡mt_š™
(
mysql
);

52 ià(!
¡mt
)

54 
	`dŸg
("Could‚ot initialize statement");

55 
	`ex™
(1);

57 
rc
 = 
	`mysql_¡mt_´•¬e
(
¡mt
, "CALL…1(?, ?, ?)", 16);

58 
	`check_¡mt_rc
(
rc
, 
¡mt
);

61 
	`mem£t
(
ps_·¿ms
, 0,  (ps_params));

63 
ps_·¿ms
[0].
bufãr_ty³
 = 
MYSQL_TYPE_LONG
;

64 
ps_·¿ms
[0].
bufãr
 = (*è&
št_d©a
[0];

65 
ps_·¿ms
[0].
Ëngth
 = 0;

66 
ps_·¿ms
[0].
is_nuÎ
 = 0;

68 
ps_·¿ms
[1].
bufãr_ty³
 = 
MYSQL_TYPE_LONG
;

69 
ps_·¿ms
[1].
bufãr
 = (*è&
št_d©a
[1];

70 
ps_·¿ms
[1].
Ëngth
 = 0;

71 
ps_·¿ms
[1].
is_nuÎ
 = 0;

73 
ps_·¿ms
[2].
bufãr_ty³
 = 
MYSQL_TYPE_LONG
;

74 
ps_·¿ms
[2].
bufãr
 = (*è&
št_d©a
[2];

75 
ps_·¿ms
[2].
Ëngth
 = 0;

76 
ps_·¿ms
[2].
is_nuÎ
 = 0;

79 
rc
 = 
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
ps_·¿ms
);

80 
	`check_¡mt_rc
(
rc
, 
¡mt
);

83 
št_d©a
[0]= 10;

84 
št_d©a
[1]= 20;

85 
št_d©a
[2]= 30;

87 
rc
 = 
	`mysql_¡mt_execu‹
(
¡mt
);

88 
	`check_¡mt_rc
(
rc
, 
¡mt
);

90 
	`FAIL_IF
(
	`mysql_¡mt_f›ld_couÁ
(
¡mt
) != 3, "expected 3 fields");

92 
	`mem£t
(
rs_bšd
, 0,  (
MYSQL_BIND
) * 3);

93 
i
=0; i < 3; i++)

95 
rs_bšd
[
i
].
bufãr
 = (*è&(
št_d©a
[i]);

96 
rs_bšd
[
i
].
bufãr_Ëngth
 =  (
št_d©a
);

97 
rs_bšd
[
i
].
bufãr_ty³
 = 
MYSQL_TYPE_LONG
;

98 
rs_bšd
[
i
].
is_nuÎ
 = &is_null[i];

100 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
rs_bšd
);

101 
	`check_¡mt_rc
(
rc
, 
¡mt
);

103 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

104 
	`check_¡mt_rc
(
rc
, 
¡mt
);

106 
	`FAIL_IF
(
št_d©a
[0] != 10 || int_data[1] != 20 || int_data[2] != 30,

108 
rc
ð
	`mysql_¡mt_Ãxt_»suÉ
(
¡mt
);

109 
	`check_¡mt_rc
(
rc
, 
¡mt
);

110 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
rs_bšd
);

112 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

113 
	`FAIL_IF
(
	`mysql_¡mt_f›ld_couÁ
(
¡mt
) != 3, "expected 3 fields");

114 
	`FAIL_IF
(
št_d©a
[0] != 100 || int_data[1] != 200 || int_data[2] != 300,

117 
	`FAIL_IF
(
	`mysql_¡mt_Ãxt_»suÉ
(
¡mt
) != 0, "expected more„esults");

118 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
rs_bšd
);

120 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

121 
	`FAIL_IF
(
	`mysql_¡mt_f›ld_couÁ
(
¡mt
) != 2, "expected 2 fields");

122 
	`FAIL_IF
(
št_d©a
[0] != 200 || int_data[1] != 300,

125 
	`FAIL_IF
(
	`mysql_¡mt_Ãxt_»suÉ
(
¡mt
) != 0, "expected more„esults");

126 
	`FAIL_IF
(
	`mysql_¡mt_f›ld_couÁ
(
¡mt
) != 0, "expected 0 fields");

128 
rc
ð
	`mysql_¡mt_þo£
(
¡mt
);

129 
rc
 = 
	`mysql_qu”y
(
mysql
, "DROP PROCEDURE IF EXISTS…1");

130 
	`check_mysql_rc
(
rc
, 
mysql
);

131  
OK
;

132 
	}
}

134 
	$‹¡_¥_·¿ms
(
MYSQL
 *
mysql
)

136 
i
, 
rc
;

137 
MYSQL_STMT
 *
¡mt
;

138 
a
[] = {10,20,30};

139 
MYSQL_BIND
 
bšd
[3];

140 cÚ¡ *
¡mt¡r
= "CALL P1(?,?,?)";

141 
»s
[3][20];

143 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP PROCEDURE IF EXISTS…1");

144 
	`check_mysql_rc
(
rc
, 
mysql
);

146 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE PROCEDURE…1(OUT…_out VARCHAR(19), IN…_in INT, INOUT…_inout INT)"

151 
	`check_mysql_rc
(
rc
, 
mysql
);

153 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

154 
	`check_mysql_rc
(
rc
, 
mysql
);

156 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
,
	`SL
(
¡mt¡r
));

157 
	`check_¡mt_rc
(
rc
, 
¡mt
);

159 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
) != 3, "expected…aram_count=3");

161 
	`mem£t
(
bšd
, 0, (
MYSQL_BIND
) * 3);

162 
i
=0; i < 3; i++)

164 
bšd
[
i
].
bufãr
ð&
a
[i];

165 
bšd
[
i
].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

167 
bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_NULL
;

168 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
bšd
);

169 
	`check_¡mt_rc
(
rc
, 
¡mt
);

171 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

172 
	`check_¡mt_rc
(
rc
, 
¡mt
);

174 
	`mem£t
(
»s
, 0, 60);

176 
	`mem£t
(
bšd
, 0, (
MYSQL_BIND
) * 3);

177 
i
=0; i < 3; i++)

179 
bšd
[
i
].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

180 
bšd
[
i
].
bufãr_Ëngth
= 20;

181 
bšd
[
i
].
bufãr
ð
»s
[i];

185 ià(
mysql
->
£rv”_¡©us
 & 
SERVER_PS_OUT_PARAMS
)

187 
	`dŸg
("out…aram„esult set");

188 
	`FAIL_IF
(
	`mysql_¡mt_f›ld_couÁ
(
¡mt
) != 2, "expected 2 columns");

189 
	`FAIL_IF
(
	`¡rcmp
(
¡mt
->
f›lds
[0].
Üg_Çme
, "p_out") != 0, "wrong field‚ame");

190 
	`FAIL_IF
(
	`¡rcmp
(
¡mt
->
f›lds
[1].
Üg_Çme
, "p_inout") != 0, "wrong field‚ame");

191 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
bšd
);

192 
	`check_¡mt_rc
(
rc
, 
¡mt
);

193 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

194 
	`check_¡mt_rc
(
rc
, 
¡mt
);

195 
	`FAIL_IF
(
	`¡rcmp
(
»s
[0],"This is OUT…aram") != 0, "comparison failed");

196 
	`FAIL_IF
(
	`¡rcmp
(
»s
[1],"200") != 0, "comparison failed");

199 ià(
	`mysql_¡mt_f›ld_couÁ
(
¡mt
))

201 
	`dŸg
("sp„esult set");

202 
	`FAIL_IF
(
	`mysql_¡mt_f›ld_couÁ
(
¡mt
) != 3, "expected 3 columns");

203 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
bšd
);

204 
	`check_¡mt_rc
(
rc
, 
¡mt
);

205 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

206 
	`check_¡mt_rc
(
rc
, 
¡mt
);

207 
	`FAIL_IF
(
	`¡rcmp
(
»s
[0],"200") != 0, "comparison failed");

208 
	`FAIL_IF
(
	`¡rcmp
(
»s
[1],"300") != 0, "comparison failed");

209 
	`FAIL_IF
(
	`¡rcmp
(
»s
[2],"OUT…aram") != 0, "comparison failed");

212 } 
	`mysql_¡mt_Ãxt_»suÉ
(
¡mt
) == 0);

214 
rc
ð
	`mysql_¡mt_þo£
(
¡mt
);

215  
OK
;

216 
	}
}

218 
	$‹¡_¥_»£t
(
MYSQL
 *
mysql
)

220 
i
, 
rc
;

221 
MYSQL_STMT
 *
¡mt
;

222 
a
[] = {10,20,30};

223 
MYSQL_BIND
 
bšd
[3];

224 cÚ¡ *
¡mt¡r
= "CALL P1(?,?,?)";

226 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP PROCEDURE IF EXISTS…1");

227 
	`check_mysql_rc
(
rc
, 
mysql
);

229 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE PROCEDURE…1(OUT…_out VARCHAR(19), IN…_in INT, INOUT…_inout INT)"

234 
	`check_mysql_rc
(
rc
, 
mysql
);

236 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

237 
	`check_mysql_rc
(
rc
, 
mysql
);

239 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
,
	`SL
(
¡mt¡r
));

240 
	`check_¡mt_rc
(
rc
, 
¡mt
);

242 
	`FAIL_IF
(
	`mysql_¡mt_·¿m_couÁ
(
¡mt
) != 3, "expected…aram_count=3");

244 
	`mem£t
(
bšd
, 0, (
MYSQL_BIND
) * 3);

245 
i
=0; i < 3; i++)

247 
bšd
[
i
].
bufãr
ð&
a
[i];

248 
bšd
[
i
].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

250 
bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_NULL
;

251 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
bšd
);

252 
	`check_¡mt_rc
(
rc
, 
¡mt
);

254 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

255 
	`check_¡mt_rc
(
rc
, 
¡mt
);

257 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

258 
	`check_¡mt_rc
(
rc
, 
¡mt
);

260 
rc
ð
	`mysql_¡mt_»£t
(
¡mt
);

261 
	`check_¡mt_rc
(
rc
, 
¡mt
);

265 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP PROCEDURE…1");

266 
	`check_mysql_rc
(
rc
, 
mysql
);

268 
rc
ð
	`mysql_¡mt_þo£
(
¡mt
);

269  
OK
;

270 
	}
}

272 
	$‹¡_¥_»£t1
(
MYSQL
 *
mysql
)

274 
rc
;

275 
MYSQL_STMT
 *
¡mt
;

276 
MYSQL_BIND
 
bšd
[1];

278 
tmp
[20];

279 cÚ¡ *
¡mt¡r
= "CALL P1(?)";

281 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP PROCEDURE IF EXISTS…1");

282 
	`check_mysql_rc
(
rc
, 
mysql
);

283 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE PROCEDURE…1(OUT…_out VARCHAR(19))"

289 
	`check_mysql_rc
(
rc
, 
mysql
);

291 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

292 
	`check_mysql_rc
(
rc
, 
mysql
);

294 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
,
	`SL
(
¡mt¡r
));

295 
	`check_¡mt_rc
(
rc
, 
¡mt
);

297 
	`mem£t
(
tmp
, 0, (tmp));

298 
	`mem£t
(
bšd
, 0, (
MYSQL_BIND
));

299 
bšd
[0].
bufãr
ð
tmp
;

300 
bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

301 
bšd
[0].
bufãr_Ëngth
= 4;

303 
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
bšd
);

305 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

306 
	`check_¡mt_rc
(
rc
, 
¡mt
);

308 
rc
ð
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

309 
	`check_¡mt_rc
(
rc
, 
¡mt
);

311 
rc
ð
	`mysql_¡mt_Ãxt_»suÉ
(
¡mt
);

312 
	`check_¡mt_rc
(
rc
, 
¡mt
);

314 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

315 
	`check_¡mt_rc
(
rc
, 
¡mt
);

321 
rc
ð
	`mysql_¡mt_»£t
(
¡mt
);

322 
	`check_¡mt_rc
(
rc
, 
¡mt
);

324 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP PROCEDURE…1");

325 
	`check_mysql_rc
(
rc
, 
mysql
);

327 
	`mysql_¡mt_þo£
(
¡mt
);

328  
OK
;

329 
	}
}

331 
	$‹¡_¥_»£t2
(
MYSQL
 *
mysql
)

333 
rc
, 
i
;

334 
MYSQL_STMT
 *
¡mt
;

335 
MYSQL_BIND
 
bšd
[4];

336 
l
[4];

337 cÚ¡ *
¡mt¡r
= "CALL P1()";

339 
	`mem£t
(
l
, 0, (l));

341 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

342 
	`check_mysql_rc
(
rc
, 
mysql
);

343 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE1 (a int)");

344 
	`check_mysql_rc
(
rc
, 
mysql
);

346 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP PROCEDURE IF EXISTS…1");

347 
	`check_mysql_rc
(
rc
, 
mysql
);

349 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE PROCEDURE…1()"

359 
	`check_mysql_rc
(
rc
, 
mysql
);

361 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

362 
	`check_mysql_rc
(
rc
, 
mysql
);

364 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
,
	`SL
(
¡mt¡r
));

365 
	`check_¡mt_rc
(
rc
, 
¡mt
);

367 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

368 
	`check_¡mt_rc
(
rc
, 
¡mt
);

370 
	`mem£t
(
bšd
, 0, (
MYSQL_BIND
) * 4);

371 
i
=0; i < 4; i++)

373 
bšd
[
i
].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

374 
bšd
[
i
].
bufãr
ð&
l
[i];

377 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
bšd
);

378 
	`check_¡mt_rc
(
rc
, 
¡mt
);

380 
rc
 !ð
MYSQL_NO_DATA
)

382 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

383 
	`dŸg
("l=%ld", 
l
[0]);

386 
rc
ð
	`mysql_¡mt_Ãxt_»suÉ
(
¡mt
);

387 
	`check_¡mt_rc
(
rc
, 
¡mt
);

390 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
bšd
);

391 
	`check_¡mt_rc
(
rc
, 
¡mt
);

393 
rc
 !ð
MYSQL_NO_DATA
)

395 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

396 
	`dŸg
("l=%ld†=%ld", 
l
[0],†[1]);

400 
rc
ð
	`mysql_¡mt_Ãxt_»suÉ
(
¡mt
);

401 
	`check_¡mt_rc
(
rc
, 
¡mt
);

404 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
bšd
);

405 
	`check_¡mt_rc
(
rc
, 
¡mt
);

407 
rc
 !ð
MYSQL_NO_DATA
)

409 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

410 
	`dŸg
("l=%ld†=%ld†=%ld", 
l
[0],†[1],†[2]);

413 
rc
ð
	`mysql_¡mt_þo£
(
¡mt
);

416 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP PROCEDURE…1");

417 
	`check_mysql_rc
(
rc
, 
mysql
);

418 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

419 
	`check_mysql_rc
(
rc
, 
mysql
);

421  
OK
;

422 
	}
}

424 
	$‹¡_qu”y
(
MYSQL
 *
mysql
)

426 
rc
;

427 
i
;

428 
MYSQL_STMT
 *
¡mt
;

429 
MYSQL_BIND
 
bšd
[1];

431 
tmp
[20];

432 cÚ¡ *
¡mt¡r
= "CALL P1(?)";

434 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP PROCEDURE IF EXISTS…1");

435 
	`check_mysql_rc
(
rc
, 
mysql
);

436 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE PROCEDURE…1(OUT…_out VARCHAR(19))"

441 
	`check_mysql_rc
(
rc
, 
mysql
);

443 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

444 
	`check_mysql_rc
(
rc
, 
mysql
);

446 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
,
	`SL
(
¡mt¡r
));

447 
	`check_¡mt_rc
(
rc
, 
¡mt
);

449 
i
=0; i < 1000; i++)

451 
¡©us
;

452 
	`mem£t
(
tmp
, 0, (tmp));

453 
	`mem£t
(
bšd
, 0, (
MYSQL_BIND
));

454 
bšd
[0].
bufãr
ð
tmp
;

455 
bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

456 
bšd
[0].
bufãr_Ëngth
= 4;

458 
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
bšd
);

460 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

461 
	`check_¡mt_rc
(
rc
, 
¡mt
);

463 ià(
¡mt
->
f›ld_couÁ
)

465 
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
bšd
);

466 
rc
ð
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

467 
	`check_¡mt_rc
(
rc
, 
¡mt
);

468 
	`mysql_¡mt_ãtch
(
¡mt
) == 0);

470 
rc
ð
	`mysql_¡mt_ä“_»suÉ
(
¡mt
);

471 
	`check_¡mt_rc
(
rc
, 
¡mt
);

473 
¡©us
ð
	`mysql_¡mt_Ãxt_»suÉ
(
¡mt
);

474 ià(
¡©us
 == 1)

475 
	`check_¡mt_rc
(
¡©us
, 
¡mt
);

476 } 
¡©us
 == 0);

478 
rc
ð
	`mysql_¡mt_»£t
(
¡mt
);

479 ià(
rc
)

480 
	`dŸg
("»£ˆçžed‡á” %d i‹¿tiÚs", 
i
);

481 
	`check_¡mt_rc
(
rc
, 
¡mt
);

483 
	`mysql_¡mt_þo£
(
¡mt
);

484 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP PROCEDURE IF EXISTS…1");

485 
	`check_mysql_rc
(
rc
, 
mysql
);

487  
OK
;

488 
	}
}

491 
my_‹¡s_¡
 
	gmy_‹¡s
[] = {

492 {"‹¡_qu”y", 
‹¡_qu”y
, 
TEST_CONNECTION_DEFAULT
, 
CLIENT_MULTI_RESULTS
 , 
NULL
 , NULL},

493 {"‹¡_¥_·¿ms", 
‹¡_¥_·¿ms
, 
TEST_CONNECTION_DEFAULT
, 
CLIENT_MULTI_STATEMENTS
, 
NULL
 , NULL},

494 {"‹¡_¥_»£t", 
‹¡_¥_»£t
, 
TEST_CONNECTION_DEFAULT
, 
CLIENT_MULTI_STATEMENTS
, 
NULL
 , NULL},

495 {"‹¡_¥_»£t1", 
‹¡_¥_»£t1
, 
TEST_CONNECTION_DEFAULT
, 
CLIENT_MULTI_STATEMENTS
, 
NULL
 , NULL},

496 {"‹¡_¥_»£t2", 
‹¡_¥_»£t2
, 
TEST_CONNECTION_DEFAULT
, 
CLIENT_MULTI_STATEMENTS
, 
NULL
 , NULL},

497 {"‹¡_muÉi_»suÉ", 
‹¡_muÉi_»suÉ
, 
TEST_CONNECTION_DEFAULT
, 
CLIENT_MULTI_STATEMENTS
, 
NULL
 , NULL},

498 {
NULL
, NULL, 0, 0, NULL, NULL}

501 
	$maš
(
¬gc
, **
¬gv
)

503 ià(
¬gc
 > 1)

504 
	`g‘_ÝtiÚs
(
¬gc
, 
¬gv
);

506 
	`g‘_’vv¬s
();

508 
	`run_‹¡s
(
my_‹¡s
);

510 (
	`ex™_¡©us
());

511 
	}
}

	@unittest/libmariadb/result.c

28 
	~"my_‹¡.h
"

30 
	$þ›Á_¡Üe_»suÉ
(
MYSQL
 *
mysql
)

32 
MYSQL_RES
 *
»suÉ
;

33 
rc
, 
rowcouÁ
= 0;

35 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT 'foo' FROM DUAL UNION SELECT 'bar' FROM DUAL");

36 
	`check_mysql_rc
(
rc
, 
mysql
);

39 
»suÉ
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

40 
	`FAIL_IF
(!
»suÉ
, "Invalid„esult set");

43 
rc
ð
	`mysql_pšg
(
mysql
);

44 
	`FAIL_IF
(
rc
, "mysql_ping failed");

46 
	`mysql_ãtch_row
(
»suÉ
))

47 
rowcouÁ
++;

49 
	`FAIL_IF
(
rowcouÁ
 != 2, "rowcount != 2");

51 
	`mysql_ä“_»suÉ
(
»suÉ
);

53  
OK
;

54 
	}
}

56 
	$þ›Á_u£_»suÉ
(
MYSQL
 *
mysql
)

58 
MYSQL_RES
 *
»suÉ
;

59 
rc
, 
rowcouÁ
= 0;

61 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT 'foo' FROM DUAL UNION SELECT 'bar' FROM DUAL");

62 
	`check_mysql_rc
(
rc
, 
mysql
);

65 
»suÉ
ð
	`mysql_u£_»suÉ
(
mysql
);

66 
	`FAIL_IF
(!
»suÉ
, "Invalid„esult set");

69 
rc
ð
	`mysql_pšg
(
mysql
);

70 
	`FAIL_IF
(!
rc
, "Errorƒxpected");

72 
	`mysql_ãtch_row
(
»suÉ
))

73 
rowcouÁ
++;

75 
	`FAIL_IF
(
rowcouÁ
 != 2, "rowcount != 2");

77 
	`mysql_ä“_»suÉ
(
»suÉ
);

79  
OK
;

80 
	}
}

82 
	$‹¡_ä“_»suÉ
(
MYSQL
 *
mysql
)

84 
MYSQL_STMT
 *
¡mt
;

85 
MYSQL_BIND
 
my_bšd
[1];

86 
c2
[5];

87 
ulÚg
 
bl1
, 
l2
;

88 
rc
, 
c1
, 
bc1
;

89 
qu”y
[
MAX_TEST_QUERY_LENGTH
];

91 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxistsest_free_result");

92 
	`check_mysql_rc
(
rc
, 
mysql
);

94 
rc
ð
	`mysql_qu”y
(
mysql
, "createableest_free_result("

96 
	`check_mysql_rc
(
rc
, 
mysql
);

98 
rc
ð
	`mysql_qu”y
(
mysql
, "insert intoest_free_result values(), (), ()");

99 
	`check_mysql_rc
(
rc
, 
mysql
);

101 
	`¡rýy
(
qu”y
, "select * fromest_free_result");

102 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

103 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

104 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

105 
	`check_¡mt_rc
(
rc
, 
¡mt
);

107 
	`mem£t
(
my_bšd
, '\0', (my_bind));

108 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

109 
my_bšd
[0].
bufãr
ð(*)&
bc1
;

110 
my_bšd
[0].
Ëngth
ð&
bl1
;

112 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

113 
	`check_¡mt_rc
(
rc
, 
¡mt
);

115 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

116 
	`check_¡mt_rc
(
rc
, 
¡mt
);

118 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

119 
	`check_¡mt_rc
(
rc
, 
¡mt
);

121 
c2
[0]ð'\0'; 
l2
= 0;

122 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

123 
my_bšd
[0].
bufãr
ð(*)
c2
;

124 
my_bšd
[0].
bufãr_Ëngth
= 7;

125 
my_bšd
[0].
is_nuÎ
= 0;

126 
my_bšd
[0].
Ëngth
ð&
l2
;

128 
rc
ð
	`mysql_¡mt_ãtch_cÞumn
(
¡mt
, 
my_bšd
, 0, 0);

129 
	`check_¡mt_rc
(
rc
, 
¡mt
);

130 
	`FAIL_UNLESS
(
	`¡ºcmp
(
c2
, "1", 1) == 0, "c2 != '1'");

131 
	`FAIL_UNLESS
(
l2
 == 1, "l2 != 1");

133 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

134 
	`check_¡mt_rc
(
rc
, 
¡mt
);

136 
c1
ð0, 
l2
= 0;

137 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

138 
my_bšd
[0].
bufãr
ð(*)&
c1
;

139 
my_bšd
[0].
bufãr_Ëngth
= 0;

140 
my_bšd
[0].
is_nuÎ
= 0;

141 
my_bšd
[0].
Ëngth
ð&
l2
;

143 
rc
ð
	`mysql_¡mt_ãtch_cÞumn
(
¡mt
, 
my_bšd
, 0, 0);

144 
	`check_¡mt_rc
(
rc
, 
¡mt
);

145 
	`FAIL_UNLESS
(
c1
 == 2, "c1 != 2");

146 
	`FAIL_UNLESS
(
l2
 == 4, "l2 != 4");

148 
rc
ð
	`mysql_qu”y
(
mysql
, "dropableest_free_result");

149 
	`FAIL_IF
(!
rc
, "Error commands out of syncƒxpected");

151 
rc
ð
	`mysql_¡mt_ä“_»suÉ
(
¡mt
);

152 
	`check_¡mt_rc
(
rc
, 
¡mt
);

154 
rc
ð
	`mysql_qu”y
(
mysql
, "dropableest_free_result");

155 
	`check_mysql_rc
(
rc
, 
mysql
);

157 
	`mysql_¡mt_þo£
(
¡mt
);

159  
OK
;

160 
	}
}

165 
	$‹¡_ä“_¡Üe_»suÉ
(
MYSQL
 *
mysql
)

167 
MYSQL_STMT
 *
¡mt
;

168 
MYSQL_BIND
 
my_bšd
[1];

169 
c2
[5];

170 
ulÚg
 
bl1
, 
l2
;

171 
rc
, 
c1
, 
bc1
;

172 
qu”y
[
MAX_TEST_QUERY_LENGTH
];

174 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxistsest_free_result");

175 
	`check_mysql_rc
(
rc
, 
mysql
);

177 
rc
ð
	`mysql_qu”y
(
mysql
, "createableest_free_result(c1 int…rimary key‡uto_increment)");

178 
	`check_mysql_rc
(
rc
, 
mysql
);

180 
rc
ð
	`mysql_qu”y
(
mysql
, "insert intoest_free_result values(), (), ()");

181 
	`check_mysql_rc
(
rc
, 
mysql
);

183 
	`¡rýy
(
qu”y
, "select * fromest_free_result");

184 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

185 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

186 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

187 
	`check_¡mt_rc
(
rc
, 
¡mt
);

189 
	`mem£t
(
my_bšd
, '\0', (my_bind));

190 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

191 
my_bšd
[0].
bufãr
ð(*)&
bc1
;

192 
my_bšd
[0].
bufãr_Ëngth
= 0;

193 
my_bšd
[0].
is_nuÎ
= 0;

194 
my_bšd
[0].
Ëngth
ð&
bl1
;

196 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

197 
	`check_¡mt_rc
(
rc
, 
¡mt
);

199 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

200 
	`check_¡mt_rc
(
rc
, 
¡mt
);

202 
rc
ð
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

203 
	`check_¡mt_rc
(
rc
, 
¡mt
);

205 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

206 
	`check_¡mt_rc
(
rc
, 
¡mt
);

208 
c2
[0]ð'\0'; 
l2
= 0;

209 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

210 
my_bšd
[0].
bufãr
ð(*)
c2
;

211 
my_bšd
[0].
bufãr_Ëngth
= 7;

212 
my_bšd
[0].
is_nuÎ
= 0;

213 
my_bšd
[0].
Ëngth
ð&
l2
;

215 
rc
ð
	`mysql_¡mt_ãtch_cÞumn
(
¡mt
, 
my_bšd
, 0, 0);

216 
	`check_¡mt_rc
(
rc
, 
¡mt
);

217 
	`FAIL_UNLESS
(
	`¡ºcmp
(
c2
, "1", 1) == 0, "c2 != '1'");

218 
	`FAIL_UNLESS
(
l2
 == 1, "l2 != 1");

220 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

221 
	`check_¡mt_rc
(
rc
, 
¡mt
);

223 
c1
ð0, 
l2
= 0;

224 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

225 
my_bšd
[0].
bufãr
ð(*)&
c1
;

226 
my_bšd
[0].
bufãr_Ëngth
= 0;

227 
my_bšd
[0].
is_nuÎ
= 0;

228 
my_bšd
[0].
Ëngth
ð&
l2
;

230 
rc
ð
	`mysql_¡mt_ãtch_cÞumn
(
¡mt
, 
my_bšd
, 0, 0);

231 
	`check_¡mt_rc
(
rc
, 
¡mt
);

232 
	`FAIL_UNLESS
(
c1
 == 2, "c1 != 2");

233 
	`FAIL_UNLESS
(
l2
 == 4, "l2 != 4");

235 
rc
ð
	`mysql_¡mt_ä“_»suÉ
(
¡mt
);

236 
	`check_¡mt_rc
(
rc
, 
¡mt
);

238 
rc
ð
	`mysql_qu”y
(
mysql
, "dropableest_free_result");

239 
	`check_mysql_rc
(
rc
, 
mysql
);

241 
	`mysql_¡mt_þo£
(
¡mt
);

243  
OK
;

244 
	}
}

246 
	$‹¡_¡Üe_»suÉ
(
MYSQL
 *
mysql
)

248 
MYSQL_STMT
 *
¡mt
;

249 
rc
;

250 
št32
 
nD©a
;

251 
szD©a
[100];

252 
MYSQL_BIND
 
my_bšd
[2];

253 
ulÚg
 
Ëngth
, 
Ëngth1
;

254 
my_boÞ
 
is_nuÎ
[2];

255 
qu”y
[
MAX_TEST_QUERY_LENGTH
];

257 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_store_result");

258 
	`check_mysql_rc
(
rc
, 
mysql
);

260 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_store_result(col1 int , col2 varchar(50))");

261 
	`check_mysql_rc
(
rc
, 
mysql
);

263 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTOest_store_result VALUES(10, 'venu'), (20, 'mysql')");

264 
	`check_mysql_rc
(
rc
, 
mysql
);

266 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTOest_store_result(col2) VALUES('monty')");

267 
	`check_mysql_rc
(
rc
, 
mysql
);

269 
rc
ð
	`mysql_comm™
(
mysql
);

270 
	`check_mysql_rc
(
rc
, 
mysql
);

273 
	`mem£t
(
my_bšd
, '\0', (my_bind));

274 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

275 
my_bšd
[0].
bufãr
ð(*è&
nD©a
;

276 
my_bšd
[0].
Ëngth
= &length;

277 
my_bšd
[0].
is_nuÎ
= &is_null[0];

279 
Ëngth
= 0;

280 
my_bšd
[1].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

281 
my_bšd
[1].
bufãr
ð
szD©a
;

282 
my_bšd
[1].
bufãr_Ëngth
ð(
szD©a
);

283 
my_bšd
[1].
Ëngth
ð&
Ëngth1
;

284 
my_bšd
[1].
is_nuÎ
= &is_null[1];

285 
Ëngth1
= 0;

287 
	`¡rýy
(
qu”y
, "SELECT * FROMest_store_result");

288 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

289 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

290 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

291 
	`check_¡mt_rc
(
rc
, 
¡mt
);

293 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

294 
	`check_¡mt_rc
(
rc
, 
¡mt
);

296 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

297 
	`check_¡mt_rc
(
rc
, 
¡mt
);

299 
rc
ð
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

300 
	`check_¡mt_rc
(
rc
, 
¡mt
);

302 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

303 
	`check_¡mt_rc
(
rc
, 
¡mt
);

305 
	`FAIL_UNLESS
(
nD©a
 == 10, "nData != 10");

306 
	`FAIL_UNLESS
(
	`¡rcmp
(
szD©a
, "venu") == 0, "szData != 'Venu'");

307 
	`FAIL_UNLESS
(
Ëngth1
 == 4, "length1 != 4");

309 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

310 
	`check_¡mt_rc
(
rc
, 
¡mt
);

312 
	`FAIL_UNLESS
(
nD©a
 == 20, "nData != 20");

313 
	`FAIL_UNLESS
(
	`¡rcmp
(
szD©a
, "mysql") == 0, "szDaza != 'mysql'");

314 
	`FAIL_UNLESS
(
Ëngth1
 == 5, "length1 != 5");

316 
Ëngth
= 99;

317 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

318 
	`check_¡mt_rc
(
rc
, 
¡mt
);

320 
	`FAIL_UNLESS
(
is_nuÎ
[0], "isnull set");

321 
	`FAIL_UNLESS
(
	`¡rcmp
(
szD©a
, "monty") == 0, "szData != 'monty'");

322 
	`FAIL_UNLESS
(
Ëngth1
 == 5, "length1 != 5");

324 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

325 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

327 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

328 
	`check_¡mt_rc
(
rc
, 
¡mt
);

330 
rc
ð
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

331 
	`check_¡mt_rc
(
rc
, 
¡mt
);

333 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

334 
	`check_¡mt_rc
(
rc
, 
¡mt
);

336 
	`FAIL_UNLESS
(
nD©a
 == 10, "nData != 10");

337 
	`FAIL_UNLESS
(
	`¡rcmp
(
szD©a
, "venu") == 0, "szData != 'Venu'");

338 
	`FAIL_UNLESS
(
Ëngth1
 == 4, "length1 != 4");

340 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

341 
	`check_¡mt_rc
(
rc
, 
¡mt
);

343 
	`FAIL_UNLESS
(
nD©a
 == 20, "nData != 20");

344 
	`FAIL_UNLESS
(
	`¡rcmp
(
szD©a
, "mysql") == 0, "szDaza != 'mysql'");

345 
	`FAIL_UNLESS
(
Ëngth1
 == 5, "length1 != 5");

347 
Ëngth
= 99;

348 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

349 
	`check_¡mt_rc
(
rc
, 
¡mt
);

351 
	`FAIL_UNLESS
(
is_nuÎ
[0], "isnull set");

352 
	`FAIL_UNLESS
(
	`¡rcmp
(
szD©a
, "monty") == 0, "szData != 'monty'");

353 
	`FAIL_UNLESS
(
Ëngth1
 == 5, "length1 != 5");

355 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

356 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

358 
	`mysql_¡mt_þo£
(
¡mt
);

359 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_store_result");

360 
	`check_mysql_rc
(
rc
, 
mysql
);

362  
OK
;

363 
	}
}

368 
	$‹¡_¡Üe_»suÉ1
(
MYSQL
 *
mysql
)

370 
MYSQL_STMT
 *
¡mt
;

371 
rc
;

372 
qu”y
[
MAX_TEST_QUERY_LENGTH
];

374 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_store_result");

375 
	`check_mysql_rc
(
rc
, 
mysql
);

377 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_store_result(col1 int , col2 varchar(50))");

378 
	`check_mysql_rc
(
rc
, 
mysql
);

380 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTOest_store_result VALUES(10, 'venu'), (20, 'mysql')");

381 
	`check_mysql_rc
(
rc
, 
mysql
);

383 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTOest_store_result(col2) VALUES('monty')");

384 
	`check_mysql_rc
(
rc
, 
mysql
);

386 
rc
ð
	`mysql_comm™
(
mysql
);

387 
	`check_mysql_rc
(
rc
, 
mysql
);

389 
	`¡rýy
(
qu”y
, "SELECT * FROMest_store_result");

390 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

391 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

392 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

393 
	`check_¡mt_rc
(
rc
, 
¡mt
);

395 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

396 
	`check_¡mt_rc
(
rc
, 
¡mt
);

398 
rc
ð
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

399 
	`check_¡mt_rc
(
rc
, 
¡mt
);

401 
rc
= 0;

402 
	`mysql_¡mt_ãtch
(
¡mt
è!ð
MYSQL_NO_DATA
)

403 
rc
++;

404 
	`FAIL_UNLESS
(
rc
 == 3, "rowcount != 3");

406 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

407 
	`check_¡mt_rc
(
rc
, 
¡mt
);

409 
rc
ð
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

410 
	`check_¡mt_rc
(
rc
, 
¡mt
);

412 
rc
= 0;

413 
	`mysql_¡mt_ãtch
(
¡mt
è!ð
MYSQL_NO_DATA
)

414 
rc
++;

415 
	`FAIL_UNLESS
(
rc
 == 3, "rowcount != 3");

417 
	`mysql_¡mt_þo£
(
¡mt
);

418 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_store_result");

419 
	`check_mysql_rc
(
rc
, 
mysql
);

421  
OK
;

422 
	}
}

427 
	$‹¡_¡Üe_»suÉ2
(
MYSQL
 *
mysql
)

429 
MYSQL_STMT
 *
¡mt
;

430 
rc
;

431 
nD©a
;

432 
ulÚg
 
Ëngth
;

433 
MYSQL_BIND
 
my_bšd
[1];

434 
qu”y
[
MAX_TEST_QUERY_LENGTH
];

436 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_store_result");

437 
	`check_mysql_rc
(
rc
, 
mysql
);

439 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_store_result(col1 int , col2 varchar(50))");

440 
	`check_mysql_rc
(
rc
, 
mysql
);

442 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTOest_store_result VALUES(10, 'venu'), (20, 'mysql')");

443 
	`check_mysql_rc
(
rc
, 
mysql
);

445 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTOest_store_result(col2) VALUES('monty')");

446 
	`check_mysql_rc
(
rc
, 
mysql
);

448 
rc
ð
	`mysql_comm™
(
mysql
);

449 
	`check_mysql_rc
(
rc
, 
mysql
);

451 
	`mem£t
(
my_bšd
, '\0', (my_bind));

453 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_LONG
;

454 
my_bšd
[0].
bufãr
ð(*è&
nD©a
;

455 
my_bšd
[0].
Ëngth
= &length;

456 
my_bšd
[0].
is_nuÎ
= 0;

458 
	`¡rýy
((*)
qu”y
 , "SELECT col1 FROMest_store_result where col1= ?");

459 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

460 
	`FAIL_IF
(!
¡mt
, 
	`mysql_”rÜ
(
mysql
));

461 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

462 
	`check_¡mt_rc
(
rc
, 
¡mt
);

464 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

465 
	`check_¡mt_rc
(
rc
, 
¡mt
);

467 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

468 
	`check_¡mt_rc
(
rc
, 
¡mt
);

470 
nD©a
ð10; 
Ëngth
= 0;

471 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

472 
	`check_¡mt_rc
(
rc
, 
¡mt
);

474 
nD©a
= 0;

475 
rc
ð
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

476 
	`check_¡mt_rc
(
rc
, 
¡mt
);

478 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

479 
	`check_¡mt_rc
(
rc
, 
¡mt
);

481 
	`FAIL_UNLESS
(
nD©a
 == 10, "nData != 10");

483 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

484 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

486 
nD©a
= 20;

487 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

488 
	`check_¡mt_rc
(
rc
, 
¡mt
);

490 
nD©a
= 0;

491 
rc
ð
	`mysql_¡mt_¡Üe_»suÉ
(
¡mt
);

492 
	`check_¡mt_rc
(
rc
, 
¡mt
);

494 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

495 
	`check_¡mt_rc
(
rc
, 
¡mt
);

497 
	`FAIL_UNLESS
(
nD©a
 == 20, "nData != 20");

499 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

500 
	`FAIL_UNLESS
(
rc
 =ð
MYSQL_NO_DATA
, "rc != MYSQL_NO_DATA");

501 
	`mysql_¡mt_þo£
(
¡mt
);

502 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_store_result");

503 
	`check_mysql_rc
(
rc
, 
mysql
);

505  
OK
;

506 
	}
}

508 
	$‹¡_bug11718
(
MYSQL
 *
mysql
)

510 
MYSQL_RES
 *
»s
;

511 
rc
;

512 cÚ¡ *
qu”y
= "select str_to_date(concat(f3),'%Y%m%d') from1,t2 "

515 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxists1,2");

516 
	`check_mysql_rc
(
rc
, 
mysql
);

517 
rc
ð
	`mysql_qu”y
(
mysql
, "createable1 (f1 int)");

518 
	`check_mysql_rc
(
rc
, 
mysql
);

519 
rc
ð
	`mysql_qu”y
(
mysql
, "createable2 (f2 int, f3‚umeric(8))");

520 
	`check_mysql_rc
(
rc
, 
mysql
);

521 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into1 values (1), (2)");

522 
	`check_mysql_rc
(
rc
, 
mysql
);

523 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into2 values (1,20050101), (2,20050202)");

524 
	`check_mysql_rc
(
rc
, 
mysql
);

525 
rc
ð
	`mysql_qu”y
(
mysql
, 
qu”y
);

526 
	`check_mysql_rc
(
rc
, 
mysql
);

527 
»s
 = 
	`mysql_¡Üe_»suÉ
(
mysql
);

529 
	`FAIL_UNLESS
(
»s
->
f›lds
[0].
ty³
 =ð
MYSQL_TYPE_DATE
, "type != MYSQL_TYPE_DATE");

530 
	`mysql_ä“_»suÉ
(
»s
);

531 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable1,2");

532 
	`check_mysql_rc
(
rc
, 
mysql
);

534  
OK
;

535 
	}
}

537 
	$‹¡_bug19671
(
MYSQL
 *
mysql
)

539 
MYSQL_RES
 *
»suÉ
;

540 
rc
;

542 
	`mysql_qu”y
(
mysql
, "set sql_mode=''");

543 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxists1");

544 
	`check_mysql_rc
(
rc
, 
mysql
);

546 
rc
ð
	`mysql_qu”y
(
mysql
, "drop view ifƒxists v1");

547 
	`check_mysql_rc
(
rc
, 
mysql
);

549 
rc
ð
	`mysql_qu”y
(
mysql
, "createable1(f1 int)");

550 
	`check_mysql_rc
(
rc
, 
mysql
);

552 
rc
ð
	`mysql_qu”y
(
mysql
, "create view v1‡s select va.* from1 va");

553 
	`check_mysql_rc
(
rc
, 
mysql
);

555 
»suÉ
ð
	`mysql_li¡_f›lds
(
mysql
, "v1", 
NULL
);

556 
	`FAIL_IF
(!
»suÉ
, "Invalid„esult set");

558 
rc
= 0;

559 
	`mysql_ãtch_row
(
»suÉ
))

560 
rc
++;

561 
	`FAIL_UNLESS
(
rc
 == 0, "");

563 ià(
	`v”ify_´•¬e_f›ld
(
»suÉ
, 0, "f1", "f1", 
MYSQL_TYPE_LONG
,

564 "v1", "v1", 
schema
, 11, "0")) {

565 
	`mysql_ä“_»suÉ
(
»suÉ
);

566 
	`dŸg
("verify_prepare_field failed");

567  
FAIL
;

570 
	`mysql_ä“_»suÉ
(
»suÉ
);

571 
	`check_mysql_rc
(
	`mysql_qu”y
(
mysql
, "drop view v1"), mysql);

572 
	`check_mysql_rc
(
	`mysql_qu”y
(
mysql
, "dropable1"), mysql);

573  
OK
;

574 
	}
}

585 
	$‹¡_bug21726
(
MYSQL
 *
mysql
)

587 cÚ¡ *
ü—‹_bË
[]=

593 cÚ¡ *
upd©e_qu”y
= "UPDATE1 SET i= LAST_INSERT_ID(i + 1)";

594 
rc
;

595 
š£¹_id
;

596 cÚ¡ *
£Ëù_qu”y
= "SELECT * FROM1";

597 
MYSQL_RES
 *
»suÉ
;

599 
rc
ð
	`mysql_qu”y
(
mysql
, 
ü—‹_bË
[0]);

600 
	`check_mysql_rc
(
rc
, 
mysql
);

601 
rc
ð
	`mysql_qu”y
(
mysql
, 
ü—‹_bË
[1]);

602 
	`check_mysql_rc
(
rc
, 
mysql
);

603 
rc
ð
	`mysql_qu”y
(
mysql
, 
ü—‹_bË
[2]);

604 
	`check_mysql_rc
(
rc
, 
mysql
);

606 
rc
ð
	`mysql_qu”y
(
mysql
, 
upd©e_qu”y
);

607 
	`check_mysql_rc
(
rc
, 
mysql
);

608 
š£¹_id
ð
	`mysql_š£¹_id
(
mysql
);

609 
	`FAIL_UNLESS
(
š£¹_id
 == 2, "insert_id != 2");

611 
rc
ð
	`mysql_qu”y
(
mysql
, 
upd©e_qu”y
);

612 
	`check_mysql_rc
(
rc
, 
mysql
);

613 
š£¹_id
ð
	`mysql_š£¹_id
(
mysql
);

614 
	`FAIL_UNLESS
(
š£¹_id
 == 3, "insert_id != 3");

616 
rc
ð
	`mysql_qu”y
(
mysql
, 
£Ëù_qu”y
);

617 
	`check_mysql_rc
(
rc
, 
mysql
);

618 
š£¹_id
ð
	`mysql_š£¹_id
(
mysql
);

619 
	`FAIL_UNLESS
(
š£¹_id
 == 3, "insert_id != 3");

620 
»suÉ
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

621 
	`mysql_ä“_»suÉ
(
»suÉ
);

623  
OK
;

624 
	}
}

628 
	$‹¡_bug6761
(
MYSQL
 *
mysql
)

630 cÚ¡ *
¡mt_‹xt
;

631 
MYSQL_RES
 *
»s
;

632 
rc
;

634 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

635 
	`check_mysql_rc
(
rc
, 
mysql
);

637 
¡mt_‹xt
= "CREATE TABLE1 (a int, b char(255), c decimal)";

638 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
¡mt_‹xt
, ()
	`¡¾’
(stmt_text));

639 
	`check_mysql_rc
(
rc
, 
mysql
);

641 
»s
ð
	`mysql_li¡_f›lds
(
mysql
, "t1", "%");

642 
	`FAIL_UNLESS
(
»s
 && 
	`mysql_num_f›lds
(res) == 3, "num_fields != 3");

643 
	`mysql_ä“_»suÉ
(
»s
);

645 
¡mt_‹xt
= "DROP TABLE1";

646 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
¡mt_‹xt
, ()
	`¡¾’
(stmt_text));

647 
	`check_mysql_rc
(
rc
, 
mysql
);

648  
OK
;

649 
	}
}

653 
	$‹¡_f›ld_æags
(
MYSQL
 *
mysql
)

655 
rc
;

656 
MYSQL_RES
 *
»suÉ
;

657 
MYSQL_FIELD
 *
f›ld
;

659 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_field_flags");

660 
	`check_mysql_rc
(
rc
, 
mysql
);

662 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_field_flags(id int NOT NULL AUTO_INCREMENT PRIMARY KEY, \
1 int NOT NULL, \
2 int UNIQUE, \
3 int, \
4 int NOT NULL, \
5 int, \
(id3, id4))");

669 
	`check_mysql_rc
(
rc
, 
mysql
);

672 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT * FROMest_field_flags");

673 
	`check_mysql_rc
(
rc
, 
mysql
);

675 
»suÉ
ð
	`mysql_u£_»suÉ
(
mysql
);

676 
	`FAIL_IF
(!
»suÉ
, "Invalid„esult set");

678 
	`mysql_f›ld_£ek
(
»suÉ
, 0);

680 
f›ld
ð
	`mysql_ãtch_f›ld
(
»suÉ
);

681 
	`FAIL_UNLESS
(
f›ld
->
æags
 & 
NOT_NULL_FLAG
 &&

682 
f›ld
->
æags
 & 
PRI_KEY_FLAG
 &&

683 
f›ld
->
æags
 & 
AUTO_INCREMENT_FLAG
, "Wrong flags for field 0");

685 
f›ld
ð
	`mysql_ãtch_f›ld
(
»suÉ
);

686 
	`FAIL_UNLESS
(
f›ld
->
æags
 & 
NOT_NULL_FLAG
, "Wrong flags for field 1");

688 
f›ld
ð
	`mysql_ãtch_f›ld
(
»suÉ
);

689 
	`FAIL_UNLESS
(
f›ld
->
æags
 & 
UNIQUE_KEY_FLAG
, "Wrong flags for field 2");

691 
f›ld
ð
	`mysql_ãtch_f›ld
(
»suÉ
);

692 
	`FAIL_UNLESS
(
f›ld
->
æags
 & 
MULTIPLE_KEY_FLAG
, "Wrong flags for field 3");

694 
f›ld
ð
	`mysql_ãtch_f›ld
(
»suÉ
);

695 
	`FAIL_UNLESS
(
f›ld
->
æags
 & 
NOT_NULL_FLAG
, "Wrong flags for field 4");

697 
	`mysql_ä“_»suÉ
(
»suÉ
);

698 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_field_flags");

699 
	`check_mysql_rc
(
rc
, 
mysql
);

700  
OK
;

701 
	}
}

705 
	$‹¡_f›ld_Çmes
(
MYSQL
 *
mysql
)

707 
rc
;

708 
MYSQL_RES
 *
»suÉ
;

711 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_field_names1");

712 
	`check_mysql_rc
(
rc
, 
mysql
);

714 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_field_names2");

715 
	`check_mysql_rc
(
rc
, 
mysql
);

717 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_field_names1(id int,‚ame varchar(50))");

718 
	`check_mysql_rc
(
rc
, 
mysql
);

720 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_field_names2(id int,‚ame varchar(50))");

721 
	`check_mysql_rc
(
rc
, 
mysql
);

724 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT id‡s 'id-alias' FROMest_field_names1");

725 
	`check_mysql_rc
(
rc
, 
mysql
);

727 
»suÉ
ð
	`mysql_u£_»suÉ
(
mysql
);

728 
	`FAIL_IF
(!
»suÉ
, "Invalid„esult set");

730 
rc
= 0;

731 
	`mysql_ãtch_row
(
»suÉ
))

732 
rc
++;

733 
	`FAIL_UNLESS
(
rc
 == 0, "rowcount != 0");

734 
	`mysql_ä“_»suÉ
(
»suÉ
);

737 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT1.id‡s 'id-alias',est_field_names2.name FROMest_field_names11,est_field_names2");

738 
	`check_mysql_rc
(
rc
, 
mysql
);

740 
»suÉ
ð
	`mysql_u£_»suÉ
(
mysql
);

741 
	`FAIL_IF
(!
»suÉ
, "Invalid„esult set");

743 
rc
= 0;

744 
	`mysql_ãtch_row
(
»suÉ
))

745 
rc
++;

746 
	`FAIL_UNLESS
(
rc
 == 0, "rowcount != 0");

747 
	`mysql_ä“_»suÉ
(
»suÉ
);

748 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_field_names1");

749 
	`check_mysql_rc
(
rc
, 
mysql
);

751 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_field_names2");

752 
	`check_mysql_rc
(
rc
, 
mysql
);

753  
OK
;

754 
	}
}

758 
	$‹¡_func_f›lds
(
MYSQL
 *
mysql
)

760 
rc
;

761 
MYSQL_RES
 *
»suÉ
;

762 
MYSQL_FIELD
 *
f›ld
;

765 
rc
ð
	`mysql_autocomm™
(
mysql
, 
TRUE
);

766 
	`check_mysql_rc
(
rc
, 
mysql
);

768 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_dateformat");

769 
	`check_mysql_rc
(
rc
, 
mysql
);

771 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEest_dateformat(id int, \
imestamp)");

773 
	`check_mysql_rc
(
rc
, 
mysql
);

775 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTOest_dateformat(id) values(10)");

776 
	`check_mysql_rc
(
rc
, 
mysql
);

778 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECTs FROMest_dateformat");

779 
	`check_mysql_rc
(
rc
, 
mysql
);

781 
»suÉ
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

782 
	`FAIL_IF
(!
»suÉ
, "Invalid„esult set");

784 
f›ld
ð
	`mysql_ãtch_f›ld
(
»suÉ
);

785 
	`FAIL_IF
(!
f›ld
, "Invalid field");

786 
	`FAIL_UNLESS
(
	`¡rcmp
(
f›ld
->
bË
, "test_dateformat") == 0, "field->table != 'test_dateformat'");

788 
f›ld
ð
	`mysql_ãtch_f›ld
(
»suÉ
);

789 
	`FAIL_IF
(
f›ld
, "no more fieldsƒxpected");

791 
	`mysql_ä“_»suÉ
(
»suÉ
);

794 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT DATE_FORMAT(ts, '%Y') AS 'venu' FROMest_dateformat");

795 
	`check_mysql_rc
(
rc
, 
mysql
);

797 
»suÉ
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

798 
	`FAIL_IF
(!
»suÉ
, "Invalid„esult set");

800 
f›ld
ð
	`mysql_ãtch_f›ld
(
»suÉ
);

801 
	`FAIL_IF
(!
f›ld
, "Invalid field");

802 
	`FAIL_UNLESS
(
f›ld
->
bË
[0] == '\0', "field->table != ''");

804 
f›ld
ð
	`mysql_ãtch_f›ld
(
»suÉ
);

805 
	`FAIL_IF
(
f›ld
, "no more fieldsƒxpected");

807 
	`mysql_ä“_»suÉ
(
»suÉ
);

810 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT DATE_FORMAT(ts, '%Y') AS 'YEAR' FROMest_dateformat");

811 
	`check_mysql_rc
(
rc
, 
mysql
);

813 
»suÉ
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

814 
	`FAIL_IF
(!
»suÉ
, "Invalid„esult set");

816 
f›ld
ð
	`mysql_ãtch_f›ld
(
»suÉ
);

817 
	`FAIL_IF
(!
f›ld
, "Invalid field");

818 
	`FAIL_UNLESS
(
	`¡rcmp
(
f›ld
->
Çme
, "YEAR") == 0, "name != 'YEAR'");

819 
	`FAIL_UNLESS
(
f›ld
->
Üg_Çme
[0] == '\0', "org_name != ''");

821 
f›ld
ð
	`mysql_ãtch_f›ld
(
»suÉ
);

822 
	`FAIL_IF
(
f›ld
, "no more fieldsƒxpected");

824 
	`mysql_ä“_»suÉ
(
»suÉ
);

825 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSest_dateformat");

826 
	`check_mysql_rc
(
rc
, 
mysql
);

827  
OK
;

828 
	}
}

832 
	$‹¡_li¡_f›lds
(
MYSQL
 *
mysql
)

834 
MYSQL_RES
 *
»suÉ
;

835 
rc
;

837 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxists1");

838 
	`check_mysql_rc
(
rc
, 
mysql
);

840 
rc
ð
	`mysql_qu”y
(
mysql
, "createable1(c1 int…rimary key‡uto_increment, c2 char(10) default 'mysql')");

841 
	`check_mysql_rc
(
rc
, 
mysql
);

843 
»suÉ
ð
	`mysql_li¡_f›lds
(
mysql
, "t1", 
NULL
);

844 
	`FAIL_IF
(!
»suÉ
, "Invalid„esult set");

846 
rc
= 0;

847 
	`mysql_ãtch_row
(
»suÉ
))

848 
rc
++;

849 
	`FAIL_UNLESS
(
rc
 == 0, "rowcount != 0");

851 ià(
	`v”ify_´•¬e_f›ld
(
»suÉ
, 0, "c1", "c1", 
MYSQL_TYPE_LONG
,

853 
schema
, 11, "0"))

854 
”rÜ
;

856 ià(
	`v”ify_´•¬e_f›ld
(
»suÉ
, 1, "c2", "c2", 
MYSQL_TYPE_STRING
,

858 
schema
, 10, "mysql"))

859 
”rÜ
;

861 
	`mysql_ä“_»suÉ
(
»suÉ
);

862 
	`check_mysql_rc
(
	`mysql_qu”y
(
mysql
, "dropable1"), mysql);

863  
OK
;

865 
”rÜ
:

866 
	`mysql_ä“_»suÉ
(
»suÉ
);

867 
	`check_mysql_rc
(
	`mysql_qu”y
(
mysql
, "dropable1"), mysql);

868  
FAIL
;

869 
	}
}

873 
	$‹¡_bug9735
(
MYSQL
 *
mysql
)

875 
MYSQL_RES
 *
»s
;

876 
rc
;

879 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxists1");

880 
	`check_mysql_rc
(
rc
, 
mysql
);

881 
rc
ð
	`mysql_qu”y
(
mysql
, "createable1 (a mediumtext, b†ongtext) "

883 
	`check_mysql_rc
(
rc
, 
mysql
);

884 
rc
ð
	`mysql_qu”y
(
mysql
, "select * from1");

885 
	`check_mysql_rc
(
rc
, 
mysql
);

886 
»s
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

887 ià(
	`v”ify_´•¬e_f›ld
(
»s
, 0, "a", "a", 
MYSQL_TYPE_BLOB
,

888 "t1", "t1", 
schema
, (1U << 24)-1, 0))

889 
”rÜ
;

890 ià(
	`v”ify_´•¬e_f›ld
(
»s
, 1, "b", "b", 
MYSQL_TYPE_BLOB
,

891 "t1", "t1", 
schema
, ~0U, 0))

892 
”rÜ
;

893 
	`mysql_ä“_»suÉ
(
»s
);

894 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable1");

895 
	`check_mysql_rc
(
rc
, 
mysql
);

896  
OK
;

897 
”rÜ
:

898 
	`mysql_ä“_»suÉ
(
»s
);

899 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable1");

900  
FAIL
;

901 
	}
}

908 
	$‹¡_bug9992
(
MYSQL
 *
mysql
)

910 
MYSQL_RES
* 
»s
 ;

911 
rc
;

914 
rc
ð
	`mysql_qu”y
(
mysql
, "SHOW TABLES; SHOW DATABASE; SELECT 1;");

915 
	`check_mysql_rc
(
rc
, 
mysql
);

917 
»s
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

918 
	`FAIL_UNLESS
(
»s
, "Invalid„esultset");

919 
	`mysql_ä“_»suÉ
(
»s
);

920 
rc
ð
	`mysql_Ãxt_»suÉ
(
mysql
);

921 
	`FAIL_UNLESS
(
rc
 == 1, "Errorƒxpected");

923  
OK
;

924 
	}
}

928 
	$‹¡_muÉi_¡©em’ts
(
MYSQL
 *
mysql
)

930 
MYSQL
 *
mysql_loÿl
;

931 
MYSQL_RES
 *
»suÉ
;

932 
rc
;

934 cÚ¡ *
qu”y
= "\
 TABLE IF EXISTSest_multi_tab;\
 TABLEest_multi_tab(id int,‚ame char(20));\
 INTOest_multi_tab(id) VALUES(10), (20);\
 INTOest_multi_tab VALUES(20, 'insert;comma');\
 * FROMest_multi_tab;\
est_multi_tab SET‚ame='new;name' WHERE id=20;\
 FROMest_multi_tab WHERE‚ame='new;name';\
 * FROMest_multi_tab;\
 FROMest_multi_tab WHERE id=10;\
 * FROMest_multi_tab;\
 TABLEest_multi_tab;\
 1;\
 TABLE IF EXISTSest_multi_tab";

948 
ušt
 
couÁ
, 
exp_v®ue
;

949 
ušt
 
rows
[]= {0, 0, 2, 1, 3, 2, 2, 1, 1, 0, 0, 1, 0};

950 
my_boÞ
 
»cÚÃù
= 1;

952 
SKIP_SKYSQL
;

953 
SKIP_MAXSCALE
;

959 
mysql_loÿl
ð
mysql
;

960 
mysql
 = 
	`‹¡_cÚÃù
(
NULL
);

961 
rc
ð
	`mysql_qu”y
(
mysql
, 
qu”y
);

962 
	`FAIL_IF
(!
rc
, "Errorƒxpected");

964 
rc
ð
	`mysql_Ãxt_»suÉ
(
mysql
);

965 
	`FAIL_UNLESS
(
rc
 == -1, "rc != -1");

966 
rc
ð
	`mysql_mÜe_»suÉs
(
mysql
);

967 
	`FAIL_UNLESS
(
rc
 == 0, "rc != 0");

969 
	`mysql_þo£
(
mysql
);

970 
mysql
ð
mysql_loÿl
;

972 
	`mysql_ÝtiÚs
(
mysql_loÿl
, 
MYSQL_OPT_RECONNECT
, &
»cÚÃù
);

974 
rc
ð
	`mysql_qu”y
(
mysql_loÿl
, 
qu”y
);

975 
	`check_mysql_rc
(
rc
, 
mysql
);

977 
couÁ
ð0 ; couÁ < 
	`¬¿y_–em’ts
(
rows
) ; count++)

979 ià((
»suÉ
ð
	`mysql_¡Üe_»suÉ
(
mysql_loÿl
)))

981 
	`mysql_ä“_»suÉ
(
»suÉ
);

984 
exp_v®ue
ð(
ušt
è
	`mysql_afãùed_rows
(
mysql_loÿl
);

985 
	`FAIL_IF
(
rows
[
couÁ
] !ð
exp_v®ue
, "row[count] !=ƒxp_value");

986 ià(
couÁ
 !ð
	`¬¿y_–em’ts
(
rows
) -1)

988 
rc
ð
	`mysql_mÜe_»suÉs
(
mysql_loÿl
);

989 
	`FAIL_IF
(!
rc
, "More„esultsƒxpected");

990 
rc
ð
	`mysql_Ãxt_»suÉ
(
mysql_loÿl
);

991 
	`check_mysql_rc
(
rc
, 
mysql_loÿl
);

995 
rc
ð
	`mysql_mÜe_»suÉs
(
mysql_loÿl
);

996 
	`FAIL_UNLESS
(
rc
 == 0, "rc != 0");

997 
rc
ð
	`mysql_Ãxt_»suÉ
(
mysql_loÿl
);

998 
	`FAIL_UNLESS
(
rc
 == -1, "rc != -1");

1004 
rc
ð
	`mysql_qu”y
(
mysql_loÿl
, "select 1+1+a;select 1+1");

1005 
	`FAIL_IF
(!
rc
, "Errorƒxpected");

1006 
rc
ð
	`mysql_mÜe_»suÉs
(
mysql_loÿl
);

1007 
	`FAIL_UNLESS
(
rc
 == 0, "rc != 0");

1008 
rc
ð
	`mysql_Ãxt_»suÉ
(
mysql_loÿl
);

1009 
	`FAIL_UNLESS
(
rc
 == -1, "rc != -1");

1011 
rc
ð
	`mysql_qu”y
(
mysql_loÿl
, "select 1+1;select 1+1+a;select 1");

1012 
	`check_mysql_rc
(
rc
, 
mysql
);

1013 
»suÉ
ð
	`mysql_¡Üe_»suÉ
(
mysql_loÿl
);

1014 
	`FAIL_IF
(!
»suÉ
, "Invalid„esult set");

1015 
	`mysql_ä“_»suÉ
(
»suÉ
);

1016 
rc
ð
	`mysql_mÜe_»suÉs
(
mysql_loÿl
);

1017 
	`FAIL_UNLESS
(
rc
 == 1, "rc != 1");

1018 
rc
ð
	`mysql_Ãxt_»suÉ
(
mysql_loÿl
);

1019 
	`FAIL_UNLESS
(
rc
 > 0, "rc <= 0");

1025 
rc
ð
	`mysql_qu”y
(
mysql_loÿl
, "select 1+1+1");

1026 
	`check_mysql_rc
(
rc
, 
mysql
);

1027 
»suÉ
ð
	`mysql_¡Üe_»suÉ
(
mysql_loÿl
);

1028 
	`FAIL_IF
(!
»suÉ
, "Invalid„esult set");

1029 
	`mysql_ä“_»suÉ
(
»suÉ
);

1034 
rc
ð
	`mysql_qu”y
(
mysql_loÿl
, "select 1; select * from‚ot_existing_table");

1035 
	`check_mysql_rc
(
rc
, 
mysql
);

1036 
»suÉ
ð
	`mysql_¡Üe_»suÉ
(
mysql_loÿl
);

1037 
	`mysql_ä“_»suÉ
(
»suÉ
);

1039 
rc
ð
	`mysql_Ãxt_»suÉ
(
mysql_loÿl
);

1040 
	`FAIL_UNLESS
(
rc
 > 0, "rc <= 0");

1042 
rc
ð
	`mysql_Ãxt_»suÉ
(
mysql_loÿl
);

1043 
	`FAIL_UNLESS
(
rc
 < 0, "rc >= 0");

1045  
OK
;

1046 
	}
}

1048 
	$‹¡_cÚc160
(
MYSQL
 *
mysql
)

1050 
MYSQL_RES
 *
»suÉ
;

1051 
MYSQL_FIELD
 *
f›ld
;

1052 
rc
;

1054 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT cast(1.234 AS DECIMAL)");

1055 
	`check_mysql_rc
(
rc
, 
mysql
);

1057 
»suÉ
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

1058 
f›ld
ð
	`mysql_ãtch_f›ld
(
»suÉ
);

1060 
	`FAIL_UNLESS
(
f›ld
->
æags
 & 
NUM_FLAG
, "Numceric flag‚ot set");

1062 
	`mysql_ä“_»suÉ
(
»suÉ
);

1063  
OK
;

1064 
	}
}

1068 
my_‹¡s_¡
 
	gmy_‹¡s
[] = {

1069 {"‹¡_cÚc160", 
‹¡_cÚc160
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1070 {"þ›Á_¡Üe_»suÉ", 
þ›Á_¡Üe_»suÉ
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1071 {"þ›Á_u£_»suÉ", 
þ›Á_u£_»suÉ
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1072 {"‹¡_ä“_»suÉ", 
‹¡_ä“_»suÉ
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1073 {"‹¡_ä“_¡Üe_»suÉ", 
‹¡_ä“_¡Üe_»suÉ
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1074 {"‹¡_¡Üe_»suÉ", 
‹¡_¡Üe_»suÉ
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1075 {"‹¡_¡Üe_»suÉ1", 
‹¡_¡Üe_»suÉ1
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1076 {"‹¡_¡Üe_»suÉ2", 
‹¡_¡Üe_»suÉ2
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1077 {"‹¡_bug11718", 
‹¡_bug11718
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1078 {"‹¡_bug19671", 
‹¡_bug19671
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1079 {"‹¡_bug21726", 
‹¡_bug21726
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1080 {"‹¡_bug6761", 
‹¡_bug6761
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1081 {"‹¡_f›ld_æags", 
‹¡_f›ld_æags
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1082 {"‹¡_f›ld_Çmes", 
‹¡_f›ld_Çmes
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1083 {"‹¡_func_f›lds", 
‹¡_func_f›lds
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1084 {"‹¡_li¡_f›lds", 
‹¡_li¡_f›lds
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1085 {"‹¡_bug9735", 
‹¡_bug9735
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

1086 {"‹¡_bug9992", 
‹¡_bug9992
, 
TEST_CONNECTION_NEW
, 
CLIENT_MULTI_STATEMENTS
, 
NULL
, NULL},

1087 {"‹¡_muÉi_¡©em’ts", 
‹¡_muÉi_¡©em’ts
, 
TEST_CONNECTION_NEW
, 
CLIENT_MULTI_STATEMENTS
, 
NULL
, NULL},

1088 {
NULL
, NULL, 0, 0, NULL, NULL}

1092 
	$maš
(
¬gc
, **
¬gv
)

1094 ià(
¬gc
 > 1)

1095 
	`g‘_ÝtiÚs
(
¬gc
, 
¬gv
);

1097 
	`g‘_’vv¬s
();

1099 
	`run_‹¡s
(
my_‹¡s
);

1101 (
	`ex™_¡©us
());

1102 
	}
}

	@unittest/libmariadb/rpl_api.c

28 
	~"my_‹¡.h
"

29 
	~"m¬Ÿdb_½l.h
"

31 
	$‹¡_½l_01
(
MYSQL
 *
mysql
)

33 
MARIADB_RPL_EVENT
 *
ev’t
ð
NULL
;

34 
MARIADB_RPL
 *
½l
ð
	`m¬Ÿdb_½l_š™
(
mysql
);

35 
	`mysql_qu”y
(
mysql
, "SET @mariadb_slave_capability=4");

36 
	`mysql_qu”y
(
mysql
, "SET NAMES†atin1");

37 
	`mysql_qu”y
(
mysql
, "SET @slave_gtid_strict_mode=1");

38 
	`mysql_qu”y
(
mysql
, "SET @slave_gtid_ignore_duplicates=1");

39 
	`mysql_qu”y
(
mysql
, "SET NAMES utf8");

40 
	`mysql_qu”y
(
mysql
, "SET @master_binlog_checksum= @@global.binlog_checksum");

41 
½l
->
£rv”_id
= 12;

42 
½l
->
¡¬t_pos™iÚ
= 4;

43 
½l
->
æags
ð
MARIADB_RPL_BINLOG_SEND_ANNOTATE_ROWS
;

45 ià(
	`m¬Ÿdb_½l_Ý’
(
½l
))

46  
FAIL
;

48 (
ev’t
ð
	`m¬Ÿdb_½l_ãtch
(
½l
,ƒvent)))

50 
	`dŸg
("ev’t: %d\n", 
ev’t
->
ev’t_ty³
);

52 
	`m¬Ÿdb_ä“_½l_ev’t
(
ev’t
);

53 
	`m¬Ÿdb_½l_þo£
(
½l
);

54  
OK
;

55 
	}
}

58 
my_‹¡s_¡
 
	gmy_‹¡s
[] = {

59 {"‹¡_½l_01", 
‹¡_½l_01
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

60 {
NULL
, NULL, 0, 0, NULL, NULL}

64 
	$maš
(
¬gc
, **
¬gv
)

66 ià(
¬gc
 > 1)

67 
	`g‘_ÝtiÚs
(
¬gc
, 
¬gv
);

69 
	`g‘_’vv¬s
();

71 
	`run_‹¡s
(
my_‹¡s
);

73 (
	`ex™_¡©us
());

74 
	}
}

	@unittest/libmariadb/sp.c

24 
	~"my_‹¡.h
"

28 
	$‹¡_bug15752
(
MYSQL
 *
mysql
)

30 
rc
, 
i
;

31 cÚ¡ 
ITERATION_COUNT
= 100;

32 cÚ¡ *
qu”y
= "CALL…1()";

35 
rc
ð
	`mysql_qu”y
(
mysql
, "drop…rocedure ifƒxists…1");

36 
	`check_mysql_rc
(
rc
, 
mysql
);

37 
rc
ð
	`mysql_qu”y
(
mysql
, "create…rocedure…1() select 1");

38 
	`check_mysql_rc
(
rc
, 
mysql
);

40 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
qu”y
));

41 
	`check_mysql_rc
(
rc
, 
mysql
);

42 
	`mysql_ä“_»suÉ
(
	`mysql_¡Üe_»suÉ
(
mysql
));

44 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
qu”y
));

45 
	`FAIL_UNLESS
(
rc
 && 
	`mysql_”ºo
(
mysql
è=ð
CR_COMMANDS_OUT_OF_SYNC
, "Errorƒxpected");

47 
rc
ð
	`mysql_Ãxt_»suÉ
(
mysql
);

48 
	`check_mysql_rc
(
rc
, 
mysql
);

50 
	`mysql_ä“_»suÉ
(
	`mysql_¡Üe_»suÉ
(
mysql
));

52 
rc
ð
	`mysql_Ãxt_»suÉ
(
mysql
);

53 
	`FAIL_IF
(
rc
 != -1, "rc != -1");

55 
i
 = 0; i < 
ITERATION_COUNT
; i++)

57 
rc
ð
	`mysql_»®_qu”y
(
mysql
, 
	`SL
(
qu”y
));

58 
	`check_mysql_rc
(
rc
, 
mysql
);

59 
	`mysql_ä“_»suÉ
(
	`mysql_¡Üe_»suÉ
(
mysql
));

60 
rc
ð
	`mysql_Ãxt_»suÉ
(
mysql
);

61 
	`check_mysql_rc
(
rc
, 
mysql
);

62 
	`mysql_ä“_»suÉ
(
	`mysql_¡Üe_»suÉ
(
mysql
));

63 
rc
ð
	`mysql_Ãxt_»suÉ
(
mysql
);

64 
	`FAIL_IF
(
rc
 != -1, "rc != -1");

67 
rc
ð
	`mysql_qu”y
(
mysql
, "drop…rocedure…1");

68 
	`check_mysql_rc
(
rc
, 
mysql
);

70  
OK
;

71 
	}
}

76 
my_‹¡s_¡
 
	gmy_‹¡s
[] = {

77 {"‹¡_bug15752", 
‹¡_bug15752
, 
TEST_CONNECTION_NEW
, 0, 
NULL
 , NULL},

78 {
NULL
, NULL, 0, 0, NULL, NULL}

81 
	$maš
(
¬gc
, **
¬gv
)

83 ià(
¬gc
 > 1)

84 
	`g‘_ÝtiÚs
(
¬gc
, 
¬gv
);

86 
	`g‘_’vv¬s
();

88 
	`run_‹¡s
(
my_‹¡s
);

90 (
	`ex™_¡©us
());

91 
	}
}

	@unittest/libmariadb/ssl.c

19 #ià
defšed
(
WIN32
è&& defšed(
HEAP_CHECK
)

20 
	#_CRTDBG_MAP_ALLOC


	)

21 
	~<¡dlib.h
>

22 
	~<ütdbg.h
>

25 
	~"my_‹¡.h
"

26 
	~<ma_±h»ad.h
>

27 #ifdeà
HAVE_OPENSSL


28 
	~<Ý’s¦/Ý’s¦v.h
>

29 
	~<Ý’s¦/s¦.h
>

32 
	#FNLEN
 4096

	)

34 
	gsk_s¦
= 1;

35 
uch¬
 
	ghave_Ý’s¦
= 1;

36 
	ghave_Žs13
= 0;

38 cÚ¡ *
	gs¦u£r
= "ssluser";

39 cÚ¡ *
	gs¦pw
= "sslpw";

40 
	gs¦ho¡
[128];

41 
	gs¦û¹
[
FNLEN
];

42 
	gs¦combšed
[
FNLEN
];

43 
	gs¦key
[
FNLEN
];

44 
	gs¦key_’c
[
FNLEN
];

45 
	gs¦ÿ
[
FNLEN
];

46 
	gs¦ül
[
FNLEN
];

47 
	gs¦_û¹_fšg”_´št
[129]= {0};

48 
	gbad_û¹_fšg”_´št
[]= "00:11:22:33:44:55:66:77:88:99:AA:BB:CC:DD:EE:FF:01:23:45:67";

50 
±h»ad_mu‹x_t
 
	gLOCK_‹¡
;

52 
	$»ad_fšg”´št
()

54 
FILE
 *
f
ð
	`fÝ’
(
CERT_PATH
 "/server-cert.sha1", "r");

55 ià(
f
)

57 ià(!
	`fsÿnf
(
f
, "%128s", 
s¦_û¹_fšg”_´št
))

58 
s¦_û¹_fšg”_´št
[0]= 0;

59 
	`fþo£
(
f
);

61 
	}
}

63 
	$check_sk_s¦
()

65 cÚ¡ *
s¦dœ
ð
NULL
;

66 #iâdeà
HAVE_TLS


67 
	`dŸg
("client†ibrary built without OpenSSL support -> skip");

70 ià(
sk_s¦
)

72 
	`dŸg
("server doesn't support SSL -> skip");

75 ià(!(
s¦dœ
ð
	`g‘’v
("SECURE_LOAD_PATH")))

77 
s¦dœ
ð
CERT_PATH
;

78 ià(!
	`¡¾’
(
s¦dœ
))

80 
	`dŸg
("certificate directory‚ot found");

84 
	`¢´štf
(
s¦û¹
, 
FNLEN
 - 1, "%s/%s", 
s¦dœ
, "client-cert.pem");

85 
	`¢´štf
(
s¦combšed
, 
FNLEN
 - 1, "%s/%s", 
s¦dœ
, "client-certkey.pem");

86 
	`¢´štf
(
s¦key
, 
FNLEN
 - 1, "%s/%s", 
s¦dœ
, "client-key.pem");

87 
	`¢´štf
(
s¦key_’c
, 
FNLEN
 - 1, "%s/%s", 
s¦dœ
, "client-key-enc.pem");

88 
	`¢´štf
(
s¦ÿ
, 
FNLEN
 - 1, "%s/%s", 
s¦dœ
, "cacert.pem");

90 
	}
}

92 
	$check_ch”
(
MYSQL
 *
mysql
)

94 *
ch”
ð(*)
	`mysql_g‘_s¦_ch”
(
mysql
);

95 ià(!
ch”
)

97 
	`dŸg
("ch”: %s", 
ch”
);

100 
	}
}

102 
	$ü—‹_s¦_u£r
(cÚ¡ *
s¦u£r
, 
my_boÞ
 
is_X509
)

104 
rc
;

105 
qu”y
[1024];

106 
MYSQL
 *
mysql
ð
	`mysql_š™
(
NULL
);

108 
	`FAIL_IF
(!
	`mysql_»®_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
, 
schema
,

109 
pÜt
, 
sock‘Çme
, 0), 
	`mysql_”rÜ
(
mysql
));

111 
	`¥rštf
(
qu”y
, "DROP USER '%s'@'%s'", 
s¦u£r
, 
this_ho¡
);

112 
rc
ð
	`mysql_qu”y
(
mysql
, 
qu”y
);

114 
	`¥rštf
(
qu”y
, "CREATE USER '%s'@'%s' IDENTIFIED BY '%s'", 
s¦u£r
, 
this_ho¡
, 
s¦pw
);

115 
rc
ð
	`mysql_qu”y
(
mysql
, 
qu”y
);

116 
	`check_mysql_rc
(
rc
,
mysql
);

118 
	`¥rštf
(
qu”y
, "GRANT ALL ON %s.* TO '%s'@'%s' REQUIRE %s", 
schema
, 
s¦u£r
, 
this_ho¡
, 
is_X509
 ? "X509" : "SSL");

119 
rc
ð
	`mysql_qu”y
(
mysql
, 
qu”y
);

120 
	`check_mysql_rc
(
rc
,
mysql
);

121 
rc
ð
	`mysql_qu”y
(
mysql
, "FLUSH PRIVILEGES");

122 
	`check_mysql_rc
(
rc
,
mysql
);

124 
	`mysql_þo£
(
mysql
);

126  
rc
;

127 
	}
}

129 
	$‹¡_s¦
(
MYSQL
 *
mysql
)

131 
rc
;

132 
iv”siÚ
;

133 
MYSQL_RES
 *
»s
;

134 
MYSQL_ROW
 
row
;

135 *
Žs_lib¿ry
;

136 
MYSQL
 *
my
ð
	`mysql_š™
(
NULL
);

138 
	`mysql_s¦_£t
(
my
,0, 0, 0, 0, 0);

140 
	`ü—‹_s¦_u£r
("ssluser", 0);

142 
	`FAIL_IF
(!
	`mysql_»®_cÚÃù
(
my
, 
ho¡Çme
, 
s¦u£r
, 
s¦pw
, 
schema
,

143 
s¦_pÜt
, 
sock‘Çme
, 0), 
	`mysql_”rÜ
(
my
));

145 
	`m¬Ÿdb_g‘_šfov
(
my
, 
MARIADB_CONNECTION_TLS_VERSION_ID
, &
iv”siÚ
);

146 
	`dŸg
("iv”siÚ: %d", 
iv”siÚ
);

147 ià(
iv”siÚ
 == 4)

148 
have_Žs13
= 1;

150 
	`mysql_þo£
(
my
);

152 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT @@have_ssl, @@have_openssl");

153 
	`check_mysql_rc
(
rc
, 
mysql
);

155 
»s
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

156 
	`FAIL_IF
(!
»s
, 
	`mysql_”rÜ
(
mysql
));

158 (
row
ð
	`mysql_ãtch_row
(
»s
)))

160 ià(!
	`¡rcmp
(
row
[0], "YES"))

161 
sk_s¦
= 0;

162 ià(
	`¡rcmp
(
row
[1], "YES"))

163 
have_Ý’s¦
= 0;

164 
	`dŸg
("SSL: %s", 
row
[0]);

166 
	`mysql_ä“_»suÉ
(
»s
);

169 ià(!
	`m¬Ÿdb_cÚÃùiÚ
(
mysql
))

171 
rc
ð
	`mysql_qu”y
(
mysql
, "select†ocate('v1.2', @@tls_version) > 0");

172 
	`check_mysql_rc
(
rc
, 
mysql
);

174 
»s
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

175 
	`FAIL_IF
(!
»s
, 
	`mysql_”rÜ
(
mysql
));

177 ià((
row
ð
	`mysql_ãtch_row
(
»s
)))

179 ià(
row
[0] &&„ow[0][0] == '0')

180 
have_Ý’s¦
= 0;

182 
	`mysql_ä“_»suÉ
(
»s
);

184 
	`dŸg
("O³nSSL: %d", 
have_Ý’s¦
);

186 
	`m¬Ÿdb_g‘_šfov
(
NULL
, 
MARIADB_TLS_LIBRARY
, &
Žs_lib¿ry
);

187 
	`dŸg
("SSL†ib¿ry: %s", 
Žs_lib¿ry
);

189 
s¦ho¡
[0]= 0;

191 ià(!
sk_s¦
)

193 *
p
;

195 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT CURRENT_USER()");

196 
	`check_mysql_rc
(
rc
, 
mysql
);

197 
»s
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

198 
row
ð
	`mysql_ãtch_row
(
»s
);

199 
	`dŸg
("u£r: %s", 
row
[0]);

200 ià((
p
ð
	`¡rchr
(
row
[0], '@')))

201 
	`¡rýy
(
s¦ho¡
, 
p
+1);

202 
	`mysql_ä“_»suÉ
(
»s
);

205  
OK
;

206 
	}
}

208 
‹¡_s¦_ch”
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

210 
MYSQL
 *
	gmy
;

211 
MYSQL_RES
 *
	g»s
;

212 
MYSQL_ROW
 
	grow
;

213 
	grc
;

215 ià(
check_sk_s¦
())

216  
	gSKIP
;

218 
	gmy
ð
mysql_š™
(
NULL
);

219 
FAIL_IF
(!
my
, "mysql_init() failed");

221 
mysql_s¦_£t
(
my
,0, 0, 
s¦ÿ
, 0, 0);

223 
FAIL_IF
(!
mysql_»®_cÚÃù
(
my
, 
ho¡Çme
, 
s¦u£r
, 
s¦pw
, 
schema
,

224 
s¦_pÜt
, 
sock‘Çme
, 0), 
mysql_”rÜ
(
my
));

226 
	grc
ð
mysql_qu”y
(
my
, "SHOW session status†ike 'Ssl_version'");

227 
check_mysql_rc
(
rc
, 
my
);

228 
	g»s
ð
mysql_¡Üe_»suÉ
(
my
);

229 
	grow
ð
mysql_ãtch_row
(
»s
);

230 
dŸg
("%s: %s", 
row
[0],„ow[1]);

231 
dŸg
("ch”: %s", 
mysql_g‘_s¦_ch”
(
my
));

232 
mysql_ä“_»suÉ
(
»s
);

234 
FAIL_IF
(
check_ch”
(
my
) != 0, "Invalid cipher");

235 
mysql_þo£
(
my
);

236  
	gOK
;

239 
‹¡_cÚc95
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

241 
MYSQL
 *
	gmysql
;

243 ià(
check_sk_s¦
())

244  
	gSKIP
;

246 
ü—‹_s¦_u£r
("ssluser1", 1);

248 
	gmysql
ð
mysql_š™
(
NULL
);

249 
mysql_s¦_£t
(
mysql
,

250 
s¦key
,

251 
s¦û¹
,

252 
NULL
,

253 
NULL
,

254 
NULL
);

256 ià(!
mysql_»®_cÚÃù
(
mysql
, 
ho¡Çme
, "s¦u£r1", 
s¦pw
, 
schema
,

257 
s¦_pÜt
, 
sock‘Çme
, 0))

259 
dŸg
("could‚Ùƒ¡ablish x509 cÚÃùiÚ. E¼Ü: %s", 
mysql_”rÜ
(
mysql
));

260 
mysql_þo£
(
mysql
);

261  
	gFAIL
;

263 
mysql_þo£
(
mysql
);

264  
	gOK
;

267 
‹¡_muÉi_s¦_cÚÃùiÚs
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

269 
MYSQL
 *
	gmysql
[50], *
	gmy
;

270 
	gi
, 
	grc
;

271 
	gÞd_cÚÃùiÚs
ð0, 
	gÃw_cÚÃùiÚs
= 0;

272 
MYSQL_RES
 *
	g»s
;

273 
MYSQL_ROW
 
	grow
;

275 ià(
check_sk_s¦
())

276  
	gSKIP
;

278 
dŸg
("Test doesn't work with yassl");

279  
	gSKIP
;

281 
ü—‹_s¦_u£r
(
s¦u£r
, 0);

283 
	gmy
ð
mysql_š™
(
NULL
);

284 
FAIL_IF
(!
my
,"mysql_init() failed");

285 
FAIL_IF
(!
mysql_»®_cÚÃù
(
my
, 
ho¡Çme
, 
s¦u£r
, 
s¦pw
, 
schema
,

286 
s¦_pÜt
, 
sock‘Çme
, 0), 
mysql_”rÜ
(
my
));

288 
	grc
ð
mysql_qu”y
(
my
, "SHOW STATUS LIKE 'Ssl_accepts'");

289 
check_mysql_rc
(
rc
, 
my
);

291 
	g»s
ð
mysql_¡Üe_»suÉ
(
my
);

292 ià((
	grow
ð
mysql_ãtch_row
(
»s
)))

293 
Þd_cÚÃùiÚs
ð
©oi
(
row
[1]);

294 
mysql_ä“_»suÉ
(
»s
);

296 
	gi
=0; i < 50; i++)

298 
	gmysql
[
i
]ð
mysql_š™
(
NULL
);

299 
FAIL_IF
(!
mysql
[
i
],"mysql_init() failed");

301 
mysql_s¦_£t
(
mysql
[
i
], 0, 0, 
s¦ÿ
, 0, 0);

303 
mysql_»®_cÚÃù
(
mysql
[
i
], 
ho¡Çme
, 
s¦u£r
, 
s¦pw
, 
schema
,

304 
s¦_pÜt
, 
sock‘Çme
, 0);

305 ià(
mysql_”ºo
(
mysql
[
i
]))

307 
dŸg
("loÝ: %dƒ¼Ü: %d %s", 
i
, 
mysql_”ºo
(
mysql
[i]), 
mysql_”rÜ
(mysql[i]));

308  
	gFAIL
;

311 
FAIL_IF
(
check_ch”
(
mysql
[
i
]) != 0, "Invalid cipher");

313 
	gi
=0; i < 50; i++)

314 
mysql_þo£
(
mysql
[
i
]);

316 
	grc
ð
mysql_qu”y
(
my
, "SHOW STATUS LIKE 'Ssl_accepts'");

317 
check_mysql_rc
(
rc
, 
my
);

319 
	g»s
ð
mysql_¡Üe_»suÉ
(
my
);

320 ià((
	grow
ð
mysql_ãtch_row
(
»s
)))

321 
Ãw_cÚÃùiÚs
ð
©oi
(
row
[1]);

322 
mysql_ä“_»suÉ
(
»s
);

324 
mysql_þo£
(
my
);

326 
dŸg
("%d SSL cÚÃùiÚ ´oûs£d", 
Ãw_cÚÃùiÚs
 - 
Þd_cÚÃùiÚs
);

327 
FAIL_IF
(
Ãw_cÚÃùiÚs
 - 
Þd_cÚÃùiÚs
 < 50, "new_connections should be‡t†east old_connections + 50");

328  
	gOK
;

331 #iâdeà
WIN32


332 
s¦_th»ad
(*
unu£d
 
__©Œibu‹__
((unused)))

334 
DWORD
 
WINAPI
 
	$s¦_th»ad
(*
dummy
)

337 
MYSQL
 *
mysql
ð
NULL
;

339 
	`mysql_th»ad_š™
();

341 ià(!(
mysql
ð
	`mysql_š™
(
NULL
)))

343 
’d
;

345 
	`mysql_s¦_£t
(
mysql
, 0, 0, 
s¦ÿ
, 0, 0);

347 if(!
	`mysql_»®_cÚÃù
(
mysql
, 
ho¡Çme
, 
s¦u£r
, 
s¦pw
, 
schema
,

348 
s¦_pÜt
, 
sock‘Çme
, 0))

350 
	`dŸg
(">E¼Ü: %s", 
	`mysql_”rÜ
(
mysql
));

351 
’d
;

354 
	`±h»ad_mu‹x_lock
(&
LOCK_‹¡
);

355 
	`mysql_qu”y
(
mysql
, "UPDATE ssltest SET‡=a+1");

356 
	`±h»ad_mu‹x_uÆock
(&
LOCK_‹¡
);

358 
’d
:

359 if(
mysql
)

360 
	`mysql_þo£
(
mysql
);

361 
	`mysql_th»ad_’d
();

362 #ifdeà
_WIN32


365 
	}
}

367 
	$‹¡_s¦_th»ads
(
MYSQL
 *
mysql
)

369 
i
, 
rc
;

370 #iâdeà
WIN32


371 
±h»ad_t
 
th»ads
[50];

373 
HANDLE
 
hth»ads
[50];

374 
DWORD
 
dth»ads
[50];

376 
MYSQL_RES
 *
»s
;

377 
MYSQL_ROW
 
row
;

379 ià(
	`check_sk_s¦
())

380  
SKIP
;

382 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IFƒxists ssltest");

383 
	`check_mysql_rc
(
rc
, 
mysql
);

384 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE ssltest (a int)");

385 
	`check_mysql_rc
(
rc
, 
mysql
);

386 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT into ssltest VALUES (0)");

387 
	`check_mysql_rc
(
rc
, 
mysql
);

388 
	`±h»ad_mu‹x_š™
(&
LOCK_‹¡
, 
NULL
);

390 
	`±h»ad_mu‹x_š™
(&
LOCK_‹¡
, 
NULL
);

392 
i
=0; i < 50; i++)

394 #iâdeà
WIN32


395 
	`±h»ad_ü—‹
(&
th»ads
[
i
], 
NULL
, (*)
s¦_th»ad
, NULL);

397 
hth»ads
[
i
]ð
	`C»©eTh»ad
(
NULL
, 0, (
LPTHREAD_START_ROUTINE
)
s¦_th»ad
, NULL, 0, &
dth»ads
[i]);

398 ià(
hth»ads
[
i
]==
NULL
)

399 
	`dŸg
("error while startinghread");

402 
i
=0; i < 50; i++)

403 #iâdeà
WIN32


404 
	`±h»ad_još
(
th»ads
[
i
], 
NULL
);

406 
	`Wa™FÜSšgËObjeù
(
hth»ads
[
i
], 
INFINITE
);

409 
	`±h»ad_mu‹x_de¡roy
(&
LOCK_‹¡
);

411 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT‡ FROM ssltest");

412 
	`check_mysql_rc
(
rc
, 
mysql
);

413 
»s
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

414 
row
ð
	`mysql_ãtch_row
(
»s
);

415 
	`dŸg
("Found: %s", 
row
[0]);

416 
	`FAIL_IF
(
	`¡rcmp
(
row
[0], "50") != 0, "Expected 50");

417 
	`mysql_ä“_»suÉ
(
»s
);

418 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IFƒxists ssltest");

419 
	`check_mysql_rc
(
rc
, 
mysql
);

420  
OK
;

421 
	}
}

423 
‹¡_phpbug51647
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

425 
MYSQL
* 
	gmysql
;

427 ià(
check_sk_s¦
())

428  
	gSKIP
;

430 
	gmysql
ð
mysql_š™
(
NULL
);

431 
FAIL_IF
(!
mysql
, "Can't‡llocate memory");

433 
mysql_s¦_£t
(
mysql
, 
s¦key
,

434 
s¦û¹
,

435 
s¦ÿ
, 0, 0);

437 
FAIL_IF
(!
mysql_»®_cÚÃù
(
mysql
, 
ho¡Çme
, 
s¦u£r
, 
s¦pw
, 
schema
,

438 
s¦_pÜt
, 
sock‘Çme
, 0), 
mysql_”rÜ
(
mysql
));

439 
dŸg
("%s", 
mysql_g‘_s¦_ch”
(
mysql
));

440 
mysql_þo£
(
mysql
);

442  
	gOK
;

445 
‹¡_·sswÜd_´Ùeùed
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

447 
MYSQL
* 
	gmysql
;

449 ià(
check_sk_s¦
())

450  
	gSKIP
;

452 
	gmysql
ð
mysql_š™
(
NULL
);

453 
FAIL_IF
(!
mysql
, "Can't‡llocate memory");

455 
mysql_s¦_£t
(
mysql
, 
s¦key_’c
,

456 
s¦û¹
,

457 
s¦ÿ
, 0, 0);

459 
mysql_ÝtiÚs
(
mysql
, 
MARIADB_OPT_TLS_PASSPHRASE
, "qwerty");

461 
FAIL_IF
(!
mysql_»®_cÚÃù
(
mysql
, 
ho¡Çme
, 
s¦u£r
, 
s¦pw
, 
schema
,

462 
s¦_pÜt
, 
sock‘Çme
, 0), 
mysql_”rÜ
(
mysql
));

463 
dŸg
("%s", 
mysql_g‘_s¦_ch”
(
mysql
));

464 
mysql_þo£
(
mysql
);

466  
	gOK
;

470 
‹¡_cÚc50
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

472 
MYSQL
 *
	gmysql
;

474 ià(
check_sk_s¦
())

475  
	gSKIP
;

477 
	gmysql
ð
mysql_š™
(
NULL
);

478 
FAIL_IF
(!
mysql
, "Can't‡llocate memory");

480 
mysql_s¦_£t
(
mysql
, 
NULL
, NULL, "./non_exisiting_cert.pem", NULL, NULL);

482 
mysql_»®_cÚÃù
(
mysql
, 
ho¡Çme
, 
s¦u£r
, 
s¦pw
, 
schema
,

483 
s¦_pÜt
, 
sock‘Çme
, 0);

484 
dŸg
("E¼Ü: %d %s", 
mysql_”ºo
(
mysql
), 
mysql_”rÜ
(mysql));

485 
FAIL_IF
(
mysql_”ºo
(
mysql
) != 2026, "Expectedƒrrno 2026");

486 
mysql_þo£
(
mysql
);

488  
	gOK
;

491 
‹¡_cÚc50_1
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

493 
MYSQL
 *
	gmysql
;

495 ià(
check_sk_s¦
())

496  
	gSKIP
;

498 ià(!
	ghave_Ý’s¦
)

500 
dŸg
("Server with OpenSSL„equired");

501  
	gSKIP
;

504 
ü—‹_s¦_u£r
(
s¦u£r
, 0);

506 
	gmysql
ð
mysql_š™
(
NULL
);

507 
FAIL_IF
(!
mysql
, "Can't‡llocate memory");

509 
mysql_s¦_£t
(
mysql
, 
NULL
, NULL, 
s¦ÿ
, NULL, NULL);

511 
mysql_»®_cÚÃù
(
mysql
, 
ho¡Çme
, 
s¦u£r
, 
s¦pw
, 
schema
,

512 
s¦_pÜt
, 
sock‘Çme
, 0);

513 ià(
mysql_”ºo
(
mysql
))

514 
dŸg
("E¼Ü: %d %s", 
mysql_”ºo
(
mysql
), 
mysql_”rÜ
(mysql));

515 
FAIL_IF
(
mysql_”ºo
(
mysql
), "Noƒrrorƒxpected");

517 
mysql_þo£
(
mysql
);

519  
	gOK
;

522 
‹¡_cÚc50_2
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

524 
MYSQL
 *
	gmysql
;

526 ià(
check_sk_s¦
())

527  
	gSKIP
;

529 
	gmysql
ð
mysql_š™
(
NULL
);

530 
FAIL_IF
(!
mysql
, "Can't‡llocate memory");

532 
mysql_s¦_£t
(
mysql
, 
NULL
, NULL, "./non_exisiting_cert.pem", NULL, NULL);

534 
mysql_»®_cÚÃù
(
mysql
, 
ho¡Çme
, 
s¦u£r
, 
s¦pw
, 
schema
,

535 
s¦_pÜt
, 
sock‘Çme
, 0);

536 
FAIL_IF
(
mysql_”ºo
(
mysql
) != 2026, "Expectedƒrrno 2026");

537 
mysql_þo£
(
mysql
);

539  
	gOK
;

542 
‹¡_cÚc127
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

544 
MYSQL
 *
	gmysql
;

546 
dŸg
("test disabled - foresting disable otherests or„unhisest‡s firstest");

547  
	gSKIP
;

549 ià(
check_sk_s¦
())

550  
	gSKIP
;

552 
	gmysql
ð
mysql_š™
(
NULL
);

553 
FAIL_IF
(!
mysql
, "Can't‡llocate memory");

555 
mysql_s¦_£t
(
mysql
, 
NULL
, NULL, "./non_exisiting.pem", NULL, NULL);

557 
mysql_»®_cÚÃù
(
mysql
, 
ho¡Çme
, 
s¦u£r
, 
s¦pw
, 
schema
,

558 
s¦_pÜt
, 
sock‘Çme
, 0);

559 
dŸg
("E¼Ü: %s", 
mysql_”rÜ
(
mysql
));

560 
FAIL_IF
(
mysql_”ºo
(
mysql
) == 0, "Errorƒxpected (invalid certificate)");

561 
mysql_þo£
(
mysql
);

563  
	gOK
;

566 
‹¡_cÚc50_3
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

568 
MYSQL
 *
	gmysql
;

570 ià(
check_sk_s¦
())

571  
	gSKIP
;

573 
ü—‹_s¦_u£r
(
s¦u£r
, 0);

575 
	gmysql
ð
mysql_š™
(
NULL
);

576 
FAIL_IF
(!
mysql
, "Can't‡llocate memory");

578 
mysql_»®_cÚÃù
(
mysql
, 
ho¡Çme
, 
s¦u£r
, 
s¦pw
, 
schema
,

579 
s¦_pÜt
, 
sock‘Çme
, 0);

580 
FAIL_IF
(!
mysql_”ºo
(
mysql
), "Errorƒxpected, SSL connection„equired!");

581 
mysql_þo£
(
mysql
);

583 
	gmysql
ð
mysql_š™
(
NULL
);

584 
FAIL_IF
(!
mysql
, "Can't‡llocate memory");

586 
mysql_s¦_£t
(
mysql
, 
NULL
, NULL, 
s¦ÿ
, NULL, NULL);

588 
mysql_»®_cÚÃù
(
mysql
, 
ho¡Çme
, 
s¦u£r
, 
s¦pw
, 
schema
,

589 
s¦_pÜt
, 
sock‘Çme
, 0);

590 
dŸg
("E¼Ü: %s<", 
mysql_”rÜ
(
mysql
));

591 
FAIL_IF
(
mysql_”ºo
(
mysql
), "Noƒrrorƒxpected");

592 
mysql_þo£
(
mysql
);

594  
	gOK
;

597 
‹¡_cÚc50_4
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

599 
MYSQL
 *
	gmysql
;

601 ià(
check_sk_s¦
())

602  
	gSKIP
;

604 
	gmysql
ð
mysql_š™
(
NULL
);

605 
FAIL_IF
(!
mysql
, "Can't‡llocate memory");

607 
mysql_s¦_£t
(
mysql
, 
NULL
, 
s¦ÿ
, NULL, NULL, NULL);

609 
mysql_»®_cÚÃù
(
mysql
, 
ho¡Çme
, 
s¦u£r
, 
s¦pw
, 
schema
,

610 
s¦_pÜt
, 
sock‘Çme
, 0);

611 
FAIL_IF
(!
mysql_”ºo
(
mysql
) , "Errorƒxpected");

612 
mysql_þo£
(
mysql
);

614  
	gOK
;

617 
v”ify_s¦_£rv”_û¹
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

619 
MYSQL
 *
	gmysql
;

620 
ušt
 
	gv”ify
= 1;

622 ià(
check_sk_s¦
())

623  
	gSKIP
;

625 ià(!
	gho¡Çme
 || !
¡rcmp
(
ho¡Çme
, "localhost"))

626  
	gSKIP
;

628 
SKIP_TRAVIS
();

630 
	gmysql
ð
mysql_š™
(
NULL
);

631 
FAIL_IF
(!
mysql
, "Can't‡llocate memory");

633 
mysql_s¦_£t
(
mysql
, 
NULL
, NULL, 
s¦ÿ
, NULL, NULL);

634 
mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_SSL_VERIFY_SERVER_CERT
, &
v”ify
);

636 
mysql_»®_cÚÃù
(
mysql
, 
ho¡Çme
, 
s¦u£r
, 
s¦pw
, 
schema
,

637 
s¦_pÜt
, 
sock‘Çme
, 0);

639 
FAIL_IF
(!
mysql_”ºo
(
mysql
), "Expectedƒrror");

640 
dŸg
("E¼Ü (ex³ùed): %s", 
mysql_”rÜ
(
mysql
));

641 
mysql_þo£
(
mysql
);

643  
	gOK
;

646 
‹¡_bug62743
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

648 
MYSQL
 *
	gmysql
;

650 ià(
check_sk_s¦
())

651  
	gSKIP
;

653 
	gmysql
ð
mysql_š™
(
NULL
);

654 
FAIL_IF
(!
mysql
, "Can't‡llocate memory");

656 
mysql_s¦_£t
(
mysql
, "dummykey", 
NULL
, NULL, NULL, NULL);

658 
mysql_»®_cÚÃù
(
mysql
, 
ho¡Çme
, 
s¦u£r
, 
s¦pw
, 
schema
,

659 
s¦_pÜt
, 
sock‘Çme
, 0);

660 
dŸg
("E¼Ü: %s", 
mysql_”rÜ
(
mysql
));

661 
FAIL_IF
(
mysql_”ºo
(
mysql
) != 2026, "Expectedƒrrno 2026");

662 
mysql_þo£
(
mysql
);

664 
	gmysql
ð
mysql_š™
(
NULL
);

665 
FAIL_IF
(!
mysql
, "Can't‡llocate memory");

667 
mysql_s¦_£t
(
mysql
, 
s¦key
, 
NULL
, NULL, NULL, NULL);

669 
mysql_»®_cÚÃù
(
mysql
, 
ho¡Çme
, 
s¦u£r
, 
s¦pw
, 
schema
,

670 
s¦_pÜt
, 
sock‘Çme
, 0);

671 
dŸg
("E¼Ü w™h key: %s", 
mysql_”rÜ
(
mysql
));

672 
FAIL_IF
(
mysql_”ºo
(
mysql
) != 2026, "Expectedƒrrno 2026");

673 
mysql_þo£
(
mysql
);

675 
	gmysql
ð
mysql_š™
(
NULL
);

676 
FAIL_IF
(!
mysql
, "Can't‡llocate memory");

678 
mysql_s¦_£t
(
mysql
, 
s¦key
,

679 
s¦û¹
, 
NULL
, NULL, NULL);

681 
mysql_»®_cÚÃù
(
mysql
, 
ho¡Çme
, 
s¦u£r
, 
s¦pw
, 
schema
,

682 
s¦_pÜt
, 
sock‘Çme
, 0);

683 
FAIL_IF
(
mysql_”ºo
(
mysql
) != 0, "Expected‚oƒrror");

684 
mysql_þo£
(
mysql
);

686 
	gmysql
ð
mysql_š™
(
NULL
);

687 
FAIL_IF
(!
mysql
, "Can't‡llocate memory");

689 
mysql_s¦_£t
(
mysql
, 
s¦key
, "bÏblubb", 
NULL
, NULL, NULL);

691 
mysql_»®_cÚÃù
(
mysql
, 
ho¡Çme
, 
s¦u£r
, 
s¦pw
, 
schema
,

692 
s¦_pÜt
, 
sock‘Çme
, 0);

693 
dŸg
("E¼Ü w™h c”t: %s", 
mysql_”rÜ
(
mysql
));

694 
FAIL_IF
(
mysql_”ºo
(
mysql
) == 0, "Expectedƒrror");

695 
mysql_þo£
(
mysql
);

697  
	gOK
;

700 #iâdeà
WIN32


701 
	$th»ad_cÚc102
()

703 
DWORD
 
WINAPI
 
	$th»ad_cÚc102
()

706 
MYSQL
 *
mysql
;

707 
rc
;

708 
MYSQL_RES
 *
»s
;

709 
	`mysql_th»ad_š™
();

710 
mysql
ð
	`mysql_š™
(
NULL
);

712 
	`mysql_s¦_£t
(
mysql
, 
s¦key
,

713 
s¦û¹
,

714 
s¦ÿ
,

715 
NULL
, NULL);

716 
	`mysql_s¦_£t
(
mysql
,0, 0, 
s¦ÿ
, 0, 0);

718 if(!
	`mysql_»®_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
, 
schema
,

719 
s¦_pÜt
, 
sock‘Çme
, 0))

721 
	`dŸg
(">E¼Ü: %s", 
	`mysql_”rÜ
(
mysql
));

722 
’d
;

724 ià(!
	`mysql_g‘_s¦_ch”
(
mysql
))

726 
	`dŸg
("Error: No ssl connection");

727 
’d
;

729 
	`±h»ad_mu‹x_lock
(&
LOCK_‹¡
);

730 
rc
ð
	`mysql_qu”y
(
mysql
, "UPDATE_conc102 SET‡=a+1");

731 
	`check_mysql_rc
(
rc
, 
mysql
);

732 
	`±h»ad_mu‹x_uÆock
(&
LOCK_‹¡
);

733 
	`check_mysql_rc
(
rc
, 
mysql
);

734 ià((
»s
ð
	`mysql_¡Üe_»suÉ
(
mysql
)))

735 
	`mysql_ä“_»suÉ
(
»s
);

736 
’d
:

737 
	`mysql_þo£
(
mysql
);

738 
	`mysql_th»ad_’d
();

740 
	}
}

742 
	$‹¡_cÚc_102
(
MYSQL
 *
mysql
)

745 
rc
;

746 
i
;

747 
MYSQL_ROW
 
row
;

748 
MYSQL_RES
 *
»s
;

749 #iâdeà
WIN32


750 
±h»ad_t
 
th»ads
[50];

752 
HANDLE
 
hth»ads
[50];

753 
DWORD
 
th»ads
[50];

756 ià(
	`check_sk_s¦
())

757  
SKIP
;

759 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS_conc102");

760 
	`check_mysql_rc
(
rc
, 
mysql
);

761 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE_conc102 (‡ int)");

762 
	`check_mysql_rc
(
rc
, 
mysql
);

763 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTO_conc102 VALUES (0)");

764 
	`check_mysql_rc
(
rc
, 
mysql
);

765 
	`±h»ad_mu‹x_š™
(&
LOCK_‹¡
, 
NULL
);

767 
i
=0; i < 50; i++)

769 #iâdeà
WIN32


770 
	`±h»ad_ü—‹
(&
th»ads
[
i
], 
NULL
, (*)
th»ad_cÚc102
, NULL);

772 
hth»ads
[
i
]ð
	`C»©eTh»ad
(
NULL
, 0, (
LPTHREAD_START_ROUTINE
)
th»ad_cÚc102
, NULL, 0, &
th»ads
[i]);

773 ià(
hth»ads
[
i
]==
NULL
)

774 
	`dŸg
("error while startinghread");

777 
i
=0; i < 50; i++)

779 #iâdeà
WIN32


780 
	`±h»ad_još
(
th»ads
[
i
], 
NULL
);

782 
	`Wa™FÜSšgËObjeù
(
hth»ads
[
i
], 
INFINITE
);

785 
	`±h»ad_mu‹x_de¡roy
(&
LOCK_‹¡
);

786 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT‡ FROM_conc102");

787 
	`check_mysql_rc
(
rc
, 
mysql
);

788 
»s
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

789 
row
ð
	`mysql_ãtch_row
(
»s
);

790 
	`dŸg
("Found: %s", 
row
[0]);

791 
	`FAIL_IF
(
	`¡rcmp
(
row
[0], "50") != 0, "Expected 50");

792 
	`mysql_ä“_»suÉ
(
»s
);

793 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS_conc102");

794 
	`check_mysql_rc
(
rc
, 
mysql
);

795  
OK
;

796 
	}
}

798 
‹¡_s¦_å
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

800 
MYSQL
 *
	gmy
;

801 
MYSQL_RES
 *
	g»s
;

802 
MYSQL_ROW
 
	grow
;

803 
	grc
;

805 ià(
check_sk_s¦
())

806  
	gSKIP
;

808 
	gmy
ð
mysql_š™
(
NULL
);

809 
FAIL_IF
(!
my
, "mysql_init() failed");

811 
mysql_s¦_£t
(
my
,0, 0, 
s¦ÿ
, 0, 0);

813 
mysql_ÝtiÚs
(
my
, 
MARIADB_OPT_SSL_FP
, 
bad_û¹_fšg”_´št
);

815 
FAIL_IF
(
mysql_»®_cÚÃù
(
my
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
, 
schema
,

816 
s¦_pÜt
, 
sock‘Çme
, 0), 
mysql_”rÜ
(
my
));

818 
mysql_ÝtiÚs
(
my
, 
MARIADB_OPT_SSL_FP
, 
s¦_û¹_fšg”_´št
);

820 
FAIL_IF
(!
mysql_»®_cÚÃù
(
my
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
, 
schema
,

821 
s¦_pÜt
, 
sock‘Çme
, 0), 
mysql_”rÜ
(
my
));

823 
FAIL_IF
(
check_ch”
(
my
) != 0, "Invalid cipher");

825 
	grc
ð
mysql_qu”y
(
my
, "SET @a:=1");

826 
check_mysql_rc
(
rc
, 
my
);

828 
	grc
ð
mysql_qu”y
(
my
, "SELECT @a");

829 
check_mysql_rc
(
rc
, 
my
);

831 ià((
	g»s
ð
mysql_¡Üe_»suÉ
(
my
)))

833 
row
ð
mysql_ãtch_row
(
»s
);

834 
dŸg
("@a:=%s", 
row
[0]);

835 
mysql_ä“_»suÉ
(
»s
);

838 
mysql_þo£
(
my
);

839  
	gOK
;

842 
‹¡_s¦_å_li¡
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

844 
MYSQL
 *
	gmy
;

846 ià(
check_sk_s¦
())

847  
	gSKIP
;

849 
	gmy
ð
mysql_š™
(
NULL
);

850 
FAIL_IF
(!
my
, "mysql_init() failed");

852 
mysql_s¦_£t
(
my
,0, 0, 
s¦ÿ
, 0, 0);

854 
mysql_ÝtiÚs
(
my
, 
MARIADB_OPT_SSL_FP_LIST
, 
CERT_PATH
 "/server-cert.sha1");

856 if(!
mysql_»®_cÚÃù
(
my
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
, 
schema
,

857 
s¦_pÜt
, 
sock‘Çme
, 0))

859 
dŸg
("E¼Ü: %s", 
mysql_”rÜ
(
my
));

860 
mysql_þo£
(
my
);

861  
	gFAIL
;

864 
FAIL_IF
(
check_ch”
(
my
) != 0, "Invalid cipher");

865 
mysql_þo£
(
my
);

866  
	gOK
;

869 
‹¡_s¦_v”siÚ
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

871 
	giv”siÚ
;

872 *
	gv”siÚ
, *
	glib¿ry
;

873 
MYSQL
 *
	gmy
;

875 ià(
check_sk_s¦
())

876  
	gSKIP
;

878 
	gmy
ð
mysql_š™
(
NULL
);

879 
FAIL_IF
(!
my
, "mysql_init() failed");

881 
mysql_s¦_£t
(
my
,0, 0, 
s¦ÿ
, 0, 0);

882 
FAIL_IF
(!
mysql_»®_cÚÃù
(
my
, 
ho¡Çme
, 
s¦u£r
, 
s¦pw
, 
schema
,

883 
s¦_pÜt
, 
sock‘Çme
, 0), 
mysql_”rÜ
(
my
));

885 
dŸg
("ch”: %s", 
mysql_g‘_s¦_ch”
(
my
));

886 
m¬Ÿdb_g‘_šfov
(
my
, 
MARIADB_CONNECTION_TLS_VERSION_ID
, &
iv”siÚ
);

887 
dŸg
("´ÙocÞ: %d", 
iv”siÚ
);

888 
m¬Ÿdb_g‘_šfov
(
my
, 
MARIADB_CONNECTION_TLS_VERSION
, &
v”siÚ
);

889 
dŸg
("´ÙocÞ: %s", 
v”siÚ
);

891 
m¬Ÿdb_g‘_šfov
(
my
, 
MARIADB_TLS_LIBRARY
, &
lib¿ry
);

892 
dŸg
("lib¿ry: %s", 
lib¿ry
);

894 
mysql_þo£
(
my
);

896  
	gOK
;

899 #ifdeà
HAVE_SCHANNEL


900 
‹¡_schªÃl_ch”
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

902 
MYSQL
 *
	gmy
;

903 
	gch”_¡»ngth
= 256;

905 ià(
check_sk_s¦
())

906  
	gSKIP
;

908 
	gmy
ð
mysql_š™
(
NULL
);

909 
FAIL_IF
(!
my
, "mysql_init() failed");

911 
mysql_s¦_£t
(
my
,0, 0, 
s¦ÿ
, 0, 0);

912 
mysql_ÝtiÚs
(
my
, 
MARIADB_OPT_TLS_CIPHER_STRENGTH
, &
ch”_¡»ngth
);

913 
FAIL_IF
(!
mysql_»®_cÚÃù
(
my
, 
ho¡Çme
, 
s¦u£r
, 
s¦pw
, 
schema
,

914 
s¦_pÜt
, 
sock‘Çme
, 0), 
mysql_”rÜ
(
my
));

916 
dŸg
("ch”: %s", 
mysql_g‘_s¦_ch”
(
my
));

918 
mysql_þo£
(
my
);

920  
	gOK
;

925 #ià
defšed
(
HAVE_GNUTLS
è|| defšed(
HAVE_OPENSSL
)

927 
‹¡_ch”_m­pšg
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

929 
	gi
=0;

930 cÚ¡ *
	gch”s
[]= { "DHE-RSA-AES256-GCM-SHA384", "DHE-RSA-AES256-SHA256", "DHE-RSA-AES256-SHA",

931 #ifdeà
TEST_CAMELLIA_CIPHER


935 #ifdeà
TEST_DES_CIPHER


943 
NULL
 };

945 
dŸg
("Thisest depends on OpenSSL version - since several ciphers might‚ot be‡vailable");

946  
	gSKIP
;

948 ià(
check_sk_s¦
())

949  
	gSKIP
;

951 ià(!
	ghave_Ý’s¦
)

953 
dŸg
("test„equires Server with OpenSSL");

954  
	gSKIP
;

957 
	gch”s
[
i
] !ð
NULL
)

959 
MYSQL
 *
mysql
ð
mysql_š™
(
NULL
);

960 
MYSQL_ROW
 
	grow
;

961 
MYSQL_RES
 *
	g»s
;

962 
	gc
[100];

963 
	grc
;

964 cÚ¡ *
	gch”
;

966 
mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_TLS_VERSION
, "TLSv1.0,TLSv1.1,TLSv1.2");

967 
mysql_s¦_£t
(
mysql
, 
NULL
, NULL, NULL, NULL, 
ch”s
[
i
]);

968 
dŸg
("%s", 
ch”s
[
i
]);

970 
	gmysql
->
	gÝtiÚs
.
	gu£_s¦
= 1;

971 
FAIL_IF
(!
mysql_»®_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
, 
schema
,

972 
s¦_pÜt
, 
sock‘Çme
, 0), 
mysql_”rÜ
(
mysql
));

973 ià(!(
	gch”
ð
mysql_g‘_s¦_ch”
(
mysql
)) ||

974 
¡rcmp
(
ch”s
[
i
], 
ch”
) != 0)

976 
dŸg
("ch” % difãrs: (%s)", 
ch”s
[
i
], 
ch”
);

977 
mysql_þo£
(
mysql
);

978 
	gcÚt
;

982 
	grc
ð
mysql_qu”y
(
mysql
, "SHOW STATUS LIKE 'ssl_cipher'");

983 
check_mysql_rc
(
rc
, 
mysql
);

984 
	g»s
ð
mysql_¡Üe_»suÉ
(
mysql
);

985 
	grow
ð
mysql_ãtch_row
(
»s
);

986 
¡rýy
(
c
, 
row
[1]);

987 
mysql_ä“_»suÉ
(
»s
);

988 
mysql_þo£
(
mysql
);

989 ià(
¡rcmp
(
ch”s
[
i
], 
c
) != 0)

991 
dŸg
("ex³ùed: % š¡—d oà%s", 
ch”s
[
i
], 
c
);

996 
	gcÚt
:

997 
i
++;

999  
	gOK
;

1003 
	$‹¡_Ý’s¦_1
(
MYSQL
 *
mysql
)

1005 
rc
;

1006 
MYSQL
 *
my
;

1007 
uch¬
 
v®
= 1;

1008 
qu”y
[1024];

1009 
i
;

1011 ià(
	`check_sk_s¦
())

1012  
SKIP
;

1014 ià(
have_Žs13
)

1015  
SKIP
;

1017 ià(!
	`m¬Ÿdb_cÚÃùiÚ
(
mysql
))

1018  
SKIP
;

1020 
i
=1; i < 6; i++)

1022 
	`¥rštf
(
qu”y
, "DROP USER 's¦u£r%d'@'%s'", 
i
, 
this_ho¡
);

1023 
rc
ð
	`mysql_qu”y
(
mysql
, 
qu”y
);

1024 
	`¥rštf
(
qu”y
, "CREATE USER 's¦u£r%d'@'%s'", 
i
, 
this_ho¡
);

1025 
rc
ð
	`mysql_qu”y
(
mysql
, 
qu”y
);

1026 
	`check_mysql_rc
(
rc
, 
mysql
);

1028 
rc
ð
	`mysql_qu”y
(
mysql
, "FLUSH PRIVILEGES");

1029 
	`check_mysql_rc
(
rc
, 
mysql
);

1030 
	`dŸg
("sslusers created");

1032 
	`dŸg
("ssluser1");

1033 
	`¥rštf
(
qu”y
, "g¿Á s–eù oÀ%s.*Ø's¦u£r1'@'%s'„equœs¦", 
schema
, 
this_ho¡
);

1034 
rc
ð
	`mysql_qu”y
(
mysql
, 
qu”y
);

1035 
	`check_mysql_rc
(
rc
, 
mysql
);

1038 
my
ð
	`mysql_š™
(
NULL
);

1039 
	`mysql_s¦_£t
(
my
, 
NULL
, NULL, NULL, NULL, "AES128-SHA");

1040 
	`FAIL_IF
(!
	`mysql_»®_cÚÃù
(
my
, 
ho¡Çme
, "s¦u£r1", 
NULL
, 
schema
,

1041 
s¦_pÜt
, 
sock‘Çme
, 0), 
	`mysql_”rÜ
(
my
));

1042 
	`FAIL_IF
(!
	`mysql_g‘_s¦_ch”
(
my
), "No TLS connection");

1043 
	`mysql_þo£
(
my
);

1045 
my
ð
	`mysql_š™
(
NULL
);

1046 
	`mysql_ÝtiÚs
(
my
, 
MYSQL_OPT_SSL_ENFORCE
, &
v®
);

1047 
	`FAIL_IF
(!
	`mysql_»®_cÚÃù
(
my
, 
ho¡Çme
, "s¦u£r1", 
NULL
, 
schema
,

1048 
s¦_pÜt
, 
sock‘Çme
, 0), 
	`mysql_”rÜ
(
my
));

1049 
	`FAIL_IF
(!
	`mysql_g‘_s¦_ch”
(
my
), "No TLS connection");

1050 
	`mysql_þo£
(
my
);

1052 
	`dŸg
("ssluser2");

1053 
	`¥rštf
(
qu”y
, "g¿Á s–eù oÀ%s.*Ø's¦u£r2'@'%s'„equœch” 'AES256-SHA'", 
schema
, 
this_ho¡
);

1054 
rc
ð
	`mysql_qu”y
(
mysql
, 
qu”y
);

1055 
	`check_mysql_rc
(
rc
, 
mysql
);

1057 #ifdeà
TEST_RANDOM_RESULT


1059 
my
ð
	`mysql_š™
(
NULL
);

1060 
	`mysql_ÝtiÚs
(
my
, 
MYSQL_OPT_SSL_ENFORCE
, &
v®
);

1061 
	`mysql_»®_cÚÃù
(
my
, 
ho¡Çme
, "s¦u£r2", 
NULL
, 
schema
,

1062 
s¦_pÜt
, 
sock‘Çme
, 0);

1063 ià(!
	`mysql_”rÜ
(
my
) &&

1064 
	`¡rcmp
(
	`mysql_g‘_s¦_ch”
(
my
), "AES256-SHA"))

1066 
	`dŸg
("Expectedƒrror or correct cipher");

1067  
FAIL
;

1069 
	`mysql_þo£
(
my
);

1072 
	`dŸg
("ssluser2");

1073 ià(
	`mysql_g‘_£rv”_v”siÚ
(
mysql
) >= 100100)

1075 
my
ð
	`mysql_š™
(
NULL
);

1076 
	`mysql_s¦_£t
(
my
, 
NULL
, NULL, NULL, NULL, "AES256-SHA");

1077 
	`FAIL_IF
(!
	`mysql_»®_cÚÃù
(
my
, 
ho¡Çme
, "s¦u£r2", 
NULL
, 
schema
,

1078 
s¦_pÜt
, 
sock‘Çme
, 0), 
	`mysql_”rÜ
(
my
));

1079 
	`FAIL_IF
(
	`¡rcmp
("AES256-SHA", 
	`mysql_g‘_s¦_ch”
(
my
)) != 0, "expected cipher AES256-SHA");

1080 
	`mysql_þo£
(
my
);

1084 
	`dŸg
("ssluser2");

1085 
my
ð
	`mysql_š™
(
NULL
);

1086 
	`mysql_s¦_£t
(
my
, 
NULL
, NULL, NULL, NULL, "AES128-SHA");

1087 
	`FAIL_IF
(
	`mysql_»®_cÚÃù
(
my
, 
ho¡Çme
, "s¦u£r2", 
NULL
, 
schema
,

1088 
s¦_pÜt
, 
sock‘Çme
, 0), "Errorƒxpected");

1089 
	`mysql_þo£
(
my
);

1092 ià(!
Œavis_‹¡
)

1094 
	`¥rštf
(
qu”y
, "grant select on %s.*o 'ssluser3'@'%s'„equire cipher 'AES256-SHA' AND "

1095 " SUBJECT '/C=FI/ST=H–sški/L=H–sški/O=M¬ŸDB/CN=þ›Á'", 
schema
, 
this_ho¡
);

1096 
rc
ð
	`mysql_qu”y
(
mysql
, 
qu”y
);

1097 
	`check_mysql_rc
(
rc
, 
mysql
);

1100 
my
ð
	`mysql_š™
(
NULL
);

1101 
	`mysql_s¦_£t
(
my
, 
NULL
, NULL, NULL, NULL, "AES256-SHA");

1102 
	`FAIL_IF
(
	`mysql_»®_cÚÃù
(
my
, 
ho¡Çme
, "s¦u£r3", 
NULL
, 
schema
,

1103 
s¦_pÜt
, 
sock‘Çme
, 0), "Errorƒxpected");

1104 
	`mysql_þo£
(
my
);

1107 
my
ð
	`mysql_š™
(
NULL
);

1108 
	`mysql_s¦_£t
(
my
, 
s¦key
,

1109 
s¦û¹
,

1110 
s¦ÿ
,

1111 
NULL
,

1113 
	`FAIL_IF
(!
	`mysql_»®_cÚÃù
(
my
, 
ho¡Çme
, "s¦u£r3", 
NULL
, 
schema
,

1114 
s¦_pÜt
, 
sock‘Çme
, 0), 
	`mysql_”rÜ
(
my
));

1116 
	`mysql_þo£
(
my
);

1118 
	`¥rštf
(
qu”y
, "grant select on %s.*o 'ssluser4'@'%s'„equire cipher 'AES256-SHA' AND "

1119 " ISSUER '/CN=ÿû¹/C=FI/ST=H–sški/L=H–sški/O=M¬ŸDB'", 
schema
, 
this_ho¡
);

1120 
rc
ð
	`mysql_qu”y
(
mysql
, 
qu”y
);

1121 
	`check_mysql_rc
(
rc
, 
mysql
);

1124 
my
ð
	`mysql_š™
(
NULL
);

1125 
	`mysql_s¦_£t
(
my
, 
NULL
, NULL, NULL, NULL, "AES256-SHA");

1126 
	`FAIL_IF
(
	`mysql_»®_cÚÃù
(
my
, 
ho¡Çme
, "s¦u£r4", 
NULL
, 
schema
,

1127 
s¦_pÜt
, 
sock‘Çme
, 0), "Errorƒxpected");

1128 
	`mysql_þo£
(
my
);

1131 
my
ð
	`mysql_š™
(
NULL
);

1132 
	`mysql_s¦_£t
(
my
, 
s¦key
,

1133 
s¦û¹
,

1134 
s¦ÿ
,

1135 
NULL
,

1137 
	`FAIL_IF
(!
	`mysql_»®_cÚÃù
(
my
, 
ho¡Çme
, "s¦u£r4", 
NULL
, 
schema
,

1138 
s¦_pÜt
, 
sock‘Çme
, 0), 
	`mysql_”rÜ
(
my
));

1139 
	`mysql_þo£
(
my
);

1141 
	`dŸg
("drop users");

1142 
i
=1; i < 6; i++)

1144 
	`¥rštf
(
qu”y
, "DROP USER 's¦u£r%d'@'%s'", 
i
, 
this_ho¡
);

1145 
rc
ð
	`mysql_qu”y
(
mysql
, 
qu”y
);

1148  
OK
;

1149 
	}
}

1151 
‹¡_s¦_timeout
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

1153 
MYSQL
 *
	gmysql
;

1154 
my_boÞ
 
	g’fÜû
= 1;

1155 
	g»ad_timeout
= 1;

1156 
	grc
;

1158 ià(
check_sk_s¦
())

1159  
	gSKIP
;

1161 
	gmysql
ð
mysql_š™
(
NULL
);

1162 
mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_SSL_ENFORCE
, &
’fÜû
);

1163 
mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_READ_TIMEOUT
, &
»ad_timeout
);

1164 
	gmysql
->
	gÝtiÚs
.
	gu£_s¦
= 1;

1165 
FAIL_IF
(!
mysql_»®_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
, 
schema
,

1166 
s¦_pÜt
, 
sock‘Çme
, 0), 
mysql_”rÜ
(
mysql
));

1167 
dŸg
("ch”: %s\n", 
mysql_g‘_s¦_ch”
(
mysql
));

1168 
	grc
ð
mysql_qu”y
(
mysql
, "SELECT SLEEP(600)");

1169 ià(!
	grc
)

1171 
dŸg
("errorƒxpected (timeout)");

1172  
	gFAIL
;

1175 
mysql_þo£
(
mysql
);

1176  
	gOK
;

1179 
	$drÝ_s¦_u£r
(
MYSQL
 *
mysql
)

1181 
rc
;

1183 
rc
ð
	`mysql_qu”y
(
mysql
, "DELETE FROM mysql.user where user†ike 'ssl%'");

1184 
	`check_mysql_rc
(
rc
, 
mysql
);

1185 
rc
ð
	`mysql_qu”y
(
mysql
, "DELETE FROM mysql.db where user†ike 'ssl%'");

1186 
	`check_mysql_rc
(
rc
, 
mysql
);

1187  
OK
;

1188 
	}
}

1190 
‹¡_cÚc286
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

1192 
MYSQL
 *
	gmy
;

1194 ià(
check_sk_s¦
())

1195  
	gSKIP
;

1197 
	gmy
ð
mysql_š™
(
NULL
);

1198 
FAIL_IF
(!
my
, "mysql_init() failed");

1200 
mysql_ÝtiÚs
(
my
, 
MARIADB_OPT_SSL_FP
, 
s¦_û¹_fšg”_´št
);

1202 
FAIL_IF
(!
mysql_»®_cÚÃù
(
my
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
, 
schema
,

1203 
s¦_pÜt
, 
sock‘Çme
, 0), 
mysql_”rÜ
(
my
));

1205 
FAIL_IF
(
check_ch”
(
my
) != 0, "Invalid cipher");

1207 
mysql_þo£
(
my
);

1208  
	gOK
;

1211 
‹¡_mdev14027
(
MYSQL
 *
mysql
 
__©Œibu‹__
((
unu£d
)))

1213 *
	gŽs_lib¿ry
;

1214 cÚ¡ *
	gcheck_lib¿ry
=

1215 #ià
defšed
(
HAVE_OPENSSL
)

1216 #ià
defšed
(
HAVE_LIBRESSL
)

1221 #–ià
defšed
(
HAVE_GNUTLS
)

1223 #–ià
defšed
(
HAVE_SCHANNEL
)

1228 
m¬Ÿdb_g‘_šfov
(
NULL
, 
MARIADB_TLS_LIBRARY
, &
Žs_lib¿ry
);

1229 
dŸg
("TLS/SSL†ib¿ry iÀu£: %s\n", 
Žs_lib¿ry
);

1230 ià(!
¡r¡r
(
Žs_lib¿ry
, 
check_lib¿ry
))

1232 
dŸg
("ex³ùed %s, gÙ %s", 
check_lib¿ry
, 
Žs_lib¿ry
);

1233  
	gFAIL
;

1235  
	gOK
;

1238 
‹¡_mdev14101
(
MYSQL
 *
my
 
__©Œibu‹__
((
unu£d
)))

1241 
boÞ
 
	gdo_yas¦
;

1242 cÚ¡ *
	gÝt_Žs_v”siÚ
;

1243 cÚ¡ *
	gex³ùed
;

1244 } 
	gcombš©iÚs
[]= {

1249 {1, 
NULL
, NULL}

1252 
	gi
;

1253 #ifdeà
HAVE_SCHANNEL


1254 
boÞ
 
	gsk_Žsv12
= 1;

1256 
boÞ
 
	gsk_Žsv12
ð!
have_Ý’s¦
;

1259 #ià
defšed
(
HAVE_OPENSSL
è&& defšed(
TLS1_3_VERSION
)

1260 
dŸg
("Test fails with TLS v1.3");

1261 (
	gSKIP
);

1264 
	gi
=0; 
	gcombš©iÚs
[
i
].
	gex³ùed
; i++)

1266 
MYSQL
 *
	gmysql
;

1267 
boÞ
 
	gv®
=1;

1268 *
	gŽs_v”siÚ
;

1270 ià(!
	gcombš©iÚs
[
i
].
	gdo_yas¦
 && 
	gsk_Žsv12
)

1273 
dŸg
("combš©iÚ %d: %s", 
i
, 
combš©iÚs
[i].
Ýt_Žs_v”siÚ
);

1275 
	gmysql
ð
mysql_š™
(
NULL
);

1276 
mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_SSL_ENFORCE
, &
v®
);

1277 
mysql_ÝtiÚs
(
mysql
, 
MARIADB_OPT_TLS_VERSION
, 
combš©iÚs
[
i
].
Ýt_Žs_v”siÚ
);

1278 
FAIL_IF
(!
mysql_»®_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
, 
schema
,

1279 
s¦_pÜt
, 
sock‘Çme
, 0), 
mysql_”rÜ
(
mysql
));

1280 
m¬Ÿdb_g‘_šfov
(
mysql
, 
MARIADB_CONNECTION_TLS_VERSION
, &
Žs_v”siÚ
);

1281 
dŸg
("ÝtiÚs: %s", 
combš©iÚs
[
i
].
Ýt_Žs_v”siÚ
);

1282 
dŸg
("´ÙocÞ: % ex³ùed: %s", 
Žs_v”siÚ
, 
combš©iÚs
[
i
].
ex³ùed
);

1283 
FAIL_IF
(
¡rcmp
(
combš©iÚs
[
i
].
ex³ùed
, 
Žs_v”siÚ
), "Wrongls_version");

1284 
mysql_þo£
(
mysql
);

1286  
	gOK
;

1289 
	$‹¡_cÚc386
(
MYSQL
 *
mysql
)

1291 
mysql
ð
	`mysql_š™
(
NULL
);

1292 
	`mysql_s¦_£t
(
mysql
,

1293 
s¦combšed
,

1294 
NULL
,

1295 
NULL
,

1296 
NULL
,

1297 
NULL
);

1298 
	`FAIL_IF
(!
	`mysql_»®_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
, 
schema
,

1299 
s¦_pÜt
, 
sock‘Çme
, 0), 
	`mysql_”rÜ
(
mysql
));

1300 
	`FAIL_IF
(
	`check_ch”
(
mysql
) != 0, "Invalid cipher");

1301 
	`mysql_þo£
(
mysql
);

1302  
OK
;

1303 
	}
}

1305 #iâdeà
HAVE_SCHANNEL


1306 
‹¡_s¦_v”ify
(
MYSQL
 *
my
 
__©Œibu‹__
((
unu£d
)))

1308 
MYSQL
 *
	gmysql
;

1309 
my_boÞ
 
	gv”ify
ð1, 
	g’fÜû
= 1;

1311 ià(
check_sk_s¦
())

1312  
	gSKIP
;

1315 
	gmysql
ð
mysql_š™
(
NULL
);

1316 
mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_SSL_ENFORCE
, &
’fÜû
);

1317 
mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_SSL_VERIFY_SERVER_CERT
, &
v”ify
);

1318 
FAIL_IF
(
mysql_»®_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
, 
schema
,

1319 
s¦_pÜt
, 
sock‘Çme
, 0), "Errorƒxpected");

1320 
dŸg
("”rÜƒx³ùed: %s\n", 
mysql_”rÜ
(
mysql
));

1321 
mysql_þo£
(
mysql
);

1337 
	gmysql
ð
mysql_š™
(
NULL
);

1338 
mysql_s¦_£t
(
mysql
,0, 0, 
s¦ÿ
, 0, 0);

1339 
mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_SSL_VERIFY_SERVER_CERT
, &
v”ify
);

1340 
FAIL_IF
(!
mysql_»®_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
, 
schema
,

1341 
s¦_pÜt
, 
sock‘Çme
, 0), 
mysql_”rÜ
(
mysql
));

1342 
mysql_þo£
(
mysql
);

1344 
	gmysql
ð
mysql_š™
(
NULL
);

1345 
mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_SSL_ENFORCE
, &
’fÜû
);

1346 
FAIL_IF
(!
mysql_»®_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
, 
schema
,

1347 
s¦_pÜt
, 
sock‘Çme
, 0), 
mysql_”rÜ
(
mysql
));

1349 
dŸg
("ch”: %s", 
mysql_g‘_s¦_ch”
(
mysql
));

1350 
mysql_þo£
(
mysql
);

1351  
	gOK
;

1355 
my_‹¡s_¡
 
	gmy_‹¡s
[] = {

1356 {"‹¡_s¦", 
‹¡_s¦
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1357 #iâdeà
HAVE_SCHANNEL


1358 {"‹¡_s¦_v”ify", 
‹¡_s¦_v”ify
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1360 {"‹¡_mdev14101", 
‹¡_mdev14101
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1361 {"‹¡_mdev14027", 
‹¡_mdev14027
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1362 {"‹¡_cÚc286", 
‹¡_cÚc286
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1363 {"‹¡_s¦_timeout", 
‹¡_s¦_timeout
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1364 {"‹¡_Ý’s¦_1", 
‹¡_Ý’s¦_1
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1365 #iâdeà
HAVE_SCHANNEL


1366 {"‹¡_ch”_m­pšg", 
‹¡_ch”_m­pšg
, 
TEST_CONNECTION_NONE
, 0, 
NULL
, NULL},

1368 {"‹¡_cÚc127", 
‹¡_cÚc127
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1371 #iâdeà
HAVE_SCHANNEL


1372 {"‹¡_s¦_å", 
‹¡_s¦_å
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1373 {"‹¡_s¦_å_li¡", 
‹¡_s¦_å_li¡
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1375 {"‹¡_cÚc50", 
‹¡_cÚc50
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1376 {"‹¡_cÚc50_1", 
‹¡_cÚc50_1
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1377 {"‹¡_cÚc50_2", 
‹¡_cÚc50_2
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1378 {"‹¡_cÚc50_3", 
‹¡_cÚc50_3
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1379 {"‹¡_cÚc50_4", 
‹¡_cÚc50_4
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1380 {"‹¡_cÚc95", 
‹¡_cÚc95
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1381 {"v”ify_s¦_£rv”_û¹", 
v”ify_s¦_£rv”_û¹
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1382 {"‹¡_bug62743", 
‹¡_bug62743
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1383 {"‹¡_phpbug51647", 
‹¡_phpbug51647
, 
TEST_CONNECTION_NONE
, 0, 
NULL
, NULL},

1384 {"‹¡_s¦_ch”", 
‹¡_s¦_ch”
, 
TEST_CONNECTION_NONE
, 0, 
NULL
, NULL},

1385 {"‹¡_muÉi_s¦_cÚÃùiÚs", 
‹¡_muÉi_s¦_cÚÃùiÚs
, 
TEST_CONNECTION_NONE
, 0, 
NULL
, NULL},

1386 {"‹¡_cÚc_102", 
‹¡_cÚc_102
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1387 {"‹¡_s¦_v”siÚ", 
‹¡_s¦_v”siÚ
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1388 {"‹¡_s¦_th»ads", 
‹¡_s¦_th»ads
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1389 #iâdeà
HAVE_SCHANNEL


1390 {"‹¡_·sswÜd_´Ùeùed", 
‹¡_·sswÜd_´Ùeùed
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1392 {"‹¡_schªÃl_ch”", 
‹¡_schªÃl_ch”
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1394 {"‹¡_cÚc386", 
‹¡_cÚc386
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1395 {"drÝ_s¦_u£r", 
drÝ_s¦_u£r
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

1396 {
NULL
, NULL, 0, 0, NULL, NULL}

1400 
	$maš
(
¬gc
, **
¬gv
)

1402 #ià
	`defšed
(
WIN32
è&& defšed(
HEAP_CHECK
)

1403 
	`_C¹S‘R•ÜtMode
Ð
_CRT_WARN
, 
_CRTDBG_MODE_FILE
 );

1404 
	`_C¹S‘R•ÜtFže
Ð
_CRT_WARN
, 
_CRTDBG_FILE_STDOUT
 );

1405 
	`_C¹S‘R•ÜtMode
Ð
_CRT_ERROR
, 
_CRTDBG_MODE_FILE
 );

1406 
	`_C¹S‘R•ÜtFže
Ð
_CRT_ERROR
, 
_CRTDBG_FILE_STDOUT
 );

1407 
	`_C¹S‘R•ÜtMode
Ð
_CRT_ASSERT
, 
_CRTDBG_MODE_FILE
 );

1408 
	`_C¹S‘R•ÜtFže
Ð
_CRT_ASSERT
, 
_CRTDBG_FILE_STDOUT
 );

1411 
	`g‘_’vv¬s
();

1412 
	`»ad_fšg”´št
();

1414 ià(
¬gc
 > 1)

1415 
	`g‘_ÝtiÚs
(
¬gc
, 
¬gv
);

1416 
	`run_‹¡s
(
my_‹¡s
);

1418 
	`mysql_£rv”_’d
();

1419 #ià
	`defšed
(
WIN32
è&& defšed(
HEAP_CHECK
)

1420 
	`_C¹DumpMemÜyL—ks
();

1422 (
	`ex™_¡©us
());

1423 
	}
}

	@unittest/libmariadb/t_aurora.c

4 
	~"my_‹¡.h
"

5 
	~"ma_pvio.h
"

7 
aurÜa1
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

9 
	grc
;

10 
my_boÞ
 
	g»ad_Úly
= 1;

11 *
	g´im¬y
, *
	gmy_schema
;

12 
MYSQL_RES
 *
	g»s
;

13 
MYSQL
 *
	gmysql
ð
mysql_š™
(
NULL
);

15 ià(!
mysql_»®_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
, 
schema
, 
pÜt
, 
NULL
, 0))

17 
dŸg
("E¼Ü: %s", 
mysql_”rÜ
(
mysql
));

18 
mysql_þo£
(
mysql
);

19  
	gFAIL
;

22 
	grc
ð
mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1");

23 
check_mysql_rc
(
rc
, 
mysql
);

25 
	grc
ð
mysql_qu”y
(
mysql
, "CREATE TABLE1 (a int, b varchar(20))");

26 
check_mysql_rc
(
rc
, 
mysql
);

28 
	grc
ð
mysql_qu”y
(
mysql
, "INSERT INTO1 VALUES (1, 'foo'), (2, 'bar')");

29 
check_mysql_rc
(
rc
, 
mysql
);

31 
m¬Ÿdb_g‘_šfov
(
mysql
, 
MARIADB_CONNECTION_HOST
, &
´im¬y
);

32 
dŸg
("´im¬y: %s", 
´im¬y
);

34 
mysql_ÝtiÚs
(
mysql
, 
MARIADB_OPT_CONNECTION_READ_ONLY
, &
»ad_Úly
);

37 
	grc
ð
mysql_qu”y
(
mysql
, "INSERT INTO1 VALUES (3, 'error')");

38 ià(
	grc
)

39 
dŸg
("Ex³ùedƒ¼Ü: %s", 
mysql_”rÜ
(
mysql
));

41 
	grc
ð
mysql_qu”y
(
mysql
, "SELECT‡, b FROM1");

42 
check_mysql_rc
(
rc
, 
mysql
);

44 
	g»s
ð
mysql_¡Üe_»suÉ
(
mysql
);

46 
dŸg
("Num_rows: %Îd", 
mysql_num_rows
(
»s
));

47 
mysql_ä“_»suÉ
(
»s
);

49 
m¬Ÿdb_g‘_šfov
(
mysql
, 
MARIADB_CONNECTION_SCHEMA
, &
my_schema
);

50 
dŸg
("db: %s", 
my_schema
);

52 
mysql_þo£
(
mysql
);

54  
	gOK
;

57 
‹¡_wrÚg_u£r
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

59 
MYSQL
 *
	gmysql
ð
mysql_š™
(
NULL
);

61 ià(
mysql_»®_cÚÃù
(
mysql
, 
ho¡Çme
, "wrÚg_u£r", 
NULL
, NULL, 0, NULL, 0))

63 
dŸg
("Errorƒxpected");

64 
mysql_þo£
(
mysql
);

65  
	gFAIL
;

67 
mysql_þo£
(
mysql
);

68  
	gOK
;

71 
‹¡_»cÚÃù
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

73 
MYSQL
 *
	gmysql
ð
mysql_š™
(
NULL
);

74 
MYSQL_RES
 *
	g»s
;

75 
my_boÞ
 
	g»ad_Úly
= 1;

76 
	grc
;

77 
my_boÞ
 
	g»cÚÃù
= 1;

78 *
	gaurÜa_ho¡
;

80 
mysql_ÝtiÚs
(
mysql
, 
MYSQL_OPT_RECONNECT
, &
»cÚÃù
);

82 ià(!
mysql_»®_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
, 
schema
, 
pÜt
, 
NULL
, 0))

84 
dŸg
("E¼Ü: %s", 
mysql_”rÜ
(
mysql
));

85 
mysql_þo£
(
mysql
);

86  
	gFAIL
;

89 
m¬Ÿdb_g‘_šfov
(
mysql
, 
MARIADB_CONNECTION_HOST
, &
aurÜa_ho¡
);

90 
dŸg
("ho¡: %s", 
aurÜa_ho¡
);

92 
	grc
ð
mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSx01");

93 
check_mysql_rc
(
rc
, 
mysql
);

94 
	grc
ð
mysql_qu”y
(
mysql
, "CREATE TABLEx01 (a int)");

95 
check_mysql_rc
(
rc
, 
mysql
);

100 
	grc
ð
sy¡em
("/usr/local/aws/bin/aws„ds failover-db-cluster --db-cluster-identifier instance-1-cluster");

102 
dŸg
("aw »tuº code: %d", 
rc
);

104 
¦“p
(50);

105 
dŸg
("Q1");

106 
	grc
ð
mysql_qu”y
(
mysql
, "INSERT INTOx01 VALUES (1)");

107 ià(!
	grc
)

108 
dŸg
("errorƒxpected!");

109 
dŸg
("E¼Ü: %s", 
mysql_”rÜ
(
mysql
));

111 
dŸg
("Q2");

112 
	grc
ð
mysql_qu”y
(
mysql
, "INSERT INTOx01 VALUES (1)");

113 ià(
	grc
)

115 
dŸg
("noƒrrorƒxpected!");

116 
dŸg
("E¼Ü: %s", 
mysql_”rÜ
(
mysql
));

117 
dŸg
("ho¡: %s", 
mysql
->
ho¡
);

121 
m¬Ÿdb_g‘_šfov
(
mysql
, 
MARIADB_CONNECTION_HOST
, &
aurÜa_ho¡
);

122 
dŸg
("ho¡: %s", 
aurÜa_ho¡
);

125 
mysql_ÝtiÚs
(
mysql
, 
MARIADB_OPT_CONNECTION_READ_ONLY
, &
»ad_Úly
);

127 
	grc
ð
mysql_qu”y
(
mysql
, "SELECT * fromx01");

128 
check_mysql_rc
(
rc
, 
mysql
);

130 ià((
	g»s
ð
mysql_¡Üe_»suÉ
(
mysql
)))

132 
dŸg
("num_rows: %Îd", 
mysql_num_rows
(
»s
));

133 
mysql_ä“_»suÉ
(
»s
);

136 
m¬Ÿdb_g‘_šfov
(
mysql
, 
MARIADB_CONNECTION_HOST
, &
aurÜa_ho¡
);

137 
dŸg
("ho¡: %s", 
aurÜa_ho¡
);

139 
mysql_þo£
(
mysql
);

140  
	gOK
;

143 
my_‹¡s_¡
 
	gmy_‹¡s
[] = {

144 {"aurÜa1", 
aurÜa1
, 
TEST_CONNECTION_NONE
, 0, 
NULL
, NULL},

145 {"‹¡_wrÚg_u£r", 
‹¡_wrÚg_u£r
, 
TEST_CONNECTION_NONE
, 0, 
NULL
, NULL},

146 {"‹¡_»cÚÃù", 
‹¡_»cÚÃù
, 
TEST_CONNECTION_NONE
, 0, 
NULL
, NULL},

147 {
NULL
, NULL, 0, 0, NULL, NULL}

151 
	$maš
(
¬gc
, **
¬gv
)

153 
	`mysql_lib¿ry_š™
(0,0,
NULL
);

155 ià(
¬gc
 > 1)

156 
	`g‘_ÝtiÚs
(
¬gc
, 
¬gv
);

158 
	`g‘_’vv¬s
();

160 
	`run_‹¡s
(
my_‹¡s
);

162 
	`mysql_£rv”_’d
();

163 (
	`ex™_¡©us
());

164 
	}
}

	@unittest/libmariadb/t_conc173.c

28 
	~"my_‹¡.h
"

30 
‹¡_cÚc_173
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

32 
MYSQL
 
	gmysql
;

33 
	g¬g
;

34 
	gi
=0;

38 
mysql_š™
(&
mysql
);

39 
mysql_ÝtiÚs
(&
mysql
, 
MYSQL_READ_DEFAULT_GROUP
, "client");

40 
mysql_ÝtiÚs
(&
mysql
, 
MYSQL_OPT_COMPRESS
, 0);

42 
mysql_ÝtiÚs
(&
mysql
, 
MYSQL_OPT_NAMED_PIPE
, 0);

44 
	g¬g
 = 
MYSQL_PROTOCOL_SOCKET
;

46 
mysql_ÝtiÚs
(&
mysql
, 
MYSQL_OPT_PROTOCOL
, &
¬g
);

48 if(!
mysql_»®_cÚÃù
(&
mysql
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
, 
schema
, 0, 0, 0)) {

49 
årštf
(
¡d”r
, "FažedØcÚÃùØd©aba£‡á” %d i‹¿tiÚs: E¼Ü: %s\n", 
i
, 
mysql_”rÜ
(&
mysql
));

52 
mysql_þo£
(&
mysql
);

54  
	gOK
;

57 
my_‹¡s_¡
 
	gmy_‹¡s
[] = {

58 {"‹¡_cÚc_173", 
‹¡_cÚc_173
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
, NULL},

62 
	$maš
(
¬gc
, **
¬gv
)

64 ià(
¬gc
 > 1)

65 
	`g‘_ÝtiÚs
(
¬gc
, 
¬gv
);

67 
	`g‘_’vv¬s
();

69 
	`run_‹¡s
(
my_‹¡s
);

71 (
	`ex™_¡©us
());

72 
	}
}

	@unittest/libmariadb/thread.c

4 
	~"my_‹¡.h
"

5 
	~<ma_±h»ad.h
>

7 
basic_cÚÃù
(
MYSQL
 *
unu£d
 
__©Œibu‹__
((unused)))

9 
MYSQL_ROW
 
	grow
;

10 
MYSQL_RES
 *
	g»s
;

11 
MYSQL_FIELD
 *
	gf›ld
;

12 
	grc
;

14 
MYSQL
 *
	gmy
ð
mysql_š™
(
NULL
);

15 
FAIL_IF
(!
my
, "mysql_init() failed");

17 
FAIL_IF
(!
my_‹¡_cÚÃù
(
my
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
, 
schema
,

18 
pÜt
, 
sock‘Çme
, 0), 
mysql_”rÜ
(
my
));

20 
	grc
ð
mysql_qu”y
(
my
, "SELECT @@version");

21 
check_mysql_rc
(
rc
, 
my
);

23 
	g»s
ð
mysql_¡Üe_»suÉ
(
my
);

24 
FAIL_IF
(!
»s
, 
mysql_”rÜ
(
my
));

25 
	gf›ld
ð
mysql_ãtch_f›lds
(
»s
);

26 
FAIL_IF
(!
f›ld
, "Couldn't fetch fields");

28 (
	grow
ð
mysql_ãtch_row
(
»s
)è!ð
NULL
)

30 
FAIL_IF
(
mysql_num_f›lds
(
»s
) != 1, "Gothe wrong‚umber of fields");

32 
FAIL_IF
(
mysql_”ºo
(
my
), 
mysql_”rÜ
(my));

34 
mysql_ä“_»suÉ
(
»s
);

35 
mysql_þo£
(
my
);

38  
	gOK
;

41 
±h»ad_mu‹x_t
 
	gLOCK_‹¡
;

43 #iâdeà
_WIN32


44 
th»ad_cÚc27
();

46 
DWORD
 
WINAPI
 
th»ad_cÚc27
();

49 
	#THREAD_NUM
 100

	)

52 
	$‹¡_cÚc_27
(
MYSQL
 *
mysql
)

55 
rc
;

56 
i
;

57 
MYSQL_ROW
 
row
;

58 
MYSQL_RES
 *
»s
;

59 #iâdeà
_WIN32


60 
±h»ad_t
 
th»ads
[
THREAD_NUM
];

62 
HANDLE
 
hth»ads
[
THREAD_NUM
];

63 
DWORD
 
th»ads
[
THREAD_NUM
];

66 
	`dŸg
("please„unhisest manually‡s„oot");

67  
SKIP
;

69 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS_conc27");

70 
	`check_mysql_rc
(
rc
, 
mysql
);

72 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE_conc27(a int)");

73 
	`check_mysql_rc
(
rc
, 
mysql
);

75 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTO_conc27 VALUES(0)");

76 
	`check_mysql_rc
(
rc
, 
mysql
);

78 
rc
ð
	`mysql_qu”y
(
mysql
, "SET @a:=@@max_connections");

79 
	`check_mysql_rc
(
rc
, 
mysql
);

81 
rc
ð
	`mysql_qu”y
(
mysql
, "SET GLOBAL max_connections=100000");

82 
	`check_mysql_rc
(
rc
, 
mysql
);

84 
	`±h»ad_mu‹x_š™
(&
LOCK_‹¡
, 
NULL
);

85 
i
=0; i < 
THREAD_NUM
; i++)

87 #iâdeà
_WIN32


88 
	`±h»ad_ü—‹
(&
th»ads
[
i
], 
NULL
, (*)
th»ad_cÚc27
, NULL);

90 
hth»ads
[
i
]ð
	`C»©eTh»ad
(
NULL
, 0, (
LPTHREAD_START_ROUTINE
)
th»ad_cÚc27
, NULL, 0, &
th»ads
[i]);

91 ià(
hth»ads
[
i
]==
NULL
)

92 
	`dŸg
("error while startinghread");

95 
i
=0; i < 
THREAD_NUM
; i++)

97 #iâdeà
_WIN32


98 
	`±h»ad_još
(
th»ads
[
i
], 
NULL
);

100 
	`Wa™FÜSšgËObjeù
(
hth»ads
[
i
], 
INFINITE
);

104 
	`±h»ad_mu‹x_de¡roy
(&
LOCK_‹¡
);

106 
rc
ð
	`mysql_qu”y
(
mysql
, "SET GLOBAL max_connections=@a");

107 
	`check_mysql_rc
(
rc
, 
mysql
);

109 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT‡ FROM_conc27");

110 
	`check_mysql_rc
(
rc
,
mysql
);

112 
»s
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

113 
	`FAIL_IF
(!
»s
, "invalid„esult");

115 
row
ð
	`mysql_ãtch_row
(
»s
);

116 
	`FAIL_IF
(!
row
, "can't fetch„ow");

118 
	`dŸg
("row=%s", 
row
[0]);

119 
	`FAIL_IF
(
	`©oi
(
row
[0]è!ð
THREAD_NUM
, "expected value THREAD_NUM");

120 
	`mysql_ä“_»suÉ
(
»s
);

121 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE_conc27");

122 
	`check_mysql_rc
(
rc
,
mysql
);

124  
OK
;

125 
	}
}

127 #iâdeà
_WIN32


128 
	$th»ad_cÚc27
()

130 
DWORD
 
WINAPI
 
	$th»ad_cÚc27
()

133 
MYSQL
 *
mysql
;

134 
rc
;

135 
MYSQL_RES
 *
»s
;

136 
	`mysql_th»ad_š™
();

137 
mysql
ð
	`mysql_š™
(
NULL
);

138 if(!
	`my_‹¡_cÚÃù
(
mysql
, 
ho¡Çme
, 
u£ºame
, 
·sswÜd
, 
schema
,

139 
pÜt
, 
sock‘Çme
, 0))

141 
	`dŸg
(">E¼Ü: %s", 
	`mysql_”rÜ
(
mysql
));

142 
	`mysql_þo£
(
mysql
);

143 
	`mysql_th»ad_’d
();

144 
’d
;

146 
	`±h»ad_mu‹x_lock
(&
LOCK_‹¡
);

147 
rc
ð
	`mysql_qu”y
(
mysql
, "UPDATE_conc27 SET‡=a+1");

148 
	`check_mysql_rc
(
rc
, 
mysql
);

149 
	`±h»ad_mu‹x_uÆock
(&
LOCK_‹¡
);

150 
	`check_mysql_rc
(
rc
, 
mysql
);

151 ià((
»s
ð
	`mysql_¡Üe_»suÉ
(
mysql
)))

152 
	`mysql_ä“_»suÉ
(
»s
);

153 
	`mysql_þo£
(
mysql
);

154 
’d
:

155 
	`mysql_th»ad_’d
();

157 
	}
}

159 
my_‹¡s_¡
 
	gmy_‹¡s
[] = {

160 {"basic_cÚÃù", 
basic_cÚÃù
, 
TEST_CONNECTION_NONE
, 0, 
NULL
, NULL},

161 {"‹¡_cÚc_27", 
‹¡_cÚc_27
, 
TEST_CONNECTION_NEW
, 0, 
NULL
, NULL},

162 {
NULL
, NULL, 0, 0, NULL, NULL}

166 
	$maš
(
¬gc
, **
¬gv
)

169 
	`mysql_lib¿ry_š™
(0,0,
NULL
);

171 ià(
¬gc
 > 1)

172 
	`g‘_ÝtiÚs
(
¬gc
, 
¬gv
);

174 
	`g‘_’vv¬s
();

176 
	`run_‹¡s
(
my_‹¡s
);

178 
	`mysql_£rv”_’d
();

179 (
	`ex™_¡©us
());

180 
	}
}

	@unittest/libmariadb/view.c

24 
	~"my_‹¡.h
"

26 
	$‹¡_v›w
(
MYSQL
 *
mysql
)

28 
MYSQL_STMT
 *
¡mt
;

29 
rc
, 
i
;

30 
MYSQL_BIND
 
my_bšd
[1];

31 
¡r_d©a
[50];

32 
ulÚg
 
Ëngth
 = 0L;

33 
my_boÞ
 
is_nuÎ
 = 0;

34 cÚ¡ *
qu”y
=

37 
rc
 = 
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1,t2,t3,v1");

38 
	`check_mysql_rc
(
rc
, 
mysql
);

40 
rc
 = 
	`mysql_qu”y
(
mysql
, "DROP VIEW IF EXISTS v1,t1,t2,t3");

41 
	`check_mysql_rc
(
rc
, 
mysql
);

42 
rc
ð
	`mysql_qu”y
(
mysql
,"CREATE TABLE1 ("

47 
	`check_mysql_rc
(
rc
, 
mysql
);

48 
rc
ð
	`mysql_qu”y
(
mysql
,"CREATE TABLE2 ("

53 
	`check_mysql_rc
(
rc
, 
mysql
);

54 
rc
ð
	`mysql_qu”y
(
mysql
,

65 
	`check_mysql_rc
(
rc
, 
mysql
);

66 
rc
ð
	`mysql_qu”y
(
mysql
,"CREATE VIEW v1 AS select sql_no_cache"

74 
	`check_mysql_rc
(
rc
, 
mysql
);

76 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

77 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

78 
	`check_¡mt_rc
(
rc
, 
¡mt
);

80 
	`¡rýy
(
¡r_d©a
, "TEST");

81 
	`mem£t
(
my_bšd
, '\0', (
MYSQL_BIND
));

82 
my_bšd
[0].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

83 
my_bšd
[0].
bufãr
ð(*)&
¡r_d©a
;

84 
my_bšd
[0].
bufãr_Ëngth
= 50;

85 
my_bšd
[0].
Ëngth
= &length;

86 
Ëngth
= 4;

87 
my_bšd
[0].
is_nuÎ
= &is_null;

88 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

89 
	`check_¡mt_rc
(
rc
, 
¡mt
);

91 
i
= 0; i < 3; i++)

93 
rowcouÁ
= 0;

95 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

96 
	`check_¡mt_rc
(
rc
, 
¡mt
);

98 
	`mysql_¡mt_ãtch
(
¡mt
è!ð
MYSQL_NO_DATA
)

99 
rowcouÁ
++;

100 
	`FAIL_IF
(
rowcouÁ
 != 1, "Expected 1„ow");

102 
	`mysql_¡mt_þo£
(
¡mt
);

104 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE1,t2,t3");

105 
	`check_mysql_rc
(
rc
, 
mysql
);

106 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP VIEW v1");

107 
	`check_mysql_rc
(
rc
, 
mysql
);

109  
OK
;

110 
	}
}

113 
	$‹¡_v›w_wh”e
(
MYSQL
 *
mysql
)

115 
MYSQL_STMT
 *
¡mt
;

116 
rc
, 
i
;

117 cÚ¡ *
qu”y
=

120 
rc
 = 
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1,v1,v2");

121 
	`check_mysql_rc
(
rc
, 
mysql
);

123 
rc
 = 
	`mysql_qu”y
(
mysql
, "DROP VIEW IF EXISTS v1,v2,t1");

124 
	`check_mysql_rc
(
rc
, 
mysql
);

125 
rc
ð
	`mysql_qu”y
(
mysql
,"CREATE TABLE1 (a int, b int)");

126 
	`check_mysql_rc
(
rc
, 
mysql
);

127 
rc
ð
	`mysql_qu”y
(
mysql
,"insert into1 values (1,2), (1,3), (2,4), (2,5), (3,10)");

128 
	`check_mysql_rc
(
rc
, 
mysql
);

129 
rc
ð
	`mysql_qu”y
(
mysql
,"create view v1 (c)‡s select b from1 where‡<3");

130 
	`check_mysql_rc
(
rc
, 
mysql
);

131 
rc
ð
	`mysql_qu”y
(
mysql
,"create view v2 (c)‡s select b from1 where‡>=3");

132 
	`check_mysql_rc
(
rc
, 
mysql
);

134 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

135 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

136 
	`check_¡mt_rc
(
rc
, 
¡mt
);

138 
i
= 0; i < 3; i++)

140 
rowcouÁ
= 0;

142 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

143 
	`check_¡mt_rc
(
rc
, 
¡mt
);

144 
	`mysql_¡mt_ãtch
(
¡mt
è!ð
MYSQL_NO_DATA
)

145 
rowcouÁ
++;

146 
	`FAIL_UNLESS
(4 =ð
rowcouÁ
, "Expected 4„ows");

148 
	`mysql_¡mt_þo£
(
¡mt
);

150 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE1");

151 
	`check_mysql_rc
(
rc
, 
mysql
);

152 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP VIEW v1, v2");

153 
	`check_mysql_rc
(
rc
, 
mysql
);

155  
OK
;

156 
	}
}

159 
	$‹¡_v›w_2wh”e
(
MYSQL
 *
mysql
)

161 
MYSQL_STMT
 *
¡mt
;

162 
rc
, 
i
;

163 
MYSQL_BIND
 
my_bšd
[8];

164 
·¿ms
[8][100];

165 
ulÚg
 
Ëngth
[8];

166 cÚ¡ *
qu”y
=

172 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS LTDX");

173 
	`check_mysql_rc
(
rc
, 
mysql
);

174 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP VIEW IF EXISTS V_LTDX");

175 
	`check_mysql_rc
(
rc
, 
mysql
);

176 
rc
ð
	`mysql_qu”y
(
mysql
,

196 
	`check_mysql_rc
(
rc
, 
mysql
);

197 
rc
ð
	`mysql_qu”y
(
mysql
,

208 
	`check_mysql_rc
(
rc
, 
mysql
);

209 
	`mem£t
(
my_bšd
, '\0', (
MYSQL_BIND
));

210 
i
=0; i < 8; i++) {

211 
	`¡rýy
(
·¿ms
[
i
], "1");

212 
my_bšd
[
i
].
bufãr_ty³
 = 
MYSQL_TYPE_VAR_STRING
;

213 
my_bšd
[
i
].
bufãr
 = (*)&
·¿ms
[i];

214 
my_bšd
[
i
].
bufãr_Ëngth
 = 1;

215 
my_bšd
[
i
].
is_nuÎ
 = 0;

216 
Ëngth
[
i
] = 1;

217 
my_bšd
[
i
].
Ëngth
 = &length[i];

219 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

220 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

221 
	`check_¡mt_rc
(
rc
, 
¡mt
);

223 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

224 
	`check_¡mt_rc
(
rc
, 
¡mt
);

226 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

227 
	`check_¡mt_rc
(
rc
, 
¡mt
);

229 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

230 
	`FAIL_UNLESS
(
MYSQL_NO_DATA
 =ð
rc
, "Expected 0„ows");

232 
	`mysql_¡mt_þo£
(
¡mt
);

234 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP VIEW V_LTDX");

235 
	`check_mysql_rc
(
rc
, 
mysql
);

236 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE LTDX");

237 
	`check_mysql_rc
(
rc
, 
mysql
);

239  
OK
;

240 
	}
}

243 
	$‹¡_v›w_¡¬
(
MYSQL
 *
mysql
)

245 
MYSQL_STMT
 *
¡mt
;

246 
rc
, 
i
;

247 
MYSQL_BIND
 
my_bšd
[8];

248 
·¿ms
[8][100];

249 
ulÚg
 
Ëngth
[8];

250 cÚ¡ *
qu”y
= "SELECT * FROM vt1 WHERE‡ IN (?,?)";

252 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1, vt1");

253 
	`check_mysql_rc
(
rc
, 
mysql
);

254 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP VIEW IF EXISTS1, vt1");

255 
	`check_mysql_rc
(
rc
, 
mysql
);

256 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLE1 (a int)");

257 
	`check_mysql_rc
(
rc
, 
mysql
);

258 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE VIEW vt1 AS SELECT‡ FROM1");

259 
	`check_mysql_rc
(
rc
, 
mysql
);

260 
	`mem£t
(
my_bšd
, '\0', (
MYSQL_BIND
));

261 
i
= 0; i < 2; i++) {

262 
	`¥rštf
((*)&
·¿ms
[
i
], "%d", i);

263 
my_bšd
[
i
].
bufãr_ty³
 = 
MYSQL_TYPE_VAR_STRING
;

264 
my_bšd
[
i
].
bufãr
 = (*)&
·¿ms
[i];

265 
my_bšd
[
i
].
bufãr_Ëngth
 = 100;

266 
my_bšd
[
i
].
is_nuÎ
 = 0;

267 
my_bšd
[
i
].
Ëngth
 = &length[i];

268 
Ëngth
[
i
] = 1;

271 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

272 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

273 
	`check_¡mt_rc
(
rc
, 
¡mt
);

275 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

276 
	`check_¡mt_rc
(
rc
, 
¡mt
);

278 
i
= 0; i < 3; i++)

280 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

281 
	`check_¡mt_rc
(
rc
, 
¡mt
);

282 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

283 
	`FAIL_UNLESS
(
MYSQL_NO_DATA
 =ð
rc
, "Expected 0„ows");

286 
	`mysql_¡mt_þo£
(
¡mt
);

288 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE1");

289 
	`check_mysql_rc
(
rc
, 
mysql
);

290 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP VIEW vt1");

291 
	`check_mysql_rc
(
rc
, 
mysql
);

293  
OK
;

294 
	}
}

297 
	$‹¡_v›w_š£¹
(
MYSQL
 *
mysql
)

299 
MYSQL_STMT
 *
š£¹_¡mt
, *
£Ëù_¡mt
;

300 
rc
, 
i
;

301 
MYSQL_BIND
 
my_bšd
[1];

302 
my_v®
 = 0;

303 
ulÚg
 
my_Ëngth
 = 0L;

304 
my_boÞ
 
my_nuÎ
 = 0;

305 cÚ¡ *
qu”y
=

308 
rc
 = 
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1,v1");

309 
	`check_mysql_rc
(
rc
, 
mysql
);

310 
rc
 = 
	`mysql_qu”y
(
mysql
, "DROP VIEW IF EXISTS1,v1");

311 
	`check_mysql_rc
(
rc
, 
mysql
);

313 
rc
ð
	`mysql_qu”y
(
mysql
,"createable1 (a int,…rimary key (a))");

314 
	`check_mysql_rc
(
rc
, 
mysql
);

316 
rc
ð
	`mysql_qu”y
(
mysql
, "create view v1‡s select‡ from1 where‡>=1");

317 
	`check_mysql_rc
(
rc
, 
mysql
);

319 
š£¹_¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

320 
rc
ð
	`mysql_¡mt_´•¬e
(
š£¹_¡mt
, 
	`SL
(
qu”y
));

321 
	`check_¡mt_rc
(
rc
, 
š£¹_¡mt
);

322 
qu”y
= "select * from1";

323 
£Ëù_¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

324 
rc
ð
	`mysql_¡mt_´•¬e
(
£Ëù_¡mt
, 
	`SL
(
qu”y
));

325 
	`check_¡mt_rc
(
rc
, 
£Ëù_¡mt
);

327 
	`mem£t
(
my_bšd
, '\0', (
MYSQL_BIND
));

328 
my_bšd
[0].
bufãr_ty³
 = 
MYSQL_TYPE_LONG
;

329 
my_bšd
[0].
bufãr
 = (*)&
my_v®
;

330 
my_bšd
[0].
Ëngth
 = &
my_Ëngth
;

331 
my_bšd
[0].
is_nuÎ
 = &
my_nuÎ
;

332 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
š£¹_¡mt
, 
my_bšd
);

333 
	`check_¡mt_rc
(
rc
, 
£Ëù_¡mt
);

335 
i
= 0; i < 3; i++)

337 
rowcouÁ
= 0;

338 
my_v®
ð
i
;

340 
rc
ð
	`mysql_¡mt_execu‹
(
š£¹_¡mt
);

341 
	`check_¡mt_rc
(
rc
, 
š£¹_¡mt
);;

343 
rc
ð
	`mysql_¡mt_execu‹
(
£Ëù_¡mt
);

344 
	`check_¡mt_rc
(
rc
, 
£Ëù_¡mt
);;

345 
	`mysql_¡mt_ãtch
(
£Ëù_¡mt
è!ð
MYSQL_NO_DATA
)

346 
rowcouÁ
++;

347 
	`FAIL_UNLESS
((
i
+1è=ð
rowcouÁ
, "rowcount != i+1");

349 
	`mysql_¡mt_þo£
(
š£¹_¡mt
);

350 
	`mysql_¡mt_þo£
(
£Ëù_¡mt
);

352 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP VIEW v1");

353 
	`check_mysql_rc
(
rc
, 
mysql
);

354 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE1");

355 
	`check_mysql_rc
(
rc
, 
mysql
);

357  
OK
;

358 
	}
}

361 
	$‹¡_Ëá_još_v›w
(
MYSQL
 *
mysql
)

363 
MYSQL_STMT
 *
¡mt
;

364 
rc
, 
i
;

365 cÚ¡ *
qu”y
=

368 
rc
 = 
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1,v1");

369 
	`check_mysql_rc
(
rc
, 
mysql
);

371 
rc
 = 
	`mysql_qu”y
(
mysql
, "DROP VIEW IF EXISTS v1,t1");

372 
	`check_mysql_rc
(
rc
, 
mysql
);

373 
rc
ð
	`mysql_qu”y
(
mysql
,"CREATE TABLE1 (a int)");

374 
	`check_mysql_rc
(
rc
, 
mysql
);

375 
rc
ð
	`mysql_qu”y
(
mysql
,"insert into1 values (1), (2), (3)");

376 
	`check_mysql_rc
(
rc
, 
mysql
);

377 
rc
ð
	`mysql_qu”y
(
mysql
,"create view v1 (x)‡s select‡ from1 where‡ > 1");

378 
	`check_mysql_rc
(
rc
, 
mysql
);

379 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

380 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

381 
	`check_¡mt_rc
(
rc
, 
¡mt
);

383 
i
= 0; i < 3; i++)

385 
rowcouÁ
= 0;

387 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

388 
	`check_¡mt_rc
(
rc
, 
¡mt
);

389 
	`mysql_¡mt_ãtch
(
¡mt
è!ð
MYSQL_NO_DATA
)

390 
rowcouÁ
++;

391 
	`FAIL_UNLESS
(3 =ð
rowcouÁ
, "Expected 3„ows");

393 
	`mysql_¡mt_þo£
(
¡mt
);

395 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP VIEW v1");

396 
	`check_mysql_rc
(
rc
, 
mysql
);

397 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE1");

398 
	`check_mysql_rc
(
rc
, 
mysql
);

400  
OK
;

401 
	}
}

404 
	$‹¡_v›w_š£¹_f›lds
(
MYSQL
 *
mysql
)

406 
MYSQL_STMT
 *
¡mt
;

407 
·rm
[11][1000];

408 
ulÚg
 
l
[11];

409 
rc
, 
i
;

410 
rowcouÁ
= 0;

411 
MYSQL_BIND
 
my_bšd
[11];

412 cÚ¡ *
qu”y
= "INSERT INTO `v1` ( `K1C4` ,`K2C4` ,`K3C4` ,`K4N4` ,`F1C4` ,`F2I4` ,`F3N5` ,`F7F8` ,`F6N4` ,`F5C8` ,`F9D8` ) VALUES( ? , ? , ? , ? , ? , ? , ? , ? , ? , ? , ? )";

414 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS1, v1");

415 
	`check_mysql_rc
(
rc
, 
mysql
);

416 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP VIEW IF EXISTS1, v1");

417 
	`check_mysql_rc
(
rc
, 
mysql
);

418 
rc
ð
	`mysql_qu”y
(
mysql
,

431 
	`check_mysql_rc
(
rc
, 
mysql
);

432 
rc
ð
	`mysql_qu”y
(
mysql
,

439 
	`mem£t
(
my_bšd
, '\0', (my_bind));

440 
i
= 0; i < 11; i++)

442 
l
[
i
]= 20;

443 
my_bšd
[
i
].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

444 
my_bšd
[
i
].
is_nuÎ
= 0;

445 
my_bšd
[
i
].
bufãr
ð(*)&
·rm
[i];

447 
	`¡rýy
(
·rm
[
i
], "1");

448 
my_bšd
[
i
].
bufãr_Ëngth
= 2;

449 
my_bšd
[
i
].
Ëngth
ð&
l
[i];

451 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

452 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

453 
	`check_¡mt_rc
(
rc
, 
¡mt
);

454 
rc
ð
	`mysql_¡mt_bšd_·¿m
(
¡mt
, 
my_bšd
);

455 
	`check_¡mt_rc
(
rc
, 
¡mt
);

457 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

458 
	`check_¡mt_rc
(
rc
, 
¡mt
);

459 
	`mysql_¡mt_þo£
(
¡mt
);

461 
qu”y
= "select * from1";

462 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

463 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

464 
	`check_¡mt_rc
(
rc
, 
¡mt
);

465 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

466 
	`check_¡mt_rc
(
rc
, 
¡mt
);

467 
	`mysql_¡mt_ãtch
(
¡mt
è!ð
MYSQL_NO_DATA
)

468 
rowcouÁ
++;

469 
	`FAIL_UNLESS
(1 =ð
rowcouÁ
, "Expected 1„ow");

471 
	`mysql_¡mt_þo£
(
¡mt
);

472 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP VIEW v1");

473 
	`check_mysql_rc
(
rc
, 
mysql
);

474 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE1");

475 
	`check_mysql_rc
(
rc
, 
mysql
);

477  
OK
;

478 
	}
}

480 
	$‹¡_v›w_¥_li¡_f›lds
(
MYSQL
 *
mysql
)

482 
rc
;

483 
MYSQL_RES
 *
»s
;

484 
MYSQL_ROW
 
row
;

485 
sk
;

488 
rc
ð
	`mysql_qu”y
(
mysql
, "SHOW VARIABLES LIKE 'log_bin'");

489 
	`check_mysql_rc
(
rc
, 
mysql
);

490 
»s
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

491 
	`FAIL_IF
(!
»s
, "empty/invalid„esultset");

492 
row
 = 
	`mysql_ãtch_row
(
»s
);

493 
sk
ð(
	`¡rcmp
((*)
row
[1], "ON") == 0);

494 
	`mysql_ä“_»suÉ
(
»s
);

496 ià(
sk
) {

497 
	`dŸg
("bin_log is ON -> skip");

498  
SKIP
;

501 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP FUNCTION IF EXISTS f1");

502 
	`check_mysql_rc
(
rc
, 
mysql
);

503 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTS v1,1,2");

504 
	`check_mysql_rc
(
rc
, 
mysql
);

505 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP VIEW IF EXISTS v1,1,2");

506 
	`check_mysql_rc
(
rc
, 
mysql
);

507 
rc
ð
	`mysql_qu”y
(
mysql
, "create function f1 ()„eturns int„eturn 5");

508 
	`check_mysql_rc
(
rc
, 
mysql
);

509 
rc
ð
	`mysql_qu”y
(
mysql
, "createable1 (s1 char,s2 char)");

510 
	`check_mysql_rc
(
rc
, 
mysql
);

511 
rc
ð
	`mysql_qu”y
(
mysql
, "createable2 (s1 int);");

512 
	`check_mysql_rc
(
rc
, 
mysql
);

513 
rc
ð
	`mysql_qu”y
(
mysql
, "create view v1‡s select s2,sum(s1) - \
(s2)‡s vx from1 group by s2 having sum(s1) - count(s2) < (select f1() \
2);");

516 
	`check_mysql_rc
(
rc
, 
mysql
);

517 
»s
ð
	`mysql_li¡_f›lds
(
mysql
, "v1", 
NuÎS
);

518 
	`FAIL_UNLESS
(
»s
 !ð0 && 
	`mysql_num_f›lds
(res) != 0, "0 Fields");

519 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP FUNCTION f1");

520 
	`check_mysql_rc
(
rc
, 
mysql
);

521 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP VIEW v1");

522 
	`check_mysql_rc
(
rc
, 
mysql
);

523 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE1,2");

524 
	`mysql_ä“_»suÉ
(
»s
);

525 
	`check_mysql_rc
(
rc
, 
mysql
);

527  
OK
;

528 
	}
}

530 
	$‹¡_bug19671
(
MYSQL
 *
mysql
)

532 
MYSQL_RES
 *
»suÉ
;

533 
MYSQL_FIELD
 *
f›ld
;

534 
rc
, 
»tcode
ð
OK
;

537 
rc
ð
	`mysql_qu”y
(
mysql
, "set sql_mode=''");

538 
	`check_mysql_rc
(
rc
, 
mysql
);

539 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxists1");

540 
	`check_mysql_rc
(
rc
, 
mysql
);

542 
rc
ð
	`mysql_qu”y
(
mysql
, "drop view ifƒxists v1");

543 
	`check_mysql_rc
(
rc
, 
mysql
);

545 
rc
ð
	`mysql_qu”y
(
mysql
, "createable1(f1 int)");

546 
	`check_mysql_rc
(
rc
, 
mysql
);

548 
rc
ð
	`mysql_qu”y
(
mysql
, "create view v1‡s select va.* from1 va");

549 
	`check_mysql_rc
(
rc
, 
mysql
);

551 
rc
ð
	`mysql_qu”y
(
mysql
, "SELECT * FROM v1");

552 
	`check_mysql_rc
(
rc
, 
mysql
);

554 
»suÉ
ð
	`mysql_¡Üe_»suÉ
(
mysql
);

555 
	`FAIL_IF
(!
»suÉ
, "Invalid„esult set");

557 
f›ld
ð
	`mysql_ãtch_f›ld
(
»suÉ
);

558 
	`FAIL_IF
(!
f›ld
, "Can't fetch field");

560 ià(
	`¡rcmp
(
f›ld
->
bË
, "v1") != 0) {

561 
	`dŸg
("WrÚg v®u'%s' fÜ f›ld_bË. Ex³ùed 'v1'. (%s: %d)", 
f›ld
->
bË
, 
__FILE__
, 
__LINE__
);

562 
»tcode
ð
FAIL
;

565 
	`mysql_ä“_»suÉ
(
»suÉ
);

567 
rc
ð
	`mysql_qu”y
(
mysql
, "drop view v1");

568 
	`check_mysql_rc
(
rc
, 
mysql
);

569 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable1");

570 
	`check_mysql_rc
(
rc
, 
mysql
);

572  
»tcode
;

573 
	}
}

579 
	$‹¡_bug11111
(
MYSQL
 *
mysql
)

581 
MYSQL_STMT
 *
¡mt
;

582 
MYSQL_BIND
 
my_bšd
[2];

583 
buf
[2][20];

584 
ulÚg
 
Ën
[2];

585 
i
;

586 
rc
;

587 cÚ¡ *
qu”y
= "SELECT DISTINCT f1,ff2 FROM v1";

589 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable ifƒxists1,2, v1");

590 
	`check_mysql_rc
(
rc
, 
mysql
);

591 
rc
ð
	`mysql_qu”y
(
mysql
, "drop view ifƒxists1,2, v1");

592 
	`check_mysql_rc
(
rc
, 
mysql
);

593 
rc
ð
	`mysql_qu”y
(
mysql
, "createable1 (f1 int, f2 int)");

594 
	`check_mysql_rc
(
rc
, 
mysql
);

595 
rc
ð
	`mysql_qu”y
(
mysql
, "createable2 (ff1 int, ff2 int)");

596 
	`check_mysql_rc
(
rc
, 
mysql
);

597 
rc
ð
	`mysql_qu”y
(
mysql
, "create view v1‡s select * from1,2 where f1=ff1");

598 
	`check_mysql_rc
(
rc
, 
mysql
);

599 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into1 values (1,1), (2,2), (3,3)");

600 
	`check_mysql_rc
(
rc
, 
mysql
);

601 
rc
ð
	`mysql_qu”y
(
mysql
, "insert into2 values (1,1), (2,2), (3,3)");

602 
	`check_mysql_rc
(
rc
, 
mysql
);

604 
¡mt
ð
	`mysql_¡mt_š™
(
mysql
);

606 
rc
ð
	`mysql_¡mt_´•¬e
(
¡mt
, 
	`SL
(
qu”y
));

607 
	`check_¡mt_rc
(
rc
, 
¡mt
);

608 
rc
ð
	`mysql_¡mt_execu‹
(
¡mt
);

609 
	`check_¡mt_rc
(
rc
, 
¡mt
);

611 
	`mem£t
(
my_bšd
, '\0', (my_bind));

612 
i
=0; i < 2; i++)

614 
my_bšd
[
i
].
bufãr_ty³
ð
MYSQL_TYPE_STRING
;

615 
my_bšd
[
i
].
bufãr
ð(
uch¬
* *)&
buf
[i];

616 
my_bšd
[
i
].
bufãr_Ëngth
= 20;

617 
my_bšd
[
i
].
Ëngth
ð&
Ën
[i];

620 
rc
ð
	`mysql_¡mt_bšd_»suÉ
(
¡mt
, 
my_bšd
);

621 
	`check_¡mt_rc
(
rc
, 
¡mt
);

623 
rc
ð
	`mysql_¡mt_ãtch
(
¡mt
);

624 
	`check_¡mt_rc
(
rc
, 
¡mt
);

625 
	`FAIL_UNLESS
(!
	`¡rcmp
(
buf
[1],"1"), "buf[1] != '1'");

626 
	`mysql_¡mt_þo£
(
¡mt
);

627 
rc
ð
	`mysql_qu”y
(
mysql
, "drop view v1");

628 
	`check_mysql_rc
(
rc
, 
mysql
);

629 
rc
ð
	`mysql_qu”y
(
mysql
, "dropable1,2");

630 
	`check_mysql_rc
(
rc
, 
mysql
);

632  
OK
;

633 
	}
}

639 
	$‹¡_bug29306
(
MYSQL
 *
mysql
)

641 
MYSQL_FIELD
 *
f›ld
;

642 
rc
;

643 
MYSQL_RES
 *
»s
;

645 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLE IF EXISTSab17557");

646 
	`check_mysql_rc
(
rc
, 
mysql
);

647 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP VIEW IF EXISTS view17557");

648 
	`check_mysql_rc
(
rc
, 
mysql
);

649 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE TABLEab17557 (dd decimal (3,1))");

650 
	`check_mysql_rc
(
rc
, 
mysql
);

651 
rc
ð
	`mysql_qu”y
(
mysql
, "CREATE VIEW view17557‡s SELECT dd FROMab17557");

652 
	`check_mysql_rc
(
rc
, 
mysql
);

653 
rc
ð
	`mysql_qu”y
(
mysql
, "INSERT INTOab17557 VALUES (7.6)");

654 
	`check_mysql_rc
(
rc
, 
mysql
);

657 
»s
ð
	`mysql_li¡_f›lds
(
mysql
, "v›w17557", 
NULL
);

658 (
f›ld
ð
	`mysql_ãtch_f›ld
(
»s
)))

660 
	`FAIL_UNLESS
(
f›ld
->
decim®s
 == 1, "field->decimals != 1");

662 
	`mysql_ä“_»suÉ
(
»s
);

664 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP TABLEab17557");

665 
	`check_mysql_rc
(
rc
, 
mysql
);

666 
rc
ð
	`mysql_qu”y
(
mysql
, "DROP VIEW view17557");

667 
	`check_mysql_rc
(
rc
, 
mysql
);

669  
OK
;

670 
	}
}

673 
my_‹¡s_¡
 
	gmy_‹¡s
[] = {

674 {"‹¡_v›w", 
‹¡_v›w
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

675 {"‹¡_v›w_wh”e", 
‹¡_v›w_wh”e
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

676 {"‹¡_v›w_2wh”e", 
‹¡_v›w_2wh”e
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

677 {"‹¡_v›w_¡¬", 
‹¡_v›w_¡¬
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

678 {"‹¡_v›w_š£¹", 
‹¡_v›w_š£¹
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

679 {"‹¡_Ëá_još_v›w", 
‹¡_Ëá_još_v›w
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

680 {"‹¡_v›w_š£¹_f›lds", 
‹¡_v›w_š£¹_f›lds
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

681 {"‹¡_v›w_¥_li¡_f›lds", 
‹¡_v›w_¥_li¡_f›lds
,
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

682 {"‹¡_bug19671", 
‹¡_bug19671
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

683 {"‹¡_bug29306", 
‹¡_bug29306
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

684 {"‹¡_bug11111", 
‹¡_bug11111
, 
TEST_CONNECTION_DEFAULT
, 0, 
NULL
 , NULL},

685 {
NULL
, NULL, 0, 0, NULL, NULL}

688 
	$maš
(
¬gc
, **
¬gv
)

690 ià(
¬gc
 > 1)

691 
	`g‘_ÝtiÚs
(
¬gc
, 
¬gv
);

693 
	`g‘_’vv¬s
();

695 
	`run_‹¡s
(
my_‹¡s
);

697 (
	`ex™_¡©us
());

698 
	}
}

	@unittest/mytap/t/basic-t.c

16 
	~"my_cÚfig.h
"

18 
	~<¡dlib.h
>

19 
	~"../p.h
"

21 
	$maš
() {

22 
	`¶ª
(5);

23 
	`ok
(1 == 1, "testing basic functions");

24 
	`ok
(2 == 2, " ");

25 
	`ok
(3 =ð3, 
NULL
);

27 
	`sk
(2, "Sensa fragoli");

29 
	`ok
(1 == 2, "Should‚ot be„un‡t‡ll");

30 
	`ok
(1, "This one‚either");

32  
	`ex™_¡©us
();

33 
	}
}

	@unittest/mytap/tap.c

21 
	~"p.h
"

23 
	~"ma_glob®.h
"

25 
	~<¡dlib.h
>

26 
	~<¡d¬g.h
>

27 
	~<¡dio.h
>

28 
	~<¡ršg.h
>

29 
	~<sigÇl.h
>

37 #ià
defšed
(
_MSC_VER
) && ( _MSC_VER == 1310 )

38 
	#v¢´štf
 
_v¢´štf


	)

54 
TEST_DATA
 
	gg_‹¡
 = { 0, 0, 0, "" };

63 
	#pout
 
¡dout


	)

80 
	$vem™_p
(
·ss
, cÚ¡ *
fmt
, 
va_li¡
 
­
)

82 
	`årštf
(
pout
, "%sok %d%s",

83 
·ss
 ? "" : "not ",

84 ++
g_‹¡
.
Ï¡
,

85 (
fmt
 && *fmt) ? " - " : "");

86 ià(
fmt
 && *fmt)

87 
	`vårštf
(
pout
, 
fmt
, 
­
);

88 
	}
}

107 
	$em™_dœ
(cÚ¡ *
dœ
, cÚ¡ *
why
)

109 
	`årštf
(
pout
, " # % %s", 
dœ
, 
why
);

110 
	}
}

119 
	$em™_’dl
()

121 
	`årštf
(
pout
, "\n");

122 
	}
}

125 
	$hªdË_cÜe_sigÇl
(
signo
)

127 
	`BAIL_OUT
("SigÇÈ%dhrown", 
signo
);

128 
	}
}

131 
	$BAIL_OUT
(cÚ¡ *
fmt
, ...)

133 
va_li¡
 
­
;

134 
	`va_¡¬t
(
­
, 
fmt
);

135 
	`årštf
(
pout
, "Bail out! ");

136 
	`vårštf
(
pout
, 
fmt
, 
­
);

137 
	`em™_’dl
();

138 
	`va_’d
(
­
);

139 
	`ex™
(255);

140 
	}
}

144 
	$dŸg
(cÚ¡ *
fmt
, ...)

146 
va_li¡
 
­
;

147 
	`va_¡¬t
(
­
, 
fmt
);

148 
	`årštf
(
pout
, "# ");

149 
	`vårštf
(
pout
, 
fmt
, 
­
);

150 
	`em™_’dl
();

151 
	`va_’d
(
­
);

152 
	}
}

154 
	ssigÇl_’Œy
 {

155 
	msigno
;

156 (*
	mhªdËr
)();

157 } 
	tsigÇl_’Œy
;

159 
sigÇl_’Œy
 
	gš¡®l_sigÇl
[]= {

160 #ifdeà
SIGQUIT


161 { 
SIGQUIT
, 
hªdË_cÜe_sigÇl
 },

163 { 
SIGILL
, 
hªdË_cÜe_sigÇl
 },

164 { 
SIGABRT
, 
hªdË_cÜe_sigÇl
 },

165 { 
SIGFPE
, 
hªdË_cÜe_sigÇl
 },

166 { 
SIGSEGV
, 
hªdË_cÜe_sigÇl
 }

167 #ifdeà
SIGBUS


168 , { 
SIGBUS
, 
hªdË_cÜe_sigÇl
 }

170 #ifdeà
SIGXCPU


171 , { 
SIGXCPU
, 
hªdË_cÜe_sigÇl
 }

173 #ifdeà
SIGXCPU


174 , { 
SIGXFSZ
, 
hªdË_cÜe_sigÇl
 }

176 #ifdeà
SIGXCPU


177 , { 
SIGSYS
, 
hªdË_cÜe_sigÇl
 }

179 #ifdeà
SIGXCPU


180 , { 
SIGTRAP
, 
hªdË_cÜe_sigÇl
 }

184 
	gsk_big_‹¡s
= 1;

187 
	$¶ª
(cÚ¡ 
couÁ
)

189 *
cÚfig
ð
	`g‘’v
("MYTAP_CONFIG");

190 
size_t
 
i
;

192 ià(
cÚfig
)

193 
sk_big_‹¡s
ð
	`¡rcmp
(
cÚfig
, "big");

195 
	`£tvbuf
(
pout
, 0, 
_IONBF
, 0);

200 
i
ð0; i < (
š¡®l_sigÇl
)/(*install_signal); ++i)

201 
	`sigÇl
(
š¡®l_sigÇl
[
i
].
signo
, in¡®l_sigÇl[i].
hªdËr
);

203 
g_‹¡
.
¶ª
ð
couÁ
;

204 
couÁ
)

206 
NO_PLAN
:

209 ià(
couÁ
 > 0)

210 
	`årštf
(
pout
, "1..%d\n", 
couÁ
);

213 
	}
}

217 
	$sk_®l
(cÚ¡ *
»asÚ
, ...)

219 
va_li¡
 
­
;

220 
	`va_¡¬t
(
­
, 
»asÚ
);

221 
	`årštf
(
pout
, "1..0 # skip ");

222 
	`vårštf
(
pout
, 
»asÚ
, 
­
);

223 
	`va_’d
(
­
);

224 
	`ex™
(0);

225 
	}
}

228 
	$ok
(cÚ¡ 
·ss
, cÚ¡ *
fmt
, ...)

230 
va_li¡
 
­
;

231 
	`va_¡¬t
(
­
, 
fmt
);

233 ià(!
·ss
 && *
g_‹¡
.
todo
 == '\0')

234 ++
g_‹¡
.
çžed
;

236 
	`vem™_p
(
·ss
, 
fmt
, 
­
);

237 
	`va_’d
(
­
);

238 ià(*
g_‹¡
.
todo
 != '\0')

239 
	`em™_dœ
("todo", 
g_‹¡
.
todo
);

240 
	`em™_’dl
();

241 
	}
}

245 
	$sk
(
how_mªy
, cÚ¡ *cÚ¡ 
fmt
, ...)

247 
»asÚ
[80];

248 ià(
fmt
 && *fmt)

250 
va_li¡
 
­
;

251 
	`va_¡¬t
(
­
, 
fmt
);

252 
	`v¢´štf
(
»asÚ
, Ô—sÚ), 
fmt
, 
­
);

253 
	`va_’d
(
­
);

256 
»asÚ
[0] = '\0';

258 
how_mªy
-- > 0)

260 
va_li¡
 
­
;

261 
	`mem£t
((*è&
­
, 0, (ap));

262 
	`vem™_p
(1, 
NULL
, 
­
);

263 
	`em™_dœ
("sk", 
»asÚ
);

264 
	`em™_’dl
();

266 
	}
}

269 
	$todo_¡¬t
(cÚ¡ *
mes§ge
, ...)

271 
va_li¡
 
­
;

272 
	`va_¡¬t
(
­
, 
mes§ge
);

273 
	`v¢´štf
(
g_‹¡
.
todo
, (g_‹¡.todo), 
mes§ge
, 
­
);

274 
	`va_’d
(
­
);

275 
	}
}

278 
	$todo_’d
()

280 *
g_‹¡
.
todo
 = '\0';

281 
	}
}

283 
	$ex™_¡©us
() {

287 ià(
g_‹¡
.
¶ª
 =ð
NO_PLAN
)

288 
	`¶ª
(
g_‹¡
.
Ï¡
);

290 ià(
g_‹¡
.
¶ª
 !ðg_‹¡.
Ï¡
)

292 
	`dŸg
("%dests…lanned but%s %dƒxecuted",

293 
g_‹¡
.
¶ª
, (g_‹¡.¶ª > g_‹¡.
Ï¡
 ? " only" : ""), g_test.last);

294  
EXIT_FAILURE
;

297 ià(
g_‹¡
.
çžed
 > 0)

299 
	`dŸg
("Fažed %de¡s!", 
g_‹¡
.
çžed
);

300  
EXIT_FAILURE
;

303  
EXIT_SUCCESS
;

304 
	}
}

	@unittest/mytap/tap.h

21 #iâdeà
TAP_H


22 
	#TAP_H


	)

24 
	~"ma_glob®.h
"

31 
	#NO_PLAN
 (0)

	)

42 
	sTEST_DATA
 {

49 
	m¶ª
;

52 
	mÏ¡
;

55 
	mçžed
;

58 
	mtodo
[128];

59 } 
	tTEST_DATA
;

61 #ifdeà
__ýlu¥lus


81 
sk_big_‹¡s
;

111 
¶ª
(cÚ¡ 
couÁ
);

130 
ok
(cÚ¡ 
·ss
, cÚ¡ *
fmt
, ...)

131 
__©Œibu‹__
((
fÜm©
(
´štf
,2,3)));

162 
sk
(
how_mªy
, cÚ¡ *cÚ¡ 
»asÚ
, ...)

163 
__©Œibu‹__
((
fÜm©
(
´štf
,2,3)));

183 
	#SKIP_BLOCK_IF
(
SKIP_IF_TRUE
, 
COUNT
, 
REASON
) \

184 ià(
SKIP_IF_TRUE
è
	`sk
((
COUNT
),(
REASON
)); 

	)

201 
	#SKIP_BIG_TESTS
(
COUNT
) \

202 ià(
sk_big_‹¡s
è
	`sk
((
COUNT
), "bige¡"); 

	)

211 
dŸg
(cÚ¡ *
fmt
, ...)

212 
__©Œibu‹__
((
fÜm©
(
´štf
,1,2)));

233 
BAIL_OUT
(cÚ¡ *
fmt
, ...)

234 
__©Œibu‹__
((
nÜ‘uº
, 
fÜm©
(
´štf
,1,2)));

253 
ex™_¡©us
();

264 
sk_®l
(cÚ¡ *
»asÚ
, ...)

265 
__©Œibu‹__
((
nÜ‘uº
, 
fÜm©
(
´štf
, 1, 2)));

289 
todo_¡¬t
(cÚ¡ *
mes§ge
, ...)

290 
__©Œibu‹__
((
fÜm©
(
´štf
, 1, 2)));

297 
todo_’d
();

301 #ifdeà
__ýlu¥lus


	@win-iconv/iconv.h

1 #iâdeà
_LIBICONV_H


2 
	#_LIBICONV_H


	)

3 
	~<¡ddef.h
>

4 #ifdeà
__ýlu¥lus


7 * 
	ticÚv_t
;

8 
icÚv_t
 
icÚv_Ý’
(cÚ¡ *
tocode
, cÚ¡ *
äomcode
);

9 
icÚv_þo£
(
icÚv_t
 
cd
);

10 
size_t
 
icÚv
(
icÚv_t
 
cd
, cÚ¡ **
šbuf
, size_ˆ*
šby‹¦eá
, **
outbuf
, size_ˆ*
outby‹¦eá
);

11 #ifdeà
__ýlu¥lus


	@win-iconv/mlang.h

1 
HRESULT
 
WINAPI
 
CÚv”tIN‘SŒšg
(

2 
LPDWORD
 
ÍdwMode
,

3 
DWORD
 
dwSrcEncodšg
,

4 
DWORD
 
dwD¡Encodšg
,

5 
LPCSTR
 
ÍSrcSŒ
,

6 
LPINT
 
ÍnSrcSize
,

7 
LPBYTE
 
ÍD¡SŒ
,

8 
LPINT
 
ÍnD¡Size


11 
HRESULT
 
WINAPI
 
CÚv”tIN‘MuÉiBy‹ToUnicode
(

12 
LPDWORD
 
ÍdwMode
,

13 
DWORD
 
dwSrcEncodšg
,

14 
LPCSTR
 
ÍSrcSŒ
,

15 
LPINT
 
ÍnMuÉiCh¬CouÁ
,

16 
LPWSTR
 
ÍD¡SŒ
,

17 
LPINT
 
ÍnWideCh¬CouÁ


20 
HRESULT
 
WINAPI
 
CÚv”tIN‘UnicodeToMuÉiBy‹
(

21 
LPDWORD
 
ÍdwMode
,

22 
DWORD
 
dwEncodšg
,

23 
LPCWSTR
 
ÍSrcSŒ
,

24 
LPINT
 
ÍnWideCh¬CouÁ
,

25 
LPSTR
 
ÍD¡SŒ
,

26 
LPINT
 
ÍnMuÉiCh¬CouÁ


29 
HRESULT
 
WINAPI
 
IsCÚv”tIN‘SŒšgAvažabË
(

30 
DWORD
 
dwSrcEncodšg
,

31 
DWORD
 
dwD¡Encodšg


34 
HRESULT
 
WINAPI
 
LcidToRfc1766A
(

35 
LCID
 
LoÿË
,

36 
LPSTR
 
pszRfc1766
,

37 
nCh¬


40 
HRESULT
 
WINAPI
 
LcidToRfc1766W
(

41 
LCID
 
LoÿË
,

42 
LPWSTR
 
pszRfc1766
,

43 
nCh¬


46 
HRESULT
 
WINAPI
 
Rfc1766ToLcidA
(

47 
LCID
 *
pLoÿË
,

48 
LPSTR
 
pszRfc1766


51 
HRESULT
 
WINAPI
 
Rfc1766ToLcidW
(

52 
LCID
 *
pLoÿË
,

53 
LPWSTR
 
pszRfc1766


	@win-iconv/win_iconv.c

8 #iâdeà
WINVER


9 
	#WINVER
 0x0500

	)

12 
	#STRICT


	)

13 
	~<wšdows.h
>

14 
	~<”ºo.h
>

15 
	~<¡ršg.h
>

16 
	~<¡dlib.h
>

18 #ifdeà
__GNUC__


19 
	#UNUSED
 
	`__©Œibu‹__
((
unu£d
))

	)

21 
	#UNUSED


	)

25 #iâdeà
UNDER_CE


26 
	#G‘ProcAdd»ssA
 
G‘ProcAdd»ss


	)

30 
	#MAKE_EXE


	)

31 
	#MAKE_DLL


	)

32 
	#USE_LIBICONV_DLL


	)

35 #ià!
defšed
(
DEFAULT_LIBICONV_DLL
)

36 
	#DEFAULT_LIBICONV_DLL
 ""

	)

39 
	#MB_CHAR_MAX
 16

	)

41 
	#UNICODE_MODE_BOM_DONE
 1

	)

42 
	#UNICODE_MODE_SWAPPED
 2

	)

44 
	#FLAG_USE_BOM
 1

	)

45 
	#FLAG_TRANSLIT
 2

	)

46 
	#FLAG_IGNORE
 4

	)

48 
	tuch¬
;

49 
	tushÜt
;

50 
	tušt
;

52 * 
	ticÚv_t
;

54 
icÚv_t
 
icÚv_Ý’
(cÚ¡ *
tocode
, cÚ¡ *
äomcode
);

55 
icÚv_þo£
(
icÚv_t
 
cd
);

56 
size_t
 
icÚv
(
icÚv_t
 
cd
, cÚ¡ **
šbuf
, size_ˆ*
šby‹¦eá
, **
outbuf
, size_ˆ*
outby‹¦eá
);

59 #ià
defšed
(
MAKE_DLL
)

61 
	$icÚvùl
 (
icÚv_t
 
cd
, 
»que¡
, * 
¬gum’t
)

65 
	}
}

68 
com·t_t
 
	tcom·t_t
;

69 
cscÚv_t
 
	tcscÚv_t
;

70 
»c_icÚv_t
 
	t»c_icÚv_t
;

72 
	$icÚv_t
 (*
	tf_icÚv_Ý’
)(cÚ¡ *
	ttocode
, cÚ¡ *
	täomcode
);

73 (*
	tf_icÚv_þo£
)(
	ticÚv_t
 
	tcd
);

74 
	$size_t
 (*
	tf_icÚv
)(
	ticÚv_t
 
	tcd
, cÚ¡ **
	tšbuf
, 
	tsize_t
 *
	tšby‹¦eá
, **
	toutbuf
, size_ˆ*
	toutby‹¦eá
);

75 * (*
	tf_”ºo
)();

76 (*
	tf_mbtowc
)(
	tcscÚv_t
 *
	tcv
, cÚ¡ 
	tuch¬
 *
	tbuf
, 
	tbufsize
, 
	tushÜt
 *
	twbuf
, *
	twbufsize
);

77 (*
	tf_wùomb
)(
	tcscÚv_t
 *
	tcv
, 
	tushÜt
 *
	twbuf
, 
	twbufsize
, 
	tuch¬
 *
	tbuf
, 
	tbufsize
);

78 (*
	tf_mbËn
)(
	tcscÚv_t
 *
	tcv
, cÚ¡ 
	tuch¬
 *
	tbuf
, 
	tbufsize
);

79 (*
	tf_æush
)(
	tcscÚv_t
 *
	tcv
, 
	tuch¬
 *
	tbuf
, 
	tbufsize
);

81 
	#COMPAT_IN
 1

	)

82 
	#COMPAT_OUT
 2

	)

85 
	scom·t_t
 {

86 
ušt
 
š
;

87 
ušt
 
out
;

88 
ušt
 
æag
;

91 
	scscÚv_t
 {

92 
cod•age
;

93 
æags
;

94 
f_mbtowc
 
mbtowc
;

95 
f_wùomb
 
wùomb
;

96 
f_mbËn
 
mbËn
;

97 
f_æush
 
æush
;

98 
DWORD
 
mode
;

99 
com·t_t
 *
com·t
;

102 
	s»c_icÚv_t
 {

103 
icÚv_t
 
cd
;

104 
f_icÚv_þo£
 
icÚv_þo£
;

105 
f_icÚv
 
icÚv
;

106 
f_”ºo
 
_”ºo
;

107 
cscÚv_t
 
äom
;

108 
cscÚv_t
 
to
;

109 #ià
	`defšed
(
USE_LIBICONV_DLL
)

110 
HMODULE
 
hlibicÚv
;

114 
	`wš_icÚv_Ý’
(
»c_icÚv_t
 *
cd
, cÚ¡ *
tocode
, cÚ¡ *
äomcode
);

115 
	`wš_icÚv_þo£
(
icÚv_t
 
cd
);

116 
size_t
 
	`wš_icÚv
(
icÚv_t
 
cd
, cÚ¡ **
šbuf
, size_ˆ*
šby‹¦eá
, **
outbuf
, size_ˆ*
outby‹¦eá
);

118 
	`lßd_mÏng
();

119 
	`make_cscÚv
(cÚ¡ *
Çme
, 
cscÚv_t
 *
cv
);

120 
	`Çme_to_cod•age
(cÚ¡ *
Çme
);

121 
ušt
 
	`utf16_to_ucs4
(cÚ¡ 
ushÜt
 *
wbuf
);

122 
	`ucs4_to_utf16
(
ušt
 
wc
, 
ushÜt
 *
wbuf
, *
wbufsize
);

123 
	`mbtowc_æags
(
cod•age
);

124 
	`mu¡_u£_nuÎ_u£ddeçuÉch¬
(
cod•age
);

125 *
	`¡¼¡r
(cÚ¡ *
¡r
, cÚ¡ *
tok’
);

126 *
	`x¡ºdup
(cÚ¡ *
s
, 
size_t
 
n
);

127 
	`£‹¼Ü
(
”r
);

129 #ià
	`defšed
(
USE_LIBICONV_DLL
)

130 
	`libicÚv_icÚv_Ý’
(
»c_icÚv_t
 *
cd
, cÚ¡ *
tocode
, cÚ¡ *
äomcode
);

131 
PVOID
 
	`MyImageDœeùÜyEÁryToD©a
(
LPVOID
 
Ba£
, 
BOOLEAN
 
M­³dAsImage
, 
USHORT
 
DœeùÜyEÁry
, 
PULONG
 
Size
);

132 
HMODULE
 
	`fšd_impÜ‹d_moduË_by_funúame
(HMODULE 
hModuË
, cÚ¡ *
funúame
);

134 
HMODULE
 
hwšicÚv
;

137 
	`sbcs_mbËn
(
cscÚv_t
 *
cv
, cÚ¡ 
uch¬
 *
buf
, 
bufsize
);

138 
	`dbcs_mbËn
(
cscÚv_t
 *
cv
, cÚ¡ 
uch¬
 *
buf
, 
bufsize
);

139 
	`mbcs_mbËn
(
cscÚv_t
 *
cv
, cÚ¡ 
uch¬
 *
buf
, 
bufsize
);

140 
	`utf8_mbËn
(
cscÚv_t
 *
cv
, cÚ¡ 
uch¬
 *
buf
, 
bufsize
);

141 
	`eucjp_mbËn
(
cscÚv_t
 *
cv
, cÚ¡ 
uch¬
 *
buf
, 
bufsize
);

143 
	`k”Ãl_mbtowc
(
cscÚv_t
 *
cv
, cÚ¡ 
uch¬
 *
buf
, 
bufsize
, 
ushÜt
 *
wbuf
, *
wbufsize
);

144 
	`k”Ãl_wùomb
(
cscÚv_t
 *
cv
, 
ushÜt
 *
wbuf
, 
wbufsize
, 
uch¬
 *
buf
, 
bufsize
);

145 
	`mÏng_mbtowc
(
cscÚv_t
 *
cv
, cÚ¡ 
uch¬
 *
buf
, 
bufsize
, 
ushÜt
 *
wbuf
, *
wbufsize
);

146 
	`mÏng_wùomb
(
cscÚv_t
 *
cv
, 
ushÜt
 *
wbuf
, 
wbufsize
, 
uch¬
 *
buf
, 
bufsize
);

147 
	`utf16_mbtowc
(
cscÚv_t
 *
cv
, cÚ¡ 
uch¬
 *
buf
, 
bufsize
, 
ushÜt
 *
wbuf
, *
wbufsize
);

148 
	`utf16_wùomb
(
cscÚv_t
 *
cv
, 
ushÜt
 *
wbuf
, 
wbufsize
, 
uch¬
 *
buf
, 
bufsize
);

149 
	`utf32_mbtowc
(
cscÚv_t
 *
cv
, cÚ¡ 
uch¬
 *
buf
, 
bufsize
, 
ushÜt
 *
wbuf
, *
wbufsize
);

150 
	`utf32_wùomb
(
cscÚv_t
 *
cv
, 
ushÜt
 *
wbuf
, 
wbufsize
, 
uch¬
 *
buf
, 
bufsize
);

151 
	`iso2022jp_mbtowc
(
cscÚv_t
 *
cv
, cÚ¡ 
uch¬
 *
buf
, 
bufsize
, 
ushÜt
 *
wbuf
, *
wbufsize
);

152 
	`iso2022jp_wùomb
(
cscÚv_t
 *
cv
, 
ushÜt
 *
wbuf
, 
wbufsize
, 
uch¬
 *
buf
, 
bufsize
);

153 
	`iso2022jp_æush
(
cscÚv_t
 *
cv
, 
uch¬
 *
buf
, 
bufsize
);

156 
cod•age
;

157 cÚ¡ *
Çme
;

158 } 
cod•age_®Ÿs
[] = {

188 #iâdeà
GLIB_COMPILATION


580 {0, 
NULL
}

581 
	}
};

602 
com·t_t
 
	gý932_com·t
[] = {

603 {0x00A5, 0x005C, 
COMPAT_OUT
},

604 {0x203E, 0x007E, 
COMPAT_OUT
},

605 {0x2014, 0x2015, 
COMPAT_OUT
},

606 {0x301C, 0xFF5E, 
COMPAT_OUT
},

607 {0x2016, 0x2225, 
COMPAT_OUT
},

608 {0x2212, 0xFF0D, 
COMPAT_OUT
},

609 {0x00A2, 0xFFE0, 
COMPAT_OUT
},

610 {0x00A3, 0xFFE1, 
COMPAT_OUT
},

611 {0x00AC, 0xFFE2, 
COMPAT_OUT
},

615 
com·t_t
 
	gý20932_com·t
[] = {

616 {0x00A5, 0x005C, 
COMPAT_OUT
},

617 {0x203E, 0x007E, 
COMPAT_OUT
},

618 {0x2014, 0x2015, 
COMPAT_OUT
},

619 {0xFF5E, 0x301C, 
COMPAT_OUT
|
COMPAT_IN
},

620 {0x2225, 0x2016, 
COMPAT_OUT
|
COMPAT_IN
},

621 {0xFF0D, 0x2212, 
COMPAT_OUT
|
COMPAT_IN
},

622 {0xFFE0, 0x00A2, 
COMPAT_OUT
|
COMPAT_IN
},

623 {0xFFE1, 0x00A3, 
COMPAT_OUT
|
COMPAT_IN
},

624 {0xFFE2, 0x00AC, 
COMPAT_OUT
|
COMPAT_IN
},

628 
com·t_t
 *
	gý51932_com·t
 = 
ý932_com·t
;

631 
com·t_t
 *
	gý5022x_com·t
 = 
ý932_com·t
;

633 
	$HRESULT
 (
	tWINAPI
 *
	tCONVERTINETSTRING
)(

634 
	tLPDWORD
 
	tÍdwMode
,

635 
	tDWORD
 
	tdwSrcEncodšg
,

636 
	tDWORD
 
	tdwD¡Encodšg
,

637 
	tLPCSTR
 
	tÍSrcSŒ
,

638 
	tLPINT
 
	tÍnSrcSize
,

639 
	tLPBYTE
 
	tÍD¡SŒ
,

640 
	tLPINT
 
	tÍnD¡Size


642 
	$HRESULT
 (
	tWINAPI
 *
	tCONVERTINETMULTIBYTETOUNICODE
)(

643 
	tLPDWORD
 
	tÍdwMode
,

644 
	tDWORD
 
	tdwSrcEncodšg
,

645 
	tLPCSTR
 
	tÍSrcSŒ
,

646 
	tLPINT
 
	tÍnMuÉiCh¬CouÁ
,

647 
	tLPWSTR
 
	tÍD¡SŒ
,

648 
	tLPINT
 
	tÍnWideCh¬CouÁ


650 
	$HRESULT
 (
	tWINAPI
 *
	tCONVERTINETUNICODETOMULTIBYTE
)(

651 
	tLPDWORD
 
	tÍdwMode
,

652 
	tDWORD
 
	tdwEncodšg
,

653 
	tLPCWSTR
 
	tÍSrcSŒ
,

654 
	tLPINT
 
	tÍnWideCh¬CouÁ
,

655 
	tLPSTR
 
	tÍD¡SŒ
,

656 
	tLPINT
 
	tÍnMuÉiCh¬CouÁ


658 
	$HRESULT
 (
	tWINAPI
 *
	tISCONVERTINETSTRINGAVAILABLE
)(

659 
	tDWORD
 
	tdwSrcEncodšg
,

660 
	tDWORD
 
	tdwD¡Encodšg


662 
	$HRESULT
 (
	tWINAPI
 *
	tLCIDTORFC1766A
)(

663 
	tLCID
 
	tLoÿË
,

664 
	tLPSTR
 
	tpszRfc1766
,

665 
	tnCh¬


667 
	$HRESULT
 (
	tWINAPI
 *
	tLCIDTORFC1766W
)(

668 
	tLCID
 
	tLoÿË
,

669 
	tLPWSTR
 
	tpszRfc1766
,

670 
	tnCh¬


672 
	$HRESULT
 (
	tWINAPI
 *
	tRFC1766TOLCIDA
)(

673 
	tLCID
 *
	tpLoÿË
,

674 
	tLPSTR
 
	tpszRfc1766


676 
	$HRESULT
 (
	tWINAPI
 *
	tRFC1766TOLCIDW
)(

677 
	tLCID
 *
	tpLoÿË
,

678 
	tLPWSTR
 
	tpszRfc1766


680 
CONVERTINETSTRING
 
CÚv”tIN‘SŒšg
;

681 
CONVERTINETMULTIBYTETOUNICODE
 
CÚv”tIN‘MuÉiBy‹ToUnicode
;

682 
CONVERTINETUNICODETOMULTIBYTE
 
CÚv”tIN‘UnicodeToMuÉiBy‹
;

683 
ISCONVERTINETSTRINGAVAILABLE
 
IsCÚv”tIN‘SŒšgAvažabË
;

684 
LCIDTORFC1766A
 
LcidToRfc1766A
;

685 
RFC1766TOLCIDA
 
Rfc1766ToLcidA
;

688 
	$lßd_mÏng
()

690 
HMODULE
 
h
;

691 ià(
CÚv”tIN‘SŒšg
 !ð
NULL
)

692  
TRUE
;

693 
h
 = 
	`LßdLib¿ry
(
	`TEXT
("mlang.dll"));

694 ià(!
h
)

695  
FALSE
;

696 
CÚv”tIN‘SŒšg
 = (
CONVERTINETSTRING
)
	`G‘ProcAdd»ssA
(
h
, "ConvertINetString");

697 
CÚv”tIN‘MuÉiBy‹ToUnicode
 = (
CONVERTINETMULTIBYTETOUNICODE
)
	`G‘ProcAdd»ssA
(
h
, "ConvertINetMultiByteToUnicode");

698 
CÚv”tIN‘UnicodeToMuÉiBy‹
 = (
CONVERTINETUNICODETOMULTIBYTE
)
	`G‘ProcAdd»ssA
(
h
, "ConvertINetUnicodeToMultiByte");

699 
IsCÚv”tIN‘SŒšgAvažabË
 = (
ISCONVERTINETSTRINGAVAILABLE
)
	`G‘ProcAdd»ssA
(
h
, "IsConvertINetStringAvailable");

700 
LcidToRfc1766A
 = (
LCIDTORFC1766A
)
	`G‘ProcAdd»ssA
(
h
, "LcidToRfc1766A");

701 
Rfc1766ToLcidA
 = (
RFC1766TOLCIDA
)
	`G‘ProcAdd»ssA
(
h
, "Rfc1766ToLcidA");

702  
TRUE
;

703 
	}
}

705 
icÚv_t


706 
	$icÚv_Ý’
(cÚ¡ *
tocode
, cÚ¡ *
äomcode
)

708 
»c_icÚv_t
 *
cd
;

710 
cd
 = (
»c_icÚv_t
 *)
	`ÿÎoc
(1, (rec_iconv_t));

711 ià(
cd
 =ð
NULL
)

712  (
icÚv_t
)(-1);

714 #ià
	`defšed
(
USE_LIBICONV_DLL
)

715 
”ºo
 = 0;

716 ià(
	`libicÚv_icÚv_Ý’
(
cd
, 
tocode
, 
äomcode
))

717  (
icÚv_t
)
cd
;

722 
”ºo
 = 0;

723 ià(
	`wš_icÚv_Ý’
(
cd
, 
tocode
, 
äomcode
))

724  (
icÚv_t
)
cd
;

726 
	`ä“
(
cd
);

728  (
icÚv_t
)(-1);

729 
	}
}

732 
	$icÚv_þo£
(
icÚv_t
 
_cd
)

734 
»c_icÚv_t
 *
cd
 = (»c_icÚv_ˆ*)
_cd
;

735 
r
 = 
cd
->
	`icÚv_þo£
(cd->cd);

736 
e
 = *(
cd
->
	`_”ºo
());

737 #ià
	`defšed
(
USE_LIBICONV_DLL
)

738 ià(
cd
->
hlibicÚv
 !ð
NULL
)

739 
	`F»eLib¿ry
(
cd
->
hlibicÚv
);

741 
	`ä“
(
cd
);

742 
”ºo
 = 
e
;

743  
r
;

744 
	}
}

746 
size_t


747 
	$icÚv
(
icÚv_t
 
_cd
, cÚ¡ **
šbuf
, 
size_t
 *
šby‹¦eá
, **
outbuf
, size_ˆ*
outby‹¦eá
)

749 
»c_icÚv_t
 *
cd
 = (»c_icÚv_ˆ*)
_cd
;

750 
size_t
 
r
 = 
cd
->
	`icÚv
(cd->cd, 
šbuf
, 
šby‹¦eá
, 
outbuf
, 
outby‹¦eá
);

751 
”ºo
 = *(
cd
->
	`_”ºo
());

752  
r
;

753 
	}
}

756 
	$wš_icÚv_Ý’
(
»c_icÚv_t
 *
cd
, cÚ¡ *
tocode
, cÚ¡ *
äomcode
)

758 ià(!
	`make_cscÚv
(
äomcode
, &
cd
->
äom
è|| !make_cscÚv(
tocode
, &cd->
to
))

759  
FALSE
;

760 
cd
->
icÚv_þo£
 = 
wš_icÚv_þo£
;

761 
cd
->
icÚv
 = 
wš_icÚv
;

762 
cd
->
_”ºo
 = _errno;

763 
cd
->cd = (
icÚv_t
)cd;

764  
TRUE
;

765 
	}
}

768 
	$wš_icÚv_þo£
(
icÚv_t
 
cd
 
UNUSED
)

771 
	}
}

773 
size_t


774 
	$wš_icÚv
(
icÚv_t
 
_cd
, cÚ¡ **
šbuf
, 
size_t
 *
šby‹¦eá
, **
outbuf
, size_ˆ*
outby‹¦eá
)

776 
»c_icÚv_t
 *
cd
 = (»c_icÚv_ˆ*)
_cd
;

777 
ushÜt
 
wbuf
[
MB_CHAR_MAX
];

778 
šsize
;

779 
outsize
;

780 
wsize
;

781 
DWORD
 
äommode
;

782 
DWORD
 
tomode
;

783 
ušt
 
wc
;

784 
com·t_t
 *
ý
;

785 
i
;

787 ià(
šbuf
 =ð
NULL
 || *inbuf == NULL)

789 ià(
outbuf
 !ð
NULL
 && *outbuà!ðNULL && 
cd
->
to
.
æush
 != NULL)

791 
tomode
 = 
cd
->
to
.
mode
;

792 
outsize
 = 
cd
->
to
.
	`æush
(&cd->to, (
uch¬
 *)*
outbuf
, ()*
outby‹¦eá
);

793 ià(
outsize
 == -1)

795 ià((
cd
->
to
.
æags
 & 
FLAG_IGNORE
è&& 
”ºo
 !ð
E2BIG
)

797 
outsize
 = 0;

801 
cd
->
to
.
mode
 = 
tomode
;

802  (
size_t
)(-1);

805 *
outbuf
 +ð
outsize
;

806 *
outby‹¦eá
 -ð
outsize
;

808 
cd
->
äom
.
mode
 = 0;

809 
cd
->
to
.
mode
 = 0;

813 *
šby‹¦eá
 != 0)

815 
äommode
 = 
cd
->
äom
.
mode
;

816 
tomode
 = 
cd
->
to
.
mode
;

817 
wsize
 = 
MB_CHAR_MAX
;

819 
šsize
 = 
cd
->
äom
.
	`mbtowc
(&cd->äom, (cÚ¡ 
uch¬
 *)*
šbuf
, ()*
šby‹¦eá
, 
wbuf
, &
wsize
);

820 ià(
šsize
 == -1)

822 ià(
cd
->
to
.
æags
 & 
FLAG_IGNORE
)

824 
cd
->
äom
.
mode
 = 
äommode
;

825 
šsize
 = 1;

826 
wsize
 = 0;

830 
cd
->
äom
.
mode
 = 
äommode
;

831  (
size_t
)(-1);

835 ià(
wsize
 == 0)

837 *
šbuf
 +ð
šsize
;

838 *
šby‹¦eá
 -ð
šsize
;

842 ià(
cd
->
äom
.
com·t
 !ð
NULL
)

844 
wc
 = 
	`utf16_to_ucs4
(
wbuf
);

845 
ý
 = 
cd
->
äom
.
com·t
;

846 
i
 = 0; 
ý
[i].
š
 != 0; ++i)

848 ià((
ý
[
i
].
æag
 & 
COMPAT_IN
è&& cp[i].
out
 =ð
wc
)

850 
	`ucs4_to_utf16
(
ý
[
i
].
š
, 
wbuf
, &
wsize
);

856 ià(
cd
->
to
.
com·t
 !ð
NULL
)

858 
wc
 = 
	`utf16_to_ucs4
(
wbuf
);

859 
ý
 = 
cd
->
to
.
com·t
;

860 
i
 = 0; 
ý
[i].
š
 != 0; ++i)

862 ià((
ý
[
i
].
æag
 & 
COMPAT_OUT
è&& cp[i].
š
 =ð
wc
)

864 
	`ucs4_to_utf16
(
ý
[
i
].
out
, 
wbuf
, &
wsize
);

870 
outsize
 = 
cd
->
to
.
	`wùomb
(&cd->to, 
wbuf
, 
wsize
, (
uch¬
 *)*
outbuf
, ()*
outby‹¦eá
);

871 ià(
outsize
 == -1)

873 ià((
cd
->
to
.
æags
 & 
FLAG_IGNORE
è&& 
”ºo
 !ð
E2BIG
)

875 
cd
->
to
.
mode
 = 
tomode
;

876 
outsize
 = 0;

880 
cd
->
äom
.
mode
 = 
äommode
;

881 
cd
->
to
.
mode
 = 
tomode
;

882  (
size_t
)(-1);

886 *
šbuf
 +ð
šsize
;

887 *
outbuf
 +ð
outsize
;

888 *
šby‹¦eá
 -ð
šsize
;

889 *
outby‹¦eá
 -ð
outsize
;

893 
	}
}

896 
	$make_cscÚv
(cÚ¡ *
_Çme
, 
cscÚv_t
 *
cv
)

898 
CPINFO
 
ýšfo
;

899 
u£_com·t
 = 
TRUE
;

900 
æag
 = 0;

901 *
Çme
;

902 *
p
;

904 
Çme
 = 
	`x¡ºdup
(
_Çme
, 
	`¡¾’
(_name));

905 ià(
Çme
 =ð
NULL
)

906  
FALSE
;

909 (
p
 = 
	`¡¼¡r
(
Çme
, "//")è!ð
NULL
)

911 ià(
	`_¡ricmp
(
p
 + 2, "nocompat") == 0)

912 
u£_com·t
 = 
FALSE
;

913 ià(
	`_¡ricmp
(
p
 + 2, "translit") == 0)

914 
æag
 |ð
FLAG_TRANSLIT
;

915 ià(
	`_¡ricmp
(
p
 + 2, "ignore") == 0)

916 
æag
 |ð
FLAG_IGNORE
;

917 *
p
 = 0;

920 
cv
->
mode
 = 0;

921 
cv
->
æags
 = 
æag
;

922 
cv
->
mbËn
 = 
NULL
;

923 
cv
->
æush
 = 
NULL
;

924 
cv
->
com·t
 = 
NULL
;

925 
cv
->
cod•age
 = 
	`Çme_to_cod•age
(
Çme
);

926 ià(
cv
->
cod•age
 == 1200 || cv->codepage == 1201)

928 
cv
->
mbtowc
 = 
utf16_mbtowc
;

929 
cv
->
wùomb
 = 
utf16_wùomb
;

930 ià(
	`_¡ricmp
(
Çme
, "UTF-16") == 0 || _stricmp(name, "UTF16") == 0 ||

931 
	`_¡ricmp
(
Çme
, "UCS-2") == 0 || _stricmp(name, "UCS2") == 0)

932 
cv
->
æags
 |ð
FLAG_USE_BOM
;

934 ià(
cv
->
cod•age
 == 12000 || cv->codepage == 12001)

936 
cv
->
mbtowc
 = 
utf32_mbtowc
;

937 
cv
->
wùomb
 = 
utf32_wùomb
;

938 ià(
	`_¡ricmp
(
Çme
, "UTF-32") == 0 || _stricmp(name, "UTF32") == 0 ||

939 
	`_¡ricmp
(
Çme
, "UCS-4") == 0 || _stricmp(name, "UCS4") == 0)

940 
cv
->
æags
 |ð
FLAG_USE_BOM
;

942 ià(
cv
->
cod•age
 == 65001)

944 
cv
->
mbtowc
 = 
k”Ãl_mbtowc
;

945 
cv
->
wùomb
 = 
k”Ãl_wùomb
;

946 
cv
->
mbËn
 = 
utf8_mbËn
;

948 ià((
cv
->
cod•age
 =ð50220 || cv->cod•ag=ð50221 || cv->cod•ag=ð50222è&& 
	`lßd_mÏng
())

950 
cv
->
mbtowc
 = 
iso2022jp_mbtowc
;

951 
cv
->
wùomb
 = 
iso2022jp_wùomb
;

952 
cv
->
æush
 = 
iso2022jp_æush
;

954 ià(
cv
->
cod•age
 =ð51932 && 
	`lßd_mÏng
())

956 
cv
->
mbtowc
 = 
mÏng_mbtowc
;

957 
cv
->
wùomb
 = 
mÏng_wùomb
;

958 
cv
->
mbËn
 = 
eucjp_mbËn
;

960 ià(
	`IsV®idCodePage
(
cv
->
cod•age
)

961 && 
	`G‘CPInfo
(
cv
->
cod•age
, &
ýšfo
) != 0)

963 
cv
->
mbtowc
 = 
k”Ãl_mbtowc
;

964 
cv
->
wùomb
 = 
k”Ãl_wùomb
;

965 ià(
ýšfo
.
MaxCh¬Size
 == 1)

966 
cv
->
mbËn
 = 
sbcs_mbËn
;

967 ià(
ýšfo
.
MaxCh¬Size
 == 2)

968 
cv
->
mbËn
 = 
dbcs_mbËn
;

970 
cv
->
mbËn
 = 
mbcs_mbËn
;

975 
	`ä“
(
Çme
);

976 
”ºo
 = 
EINVAL
;

977  
FALSE
;

980 ià(
u£_com·t
)

982 
cv
->
cod•age
)

984 932: 
cv
->
com·t
 = 
ý932_com·t
; ;

985 20932: 
cv
->
com·t
 = 
ý20932_com·t
; ;

986 51932: 
cv
->
com·t
 = 
ý51932_com·t
; ;

987 50220: 50221: 50222: 
cv
->
com·t
 = 
ý5022x_com·t
; ;

991 
	`ä“
(
Çme
);

993  
TRUE
;

994 
	}
}

997 
	$Çme_to_cod•age
(cÚ¡ *
Çme
)

999 
i
;

1001 ià(*
Çme
 == '\0' ||

1002 
	`¡rcmp
(
Çme
, "char") == 0)

1003  
	`G‘ACP
();

1004 ià(
	`¡rcmp
(
Çme
, "wchar_t") == 0)

1006 ià(
	`_¡ºicmp
(
Çme
, "cp", 2) == 0)

1007  
	`©oi
(
Çme
 + 2);

1008 ià('0' <ð
Çme
[0] &&‚ame[0] <= '9')

1009  
	`©oi
(
Çme
);

1010 ià(
	`_¡ºicmp
(
Çme
, "xx", 2) == 0)

1011  
	`©oi
(
Çme
 + 2);

1013 
i
 = 0; 
cod•age_®Ÿs
[i].
Çme
 !ð
NULL
; ++i)

1014 ià(
	`_¡ricmp
(
Çme
, 
cod•age_®Ÿs
[
i
].name) == 0)

1015  
cod•age_®Ÿs
[
i
].
cod•age
;

1017 
	}
}

1022 
ušt


1023 
	$utf16_to_ucs4
(cÚ¡ 
ushÜt
 *
wbuf
)

1025 
ušt
 
wc
 = 
wbuf
[0];

1026 ià(0xD800 <ð
wbuf
[0] && wbuf[0] <= 0xDBFF)

1027 
wc
 = ((
wbuf
[0] & 0x3FF) << 10) + (wbuf[1] & 0x3FF) + 0x10000;

1028  
wc
;

1029 
	}
}

1032 
	$ucs4_to_utf16
(
ušt
 
wc
, 
ushÜt
 *
wbuf
, *
wbufsize
)

1034 ià(
wc
 < 0x10000)

1036 
wbuf
[0] = 
wc
;

1037 *
wbufsize
 = 1;

1041 
wc
 -= 0x10000;

1042 
wbuf
[0] = 0xD800 | ((
wc
 >> 10) & 0x3FF);

1043 
wbuf
[1] = 0xDC00 | (
wc
 & 0x3FF);

1044 *
wbufsize
 = 2;

1046 
	}
}

1059 
	$mbtowc_æags
(
cod•age
)

1061  (
cod•age
 == 50220 || codepage == 50221 ||

1062 
cod•age
 == 50222 || codepage == 50225 ||

1063 
cod•age
 == 50227 || codepage == 50229 ||

1064 
cod•age
 == 52936 || codepage == 54936 ||

1065 (
cod•age
 >= 57002 && codepage <= 57011) ||

1066 
cod•age
 =ð65000 || cod•ag=ð42è? 0 : 
MB_ERR_INVALID_CHARS
;

1067 
	}
}

1078 
	$mu¡_u£_nuÎ_u£ddeçuÉch¬
(
cod•age
)

1080  (
cod•age
 == 65000 || codepage == 65001 ||

1081 
cod•age
 == 50220 || codepage == 50221 ||

1082 
cod•age
 == 50222 || codepage == 50225 ||

1083 
cod•age
 == 50227 || codepage == 50229 ||

1084 
cod•age
 == 52936 || codepage == 54936 ||

1085 (
cod•age
 >= 57002 && codepage <= 57011) ||

1086 
cod•age
 == 42);

1087 
	}
}

1090 
	$¡¼¡r
(cÚ¡ *
¡r
, cÚ¡ *
tok’
)

1092 
size_t
 
Ën
 = 
	`¡¾’
(
tok’
);

1093 cÚ¡ *
p
 = 
¡r
 + 
	`¡¾’
(str);

1095 
¡r
 <ð--
p
)

1096 ià(
p
[0] =ð
tok’
[0] && 
	`¡ºcmp
Õ,ok’, 
Ën
) == 0)

1097  (*)
p
;

1098  
NULL
;

1099 
	}
}

1102 
	$x¡ºdup
(cÚ¡ *
s
, 
size_t
 
n
)

1104 *
p
;

1106 
p
 = (*)
	`m®loc
(
n
 + 1);

1107 ià(
p
 =ð
NULL
)

1108  
NULL
;

1109 
	`memýy
(
p
, 
s
, 
n
);

1110 
p
[
n
] = '\0';

1111  
p
;

1112 
	}
}

1115 
	$£‹¼Ü
(
”r
)

1117 
”ºo
 = 
”r
;

1119 
	}
}

1121 #ià
defšed
(
USE_LIBICONV_DLL
)

1123 
	$libicÚv_icÚv_Ý’
(
»c_icÚv_t
 *
cd
, cÚ¡ *
tocode
, cÚ¡ *
äomcode
)

1125 
HMODULE
 
hlibicÚv
 = 
NULL
;

1126 
HMODULE
 
hmsvüt
 = 
NULL
;

1127 *
dÎÇme
;

1128 cÚ¡ *
p
;

1129 cÚ¡ *
e
;

1130 
f_icÚv_Ý’
 
_icÚv_Ý’
;

1137 
p
 = 
	`g‘’v
("WINICONV_LIBICONV_DLL");

1138 ià(
p
 =ð
NULL
)

1139 
p
 = 
DEFAULT_LIBICONV_DLL
;

1141  ; *
p
 !ð0;… = (*
e
 == ',') ?ƒ + 1 :ƒ)

1143 
e
 = 
	`¡rchr
(
p
, ',');

1144 ià(
p
 =ð
e
)

1146 ià(
e
 =ð
NULL
)

1147 
e
 = 
p
 + 
	`¡¾’
(p);

1148 
dÎÇme
 = 
	`x¡ºdup
(
p
, 
e
 -…);

1149 ià(
dÎÇme
 =ð
NULL
)

1150  
FALSE
;

1151 
hlibicÚv
 = 
	`LßdLib¿ryA
(
dÎÇme
);

1152 
	`ä“
(
dÎÇme
);

1153 ià(
hlibicÚv
 !ð
NULL
)

1155 ià(
hlibicÚv
 =ð
hwšicÚv
)

1157 
	`F»eLib¿ry
(
hlibicÚv
);

1158 
hlibicÚv
 = 
NULL
;

1165 ià(
hlibicÚv
 =ð
NULL
)

1166 
çžed
;

1168 
hmsvüt
 = 
	`fšd_impÜ‹d_moduË_by_funúame
(
hlibicÚv
, "_errno");

1169 ià(
hmsvüt
 =ð
NULL
)

1170 
çžed
;

1172 
_icÚv_Ý’
 = (
f_icÚv_Ý’
)
	`G‘ProcAdd»ssA
(
hlibicÚv
, "libiconv_open");

1173 ià(
_icÚv_Ý’
 =ð
NULL
)

1174 
_icÚv_Ý’
 = (
f_icÚv_Ý’
)
	`G‘ProcAdd»ssA
(
hlibicÚv
, "iconv_open");

1175 
cd
->
icÚv_þo£
 = (
f_icÚv_þo£
)
	`G‘ProcAdd»ssA
(
hlibicÚv
, "libiconv_close");

1176 ià(
cd
->
icÚv_þo£
 =ð
NULL
)

1177 
cd
->
icÚv_þo£
 = (
f_icÚv_þo£
)
	`G‘ProcAdd»ssA
(
hlibicÚv
, "iconv_close");

1178 
cd
->
icÚv
 = (
f_icÚv
)
	`G‘ProcAdd»ssA
(
hlibicÚv
, "libiconv");

1179 ià(
cd
->
icÚv
 =ð
NULL
)

1180 
cd
->
icÚv
 = (
f_icÚv
)
	`G‘ProcAdd»ssA
(
hlibicÚv
, "iconv");

1181 
cd
->
_”ºo
 = (
f_”ºo
)
	`G‘ProcAdd»ssA
(
hmsvüt
, "_errno");

1182 ià(
_icÚv_Ý’
 =ð
NULL
 || 
cd
->
icÚv_þo£
 == NULL

1183 || 
cd
->
icÚv
 =ð
NULL
 || cd->
_”ºo
 == NULL)

1184 
çžed
;

1186 
cd
->cd = 
	`_icÚv_Ý’
(
tocode
, 
äomcode
);

1187 ià(
cd
->cd =ð(
icÚv_t
)(-1))

1188 
çžed
;

1190 
cd
->
hlibicÚv
 = hlibiconv;

1191  
TRUE
;

1193 
çžed
:

1194 ià(
hlibicÚv
 !ð
NULL
)

1195 
	`F»eLib¿ry
(
hlibicÚv
);

1197  
FALSE
;

1198 
	}
}

1210 
	#TO_DOS_HEADER
(
ba£
è((
PIMAGE_DOS_HEADER
)(ba£))

	)

1211 
	#TO_NT_HEADERS
(
ba£
è((
PIMAGE_NT_HEADERS
)((
LPBYTE
)(ba£è+ 
	`TO_DOS_HEADER
(ba£)->
e_lçÃw
))

	)

1212 
PVOID


1213 
	$MyImageDœeùÜyEÁryToD©a
(
LPVOID
 
Ba£
, 
BOOLEAN
 
M­³dAsImage
, 
USHORT
 
DœeùÜyEÁry
, 
PULONG
 
Size
)

1216 
PIMAGE_DATA_DIRECTORY
 
p
;

1217 
p
 = 
	`TO_NT_HEADERS
(
Ba£
)->
O±iÚ®H—d”
.
D©aDœeùÜy
 + 
DœeùÜyEÁry
;

1218 ià(
p
->
Vœtu®Add»ss
 == 0) {

1219 *
Size
 = 0;

1220  
NULL
;

1222 *
Size
 = 
p
->Size;

1223  (
PVOID
)((
LPBYTE
)
Ba£
 + 
p
->
Vœtu®Add»ss
);

1224 
	}
}

1226 
HMODULE


1227 
	$fšd_impÜ‹d_moduË_by_funúame
(
HMODULE
 
hModuË
, cÚ¡ *
funúame
)

1229 
DWORD_PTR
 
Ba£
;

1230 
ULONG
 
Size
;

1231 
PIMAGE_IMPORT_DESCRIPTOR
 
Imp
;

1232 
PIMAGE_THUNK_DATA
 
Name
;

1233 
PIMAGE_IMPORT_BY_NAME
 
ImpName
;

1235 
Ba£
 = (
DWORD_PTR
)
hModuË
;

1236 
Imp
 = (
PIMAGE_IMPORT_DESCRIPTOR
)
	`MyImageDœeùÜyEÁryToD©a
(

1237 (
LPVOID
)
Ba£
,

1238 
TRUE
,

1239 
IMAGE_DIRECTORY_ENTRY_IMPORT
,

1240 &
Size
);

1241 ià(
Imp
 =ð
NULL
)

1242  
NULL
;

1243  ; 
Imp
->
Origš®Fœ¡Thunk
 != 0; ++Imp)

1245 
Name
 = (
PIMAGE_THUNK_DATA
)(
Ba£
 + 
Imp
->
Origš®Fœ¡Thunk
);

1246  ; 
Name
->
u1
.
Ordš®
 != 0; ++Name)

1248 ià(!
	`IMAGE_SNAP_BY_ORDINAL
(
Name
->
u1
.
Ordš®
))

1250 
ImpName
 = (
PIMAGE_IMPORT_BY_NAME
)

1251 (
Ba£
 + (
DWORD_PTR
)
Name
->
u1
.
Add»ssOfD©a
);

1252 ià(
	`¡rcmp
((*)
ImpName
->
Name
, 
funúame
) == 0)

1253  
	`G‘ModuËHªdËA
((*)(
Ba£
 + 
Imp
->
Name
));

1257  
NULL
;

1258 
	}
}

1262 
	$sbcs_mbËn
(
cscÚv_t
 *
cv
 
UNUSED
, cÚ¡ 
uch¬
 *
buf
 UNUSED, 
bufsize
 UNUSED)

1265 
	}
}

1268 
	$dbcs_mbËn
(
cscÚv_t
 *
cv
, cÚ¡ 
uch¬
 *
buf
, 
bufsize
)

1270 
Ën
 = 
	`IsDBCSL—dBy‹Ex
(
cv
->
cod•age
, 
buf
[0]) ? 2 : 1;

1271 ià(
bufsize
 < 
Ën
)

1272  
	`£‹¼Ü
(
EINVAL
);

1273  
Ën
;

1274 
	}
}

1277 
	$mbcs_mbËn
(
cscÚv_t
 *
cv
, cÚ¡ 
uch¬
 *
buf
, 
bufsize
)

1279 
Ën
 = 0;

1281 ià(
cv
->
cod•age
 == 54936) {

1282 ià(
buf
[0] <ð0x7Fè
Ën
 = 1;

1283 ià(
buf
[0] >= 0x81 && buf[0] <= 0xFE &&

1284 
bufsize
 >= 2 &&

1285 ((
buf
[1] >= 0x40 && buf[1] <= 0x7E) ||

1286 (
buf
[1] >ð0x80 && buf[1] <ð0xFE))è
Ën
 = 2;

1287 ià(
buf
[0] >= 0x81 && buf[0] <= 0xFE &&

1288 
bufsize
 >= 4 &&

1289 
buf
[1] >ð0x30 && buf[1] <ð0x39è
Ën
 = 4;

1291  
	`£‹¼Ü
(
EINVAL
);

1292  
Ën
;

1295  
	`£‹¼Ü
(
EINVAL
);

1296 
	}
}

1299 
	$utf8_mbËn
(
cscÚv_t
 *
cv
 
UNUSED
, cÚ¡ 
uch¬
 *
buf
, 
bufsize
)

1301 
Ën
 = 0;

1303 ià(
buf
[0] < 0x80è
Ën
 = 1;

1304 ià((
buf
[0] & 0xE0è=ð0xC0è
Ën
 = 2;

1305 ià((
buf
[0] & 0xF0è=ð0xE0è
Ën
 = 3;

1306 ià((
buf
[0] & 0xF8è=ð0xF0è
Ën
 = 4;

1307 ià((
buf
[0] & 0xFCè=ð0xF8è
Ën
 = 5;

1308 ià((
buf
[0] & 0xFEè=ð0xFCè
Ën
 = 6;

1310 ià(
Ën
 == 0)

1311  
	`£‹¼Ü
(
EILSEQ
);

1312 ià(
bufsize
 < 
Ën
)

1313  
	`£‹¼Ü
(
EINVAL
);

1314  
Ën
;

1315 
	}
}

1318 
	$eucjp_mbËn
(
cscÚv_t
 *
cv
 
UNUSED
, cÚ¡ 
uch¬
 *
buf
, 
bufsize
)

1320 ià(
buf
[0] < 0x80)

1322 ià(
buf
[0] == 0x8E)

1324 ià(
bufsize
 < 2)

1325  
	`£‹¼Ü
(
EINVAL
);

1326 ià(!(0xA1 <ð
buf
[1] && buf[1] <= 0xDF))

1327  
	`£‹¼Ü
(
EILSEQ
);

1330 ià(
buf
[0] == 0x8F)

1332 ià(
bufsize
 < 3)

1333  
	`£‹¼Ü
(
EINVAL
);

1334 ià(!(0xA1 <ð
buf
[1] && buf[1] <= 0xFE)

1335 || !(0xA1 <ð
buf
[2] && buf[2] <= 0xFE))

1336  
	`£‹¼Ü
(
EILSEQ
);

1341 ià(
bufsize
 < 2)

1342  
	`£‹¼Ü
(
EINVAL
);

1343 ià(!(0xA1 <ð
buf
[0] && buf[0] <= 0xFE)

1344 || !(0xA1 <ð
buf
[1] && buf[1] <= 0xFE))

1345  
	`£‹¼Ü
(
EILSEQ
);

1348 
	}
}

1351 
	$k”Ãl_mbtowc
(
cscÚv_t
 *
cv
, cÚ¡ 
uch¬
 *
buf
, 
bufsize
, 
ushÜt
 *
wbuf
, *
wbufsize
)

1353 
Ën
;

1355 
Ën
 = 
cv
->
	`mbËn
(cv, 
buf
, 
bufsize
);

1356 ià(
Ën
 == -1)

1358 *
wbufsize
 = 
	`MuÉiBy‹ToWideCh¬
(
cv
->
cod•age
, 
	`mbtowc_æags
 (cv->codepage),

1359 (cÚ¡ *)
buf
, 
Ën
, (
wch¬_t
 *)
wbuf
, *
wbufsize
);

1360 ià(*
wbufsize
 == 0)

1361  
	`£‹¼Ü
(
EILSEQ
);

1362  
Ën
;

1363 
	}
}

1366 
	$k”Ãl_wùomb
(
cscÚv_t
 *
cv
, 
ushÜt
 *
wbuf
, 
wbufsize
, 
uch¬
 *
buf
, 
bufsize
)

1368 
BOOL
 
u£dDeçuÉCh¬
 = 0;

1369 
BOOL
 *
p
 = 
NULL
;

1370 
æags
 = 0;

1371 
Ën
;

1373 ià(
bufsize
 == 0)

1374  
	`£‹¼Ü
(
E2BIG
);

1375 ià(!
	`mu¡_u£_nuÎ_u£ddeçuÉch¬
(
cv
->
cod•age
))

1377 
p
 = &
u£dDeçuÉCh¬
;

1378 #ifdeà
WC_NO_BEST_FIT_CHARS


1379 ià(!(
cv
->
æags
 & 
FLAG_TRANSLIT
))

1380 
æags
 |ð
WC_NO_BEST_FIT_CHARS
;

1383 
Ën
 = 
	`WideCh¬ToMuÉiBy‹
(
cv
->
cod•age
, 
æags
,

1384 (cÚ¡ 
wch¬_t
 *)
wbuf
, 
wbufsize
, (*)
buf
, 
bufsize
, 
NULL
, 
p
);

1385 ià(
Ën
 == 0)

1387 ià(
	`G‘La¡E¼Ü
(è=ð
ERROR_INSUFFICIENT_BUFFER
)

1388  
	`£‹¼Ü
(
E2BIG
);

1389  
	`£‹¼Ü
(
EILSEQ
);

1391 ià(
u£dDeçuÉCh¬
 && !(
cv
->
æags
 & 
FLAG_TRANSLIT
))

1392  
	`£‹¼Ü
(
EILSEQ
);

1393 ià(
cv
->
	`mbËn
(cv, 
buf
, 
Ën
) !=†en)

1394  
	`£‹¼Ü
(
EILSEQ
);

1395  
Ën
;

1396 
	}
}

1407 
	$mÏng_mbtowc
(
cscÚv_t
 *
cv
, cÚ¡ 
uch¬
 *
buf
, 
bufsize
, 
ushÜt
 *
wbuf
, *
wbufsize
)

1409 
Ën
;

1410 
šsize
;

1411 
HRESULT
 
hr
;

1413 
Ën
 = 
cv
->
	`mbËn
(cv, 
buf
, 
bufsize
);

1414 ià(
Ën
 == -1)

1416 
šsize
 = 
Ën
;

1417 
hr
 = 
	`CÚv”tIN‘MuÉiBy‹ToUnicode
(&
cv
->
mode
, cv->
cod•age
,

1418 (cÚ¡ *)
buf
, &
šsize
, (
wch¬_t
 *)
wbuf
, 
wbufsize
);

1419 ià(
hr
 !ð
S_OK
 || 
šsize
 !ð
Ën
)

1420  
	`£‹¼Ü
(
EILSEQ
);

1421  
Ën
;

1422 
	}
}

1425 
	$mÏng_wùomb
(
cscÚv_t
 *
cv
, 
ushÜt
 *
wbuf
, 
wbufsize
, 
uch¬
 *
buf
, 
bufsize
)

1427 
tmpbuf
[
MB_CHAR_MAX
];

1428 
tmpsize
 = 
MB_CHAR_MAX
;

1429 
šsize
 = 
wbufsize
;

1430 
HRESULT
 
hr
;

1432 
hr
 = 
	`CÚv”tIN‘UnicodeToMuÉiBy‹
(&
cv
->
mode
, cv->
cod•age
,

1433 (cÚ¡ 
wch¬_t
 *)
wbuf
, &
wbufsize
, 
tmpbuf
, &
tmpsize
);

1434 ià(
hr
 !ð
S_OK
 || 
šsize
 !ð
wbufsize
)

1435  
	`£‹¼Ü
(
EILSEQ
);

1436 ià(
bufsize
 < 
tmpsize
)

1437  
	`£‹¼Ü
(
E2BIG
);

1438 ià(
cv
->
	`mbËn
(cv, (
uch¬
 *)
tmpbuf
, 
tmpsize
) !=mpsize)

1439  
	`£‹¼Ü
(
EILSEQ
);

1440 
	`memýy
(
buf
, 
tmpbuf
, 
tmpsize
);

1441  
tmpsize
;

1442 
	}
}

1445 
	$utf16_mbtowc
(
cscÚv_t
 *
cv
, cÚ¡ 
uch¬
 *
buf
, 
bufsize
, 
ushÜt
 *
wbuf
, *
wbufsize
)

1447 
cod•age
 = 
cv
->codepage;

1450 ià(
cv
->
mode
 & 
UNICODE_MODE_SWAPPED
)

1451 
cod•age
 ^= 1;

1453 ià(
bufsize
 < 2)

1454  
	`£‹¼Ü
(
EINVAL
);

1455 ià(
cod•age
 == 1200)

1456 
wbuf
[0] = (
buf
[1] << 8) | buf[0];

1457 ià(
cod•age
 == 1201)

1458 
wbuf
[0] = (
buf
[0] << 8) | buf[1];

1460 ià((
cv
->
æags
 & 
FLAG_USE_BOM
è&& !(cv->
mode
 & 
UNICODE_MODE_BOM_DONE
))

1462 
cv
->
mode
 |ð
UNICODE_MODE_BOM_DONE
;

1463 ià(
wbuf
[0] == 0xFFFE)

1465 
cv
->
mode
 |ð
UNICODE_MODE_SWAPPED
;

1466 *
wbufsize
 = 0;

1469 ià(
wbuf
[0] == 0xFEFF)

1471 *
wbufsize
 = 0;

1476 ià(0xDC00 <ð
wbuf
[0] && wbuf[0] <= 0xDFFF)

1477  
	`£‹¼Ü
(
EILSEQ
);

1478 ià(0xD800 <ð
wbuf
[0] && wbuf[0] <= 0xDBFF)

1480 ià(
bufsize
 < 4)

1481  
	`£‹¼Ü
(
EINVAL
);

1482 ià(
cod•age
 == 1200)

1483 
wbuf
[1] = (
buf
[3] << 8) | buf[2];

1484 ià(
cod•age
 == 1201)

1485 
wbuf
[1] = (
buf
[2] << 8) | buf[3];

1486 ià(!(0xDC00 <ð
wbuf
[1] && wbuf[1] <= 0xDFFF))

1487  
	`£‹¼Ü
(
EILSEQ
);

1488 *
wbufsize
 = 2;

1491 *
wbufsize
 = 1;

1493 
	}
}

1496 
	$utf16_wùomb
(
cscÚv_t
 *
cv
, 
ushÜt
 *
wbuf
, 
wbufsize
, 
uch¬
 *
buf
, 
bufsize
)

1498 ià((
cv
->
æags
 & 
FLAG_USE_BOM
è&& !(cv->
mode
 & 
UNICODE_MODE_BOM_DONE
))

1500 
r
;

1502 
cv
->
mode
 |ð
UNICODE_MODE_BOM_DONE
;

1503 ià(
bufsize
 < 2)

1504  
	`£‹¼Ü
(
E2BIG
);

1505 ià(
cv
->
cod•age
 == 1200)

1506 
	`memýy
(
buf
, "\xFF\xFE", 2);

1507 ià(
cv
->
cod•age
 == 1201)

1508 
	`memýy
(
buf
, "\xFE\xFF", 2);

1510 
r
 = 
	`utf16_wùomb
(
cv
, 
wbuf
, 
wbufsize
, 
buf
 + 2, 
bufsize
 - 2);

1511 ià(
r
 == -1)

1513  
r
 + 2;

1516 ià(
bufsize
 < 2)

1517  
	`£‹¼Ü
(
E2BIG
);

1518 ià(
cv
->
cod•age
 == 1200)

1520 
buf
[0] = (
wbuf
[0] & 0x00FF);

1521 
buf
[1] = (
wbuf
[0] & 0xFF00) >> 8;

1523 ià(
cv
->
cod•age
 == 1201)

1525 
buf
[0] = (
wbuf
[0] & 0xFF00) >> 8;

1526 
buf
[1] = (
wbuf
[0] & 0x00FF);

1528 ià(0xD800 <ð
wbuf
[0] && wbuf[0] <= 0xDBFF)

1530 ià(
bufsize
 < 4)

1531  
	`£‹¼Ü
(
E2BIG
);

1532 ià(
cv
->
cod•age
 == 1200)

1534 
buf
[2] = (
wbuf
[1] & 0x00FF);

1535 
buf
[3] = (
wbuf
[1] & 0xFF00) >> 8;

1537 ià(
cv
->
cod•age
 == 1201)

1539 
buf
[2] = (
wbuf
[1] & 0xFF00) >> 8;

1540 
buf
[3] = (
wbuf
[1] & 0x00FF);

1545 
	}
}

1548 
	$utf32_mbtowc
(
cscÚv_t
 *
cv
, cÚ¡ 
uch¬
 *
buf
, 
bufsize
, 
ushÜt
 *
wbuf
, *
wbufsize
)

1550 
cod•age
 = 
cv
->codepage;

1551 
ušt
 
wc
;

1554 ià(
cv
->
mode
 & 
UNICODE_MODE_SWAPPED
)

1555 
cod•age
 ^= 1;

1557 ià(
bufsize
 < 4)

1558  
	`£‹¼Ü
(
EINVAL
);

1559 ià(
cod•age
 == 12000)

1560 
wc
 = (
buf
[3] << 24) | (buf[2] << 16) | (buf[1] << 8) | buf[0];

1561 ià(
cod•age
 == 12001)

1562 
wc
 = (
buf
[0] << 24) | (buf[1] << 16) | (buf[2] << 8) | buf[3];

1564 ià((
cv
->
æags
 & 
FLAG_USE_BOM
è&& !(cv->
mode
 & 
UNICODE_MODE_BOM_DONE
))

1566 
cv
->
mode
 |ð
UNICODE_MODE_BOM_DONE
;

1567 ià(
wc
 == 0xFFFE0000)

1569 
cv
->
mode
 |ð
UNICODE_MODE_SWAPPED
;

1570 *
wbufsize
 = 0;

1573 ià(
wc
 == 0x0000FEFF)

1575 *
wbufsize
 = 0;

1580 ià((0xD800 <ð
wc
 && wc <= 0xDFFF) || 0x10FFFF < wc)

1581  
	`£‹¼Ü
(
EILSEQ
);

1582 
	`ucs4_to_utf16
(
wc
, 
wbuf
, 
wbufsize
);

1584 
	}
}

1587 
	$utf32_wùomb
(
cscÚv_t
 *
cv
, 
ushÜt
 *
wbuf
, 
wbufsize
, 
uch¬
 *
buf
, 
bufsize
)

1589 
ušt
 
wc
;

1591 ià((
cv
->
æags
 & 
FLAG_USE_BOM
è&& !(cv->
mode
 & 
UNICODE_MODE_BOM_DONE
))

1593 
r
;

1595 
cv
->
mode
 |ð
UNICODE_MODE_BOM_DONE
;

1596 ià(
bufsize
 < 4)

1597  
	`£‹¼Ü
(
E2BIG
);

1598 ià(
cv
->
cod•age
 == 12000)

1599 
	`memýy
(
buf
, "\xFF\xFE\x00\x00", 4);

1600 ià(
cv
->
cod•age
 == 12001)

1601 
	`memýy
(
buf
, "\x00\x00\xFE\xFF", 4);

1603 
r
 = 
	`utf32_wùomb
(
cv
, 
wbuf
, 
wbufsize
, 
buf
 + 4, 
bufsize
 - 4);

1604 ià(
r
 == -1)

1606  
r
 + 4;

1609 ià(
bufsize
 < 4)

1610  
	`£‹¼Ü
(
E2BIG
);

1611 
wc
 = 
	`utf16_to_ucs4
(
wbuf
);

1612 ià(
cv
->
cod•age
 == 12000)

1614 
buf
[0] = 
wc
 & 0x000000FF;

1615 
buf
[1] = (
wc
 & 0x0000FF00) >> 8;

1616 
buf
[2] = (
wc
 & 0x00FF0000) >> 16;

1617 
buf
[3] = (
wc
 & 0xFF000000) >> 24;

1619 ià(
cv
->
cod•age
 == 12001)

1621 
buf
[0] = (
wc
 & 0xFF000000) >> 24;

1622 
buf
[1] = (
wc
 & 0x00FF0000) >> 16;

1623 
buf
[2] = (
wc
 & 0x0000FF00) >> 8;

1624 
buf
[3] = 
wc
 & 0x000000FF;

1627 
	}
}

1642 
	#ISO2022_MODE
(
cs
, 
shiá
è(((csè<< 8è| (shiá))

	)

1643 
	#ISO2022_MODE_CS
(
mode
è(((modeè>> 8è& 0xFF)

	)

1644 
	#ISO2022_MODE_SHIFT
(
mode
è((modeè& 0xFF)

	)

1646 
	#ISO2022_SI
 0

	)

1647 
	#ISO2022_SO
 1

	)

1650 cÚ¡ 
	giso2022_SI_£q
[] = "\x0F";

1652 cÚ¡ 
	giso2022_SO_£q
[] = "\x0E";

1654 
iso2022_esc_t
 
	tiso2022_esc_t
;

1655 
	siso2022_esc_t
 {

1656 cÚ¡ *
	mesc
;

1657 
	mesc_Ën
;

1658 
	mËn
;

1659 
	mcs
;

1662 
	#ISO2022JP_CS_ASCII
 0

	)

1663 
	#ISO2022JP_CS_JISX0201_ROMAN
 1

	)

1664 
	#ISO2022JP_CS_JISX0201_KANA
 2

	)

1665 
	#ISO2022JP_CS_JISX0208_1978
 3

	)

1666 
	#ISO2022JP_CS_JISX0208_1983
 4

	)

1667 
	#ISO2022JP_CS_JISX0212
 5

	)

1669 
iso2022_esc_t
 
	giso2022jp_esc
[] = {

1670 {"\x1B\x28\x42", 3, 1, 
ISO2022JP_CS_ASCII
},

1671 {"\x1B\x28\x4A", 3, 1, 
ISO2022JP_CS_JISX0201_ROMAN
},

1672 {"\x1B\x28\x49", 3, 1, 
ISO2022JP_CS_JISX0201_KANA
},

1673 {"\x1B\x24\x40", 3, 2, 
ISO2022JP_CS_JISX0208_1983
},

1674 {"\x1B\x24\x42", 3, 2, 
ISO2022JP_CS_JISX0208_1983
},

1675 {"\x1B\x24\x28\x44", 4, 2, 
ISO2022JP_CS_JISX0212
},

1676 {
NULL
, 0, 0, 0}

1680 
	$iso2022jp_mbtowc
(
cscÚv_t
 *
cv
, cÚ¡ 
uch¬
 *
buf
, 
bufsize
, 
ushÜt
 *
wbuf
, *
wbufsize
)

1682 
iso2022_esc_t
 *
›sc
 = 
iso2022jp_esc
;

1683 
tmp
[
MB_CHAR_MAX
];

1684 
šsize
;

1685 
HRESULT
 
hr
;

1686 
DWORD
 
dummy
 = 0;

1687 
Ën
;

1688 
esc_Ën
;

1689 
cs
;

1690 
shiá
;

1691 
i
;

1693 ià(
buf
[0] == 0x1B)

1695 
i
 = 0; 
›sc
[i].
esc
 !ð
NULL
; ++i)

1697 
esc_Ën
 = 
›sc
[
i
].esc_len;

1698 ià(
bufsize
 < 
esc_Ën
)

1700 ià(
	`¡ºcmp
((*)
buf
, 
›sc
[
i
].
esc
, 
bufsize
) == 0)

1701  
	`£‹¼Ü
(
EINVAL
);

1705 ià(
	`¡ºcmp
((*)
buf
, 
›sc
[
i
].
esc
, 
esc_Ën
) == 0)

1707 
cv
->
mode
 = 
	`ISO2022_MODE
(
›sc
[
i
].
cs
, 
ISO2022_SI
);

1708 *
wbufsize
 = 0;

1709  
esc_Ën
;

1714  
	`£‹¼Ü
(
EILSEQ
);

1716 ià(
buf
[0] =ð
iso2022_SO_£q
[0])

1718 
cv
->
mode
 = 
	`ISO2022_MODE
(
	`ISO2022_MODE_CS
(cv->mode), 
ISO2022_SO
);

1719 *
wbufsize
 = 0;

1722 ià(
buf
[0] =ð
iso2022_SI_£q
[0])

1724 
cv
->
mode
 = 
	`ISO2022_MODE
(
	`ISO2022_MODE_CS
(cv->mode), 
ISO2022_SI
);

1725 *
wbufsize
 = 0;

1729 
cs
 = 
	`ISO2022_MODE_CS
(
cv
->
mode
);

1730 
shiá
 = 
	`ISO2022_MODE_SHIFT
(
cv
->
mode
);

1733 ià(
buf
[0] < 0x20)

1735 
cs
 = 
ISO2022JP_CS_ASCII
;

1736 
shiá
 = 
ISO2022_SI
;

1739 
Ën
 = 
›sc
[
cs
].len;

1740 ià(
bufsize
 < 
Ën
)

1741  
	`£‹¼Ü
(
EINVAL
);

1742 
i
 = 0; i < 
Ën
; ++i)

1743 ià(!(
buf
[
i
] < 0x80))

1744  
	`£‹¼Ü
(
EILSEQ
);

1745 
esc_Ën
 = 
›sc
[
cs
].esc_len;

1746 
	`memýy
(
tmp
, 
›sc
[
cs
].
esc
, 
esc_Ën
);

1747 ià(
shiá
 =ð
ISO2022_SO
)

1749 
	`memýy
(
tmp
 + 
esc_Ën
, 
iso2022_SO_£q
, 1);

1750 
esc_Ën
 += 1;

1752 
	`memýy
(
tmp
 + 
esc_Ën
, 
buf
, 
Ën
);

1754 ià((
cv
->
cod•age
 == 50220 || cv->codepage == 50221

1755 || 
cv
->
cod•age
 =ð50222è&& 
shiá
 =ð
ISO2022_SO
)

1759 
esc_Ën
 = 
›sc
[
ISO2022JP_CS_JISX0201_KANA
].esc_len;

1760 
	`memýy
(
tmp
, 
›sc
[
ISO2022JP_CS_JISX0201_KANA
].
esc
, 
esc_Ën
);

1761 
	`memýy
(
tmp
 + 
esc_Ën
, 
buf
, 
Ën
);

1764 
šsize
 = 
Ën
 + 
esc_Ën
;

1765 
hr
 = 
	`CÚv”tIN‘MuÉiBy‹ToUnicode
(&
dummy
, 
cv
->
cod•age
,

1766 (cÚ¡ *)
tmp
, &
šsize
, (
wch¬_t
 *)
wbuf
, 
wbufsize
);

1767 ià(
hr
 !ð
S_OK
 || 
šsize
 !ð
Ën
 + 
esc_Ën
)

1768  
	`£‹¼Ü
(
EILSEQ
);

1772 ià(
wbuf
[0] =ð
buf
[0]

1773 && 
cv
->
mode
 !ð
	`ISO2022_MODE
(
ISO2022JP_CS_ASCII
, 
ISO2022_SI
))

1774  
	`£‹¼Ü
(
EILSEQ
);

1777 ià(
cv
->
mode
 !ð(
DWORD
)
	`ISO2022_MODE
(
cs
, 
shiá
))

1778 
cv
->
mode
 = (
DWORD
)
	`ISO2022_MODE
(
cs
, 
shiá
);

1780  
Ën
;

1781 
	}
}

1784 
	$iso2022jp_wùomb
(
cscÚv_t
 *
cv
, 
ushÜt
 *
wbuf
, 
wbufsize
, 
uch¬
 *
buf
, 
bufsize
)

1786 
iso2022_esc_t
 *
›sc
 = 
iso2022jp_esc
;

1787 
tmp
[
MB_CHAR_MAX
];

1788 
tmpsize
 = 
MB_CHAR_MAX
;

1789 
šsize
 = 
wbufsize
;

1790 
HRESULT
 
hr
;

1791 
DWORD
 
dummy
 = 0;

1792 
Ën
;

1793 
esc_Ën
;

1794 
cs
;

1795 
shiá
;

1796 
i
;

1804 
hr
 = 
	`CÚv”tIN‘UnicodeToMuÉiBy‹
(&
dummy
, 
cv
->
cod•age
,

1805 (cÚ¡ 
wch¬_t
 *)
wbuf
, &
wbufsize
, 
tmp
, &
tmpsize
);

1806 ià(
hr
 !ð
S_OK
 || 
šsize
 !ð
wbufsize
)

1807  
	`£‹¼Ü
(
EILSEQ
);

1808 ià(
bufsize
 < 
tmpsize
)

1809  
	`£‹¼Ü
(
E2BIG
);

1811 ià(
tmpsize
 == 1)

1813 
cs
 = 
ISO2022JP_CS_ASCII
;

1814 
esc_Ën
 = 0;

1818 
i
 = 1; 
›sc
[i].
esc
 !ð
NULL
; ++i)

1820 
esc_Ën
 = 
›sc
[
i
].esc_len;

1821 ià(
	`¡ºcmp
(
tmp
, 
›sc
[
i
].
esc
, 
esc_Ën
) == 0)

1823 
cs
 = 
›sc
[
i
].cs;

1827 ià(
›sc
[
i
].
esc
 =ð
NULL
)

1829  
	`£‹¼Ü
(
EILSEQ
);

1832 
shiá
 = 
ISO2022_SI
;

1833 ià(
tmp
[
esc_Ën
] =ð
iso2022_SO_£q
[0])

1835 
shiá
 = 
ISO2022_SO
;

1836 
esc_Ën
 += 1;

1839 
Ën
 = 
›sc
[
cs
].len;

1843 ià(
cs
 =ð
ISO2022JP_CS_ASCII
 && !(
wbuf
[0] < 0x80))

1844  
	`£‹¼Ü
(
EILSEQ
);

1845 ià(
tmpsize
 < 
esc_Ën
 + 
Ën
)

1846  
	`£‹¼Ü
(
EILSEQ
);

1848 ià(
cv
->
mode
 =ð
	`ISO2022_MODE
(
cs
, 
shiá
))

1851 ià(
esc_Ën
 != 0)

1852 
	`memmove
(
tmp
,m°+ 
esc_Ën
, 
Ën
);

1853 
esc_Ën
 = 0;

1857 ià(
cs
 =ð
ISO2022JP_CS_ASCII
)

1859 
esc_Ën
 = 
›sc
[
ISO2022JP_CS_ASCII
].esc_len;

1860 
	`memmove
(
tmp
 + 
esc_Ën
,mp, 
Ën
);

1861 
	`memýy
(
tmp
, 
›sc
[
ISO2022JP_CS_ASCII
].
esc
, 
esc_Ën
);

1863 ià(
	`ISO2022_MODE_SHIFT
(
cv
->
mode
è=ð
ISO2022_SO
)

1866 
	`memmove
(
tmp
 + 1,mp, 
Ën
 + 
esc_Ën
);

1867 
	`memýy
(
tmp
, 
iso2022_SI_£q
, 1);

1868 
esc_Ën
 += 1;

1872 ià(
bufsize
 < 
Ën
 + 
esc_Ën
)

1873  
	`£‹¼Ü
(
E2BIG
);

1874 
	`memýy
(
buf
, 
tmp
, 
Ën
 + 
esc_Ën
);

1875 
cv
->
mode
 = 
	`ISO2022_MODE
(
cs
, 
shiá
);

1876  
Ën
 + 
esc_Ën
;

1877 
	}
}

1880 
	$iso2022jp_æush
(
cscÚv_t
 *
cv
, 
uch¬
 *
buf
, 
bufsize
)

1882 
iso2022_esc_t
 *
›sc
 = 
iso2022jp_esc
;

1883 
esc_Ën
;

1885 ià(
cv
->
mode
 !ð
	`ISO2022_MODE
(
ISO2022JP_CS_ASCII
, 
ISO2022_SI
))

1887 
esc_Ën
 = 0;

1888 ià(
	`ISO2022_MODE_SHIFT
(
cv
->
mode
è!ð
ISO2022_SI
)

1889 
esc_Ën
 += 1;

1890 ià(
	`ISO2022_MODE_CS
(
cv
->
mode
è!ð
ISO2022JP_CS_ASCII
)

1891 
esc_Ën
 +ð
›sc
[
ISO2022JP_CS_ASCII
].esc_len;

1892 ià(
bufsize
 < 
esc_Ën
)

1893  
	`£‹¼Ü
(
E2BIG
);

1895 
esc_Ën
 = 0;

1896 ià(
	`ISO2022_MODE_SHIFT
(
cv
->
mode
è!ð
ISO2022_SI
)

1898 
	`memýy
(
buf
, 
iso2022_SI_£q
, 1);

1899 
esc_Ën
 += 1;

1901 ià(
	`ISO2022_MODE_CS
(
cv
->
mode
è!ð
ISO2022JP_CS_ASCII
)

1903 
	`memýy
(
buf
 + 
esc_Ën
, 
›sc
[
ISO2022JP_CS_ASCII
].
esc
,

1904 
›sc
[
ISO2022JP_CS_ASCII
].
esc_Ën
);

1905 
esc_Ën
 +ð
›sc
[
ISO2022JP_CS_ASCII
].esc_len;

1907  
esc_Ën
;

1910 
	}
}

1912 #ià
defšed
(
MAKE_DLL
è&& defšed(
USE_LIBICONV_DLL
)

1913 
BOOL
 
WINAPI


1914 
	$DÎMaš
(
HINSTANCE
 
hš¡DLL
, 
DWORD
 
fdwR—sÚ
, 
LPVOID
 
ÍRe£rved
)

1916  
fdwR—sÚ
 )

1918 
DLL_PROCESS_ATTACH
:

1919 
hwšicÚv
 = (
HMODULE
)
hš¡DLL
;

1921 
DLL_THREAD_ATTACH
:

1922 
DLL_THREAD_DETACH
:

1923 
DLL_PROCESS_DETACH
:

1926  
TRUE
;

1927 
	}
}

1930 #ià
defšed
(
MAKE_EXE
)

1931 
	~<¡dio.h
>

1932 
	~<fúŽ.h
>

1933 
	~<io.h
>

1935 
	$maš
(
¬gc
, **
¬gv
)

1937 *
äomcode
 = 
NULL
;

1938 *
tocode
 = 
NULL
;

1939 
i
;

1940 
šbuf
[
BUFSIZ
];

1941 
outbuf
[
BUFSIZ
];

1942 *
pš
;

1943 *
pout
;

1944 
size_t
 
šby‹¦eá
;

1945 
size_t
 
outby‹¦eá
;

1946 
size_t
 
»¡
 = 0;

1947 
icÚv_t
 
cd
;

1948 
size_t
 
r
;

1949 
FILE
 *
š
 = 
¡dš
;

1950 
FILE
 *
out
 = 
¡dout
;

1951 
ignÜe
 = 0;

1952 *
p
;

1954 
	`_£tmode
(
	`_fž’o
(
¡dš
), 
_O_BINARY
);

1955 
	`_£tmode
(
	`_fž’o
(
¡dout
), 
_O_BINARY
);

1957 
i
 = 1; i < 
¬gc
; ++i)

1959 ià(
	`¡rcmp
(
¬gv
[
i
], "-l") == 0)

1961 
i
 = 0; 
cod•age_®Ÿs
[i].
Çme
 !ð
NULL
; ++i)

1962 
	`´štf
("%s\n", 
cod•age_®Ÿs
[
i
].
Çme
);

1966 ià(
	`¡rcmp
(
¬gv
[
i
], "-f") == 0)

1967 
äomcode
 = 
¬gv
[++
i
];

1968 ià(
	`¡rcmp
(
¬gv
[
i
], "-t") == 0)

1969 
tocode
 = 
¬gv
[++
i
];

1970 ià(
	`¡rcmp
(
¬gv
[
i
], "-c") == 0)

1971 
ignÜe
 = 1;

1972 ià(
	`¡rcmp
(
¬gv
[
i
], "--output") == 0)

1974 
out
 = 
	`fÝ’
(
¬gv
[++
i
], "wb");

1975 if(
out
 =ð
NULL
)

1977 
	`årštf
(
¡d”r
, "ÿÂÙ o³À%s\n", 
¬gv
[
i
]);

1983 
š
 = 
	`fÝ’
(
¬gv
[
i
], "rb");

1984 ià(
š
 =ð
NULL
)

1986 
	`årštf
(
¡d”r
, "ÿÂÙ o³À%s\n", 
¬gv
[
i
]);

1993 ià(
äomcode
 =ð
NULL
 || 
tocode
 == NULL)

1995 
	`´štf
("u§ge: % [-c] -àäom-’ø-ˆto-’ø[fže]\n", 
¬gv
[0]);

1999 ià(
ignÜe
)

2001 
p
 = 
tocode
;

2002 
tocode
 = (*)
	`m®loc
(
	`¡¾’
(
p
) + strlen("//IGNORE") + 1);

2003 ià(
tocode
 =ð
NULL
)

2005 
	`³¼Ü
("fatalƒrror");

2008 
	`¡rýy
(
tocode
, 
p
);

2009 
	`¡rÿt
(
tocode
, "//IGNORE");

2012 
cd
 = 
	`icÚv_Ý’
(
tocode
, 
äomcode
);

2013 ià(
cd
 =ð(
icÚv_t
)(-1))

2015 
	`³¼Ü
("iconv_openƒrror");

2019 (
šby‹¦eá
 = 
	`ä—d
(
šbuf
 + 
»¡
, 1, (šbufè-„e¡, 
š
)) != 0

2020 || 
»¡
 != 0)

2022 
šby‹¦eá
 +ð
»¡
;

2023 
pš
 = 
šbuf
;

2024 
pout
 = 
outbuf
;

2025 
outby‹¦eá
 = (
outbuf
);

2026 
r
 = 
	`icÚv
(
cd
, &
pš
, &
šby‹¦eá
, &
pout
, &
outby‹¦eá
);

2027 
	`fwr™e
(
outbuf
, 1, (outbufè- 
outby‹¦eá
, 
out
);

2028 ià(
r
 =ð(
size_t
)(-1è&& 
”ºo
 !ð
E2BIG
 && (”ºØ!ð
EINVAL
 || 
	`ãof
(
š
)))

2030 
	`³¼Ü
("conversionƒrror");

2033 
	`memmove
(
šbuf
, 
pš
, 
šby‹¦eá
);

2034 
»¡
 = 
šby‹¦eá
;

2036 
pout
 = 
outbuf
;

2037 
outby‹¦eá
 = (
outbuf
);

2038 
r
 = 
	`icÚv
(
cd
, 
NULL
, NULL, &
pout
, &
outby‹¦eá
);

2039 
	`fwr™e
(
outbuf
, 1, (outbufè- 
outby‹¦eá
, 
out
);

2040 ià(
r
 =ð(
size_t
)(-1))

2042 
	`³¼Ü
("conversionƒrror");

2046 
	`icÚv_þo£
(
cd
);

2049 
	}
}

	@zlib/adler32.c

8 
	~"zutž.h
"

10 
loÿl
 
uLÚg
 
adËr32_combše_
 
OF
((uLÚg 
adËr1
, uLÚg 
adËr2
, 
z_off64_t
 
Ën2
));

12 
	#BASE
 65521U

	)

13 
	#NMAX
 5552

	)

16 
	#DO1
(
buf
,
i
è{
adËr
 +ð(buf)[i]; 
sum2
 +ðadËr;}

	)

17 
	#DO2
(
buf
,
i
è
	`DO1
(buf,i); DO1(buf,i+1);

	)

18 
	#DO4
(
buf
,
i
è
	`DO2
(buf,i); DO2(buf,i+2);

	)

19 
	#DO8
(
buf
,
i
è
	`DO4
(buf,i); DO4(buf,i+4);

	)

20 
	#DO16
(
buf
è
	`DO8
(buf,0); DO8(buf,8);

	)

24 #ifdeà
NO_DIVIDE


27 
	#CHOP
(
a
) \

29 
tmp
 = 
a
 >> 16; \

30 
a
 &= 0xffffUL; \

31 
a
 +ð(
tmp
 << 4) -mp; \

32 } 0)

	)

33 
	#MOD28
(
a
) \

35 
	`CHOP
(
a
); \

36 ià(
a
 >ð
BASE
)‡ -= BASE; \

37 } 0)

	)

38 
	#MOD
(
a
) \

40 
	`CHOP
(
a
); \

41 
	`MOD28
(
a
); \

42 } 0)

	)

43 
	#MOD63
(
a
) \

45 
z_off64_t
 
tmp
 = 
a
 >> 32; \

46 
a
 &= 0xffffffffL; \

47 
a
 +ð(
tmp
 << 8) - (tmp << 5) +mp; \

48 
tmp
 = 
a
 >> 16; \

49 
a
 &= 0xffffL; \

50 
a
 +ð(
tmp
 << 4) -mp; \

51 
tmp
 = 
a
 >> 16; \

52 
a
 &= 0xffffL; \

53 
a
 +ð(
tmp
 << 4) -mp; \

54 ià(
a
 >ð
BASE
)‡ -= BASE; \

55 } 0)

	)

57 
	#MOD
(
a
è¨%ð
BASE


	)

58 
	#MOD28
(
a
è¨%ð
BASE


	)

59 
	#MOD63
(
a
è¨%ð
BASE


	)

63 
uLÚg
 
ZEXPORT
 
	$adËr32_z
(
adËr
, 
buf
, 
Ën
)

64 
uLÚg
 
adËr
;

65 cÚ¡ 
By‹f
 *
buf
;

66 
z_size_t
 
Ën
;

68 
sum2
;

69 
n
;

72 
sum2
 = (
adËr
 >> 16) & 0xffff;

73 
adËr
 &= 0xffff;

76 ià(
Ën
 == 1) {

77 
adËr
 +ð
buf
[0];

78 ià(
adËr
 >ð
BASE
)

79 
adËr
 -ð
BASE
;

80 
sum2
 +ð
adËr
;

81 ià(
sum2
 >ð
BASE
)

82 
sum2
 -ð
BASE
;

83  
adËr
 | (
sum2
 << 16);

87 ià(
buf
 =ð
Z_NULL
)

91 ià(
Ën
 < 16) {

92 
Ën
--) {

93 
adËr
 +ð*
buf
++;

94 
sum2
 +ð
adËr
;

96 ià(
adËr
 >ð
BASE
)

97 
adËr
 -ð
BASE
;

98 
	`MOD28
(
sum2
);

99  
adËr
 | (
sum2
 << 16);

103 
Ën
 >ð
NMAX
) {

104 
Ën
 -ð
NMAX
;

105 
n
 = 
NMAX
 / 16;

107 
	`DO16
(
buf
);

108 
buf
 += 16;

109 } --
n
);

110 
	`MOD
(
adËr
);

111 
	`MOD
(
sum2
);

115 ià(
Ën
) {

116 
Ën
 >= 16) {

117 
Ën
 -= 16;

118 
	`DO16
(
buf
);

119 
buf
 += 16;

121 
Ën
--) {

122 
adËr
 +ð*
buf
++;

123 
sum2
 +ð
adËr
;

125 
	`MOD
(
adËr
);

126 
	`MOD
(
sum2
);

130  
adËr
 | (
sum2
 << 16);

131 
	}
}

134 
uLÚg
 
ZEXPORT
 
	$adËr32
(
adËr
, 
buf
, 
Ën
)

135 
uLÚg
 
adËr
;

136 cÚ¡ 
By‹f
 *
buf
;

137 
uIÁ
 
Ën
;

139  
	`adËr32_z
(
adËr
, 
buf
, 
Ën
);

140 
	}
}

143 
loÿl
 
uLÚg
 
	$adËr32_combše_
(
adËr1
, 
adËr2
, 
Ën2
)

144 
uLÚg
 
adËr1
;

145 
uLÚg
 
adËr2
;

146 
z_off64_t
 
Ën2
;

148 
sum1
;

149 
sum2
;

150 
»m
;

153 ià(
Ën2
 < 0)

157 
	`MOD63
(
Ën2
);

158 
»m
 = ()
Ën2
;

159 
sum1
 = 
adËr1
 & 0xffff;

160 
sum2
 = 
»m
 * 
sum1
;

161 
	`MOD
(
sum2
);

162 
sum1
 +ð(
adËr2
 & 0xffffè+ 
BASE
 - 1;

163 
sum2
 +ð((
adËr1
 >> 16è& 0xffffè+ ((
adËr2
 >> 16è& 0xffffè+ 
BASE
 - 
»m
;

164 ià(
sum1
 >ð
BASE
) sum1 -= BASE;

165 ià(
sum1
 >ð
BASE
) sum1 -= BASE;

166 ià(
sum2
 >ð(()
BASE
 << 1)) sum2 -= (()BASE << 1);

167 ià(
sum2
 >ð
BASE
) sum2 -= BASE;

168  
sum1
 | (
sum2
 << 16);

169 
	}
}

172 
uLÚg
 
ZEXPORT
 
	$adËr32_combše
(
adËr1
, 
adËr2
, 
Ën2
)

173 
uLÚg
 
adËr1
;

174 
uLÚg
 
adËr2
;

175 
z_off_t
 
Ën2
;

177  
	`adËr32_combše_
(
adËr1
, 
adËr2
, 
Ën2
);

178 
	}
}

180 
uLÚg
 
ZEXPORT
 
	$adËr32_combše64
(
adËr1
, 
adËr2
, 
Ën2
)

181 
uLÚg
 
adËr1
;

182 
uLÚg
 
adËr2
;

183 
z_off64_t
 
Ën2
;

185  
	`adËr32_combše_
(
adËr1
, 
adËr2
, 
Ën2
);

186 
	}
}

	@zlib/compress.c

8 
	#ZLIB_INTERNAL


	)

9 
	~"zlib.h
"

22 
ZEXPORT
 
	$com´ess2
 (
de¡
, 
de¡L’
, 
sourû
, 
sourûL’
, 
Ëv–
)

23 
By‹f
 *
de¡
;

24 
uLÚgf
 *
de¡L’
;

25 cÚ¡ 
By‹f
 *
sourû
;

26 
uLÚg
 
sourûL’
;

27 
Ëv–
;

29 
z_¡»am
 
¡»am
;

30 
”r
;

31 cÚ¡ 
uIÁ
 
max
 = (uInt)-1;

32 
uLÚg
 
Ëá
;

34 
Ëá
 = *
de¡L’
;

35 *
de¡L’
 = 0;

37 
¡»am
.
z®loc
 = (
®loc_func
)0;

38 
¡»am
.
zä“
 = (
ä“_func
)0;

39 
¡»am
.
Ýaque
 = (
voidpf
)0;

41 
”r
 = 
	`deæ©eIn™
(&
¡»am
, 
Ëv–
);

42 ià(
”r
 !ð
Z_OK
) ƒrr;

44 
¡»am
.
Ãxt_out
 = 
de¡
;

45 
¡»am
.
avaž_out
 = 0;

46 
¡»am
.
Ãxt_š
 = (
z_cÚ¡
 
By‹f
 *)
sourû
;

47 
¡»am
.
avaž_š
 = 0;

50 ià(
¡»am
.
avaž_out
 == 0) {

51 
¡»am
.
avaž_out
 = 
Ëá
 > (
uLÚg
)
max
 ? max : (
uIÁ
)left;

52 
Ëá
 -ð
¡»am
.
avaž_out
;

54 ià(
¡»am
.
avaž_š
 == 0) {

55 
¡»am
.
avaž_š
 = 
sourûL’
 > (
uLÚg
)
max
 ? max : (
uIÁ
)sourceLen;

56 
sourûL’
 -ð
¡»am
.
avaž_š
;

58 
”r
 = 
	`deæ©e
(&
¡»am
, 
sourûL’
 ? 
Z_NO_FLUSH
 : 
Z_FINISH
);

59 } 
”r
 =ð
Z_OK
);

61 *
de¡L’
 = 
¡»am
.
tÙ®_out
;

62 
	`deæ©eEnd
(&
¡»am
);

63  
”r
 =ð
Z_STREAM_END
 ? 
Z_OK
 :ƒrr;

64 
	}
}

68 
ZEXPORT
 
	$com´ess
 (
de¡
, 
de¡L’
, 
sourû
, 
sourûL’
)

69 
By‹f
 *
de¡
;

70 
uLÚgf
 *
de¡L’
;

71 cÚ¡ 
By‹f
 *
sourû
;

72 
uLÚg
 
sourûL’
;

74  
	`com´ess2
(
de¡
, 
de¡L’
, 
sourû
, 
sourûL’
, 
Z_DEFAULT_COMPRESSION
);

75 
	}
}

81 
uLÚg
 
ZEXPORT
 
	$com´essBound
 (
sourûL’
)

82 
uLÚg
 
sourûL’
;

84  
sourûL’
 + (sourceLen >> 12) + (sourceLen >> 14) +

85 (
sourûL’
 >> 25) + 13;

86 
	}
}

	@zlib/crc32.c

24 #ifdeà
MAKECRCH


25 
	~<¡dio.h
>

26 #iâdeà
DYNAMIC_CRC_TABLE


27 
	#DYNAMIC_CRC_TABLE


	)

31 
	~"zutž.h
"

34 #ià!
defšed
(
NOBYFOUR
è&& defšed(
Z_U4
)

35 
	#BYFOUR


	)

37 #ifdeà
BYFOUR


38 
loÿl
 
üc32_l™Že
 
OF
((,

39 cÚ¡ 
FAR
 *, 
z_size_t
));

40 
loÿl
 
üc32_big
 
OF
((,

41 cÚ¡ 
FAR
 *, 
z_size_t
));

42 
	#TBLS
 8

	)

44 
	#TBLS
 1

	)

48 
loÿl
 
gf2_m©rix_times
 
OF
((*
m©
,

49 
vec
));

50 
loÿl
 
gf2_m©rix_squ¬e
 
OF
((*
squ¬e
, *
m©
));

51 
loÿl
 
uLÚg
 
üc32_combše_
 
OF
((uLÚg 
üc1
, uLÚg 
üc2
, 
z_off64_t
 
Ën2
));

54 #ifdeà
DYNAMIC_CRC_TABLE


56 
loÿl
 vÞ©ž
	güc_bË_em±y
 = 1;

57 
loÿl
 
z_üc_t
 
FAR
 
	güc_bË
[
TBLS
][256];

58 
loÿl
 
make_üc_bË
 
OF
(());

59 #ifdeà
MAKECRCH


60 
loÿl
 
wr™e_bË
 
OF
((
FILE
 *, cÚ¡ 
z_üc_t
 
FAR
 *));

88 
loÿl
 
	$make_üc_bË
()

90 
z_üc_t
 
c
;

91 
n
, 
k
;

92 
z_üc_t
 
pÞy
;

94 vÞ©ž
fœ¡
 = 1;

95 cÚ¡ 
p
[] = {0,1,2,4,5,7,8,10,11,12,16,22,23,26};

100 ià(
fœ¡
) {

101 
fœ¡
 = 0;

104 
pÞy
 = 0;

105 
n
 = 0;‚ < ()((
p
)/());‚++)

106 
pÞy
 |ð(
z_üc_t
)1 << (31 - 
p
[
n
]);

109 
n
 = 0;‚ < 256;‚++) {

110 
c
 = (
z_üc_t
)
n
;

111 
k
 = 0; k < 8; k++)

112 
c
 = c & 1 ? 
pÞy
 ^ (c >> 1) : c >> 1;

113 
üc_bË
[0][
n
] = 
c
;

116 #ifdeà
BYFOUR


119 
n
 = 0;‚ < 256;‚++) {

120 
c
 = 
üc_bË
[0][
n
];

121 
üc_bË
[4][
n
] = 
	`ZSWAP32
(
c
);

122 
k
 = 1; k < 4; k++) {

123 
c
 = 
üc_bË
[0][c & 0xff] ^ (c >> 8);

124 
üc_bË
[
k
][
n
] = 
c
;

125 
üc_bË
[
k
 + 4][
n
] = 
	`ZSWAP32
(
c
);

130 
üc_bË_em±y
 = 0;

134 
üc_bË_em±y
)

138 #ifdeà
MAKECRCH


141 
FILE
 *
out
;

143 
out
 = 
	`fÝ’
("crc32.h", "w");

144 ià(
out
 =ð
NULL
) ;

145 
	`årštf
(
out
, "/* crc32.h --ables for„apid CRC calculation\n");

146 
	`årštf
(
out
, " * Generated‡utomatically by crc32.c\n */\n\n");

147 
	`årštf
(
out
, "local const z_crc_t FAR ");

148 
	`årštf
(
out
, "crc_table[TBLS][256] =\n{\n {\n");

149 
	`wr™e_bË
(
out
, 
üc_bË
[0]);

150 #ifdeà
BYFOUR


151 
	`årštf
(
out
, "#ifdef BYFOUR\n");

152 
k
 = 1; k < 8; k++) {

153 
	`årštf
(
out
, " },\n {\n");

154 
	`wr™e_bË
(
out
, 
üc_bË
[
k
]);

156 
	`årštf
(
out
, "#endif\n");

158 
	`årštf
(
out
, " }\n};\n");

159 
	`fþo£
(
out
);

162 
	}
}

164 #ifdeà
MAKECRCH


165 
loÿl
 
	$wr™e_bË
(
out
, 
bË
)

166 
FILE
 *
out
;

167 cÚ¡ 
z_üc_t
 
FAR
 *
bË
;

169 
n
;

171 
n
 = 0;‚ < 256;‚++)

172 
	`årštf
(
out
, "%s0x%08lxUL%s", 
n
 % 5 ? "" : " ",

173 ()(
bË
[
n
]),

174 
n
 == 255 ? "\n" : (n % 5 == 4 ? ",\n" : ", "));

175 
	}
}

182 
	~"üc32.h
"

188 cÚ¡ 
z_üc_t
 
FAR
 * 
ZEXPORT
 
	$g‘_üc_bË
()

190 #ifdeà
DYNAMIC_CRC_TABLE


191 ià(
üc_bË_em±y
)

192 
	`make_üc_bË
();

194  (cÚ¡ 
z_üc_t
 
FAR
 *)
üc_bË
;

195 
	}
}

198 
	#DO1
 
üc
 = 
üc_bË
[0][(()üø^ (*
buf
++)è& 0xff] ^ (üø>> 8)

	)

199 
	#DO8
 
DO1
; DO1; DO1; DO1; DO1; DO1; DO1; 
	)
DO1

202 
ZEXPORT
 
	$üc32_z
(
üc
, 
buf
, 
Ën
)

203 
üc
;

204 cÚ¡ 
FAR
 *
buf
;

205 
z_size_t
 
Ën
;

207 ià(
buf
 =ð
Z_NULL
)  0UL;

209 #ifdeà
DYNAMIC_CRC_TABLE


210 ià(
üc_bË_em±y
)

211 
	`make_üc_bË
();

214 #ifdeà
BYFOUR


215 ià((*è=ð(
±rdiff_t
)) {

216 
z_üc_t
 
’dŸn
;

218 
’dŸn
 = 1;

219 ià(*((*)(&
’dŸn
)))

220  
	`üc32_l™Že
(
üc
, 
buf
, 
Ën
);

222  
	`üc32_big
(
üc
, 
buf
, 
Ën
);

225 
üc
 = crc ^ 0xffffffffUL;

226 
Ën
 >= 8) {

227 
DO8
;

228 
Ën
 -= 8;

230 ià(
Ën
) do {

231 
DO1
;

232 } --
Ën
);

233  
üc
 ^ 0xffffffffUL;

234 
	}
}

237 
ZEXPORT
 
	$üc32
(
üc
, 
buf
, 
Ën
)

238 
üc
;

239 cÚ¡ 
FAR
 *
buf
;

240 
uIÁ
 
Ën
;

242  
	`üc32_z
(
üc
, 
buf
, 
Ën
);

243 
	}
}

245 #ifdeà
BYFOUR


260 
	#DOLIT4
 
c
 ^ð*
buf4
++; \

261 
c
 = 
üc_bË
[3][c & 0xff] ^ crc_table[2][(c >> 8) & 0xff] ^ \

262 
üc_bË
[1][(
c
 >> 16è& 0xff] ^ crc_bË[0][ø>> 24]

	)

263 
	#DOLIT32
 
DOLIT4
; DOLIT4; DOLIT4; DOLIT4; DOLIT4; DOLIT4; DOLIT4; 
	)
DOLIT4

266 
loÿl
 
	$üc32_l™Že
(
üc
, 
buf
, 
Ën
)

267 
üc
;

268 cÚ¡ 
FAR
 *
buf
;

269 
z_size_t
 
Ën
;

271 
z_üc_t
 
c
;

272 cÚ¡ 
z_üc_t
 
FAR
 *
buf4
;

274 
c
 = (
z_üc_t
)
üc
;

275 
c
 = ~c;

276 
Ën
 && ((
±rdiff_t
)
buf
 & 3)) {

277 
c
 = 
üc_bË
[0][(ø^ *
buf
++) & 0xff] ^ (c >> 8);

278 
Ën
--;

281 
buf4
 = (cÚ¡ 
z_üc_t
 
FAR
 *)(cÚ¡ FAR *)
buf
;

282 
Ën
 >= 32) {

283 
DOLIT32
;

284 
Ën
 -= 32;

286 
Ën
 >= 4) {

287 
DOLIT4
;

288 
Ën
 -= 4;

290 
buf
 = (cÚ¡ 
FAR
 *)
buf4
;

292 ià(
Ën
) do {

293 
c
 = 
üc_bË
[0][(ø^ *
buf
++) & 0xff] ^ (c >> 8);

294 } --
Ën
);

295 
c
 = ~c;

296  ()
c
;

297 
	}
}

300 
	#DOBIG4
 
c
 ^ð*
buf4
++; \

301 
c
 = 
üc_bË
[4][c & 0xff] ^ crc_table[5][(c >> 8) & 0xff] ^ \

302 
üc_bË
[6][(
c
 >> 16è& 0xff] ^ crc_bË[7][ø>> 24]

	)

303 
	#DOBIG32
 
DOBIG4
; DOBIG4; DOBIG4; DOBIG4; DOBIG4; DOBIG4; DOBIG4; 
	)
DOBIG4

306 
loÿl
 
	$üc32_big
(
üc
, 
buf
, 
Ën
)

307 
üc
;

308 cÚ¡ 
FAR
 *
buf
;

309 
z_size_t
 
Ën
;

311 
z_üc_t
 
c
;

312 cÚ¡ 
z_üc_t
 
FAR
 *
buf4
;

314 
c
 = 
	`ZSWAP32
((
z_üc_t
)
üc
);

315 
c
 = ~c;

316 
Ën
 && ((
±rdiff_t
)
buf
 & 3)) {

317 
c
 = 
üc_bË
[4][(ø>> 24è^ *
buf
++] ^ (c << 8);

318 
Ën
--;

321 
buf4
 = (cÚ¡ 
z_üc_t
 
FAR
 *)(cÚ¡ FAR *)
buf
;

322 
Ën
 >= 32) {

323 
DOBIG32
;

324 
Ën
 -= 32;

326 
Ën
 >= 4) {

327 
DOBIG4
;

328 
Ën
 -= 4;

330 
buf
 = (cÚ¡ 
FAR
 *)
buf4
;

332 ià(
Ën
) do {

333 
c
 = 
üc_bË
[4][(ø>> 24è^ *
buf
++] ^ (c << 8);

334 } --
Ën
);

335 
c
 = ~c;

336  ()(
	`ZSWAP32
(
c
));

337 
	}
}

341 
	#GF2_DIM
 32

	)

344 
loÿl
 
	$gf2_m©rix_times
(
m©
, 
vec
)

345 *
m©
;

346 
vec
;

348 
sum
;

350 
sum
 = 0;

351 
vec
) {

352 ià(
vec
 & 1)

353 
sum
 ^ð*
m©
;

354 
vec
 >>= 1;

355 
m©
++;

357  
sum
;

358 
	}
}

361 
loÿl
 
	$gf2_m©rix_squ¬e
(
squ¬e
, 
m©
)

362 *
squ¬e
;

363 *
m©
;

365 
n
;

367 
n
 = 0;‚ < 
GF2_DIM
;‚++)

368 
squ¬e
[
n
] = 
	`gf2_m©rix_times
(
m©
, mat[n]);

369 
	}
}

372 
loÿl
 
uLÚg
 
	$üc32_combše_
(
üc1
, 
üc2
, 
Ën2
)

373 
uLÚg
 
üc1
;

374 
uLÚg
 
üc2
;

375 
z_off64_t
 
Ën2
;

377 
n
;

378 
row
;

379 
ev’
[
GF2_DIM
];

380 
odd
[
GF2_DIM
];

383 ià(
Ën2
 <= 0)

384  
üc1
;

387 
odd
[0] = 0xedb88320UL;

388 
row
 = 1;

389 
n
 = 1;‚ < 
GF2_DIM
;‚++) {

390 
odd
[
n
] = 
row
;

391 
row
 <<= 1;

395 
	`gf2_m©rix_squ¬e
(
ev’
, 
odd
);

398 
	`gf2_m©rix_squ¬e
(
odd
, 
ev’
);

404 
	`gf2_m©rix_squ¬e
(
ev’
, 
odd
);

405 ià(
Ën2
 & 1)

406 
üc1
 = 
	`gf2_m©rix_times
(
ev’
, crc1);

407 
Ën2
 >>= 1;

410 ià(
Ën2
 == 0)

414 
	`gf2_m©rix_squ¬e
(
odd
, 
ev’
);

415 ià(
Ën2
 & 1)

416 
üc1
 = 
	`gf2_m©rix_times
(
odd
, crc1);

417 
Ën2
 >>= 1;

420 } 
Ën2
 != 0);

423 
üc1
 ^ð
üc2
;

424  
üc1
;

425 
	}
}

428 
uLÚg
 
ZEXPORT
 
	$üc32_combše
(
üc1
, 
üc2
, 
Ën2
)

429 
uLÚg
 
üc1
;

430 
uLÚg
 
üc2
;

431 
z_off_t
 
Ën2
;

433  
	`üc32_combše_
(
üc1
, 
üc2
, 
Ën2
);

434 
	}
}

436 
uLÚg
 
ZEXPORT
 
	$üc32_combše64
(
üc1
, 
üc2
, 
Ën2
)

437 
uLÚg
 
üc1
;

438 
uLÚg
 
üc2
;

439 
z_off64_t
 
Ën2
;

441  
	`üc32_combše_
(
üc1
, 
üc2
, 
Ën2
);

442 
	}
}

	@zlib/crc32.h

5 
loÿl
 cÚ¡ 
z_üc_t
 
FAR
 
	güc_bË
[
TBLS
][256] =

60 #ifdeà
BYFOUR


	@zlib/deflate.c

52 
	~"deæ©e.h
"

54 cÚ¡ 
	gdeæ©e_cÝyright
[] =

67 
	mÃed_mÜe
,

68 
	mblock_dÚe
,

69 
	mfšish_¡¬‹d
,

70 
	mfšish_dÚe


71 } 
	tblock_¡©e
;

73 
	$block_¡©e
 (*
	tcom´ess_func
è
	tOF
((
	tdeæ©e_¡©e
 *
	ts
, 
	tæush
));

76 
loÿl
 
deæ©eS‹Check
 
	`OF
((
z_¡»amp
 
¡rm
));

77 
loÿl
 
¦ide_hash
 
	`OF
((
deæ©e_¡©e
 *
s
));

78 
loÿl
 
fžl_wšdow
 
	`OF
((
deæ©e_¡©e
 *
s
));

79 
loÿl
 
block_¡©e
 
deæ©e_¡Üed
 
	`OF
((
deæ©e_¡©e
 *
s
, 
æush
));

80 
loÿl
 
block_¡©e
 
deæ©e_ç¡
 
	`OF
((
deæ©e_¡©e
 *
s
, 
æush
));

81 #iâdeà
FASTEST


82 
loÿl
 
block_¡©e
 
deæ©e_¦ow
 
	`OF
((
deæ©e_¡©e
 *
s
, 
æush
));

84 
loÿl
 
block_¡©e
 
deæ©e_¾e
 
	`OF
((
deæ©e_¡©e
 *
s
, 
æush
));

85 
loÿl
 
block_¡©e
 
deæ©e_huff
 
	`OF
((
deæ©e_¡©e
 *
s
, 
æush
));

86 
loÿl
 
lm_š™
 
	`OF
((
deæ©e_¡©e
 *
s
));

87 
loÿl
 
putShÜtMSB
 
	`OF
((
deæ©e_¡©e
 *
s
, 
uIÁ
 
b
));

88 
loÿl
 
æush_³ndšg
 
	`OF
((
z_¡»amp
 
¡rm
));

89 
loÿl
 
»ad_buf
 
	`OF
((
z_¡»amp
 
¡rm
, 
By‹f
 *
buf
, 
size
));

90 #ifdeà
ASMV


91 #´agm¨
	`mes§ge
("Assembler code may have bugs -- use‡t your own„isk")

92 
m©ch_š™
 
	`OF
(());

93 
uIÁ
 
lÚge¡_m©ch
 
	`OF
((
deæ©e_¡©e
 *
s
, 
IPos
 
cur_m©ch
));

95 
loÿl
 
uIÁ
 
lÚge¡_m©ch
 
	`OF
((
deæ©e_¡©e
 *
s
, 
IPos
 
cur_m©ch
));

98 #ifdeà
ZLIB_DEBUG


99 
loÿl
 
check_m©ch
 
	`OF
((
deæ©e_¡©e
 *
s
, 
IPos
 
¡¬t
, IPo 
m©ch
,

100 
Ëngth
));

107 
	#NIL
 0

	)

110 #iâdeà
TOO_FAR


111 
	#TOO_FAR
 4096

	)

120 
	scÚfig_s
 {

121 
ush
 
good_Ëngth
;

122 
ush
 
max_Ïzy
;

123 
ush
 
niû_Ëngth
;

124 
ush
 
max_chaš
;

125 
com´ess_func
 
func
;

126 } 
	tcÚfig
;

128 #ifdeà
FASTEST


129 
loÿl
 cÚ¡ 
cÚfig
 
cÚfigu¿tiÚ_bË
[2] = {

131  {0, 0, 0, 0, 
deæ©e_¡Üed
},

132  {4, 4, 8, 4, 
deæ©e_ç¡
}
	}
};

134 
loÿl
 cÚ¡ 
cÚfig
 
	gcÚfigu¿tiÚ_bË
[10] = {

136  {0, 0, 0, 0, 
deæ©e_¡Üed
},

137  {4, 4, 8, 4, 
deæ©e_ç¡
},

138  {4, 5, 16, 8, 
deæ©e_ç¡
},

139  {4, 6, 32, 32, 
deæ©e_ç¡
},

141  {4, 4, 16, 16, 
deæ©e_¦ow
},

142  {8, 16, 32, 32, 
deæ©e_¦ow
},

143  {8, 16, 128, 128, 
deæ©e_¦ow
},

144  {8, 32, 128, 256, 
deæ©e_¦ow
},

145  {32, 128, 258, 1024, 
deæ©e_¦ow
},

146  {32, 258, 258, 4096, 
deæ©e_¦ow
}};

155 
	#RANK
(
f
è(((fè* 2è- ((fè> 4 ? 9 : 0))

	)

163 
	#UPDATE_HASH
(
s
,
h
,
c
è(h = (((h)<<s->
hash_shiá
è^ (c)è& s->
hash_mask
)

	)

176 #ifdeà
FASTEST


177 
	#INSERT_STRING
(
s
, 
¡r
, 
m©ch_h—d
) \

178 (
	`UPDATE_HASH
(
s
, s->
šs_h
, s->
wšdow
[(
¡r
è+ (
MIN_MATCH
-1)]), \

179 
m©ch_h—d
 = 
s
->
h—d
[s->
šs_h
], \

180 
s
->
h—d
[s->
šs_h
] = (
Pos
)(
¡r
))

	)

182 
	#INSERT_STRING
(
s
, 
¡r
, 
m©ch_h—d
) \

183 (
	`UPDATE_HASH
(
s
, s->
šs_h
, s->
wšdow
[(
¡r
è+ (
MIN_MATCH
-1)]), \

184 
m©ch_h—d
 = 
s
->
´ev
[(
¡r
è& s->
w_mask
] = s->
h—d
[s->
šs_h
], \

185 
s
->
h—d
[s->
šs_h
] = (
Pos
)(
¡r
))

	)

192 
	#CLEAR_HASH
(
s
) \

193 
s
->
h—d
[s->
hash_size
-1] = 
NIL
; \

194 
	`zmemz”o
((
By‹f
 *)
s
->
h—d
, ()(s->
hash_size
-1)*(*s->h—d));

	)

201 
loÿl
 
	$¦ide_hash
(
s
)

202 
deæ©e_¡©e
 *
s
;

204 
n
, 
m
;

205 
Posf
 *
p
;

206 
uIÁ
 
wsize
 = 
s
->
w_size
;

208 
n
 = 
s
->
hash_size
;

209 
p
 = &
s
->
h—d
[
n
];

211 
m
 = *--
p
;

212 *
p
 = (
Pos
)(
m
 >ð
wsize
 ? m - wsiz: 
NIL
);

213 } --
n
);

214 
n
 = 
wsize
;

215 #iâdeà
FASTEST


216 
p
 = &
s
->
´ev
[
n
];

218 
m
 = *--
p
;

219 *
p
 = (
Pos
)(
m
 >ð
wsize
 ? m - wsiz: 
NIL
);

223 } --
n
);

225 
	}
}

228 
ZEXPORT
 
	$deæ©eIn™_
(
¡rm
, 
Ëv–
, 
v”siÚ
, 
¡»am_size
)

229 
z_¡»amp
 
¡rm
;

230 
Ëv–
;

231 cÚ¡ *
v”siÚ
;

232 
¡»am_size
;

234  
	`deæ©eIn™2_
(
¡rm
, 
Ëv–
, 
Z_DEFLATED
, 
MAX_WBITS
, 
DEF_MEM_LEVEL
,

235 
Z_DEFAULT_STRATEGY
, 
v”siÚ
, 
¡»am_size
);

237 
	}
}

240 
ZEXPORT
 
	$deæ©eIn™2_
(
¡rm
, 
Ëv–
, 
m‘hod
, 
wšdowB™s
, 
memLev–
, 
¡¿‹gy
,

241 
v”siÚ
, 
¡»am_size
)

242 
z_¡»amp
 
¡rm
;

243 
Ëv–
;

244 
m‘hod
;

245 
wšdowB™s
;

246 
memLev–
;

247 
¡¿‹gy
;

248 cÚ¡ *
v”siÚ
;

249 
¡»am_size
;

251 
deæ©e_¡©e
 *
s
;

252 
w¿p
 = 1;

253 cÚ¡ 
my_v”siÚ
[] = 
ZLIB_VERSION
;

255 
ushf
 *
ov”Ïy
;

260 ià(
v”siÚ
 =ð
Z_NULL
 || v”siÚ[0] !ð
my_v”siÚ
[0] ||

261 
¡»am_size
 !ð(
z_¡»am
)) {

262  
Z_VERSION_ERROR
;

264 ià(
¡rm
 =ð
Z_NULL
è 
Z_STREAM_ERROR
;

266 
¡rm
->
msg
 = 
Z_NULL
;

267 ià(
¡rm
->
z®loc
 =ð(
®loc_func
)0) {

268 #ifdeà
Z_SOLO


269  
Z_STREAM_ERROR
;

271 
¡rm
->
z®loc
 = 
zÿÎoc
;

272 
¡rm
->
Ýaque
 = (
voidpf
)0;

275 ià(
¡rm
->
zä“
 =ð(
ä“_func
)0)

276 #ifdeà
Z_SOLO


277  
Z_STREAM_ERROR
;

279 
¡rm
->
zä“
 = 
zcä“
;

282 #ifdeà
FASTEST


283 ià(
Ëv–
 != 0)†evel = 1;

285 ià(
Ëv–
 =ð
Z_DEFAULT_COMPRESSION
)†evel = 6;

288 ià(
wšdowB™s
 < 0) {

289 
w¿p
 = 0;

290 
wšdowB™s
 = -windowBits;

292 #ifdeà
GZIP


293 ià(
wšdowB™s
 > 15) {

294 
w¿p
 = 2;

295 
wšdowB™s
 -= 16;

298 ià(
memLev–
 < 1 || memLev– > 
MAX_MEM_LEVEL
 || 
m‘hod
 !ð
Z_DEFLATED
 ||

299 
wšdowB™s
 < 8 || wšdowB™ > 15 || 
Ëv–
 < 0 ||†evel > 9 ||

300 
¡¿‹gy
 < 0 || sŒ©egy > 
Z_FIXED
 || (
wšdowB™s
 =ð8 && 
w¿p
 != 1)) {

301  
Z_STREAM_ERROR
;

303 ià(
wšdowB™s
 == 8) windowBits = 9;

304 
s
 = (
deæ©e_¡©e
 *è
	`ZALLOC
(
¡rm
, 1, (deflate_state));

305 ià(
s
 =ð
Z_NULL
è 
Z_MEM_ERROR
;

306 
¡rm
->
¡©e
 = (
š‹º®_¡©e
 
FAR
 *)
s
;

307 
s
->
¡rm
 = strm;

308 
s
->
¡©us
 = 
INIT_STATE
;

310 
s
->
w¿p
 = wrap;

311 
s
->
gzh—d
 = 
Z_NULL
;

312 
s
->
w_b™s
 = (
uIÁ
)
wšdowB™s
;

313 
s
->
w_size
 = 1 << s->
w_b™s
;

314 
s
->
w_mask
 = s->
w_size
 - 1;

316 
s
->
hash_b™s
 = (
uIÁ
)
memLev–
 + 7;

317 
s
->
hash_size
 = 1 << s->
hash_b™s
;

318 
s
->
hash_mask
 = s->
hash_size
 - 1;

319 
s
->
hash_shiá
 = ((s->
hash_b™s
+
MIN_MATCH
-1)/MIN_MATCH);

321 
s
->
wšdow
 = (
By‹f
 *è
	`ZALLOC
(
¡rm
, s->
w_size
, 2*(
By‹
));

322 
s
->
´ev
 = (
Posf
 *è
	`ZALLOC
(
¡rm
, s->
w_size
, (
Pos
));

323 
s
->
h—d
 = (
Posf
 *è
	`ZALLOC
(
¡rm
, s->
hash_size
, (
Pos
));

325 
s
->
high_w©”
 = 0;

327 
s
->
l™_bufsize
 = 1 << (
memLev–
 + 6);

329 
ov”Ïy
 = (
ushf
 *è
	`ZALLOC
(
¡rm
, 
s
->
l™_bufsize
, (
ush
)+2);

330 
s
->
³ndšg_buf
 = (
uchf
 *è
ov”Ïy
;

331 
s
->
³ndšg_buf_size
 = (
ulg
)s->
l™_bufsize
 * ((
ush
)+2L);

333 ià(
s
->
wšdow
 =ð
Z_NULL
 || s->
´ev
 =ðZ_NULL || s->
h—d
 == Z_NULL ||

334 
s
->
³ndšg_buf
 =ð
Z_NULL
) {

335 
s
->
¡©us
 = 
FINISH_STATE
;

336 
¡rm
->
msg
 = 
	`ERR_MSG
(
Z_MEM_ERROR
);

337 
	`deæ©eEnd
 (
¡rm
);

338  
Z_MEM_ERROR
;

340 
s
->
d_buf
 = 
ov”Ïy
 + s->
l™_bufsize
/(
ush
);

341 
s
->
l_buf
 = s->
³ndšg_buf
 + (1+(
ush
))*s->
l™_bufsize
;

343 
s
->
Ëv–
 =†evel;

344 
s
->
¡¿‹gy
 = strategy;

345 
s
->
m‘hod
 = (
By‹
)method;

347  
	`deæ©eRe£t
(
¡rm
);

348 
	}
}

353 
loÿl
 
	$deæ©eS‹Check
 (
¡rm
)

354 
z_¡»amp
 
¡rm
;

356 
deæ©e_¡©e
 *
s
;

357 ià(
¡rm
 =ð
Z_NULL
 ||

358 
¡rm
->
z®loc
 =ð(
®loc_func
)0 || sŒm->
zä“
 =ð(
ä“_func
)0)

360 
s
 = 
¡rm
->
¡©e
;

361 ià(
s
 =ð
Z_NULL
 || s->
¡rm
 !ð¡rm || (s->
¡©us
 !ð
INIT_STATE
 &&

362 #ifdeà
GZIP


363 
s
->
¡©us
 !ð
GZIP_STATE
 &&

365 
s
->
¡©us
 !ð
EXTRA_STATE
 &&

366 
s
->
¡©us
 !ð
NAME_STATE
 &&

367 
s
->
¡©us
 !ð
COMMENT_STATE
 &&

368 
s
->
¡©us
 !ð
HCRC_STATE
 &&

369 
s
->
¡©us
 !ð
BUSY_STATE
 &&

370 
s
->
¡©us
 !ð
FINISH_STATE
))

373 
	}
}

376 
ZEXPORT
 
	$deæ©eS‘DiùiÚ¬y
 (
¡rm
, 
diùiÚ¬y
, 
diùL’gth
)

377 
z_¡»amp
 
¡rm
;

378 cÚ¡ 
By‹f
 *
diùiÚ¬y
;

379 
uIÁ
 
diùL’gth
;

381 
deæ©e_¡©e
 *
s
;

382 
uIÁ
 
¡r
, 
n
;

383 
w¿p
;

384 
avaž
;

385 
z_cÚ¡
 *
Ãxt
;

387 ià(
	`deæ©eS‹Check
(
¡rm
è|| 
diùiÚ¬y
 =ð
Z_NULL
)

388  
Z_STREAM_ERROR
;

389 
s
 = 
¡rm
->
¡©e
;

390 
w¿p
 = 
s
->wrap;

391 ià(
w¿p
 =ð2 || (w¿°=ð1 && 
s
->
¡©us
 !ð
INIT_STATE
è|| s->
lookah—d
)

392  
Z_STREAM_ERROR
;

395 ià(
w¿p
 == 1)

396 
¡rm
->
adËr
 = 
	`adËr32
(¡rm->adËr, 
diùiÚ¬y
, 
diùL’gth
);

397 
s
->
w¿p
 = 0;

400 ià(
diùL’gth
 >ð
s
->
w_size
) {

401 ià(
w¿p
 == 0) {

402 
	`CLEAR_HASH
(
s
);

403 
s
->
¡r¡¬t
 = 0;

404 
s
->
block_¡¬t
 = 0L;

405 
s
->
š£¹
 = 0;

407 
diùiÚ¬y
 +ð
diùL’gth
 - 
s
->
w_size
;

408 
diùL’gth
 = 
s
->
w_size
;

412 
avaž
 = 
¡rm
->
avaž_š
;

413 
Ãxt
 = 
¡rm
->
Ãxt_š
;

414 
¡rm
->
avaž_š
 = 
diùL’gth
;

415 
¡rm
->
Ãxt_š
 = (
z_cÚ¡
 
By‹f
 *)
diùiÚ¬y
;

416 
	`fžl_wšdow
(
s
);

417 
s
->
lookah—d
 >ð
MIN_MATCH
) {

418 
¡r
 = 
s
->
¡r¡¬t
;

419 
n
 = 
s
->
lookah—d
 - (
MIN_MATCH
-1);

421 
	`UPDATE_HASH
(
s
, s->
šs_h
, s->
wšdow
[
¡r
 + 
MIN_MATCH
-1]);

422 #iâdeà
FASTEST


423 
s
->
´ev
[
¡r
 & s->
w_mask
] = s->
h—d
[s->
šs_h
];

425 
s
->
h—d
[s->
šs_h
] = (
Pos
)
¡r
;

426 
¡r
++;

427 } --
n
);

428 
s
->
¡r¡¬t
 = 
¡r
;

429 
s
->
lookah—d
 = 
MIN_MATCH
-1;

430 
	`fžl_wšdow
(
s
);

432 
s
->
¡r¡¬t
 +ðs->
lookah—d
;

433 
s
->
block_¡¬t
 = ()s->
¡r¡¬t
;

434 
s
->
š£¹
 = s->
lookah—d
;

435 
s
->
lookah—d
 = 0;

436 
s
->
m©ch_Ëngth
 = s->
´ev_Ëngth
 = 
MIN_MATCH
-1;

437 
s
->
m©ch_avažabË
 = 0;

438 
¡rm
->
Ãxt_š
 = 
Ãxt
;

439 
¡rm
->
avaž_š
 = 
avaž
;

440 
s
->
w¿p
 = wrap;

441  
Z_OK
;

442 
	}
}

445 
ZEXPORT
 
	$deæ©eG‘DiùiÚ¬y
 (
¡rm
, 
diùiÚ¬y
, 
diùL’gth
)

446 
z_¡»amp
 
¡rm
;

447 
By‹f
 *
diùiÚ¬y
;

448 
uIÁ
 *
diùL’gth
;

450 
deæ©e_¡©e
 *
s
;

451 
uIÁ
 
Ën
;

453 ià(
	`deæ©eS‹Check
(
¡rm
))

454  
Z_STREAM_ERROR
;

455 
s
 = 
¡rm
->
¡©e
;

456 
Ën
 = 
s
->
¡r¡¬t
 + s->
lookah—d
;

457 ià(
Ën
 > 
s
->
w_size
)

458 
Ën
 = 
s
->
w_size
;

459 ià(
diùiÚ¬y
 !ð
Z_NULL
 && 
Ën
)

460 
	`zmemýy
(
diùiÚ¬y
, 
s
->
wšdow
 + s->
¡r¡¬t
 + s->
lookah—d
 - 
Ën
,†en);

461 ià(
diùL’gth
 !ð
Z_NULL
)

462 *
diùL’gth
 = 
Ën
;

463  
Z_OK
;

464 
	}
}

467 
ZEXPORT
 
	$deæ©eRe£tK“p
 (
¡rm
)

468 
z_¡»amp
 
¡rm
;

470 
deæ©e_¡©e
 *
s
;

472 ià(
	`deæ©eS‹Check
(
¡rm
)) {

473  
Z_STREAM_ERROR
;

476 
¡rm
->
tÙ®_š
 = sŒm->
tÙ®_out
 = 0;

477 
¡rm
->
msg
 = 
Z_NULL
;

478 
¡rm
->
d©a_ty³
 = 
Z_UNKNOWN
;

480 
s
 = (
deæ©e_¡©e
 *)
¡rm
->
¡©e
;

481 
s
->
³ndšg
 = 0;

482 
s
->
³ndšg_out
 = s->
³ndšg_buf
;

484 ià(
s
->
w¿p
 < 0) {

485 
s
->
w¿p
 = -s->wrap;

487 
s
->
¡©us
 =

488 #ifdeà
GZIP


489 
s
->
w¿p
 =ð2 ? 
GZIP_STATE
 :

491 
s
->
w¿p
 ? 
INIT_STATE
 : 
BUSY_STATE
;

492 
¡rm
->
adËr
 =

493 #ifdeà
GZIP


494 
s
->
w¿p
 =ð2 ? 
	`üc32
(0L, 
Z_NULL
, 0) :

496 
	`adËr32
(0L, 
Z_NULL
, 0);

497 
s
->
Ï¡_æush
 = 
Z_NO_FLUSH
;

499 
	`_Œ_š™
(
s
);

501  
Z_OK
;

502 
	}
}

505 
ZEXPORT
 
	$deæ©eRe£t
 (
¡rm
)

506 
z_¡»amp
 
¡rm
;

508 
»t
;

510 
»t
 = 
	`deæ©eRe£tK“p
(
¡rm
);

511 ià(
»t
 =ð
Z_OK
)

512 
	`lm_š™
(
¡rm
->
¡©e
);

513  
»t
;

514 
	}
}

517 
ZEXPORT
 
	$deæ©eS‘H—d”
 (
¡rm
, 
h—d
)

518 
z_¡»amp
 
¡rm
;

519 
gz_h—d”p
 
h—d
;

521 ià(
	`deæ©eS‹Check
(
¡rm
è|| sŒm->
¡©e
->
w¿p
 != 2)

522  
Z_STREAM_ERROR
;

523 
¡rm
->
¡©e
->
gzh—d
 = 
h—d
;

524  
Z_OK
;

525 
	}
}

528 
ZEXPORT
 
	$deæ©eP’dšg
 (
¡rm
, 
³ndšg
, 
b™s
)

529 *
³ndšg
;

530 *
b™s
;

531 
z_¡»amp
 
¡rm
;

533 ià(
	`deæ©eS‹Check
(
¡rm
)è 
Z_STREAM_ERROR
;

534 ià(
³ndšg
 !ð
Z_NULL
)

535 *
³ndšg
 = 
¡rm
->
¡©e
->pending;

536 ià(
b™s
 !ð
Z_NULL
)

537 *
b™s
 = 
¡rm
->
¡©e
->
bi_v®id
;

538  
Z_OK
;

539 
	}
}

542 
ZEXPORT
 
	$deæ©ePrime
 (
¡rm
, 
b™s
, 
v®ue
)

543 
z_¡»amp
 
¡rm
;

544 
b™s
;

545 
v®ue
;

547 
deæ©e_¡©e
 *
s
;

548 
put
;

550 ià(
	`deæ©eS‹Check
(
¡rm
)è 
Z_STREAM_ERROR
;

551 
s
 = 
¡rm
->
¡©e
;

552 ià((
By‹f
 *)(
s
->
d_buf
è< s->
³ndšg_out
 + ((
Buf_size
 + 7) >> 3))

553  
Z_BUF_ERROR
;

555 
put
 = 
Buf_size
 - 
s
->
bi_v®id
;

556 ià(
put
 > 
b™s
)

557 
put
 = 
b™s
;

558 
s
->
bi_buf
 |ð(
ush
)((
v®ue
 & ((1 << 
put
è- 1)è<< s->
bi_v®id
);

559 
s
->
bi_v®id
 +ð
put
;

560 
	`_Œ_æush_b™s
(
s
);

561 
v®ue
 >>ð
put
;

562 
b™s
 -ð
put
;

563 } 
b™s
);

564  
Z_OK
;

565 
	}
}

568 
ZEXPORT
 
	$deæ©eP¬ams
(
¡rm
, 
Ëv–
, 
¡¿‹gy
)

569 
z_¡»amp
 
¡rm
;

570 
Ëv–
;

571 
¡¿‹gy
;

573 
deæ©e_¡©e
 *
s
;

574 
com´ess_func
 
func
;

576 ià(
	`deæ©eS‹Check
(
¡rm
)è 
Z_STREAM_ERROR
;

577 
s
 = 
¡rm
->
¡©e
;

579 #ifdeà
FASTEST


580 ià(
Ëv–
 != 0)†evel = 1;

582 ià(
Ëv–
 =ð
Z_DEFAULT_COMPRESSION
)†evel = 6;

584 ià(
Ëv–
 < 0 ||†ev– > 9 || 
¡¿‹gy
 < 0 || sŒ©egy > 
Z_FIXED
) {

585  
Z_STREAM_ERROR
;

587 
func
 = 
cÚfigu¿tiÚ_bË
[
s
->
Ëv–
].func;

589 ià((
¡¿‹gy
 !ð
s
->¡¿‹gy || 
func
 !ð
cÚfigu¿tiÚ_bË
[
Ëv–
].func) &&

590 
s
->
high_w©”
) {

592 
”r
 = 
	`deæ©e
(
¡rm
, 
Z_BLOCK
);

593 ià(
”r
 =ð
Z_STREAM_ERROR
)

594  
”r
;

595 ià(
¡rm
->
avaž_out
 == 0)

596  
Z_BUF_ERROR
;

598 ià(
s
->
Ëv–
 !=†evel) {

599 ià(
s
->
Ëv–
 =ð0 && s->
m©ches
 != 0) {

600 ià(
s
->
m©ches
 == 1)

601 
	`¦ide_hash
(
s
);

603 
	`CLEAR_HASH
(
s
);

604 
s
->
m©ches
 = 0;

606 
s
->
Ëv–
 =†evel;

607 
s
->
max_Ïzy_m©ch
 = 
cÚfigu¿tiÚ_bË
[
Ëv–
].
max_Ïzy
;

608 
s
->
good_m©ch
 = 
cÚfigu¿tiÚ_bË
[
Ëv–
].
good_Ëngth
;

609 
s
->
niû_m©ch
 = 
cÚfigu¿tiÚ_bË
[
Ëv–
].
niû_Ëngth
;

610 
s
->
max_chaš_Ëngth
 = 
cÚfigu¿tiÚ_bË
[
Ëv–
].
max_chaš
;

612 
s
->
¡¿‹gy
 = strategy;

613  
Z_OK
;

614 
	}
}

617 
ZEXPORT
 
	$deæ©eTuÃ
(
¡rm
, 
good_Ëngth
, 
max_Ïzy
, 
niû_Ëngth
, 
max_chaš
)

618 
z_¡»amp
 
¡rm
;

619 
good_Ëngth
;

620 
max_Ïzy
;

621 
niû_Ëngth
;

622 
max_chaš
;

624 
deæ©e_¡©e
 *
s
;

626 ià(
	`deæ©eS‹Check
(
¡rm
)è 
Z_STREAM_ERROR
;

627 
s
 = 
¡rm
->
¡©e
;

628 
s
->
good_m©ch
 = (
uIÁ
)
good_Ëngth
;

629 
s
->
max_Ïzy_m©ch
 = (
uIÁ
)
max_Ïzy
;

630 
s
->
niû_m©ch
 = 
niû_Ëngth
;

631 
s
->
max_chaš_Ëngth
 = (
uIÁ
)
max_chaš
;

632  
Z_OK
;

633 
	}
}

652 
uLÚg
 
ZEXPORT
 
	$deæ©eBound
(
¡rm
, 
sourûL’
)

653 
z_¡»amp
 
¡rm
;

654 
uLÚg
 
sourûL’
;

656 
deæ©e_¡©e
 *
s
;

657 
uLÚg
 
com¶’
, 
w¿¶’
;

660 
com¶’
 = 
sourûL’
 +

661 ((
sourûL’
 + 7) >> 3) + ((sourceLen + 63) >> 6) + 5;

664 ià(
	`deæ©eS‹Check
(
¡rm
))

665  
com¶’
 + 6;

668 
s
 = 
¡rm
->
¡©e
;

669 
s
->
w¿p
) {

671 
w¿¶’
 = 0;

674 
w¿¶’
 = 6 + (
s
->
¡r¡¬t
 ? 4 : 0);

676 #ifdeà
GZIP


678 
w¿¶’
 = 18;

679 ià(
s
->
gzh—d
 !ð
Z_NULL
) {

680 
By‹f
 *
¡r
;

681 ià(
s
->
gzh—d
->
exŒa
 !ð
Z_NULL
)

682 
w¿¶’
 +ð2 + 
s
->
gzh—d
->
exŒa_Ën
;

683 
¡r
 = 
s
->
gzh—d
->
Çme
;

684 ià(
¡r
 !ð
Z_NULL
)

686 
w¿¶’
++;

687 } *
¡r
++);

688 
¡r
 = 
s
->
gzh—d
->
comm’t
;

689 ià(
¡r
 !ð
Z_NULL
)

691 
w¿¶’
++;

692 } *
¡r
++);

693 ià(
s
->
gzh—d
->
hüc
)

694 
w¿¶’
 += 2;

699 
w¿¶’
 = 6;

703 ià(
s
->
w_b™s
 !ð15 || s->
hash_b™s
 != 8 + 7)

704  
com¶’
 + 
w¿¶’
;

707  
sourûL’
 + (sourceLen >> 12) + (sourceLen >> 14) +

708 (
sourûL’
 >> 25è+ 13 - 6 + 
w¿¶’
;

709 
	}
}

716 
loÿl
 
	$putShÜtMSB
 (
s
, 
b
)

717 
deæ©e_¡©e
 *
s
;

718 
uIÁ
 
b
;

720 
	`put_by‹
(
s
, (
By‹
)(
b
 >> 8));

721 
	`put_by‹
(
s
, (
By‹
)(
b
 & 0xff));

722 
	}
}

730 
loÿl
 
	$æush_³ndšg
(
¡rm
)

731 
z_¡»amp
 
¡rm
;

733 
Ën
;

734 
deæ©e_¡©e
 *
s
 = 
¡rm
->
¡©e
;

736 
	`_Œ_æush_b™s
(
s
);

737 
Ën
 = 
s
->
³ndšg
;

738 ià(
Ën
 > 
¡rm
->
avaž_out
)†en = strm->avail_out;

739 ià(
Ën
 == 0) ;

741 
	`zmemýy
(
¡rm
->
Ãxt_out
, 
s
->
³ndšg_out
, 
Ën
);

742 
¡rm
->
Ãxt_out
 +ð
Ën
;

743 
s
->
³ndšg_out
 +ð
Ën
;

744 
¡rm
->
tÙ®_out
 +ð
Ën
;

745 
¡rm
->
avaž_out
 -ð
Ën
;

746 
s
->
³ndšg
 -ð
Ën
;

747 ià(
s
->
³ndšg
 == 0) {

748 
s
->
³ndšg_out
 = s->
³ndšg_buf
;

750 
	}
}

755 
	#HCRC_UPDATE
(
beg
) \

757 ià(
s
->
gzh—d
->
hüc
 && s->
³ndšg
 > (
beg
)) \

758 
¡rm
->
adËr
 = 
	`üc32
(¡rm->adËr, 
s
->
³ndšg_buf
 + (
beg
), \

759 
s
->
³ndšg
 - (
beg
)); \

760 } 0)

	)

763 
ZEXPORT
 
	$deæ©e
 (
¡rm
, 
æush
)

764 
z_¡»amp
 
¡rm
;

765 
æush
;

767 
Þd_æush
;

768 
deæ©e_¡©e
 *
s
;

770 ià(
	`deæ©eS‹Check
(
¡rm
è|| 
æush
 > 
Z_BLOCK
 || flush < 0) {

771  
Z_STREAM_ERROR
;

773 
s
 = 
¡rm
->
¡©e
;

775 ià(
¡rm
->
Ãxt_out
 =ð
Z_NULL
 ||

776 (
¡rm
->
avaž_š
 !ð0 && sŒm->
Ãxt_š
 =ð
Z_NULL
) ||

777 (
s
->
¡©us
 =ð
FINISH_STATE
 && 
æush
 !ð
Z_FINISH
)) {

778 
	`ERR_RETURN
(
¡rm
, 
Z_STREAM_ERROR
);

780 ià(
¡rm
->
avaž_out
 =ð0è
	`ERR_RETURN
(¡rm, 
Z_BUF_ERROR
);

782 
Þd_æush
 = 
s
->
Ï¡_æush
;

783 
s
->
Ï¡_æush
 = 
æush
;

786 ià(
s
->
³ndšg
 != 0) {

787 
	`æush_³ndšg
(
¡rm
);

788 ià(
¡rm
->
avaž_out
 == 0) {

795 
s
->
Ï¡_æush
 = -1;

796  
Z_OK
;

803 } ià(
¡rm
->
avaž_š
 =ð0 && 
	`RANK
(
æush
è<ðRANK(
Þd_æush
) &&

804 
æush
 !ð
Z_FINISH
) {

805 
	`ERR_RETURN
(
¡rm
, 
Z_BUF_ERROR
);

809 ià(
s
->
¡©us
 =ð
FINISH_STATE
 && 
¡rm
->
avaž_š
 != 0) {

810 
	`ERR_RETURN
(
¡rm
, 
Z_BUF_ERROR
);

814 ià(
s
->
¡©us
 =ð
INIT_STATE
) {

816 
uIÁ
 
h—d”
 = (
Z_DEFLATED
 + ((
s
->
w_b™s
-8)<<4)) << 8;

817 
uIÁ
 
Ëv–_æags
;

819 ià(
s
->
¡¿‹gy
 >ð
Z_HUFFMAN_ONLY
 || s->
Ëv–
 < 2)

820 
Ëv–_æags
 = 0;

821 ià(
s
->
Ëv–
 < 6)

822 
Ëv–_æags
 = 1;

823 ià(
s
->
Ëv–
 == 6)

824 
Ëv–_æags
 = 2;

826 
Ëv–_æags
 = 3;

827 
h—d”
 |ð(
Ëv–_æags
 << 6);

828 ià(
s
->
¡r¡¬t
 !ð0è
h—d”
 |ð
PRESET_DICT
;

829 
h—d”
 += 31 - (header % 31);

831 
	`putShÜtMSB
(
s
, 
h—d”
);

834 ià(
s
->
¡r¡¬t
 != 0) {

835 
	`putShÜtMSB
(
s
, (
uIÁ
)(
¡rm
->
adËr
 >> 16));

836 
	`putShÜtMSB
(
s
, (
uIÁ
)(
¡rm
->
adËr
 & 0xffff));

838 
¡rm
->
adËr
 = 
	`adËr32
(0L, 
Z_NULL
, 0);

839 
s
->
¡©us
 = 
BUSY_STATE
;

842 
	`æush_³ndšg
(
¡rm
);

843 ià(
s
->
³ndšg
 != 0) {

844 
s
->
Ï¡_æush
 = -1;

845  
Z_OK
;

848 #ifdeà
GZIP


849 ià(
s
->
¡©us
 =ð
GZIP_STATE
) {

851 
¡rm
->
adËr
 = 
	`üc32
(0L, 
Z_NULL
, 0);

852 
	`put_by‹
(
s
, 31);

853 
	`put_by‹
(
s
, 139);

854 
	`put_by‹
(
s
, 8);

855 ià(
s
->
gzh—d
 =ð
Z_NULL
) {

856 
	`put_by‹
(
s
, 0);

857 
	`put_by‹
(
s
, 0);

858 
	`put_by‹
(
s
, 0);

859 
	`put_by‹
(
s
, 0);

860 
	`put_by‹
(
s
, 0);

861 
	`put_by‹
(
s
, s->
Ëv–
 == 9 ? 2 :

862 (
s
->
¡¿‹gy
 >ð
Z_HUFFMAN_ONLY
 || s->
Ëv–
 < 2 ?

864 
	`put_by‹
(
s
, 
OS_CODE
);

865 
s
->
¡©us
 = 
BUSY_STATE
;

868 
	`æush_³ndšg
(
¡rm
);

869 ià(
s
->
³ndšg
 != 0) {

870 
s
->
Ï¡_æush
 = -1;

871  
Z_OK
;

875 
	`put_by‹
(
s
, (s->
gzh—d
->
‹xt
 ? 1 : 0) +

876 (
s
->
gzh—d
->
hüc
 ? 2 : 0) +

877 (
s
->
gzh—d
->
exŒa
 =ð
Z_NULL
 ? 0 : 4) +

878 (
s
->
gzh—d
->
Çme
 =ð
Z_NULL
 ? 0 : 8) +

879 (
s
->
gzh—d
->
comm’t
 =ð
Z_NULL
 ? 0 : 16)

881 
	`put_by‹
(
s
, (
By‹
)(s->
gzh—d
->
time
 & 0xff));

882 
	`put_by‹
(
s
, (
By‹
)((s->
gzh—d
->
time
 >> 8) & 0xff));

883 
	`put_by‹
(
s
, (
By‹
)((s->
gzh—d
->
time
 >> 16) & 0xff));

884 
	`put_by‹
(
s
, (
By‹
)((s->
gzh—d
->
time
 >> 24) & 0xff));

885 
	`put_by‹
(
s
, s->
Ëv–
 == 9 ? 2 :

886 (
s
->
¡¿‹gy
 >ð
Z_HUFFMAN_ONLY
 || s->
Ëv–
 < 2 ?

888 
	`put_by‹
(
s
, s->
gzh—d
->
os
 & 0xff);

889 ià(
s
->
gzh—d
->
exŒa
 !ð
Z_NULL
) {

890 
	`put_by‹
(
s
, s->
gzh—d
->
exŒa_Ën
 & 0xff);

891 
	`put_by‹
(
s
, (s->
gzh—d
->
exŒa_Ën
 >> 8) & 0xff);

893 ià(
s
->
gzh—d
->
hüc
)

894 
¡rm
->
adËr
 = 
	`üc32
(¡rm->adËr, 
s
->
³ndšg_buf
,

895 
s
->
³ndšg
);

896 
s
->
gzšdex
 = 0;

897 
s
->
¡©us
 = 
EXTRA_STATE
;

900 ià(
s
->
¡©us
 =ð
EXTRA_STATE
) {

901 ià(
s
->
gzh—d
->
exŒa
 !ð
Z_NULL
) {

902 
ulg
 
beg
 = 
s
->
³ndšg
;

903 
uIÁ
 
Ëá
 = (
s
->
gzh—d
->
exŒa_Ën
 & 0xffffè- s->
gzšdex
;

904 
s
->
³ndšg
 + 
Ëá
 > s->
³ndšg_buf_size
) {

905 
uIÁ
 
cÝy
 = 
s
->
³ndšg_buf_size
 - s->
³ndšg
;

906 
	`zmemýy
(
s
->
³ndšg_buf
 + s->
³ndšg
,

907 
s
->
gzh—d
->
exŒa
 + s->
gzšdex
, 
cÝy
);

908 
s
->
³ndšg
 = s->
³ndšg_buf_size
;

909 
	`HCRC_UPDATE
(
beg
);

910 
s
->
gzšdex
 +ð
cÝy
;

911 
	`æush_³ndšg
(
¡rm
);

912 ià(
s
->
³ndšg
 != 0) {

913 
s
->
Ï¡_æush
 = -1;

914  
Z_OK
;

916 
beg
 = 0;

917 
Ëá
 -ð
cÝy
;

919 
	`zmemýy
(
s
->
³ndšg_buf
 + s->
³ndšg
,

920 
s
->
gzh—d
->
exŒa
 + s->
gzšdex
, 
Ëá
);

921 
s
->
³ndšg
 +ð
Ëá
;

922 
	`HCRC_UPDATE
(
beg
);

923 
s
->
gzšdex
 = 0;

925 
s
->
¡©us
 = 
NAME_STATE
;

927 ià(
s
->
¡©us
 =ð
NAME_STATE
) {

928 ià(
s
->
gzh—d
->
Çme
 !ð
Z_NULL
) {

929 
ulg
 
beg
 = 
s
->
³ndšg
;

930 
v®
;

932 ià(
s
->
³ndšg
 =ðs->
³ndšg_buf_size
) {

933 
	`HCRC_UPDATE
(
beg
);

934 
	`æush_³ndšg
(
¡rm
);

935 ià(
s
->
³ndšg
 != 0) {

936 
s
->
Ï¡_æush
 = -1;

937  
Z_OK
;

939 
beg
 = 0;

941 
v®
 = 
s
->
gzh—d
->
Çme
[s->
gzšdex
++];

942 
	`put_by‹
(
s
, 
v®
);

943 } 
v®
 != 0);

944 
	`HCRC_UPDATE
(
beg
);

945 
s
->
gzšdex
 = 0;

947 
s
->
¡©us
 = 
COMMENT_STATE
;

949 ià(
s
->
¡©us
 =ð
COMMENT_STATE
) {

950 ià(
s
->
gzh—d
->
comm’t
 !ð
Z_NULL
) {

951 
ulg
 
beg
 = 
s
->
³ndšg
;

952 
v®
;

954 ià(
s
->
³ndšg
 =ðs->
³ndšg_buf_size
) {

955 
	`HCRC_UPDATE
(
beg
);

956 
	`æush_³ndšg
(
¡rm
);

957 ià(
s
->
³ndšg
 != 0) {

958 
s
->
Ï¡_æush
 = -1;

959  
Z_OK
;

961 
beg
 = 0;

963 
v®
 = 
s
->
gzh—d
->
comm’t
[s->
gzšdex
++];

964 
	`put_by‹
(
s
, 
v®
);

965 } 
v®
 != 0);

966 
	`HCRC_UPDATE
(
beg
);

968 
s
->
¡©us
 = 
HCRC_STATE
;

970 ià(
s
->
¡©us
 =ð
HCRC_STATE
) {

971 ià(
s
->
gzh—d
->
hüc
) {

972 ià(
s
->
³ndšg
 + 2 > s->
³ndšg_buf_size
) {

973 
	`æush_³ndšg
(
¡rm
);

974 ià(
s
->
³ndšg
 != 0) {

975 
s
->
Ï¡_æush
 = -1;

976  
Z_OK
;

979 
	`put_by‹
(
s
, (
By‹
)(
¡rm
->
adËr
 & 0xff));

980 
	`put_by‹
(
s
, (
By‹
)((
¡rm
->
adËr
 >> 8) & 0xff));

981 
¡rm
->
adËr
 = 
	`üc32
(0L, 
Z_NULL
, 0);

983 
s
->
¡©us
 = 
BUSY_STATE
;

986 
	`æush_³ndšg
(
¡rm
);

987 ià(
s
->
³ndšg
 != 0) {

988 
s
->
Ï¡_æush
 = -1;

989  
Z_OK
;

996 ià(
¡rm
->
avaž_š
 !ð0 || 
s
->
lookah—d
 != 0 ||

997 (
æush
 !ð
Z_NO_FLUSH
 && 
s
->
¡©us
 !ð
FINISH_STATE
)) {

998 
block_¡©e
 
b¡©e
;

1000 
b¡©e
 = 
s
->
Ëv–
 =ð0 ? 
	`deæ©e_¡Üed
(s, 
æush
) :

1001 
s
->
¡¿‹gy
 =ð
Z_HUFFMAN_ONLY
 ? 
	`deæ©e_huff
(s, 
æush
) :

1002 
s
->
¡¿‹gy
 =ð
Z_RLE
 ? 
	`deæ©e_¾e
(s, 
æush
) :

1003 (*(
cÚfigu¿tiÚ_bË
[
s
->
Ëv–
].
func
))(s, 
æush
);

1005 ià(
b¡©e
 =ð
fšish_¡¬‹d
 || b¡©=ð
fšish_dÚe
) {

1006 
s
->
¡©us
 = 
FINISH_STATE
;

1008 ià(
b¡©e
 =ð
Ãed_mÜe
 || b¡©=ð
fšish_¡¬‹d
) {

1009 ià(
¡rm
->
avaž_out
 == 0) {

1010 
s
->
Ï¡_æush
 = -1;

1012  
Z_OK
;

1021 ià(
b¡©e
 =ð
block_dÚe
) {

1022 ià(
æush
 =ð
Z_PARTIAL_FLUSH
) {

1023 
	`_Œ_®ign
(
s
);

1024 } ià(
æush
 !ð
Z_BLOCK
) {

1025 
	`_Œ_¡Üed_block
(
s
, (*)0, 0L, 0);

1029 ià(
æush
 =ð
Z_FULL_FLUSH
) {

1030 
	`CLEAR_HASH
(
s
);

1031 ià(
s
->
lookah—d
 == 0) {

1032 
s
->
¡r¡¬t
 = 0;

1033 
s
->
block_¡¬t
 = 0L;

1034 
s
->
š£¹
 = 0;

1038 
	`æush_³ndšg
(
¡rm
);

1039 ià(
¡rm
->
avaž_out
 == 0) {

1040 
s
->
Ï¡_æush
 = -1;

1041  
Z_OK
;

1046 ià(
æush
 !ð
Z_FINISH
è 
Z_OK
;

1047 ià(
s
->
w¿p
 <ð0è 
Z_STREAM_END
;

1050 #ifdeà
GZIP


1051 ià(
s
->
w¿p
 == 2) {

1052 
	`put_by‹
(
s
, (
By‹
)(
¡rm
->
adËr
 & 0xff));

1053 
	`put_by‹
(
s
, (
By‹
)((
¡rm
->
adËr
 >> 8) & 0xff));

1054 
	`put_by‹
(
s
, (
By‹
)((
¡rm
->
adËr
 >> 16) & 0xff));

1055 
	`put_by‹
(
s
, (
By‹
)((
¡rm
->
adËr
 >> 24) & 0xff));

1056 
	`put_by‹
(
s
, (
By‹
)(
¡rm
->
tÙ®_š
 & 0xff));

1057 
	`put_by‹
(
s
, (
By‹
)((
¡rm
->
tÙ®_š
 >> 8) & 0xff));

1058 
	`put_by‹
(
s
, (
By‹
)((
¡rm
->
tÙ®_š
 >> 16) & 0xff));

1059 
	`put_by‹
(
s
, (
By‹
)((
¡rm
->
tÙ®_š
 >> 24) & 0xff));

1064 
	`putShÜtMSB
(
s
, (
uIÁ
)(
¡rm
->
adËr
 >> 16));

1065 
	`putShÜtMSB
(
s
, (
uIÁ
)(
¡rm
->
adËr
 & 0xffff));

1067 
	`æush_³ndšg
(
¡rm
);

1071 ià(
s
->
w¿p
 > 0) s->wrap = -s->wrap;

1072  
s
->
³ndšg
 !ð0 ? 
Z_OK
 : 
Z_STREAM_END
;

1073 
	}
}

1076 
ZEXPORT
 
	$deæ©eEnd
 (
¡rm
)

1077 
z_¡»amp
 
¡rm
;

1079 
¡©us
;

1081 ià(
	`deæ©eS‹Check
(
¡rm
)è 
Z_STREAM_ERROR
;

1083 
¡©us
 = 
¡rm
->
¡©e
->status;

1086 
	`TRY_FREE
(
¡rm
, sŒm->
¡©e
->
³ndšg_buf
);

1087 
	`TRY_FREE
(
¡rm
, sŒm->
¡©e
->
h—d
);

1088 
	`TRY_FREE
(
¡rm
, sŒm->
¡©e
->
´ev
);

1089 
	`TRY_FREE
(
¡rm
, sŒm->
¡©e
->
wšdow
);

1091 
	`ZFREE
(
¡rm
, sŒm->
¡©e
);

1092 
¡rm
->
¡©e
 = 
Z_NULL
;

1094  
¡©us
 =ð
BUSY_STATE
 ? 
Z_DATA_ERROR
 : 
Z_OK
;

1095 
	}
}

1102 
ZEXPORT
 
	$deæ©eCÝy
 (
de¡
, 
sourû
)

1103 
z_¡»amp
 
de¡
;

1104 
z_¡»amp
 
sourû
;

1106 #ifdeà
MAXSEG_64K


1107  
Z_STREAM_ERROR
;

1109 
deæ©e_¡©e
 *
ds
;

1110 
deæ©e_¡©e
 *
ss
;

1111 
ushf
 *
ov”Ïy
;

1114 ià(
	`deæ©eS‹Check
(
sourû
è|| 
de¡
 =ð
Z_NULL
) {

1115  
Z_STREAM_ERROR
;

1118 
ss
 = 
sourû
->
¡©e
;

1120 
	`zmemýy
((
voidpf
)
de¡
, (voidpf)
sourû
, (
z_¡»am
));

1122 
ds
 = (
deæ©e_¡©e
 *è
	`ZALLOC
(
de¡
, 1, (deflate_state));

1123 ià(
ds
 =ð
Z_NULL
è 
Z_MEM_ERROR
;

1124 
de¡
->
¡©e
 = (
š‹º®_¡©e
 
FAR
 *è
ds
;

1125 
	`zmemýy
((
voidpf
)
ds
, (voidpf)
ss
, (
deæ©e_¡©e
));

1126 
ds
->
¡rm
 = 
de¡
;

1128 
ds
->
wšdow
 = (
By‹f
 *è
	`ZALLOC
(
de¡
, ds->
w_size
, 2*(
By‹
));

1129 
ds
->
´ev
 = (
Posf
 *è
	`ZALLOC
(
de¡
, ds->
w_size
, (
Pos
));

1130 
ds
->
h—d
 = (
Posf
 *è
	`ZALLOC
(
de¡
, ds->
hash_size
, (
Pos
));

1131 
ov”Ïy
 = (
ushf
 *è
	`ZALLOC
(
de¡
, 
ds
->
l™_bufsize
, (
ush
)+2);

1132 
ds
->
³ndšg_buf
 = (
uchf
 *è
ov”Ïy
;

1134 ià(
ds
->
wšdow
 =ð
Z_NULL
 || ds->
´ev
 =ðZ_NULL || ds->
h—d
 == Z_NULL ||

1135 
ds
->
³ndšg_buf
 =ð
Z_NULL
) {

1136 
	`deæ©eEnd
 (
de¡
);

1137  
Z_MEM_ERROR
;

1140 
	`zmemýy
(
ds
->
wšdow
, 
ss
->wšdow, ds->
w_size
 * 2 * (
By‹
));

1141 
	`zmemýy
((
voidpf
)
ds
->
´ev
, (voidpf)
ss
->´ev, ds->
w_size
 * (
Pos
));

1142 
	`zmemýy
((
voidpf
)
ds
->
h—d
, (voidpf)
ss
->h—d, ds->
hash_size
 * (
Pos
));

1143 
	`zmemýy
(
ds
->
³ndšg_buf
, 
ss
->³ndšg_buf, (
uIÁ
)ds->
³ndšg_buf_size
);

1145 
ds
->
³ndšg_out
 = ds->
³ndšg_buf
 + (
ss
->pending_out - ss->pending_buf);

1146 
ds
->
d_buf
 = 
ov”Ïy
 + ds->
l™_bufsize
/(
ush
);

1147 
ds
->
l_buf
 = ds->
³ndšg_buf
 + (1+(
ush
))*ds->
l™_bufsize
;

1149 
ds
->
l_desc
.
dyn_Œ“
 = ds->
dyn_É»e
;

1150 
ds
->
d_desc
.
dyn_Œ“
 = ds->
dyn_dŒ“
;

1151 
ds
->
bl_desc
.
dyn_Œ“
 = ds->
bl_Œ“
;

1153  
Z_OK
;

1155 
	}
}

1164 
loÿl
 
	$»ad_buf
(
¡rm
, 
buf
, 
size
)

1165 
z_¡»amp
 
¡rm
;

1166 
By‹f
 *
buf
;

1167 
size
;

1169 
Ën
 = 
¡rm
->
avaž_š
;

1171 ià(
Ën
 > 
size
)†en = size;

1172 ià(
Ën
 == 0)  0;

1174 
¡rm
->
avaž_š
 -ð
Ën
;

1176 
	`zmemýy
(
buf
, 
¡rm
->
Ãxt_š
, 
Ën
);

1177 ià(
¡rm
->
¡©e
->
w¿p
 == 1) {

1178 
¡rm
->
adËr
 = 
	`adËr32
(¡rm->adËr, 
buf
, 
Ën
);

1180 #ifdeà
GZIP


1181 ià(
¡rm
->
¡©e
->
w¿p
 == 2) {

1182 
¡rm
->
adËr
 = 
	`üc32
(¡rm->adËr, 
buf
, 
Ën
);

1185 
¡rm
->
Ãxt_š
 +ð
Ën
;

1186 
¡rm
->
tÙ®_š
 +ð
Ën
;

1188  
Ën
;

1189 
	}
}

1194 
loÿl
 
	$lm_š™
 (
s
)

1195 
deæ©e_¡©e
 *
s
;

1197 
s
->
wšdow_size
 = (
ulg
)2L*s->
w_size
;

1199 
	`CLEAR_HASH
(
s
);

1203 
s
->
max_Ïzy_m©ch
 = 
cÚfigu¿tiÚ_bË
[s->
Ëv–
].
max_Ïzy
;

1204 
s
->
good_m©ch
 = 
cÚfigu¿tiÚ_bË
[s->
Ëv–
].
good_Ëngth
;

1205 
s
->
niû_m©ch
 = 
cÚfigu¿tiÚ_bË
[s->
Ëv–
].
niû_Ëngth
;

1206 
s
->
max_chaš_Ëngth
 = 
cÚfigu¿tiÚ_bË
[s->
Ëv–
].
max_chaš
;

1208 
s
->
¡r¡¬t
 = 0;

1209 
s
->
block_¡¬t
 = 0L;

1210 
s
->
lookah—d
 = 0;

1211 
s
->
š£¹
 = 0;

1212 
s
->
m©ch_Ëngth
 = s->
´ev_Ëngth
 = 
MIN_MATCH
-1;

1213 
s
->
m©ch_avažabË
 = 0;

1214 
s
->
šs_h
 = 0;

1215 #iâdeà
FASTEST


1216 #ifdeà
ASMV


1217 
	`m©ch_š™
();

1220 
	}
}

1222 #iâdeà
FASTEST


1232 #iâdeà
ASMV


1236 
loÿl
 
uIÁ
 
	$lÚge¡_m©ch
(
s
, 
cur_m©ch
)

1237 
deæ©e_¡©e
 *
s
;

1238 
IPos
 
cur_m©ch
;

1240 
chaš_Ëngth
 = 
s
->
max_chaš_Ëngth
;

1241 
By‹f
 *
sÿn
 = 
s
->
wšdow
 + s->
¡r¡¬t
;

1242 
By‹f
 *
m©ch
;

1243 
Ën
;

1244 
be¡_Ën
 = ()
s
->
´ev_Ëngth
;

1245 
niû_m©ch
 = 
s
->nice_match;

1246 
IPos
 
lim™
 = 
s
->
¡r¡¬t
 > (IPos)
	`MAX_DIST
(s) ?

1247 
s
->
¡r¡¬t
 - (
IPos
)
	`MAX_DIST
(sè: 
NIL
;

1251 
Posf
 *
´ev
 = 
s
->prev;

1252 
uIÁ
 
wmask
 = 
s
->
w_mask
;

1254 #ifdeà
UNALIGNED_OK


1258 
By‹f
 *
¡»nd
 = 
s
->
wšdow
 + s->
¡r¡¬t
 + 
MAX_MATCH
 - 1;

1259 
ush
 
sÿn_¡¬t
 = *(
ushf
*)
sÿn
;

1260 
ush
 
sÿn_’d
 = *(
ushf
*)(
sÿn
+
be¡_Ën
-1);

1262 
By‹f
 *
¡»nd
 = 
s
->
wšdow
 + s->
¡r¡¬t
 + 
MAX_MATCH
;

1263 
By‹
 
sÿn_’d1
 = 
sÿn
[
be¡_Ën
-1];

1264 
By‹
 
sÿn_’d
 = 
sÿn
[
be¡_Ën
];

1270 
	`As£¹
(
s
->
hash_b™s
 >ð8 && 
MAX_MATCH
 == 258, "Codeoo clever");

1273 ià(
s
->
´ev_Ëngth
 >ðs->
good_m©ch
) {

1274 
chaš_Ëngth
 >>= 2;

1279 ià((
uIÁ
)
niû_m©ch
 > 
s
->
lookah—d
)‚ice_match = ()s->lookahead;

1281 
	`As£¹
((
ulg
)
s
->
¡r¡¬t
 <ðs->
wšdow_size
-
MIN_LOOKAHEAD
, "need†ookahead");

1284 
	`As£¹
(
cur_m©ch
 < 
s
->
¡r¡¬t
, "no future");

1285 
m©ch
 = 
s
->
wšdow
 + 
cur_m©ch
;

1295 #ià(
	`defšed
(
UNALIGNED_OK
è&& 
MAX_MATCH
 == 258)

1299 ià(*(
ushf
*)(
m©ch
+
be¡_Ën
-1è!ð
sÿn_’d
 ||

1300 *(
ushf
*)
m©ch
 !ð
sÿn_¡¬t
) ;

1311 
	`As£¹
(
sÿn
[2] =ð
m©ch
[2], "scan[2]?");

1312 
sÿn
++, 
m©ch
++;

1314 } *(
ushf
*)(
sÿn
+=2è=ð*(ushf*)(
m©ch
+=2) &&

1315 *(
ushf
*)(
sÿn
+=2è=ð*(ushf*)(
m©ch
+=2) &&

1316 *(
ushf
*)(
sÿn
+=2è=ð*(ushf*)(
m©ch
+=2) &&

1317 *(
ushf
*)(
sÿn
+=2è=ð*(ushf*)(
m©ch
+=2) &&

1318 
sÿn
 < 
¡»nd
);

1322 
	`As£¹
(
sÿn
 <ð
s
->
wšdow
+()(s->
wšdow_size
-1), "wild scan");

1323 ià(*
sÿn
 =ð*
m©ch
) scan++;

1325 
Ën
 = (
MAX_MATCH
 - 1è- ()(
¡»nd
-
sÿn
);

1326 
sÿn
 = 
¡»nd
 - (
MAX_MATCH
-1);

1330 ià(
m©ch
[
be¡_Ën
] !ð
sÿn_’d
 ||

1331 
m©ch
[
be¡_Ën
-1] !ð
sÿn_’d1
 ||

1332 *
m©ch
 !ð*
sÿn
 ||

1333 *++
m©ch
 !ð
sÿn
[1]) ;

1341 
sÿn
 +ð2, 
m©ch
++;

1342 
	`As£¹
(*
sÿn
 =ð*
m©ch
, "match[2]?");

1348 } *++
sÿn
 =ð*++
m©ch
 && *++scan == *++match &&

1349 *++
sÿn
 =ð*++
m©ch
 && *++scan == *++match &&

1350 *++
sÿn
 =ð*++
m©ch
 && *++scan == *++match &&

1351 *++
sÿn
 =ð*++
m©ch
 && *++scan == *++match &&

1352 
sÿn
 < 
¡»nd
);

1354 
	`As£¹
(
sÿn
 <ð
s
->
wšdow
+()(s->
wšdow_size
-1), "wild scan");

1356 
Ën
 = 
MAX_MATCH
 - ()(
¡»nd
 - 
sÿn
);

1357 
sÿn
 = 
¡»nd
 - 
MAX_MATCH
;

1361 ià(
Ën
 > 
be¡_Ën
) {

1362 
s
->
m©ch_¡¬t
 = 
cur_m©ch
;

1363 
be¡_Ën
 = 
Ën
;

1364 ià(
Ën
 >ð
niû_m©ch
) ;

1365 #ifdeà
UNALIGNED_OK


1366 
sÿn_’d
 = *(
ushf
*)(
sÿn
+
be¡_Ën
-1);

1368 
sÿn_’d1
 = 
sÿn
[
be¡_Ën
-1];

1369 
sÿn_’d
 = 
sÿn
[
be¡_Ën
];

1372 } (
cur_m©ch
 = 
´ev
[cur_m©ch & 
wmask
]è> 
lim™


1373 && --
chaš_Ëngth
 != 0);

1375 ià((
uIÁ
)
be¡_Ën
 <ð
s
->
lookah—d
)  (uInt)best_len;

1376  
s
->
lookah—d
;

1377 
	}
}

1385 
loÿl
 
uIÁ
 
	$lÚge¡_m©ch
(
s
, 
cur_m©ch
)

1386 
deæ©e_¡©e
 *
s
;

1387 
IPos
 
cur_m©ch
;

1389 
By‹f
 *
sÿn
 = 
s
->
wšdow
 + s->
¡r¡¬t
;

1390 
By‹f
 *
m©ch
;

1391 
Ën
;

1392 
By‹f
 *
¡»nd
 = 
s
->
wšdow
 + s->
¡r¡¬t
 + 
MAX_MATCH
;

1397 
	`As£¹
(
s
->
hash_b™s
 >ð8 && 
MAX_MATCH
 == 258, "Codeoo clever");

1399 
	`As£¹
((
ulg
)
s
->
¡r¡¬t
 <ðs->
wšdow_size
-
MIN_LOOKAHEAD
, "need†ookahead");

1401 
	`As£¹
(
cur_m©ch
 < 
s
->
¡r¡¬t
, "no future");

1403 
m©ch
 = 
s
->
wšdow
 + 
cur_m©ch
;

1407 ià(
m©ch
[0] !ð
sÿn
[0] || m©ch[1] !ðsÿn[1]è 
MIN_MATCH
-1;

1415 
sÿn
 +ð2, 
m©ch
 += 2;

1416 
	`As£¹
(*
sÿn
 =ð*
m©ch
, "match[2]?");

1422 } *++
sÿn
 =ð*++
m©ch
 && *++scan == *++match &&

1423 *++
sÿn
 =ð*++
m©ch
 && *++scan == *++match &&

1424 *++
sÿn
 =ð*++
m©ch
 && *++scan == *++match &&

1425 *++
sÿn
 =ð*++
m©ch
 && *++scan == *++match &&

1426 
sÿn
 < 
¡»nd
);

1428 
	`As£¹
(
sÿn
 <ð
s
->
wšdow
+()(s->
wšdow_size
-1), "wild scan");

1430 
Ën
 = 
MAX_MATCH
 - ()(
¡»nd
 - 
sÿn
);

1432 ià(
Ën
 < 
MIN_MATCH
)  MIN_MATCH - 1;

1434 
s
->
m©ch_¡¬t
 = 
cur_m©ch
;

1435  (
uIÁ
)
Ën
 <ð
s
->
lookah—d
 ? (uInt)len : s->lookahead;

1436 
	}
}

1440 #ifdeà
ZLIB_DEBUG


1442 
	#EQUAL
 0

	)

1448 
loÿl
 
	$check_m©ch
(
s
, 
¡¬t
, 
m©ch
, 
Ëngth
)

1449 
deæ©e_¡©e
 *
s
;

1450 
IPos
 
¡¬t
, 
m©ch
;

1451 
Ëngth
;

1454 ià(
	`zmemcmp
(
s
->
wšdow
 + 
m©ch
,

1455 
s
->
wšdow
 + 
¡¬t
, 
Ëngth
è!ð
EQUAL
) {

1456 
	`årštf
(
¡d”r
, " start %u, match %u,†ength %d\n",

1457 
¡¬t
, 
m©ch
, 
Ëngth
);

1459 
	`årštf
(
¡d”r
, "%c%c", 
s
->
wšdow
[
m©ch
++], s->wšdow[
¡¬t
++]);

1460 } --
Ëngth
 != 0);

1461 
	`z_”rÜ
("invalid match");

1463 ià(
z_v”bo£
 > 1) {

1464 
	`årštf
(
¡d”r
,"\\[%d,%d]", 
¡¬t
-
m©ch
, 
Ëngth
);

1465 dØ{ 
	`putc
(
s
->
wšdow
[
¡¬t
++], 
¡d”r
); } --
Ëngth
 != 0);

1467 
	}
}

1469 
	#check_m©ch
(
s
, 
¡¬t
, 
m©ch
, 
Ëngth
)

	)

1482 
loÿl
 
	$fžl_wšdow
(
s
)

1483 
deæ©e_¡©e
 *
s
;

1485 
n
;

1486 
mÜe
;

1487 
uIÁ
 
wsize
 = 
s
->
w_size
;

1489 
	`As£¹
(
s
->
lookah—d
 < 
MIN_LOOKAHEAD
, "alreadyƒnough†ookahead");

1492 
mÜe
 = ()(
s
->
wšdow_size
 -(
ulg
)s->
lookah—d
 -(ulg)s->
¡r¡¬t
);

1496 ià(
mÜe
 =ð0 && 
s
->
¡r¡¬t
 =ð0 && s->
lookah—d
 == 0) {

1497 
mÜe
 = 
wsize
;

1499 } ià(
mÜe
 == ()(-1)) {

1503 
mÜe
--;

1510 ià(
s
->
¡r¡¬t
 >ð
wsize
+
	`MAX_DIST
(s)) {

1512 
	`zmemýy
(
s
->
wšdow
, s->wšdow+
wsize
, ()wsiz- 
mÜe
);

1513 
s
->
m©ch_¡¬t
 -ð
wsize
;

1514 
s
->
¡r¡¬t
 -ð
wsize
;

1515 
s
->
block_¡¬t
 -ð(è
wsize
;

1516 
	`¦ide_hash
(
s
);

1517 
mÜe
 +ð
wsize
;

1519 ià(
s
->
¡rm
->
avaž_š
 == 0) ;

1532 
	`As£¹
(
mÜe
 >= 2, "more < 2");

1534 
n
 = 
	`»ad_buf
(
s
->
¡rm
, s->
wšdow
 + s->
¡r¡¬t
 + s->
lookah—d
, 
mÜe
);

1535 
s
->
lookah—d
 +ð
n
;

1538 ià(
s
->
lookah—d
 + s->
š£¹
 >ð
MIN_MATCH
) {

1539 
uIÁ
 
¡r
 = 
s
->
¡r¡¬t
 - s->
š£¹
;

1540 
s
->
šs_h
 = s->
wšdow
[
¡r
];

1541 
	`UPDATE_HASH
(
s
, s->
šs_h
, s->
wšdow
[
¡r
 + 1]);

1542 #ià
MIN_MATCH
 != 3

1543 
C®l
 
	`UPDATE_HASH
(è
MIN_MATCH
-3 
mÜe
 
times


1545 
s
->
š£¹
) {

1546 
	`UPDATE_HASH
(
s
, s->
šs_h
, s->
wšdow
[
¡r
 + 
MIN_MATCH
-1]);

1547 #iâdeà
FASTEST


1548 
s
->
´ev
[
¡r
 & s->
w_mask
] = s->
h—d
[s->
šs_h
];

1550 
s
->
h—d
[s->
šs_h
] = (
Pos
)
¡r
;

1551 
¡r
++;

1552 
s
->
š£¹
--;

1553 ià(
s
->
lookah—d
 + s->
š£¹
 < 
MIN_MATCH
)

1561 } 
s
->
lookah—d
 < 
MIN_LOOKAHEAD
 && s->
¡rm
->
avaž_š
 != 0);

1570 ià(
s
->
high_w©”
 < s->
wšdow_size
) {

1571 
ulg
 
cu¼
 = 
s
->
¡r¡¬t
 + (ulg)(s->
lookah—d
);

1572 
ulg
 
š™
;

1574 ià(
s
->
high_w©”
 < 
cu¼
) {

1578 
š™
 = 
s
->
wšdow_size
 - 
cu¼
;

1579 ià(
š™
 > 
WIN_INIT
)

1580 
š™
 = 
WIN_INIT
;

1581 
	`zmemz”o
(
s
->
wšdow
 + 
cu¼
, ()
š™
);

1582 
s
->
high_w©”
 = 
cu¼
 + 
š™
;

1584 ià(
s
->
high_w©”
 < (
ulg
)
cu¼
 + 
WIN_INIT
) {

1589 
š™
 = (
ulg
)
cu¼
 + 
WIN_INIT
 - 
s
->
high_w©”
;

1590 ià(
š™
 > 
s
->
wšdow_size
 - s->
high_w©”
)

1591 
š™
 = 
s
->
wšdow_size
 - s->
high_w©”
;

1592 
	`zmemz”o
(
s
->
wšdow
 + s->
high_w©”
, ()
š™
);

1593 
s
->
high_w©”
 +ð
š™
;

1597 
	`As£¹
((
ulg
)
s
->
¡r¡¬t
 <ðs->
wšdow_size
 - 
MIN_LOOKAHEAD
,

1599 
	}
}

1605 
	#FLUSH_BLOCK_ONLY
(
s
, 
Ï¡
) { \

1606 
	`_Œ_æush_block
(
s
, (s->
block_¡¬t
 >= 0L ? \

1607 (
ch¬f
 *)&
s
->
wšdow
[()s->
block_¡¬t
] : \

1608 (
ch¬f
 *)
Z_NULL
), \

1609 (
ulg
)(()
s
->
¡r¡¬t
 - s->
block_¡¬t
), \

1610 (
Ï¡
)); \

1611 
s
->
block_¡¬t
 = s->
¡r¡¬t
; \

1612 
	`æush_³ndšg
(
s
->
¡rm
); \

1613 
	`T¿ûv
((
¡d”r
,"[FLUSH]")); \

1614 }

	)

1617 
	#FLUSH_BLOCK
(
s
, 
Ï¡
) { \

1618 
	`FLUSH_BLOCK_ONLY
(
s
, 
Ï¡
); \

1619 ià(
s
->
¡rm
->
avaž_out
 =ð0è (
Ï¡
è? 
fšish_¡¬‹d
 : 
Ãed_mÜe
; \

1620 }

	)

1623 
	#MAX_STORED
 65535

	)

1626 
	#MIN
(
a
, 
b
è(×è> (bè? (bè: (a))

	)

1643 
loÿl
 
block_¡©e
 
	$deæ©e_¡Üed
(
s
, 
æush
)

1644 
deæ©e_¡©e
 *
s
;

1645 
æush
;

1651 
mš_block
 = 
	`MIN
(
s
->
³ndšg_buf_size
 - 5, s->
w_size
);

1657 
Ën
, 
Ëá
, 
have
, 
Ï¡
 = 0;

1658 
u£d
 = 
s
->
¡rm
->
avaž_š
;

1664 
Ën
 = 
MAX_STORED
;

1665 
have
 = (
s
->
bi_v®id
 + 42) >> 3;

1666 ià(
s
->
¡rm
->
avaž_out
 < 
have
)

1669 
have
 = 
s
->
¡rm
->
avaž_out
 - have;

1670 
Ëá
 = 
s
->
¡r¡¬t
 - s->
block_¡¬t
;

1671 ià(
Ën
 > (
ulg
)
Ëá
 + 
s
->
¡rm
->
avaž_š
)

1672 
Ën
 = 
Ëá
 + 
s
->
¡rm
->
avaž_š
;

1673 ià(
Ën
 > 
have
)

1674 
Ën
 = 
have
;

1681 ià(
Ën
 < 
mš_block
 && (Ö’ =ð0 && 
æush
 !ð
Z_FINISH
) ||

1682 
æush
 =ð
Z_NO_FLUSH
 ||

1683 
Ën
 !ð
Ëá
 + 
s
->
¡rm
->
avaž_š
))

1689 
Ï¡
 = 
æush
 =ð
Z_FINISH
 && 
Ën
 =ð
Ëá
 + 
s
->
¡rm
->
avaž_š
 ? 1 : 0;

1690 
	`_Œ_¡Üed_block
(
s
, (*)0, 0L, 
Ï¡
);

1693 
s
->
³ndšg_buf
[s->
³ndšg
 - 4] = 
Ën
;

1694 
s
->
³ndšg_buf
[s->
³ndšg
 - 3] = 
Ën
 >> 8;

1695 
s
->
³ndšg_buf
[s->
³ndšg
 - 2] = ~
Ën
;

1696 
s
->
³ndšg_buf
[s->
³ndšg
 - 1] = ~
Ën
 >> 8;

1699 
	`æush_³ndšg
(
s
->
¡rm
);

1701 #ifdeà
ZLIB_DEBUG


1703 
s
->
com´es£d_Ën
 +ð
Ën
 << 3;

1704 
s
->
b™s_£Á
 +ð
Ën
 << 3;

1708 ià(
Ëá
) {

1709 ià(
Ëá
 > 
Ën
)

1710 
Ëá
 = 
Ën
;

1711 
	`zmemýy
(
s
->
¡rm
->
Ãxt_out
, s->
wšdow
 + s->
block_¡¬t
, 
Ëá
);

1712 
s
->
¡rm
->
Ãxt_out
 +ð
Ëá
;

1713 
s
->
¡rm
->
avaž_out
 -ð
Ëá
;

1714 
s
->
¡rm
->
tÙ®_out
 +ð
Ëá
;

1715 
s
->
block_¡¬t
 +ð
Ëá
;

1716 
Ën
 -ð
Ëá
;

1722 ià(
Ën
) {

1723 
	`»ad_buf
(
s
->
¡rm
, s->¡rm->
Ãxt_out
, 
Ën
);

1724 
s
->
¡rm
->
Ãxt_out
 +ð
Ën
;

1725 
s
->
¡rm
->
avaž_out
 -ð
Ën
;

1726 
s
->
¡rm
->
tÙ®_out
 +ð
Ën
;

1728 } 
Ï¡
 == 0);

1736 
u£d
 -ð
s
->
¡rm
->
avaž_š
;

1737 ià(
u£d
) {

1741 ià(
u£d
 >ð
s
->
w_size
) {

1742 
s
->
m©ches
 = 2;

1743 
	`zmemýy
(
s
->
wšdow
, s->
¡rm
->
Ãxt_š
 - s->
w_size
, s->w_size);

1744 
s
->
¡r¡¬t
 = s->
w_size
;

1747 ià(
s
->
wšdow_size
 - s->
¡r¡¬t
 <ð
u£d
) {

1749 
s
->
¡r¡¬t
 -ðs->
w_size
;

1750 
	`zmemýy
(
s
->
wšdow
, s->wšdow + s->
w_size
, s->
¡r¡¬t
);

1751 ià(
s
->
m©ches
 < 2)

1752 
s
->
m©ches
++;

1754 
	`zmemýy
(
s
->
wšdow
 + s->
¡r¡¬t
, s->
¡rm
->
Ãxt_š
 - 
u£d
, used);

1755 
s
->
¡r¡¬t
 +ð
u£d
;

1757 
s
->
block_¡¬t
 = s->
¡r¡¬t
;

1758 
s
->
š£¹
 +ð
	`MIN
(
u£d
, s->
w_size
 - s->insert);

1760 ià(
s
->
high_w©”
 < s->
¡r¡¬t
)

1761 
s
->
high_w©”
 = s->
¡r¡¬t
;

1764 ià(
Ï¡
)

1765  
fšish_dÚe
;

1768 ià(
æush
 !ð
Z_NO_FLUSH
 && flush !ð
Z_FINISH
 &&

1769 
s
->
¡rm
->
avaž_š
 =ð0 && ()s->
¡r¡¬t
 =ðs->
block_¡¬t
)

1770  
block_dÚe
;

1773 
have
 = 
s
->
wšdow_size
 - s->
¡r¡¬t
 - 1;

1774 ià(
s
->
¡rm
->
avaž_š
 > 
have
 && s->
block_¡¬t
 >ð()s->
w_size
) {

1776 
s
->
block_¡¬t
 -ðs->
w_size
;

1777 
s
->
¡r¡¬t
 -ðs->
w_size
;

1778 
	`zmemýy
(
s
->
wšdow
, s->wšdow + s->
w_size
, s->
¡r¡¬t
);

1779 ià(
s
->
m©ches
 < 2)

1780 
s
->
m©ches
++;

1781 
have
 +ð
s
->
w_size
;

1783 ià(
have
 > 
s
->
¡rm
->
avaž_š
)

1784 
have
 = 
s
->
¡rm
->
avaž_š
;

1785 ià(
have
) {

1786 
	`»ad_buf
(
s
->
¡rm
, s->
wšdow
 + s->
¡r¡¬t
, 
have
);

1787 
s
->
¡r¡¬t
 +ð
have
;

1789 ià(
s
->
high_w©”
 < s->
¡r¡¬t
)

1790 
s
->
high_w©”
 = s->
¡r¡¬t
;

1797 
have
 = (
s
->
bi_v®id
 + 42) >> 3;

1799 
have
 = 
	`MIN
(
s
->
³ndšg_buf_size
 - have, 
MAX_STORED
);

1800 
mš_block
 = 
	`MIN
(
have
, 
s
->
w_size
);

1801 
Ëá
 = 
s
->
¡r¡¬t
 - s->
block_¡¬t
;

1802 ià(
Ëá
 >ð
mš_block
 ||

1803 ((
Ëá
 || 
æush
 =ð
Z_FINISH
è&& flush !ð
Z_NO_FLUSH
 &&

1804 
s
->
¡rm
->
avaž_š
 =ð0 && 
Ëá
 <ð
have
)) {

1805 
Ën
 = 
	`MIN
(
Ëá
, 
have
);

1806 
Ï¡
 = 
æush
 =ð
Z_FINISH
 && 
s
->
¡rm
->
avaž_š
 == 0 &&

1807 
Ën
 =ð
Ëá
 ? 1 : 0;

1808 
	`_Œ_¡Üed_block
(
s
, (
ch¬f
 *)s->
wšdow
 + s->
block_¡¬t
, 
Ën
, 
Ï¡
);

1809 
s
->
block_¡¬t
 +ð
Ën
;

1810 
	`æush_³ndšg
(
s
->
¡rm
);

1814  
Ï¡
 ? 
fšish_¡¬‹d
 : 
Ãed_mÜe
;

1815 
	}
}

1824 
loÿl
 
block_¡©e
 
	$deæ©e_ç¡
(
s
, 
æush
)

1825 
deæ©e_¡©e
 *
s
;

1826 
æush
;

1828 
IPos
 
hash_h—d
;

1829 
bæush
;

1837 ià(
s
->
lookah—d
 < 
MIN_LOOKAHEAD
) {

1838 
	`fžl_wšdow
(
s
);

1839 ià(
s
->
lookah—d
 < 
MIN_LOOKAHEAD
 && 
æush
 =ð
Z_NO_FLUSH
) {

1840  
Ãed_mÜe
;

1842 ià(
s
->
lookah—d
 == 0) ;

1848 
hash_h—d
 = 
NIL
;

1849 ià(
s
->
lookah—d
 >ð
MIN_MATCH
) {

1850 
	`INSERT_STRING
(
s
, s->
¡r¡¬t
, 
hash_h—d
);

1856 ià(
hash_h—d
 !ð
NIL
 && 
s
->
¡r¡¬t
 - hash_h—d <ð
	`MAX_DIST
(s)) {

1861 
s
->
m©ch_Ëngth
 = 
	`lÚge¡_m©ch
 (s, 
hash_h—d
);

1864 ià(
s
->
m©ch_Ëngth
 >ð
MIN_MATCH
) {

1865 
	`check_m©ch
(
s
, s->
¡r¡¬t
, s->
m©ch_¡¬t
, s->
m©ch_Ëngth
);

1867 
	`_Œ_Îy_di¡
(
s
, s->
¡r¡¬t
 - s->
m©ch_¡¬t
,

1868 
s
->
m©ch_Ëngth
 - 
MIN_MATCH
, 
bæush
);

1870 
s
->
lookah—d
 -ðs->
m©ch_Ëngth
;

1875 #iâdeà
FASTEST


1876 ià(
s
->
m©ch_Ëngth
 <ðs->
max_š£¹_Ëngth
 &&

1877 
s
->
lookah—d
 >ð
MIN_MATCH
) {

1878 
s
->
m©ch_Ëngth
--;

1880 
s
->
¡r¡¬t
++;

1881 
	`INSERT_STRING
(
s
, s->
¡r¡¬t
, 
hash_h—d
);

1885 } --
s
->
m©ch_Ëngth
 != 0);

1886 
s
->
¡r¡¬t
++;

1890 
s
->
¡r¡¬t
 +ðs->
m©ch_Ëngth
;

1891 
s
->
m©ch_Ëngth
 = 0;

1892 
s
->
šs_h
 = s->
wšdow
[s->
¡r¡¬t
];

1893 
	`UPDATE_HASH
(
s
, s->
šs_h
, s->
wšdow
[s->
¡r¡¬t
+1]);

1894 #ià
MIN_MATCH
 != 3

1895 
C®l
 
	`UPDATE_HASH
(è
MIN_MATCH
-3 
mÜe
 
times


1903 
	`T¿ûvv
((
¡d”r
,"%c", 
s
->
wšdow
[s->
¡r¡¬t
]));

1904 
	`_Œ_Îy_l™
 (
s
, s->
wšdow
[s->
¡r¡¬t
], 
bæush
);

1905 
s
->
lookah—d
--;

1906 
s
->
¡r¡¬t
++;

1908 ià(
bæush
è
	`FLUSH_BLOCK
(
s
, 0);

1910 
s
->
š£¹
 = s->
¡r¡¬t
 < 
MIN_MATCH
-1 ? s->strstart : MIN_MATCH-1;

1911 ià(
æush
 =ð
Z_FINISH
) {

1912 
	`FLUSH_BLOCK
(
s
, 1);

1913  
fšish_dÚe
;

1915 ià(
s
->
Ï¡_l™
)

1916 
	`FLUSH_BLOCK
(
s
, 0);

1917  
block_dÚe
;

1918 
	}
}

1920 #iâdeà
FASTEST


1926 
loÿl
 
block_¡©e
 
	$deæ©e_¦ow
(
s
, 
æush
)

1927 
deæ©e_¡©e
 *
s
;

1928 
æush
;

1930 
IPos
 
hash_h—d
;

1931 
bæush
;

1940 ià(
s
->
lookah—d
 < 
MIN_LOOKAHEAD
) {

1941 
	`fžl_wšdow
(
s
);

1942 ià(
s
->
lookah—d
 < 
MIN_LOOKAHEAD
 && 
æush
 =ð
Z_NO_FLUSH
) {

1943  
Ãed_mÜe
;

1945 ià(
s
->
lookah—d
 == 0) ;

1951 
hash_h—d
 = 
NIL
;

1952 ià(
s
->
lookah—d
 >ð
MIN_MATCH
) {

1953 
	`INSERT_STRING
(
s
, s->
¡r¡¬t
, 
hash_h—d
);

1958 
s
->
´ev_Ëngth
 = s->
m©ch_Ëngth
, s->
´ev_m©ch
 = s->
m©ch_¡¬t
;

1959 
s
->
m©ch_Ëngth
 = 
MIN_MATCH
-1;

1961 ià(
hash_h—d
 !ð
NIL
 && 
s
->
´ev_Ëngth
 < s->
max_Ïzy_m©ch
 &&

1962 
s
->
¡r¡¬t
 - 
hash_h—d
 <ð
	`MAX_DIST
(s)) {

1967 
s
->
m©ch_Ëngth
 = 
	`lÚge¡_m©ch
 (s, 
hash_h—d
);

1970 ià(
s
->
m©ch_Ëngth
 <ð5 && (s->
¡¿‹gy
 =ð
Z_FILTERED


1971 #ià
TOO_FAR
 <= 32767

1972 || (
s
->
m©ch_Ëngth
 =ð
MIN_MATCH
 &&

1973 
s
->
¡r¡¬t
 - s->
m©ch_¡¬t
 > 
TOO_FAR
)

1980 
s
->
m©ch_Ëngth
 = 
MIN_MATCH
-1;

1986 ià(
s
->
´ev_Ëngth
 >ð
MIN_MATCH
 && s->
m©ch_Ëngth
 <= s->prev_length) {

1987 
uIÁ
 
max_š£¹
 = 
s
->
¡r¡¬t
 + s->
lookah—d
 - 
MIN_MATCH
;

1990 
	`check_m©ch
(
s
, s->
¡r¡¬t
-1, s->
´ev_m©ch
, s->
´ev_Ëngth
);

1992 
	`_Œ_Îy_di¡
(
s
, s->
¡r¡¬t
 -1 - s->
´ev_m©ch
,

1993 
s
->
´ev_Ëngth
 - 
MIN_MATCH
, 
bæush
);

2000 
s
->
lookah—d
 -ðs->
´ev_Ëngth
-1;

2001 
s
->
´ev_Ëngth
 -= 2;

2003 ià(++
s
->
¡r¡¬t
 <ð
max_š£¹
) {

2004 
	`INSERT_STRING
(
s
, s->
¡r¡¬t
, 
hash_h—d
);

2006 } --
s
->
´ev_Ëngth
 != 0);

2007 
s
->
m©ch_avažabË
 = 0;

2008 
s
->
m©ch_Ëngth
 = 
MIN_MATCH
-1;

2009 
s
->
¡r¡¬t
++;

2011 ià(
bæush
è
	`FLUSH_BLOCK
(
s
, 0);

2013 } ià(
s
->
m©ch_avažabË
) {

2018 
	`T¿ûvv
((
¡d”r
,"%c", 
s
->
wšdow
[s->
¡r¡¬t
-1]));

2019 
	`_Œ_Îy_l™
(
s
, s->
wšdow
[s->
¡r¡¬t
-1], 
bæush
);

2020 ià(
bæush
) {

2021 
	`FLUSH_BLOCK_ONLY
(
s
, 0);

2023 
s
->
¡r¡¬t
++;

2024 
s
->
lookah—d
--;

2025 ià(
s
->
¡rm
->
avaž_out
 =ð0è 
Ãed_mÜe
;

2030 
s
->
m©ch_avažabË
 = 1;

2031 
s
->
¡r¡¬t
++;

2032 
s
->
lookah—d
--;

2035 
	`As£¹
 (
æush
 !ð
Z_NO_FLUSH
, "no flush?");

2036 ià(
s
->
m©ch_avažabË
) {

2037 
	`T¿ûvv
((
¡d”r
,"%c", 
s
->
wšdow
[s->
¡r¡¬t
-1]));

2038 
	`_Œ_Îy_l™
(
s
, s->
wšdow
[s->
¡r¡¬t
-1], 
bæush
);

2039 
s
->
m©ch_avažabË
 = 0;

2041 
s
->
š£¹
 = s->
¡r¡¬t
 < 
MIN_MATCH
-1 ? s->strstart : MIN_MATCH-1;

2042 ià(
æush
 =ð
Z_FINISH
) {

2043 
	`FLUSH_BLOCK
(
s
, 1);

2044  
fšish_dÚe
;

2046 ià(
s
->
Ï¡_l™
)

2047 
	`FLUSH_BLOCK
(
s
, 0);

2048  
block_dÚe
;

2049 
	}
}

2057 
loÿl
 
block_¡©e
 
	$deæ©e_¾e
(
s
, 
æush
)

2058 
deæ©e_¡©e
 *
s
;

2059 
æush
;

2061 
bæush
;

2062 
uIÁ
 
´ev
;

2063 
By‹f
 *
sÿn
, *
¡»nd
;

2070 ià(
s
->
lookah—d
 <ð
MAX_MATCH
) {

2071 
	`fžl_wšdow
(
s
);

2072 ià(
s
->
lookah—d
 <ð
MAX_MATCH
 && 
æush
 =ð
Z_NO_FLUSH
) {

2073  
Ãed_mÜe
;

2075 ià(
s
->
lookah—d
 == 0) ;

2079 
s
->
m©ch_Ëngth
 = 0;

2080 ià(
s
->
lookah—d
 >ð
MIN_MATCH
 && s->
¡r¡¬t
 > 0) {

2081 
sÿn
 = 
s
->
wšdow
 + s->
¡r¡¬t
 - 1;

2082 
´ev
 = *
sÿn
;

2083 ià(
´ev
 =ð*++
sÿn
 &&…rev == *++scan &&…rev == *++scan) {

2084 
¡»nd
 = 
s
->
wšdow
 + s->
¡r¡¬t
 + 
MAX_MATCH
;

2086 } 
´ev
 =ð*++
sÿn
 &&…rev == *++scan &&

2087 
´ev
 =ð*++
sÿn
 &&…rev == *++scan &&

2088 
´ev
 =ð*++
sÿn
 &&…rev == *++scan &&

2089 
´ev
 =ð*++
sÿn
 &&…rev == *++scan &&

2090 
sÿn
 < 
¡»nd
);

2091 
s
->
m©ch_Ëngth
 = 
MAX_MATCH
 - (
uIÁ
)(
¡»nd
 - 
sÿn
);

2092 ià(
s
->
m©ch_Ëngth
 > s->
lookah—d
)

2093 
s
->
m©ch_Ëngth
 = s->
lookah—d
;

2095 
	`As£¹
(
sÿn
 <ð
s
->
wšdow
+(
uIÁ
)(s->
wšdow_size
-1), "wild scan");

2099 ià(
s
->
m©ch_Ëngth
 >ð
MIN_MATCH
) {

2100 
	`check_m©ch
(
s
, s->
¡r¡¬t
, s->¡r¡¬ˆ- 1, s->
m©ch_Ëngth
);

2102 
	`_Œ_Îy_di¡
(
s
, 1, s->
m©ch_Ëngth
 - 
MIN_MATCH
, 
bæush
);

2104 
s
->
lookah—d
 -ðs->
m©ch_Ëngth
;

2105 
s
->
¡r¡¬t
 +ðs->
m©ch_Ëngth
;

2106 
s
->
m©ch_Ëngth
 = 0;

2109 
	`T¿ûvv
((
¡d”r
,"%c", 
s
->
wšdow
[s->
¡r¡¬t
]));

2110 
	`_Œ_Îy_l™
 (
s
, s->
wšdow
[s->
¡r¡¬t
], 
bæush
);

2111 
s
->
lookah—d
--;

2112 
s
->
¡r¡¬t
++;

2114 ià(
bæush
è
	`FLUSH_BLOCK
(
s
, 0);

2116 
s
->
š£¹
 = 0;

2117 ià(
æush
 =ð
Z_FINISH
) {

2118 
	`FLUSH_BLOCK
(
s
, 1);

2119  
fšish_dÚe
;

2121 ià(
s
->
Ï¡_l™
)

2122 
	`FLUSH_BLOCK
(
s
, 0);

2123  
block_dÚe
;

2124 
	}
}

2130 
loÿl
 
block_¡©e
 
	$deæ©e_huff
(
s
, 
æush
)

2131 
deæ©e_¡©e
 *
s
;

2132 
æush
;

2134 
bæush
;

2138 ià(
s
->
lookah—d
 == 0) {

2139 
	`fžl_wšdow
(
s
);

2140 ià(
s
->
lookah—d
 == 0) {

2141 ià(
æush
 =ð
Z_NO_FLUSH
)

2142  
Ãed_mÜe
;

2148 
s
->
m©ch_Ëngth
 = 0;

2149 
	`T¿ûvv
((
¡d”r
,"%c", 
s
->
wšdow
[s->
¡r¡¬t
]));

2150 
	`_Œ_Îy_l™
 (
s
, s->
wšdow
[s->
¡r¡¬t
], 
bæush
);

2151 
s
->
lookah—d
--;

2152 
s
->
¡r¡¬t
++;

2153 ià(
bæush
è
	`FLUSH_BLOCK
(
s
, 0);

2155 
s
->
š£¹
 = 0;

2156 ià(
æush
 =ð
Z_FINISH
) {

2157 
	`FLUSH_BLOCK
(
s
, 1);

2158  
fšish_dÚe
;

2160 ià(
s
->
Ï¡_l™
)

2161 
	`FLUSH_BLOCK
(
s
, 0);

2162  
block_dÚe
;

2163 
	}
}

	@zlib/deflate.h

13 #iâdeà
DEFLATE_H


14 
	#DEFLATE_H


	)

16 
	~"zutž.h
"

22 #iâdeà
NO_GZIP


23 
	#GZIP


	)

30 
	#LENGTH_CODES
 29

	)

33 
	#LITERALS
 256

	)

36 
	#L_CODES
 (
LITERALS
+1+
LENGTH_CODES
)

	)

39 
	#D_CODES
 30

	)

42 
	#BL_CODES
 19

	)

45 
	#HEAP_SIZE
 (2*
L_CODES
+1)

	)

48 
	#MAX_BITS
 15

	)

51 
	#Buf_size
 16

	)

54 
	#INIT_STATE
 42

	)

55 #ifdeà
GZIP


56 
	#GZIP_STATE
 57

	)

58 
	#EXTRA_STATE
 69

	)

59 
	#NAME_STATE
 73

	)

60 
	#COMMENT_STATE
 91

	)

61 
	#HCRC_STATE
 103

	)

62 
	#BUSY_STATE
 113

	)

63 
	#FINISH_STATE
 666

	)

68 
	sù_d©a_s
 {

70 
ush
 
	mäeq
;

71 
ush
 
	mcode
;

72 } 
	mfc
;

74 
ush
 
	mdad
;

75 
ush
 
	mËn
;

76 } 
	mdl
;

77 } 
	tFAR
 
	tù_d©a
;

79 
	#F»q
 
fc
.
äeq


	)

80 
	#Code
 
fc
.
code


	)

81 
	#Dad
 
dl
.
dad


	)

82 
	#L’
 
dl
.
Ën


	)

84 
¡©ic_Œ“_desc_s
 
	t¡©ic_Œ“_desc
;

86 
	sŒ“_desc_s
 {

87 
ù_d©a
 *
	mdyn_Œ“
;

88 
	mmax_code
;

89 cÚ¡ 
¡©ic_Œ“_desc
 *
	m¡©_desc
;

90 } 
	tFAR
 
	tŒ“_desc
;

92 
ush
 
	tPos
;

93 
Pos
 
	tFAR
 
	tPosf
;

94 
	tIPos
;

100 
	sš‹º®_¡©e
 {

101 
z_¡»amp
 
	m¡rm
;

102 
	m¡©us
;

103 
By‹f
 *
	m³ndšg_buf
;

104 
ulg
 
	m³ndšg_buf_size
;

105 
By‹f
 *
	m³ndšg_out
;

106 
ulg
 
	m³ndšg
;

107 
	mw¿p
;

108 
gz_h—d”p
 
	mgzh—d
;

109 
ulg
 
	mgzšdex
;

110 
By‹
 
	mm‘hod
;

111 
	mÏ¡_æush
;

115 
uIÁ
 
	mw_size
;

116 
uIÁ
 
	mw_b™s
;

117 
uIÁ
 
	mw_mask
;

119 
By‹f
 *
	mwšdow
;

129 
ulg
 
	mwšdow_size
;

134 
Posf
 *
	m´ev
;

140 
Posf
 *
	mh—d
;

142 
uIÁ
 
	mšs_h
;

143 
uIÁ
 
	mhash_size
;

144 
uIÁ
 
	mhash_b™s
;

145 
uIÁ
 
	mhash_mask
;

147 
uIÁ
 
	mhash_shiá
;

154 
	mblock_¡¬t
;

159 
uIÁ
 
	mm©ch_Ëngth
;

160 
IPos
 
	m´ev_m©ch
;

161 
	mm©ch_avažabË
;

162 
uIÁ
 
	m¡r¡¬t
;

163 
uIÁ
 
	mm©ch_¡¬t
;

164 
uIÁ
 
	mlookah—d
;

166 
uIÁ
 
	m´ev_Ëngth
;

171 
uIÁ
 
	mmax_chaš_Ëngth
;

177 
uIÁ
 
	mmax_Ïzy_m©ch
;

182 
	#max_š£¹_Ëngth
 
max_Ïzy_m©ch


	)

188 
	mËv–
;

189 
	m¡¿‹gy
;

191 
uIÁ
 
	mgood_m©ch
;

194 
	mniû_m©ch
;

198 
ù_d©a_s
 
	mdyn_É»e
[
HEAP_SIZE
];

199 
ù_d©a_s
 
	mdyn_dŒ“
[2*
D_CODES
+1];

200 
ù_d©a_s
 
	mbl_Œ“
[2*
BL_CODES
+1];

202 
Œ“_desc_s
 
	ml_desc
;

203 
Œ“_desc_s
 
	md_desc
;

204 
Œ“_desc_s
 
	mbl_desc
;

206 
ush
 
	mbl_couÁ
[
MAX_BITS
+1];

209 
	mh—p
[2*
L_CODES
+1];

210 
	mh—p_Ën
;

211 
	mh—p_max
;

216 
uch
 
	md•th
[2*
L_CODES
+1];

220 
uchf
 *
	ml_buf
;

222 
uIÁ
 
	ml™_bufsize
;

242 
uIÁ
 
	mÏ¡_l™
;

244 
ushf
 *
	md_buf
;

250 
ulg
 
	mÝt_Ën
;

251 
ulg
 
	m¡©ic_Ën
;

252 
uIÁ
 
	mm©ches
;

253 
uIÁ
 
	mš£¹
;

255 #ifdeà
ZLIB_DEBUG


256 
ulg
 
	mcom´es£d_Ën
;

257 
ulg
 
	mb™s_£Á
;

260 
ush
 
	mbi_buf
;

264 
	mbi_v®id
;

269 
ulg
 
	mhigh_w©”
;

276 } 
	tFAR
 
	tdeæ©e_¡©e
;

281 
	#put_by‹
(
s
, 
c
è{s->
³ndšg_buf
[s->
³ndšg
++] = (
By‹f
)(c);}

	)

284 
	#MIN_LOOKAHEAD
 (
MAX_MATCH
+
MIN_MATCH
+1)

	)

289 
	#MAX_DIST
(
s
è((s)->
w_size
-
MIN_LOOKAHEAD
)

	)

294 
	#WIN_INIT
 
MAX_MATCH


	)

299 
ZLIB_INTERNAL
 
_Œ_š™
 
OF
((
deæ©e_¡©e
 *
s
));

300 
ZLIB_INTERNAL
 
_Œ_Îy
 
OF
((
deæ©e_¡©e
 *
s
, 
di¡
, 
lc
));

301 
ZLIB_INTERNAL
 
_Œ_æush_block
 
OF
((
deæ©e_¡©e
 *
s
, 
ch¬f
 *
buf
,

302 
ulg
 
¡Üed_Ën
, 
Ï¡
));

303 
ZLIB_INTERNAL
 
_Œ_æush_b™s
 
OF
((
deæ©e_¡©e
 *
s
));

304 
ZLIB_INTERNAL
 
_Œ_®ign
 
OF
((
deæ©e_¡©e
 *
s
));

305 
ZLIB_INTERNAL
 
_Œ_¡Üed_block
 
OF
((
deæ©e_¡©e
 *
s
, 
ch¬f
 *
buf
,

306 
ulg
 
¡Üed_Ën
, 
Ï¡
));

308 
	#d_code
(
di¡
) \

309 ((
di¡
è< 256 ? 
_di¡_code
[di¡] : _di¡_code[256+((di¡)>>7)])

	)

315 #iâdeà
ZLIB_DEBUG


318 #ià
defšed
(
GEN_TREES_H
è|| !defšed(
STDC
)

319 
uch
 
ZLIB_INTERNAL
 
_Ëngth_code
[];

320 
uch
 
ZLIB_INTERNAL
 
_di¡_code
[];

322 cÚ¡ 
uch
 
ZLIB_INTERNAL
 
_Ëngth_code
[];

323 cÚ¡ 
uch
 
ZLIB_INTERNAL
 
_di¡_code
[];

326 
	#_Œ_Îy_l™
(
s
, 
c
, 
æush
) \

327 { 
uch
 
cc
 = (
c
); \

328 
s
->
d_buf
[s->
Ï¡_l™
] = 0; \

329 
s
->
l_buf
[s->
Ï¡_l™
++] = 
cc
; \

330 
s
->
dyn_É»e
[
cc
].
F»q
++; \

331 
æush
 = (
s
->
Ï¡_l™
 =ðs->
l™_bufsize
-1); \

332 }

	)

333 
	#_Œ_Îy_di¡
(
s
, 
di¡ªû
, 
Ëngth
, 
æush
) \

334 { 
uch
 
Ën
 = (uch)(
Ëngth
); \

335 
ush
 
di¡
 = (ush)(
di¡ªû
); \

336 
s
->
d_buf
[s->
Ï¡_l™
] = 
di¡
; \

337 
s
->
l_buf
[s->
Ï¡_l™
++] = 
Ën
; \

338 
di¡
--; \

339 
s
->
dyn_É»e
[
_Ëngth_code
[
Ën
]+
LITERALS
+1].
F»q
++; \

340 
s
->
dyn_dŒ“
[
	`d_code
(
di¡
)].
F»q
++; \

341 
æush
 = (
s
->
Ï¡_l™
 =ðs->
l™_bufsize
-1); \

342 }

	)

344 
	#_Œ_Îy_l™
(
s
, 
c
, 
æush
èæush = 
	`_Œ_Îy
(s, 0, c)

	)

345 
	#_Œ_Îy_di¡
(
s
, 
di¡ªû
, 
Ëngth
, 
æush
) \

346 
æush
 = 
	`_Œ_Îy
(
s
, 
di¡ªû
, 
Ëngth
)

	)

	@zlib/example.c

8 
	~"zlib.h
"

9 
	~<¡dio.h
>

11 #ifdeà
STDC


12 
	~<¡ršg.h
>

13 
	~<¡dlib.h
>

16 #ià
defšed
(
VMS
è|| defšed(
RISCOS
)

17 
	#TESTFILE
 "foo-gz"

	)

19 
	#TESTFILE
 "foo.gz"

	)

22 
	#CHECK_ERR
(
”r
, 
msg
) { \

23 ià(
”r
 !ð
Z_OK
) { \

24 
	`årštf
(
¡d”r
, "% ”rÜ: %d\n", 
msg
, 
”r
); \

25 
	`ex™
(1); \

27 }

	)

29 cÚ¡ 
	gh–lo
[] = "hello, hello!";

34 cÚ¡ 
	gdiùiÚ¬y
[] = "hello";

35 
uLÚg
 
	gdiùId
;

37 
‹¡_com´ess
 
OF
((
By‹
 *
com´
, 
uLÚg
 
com´L’
,

38 
By‹
 *
uncom´
, 
uLÚg
 
uncom´L’
));

39 
‹¡_gzio
 
OF
((cÚ¡ *
âame
,

40 
By‹
 *
uncom´
, 
uLÚg
 
uncom´L’
));

41 
‹¡_deæ©e
 
OF
((
By‹
 *
com´
, 
uLÚg
 
com´L’
));

42 
‹¡_šæ©e
 
OF
((
By‹
 *
com´
, 
uLÚg
 
com´L’
,

43 
By‹
 *
uncom´
, 
uLÚg
 
uncom´L’
));

44 
‹¡_Ïrge_deæ©e
 
OF
((
By‹
 *
com´
, 
uLÚg
 
com´L’
,

45 
By‹
 *
uncom´
, 
uLÚg
 
uncom´L’
));

46 
‹¡_Ïrge_šæ©e
 
OF
((
By‹
 *
com´
, 
uLÚg
 
com´L’
,

47 
By‹
 *
uncom´
, 
uLÚg
 
uncom´L’
));

48 
‹¡_æush
 
OF
((
By‹
 *
com´
, 
uLÚg
 *
com´L’
));

49 
‹¡_sync
 
OF
((
By‹
 *
com´
, 
uLÚg
 
com´L’
,

50 
By‹
 *
uncom´
, 
uLÚg
 
uncom´L’
));

51 
‹¡_diù_deæ©e
 
OF
((
By‹
 *
com´
, 
uLÚg
 
com´L’
));

52 
‹¡_diù_šæ©e
 
OF
((
By‹
 *
com´
, 
uLÚg
 
com´L’
,

53 
By‹
 *
uncom´
, 
uLÚg
 
uncom´L’
));

54 
maš
 
OF
((
¬gc
, *
¬gv
[]));

59 
	$‹¡_com´ess
(
com´
, 
com´L’
, 
uncom´
, 
uncom´L’
)

60 
By‹
 *
com´
, *
uncom´
;

61 
uLÚg
 
com´L’
, 
uncom´L’
;

63 
”r
;

64 
uLÚg
 
Ën
 = (uLÚg)
	`¡¾’
(
h–lo
)+1;

66 
”r
 = 
	`com´ess
(
com´
, &
com´L’
, (cÚ¡ 
By‹f
*)
h–lo
, 
Ën
);

67 
	`CHECK_ERR
(
”r
, "compress");

69 
	`¡rýy
((*)
uncom´
, "garbage");

71 
”r
 = 
	`uncom´ess
(
uncom´
, &
uncom´L’
, 
com´
, 
com´L’
);

72 
	`CHECK_ERR
(
”r
, "uncompress");

74 ià(
	`¡rcmp
((*)
uncom´
, 
h–lo
)) {

75 
	`årštf
(
¡d”r
, "bad uncompress\n");

76 
	`ex™
(1);

78 
	`´štf
("uncom´ess(): %s\n", (*)
uncom´
);

80 
	}
}

85 
	$‹¡_gzio
(
âame
, 
uncom´
, 
uncom´L’
)

86 cÚ¡ *
âame
;

87 
By‹
 *
uncom´
;

88 
uLÚg
 
uncom´L’
;

90 #ifdeà
NO_GZCOMPRESS


91 
	`årštf
(
¡d”r
, "NO_GZCOMPRESS -- gz* functions cannot compress\n");

93 
”r
;

94 
Ën
 = ()
	`¡¾’
(
h–lo
)+1;

95 
gzFže
 
fže
;

96 
z_off_t
 
pos
;

98 
fže
 = 
	`gzÝ’
(
âame
, "wb");

99 ià(
fže
 =ð
NULL
) {

100 
	`årštf
(
¡d”r
, "gzopenƒrror\n");

101 
	`ex™
(1);

103 
	`gzputc
(
fže
, 'h');

104 ià(
	`gzputs
(
fže
, "ello") != 4) {

105 
	`årštf
(
¡d”r
, "gzput ”r: %s\n", 
	`gz”rÜ
(
fže
, &
”r
));

106 
	`ex™
(1);

108 ià(
	`gz´štf
(
fže
, ", %s!", "hello") != 8) {

109 
	`årštf
(
¡d”r
, "gz´štà”r: %s\n", 
	`gz”rÜ
(
fže
, &
”r
));

110 
	`ex™
(1);

112 
	`gz£ek
(
fže
, 1L, 
SEEK_CUR
);

113 
	`gzþo£
(
fže
);

115 
fže
 = 
	`gzÝ’
(
âame
, "rb");

116 ià(
fže
 =ð
NULL
) {

117 
	`årštf
(
¡d”r
, "gzopenƒrror\n");

118 
	`ex™
(1);

120 
	`¡rýy
((*)
uncom´
, "garbage");

122 ià(
	`gz»ad
(
fže
, 
uncom´
, ()
uncom´L’
è!ð
Ën
) {

123 
	`årštf
(
¡d”r
, "gz»adƒ¼: %s\n", 
	`gz”rÜ
(
fže
, &
”r
));

124 
	`ex™
(1);

126 ià(
	`¡rcmp
((*)
uncom´
, 
h–lo
)) {

127 
	`årštf
(
¡d”r
, "bad gz»ad: %s\n", (*)
uncom´
);

128 
	`ex™
(1);

130 
	`´štf
("gz»ad(): %s\n", (*)
uncom´
);

133 
pos
 = 
	`gz£ek
(
fže
, -8L, 
SEEK_CUR
);

134 ià(
pos
 !ð6 || 
	`gz‹Î
(
fže
) !=…os) {

135 
	`årštf
(
¡d”r
, "gzseekƒrror,…os=%ld, gztell=%ld\n",

136 ()
pos
, ()
	`gz‹Î
(
fže
));

137 
	`ex™
(1);

140 ià(
	`gzg‘c
(
fže
) != ' ') {

141 
	`årštf
(
¡d”r
, "gzgetcƒrror\n");

142 
	`ex™
(1);

145 ià(
	`gzung‘c
(' ', 
fže
) != ' ') {

146 
	`årštf
(
¡d”r
, "gzungetcƒrror\n");

147 
	`ex™
(1);

150 
	`gzg‘s
(
fže
, (*)
uncom´
, ()
uncom´L’
);

151 ià(
	`¡¾’
((*)
uncom´
) != 7) {

152 
	`årštf
(
¡d”r
, "gzg‘ ”¸aá” gz£ek: %s\n", 
	`gz”rÜ
(
fže
, &
”r
));

153 
	`ex™
(1);

155 ià(
	`¡rcmp
((*)
uncom´
, 
h–lo
 + 6)) {

156 
	`årštf
(
¡d”r
, "bad gzgets‡fter gzseek\n");

157 
	`ex™
(1);

159 
	`´štf
("gzg‘s(èaá” gz£ek: %s\n", (*)
uncom´
);

162 
	`gzþo£
(
fže
);

164 
	}
}

169 
	$‹¡_deæ©e
(
com´
, 
com´L’
)

170 
By‹
 *
com´
;

171 
uLÚg
 
com´L’
;

173 
z_¡»am
 
c_¡»am
;

174 
”r
;

175 
uLÚg
 
Ën
 = (uLÚg)
	`¡¾’
(
h–lo
)+1;

177 
c_¡»am
.
z®loc
 = (
®loc_func
)0;

178 
c_¡»am
.
zä“
 = (
ä“_func
)0;

179 
c_¡»am
.
Ýaque
 = (
voidpf
)0;

181 
”r
 = 
	`deæ©eIn™
(&
c_¡»am
, 
Z_DEFAULT_COMPRESSION
);

182 
	`CHECK_ERR
(
”r
, "deflateInit");

184 
c_¡»am
.
Ãxt_š
 = (
By‹f
*)
h–lo
;

185 
c_¡»am
.
Ãxt_out
 = 
com´
;

187 
c_¡»am
.
tÙ®_š
 !ð
Ën
 && c_¡»am.
tÙ®_out
 < 
com´L’
) {

188 
c_¡»am
.
avaž_š
 = c_¡»am.
avaž_out
 = 1;

189 
”r
 = 
	`deæ©e
(&
c_¡»am
, 
Z_NO_FLUSH
);

190 
	`CHECK_ERR
(
”r
, "deflate");

194 
c_¡»am
.
avaž_out
 = 1;

195 
”r
 = 
	`deæ©e
(&
c_¡»am
, 
Z_FINISH
);

196 ià(
”r
 =ð
Z_STREAM_END
) ;

197 
	`CHECK_ERR
(
”r
, "deflate");

200 
”r
 = 
	`deæ©eEnd
(&
c_¡»am
);

201 
	`CHECK_ERR
(
”r
, "deflateEnd");

202 
	}
}

207 
	$‹¡_šæ©e
(
com´
, 
com´L’
, 
uncom´
, 
uncom´L’
)

208 
By‹
 *
com´
, *
uncom´
;

209 
uLÚg
 
com´L’
, 
uncom´L’
;

211 
”r
;

212 
z_¡»am
 
d_¡»am
;

214 
	`¡rýy
((*)
uncom´
, "garbage");

216 
d_¡»am
.
z®loc
 = (
®loc_func
)0;

217 
d_¡»am
.
zä“
 = (
ä“_func
)0;

218 
d_¡»am
.
Ýaque
 = (
voidpf
)0;

220 
d_¡»am
.
Ãxt_š
 = 
com´
;

221 
d_¡»am
.
avaž_š
 = 0;

222 
d_¡»am
.
Ãxt_out
 = 
uncom´
;

224 
”r
 = 
	`šæ©eIn™
(&
d_¡»am
);

225 
	`CHECK_ERR
(
”r
, "inflateInit");

227 
d_¡»am
.
tÙ®_out
 < 
uncom´L’
 && d_¡»am.
tÙ®_š
 < 
com´L’
) {

228 
d_¡»am
.
avaž_š
 = d_¡»am.
avaž_out
 = 1;

229 
”r
 = 
	`šæ©e
(&
d_¡»am
, 
Z_NO_FLUSH
);

230 ià(
”r
 =ð
Z_STREAM_END
) ;

231 
	`CHECK_ERR
(
”r
, "inflate");

234 
”r
 = 
	`šæ©eEnd
(&
d_¡»am
);

235 
	`CHECK_ERR
(
”r
, "inflateEnd");

237 ià(
	`¡rcmp
((*)
uncom´
, 
h–lo
)) {

238 
	`årštf
(
¡d”r
, "bad inflate\n");

239 
	`ex™
(1);

241 
	`´štf
("šæ©e(): %s\n", (*)
uncom´
);

243 
	}
}

248 
	$‹¡_Ïrge_deæ©e
(
com´
, 
com´L’
, 
uncom´
, 
uncom´L’
)

249 
By‹
 *
com´
, *
uncom´
;

250 
uLÚg
 
com´L’
, 
uncom´L’
;

252 
z_¡»am
 
c_¡»am
;

253 
”r
;

255 
c_¡»am
.
z®loc
 = (
®loc_func
)0;

256 
c_¡»am
.
zä“
 = (
ä“_func
)0;

257 
c_¡»am
.
Ýaque
 = (
voidpf
)0;

259 
”r
 = 
	`deæ©eIn™
(&
c_¡»am
, 
Z_BEST_SPEED
);

260 
	`CHECK_ERR
(
”r
, "deflateInit");

262 
c_¡»am
.
Ãxt_out
 = 
com´
;

263 
c_¡»am
.
avaž_out
 = (
uIÁ
)
com´L’
;

268 
c_¡»am
.
Ãxt_š
 = 
uncom´
;

269 
c_¡»am
.
avaž_š
 = (
uIÁ
)
uncom´L’
;

270 
”r
 = 
	`deæ©e
(&
c_¡»am
, 
Z_NO_FLUSH
);

271 
	`CHECK_ERR
(
”r
, "deflate");

272 ià(
c_¡»am
.
avaž_š
 != 0) {

273 
	`årštf
(
¡d”r
, "deflate‚ot greedy\n");

274 
	`ex™
(1);

278 
	`deæ©eP¬ams
(&
c_¡»am
, 
Z_NO_COMPRESSION
, 
Z_DEFAULT_STRATEGY
);

279 
c_¡»am
.
Ãxt_š
 = 
com´
;

280 
c_¡»am
.
avaž_š
 = (
uIÁ
)
com´L’
/2;

281 
”r
 = 
	`deæ©e
(&
c_¡»am
, 
Z_NO_FLUSH
);

282 
	`CHECK_ERR
(
”r
, "deflate");

285 
	`deæ©eP¬ams
(&
c_¡»am
, 
Z_BEST_COMPRESSION
, 
Z_FILTERED
);

286 
c_¡»am
.
Ãxt_š
 = 
uncom´
;

287 
c_¡»am
.
avaž_š
 = (
uIÁ
)
uncom´L’
;

288 
”r
 = 
	`deæ©e
(&
c_¡»am
, 
Z_NO_FLUSH
);

289 
	`CHECK_ERR
(
”r
, "deflate");

291 
”r
 = 
	`deæ©e
(&
c_¡»am
, 
Z_FINISH
);

292 ià(
”r
 !ð
Z_STREAM_END
) {

293 
	`årštf
(
¡d”r
, "deflate should„eport Z_STREAM_END\n");

294 
	`ex™
(1);

296 
”r
 = 
	`deæ©eEnd
(&
c_¡»am
);

297 
	`CHECK_ERR
(
”r
, "deflateEnd");

298 
	}
}

303 
	$‹¡_Ïrge_šæ©e
(
com´
, 
com´L’
, 
uncom´
, 
uncom´L’
)

304 
By‹
 *
com´
, *
uncom´
;

305 
uLÚg
 
com´L’
, 
uncom´L’
;

307 
”r
;

308 
z_¡»am
 
d_¡»am
;

310 
	`¡rýy
((*)
uncom´
, "garbage");

312 
d_¡»am
.
z®loc
 = (
®loc_func
)0;

313 
d_¡»am
.
zä“
 = (
ä“_func
)0;

314 
d_¡»am
.
Ýaque
 = (
voidpf
)0;

316 
d_¡»am
.
Ãxt_š
 = 
com´
;

317 
d_¡»am
.
avaž_š
 = (
uIÁ
)
com´L’
;

319 
”r
 = 
	`šæ©eIn™
(&
d_¡»am
);

320 
	`CHECK_ERR
(
”r
, "inflateInit");

323 
d_¡»am
.
Ãxt_out
 = 
uncom´
;

324 
d_¡»am
.
avaž_out
 = (
uIÁ
)
uncom´L’
;

325 
”r
 = 
	`šæ©e
(&
d_¡»am
, 
Z_NO_FLUSH
);

326 ià(
”r
 =ð
Z_STREAM_END
) ;

327 
	`CHECK_ERR
(
”r
, "large inflate");

330 
”r
 = 
	`šæ©eEnd
(&
d_¡»am
);

331 
	`CHECK_ERR
(
”r
, "inflateEnd");

333 ià(
d_¡»am
.
tÙ®_out
 !ð2*
uncom´L’
 + 
com´L’
/2) {

334 
	`årštf
(
¡d”r
, "bad†¬gšæ©e: %ld\n", 
d_¡»am
.
tÙ®_out
);

335 
	`ex™
(1);

337 
	`´štf
("large_inflate(): OK\n");

339 
	}
}

344 
	$‹¡_æush
(
com´
, 
com´L’
)

345 
By‹
 *
com´
;

346 
uLÚg
 *
com´L’
;

348 
z_¡»am
 
c_¡»am
;

349 
”r
;

350 
uIÁ
 
Ën
 = (uIÁ)
	`¡¾’
(
h–lo
)+1;

352 
c_¡»am
.
z®loc
 = (
®loc_func
)0;

353 
c_¡»am
.
zä“
 = (
ä“_func
)0;

354 
c_¡»am
.
Ýaque
 = (
voidpf
)0;

356 
”r
 = 
	`deæ©eIn™
(&
c_¡»am
, 
Z_DEFAULT_COMPRESSION
);

357 
	`CHECK_ERR
(
”r
, "deflateInit");

359 
c_¡»am
.
Ãxt_š
 = (
By‹f
*)
h–lo
;

360 
c_¡»am
.
Ãxt_out
 = 
com´
;

361 
c_¡»am
.
avaž_š
 = 3;

362 
c_¡»am
.
avaž_out
 = (
uIÁ
)*
com´L’
;

363 
”r
 = 
	`deæ©e
(&
c_¡»am
, 
Z_FULL_FLUSH
);

364 
	`CHECK_ERR
(
”r
, "deflate");

366 
com´
[3]++;

367 
c_¡»am
.
avaž_š
 = 
Ën
 - 3;

369 
”r
 = 
	`deæ©e
(&
c_¡»am
, 
Z_FINISH
);

370 ià(
”r
 !ð
Z_STREAM_END
) {

371 
	`CHECK_ERR
(
”r
, "deflate");

373 
”r
 = 
	`deæ©eEnd
(&
c_¡»am
);

374 
	`CHECK_ERR
(
”r
, "deflateEnd");

376 *
com´L’
 = 
c_¡»am
.
tÙ®_out
;

377 
	}
}

382 
	$‹¡_sync
(
com´
, 
com´L’
, 
uncom´
, 
uncom´L’
)

383 
By‹
 *
com´
, *
uncom´
;

384 
uLÚg
 
com´L’
, 
uncom´L’
;

386 
”r
;

387 
z_¡»am
 
d_¡»am
;

389 
	`¡rýy
((*)
uncom´
, "garbage");

391 
d_¡»am
.
z®loc
 = (
®loc_func
)0;

392 
d_¡»am
.
zä“
 = (
ä“_func
)0;

393 
d_¡»am
.
Ýaque
 = (
voidpf
)0;

395 
d_¡»am
.
Ãxt_š
 = 
com´
;

396 
d_¡»am
.
avaž_š
 = 2;

398 
”r
 = 
	`šæ©eIn™
(&
d_¡»am
);

399 
	`CHECK_ERR
(
”r
, "inflateInit");

401 
d_¡»am
.
Ãxt_out
 = 
uncom´
;

402 
d_¡»am
.
avaž_out
 = (
uIÁ
)
uncom´L’
;

404 
	`šæ©e
(&
d_¡»am
, 
Z_NO_FLUSH
);

405 
	`CHECK_ERR
(
”r
, "inflate");

407 
d_¡»am
.
avaž_š
 = (
uIÁ
)
com´L’
-2;

408 
”r
 = 
	`šæ©eSync
(&
d_¡»am
);

409 
	`CHECK_ERR
(
”r
, "inflateSync");

411 
”r
 = 
	`šæ©e
(&
d_¡»am
, 
Z_FINISH
);

412 ià(
”r
 !ð
Z_DATA_ERROR
) {

413 
	`årštf
(
¡d”r
, "inflate should„eport DATA_ERROR\n");

415 
	`ex™
(1);

417 
”r
 = 
	`šæ©eEnd
(&
d_¡»am
);

418 
	`CHECK_ERR
(
”r
, "inflateEnd");

420 
	`´štf
("aá” inæ©eSync(): h–%s\n", (*)
uncom´
);

421 
	}
}

426 
	$‹¡_diù_deæ©e
(
com´
, 
com´L’
)

427 
By‹
 *
com´
;

428 
uLÚg
 
com´L’
;

430 
z_¡»am
 
c_¡»am
;

431 
”r
;

433 
c_¡»am
.
z®loc
 = (
®loc_func
)0;

434 
c_¡»am
.
zä“
 = (
ä“_func
)0;

435 
c_¡»am
.
Ýaque
 = (
voidpf
)0;

437 
”r
 = 
	`deæ©eIn™
(&
c_¡»am
, 
Z_BEST_COMPRESSION
);

438 
	`CHECK_ERR
(
”r
, "deflateInit");

440 
”r
 = 
	`deæ©eS‘DiùiÚ¬y
(&
c_¡»am
,

441 (cÚ¡ 
By‹f
*)
diùiÚ¬y
, (dictionary));

442 
	`CHECK_ERR
(
”r
, "deflateSetDictionary");

444 
diùId
 = 
c_¡»am
.
adËr
;

445 
c_¡»am
.
Ãxt_out
 = 
com´
;

446 
c_¡»am
.
avaž_out
 = (
uIÁ
)
com´L’
;

448 
c_¡»am
.
Ãxt_š
 = (
By‹f
*)
h–lo
;

449 
c_¡»am
.
avaž_š
 = (
uIÁ
)
	`¡¾’
(
h–lo
)+1;

451 
”r
 = 
	`deæ©e
(&
c_¡»am
, 
Z_FINISH
);

452 ià(
”r
 !ð
Z_STREAM_END
) {

453 
	`årštf
(
¡d”r
, "deflate should„eport Z_STREAM_END\n");

454 
	`ex™
(1);

456 
”r
 = 
	`deæ©eEnd
(&
c_¡»am
);

457 
	`CHECK_ERR
(
”r
, "deflateEnd");

458 
	}
}

463 
	$‹¡_diù_šæ©e
(
com´
, 
com´L’
, 
uncom´
, 
uncom´L’
)

464 
By‹
 *
com´
, *
uncom´
;

465 
uLÚg
 
com´L’
, 
uncom´L’
;

467 
”r
;

468 
z_¡»am
 
d_¡»am
;

470 
	`¡rýy
((*)
uncom´
, "garbage");

472 
d_¡»am
.
z®loc
 = (
®loc_func
)0;

473 
d_¡»am
.
zä“
 = (
ä“_func
)0;

474 
d_¡»am
.
Ýaque
 = (
voidpf
)0;

476 
d_¡»am
.
Ãxt_š
 = 
com´
;

477 
d_¡»am
.
avaž_š
 = (
uIÁ
)
com´L’
;

479 
”r
 = 
	`šæ©eIn™
(&
d_¡»am
);

480 
	`CHECK_ERR
(
”r
, "inflateInit");

482 
d_¡»am
.
Ãxt_out
 = 
uncom´
;

483 
d_¡»am
.
avaž_out
 = (
uIÁ
)
uncom´L’
;

486 
”r
 = 
	`šæ©e
(&
d_¡»am
, 
Z_NO_FLUSH
);

487 ià(
”r
 =ð
Z_STREAM_END
) ;

488 ià(
”r
 =ð
Z_NEED_DICT
) {

489 ià(
d_¡»am
.
adËr
 !ð
diùId
) {

490 
	`årštf
(
¡d”r
, "unexpected dictionary");

491 
	`ex™
(1);

493 
”r
 = 
	`šæ©eS‘DiùiÚ¬y
(&
d_¡»am
, (cÚ¡ 
By‹f
*)
diùiÚ¬y
,

494 (
diùiÚ¬y
));

496 
	`CHECK_ERR
(
”r
, "inflate with dict");

499 
”r
 = 
	`šæ©eEnd
(&
d_¡»am
);

500 
	`CHECK_ERR
(
”r
, "inflateEnd");

502 ià(
	`¡rcmp
((*)
uncom´
, 
h–lo
)) {

503 
	`årštf
(
¡d”r
, "bad inflate with dict\n");

504 
	`ex™
(1);

506 
	`´štf
("šæ©w™h diùiÚ¬y: %s\n", (*)
uncom´
);

508 
	}
}

514 
	$maš
(
¬gc
, 
¬gv
)

515 
¬gc
;

516 *
¬gv
[];

518 
By‹
 *
com´
, *
uncom´
;

519 
uLÚg
 
com´L’
 = 10000*();

520 
uLÚg
 
uncom´L’
 = 
com´L’
;

521 cÚ¡ * 
myV”siÚ
 = 
ZLIB_VERSION
;

523 ià(
	`zlibV”siÚ
()[0] !ð
myV”siÚ
[0]) {

524 
	`årštf
(
¡d”r
, "incompatible zlib version\n");

525 
	`ex™
(1);

527 } ià(
	`¡rcmp
(
	`zlibV”siÚ
(), 
ZLIB_VERSION
) != 0) {

528 
	`årštf
(
¡d”r
, "warning: different zlib version\n");

531 
	`´štf
("zlib version %s = 0x%04x, compile flags = 0x%lx\n",

532 
ZLIB_VERSION
, 
ZLIB_VERNUM
, 
	`zlibCompžeFÏgs
());

534 
com´
 = (
By‹
*)
	`ÿÎoc
((
uIÁ
)
com´L’
, 1);

535 
uncom´
 = (
By‹
*)
	`ÿÎoc
((
uIÁ
)
uncom´L’
, 1);

539 ià(
com´
 =ð
Z_NULL
 || 
uncom´
 == Z_NULL) {

540 
	`´štf
("out of memory\n");

541 
	`ex™
(1);

543 
	`‹¡_com´ess
(
com´
, 
com´L’
, 
uncom´
, 
uncom´L’
);

545 
	`‹¡_gzio
((
¬gc
 > 1 ? 
¬gv
[1] : 
TESTFILE
),

546 
uncom´
, 
uncom´L’
);

548 
	`‹¡_deæ©e
(
com´
, 
com´L’
);

549 
	`‹¡_šæ©e
(
com´
, 
com´L’
, 
uncom´
, 
uncom´L’
);

551 
	`‹¡_Ïrge_deæ©e
(
com´
, 
com´L’
, 
uncom´
, 
uncom´L’
);

552 
	`‹¡_Ïrge_šæ©e
(
com´
, 
com´L’
, 
uncom´
, 
uncom´L’
);

554 
	`‹¡_æush
(
com´
, &
com´L’
);

555 
	`‹¡_sync
(
com´
, 
com´L’
, 
uncom´
, 
uncom´L’
);

556 
com´L’
 = 
uncom´L’
;

558 
	`‹¡_diù_deæ©e
(
com´
, 
com´L’
);

559 
	`‹¡_diù_šæ©e
(
com´
, 
com´L’
, 
uncom´
, 
uncom´L’
);

561 
	`ä“
(
com´
);

562 
	`ä“
(
uncom´
);

565 
	}
}

	@zlib/gzclose.c

6 
	~"gzguts.h
"

11 
ZEXPORT
 
	$gzþo£
(
fže
)

12 
gzFže
 
fže
;

14 #iâdeà
NO_GZCOMPRESS


15 
gz_¡©•
 
¡©e
;

17 ià(
fže
 =ð
NULL
)

18  
Z_STREAM_ERROR
;

19 
¡©e
 = (
gz_¡©•
)
fže
;

21  
¡©e
->
mode
 =ð
GZ_READ
 ? 
	`gzþo£_r
(
fže
è: 
	`gzþo£_w
(file);

23  
	`gzþo£_r
(
fže
);

25 
	}
}

	@zlib/gzguts.h

6 #ifdeà
_LARGEFILE64_SOURCE


7 #iâdeà
_LARGEFILE_SOURCE


8 
	#_LARGEFILE_SOURCE
 1

	)

10 #ifdeà
_FILE_OFFSET_BITS


11 #undeà
_FILE_OFFSET_BITS


15 #ifdeà
HAVE_HIDDEN


16 
	#ZLIB_INTERNAL
 
	`__©Œibu‹__
((
	`visibž™y
 ("hidd’")))

	)

18 
	#ZLIB_INTERNAL


	)

21 
	~<¡dio.h
>

22 
	~"zlib.h
"

23 #ifdeà
STDC


24 
	~<¡ršg.h
>

25 
	~<¡dlib.h
>

26 
	~<lim™s.h
>

29 #iâdeà
_POSIX_SOURCE


30 
	#_POSIX_SOURCE


	)

32 
	~<fúŽ.h
>

34 #ifdeà
_WIN32


35 
	~<¡ddef.h
>

38 #ià
defšed
(
__TURBOC__
è|| defšed(
_MSC_VER
è|| defšed(
_WIN32
)

39 
	~<io.h
>

42 #ià
defšed
(
_WIN32
è|| defšed(
__CYGWIN__
)

43 
	#WIDECHAR


	)

46 #ifdeà
WINAPI_FAMILY


47 
	#Ý’
 
_Ý’


	)

48 
	#»ad
 
_»ad


	)

49 
	#wr™e
 
_wr™e


	)

50 
	#þo£
 
_þo£


	)

53 #ifdeà
NO_DEFLATE


54 
	#NO_GZCOMPRESS


	)

57 #ià
defšed
(
STDC99
è|| (defšed(
__TURBOC__
) && __TURBOC__ >= 0x550)

58 #iâdeà
HAVE_VSNPRINTF


59 
	#HAVE_VSNPRINTF


	)

63 #ià
defšed
(
__CYGWIN__
)

64 #iâdeà
HAVE_VSNPRINTF


65 
	#HAVE_VSNPRINTF


	)

69 #ià
defšed
(
MSDOS
è&& defšed(
__BORLANDC__
è&& (
BORLANDC
 > 0x410)

70 #iâdeà
HAVE_VSNPRINTF


71 
	#HAVE_VSNPRINTF


	)

75 #iâdeà
HAVE_VSNPRINTF


76 #ifdeà
MSDOS


79 
	#NO_v¢´štf


	)

81 #ifdeà
__TURBOC__


82 
	#NO_v¢´štf


	)

84 #ifdeà
WIN32


86 #ià!
defšed
(
v¢´štf
è&& !defšed(
NO_v¢´štf
)

87 #ià!
defšed
(
_MSC_VER
) || ( defined(_MSC_VER) && _MSC_VER < 1500 )

88 
	#v¢´štf
 
_v¢´štf


	)

92 #ifdeà
__SASC


93 
	#NO_v¢´štf


	)

95 #ifdeà
VMS


96 
	#NO_v¢´štf


	)

98 #ifdeà
__OS400__


99 
	#NO_v¢´štf


	)

101 #ifdeà
__MVS__


102 
	#NO_v¢´štf


	)

109 #ià
defšed
(
_MSC_VER
) && _MSC_VER < 1900

110 
	#¢´štf
 
_¢´štf


	)

113 #iâdeà
loÿl


114 
	#loÿl
 

	)

121 #iâdeà
STDC


122 
voidp
 
m®loc
 
OF
((
uIÁ
 
size
));

123 
ä“
 
OF
((
voidpf
 
±r
));

127 #ià
defšed
 
UNDER_CE


128 
	~<wšdows.h
>

129 
	#z¡»¼Ü
(è
	`gz_¡rwš”rÜ
((
DWORD
)
	`G‘La¡E¼Ü
())

	)

131 #iâdeà
NO_STRERROR


132 
	~<”ºo.h
>

133 
	#z¡»¼Ü
(è
	`¡»¼Ü
(
”ºo
)

	)

135 
	#z¡»¼Ü
(è"¡diØ”rÜ (cÚsuÉƒ¼no)"

	)

140 #ià!
defšed
(
_LARGEFILE64_SOURCE
è|| 
_LFS64_LARGEFILE
-0 == 0

141 
ZEXTERN
 
gzFže
 
ZEXPORT
 
gzÝ’64
 
OF
((const *, const *));

142 
ZEXTERN
 
z_off64_t
 
ZEXPORT
 
gz£ek64
 
OF
((
gzFže
, z_off64_t, ));

143 
ZEXTERN
 
z_off64_t
 
ZEXPORT
 
gz‹Î64
 
OF
((
gzFže
));

144 
ZEXTERN
 
z_off64_t
 
ZEXPORT
 
gzoff£t64
 
OF
((
gzFže
));

148 #ià
MAX_MEM_LEVEL
 >= 8

149 
	#DEF_MEM_LEVEL
 8

	)

151 
	#DEF_MEM_LEVEL
 
MAX_MEM_LEVEL


	)

156 
	#GZBUFSIZE
 8192

	)

159 
	#GZ_NONE
 0

	)

160 
	#GZ_READ
 7247

	)

161 
	#GZ_WRITE
 31153

	)

162 
	#GZ_APPEND
 1

	)

165 
	#LOOK
 0

	)

166 
	#COPY
 1

	)

167 
	#GZIP
 2

	)

172 
gzFže_s
 
	mx
;

177 
	mmode
;

178 
	mfd
;

179 *
	m·th
;

180 
	msize
;

181 
	mwªt
;

182 *
	mš
;

183 *
	mout
;

184 
	mdœeù
;

186 
	mhow
;

187 
z_off64_t
 
	m¡¬t
;

188 
	meof
;

189 
	m·¡
;

191 
	mËv–
;

192 
	m¡¿‹gy
;

194 
z_off64_t
 
	msk
;

195 
	m£ek
;

197 
	m”r
;

198 *
	mmsg
;

200 
z_¡»am
 
	m¡rm
;

201 } 
	tgz_¡©e
;

202 
gz_¡©e
 
	tFAR
 *
	tgz_¡©•
;

205 
ZLIB_INTERNAL
 
gz_”rÜ
 
OF
((
gz_¡©•
, , const *));

206 #ià
defšed
 
UNDER_CE


207 
ZLIB_INTERNAL
 *
gz_¡rwš”rÜ
 
OF
((
DWORD
 
”rÜ
));

213 #ifdeà
INT_MAX


214 
	#GT_OFF
(
x
è((è=ð(
z_off64_t
è&& (xè> 
INT_MAX
)

	)

216 
ZLIB_INTERNAL
 
gz_štmax
 
OF
(());

217 
	#GT_OFF
(
x
è((è=ð(
z_off64_t
è&& (xè> 
	`gz_štmax
())

	)

	@zlib/gzlib.c

6 
	~"gzguts.h
"

8 #ià
defšed
(
_WIN32
è&& !defšed(
__BORLANDC__
è&& !defšed(
__MINGW32__
)

9 
	#LSEEK
 
_l£eki64


	)

11 #ià
defšed
(
_LARGEFILE64_SOURCE
è&& 
_LFS64_LARGEFILE
-0

12 
	#LSEEK
 
l£ek64


	)

14 
	#LSEEK
 
l£ek


	)

19 
loÿl
 
gz_»£t
 
OF
((
gz_¡©•
));

20 
loÿl
 
gzFže
 
gz_Ý’
 
OF
((const *, , const *));

22 #ià
defšed
 
UNDER_CE


33 
ZLIB_INTERNAL
 *
	$gz_¡rwš”rÜ
 (
”rÜ
)

34 
DWORD
 
”rÜ
;

36 
buf
[1024];

38 
wch¬_t
 *
msgbuf
;

39 
DWORD
 
Ï¡”r
 = 
	`G‘La¡E¼Ü
();

40 
DWORD
 
ch¬s
 = 
	`FÜm©Mes§ge
(
FORMAT_MESSAGE_FROM_SYSTEM


41 | 
FORMAT_MESSAGE_ALLOCATE_BUFFER
,

42 
NULL
,

43 
”rÜ
,

45 (
LPVOID
)&
msgbuf
,

47 
NULL
);

48 ià(
ch¬s
 != 0) {

50 ià(
ch¬s
 >= 2

51 && 
msgbuf
[
ch¬s
 - 2] == '\r' && msgbuf[chars - 1] == '\n') {

52 
ch¬s
 -= 2;

53 
msgbuf
[
ch¬s
] = 0;

56 ià(
ch¬s
 >  (
buf
) - 1) {

57 
ch¬s
 =  (
buf
) - 1;

58 
msgbuf
[
ch¬s
] = 0;

61 
	`wc¡ombs
(
buf
, 
msgbuf
, 
ch¬s
 + 1);

62 
	`LoÿlF»e
(
msgbuf
);

65 
	`¥rštf
(
buf
, "unknowÀwš32ƒ¼Ü (%ld)", 
”rÜ
);

68 
	`S‘La¡E¼Ü
(
Ï¡”r
);

69  
buf
;

70 
	}
}

75 
loÿl
 
	$gz_»£t
(
¡©e
)

76 
gz_¡©•
 
¡©e
;

78 
¡©e
->
x
.
have
 = 0;

79 ià(
¡©e
->
mode
 =ð
GZ_READ
) {

80 
¡©e
->
eof
 = 0;

81 
¡©e
->
·¡
 = 0;

82 
¡©e
->
how
 = 
LOOK
;

84 
¡©e
->
£ek
 = 0;

85 
	`gz_”rÜ
(
¡©e
, 
Z_OK
, 
NULL
);

86 
¡©e
->
x
.
pos
 = 0;

87 
¡©e
->
¡rm
.
avaž_š
 = 0;

88 
	}
}

91 
loÿl
 
gzFže
 
	$gz_Ý’
(
·th
, 
fd
, 
mode
)

92 cÚ¡ *
·th
;

93 
fd
;

94 cÚ¡ *
mode
;

96 
gz_¡©•
 
¡©e
;

97 
z_size_t
 
Ën
;

98 
oæag
;

99 #ifdeà
O_CLOEXEC


100 
þÛxec
 = 0;

102 #ifdeà
O_EXCL


103 
exþusive
 = 0;

107 ià(
·th
 =ð
NULL
)

108  
NULL
;

111 
¡©e
 = (
gz_¡©•
)
	`m®loc
((
gz_¡©e
));

112 ià(
¡©e
 =ð
NULL
)

113  
NULL
;

114 
¡©e
->
size
 = 0;

115 
¡©e
->
wªt
 = 
GZBUFSIZE
;

116 
¡©e
->
msg
 = 
NULL
;

119 
¡©e
->
mode
 = 
GZ_NONE
;

120 
¡©e
->
Ëv–
 = 
Z_DEFAULT_COMPRESSION
;

121 
¡©e
->
¡¿‹gy
 = 
Z_DEFAULT_STRATEGY
;

122 
¡©e
->
dœeù
 = 0;

123 *
mode
) {

124 ià(*
mode
 >= '0' && *mode <= '9')

125 
¡©e
->
Ëv–
 = *
mode
 - '0';

127 *
mode
) {

129 
¡©e
->
mode
 = 
GZ_READ
;

131 #iâdeà
NO_GZCOMPRESS


133 
¡©e
->
mode
 = 
GZ_WRITE
;

136 
¡©e
->
mode
 = 
GZ_APPEND
;

140 
	`ä“
(
¡©e
);

141  
NULL
;

144 #ifdeà
O_CLOEXEC


146 
þÛxec
 = 1;

149 #ifdeà
O_EXCL


151 
exþusive
 = 1;

155 
¡©e
->
¡¿‹gy
 = 
Z_FILTERED
;

158 
¡©e
->
¡¿‹gy
 = 
Z_HUFFMAN_ONLY
;

161 
¡©e
->
¡¿‹gy
 = 
Z_RLE
;

164 
¡©e
->
¡¿‹gy
 = 
Z_FIXED
;

167 
¡©e
->
dœeù
 = 1;

172 
mode
++;

176 ià(
¡©e
->
mode
 =ð
GZ_NONE
) {

177 
	`ä“
(
¡©e
);

178  
NULL
;

182 ià(
¡©e
->
mode
 =ð
GZ_READ
) {

183 ià(
¡©e
->
dœeù
) {

184 
	`ä“
(
¡©e
);

185  
NULL
;

187 
¡©e
->
dœeù
 = 1;

191 #ifdeà
WIDECHAR


192 ià(
fd
 == -2) {

193 
Ën
 = 
	`wc¡ombs
(
NULL
, 
·th
, 0);

194 ià(
Ën
 =ð(
z_size_t
)-1)

195 
Ën
 = 0;

199 
Ën
 = 
	`¡¾’
((cÚ¡ *)
·th
);

200 
¡©e
->
·th
 = (*)
	`m®loc
(
Ën
 + 1);

201 ià(
¡©e
->
·th
 =ð
NULL
) {

202 
	`ä“
(
¡©e
);

203  
NULL
;

205 #ifdeà
WIDECHAR


206 ià(
fd
 == -2)

207 ià(
Ën
)

208 
	`wc¡ombs
(
¡©e
->
·th
,…©h, 
Ën
 + 1);

210 *(
¡©e
->
·th
) = 0;

213 #ià!
	`defšed
(
NO_¢´štf
è&& !defšed(
NO_v¢´štf
)

214 ()
	`¢´štf
(
¡©e
->
·th
, 
Ën
 + 1, "%s", (const *)path);

216 
	`¡rýy
(
¡©e
->
·th
,…ath);

220 
oæag
 =

221 #ifdeà
O_LARGEFILE


222 
O_LARGEFILE
 |

224 #ifdeà
O_BINARY


225 
O_BINARY
 |

227 #ifdeà
O_CLOEXEC


228 (
þÛxec
 ? 
O_CLOEXEC
 : 0) |

230 (
¡©e
->
mode
 =ð
GZ_READ
 ?

231 
O_RDONLY
 :

232 (
O_WRONLY
 | 
O_CREAT
 |

233 #ifdeà
O_EXCL


234 (
exþusive
 ? 
O_EXCL
 : 0) |

236 (
¡©e
->
mode
 =ð
GZ_WRITE
 ?

237 
O_TRUNC
 :

238 
O_APPEND
)));

241 
¡©e
->
fd
 = fd > -1 ? fd : (

242 #ifdeà
WIDECHAR


243 
fd
 =ð-2 ? 
	`_wÝ’
(
·th
, 
oæag
, 0666) :

245 
	`Ý’
((cÚ¡ *)
·th
, 
oæag
, 0666));

246 ià(
¡©e
->
fd
 == -1) {

247 
	`ä“
(
¡©e
->
·th
);

248 
	`ä“
(
¡©e
);

249  
NULL
;

251 ià(
¡©e
->
mode
 =ð
GZ_APPEND
) {

252 
	`LSEEK
(
¡©e
->
fd
, 0, 
SEEK_END
);

253 
¡©e
->
mode
 = 
GZ_WRITE
;

257 ià(
¡©e
->
mode
 =ð
GZ_READ
) {

258 
¡©e
->
¡¬t
 = 
	`LSEEK
(¡©e->
fd
, 0, 
SEEK_CUR
);

259 ià(
¡©e
->
¡¬t
 == -1) state->start = 0;

263 
	`gz_»£t
(
¡©e
);

266  (
gzFže
)
¡©e
;

267 
	}
}

270 
gzFže
 
ZEXPORT
 
	$gzÝ’
(
·th
, 
mode
)

271 cÚ¡ *
·th
;

272 cÚ¡ *
mode
;

274  
	`gz_Ý’
(
·th
, -1, 
mode
);

275 
	}
}

278 
gzFže
 
ZEXPORT
 
	$gzÝ’64
(
·th
, 
mode
)

279 cÚ¡ *
·th
;

280 cÚ¡ *
mode
;

282  
	`gz_Ý’
(
·th
, -1, 
mode
);

283 
	}
}

286 
gzFže
 
ZEXPORT
 
	$gzdÝ’
(
fd
, 
mode
)

287 
fd
;

288 cÚ¡ *
mode
;

290 *
·th
;

291 
gzFže
 
gz
;

293 ià(
fd
 =ð-1 || (
·th
 = (*)
	`m®loc
(7 + 3 * ())è=ð
NULL
)

294  
NULL
;

295 #ià!
	`defšed
(
NO_¢´štf
è&& !defšed(
NO_v¢´štf
)

296 ()
	`¢´štf
(
·th
, 7 + 3 * (), "<fd:%d>", 
fd
);

298 
	`¥rštf
(
·th
, "<fd:%d>", 
fd
);

300 
gz
 = 
	`gz_Ý’
(
·th
, 
fd
, 
mode
);

301 
	`ä“
(
·th
);

302  
gz
;

303 
	}
}

306 #ifdeà
WIDECHAR


307 
gzFže
 
ZEXPORT
 
	$gzÝ’_w
(
·th
, 
mode
)

308 cÚ¡ 
wch¬_t
 *
·th
;

309 cÚ¡ *
mode
;

311  
	`gz_Ý’
(
·th
, -2, 
mode
);

312 
	}
}

316 
ZEXPORT
 
	$gzbufãr
(
fže
, 
size
)

317 
gzFže
 
fže
;

318 
size
;

320 
gz_¡©•
 
¡©e
;

323 ià(
fže
 =ð
NULL
)

325 
¡©e
 = (
gz_¡©•
)
fže
;

326 ià(
¡©e
->
mode
 !ð
GZ_READ
 && s‹->mod!ð
GZ_WRITE
)

330 ià(
¡©e
->
size
 != 0)

334 ià((
size
 << 1) < size)

336 ià(
size
 < 2)

337 
size
 = 2;

338 
¡©e
->
wªt
 = 
size
;

340 
	}
}

343 
ZEXPORT
 
	$gz»wšd
(
fže
)

344 
gzFže
 
fže
;

346 
gz_¡©•
 
¡©e
;

349 ià(
fže
 =ð
NULL
)

351 
¡©e
 = (
gz_¡©•
)
fže
;

354 ià(
¡©e
->
mode
 !ð
GZ_READ
 ||

355 (
¡©e
->
”r
 !ð
Z_OK
 && s‹->”¸!ð
Z_BUF_ERROR
))

359 ià(
	`LSEEK
(
¡©e
->
fd
, s‹->
¡¬t
, 
SEEK_SET
) == -1)

361 
	`gz_»£t
(
¡©e
);

363 
	}
}

366 
z_off64_t
 
ZEXPORT
 
	$gz£ek64
(
fže
, 
off£t
, 
wh’û
)

367 
gzFže
 
fže
;

368 
z_off64_t
 
off£t
;

369 
wh’û
;

371 
n
;

372 
z_off64_t
 
»t
;

373 
gz_¡©•
 
¡©e
;

376 ià(
fže
 =ð
NULL
)

378 
¡©e
 = (
gz_¡©•
)
fže
;

379 ià(
¡©e
->
mode
 !ð
GZ_READ
 && s‹->mod!ð
GZ_WRITE
)

383 ià(
¡©e
->
”r
 !ð
Z_OK
 && s‹->”¸!ð
Z_BUF_ERROR
)

387 ià(
wh’û
 !ð
SEEK_SET
 && wh’û !ð
SEEK_CUR
)

391 ià(
wh’û
 =ð
SEEK_SET
)

392 
off£t
 -ð
¡©e
->
x
.
pos
;

393 ià(
¡©e
->
£ek
)

394 
off£t
 +ð
¡©e
->
sk
;

395 
¡©e
->
£ek
 = 0;

398 ià(
¡©e
->
mode
 =ð
GZ_READ
 && s‹->
how
 =ð
COPY
 &&

399 
¡©e
->
x
.
pos
 + 
off£t
 >= 0) {

400 
»t
 = 
	`LSEEK
(
¡©e
->
fd
, 
off£t
 - s‹->
x
.
have
, 
SEEK_CUR
);

401 ià(
»t
 == -1)

403 
¡©e
->
x
.
have
 = 0;

404 
¡©e
->
eof
 = 0;

405 
¡©e
->
·¡
 = 0;

406 
¡©e
->
£ek
 = 0;

407 
	`gz_”rÜ
(
¡©e
, 
Z_OK
, 
NULL
);

408 
¡©e
->
¡rm
.
avaž_š
 = 0;

409 
¡©e
->
x
.
pos
 +ð
off£t
;

410  
¡©e
->
x
.
pos
;

414 ià(
off£t
 < 0) {

415 ià(
¡©e
->
mode
 !ð
GZ_READ
)

417 
off£t
 +ð
¡©e
->
x
.
pos
;

418 ià(
off£t
 < 0)

420 ià(
	`gz»wšd
(
fže
) == -1)

425 ià(
¡©e
->
mode
 =ð
GZ_READ
) {

426 
n
 = 
	`GT_OFF
(
¡©e
->
x
.
have
è|| (
z_off64_t
)¡©e->x.hav> 
off£t
 ?

427 ()
off£t
 : 
¡©e
->
x
.
have
;

428 
¡©e
->
x
.
have
 -ð
n
;

429 
¡©e
->
x
.
Ãxt
 +ð
n
;

430 
¡©e
->
x
.
pos
 +ð
n
;

431 
off£t
 -ð
n
;

435 ià(
off£t
) {

436 
¡©e
->
£ek
 = 1;

437 
¡©e
->
sk
 = 
off£t
;

439  
¡©e
->
x
.
pos
 + 
off£t
;

440 
	}
}

443 
z_off_t
 
ZEXPORT
 
	$gz£ek
(
fže
, 
off£t
, 
wh’û
)

444 
gzFže
 
fže
;

445 
z_off_t
 
off£t
;

446 
wh’û
;

448 
z_off64_t
 
»t
;

450 
»t
 = 
	`gz£ek64
(
fže
, (
z_off64_t
)
off£t
, 
wh’û
);

451  
»t
 =ð(
z_off_t
)ret ? (z_off_t)ret : -1;

452 
	}
}

455 
z_off64_t
 
ZEXPORT
 
	$gz‹Î64
(
fže
)

456 
gzFže
 
fže
;

458 
gz_¡©•
 
¡©e
;

461 ià(
fže
 =ð
NULL
)

463 
¡©e
 = (
gz_¡©•
)
fže
;

464 ià(
¡©e
->
mode
 !ð
GZ_READ
 && s‹->mod!ð
GZ_WRITE
)

468  
¡©e
->
x
.
pos
 + (¡©e->
£ek
 ? s‹->
sk
 : 0);

469 
	}
}

472 
z_off_t
 
ZEXPORT
 
	$gz‹Î
(
fže
)

473 
gzFže
 
fže
;

475 
z_off64_t
 
»t
;

477 
»t
 = 
	`gz‹Î64
(
fže
);

478  
»t
 =ð(
z_off_t
)ret ? (z_off_t)ret : -1;

479 
	}
}

482 
z_off64_t
 
ZEXPORT
 
	$gzoff£t64
(
fže
)

483 
gzFže
 
fže
;

485 
z_off64_t
 
off£t
;

486 
gz_¡©•
 
¡©e
;

489 ià(
fže
 =ð
NULL
)

491 
¡©e
 = (
gz_¡©•
)
fže
;

492 ià(
¡©e
->
mode
 !ð
GZ_READ
 && s‹->mod!ð
GZ_WRITE
)

496 
off£t
 = 
	`LSEEK
(
¡©e
->
fd
, 0, 
SEEK_CUR
);

497 ià(
off£t
 == -1)

499 ià(
¡©e
->
mode
 =ð
GZ_READ
)

500 
off£t
 -ð
¡©e
->
¡rm
.
avaž_š
;

501  
off£t
;

502 
	}
}

505 
z_off_t
 
ZEXPORT
 
	$gzoff£t
(
fže
)

506 
gzFže
 
fže
;

508 
z_off64_t
 
»t
;

510 
»t
 = 
	`gzoff£t64
(
fže
);

511  
»t
 =ð(
z_off_t
)ret ? (z_off_t)ret : -1;

512 
	}
}

515 
ZEXPORT
 
	$gzeof
(
fže
)

516 
gzFže
 
fže
;

518 
gz_¡©•
 
¡©e
;

521 ià(
fže
 =ð
NULL
)

523 
¡©e
 = (
gz_¡©•
)
fže
;

524 ià(
¡©e
->
mode
 !ð
GZ_READ
 && s‹->mod!ð
GZ_WRITE
)

528  
¡©e
->
mode
 =ð
GZ_READ
 ? s‹->
·¡
 : 0;

529 
	}
}

532 cÚ¡ * 
ZEXPORT
 
	$gz”rÜ
(
fže
, 
”ºum
)

533 
gzFže
 
fže
;

534 *
”ºum
;

536 
gz_¡©•
 
¡©e
;

539 ià(
fže
 =ð
NULL
)

540  
NULL
;

541 
¡©e
 = (
gz_¡©•
)
fže
;

542 ià(
¡©e
->
mode
 !ð
GZ_READ
 && s‹->mod!ð
GZ_WRITE
)

543  
NULL
;

546 ià(
”ºum
 !ð
NULL
)

547 *
”ºum
 = 
¡©e
->
”r
;

548  
¡©e
->
”r
 =ð
Z_MEM_ERROR
 ? "out of memory" :

549 (
¡©e
->
msg
 =ð
NULL
 ? "" : state->msg);

550 
	}
}

553 
ZEXPORT
 
	$gzþ—»¼
(
fže
)

554 
gzFže
 
fže
;

556 
gz_¡©•
 
¡©e
;

559 ià(
fže
 =ð
NULL
)

561 
¡©e
 = (
gz_¡©•
)
fže
;

562 ià(
¡©e
->
mode
 !ð
GZ_READ
 && s‹->mod!ð
GZ_WRITE
)

566 ià(
¡©e
->
mode
 =ð
GZ_READ
) {

567 
¡©e
->
eof
 = 0;

568 
¡©e
->
·¡
 = 0;

570 
	`gz_”rÜ
(
¡©e
, 
Z_OK
, 
NULL
);

571 
	}
}

579 
ZLIB_INTERNAL
 
	$gz_”rÜ
(
¡©e
, 
”r
, 
msg
)

580 
gz_¡©•
 
¡©e
;

581 
”r
;

582 cÚ¡ *
msg
;

585 ià(
¡©e
->
msg
 !ð
NULL
) {

586 ià(
¡©e
->
”r
 !ð
Z_MEM_ERROR
)

587 
	`ä“
(
¡©e
->
msg
);

588 
¡©e
->
msg
 = 
NULL
;

592 ià(
”r
 !ð
Z_OK
 &&ƒ¼ !ð
Z_BUF_ERROR
)

593 
¡©e
->
x
.
have
 = 0;

596 
¡©e
->
”r
 =ƒrr;

597 ià(
msg
 =ð
NULL
)

601 ià(
”r
 =ð
Z_MEM_ERROR
)

605 ià((
¡©e
->
msg
 = (*)
	`m®loc
(
	`¡¾’
(¡©e->
·th
) + strlen(msg) + 3)) ==

606 
NULL
) {

607 
¡©e
->
”r
 = 
Z_MEM_ERROR
;

610 #ià!
	`defšed
(
NO_¢´štf
è&& !defšed(
NO_v¢´štf
)

611 ()
	`¢´štf
(
¡©e
->
msg
, 
	`¡¾’
(¡©e->
·th
) + strlen(msg) + 3,

612 "%s%s%s", 
¡©e
->
·th
, ": ", 
msg
);

614 
	`¡rýy
(
¡©e
->
msg
, s‹->
·th
);

615 
	`¡rÿt
(
¡©e
->
msg
, ": ");

616 
	`¡rÿt
(
¡©e
->
msg
, msg);

618 
	}
}

620 #iâdeà
INT_MAX


625 
ZLIB_INTERNAL
 
	$gz_štmax
()

627 
p
, 
q
;

629 
p
 = 1;

631 
q
 = 
p
;

632 
p
 <<= 1;

633 
p
++;

634 } 
p
 > 
q
);

635  
q
 >> 1;

636 
	}
}

	@zlib/gzread.c

6 
	~"gzguts.h
"

9 
loÿl
 
gz_lßd
 
OF
((
gz_¡©•
, *, , *));

10 
loÿl
 
gz_avaž
 
OF
((
gz_¡©•
));

11 
loÿl
 
gz_look
 
OF
((
gz_¡©•
));

12 
loÿl
 
gz_decomp
 
OF
((
gz_¡©•
));

13 
loÿl
 
gz_ãtch
 
OF
((
gz_¡©•
));

14 
loÿl
 
gz_sk
 
OF
((
gz_¡©•
, 
z_off64_t
));

15 
loÿl
 
z_size_t
 
gz_»ad
 
OF
((
gz_¡©•
, 
voidp
, z_size_t));

21 
loÿl
 
	$gz_lßd
(
¡©e
, 
buf
, 
Ën
, 
have
)

22 
gz_¡©•
 
¡©e
;

23 *
buf
;

24 
Ën
;

25 *
have
;

27 
»t
;

28 
g‘
, 
max
 = (()-1 >> 2) + 1;

30 *
have
 = 0;

32 
g‘
 = 
Ën
 - *
have
;

33 ià(
g‘
 > 
max
)

34 
g‘
 = 
max
;

35 
»t
 = 
	`»ad
(
¡©e
->
fd
, 
buf
 + *
have
, 
g‘
);

36 ià(
»t
 <= 0)

38 *
have
 +ð()
»t
;

39 } *
have
 < 
Ën
);

40 ià(
»t
 < 0) {

41 
	`gz_”rÜ
(
¡©e
, 
Z_ERRNO
, 
	`z¡»¼Ü
());

44 ià(
»t
 == 0)

45 
¡©e
->
eof
 = 1;

47 
	}
}

56 
loÿl
 
	$gz_avaž
(
¡©e
)

57 
gz_¡©•
 
¡©e
;

59 
gÙ
;

60 
z_¡»amp
 
¡rm
 = &(
¡©e
->strm);

62 ià(
¡©e
->
”r
 !ð
Z_OK
 && s‹->”¸!ð
Z_BUF_ERROR
)

64 ià(
¡©e
->
eof
 == 0) {

65 ià(
¡rm
->
avaž_š
) {

66 *
p
 = 
¡©e
->
š
;

67 cÚ¡ *
q
 = 
¡rm
->
Ãxt_š
;

68 
n
 = 
¡rm
->
avaž_š
;

70 *
p
++ = *
q
++;

71 } --
n
);

73 ià(
	`gz_lßd
(
¡©e
, s‹->
š
 + 
¡rm
->
avaž_š
,

74 
¡©e
->
size
 - 
¡rm
->
avaž_š
, &
gÙ
) == -1)

76 
¡rm
->
avaž_š
 +ð
gÙ
;

77 
¡rm
->
Ãxt_š
 = 
¡©e
->
š
;

80 
	}
}

91 
loÿl
 
	$gz_look
(
¡©e
)

92 
gz_¡©•
 
¡©e
;

94 
z_¡»amp
 
¡rm
 = &(
¡©e
->strm);

97 ià(
¡©e
->
size
 == 0) {

99 
¡©e
->
š
 = (*)
	`m®loc
(¡©e->
wªt
);

100 
¡©e
->
out
 = (*)
	`m®loc
(¡©e->
wªt
 << 1);

101 ià(
¡©e
->
š
 =ð
NULL
 || s‹->
out
 == NULL) {

102 
	`ä“
(
¡©e
->
out
);

103 
	`ä“
(
¡©e
->
š
);

104 
	`gz_”rÜ
(
¡©e
, 
Z_MEM_ERROR
, "out of memory");

107 
¡©e
->
size
 = s‹->
wªt
;

110 
¡©e
->
¡rm
.
z®loc
 = 
Z_NULL
;

111 
¡©e
->
¡rm
.
zä“
 = 
Z_NULL
;

112 
¡©e
->
¡rm
.
Ýaque
 = 
Z_NULL
;

113 
¡©e
->
¡rm
.
avaž_š
 = 0;

114 
¡©e
->
¡rm
.
Ãxt_š
 = 
Z_NULL
;

115 ià(
	`šæ©eIn™2
(&(
¡©e
->
¡rm
), 15 + 16è!ð
Z_OK
) {

116 
	`ä“
(
¡©e
->
out
);

117 
	`ä“
(
¡©e
->
š
);

118 
¡©e
->
size
 = 0;

119 
	`gz_”rÜ
(
¡©e
, 
Z_MEM_ERROR
, "out of memory");

125 ià(
¡rm
->
avaž_š
 < 2) {

126 ià(
	`gz_avaž
(
¡©e
) == -1)

128 ià(
¡rm
->
avaž_š
 == 0)

139 ià(
¡rm
->
avaž_š
 > 1 &&

140 
¡rm
->
Ãxt_š
[0] == 31 && strm->next_in[1] == 139) {

141 
	`šæ©eRe£t
(
¡rm
);

142 
¡©e
->
how
 = 
GZIP
;

143 
¡©e
->
dœeù
 = 0;

149 ià(
¡©e
->
dœeù
 == 0) {

150 
¡rm
->
avaž_š
 = 0;

151 
¡©e
->
eof
 = 1;

152 
¡©e
->
x
.
have
 = 0;

159 
¡©e
->
x
.
Ãxt
 = s‹->
out
;

160 ià(
¡rm
->
avaž_š
) {

161 
	`memýy
(
¡©e
->
x
.
Ãxt
, 
¡rm
->
Ãxt_š
, sŒm->
avaž_š
);

162 
¡©e
->
x
.
have
 = 
¡rm
->
avaž_š
;

163 
¡rm
->
avaž_š
 = 0;

165 
¡©e
->
how
 = 
COPY
;

166 
¡©e
->
dœeù
 = 1;

168 
	}
}

175 
loÿl
 
	$gz_decomp
(
¡©e
)

176 
gz_¡©•
 
¡©e
;

178 
»t
 = 
Z_OK
;

179 
had
;

180 
z_¡»amp
 
¡rm
 = &(
¡©e
->strm);

183 
had
 = 
¡rm
->
avaž_out
;

186 ià(
¡rm
->
avaž_š
 =ð0 && 
	`gz_avaž
(
¡©e
) == -1)

188 ià(
¡rm
->
avaž_š
 == 0) {

189 
	`gz_”rÜ
(
¡©e
, 
Z_BUF_ERROR
, "unexpectedƒnd of file");

194 
»t
 = 
	`šæ©e
(
¡rm
, 
Z_NO_FLUSH
);

195 ià(
»t
 =ð
Z_STREAM_ERROR
 ||„‘ =ð
Z_NEED_DICT
) {

196 
	`gz_”rÜ
(
¡©e
, 
Z_STREAM_ERROR
,

200 ià(
»t
 =ð
Z_MEM_ERROR
) {

201 
	`gz_”rÜ
(
¡©e
, 
Z_MEM_ERROR
, "out of memory");

204 ià(
»t
 =ð
Z_DATA_ERROR
) {

205 
	`gz_”rÜ
(
¡©e
, 
Z_DATA_ERROR
,

206 
¡rm
->
msg
 =ð
NULL
 ? "compressed dataƒrror" : strm->msg);

209 } 
¡rm
->
avaž_out
 && 
»t
 !ð
Z_STREAM_END
);

212 
¡©e
->
x
.
have
 = 
had
 - 
¡rm
->
avaž_out
;

213 
¡©e
->
x
.
Ãxt
 = 
¡rm
->
Ãxt_out
 - s‹->x.
have
;

216 ià(
»t
 =ð
Z_STREAM_END
)

217 
¡©e
->
how
 = 
LOOK
;

221 
	}
}

229 
loÿl
 
	$gz_ãtch
(
¡©e
)

230 
gz_¡©•
 
¡©e
;

232 
z_¡»amp
 
¡rm
 = &(
¡©e
->strm);

235 
¡©e
->
how
) {

236 
LOOK
:

237 ià(
	`gz_look
(
¡©e
) == -1)

239 ià(
¡©e
->
how
 =ð
LOOK
)

242 
COPY
:

243 ià(
	`gz_lßd
(
¡©e
, s‹->
out
, s‹->
size
 << 1, &(¡©e->
x
.
have
))

246 
¡©e
->
x
.
Ãxt
 = s‹->
out
;

248 
GZIP
:

249 
¡rm
->
avaž_out
 = 
¡©e
->
size
 << 1;

250 
¡rm
->
Ãxt_out
 = 
¡©e
->
out
;

251 ià(
	`gz_decomp
(
¡©e
) == -1)

254 } 
¡©e
->
x
.
have
 =ð0 && (!¡©e->
eof
 || 
¡rm
->
avaž_š
));

256 
	}
}

259 
loÿl
 
	$gz_sk
(
¡©e
, 
Ën
)

260 
gz_¡©•
 
¡©e
;

261 
z_off64_t
 
Ën
;

263 
n
;

266 
Ën
)

268 ià(
¡©e
->
x
.
have
) {

269 
n
 = 
	`GT_OFF
(
¡©e
->
x
.
have
è|| (
z_off64_t
)¡©e->x.hav> 
Ën
 ?

270 ()
Ën
 : 
¡©e
->
x
.
have
;

271 
¡©e
->
x
.
have
 -ð
n
;

272 
¡©e
->
x
.
Ãxt
 +ð
n
;

273 
¡©e
->
x
.
pos
 +ð
n
;

274 
Ën
 -ð
n
;

278 ià(
¡©e
->
eof
 && s‹->
¡rm
.
avaž_š
 == 0)

284 ià(
	`gz_ãtch
(
¡©e
) == -1)

288 
	}
}

294 
loÿl
 
z_size_t
 
	$gz_»ad
(
¡©e
, 
buf
, 
Ën
)

295 
gz_¡©•
 
¡©e
;

296 
voidp
 
buf
;

297 
z_size_t
 
Ën
;

299 
z_size_t
 
gÙ
;

300 
n
;

303 ià(
Ën
 == 0)

307 ià(
¡©e
->
£ek
) {

308 
¡©e
->
£ek
 = 0;

309 ià(
	`gz_sk
(
¡©e
, s‹->
sk
) == -1)

314 
gÙ
 = 0;

317 
n
 = -1;

318 ià(
n
 > 
Ën
)

319 
n
 = 
Ën
;

322 ià(
¡©e
->
x
.
have
) {

323 ià(
¡©e
->
x
.
have
 < 
n
)

324 
n
 = 
¡©e
->
x
.
have
;

325 
	`memýy
(
buf
, 
¡©e
->
x
.
Ãxt
, 
n
);

326 
¡©e
->
x
.
Ãxt
 +ð
n
;

327 
¡©e
->
x
.
have
 -ð
n
;

331 ià(
¡©e
->
eof
 && s‹->
¡rm
.
avaž_š
 == 0) {

332 
¡©e
->
·¡
 = 1;

338 ià(
¡©e
->
how
 =ð
LOOK
 || 
n
 < (¡©e->
size
 << 1)) {

340 ià(
	`gz_ãtch
(
¡©e
) == -1)

348 ià(
¡©e
->
how
 =ð
COPY
) {

349 ià(
	`gz_lßd
(
¡©e
, (*)
buf
, 
n
, &n) == -1)

355 
¡©e
->
¡rm
.
avaž_out
 = 
n
;

356 
¡©e
->
¡rm
.
Ãxt_out
 = (*)
buf
;

357 ià(
	`gz_decomp
(
¡©e
) == -1)

359 
n
 = 
¡©e
->
x
.
have
;

360 
¡©e
->
x
.
have
 = 0;

364 
Ën
 -ð
n
;

365 
buf
 = (*)buà+ 
n
;

366 
gÙ
 +ð
n
;

367 
¡©e
->
x
.
pos
 +ð
n
;

368 } 
Ën
);

371  
gÙ
;

372 
	}
}

375 
ZEXPORT
 
	$gz»ad
(
fže
, 
buf
, 
Ën
)

376 
gzFže
 
fže
;

377 
voidp
 
buf
;

378 
Ën
;

380 
gz_¡©•
 
¡©e
;

383 ià(
fže
 =ð
NULL
)

385 
¡©e
 = (
gz_¡©•
)
fže
;

388 ià(
¡©e
->
mode
 !ð
GZ_READ
 ||

389 (
¡©e
->
”r
 !ð
Z_OK
 && s‹->”¸!ð
Z_BUF_ERROR
))

394 ià(()
Ën
 < 0) {

395 
	`gz_”rÜ
(
¡©e
, 
Z_STREAM_ERROR
, "request does‚ot fit in‡n int");

400 
Ën
 = 
	`gz_»ad
(
¡©e
, 
buf
,†en);

403 ià(
Ën
 =ð0 && 
¡©e
->
”r
 !ð
Z_OK
 && s‹->”¸!ð
Z_BUF_ERROR
)

407  ()
Ën
;

408 
	}
}

411 
z_size_t
 
ZEXPORT
 
	$gzä—d
(
buf
, 
size
, 
n™ems
, 
fže
)

412 
voidp
 
buf
;

413 
z_size_t
 
size
;

414 
z_size_t
 
n™ems
;

415 
gzFže
 
fže
;

417 
z_size_t
 
Ën
;

418 
gz_¡©•
 
¡©e
;

421 ià(
fže
 =ð
NULL
)

423 
¡©e
 = (
gz_¡©•
)
fže
;

426 ià(
¡©e
->
mode
 !ð
GZ_READ
 ||

427 (
¡©e
->
”r
 !ð
Z_OK
 && s‹->”¸!ð
Z_BUF_ERROR
))

431 
Ën
 = 
n™ems
 * 
size
;

432 ià(
size
 && 
Ën
 / siz!ð
n™ems
) {

433 
	`gz_”rÜ
(
¡©e
, 
Z_STREAM_ERROR
, "request does‚ot fit in‡ size_t");

438  
Ën
 ? 
	`gz_»ad
(
¡©e
, 
buf
,†’è/ 
size
 : 0;

439 
	}
}

442 #ifdeà
Z_PREFIX_SET


443 #undeà
z_gzg‘c


445 #undeà
gzg‘c


447 
ZEXPORT
 
	$gzg‘c
(
fže
)

448 
gzFže
 
fže
;

450 
»t
;

451 
buf
[1];

452 
gz_¡©•
 
¡©e
;

455 ià(
fže
 =ð
NULL
)

457 
¡©e
 = (
gz_¡©•
)
fže
;

460 ià(
¡©e
->
mode
 !ð
GZ_READ
 ||

461 (
¡©e
->
”r
 !ð
Z_OK
 && s‹->”¸!ð
Z_BUF_ERROR
))

465 ià(
¡©e
->
x
.
have
) {

466 
¡©e
->
x
.
have
--;

467 
¡©e
->
x
.
pos
++;

468  *(
¡©e
->
x
.
Ãxt
)++;

472 
»t
 = 
	`gz_»ad
(
¡©e
, 
buf
, 1);

473  
»t
 < 1 ? -1 : 
buf
[0];

474 
	}
}

476 
ZEXPORT
 
	$gzg‘c_
(
fže
)

477 
gzFže
 
fže
;

479  
	`gzg‘c
(
fže
);

480 
	}
}

483 
ZEXPORT
 
	$gzung‘c
(
c
, 
fže
)

484 
c
;

485 
gzFže
 
fže
;

487 
gz_¡©•
 
¡©e
;

490 ià(
fže
 =ð
NULL
)

492 
¡©e
 = (
gz_¡©•
)
fže
;

495 ià(
¡©e
->
mode
 !ð
GZ_READ
 ||

496 (
¡©e
->
”r
 !ð
Z_OK
 && s‹->”¸!ð
Z_BUF_ERROR
))

500 ià(
¡©e
->
£ek
) {

501 
¡©e
->
£ek
 = 0;

502 ià(
	`gz_sk
(
¡©e
, s‹->
sk
) == -1)

507 ià(
c
 < 0)

511 ià(
¡©e
->
x
.
have
 == 0) {

512 
¡©e
->
x
.
have
 = 1;

513 
¡©e
->
x
.
Ãxt
 = s‹->
out
 + (¡©e->
size
 << 1) - 1;

514 
¡©e
->
x
.
Ãxt
[0] = ()
c
;

515 
¡©e
->
x
.
pos
--;

516 
¡©e
->
·¡
 = 0;

517  
c
;

521 ià(
¡©e
->
x
.
have
 =ð(¡©e->
size
 << 1)) {

522 
	`gz_”rÜ
(
¡©e
, 
Z_DATA_ERROR
, "out of„oomo…ush characters");

527 ià(
¡©e
->
x
.
Ãxt
 =ð¡©e->
out
) {

528 *
¤c
 = 
¡©e
->
out
 + s‹->
x
.
have
;

529 *
de¡
 = 
¡©e
->
out
 + (¡©e->
size
 << 1);

530 
¤c
 > 
¡©e
->
out
)

531 *--
de¡
 = *--
¤c
;

532 
¡©e
->
x
.
Ãxt
 = 
de¡
;

534 
¡©e
->
x
.
have
++;

535 
¡©e
->
x
.
Ãxt
--;

536 
¡©e
->
x
.
Ãxt
[0] = ()
c
;

537 
¡©e
->
x
.
pos
--;

538 
¡©e
->
·¡
 = 0;

539  
c
;

540 
	}
}

543 * 
ZEXPORT
 
	$gzg‘s
(
fže
, 
buf
, 
Ën
)

544 
gzFže
 
fže
;

545 *
buf
;

546 
Ën
;

548 
Ëá
, 
n
;

549 *
¡r
;

550 *
eÞ
;

551 
gz_¡©•
 
¡©e
;

554 ià(
fže
 =ð
NULL
 || 
buf
 =ðNULL || 
Ën
 < 1)

555  
NULL
;

556 
¡©e
 = (
gz_¡©•
)
fže
;

559 ià(
¡©e
->
mode
 !ð
GZ_READ
 ||

560 (
¡©e
->
”r
 !ð
Z_OK
 && s‹->”¸!ð
Z_BUF_ERROR
))

561  
NULL
;

564 ià(
¡©e
->
£ek
) {

565 
¡©e
->
£ek
 = 0;

566 ià(
	`gz_sk
(
¡©e
, s‹->
sk
) == -1)

567  
NULL
;

573 
¡r
 = 
buf
;

574 
Ëá
 = ()
Ën
 - 1;

575 ià(
Ëá
) do {

577 ià(
¡©e
->
x
.
have
 =ð0 && 
	`gz_ãtch
(state) == -1)

578  
NULL
;

579 ià(
¡©e
->
x
.
have
 == 0) {

580 
¡©e
->
·¡
 = 1;

585 
n
 = 
¡©e
->
x
.
have
 > 
Ëá
 ?†eft : state->x.have;

586 
eÞ
 = (*)
	`memchr
(
¡©e
->
x
.
Ãxt
, '\n', 
n
);

587 ià(
eÞ
 !ð
NULL
)

588 
n
 = ()(
eÞ
 - 
¡©e
->
x
.
Ãxt
) + 1;

591 
	`memýy
(
buf
, 
¡©e
->
x
.
Ãxt
, 
n
);

592 
¡©e
->
x
.
have
 -ð
n
;

593 
¡©e
->
x
.
Ãxt
 +ð
n
;

594 
¡©e
->
x
.
pos
 +ð
n
;

595 
Ëá
 -ð
n
;

596 
buf
 +ð
n
;

597 } 
Ëá
 && 
eÞ
 =ð
NULL
);

600 ià(
buf
 =ð
¡r
)

601  
NULL
;

602 
buf
[0] = 0;

603  
¡r
;

604 
	}
}

607 
ZEXPORT
 
	$gzdœeù
(
fže
)

608 
gzFže
 
fže
;

610 
gz_¡©•
 
¡©e
;

613 ià(
fže
 =ð
NULL
)

615 
¡©e
 = (
gz_¡©•
)
fže
;

619 ià(
¡©e
->
mode
 =ð
GZ_READ
 && s‹->
how
 =ð
LOOK
 && s‹->
x
.
have
 == 0)

620 ()
	`gz_look
(
¡©e
);

623  
¡©e
->
dœeù
;

624 
	}
}

627 
ZEXPORT
 
	$gzþo£_r
(
fže
)

628 
gzFže
 
fže
;

630 
»t
, 
”r
;

631 
gz_¡©•
 
¡©e
;

634 ià(
fže
 =ð
NULL
)

635  
Z_STREAM_ERROR
;

636 
¡©e
 = (
gz_¡©•
)
fže
;

639 ià(
¡©e
->
mode
 !ð
GZ_READ
)

640  
Z_STREAM_ERROR
;

643 ià(
¡©e
->
size
) {

644 
	`šæ©eEnd
(&(
¡©e
->
¡rm
));

645 
	`ä“
(
¡©e
->
out
);

646 
	`ä“
(
¡©e
->
š
);

648 
”r
 = 
¡©e
->”¸=ð
Z_BUF_ERROR
 ? Z_BUF_ERROR : 
Z_OK
;

649 
	`gz_”rÜ
(
¡©e
, 
Z_OK
, 
NULL
);

650 
	`ä“
(
¡©e
->
·th
);

651 
»t
 = 
	`þo£
(
¡©e
->
fd
);

652 
	`ä“
(
¡©e
);

653  
»t
 ? 
Z_ERRNO
 : 
”r
;

654 
	}
}

	@zlib/gzwrite.c

6 
	~"gzguts.h
"

9 
loÿl
 
gz_š™
 
OF
((
gz_¡©•
));

10 
loÿl
 
gz_comp
 
OF
((
gz_¡©•
, ));

11 
loÿl
 
gz_z”o
 
OF
((
gz_¡©•
, 
z_off64_t
));

12 
loÿl
 
z_size_t
 
gz_wr™e
 
OF
((
gz_¡©•
, 
voidpc
, z_size_t));

17 
loÿl
 
	$gz_š™
(
¡©e
)

18 
gz_¡©•
 
¡©e
;

20 
»t
;

21 
z_¡»amp
 
¡rm
 = &(
¡©e
->strm);

24 
¡©e
->
š
 = (*)
	`m®loc
(¡©e->
wªt
 << 1);

25 ià(
¡©e
->
š
 =ð
NULL
) {

26 
	`gz_”rÜ
(
¡©e
, 
Z_MEM_ERROR
, "out of memory");

31 ià(!
¡©e
->
dœeù
) {

33 
¡©e
->
out
 = (*)
	`m®loc
(¡©e->
wªt
);

34 ià(
¡©e
->
out
 =ð
NULL
) {

35 
	`ä“
(
¡©e
->
š
);

36 
	`gz_”rÜ
(
¡©e
, 
Z_MEM_ERROR
, "out of memory");

41 
¡rm
->
z®loc
 = 
Z_NULL
;

42 
¡rm
->
zä“
 = 
Z_NULL
;

43 
¡rm
->
Ýaque
 = 
Z_NULL
;

44 
»t
 = 
	`deæ©eIn™2
(
¡rm
, 
¡©e
->
Ëv–
, 
Z_DEFLATED
,

45 
MAX_WBITS
 + 16, 
DEF_MEM_LEVEL
, 
¡©e
->
¡¿‹gy
);

46 ià(
»t
 !ð
Z_OK
) {

47 
	`ä“
(
¡©e
->
out
);

48 
	`ä“
(
¡©e
->
š
);

49 
	`gz_”rÜ
(
¡©e
, 
Z_MEM_ERROR
, "out of memory");

52 
¡rm
->
Ãxt_š
 = 
NULL
;

56 
¡©e
->
size
 = s‹->
wªt
;

59 ià(!
¡©e
->
dœeù
) {

60 
¡rm
->
avaž_out
 = 
¡©e
->
size
;

61 
¡rm
->
Ãxt_out
 = 
¡©e
->
out
;

62 
¡©e
->
x
.
Ãxt
 = 
¡rm
->
Ãxt_out
;

65 
	}
}

73 
loÿl
 
	$gz_comp
(
¡©e
, 
æush
)

74 
gz_¡©•
 
¡©e
;

75 
æush
;

77 
»t
, 
wr™
;

78 
have
, 
put
, 
max
 = (()-1 >> 2) + 1;

79 
z_¡»amp
 
¡rm
 = &(
¡©e
->strm);

82 ià(
¡©e
->
size
 =ð0 && 
	`gz_š™
(state) == -1)

86 ià(
¡©e
->
dœeù
) {

87 
¡rm
->
avaž_š
) {

88 
put
 = 
¡rm
->
avaž_š
 > 
max
 ? max : strm->avail_in;

89 
wr™
 = 
	`wr™e
(
¡©e
->
fd
, 
¡rm
->
Ãxt_š
, 
put
);

90 ià(
wr™
 < 0) {

91 
	`gz_”rÜ
(
¡©e
, 
Z_ERRNO
, 
	`z¡»¼Ü
());

94 
¡rm
->
avaž_š
 -ð()
wr™
;

95 
¡rm
->
Ãxt_š
 +ð
wr™
;

101 
»t
 = 
Z_OK
;

105 ià(
¡rm
->
avaž_out
 =ð0 || (
æush
 !ð
Z_NO_FLUSH
 &&

106 (
æush
 !ð
Z_FINISH
 || 
»t
 =ð
Z_STREAM_END
))) {

107 
¡rm
->
Ãxt_out
 > 
¡©e
->
x
.
Ãxt
) {

108 
put
 = 
¡rm
->
Ãxt_out
 - 
¡©e
->
x
.
Ãxt
 > ()
max
 ? max :

109 ()(
¡rm
->
Ãxt_out
 - 
¡©e
->
x
.
Ãxt
);

110 
wr™
 = 
	`wr™e
(
¡©e
->
fd
, s‹->
x
.
Ãxt
, 
put
);

111 ià(
wr™
 < 0) {

112 
	`gz_”rÜ
(
¡©e
, 
Z_ERRNO
, 
	`z¡»¼Ü
());

115 
¡©e
->
x
.
Ãxt
 +ð
wr™
;

117 ià(
¡rm
->
avaž_out
 == 0) {

118 
¡rm
->
avaž_out
 = 
¡©e
->
size
;

119 
¡rm
->
Ãxt_out
 = 
¡©e
->
out
;

120 
¡©e
->
x
.
Ãxt
 = s‹->
out
;

125 
have
 = 
¡rm
->
avaž_out
;

126 
»t
 = 
	`deæ©e
(
¡rm
, 
æush
);

127 ià(
»t
 =ð
Z_STREAM_ERROR
) {

128 
	`gz_”rÜ
(
¡©e
, 
Z_STREAM_ERROR
,

132 
have
 -ð
¡rm
->
avaž_out
;

133 } 
have
);

136 ià(
æush
 =ð
Z_FINISH
)

137 
	`deæ©eRe£t
(
¡rm
);

141 
	}
}

145 
loÿl
 
	$gz_z”o
(
¡©e
, 
Ën
)

146 
gz_¡©•
 
¡©e
;

147 
z_off64_t
 
Ën
;

149 
fœ¡
;

150 
n
;

151 
z_¡»amp
 
¡rm
 = &(
¡©e
->strm);

154 ià(
¡rm
->
avaž_š
 && 
	`gz_comp
(
¡©e
, 
Z_NO_FLUSH
) == -1)

158 
fœ¡
 = 1;

159 
Ën
) {

160 
n
 = 
	`GT_OFF
(
¡©e
->
size
è|| (
z_off64_t
)¡©e->siz> 
Ën
 ?

161 ()
Ën
 : 
¡©e
->
size
;

162 ià(
fœ¡
) {

163 
	`mem£t
(
¡©e
->
š
, 0, 
n
);

164 
fœ¡
 = 0;

166 
¡rm
->
avaž_š
 = 
n
;

167 
¡rm
->
Ãxt_š
 = 
¡©e
->
š
;

168 
¡©e
->
x
.
pos
 +ð
n
;

169 ià(
	`gz_comp
(
¡©e
, 
Z_NO_FLUSH
) == -1)

171 
Ën
 -ð
n
;

174 
	}
}

178 
loÿl
 
z_size_t
 
	$gz_wr™e
(
¡©e
, 
buf
, 
Ën
)

179 
gz_¡©•
 
¡©e
;

180 
voidpc
 
buf
;

181 
z_size_t
 
Ën
;

183 
z_size_t
 
put
 = 
Ën
;

186 ià(
Ën
 == 0)

190 ià(
¡©e
->
size
 =ð0 && 
	`gz_š™
(state) == -1)

194 ià(
¡©e
->
£ek
) {

195 
¡©e
->
£ek
 = 0;

196 ià(
	`gz_z”o
(
¡©e
, s‹->
sk
) == -1)

201 ià(
Ën
 < 
¡©e
->
size
) {

204 
have
, 
cÝy
;

206 ià(
¡©e
->
¡rm
.
avaž_š
 == 0)

207 
¡©e
->
¡rm
.
Ãxt_š
 = s‹->
š
;

208 
have
 = ()((
¡©e
->
¡rm
.
Ãxt_š
 + s‹->¡rm.
avaž_š
) -

209 
¡©e
->
š
);

210 
cÝy
 = 
¡©e
->
size
 - 
have
;

211 ià(
cÝy
 > 
Ën
)

212 
cÝy
 = 
Ën
;

213 
	`memýy
(
¡©e
->
š
 + 
have
, 
buf
, 
cÝy
);

214 
¡©e
->
¡rm
.
avaž_š
 +ð
cÝy
;

215 
¡©e
->
x
.
pos
 +ð
cÝy
;

216 
buf
 = (cÚ¡ *)buà+ 
cÝy
;

217 
Ën
 -ð
cÝy
;

218 ià(
Ën
 && 
	`gz_comp
(
¡©e
, 
Z_NO_FLUSH
) == -1)

220 } 
Ën
);

224 ià(
¡©e
->
¡rm
.
avaž_š
 && 
	`gz_comp
(¡©e, 
Z_NO_FLUSH
) == -1)

228 
¡©e
->
¡rm
.
Ãxt_š
 = (
z_cÚ¡
 
By‹f
 *)
buf
;

230 
n
 = ()-1;

231 ià(
n
 > 
Ën
)

232 
n
 = 
Ën
;

233 
¡©e
->
¡rm
.
avaž_š
 = 
n
;

234 
¡©e
->
x
.
pos
 +ð
n
;

235 ià(
	`gz_comp
(
¡©e
, 
Z_NO_FLUSH
) == -1)

237 
Ën
 -ð
n
;

238 } 
Ën
);

242  
put
;

243 
	}
}

246 
ZEXPORT
 
	$gzwr™e
(
fže
, 
buf
, 
Ën
)

247 
gzFže
 
fže
;

248 
voidpc
 
buf
;

249 
Ën
;

251 
gz_¡©•
 
¡©e
;

254 ià(
fže
 =ð
NULL
)

256 
¡©e
 = (
gz_¡©•
)
fže
;

259 ià(
¡©e
->
mode
 !ð
GZ_WRITE
 || s‹->
”r
 !ð
Z_OK
)

264 ià(()
Ën
 < 0) {

265 
	`gz_”rÜ
(
¡©e
, 
Z_DATA_ERROR
, "requested†ength does‚ot fit in int");

270  ()
	`gz_wr™e
(
¡©e
, 
buf
, 
Ën
);

271 
	}
}

274 
z_size_t
 
ZEXPORT
 
	$gzfwr™e
(
buf
, 
size
, 
n™ems
, 
fže
)

275 
voidpc
 
buf
;

276 
z_size_t
 
size
;

277 
z_size_t
 
n™ems
;

278 
gzFže
 
fže
;

280 
z_size_t
 
Ën
;

281 
gz_¡©•
 
¡©e
;

284 ià(
fže
 =ð
NULL
)

286 
¡©e
 = (
gz_¡©•
)
fže
;

289 ià(
¡©e
->
mode
 !ð
GZ_WRITE
 || s‹->
”r
 !ð
Z_OK
)

293 
Ën
 = 
n™ems
 * 
size
;

294 ià(
size
 && 
Ën
 / siz!ð
n™ems
) {

295 
	`gz_”rÜ
(
¡©e
, 
Z_STREAM_ERROR
, "request does‚ot fit in‡ size_t");

300  
Ën
 ? 
	`gz_wr™e
(
¡©e
, 
buf
,†’è/ 
size
 : 0;

301 
	}
}

304 
ZEXPORT
 
	$gzputc
(
fže
, 
c
)

305 
gzFže
 
fže
;

306 
c
;

308 
have
;

309 
buf
[1];

310 
gz_¡©•
 
¡©e
;

311 
z_¡»amp
 
¡rm
;

314 ià(
fže
 =ð
NULL
)

316 
¡©e
 = (
gz_¡©•
)
fže
;

317 
¡rm
 = &(
¡©e
->strm);

320 ià(
¡©e
->
mode
 !ð
GZ_WRITE
 || s‹->
”r
 !ð
Z_OK
)

324 ià(
¡©e
->
£ek
) {

325 
¡©e
->
£ek
 = 0;

326 ià(
	`gz_z”o
(
¡©e
, s‹->
sk
) == -1)

332 ià(
¡©e
->
size
) {

333 ià(
¡rm
->
avaž_š
 == 0)

334 
¡rm
->
Ãxt_š
 = 
¡©e
->
š
;

335 
have
 = ()((
¡rm
->
Ãxt_š
 + sŒm->
avaž_š
è- 
¡©e
->
š
);

336 ià(
have
 < 
¡©e
->
size
) {

337 
¡©e
->
š
[
have
] = ()
c
;

338 
¡rm
->
avaž_š
++;

339 
¡©e
->
x
.
pos
++;

340  
c
 & 0xff;

345 
buf
[0] = ()
c
;

346 ià(
	`gz_wr™e
(
¡©e
, 
buf
, 1) != 1)

348  
c
 & 0xff;

349 
	}
}

352 
ZEXPORT
 
	$gzputs
(
fže
, 
¡r
)

353 
gzFže
 
fže
;

354 cÚ¡ *
¡r
;

356 
»t
;

357 
z_size_t
 
Ën
;

358 
gz_¡©•
 
¡©e
;

361 ià(
fže
 =ð
NULL
)

363 
¡©e
 = (
gz_¡©•
)
fže
;

366 ià(
¡©e
->
mode
 !ð
GZ_WRITE
 || s‹->
”r
 !ð
Z_OK
)

370 
Ën
 = 
	`¡¾’
(
¡r
);

371 
»t
 = 
	`gz_wr™e
(
¡©e
, 
¡r
, 
Ën
);

372  
»t
 =ð0 && 
Ën
 != 0 ? -1 :„et;

373 
	}
}

375 #ià
defšed
(
STDC
è|| defšed(
Z_HAVE_STDARG_H
)

376 
	~<¡d¬g.h
>

379 
ZEXPORTVA
 
	$gzv´štf
(
gzFže
 
fže
, cÚ¡ *
fÜm©
, 
va_li¡
 
va
)

381 
Ën
;

382 
Ëá
;

383 *
Ãxt
;

384 
gz_¡©•
 
¡©e
;

385 
z_¡»amp
 
¡rm
;

388 ià(
fže
 =ð
NULL
)

389  
Z_STREAM_ERROR
;

390 
¡©e
 = (
gz_¡©•
)
fže
;

391 
¡rm
 = &(
¡©e
->strm);

394 ià(
¡©e
->
mode
 !ð
GZ_WRITE
 || s‹->
”r
 !ð
Z_OK
)

395  
Z_STREAM_ERROR
;

398 ià(
¡©e
->
size
 =ð0 && 
	`gz_š™
(state) == -1)

399  
¡©e
->
”r
;

402 ià(
¡©e
->
£ek
) {

403 
¡©e
->
£ek
 = 0;

404 ià(
	`gz_z”o
(
¡©e
, s‹->
sk
) == -1)

405  
¡©e
->
”r
;

411 ià(
¡rm
->
avaž_š
 == 0)

412 
¡rm
->
Ãxt_š
 = 
¡©e
->
š
;

413 
Ãxt
 = (*)(
¡©e
->
š
 + (
¡rm
->
Ãxt_š
 - s‹->šè+ sŒm->
avaž_š
);

414 
Ãxt
[
¡©e
->
size
 - 1] = 0;

415 #ifdeà
NO_v¢´štf


416 #ifdeà
HAS_v¥rštf_void


417 ()
	`v¥rštf
(
Ãxt
, 
fÜm©
, 
va
);

418 
Ën
 = 0;†’ < 
¡©e
->
size
;†en++)

419 ià(
Ãxt
[
Ën
] == 0) ;

421 
Ën
 = 
	`v¥rštf
(
Ãxt
, 
fÜm©
, 
va
);

424 #ifdeà
HAS_v¢´štf_void


425 ()
	`v¢´štf
(
Ãxt
, 
¡©e
->
size
, 
fÜm©
, 
va
);

426 
Ën
 = 
	`¡¾’
(
Ãxt
);

428 
Ën
 = 
	`v¢´štf
(
Ãxt
, 
¡©e
->
size
, 
fÜm©
, 
va
);

433 ià(
Ën
 =ð0 || (î’ >ð
¡©e
->
size
 || 
Ãxt
[state->size - 1] != 0)

437 
¡rm
->
avaž_š
 +ð()
Ën
;

438 
¡©e
->
x
.
pos
 +ð
Ën
;

439 ià(
¡rm
->
avaž_š
 >ð
¡©e
->
size
) {

440 
Ëá
 = 
¡rm
->
avaž_š
 - 
¡©e
->
size
;

441 
¡rm
->
avaž_š
 = 
¡©e
->
size
;

442 ià(
	`gz_comp
(
¡©e
, 
Z_NO_FLUSH
) == -1)

443  
¡©e
->
”r
;

444 
	`memýy
(
¡©e
->
š
, s‹->š + s‹->
size
, 
Ëá
);

445 
¡rm
->
Ãxt_š
 = 
¡©e
->
š
;

446 
¡rm
->
avaž_š
 = 
Ëá
;

448  
Ën
;

449 
	}
}

451 
ZEXPORTVA
 
	$gz´štf
(
gzFže
 
fže
, cÚ¡ *
fÜm©
, ...)

453 
va_li¡
 
va
;

454 
»t
;

456 
	`va_¡¬t
(
va
, 
fÜm©
);

457 
»t
 = 
	`gzv´štf
(
fže
, 
fÜm©
, 
va
);

458 
	`va_’d
(
va
);

459  
»t
;

460 
	}
}

465 
ZEXPORTVA
 
	$gz´štf
 (
fže
, 
fÜm©
, 
a1
, 
a2
, 
a3
, 
a4
, 
a5
, 
a6
, 
a7
, 
a8
, 
a9
, 
a10
,

466 
a11
, 
a12
, 
a13
, 
a14
, 
a15
, 
a16
, 
a17
, 
a18
, 
a19
, 
a20
)

467 
gzFže
 
fže
;

468 cÚ¡ *
fÜm©
;

469 
a1
, 
a2
, 
a3
, 
a4
, 
a5
, 
a6
, 
a7
, 
a8
, 
a9
, 
a10
,

470 
a11
, 
a12
, 
a13
, 
a14
, 
a15
, 
a16
, 
a17
, 
a18
, 
a19
, 
a20
;

472 
Ën
, 
Ëá
;

473 *
Ãxt
;

474 
gz_¡©•
 
¡©e
;

475 
z_¡»amp
 
¡rm
;

478 ià(
fže
 =ð
NULL
)

479  
Z_STREAM_ERROR
;

480 
¡©e
 = (
gz_¡©•
)
fže
;

481 
¡rm
 = &(
¡©e
->strm);

485  
Z_STREAM_ERROR
;

488 ià(
¡©e
->
mode
 !ð
GZ_WRITE
 || s‹->
”r
 !ð
Z_OK
)

489  
Z_STREAM_ERROR
;

492 ià(
¡©e
->
size
 =ð0 && 
	`gz_š™
(state) == -1)

493  
¡©e
->
”rÜ
;

496 ià(
¡©e
->
£ek
) {

497 
¡©e
->
£ek
 = 0;

498 ià(
	`gz_z”o
(
¡©e
, s‹->
sk
) == -1)

499  
¡©e
->
”rÜ
;

505 ià(
¡rm
->
avaž_š
 == 0)

506 
¡rm
->
Ãxt_š
 = 
¡©e
->
š
;

507 
Ãxt
 = (*)(
¡rm
->
Ãxt_š
 + sŒm->
avaž_š
);

508 
Ãxt
[
¡©e
->
size
 - 1] = 0;

509 #ifdeà
NO_¢´štf


510 #ifdeà
HAS_¥rštf_void


511 
	`¥rštf
(
Ãxt
, 
fÜm©
, 
a1
, 
a2
, 
a3
, 
a4
, 
a5
, 
a6
, 
a7
, 
a8
, 
a9
, 
a10
, 
a11
, 
a12
,

512 
a13
, 
a14
, 
a15
, 
a16
, 
a17
, 
a18
, 
a19
, 
a20
);

513 
Ën
 = 0;†’ < 
size
;†en++)

514 ià(
Ãxt
[
Ën
] == 0)

517 
Ën
 = 
	`¥rštf
(
Ãxt
, 
fÜm©
, 
a1
, 
a2
, 
a3
, 
a4
, 
a5
, 
a6
, 
a7
, 
a8
, 
a9
, 
a10
, 
a11
,

518 
a12
, 
a13
, 
a14
, 
a15
, 
a16
, 
a17
, 
a18
, 
a19
, 
a20
);

521 #ifdeà
HAS_¢´štf_void


522 
	`¢´štf
(
Ãxt
, 
¡©e
->
size
, 
fÜm©
, 
a1
, 
a2
, 
a3
, 
a4
, 
a5
, 
a6
, 
a7
, 
a8
, 
a9
,

523 
a10
, 
a11
, 
a12
, 
a13
, 
a14
, 
a15
, 
a16
, 
a17
, 
a18
, 
a19
, 
a20
);

524 
Ën
 = 
	`¡¾’
(
Ãxt
);

526 
Ën
 = 
	`¢´štf
(
Ãxt
, 
¡©e
->
size
, 
fÜm©
, 
a1
, 
a2
, 
a3
, 
a4
, 
a5
, 
a6
, 
a7
, 
a8
,

527 
a9
, 
a10
, 
a11
, 
a12
, 
a13
, 
a14
, 
a15
, 
a16
, 
a17
, 
a18
, 
a19
, 
a20
);

532 ià(
Ën
 =ð0 ||†’ >ð
¡©e
->
size
 || 
Ãxt
[state->size - 1] != 0)

536 
¡rm
->
avaž_š
 +ð
Ën
;

537 
¡©e
->
x
.
pos
 +ð
Ën
;

538 ià(
¡rm
->
avaž_š
 >ð
¡©e
->
size
) {

539 
Ëá
 = 
¡rm
->
avaž_š
 - 
¡©e
->
size
;

540 
¡rm
->
avaž_š
 = 
¡©e
->
size
;

541 ià(
	`gz_comp
(
¡©e
, 
Z_NO_FLUSH
) == -1)

542  
¡©e
->
”r
;

543 
	`memýy
(
¡©e
->
š
, s‹->š + s‹->
size
, 
Ëá
);

544 
¡rm
->
Ãxt_š
 = 
¡©e
->
š
;

545 
¡rm
->
avaž_š
 = 
Ëá
;

547  ()
Ën
;

548 
	}
}

553 
ZEXPORT
 
	$gzæush
(
fže
, 
æush
)

554 
gzFže
 
fže
;

555 
æush
;

557 
gz_¡©•
 
¡©e
;

560 ià(
fže
 =ð
NULL
)

561  
Z_STREAM_ERROR
;

562 
¡©e
 = (
gz_¡©•
)
fže
;

565 ià(
¡©e
->
mode
 !ð
GZ_WRITE
 || s‹->
”r
 !ð
Z_OK
)

566  
Z_STREAM_ERROR
;

569 ià(
æush
 < 0 || flush > 
Z_FINISH
)

570  
Z_STREAM_ERROR
;

573 ià(
¡©e
->
£ek
) {

574 
¡©e
->
£ek
 = 0;

575 ià(
	`gz_z”o
(
¡©e
, s‹->
sk
) == -1)

576  
¡©e
->
”r
;

580 ()
	`gz_comp
(
¡©e
, 
æush
);

581  
¡©e
->
”r
;

582 
	}
}

585 
ZEXPORT
 
	$gz£¬ams
(
fže
, 
Ëv–
, 
¡¿‹gy
)

586 
gzFže
 
fže
;

587 
Ëv–
;

588 
¡¿‹gy
;

590 
gz_¡©•
 
¡©e
;

591 
z_¡»amp
 
¡rm
;

594 ià(
fže
 =ð
NULL
)

595  
Z_STREAM_ERROR
;

596 
¡©e
 = (
gz_¡©•
)
fže
;

597 
¡rm
 = &(
¡©e
->strm);

600 ià(
¡©e
->
mode
 !ð
GZ_WRITE
 || s‹->
”r
 !ð
Z_OK
)

601  
Z_STREAM_ERROR
;

604 ià(
Ëv–
 =ð
¡©e
->Ëv– && 
¡¿‹gy
 == state->strategy)

605  
Z_OK
;

608 ià(
¡©e
->
£ek
) {

609 
¡©e
->
£ek
 = 0;

610 ià(
	`gz_z”o
(
¡©e
, s‹->
sk
) == -1)

611  
¡©e
->
”r
;

615 ià(
¡©e
->
size
) {

617 ià(
¡rm
->
avaž_š
 && 
	`gz_comp
(
¡©e
, 
Z_BLOCK
) == -1)

618  
¡©e
->
”r
;

619 
	`deæ©eP¬ams
(
¡rm
, 
Ëv–
, 
¡¿‹gy
);

621 
¡©e
->
Ëv–
 =†evel;

622 
¡©e
->
¡¿‹gy
 = strategy;

623  
Z_OK
;

624 
	}
}

627 
ZEXPORT
 
	$gzþo£_w
(
fže
)

628 
gzFže
 
fže
;

630 
»t
 = 
Z_OK
;

631 
gz_¡©•
 
¡©e
;

634 ià(
fže
 =ð
NULL
)

635  
Z_STREAM_ERROR
;

636 
¡©e
 = (
gz_¡©•
)
fže
;

639 ià(
¡©e
->
mode
 !ð
GZ_WRITE
)

640  
Z_STREAM_ERROR
;

643 ià(
¡©e
->
£ek
) {

644 
¡©e
->
£ek
 = 0;

645 ià(
	`gz_z”o
(
¡©e
, s‹->
sk
) == -1)

646 
»t
 = 
¡©e
->
”r
;

650 ià(
	`gz_comp
(
¡©e
, 
Z_FINISH
) == -1)

651 
»t
 = 
¡©e
->
”r
;

652 ià(
¡©e
->
size
) {

653 ià(!
¡©e
->
dœeù
) {

654 ()
	`deæ©eEnd
(&(
¡©e
->
¡rm
));

655 
	`ä“
(
¡©e
->
out
);

657 
	`ä“
(
¡©e
->
š
);

659 
	`gz_”rÜ
(
¡©e
, 
Z_OK
, 
NULL
);

660 
	`ä“
(
¡©e
->
·th
);

661 ià(
	`þo£
(
¡©e
->
fd
) == -1)

662 
»t
 = 
Z_ERRNO
;

663 
	`ä“
(
¡©e
);

664  
»t
;

665 
	}
}

	@zlib/infback.c

13 
	~"zutž.h
"

14 
	~"šá»es.h
"

15 
	~"šæ©e.h
"

16 
	~"šfç¡.h
"

19 
loÿl
 
fixedbËs
 
OF
((
šæ©e_¡©e
 
FAR
 *
¡©e
));

28 
ZEXPORT
 
	$šæ©eBackIn™_
(
¡rm
, 
wšdowB™s
, 
wšdow
, 
v”siÚ
, 
¡»am_size
)

29 
z_¡»amp
 
¡rm
;

30 
wšdowB™s
;

31 
FAR
 *
wšdow
;

32 cÚ¡ *
v”siÚ
;

33 
¡»am_size
;

35 
šæ©e_¡©e
 
FAR
 *
¡©e
;

37 ià(
v”siÚ
 =ð
Z_NULL
 || v”siÚ[0] !ð
ZLIB_VERSION
[0] ||

38 
¡»am_size
 !ð()((
z_¡»am
)))

39  
Z_VERSION_ERROR
;

40 ià(
¡rm
 =ð
Z_NULL
 || 
wšdow
 == Z_NULL ||

41 
wšdowB™s
 < 8 || windowBits > 15)

42  
Z_STREAM_ERROR
;

43 
¡rm
->
msg
 = 
Z_NULL
;

44 ià(
¡rm
->
z®loc
 =ð(
®loc_func
)0) {

45 #ifdeà
Z_SOLO


46  
Z_STREAM_ERROR
;

48 
¡rm
->
z®loc
 = 
zÿÎoc
;

49 
¡rm
->
Ýaque
 = (
voidpf
)0;

52 ià(
¡rm
->
zä“
 =ð(
ä“_func
)0)

53 #ifdeà
Z_SOLO


54  
Z_STREAM_ERROR
;

56 
¡rm
->
zä“
 = 
zcä“
;

58 
¡©e
 = (
šæ©e_¡©e
 
FAR
 *)
	`ZALLOC
(
¡rm
, 1,

59 (
šæ©e_¡©e
));

60 ià(
¡©e
 =ð
Z_NULL
è 
Z_MEM_ERROR
;

61 
	`T¿ûv
((
¡d”r
, "inflate:‡llocated\n"));

62 
¡rm
->
¡©e
 = (
š‹º®_¡©e
 
FAR
 *)state;

63 
¡©e
->
dmax
 = 32768U;

64 
¡©e
->
wb™s
 = (
uIÁ
)
wšdowB™s
;

65 
¡©e
->
wsize
 = 1U << 
wšdowB™s
;

66 
¡©e
->
wšdow
 = window;

67 
¡©e
->
wÃxt
 = 0;

68 
¡©e
->
whave
 = 0;

69  
Z_OK
;

70 
	}
}

82 
loÿl
 
	$fixedbËs
(
¡©e
)

83 
šæ©e_¡©e
 
FAR
 *
¡©e
;

85 #ifdeà
BUILDFIXED


86 
vœgš
 = 1;

87 
code
 *
Ënfix
, *
di¡fix
;

88 
code
 
fixed
[544];

91 ià(
vœgš
) {

92 
sym
, 
b™s
;

93 
code
 *
Ãxt
;

96 
sym
 = 0;

97 
sym
 < 144è
¡©e
->
Ëns
[sym++] = 8;

98 
sym
 < 256è
¡©e
->
Ëns
[sym++] = 9;

99 
sym
 < 280è
¡©e
->
Ëns
[sym++] = 7;

100 
sym
 < 288è
¡©e
->
Ëns
[sym++] = 8;

101 
Ãxt
 = 
fixed
;

102 
Ënfix
 = 
Ãxt
;

103 
b™s
 = 9;

104 
	`šæ©e_bË
(
LENS
, 
¡©e
->
Ëns
, 288, &(
Ãxt
), &(
b™s
), s‹->
wÜk
);

107 
sym
 = 0;

108 
sym
 < 32è
¡©e
->
Ëns
[sym++] = 5;

109 
di¡fix
 = 
Ãxt
;

110 
b™s
 = 5;

111 
	`šæ©e_bË
(
DISTS
, 
¡©e
->
Ëns
, 32, &(
Ãxt
), &(
b™s
), s‹->
wÜk
);

114 
vœgš
 = 0;

117 
	~"šffixed.h
"

119 
¡©e
->
Ëncode
 = 
Ënfix
;

120 
¡©e
->
Ënb™s
 = 9;

121 
¡©e
->
di¡code
 = 
di¡fix
;

122 
¡©e
->
di¡b™s
 = 5;

123 
	}
}

128 
	#LOAD
() \

130 
put
 = 
¡rm
->
Ãxt_out
; \

131 
Ëá
 = 
¡rm
->
avaž_out
; \

132 
Ãxt
 = 
¡rm
->
Ãxt_š
; \

133 
have
 = 
¡rm
->
avaž_š
; \

134 
hÞd
 = 
¡©e
->hold; \

135 
b™s
 = 
¡©e
->bits; \

136 } 0)

	)

139 
	#RESTORE
() \

141 
¡rm
->
Ãxt_out
 = 
put
; \

142 
¡rm
->
avaž_out
 = 
Ëá
; \

143 
¡rm
->
Ãxt_š
 = 
Ãxt
; \

144 
¡rm
->
avaž_š
 = 
have
; \

145 
¡©e
->
hÞd
 = hold; \

146 
¡©e
->
b™s
 = bits; \

147 } 0)

	)

150 
	#INITBITS
() \

152 
hÞd
 = 0; \

153 
b™s
 = 0; \

154 } 0)

	)

158 
	#PULL
() \

160 ià(
have
 == 0) { \

161 
have
 = 
	`š
(
š_desc
, &
Ãxt
); \

162 ià(
have
 == 0) { \

163 
Ãxt
 = 
Z_NULL
; \

164 
»t
 = 
Z_BUF_ERROR
; \

165 
šf_Ëave
; \

168 } 0)

	)

172 
	#PULLBYTE
() \

174 
	`PULL
(); \

175 
have
--; \

176 
hÞd
 +ð()(*
Ãxt
++è<< 
b™s
; \

177 
b™s
 += 8; \

178 } 0)

	)

183 
	#NEEDBITS
(
n
) \

185 
b™s
 < ()(
n
)) \

186 
	`PULLBYTE
(); \

187 } 0)

	)

190 
	#BITS
(
n
) \

191 (()
hÞd
 & ((1U << (
n
)è- 1))

	)

194 
	#DROPBITS
(
n
) \

196 
hÞd
 >>ð(
n
); \

197 
b™s
 -ð()(
n
); \

198 } 0)

	)

201 
	#BYTEBITS
() \

203 
hÞd
 >>ð
b™s
 & 7; \

204 
b™s
 -= bits & 7; \

205 } 0)

	)

210 
	#ROOM
() \

212 ià(
Ëá
 == 0) { \

213 
put
 = 
¡©e
->
wšdow
; \

214 
Ëá
 = 
¡©e
->
wsize
; \

215 
¡©e
->
whave
 = 
Ëá
; \

216 ià(
	`out
(
out_desc
, 
put
, 
Ëá
)) { \

217 
»t
 = 
Z_BUF_ERROR
; \

218 
šf_Ëave
; \

221 } 0)

	)

250 
ZEXPORT
 
	$šæ©eBack
(
¡rm
, 
š
, 
š_desc
, 
out
, 
out_desc
)

251 
z_¡»amp
 
¡rm
;

252 
š_func
 
š
;

253 
FAR
 *
š_desc
;

254 
out_func
 
out
;

255 
FAR
 *
out_desc
;

257 
šæ©e_¡©e
 
FAR
 *
¡©e
;

258 
z_cÚ¡
 
FAR
 *
Ãxt
;

259 
FAR
 *
put
;

260 
have
, 
Ëá
;

261 
hÞd
;

262 
b™s
;

263 
cÝy
;

264 
FAR
 *
äom
;

265 
code
 
h”e
;

266 
code
 
Ï¡
;

267 
Ën
;

268 
»t
;

269 cÚ¡ 
Üd”
[19] =

273 ià(
¡rm
 =ð
Z_NULL
 || sŒm->
¡©e
 == Z_NULL)

274  
Z_STREAM_ERROR
;

275 
¡©e
 = (
šæ©e_¡©e
 
FAR
 *)
¡rm
->state;

278 
¡rm
->
msg
 = 
Z_NULL
;

279 
¡©e
->
mode
 = 
TYPE
;

280 
¡©e
->
Ï¡
 = 0;

281 
¡©e
->
whave
 = 0;

282 
Ãxt
 = 
¡rm
->
Ãxt_š
;

283 
have
 = 
Ãxt
 !ð
Z_NULL
 ? 
¡rm
->
avaž_š
 : 0;

284 
hÞd
 = 0;

285 
b™s
 = 0;

286 
put
 = 
¡©e
->
wšdow
;

287 
Ëá
 = 
¡©e
->
wsize
;

291 
¡©e
->
mode
) {

292 
TYPE
:

294 ià(
¡©e
->
Ï¡
) {

295 
	`BYTEBITS
();

296 
¡©e
->
mode
 = 
DONE
;

299 
	`NEEDBITS
(3);

300 
¡©e
->
Ï¡
 = 
	`BITS
(1);

301 
	`DROPBITS
(1);

302 
	`BITS
(2)) {

304 
	`T¿ûv
((
¡d”r
, "inflate: stored block%s\n",

305 
¡©e
->
Ï¡
 ? " (last)" : ""));

306 
¡©e
->
mode
 = 
STORED
;

309 
	`fixedbËs
(
¡©e
);

310 
	`T¿ûv
((
¡d”r
, "inflate: fixed codes block%s\n",

311 
¡©e
->
Ï¡
 ? " (last)" : ""));

312 
¡©e
->
mode
 = 
LEN
;

315 
	`T¿ûv
((
¡d”r
, "inflate: dynamic codes block%s\n",

316 
¡©e
->
Ï¡
 ? " (last)" : ""));

317 
¡©e
->
mode
 = 
TABLE
;

320 
¡rm
->
msg
 = (*)"invalid blockype";

321 
¡©e
->
mode
 = 
BAD
;

323 
	`DROPBITS
(2);

326 
STORED
:

328 
	`BYTEBITS
();

329 
	`NEEDBITS
(32);

330 ià((
hÞd
 & 0xffff) != ((hold >> 16) ^ 0xffff)) {

331 
¡rm
->
msg
 = (*)"invalid stored block†engths";

332 
¡©e
->
mode
 = 
BAD
;

335 
¡©e
->
Ëngth
 = ()
hÞd
 & 0xffff;

336 
	`T¿ûv
((
¡d”r
, "inflate: stored†ength %u\n",

337 
¡©e
->
Ëngth
));

338 
	`INITBITS
();

341 
¡©e
->
Ëngth
 != 0) {

342 
cÝy
 = 
¡©e
->
Ëngth
;

343 
	`PULL
();

344 
	`ROOM
();

345 ià(
cÝy
 > 
have
) copy = have;

346 ià(
cÝy
 > 
Ëá
) copy =†eft;

347 
	`zmemýy
(
put
, 
Ãxt
, 
cÝy
);

348 
have
 -ð
cÝy
;

349 
Ãxt
 +ð
cÝy
;

350 
Ëá
 -ð
cÝy
;

351 
put
 +ð
cÝy
;

352 
¡©e
->
Ëngth
 -ð
cÝy
;

354 
	`T¿ûv
((
¡d”r
, "inflate: storedƒnd\n"));

355 
¡©e
->
mode
 = 
TYPE
;

358 
TABLE
:

360 
	`NEEDBITS
(14);

361 
¡©e
->
Æ’
 = 
	`BITS
(5) + 257;

362 
	`DROPBITS
(5);

363 
¡©e
->
ndi¡
 = 
	`BITS
(5) + 1;

364 
	`DROPBITS
(5);

365 
¡©e
->
ncode
 = 
	`BITS
(4) + 4;

366 
	`DROPBITS
(4);

367 #iâdeà
PKZIP_BUG_WORKAROUND


368 ià(
¡©e
->
Æ’
 > 286 || s‹->
ndi¡
 > 30) {

369 
¡rm
->
msg
 = (*)"too many†ength or distance symbols";

370 
¡©e
->
mode
 = 
BAD
;

374 
	`T¿ûv
((
¡d”r
, "inflate:able sizes ok\n"));

377 
¡©e
->
have
 = 0;

378 
¡©e
->
have
 < s‹->
ncode
) {

379 
	`NEEDBITS
(3);

380 
¡©e
->
Ëns
[
Üd”
[¡©e->
have
++]] = ()
	`BITS
(3);

381 
	`DROPBITS
(3);

383 
¡©e
->
have
 < 19)

384 
¡©e
->
Ëns
[
Üd”
[¡©e->
have
++]] = 0;

385 
¡©e
->
Ãxt
 = s‹->
codes
;

386 
¡©e
->
Ëncode
 = (
code
 cÚ¡ 
FAR
 *)(¡©e->
Ãxt
);

387 
¡©e
->
Ënb™s
 = 7;

388 
»t
 = 
	`šæ©e_bË
(
CODES
, 
¡©e
->
Ëns
, 19, &(¡©e->
Ãxt
),

389 &(
¡©e
->
Ënb™s
), s‹->
wÜk
);

390 ià(
»t
) {

391 
¡rm
->
msg
 = (*)"invalid code†engths set";

392 
¡©e
->
mode
 = 
BAD
;

395 
	`T¿ûv
((
¡d”r
, "inflate: code†engths ok\n"));

398 
¡©e
->
have
 = 0;

399 
¡©e
->
have
 < s‹->
Æ’
 + s‹->
ndi¡
) {

401 
h”e
 = 
¡©e
->
Ëncode
[
	`BITS
(¡©e->
Ënb™s
)];

402 ià(()(
h”e
.
b™s
) <= bits) ;

403 
	`PULLBYTE
();

405 ià(
h”e
.
v®
 < 16) {

406 
	`DROPBITS
(
h”e
.
b™s
);

407 
¡©e
->
Ëns
[¡©e->
have
++] = 
h”e
.
v®
;

410 ià(
h”e
.
v®
 == 16) {

411 
	`NEEDBITS
(
h”e
.
b™s
 + 2);

412 
	`DROPBITS
(
h”e
.
b™s
);

413 ià(
¡©e
->
have
 == 0) {

414 
¡rm
->
msg
 = (*)"invalid bit†ength„epeat";

415 
¡©e
->
mode
 = 
BAD
;

418 
Ën
 = ()(
¡©e
->
Ëns
[¡©e->
have
 - 1]);

419 
cÝy
 = 3 + 
	`BITS
(2);

420 
	`DROPBITS
(2);

422 ià(
h”e
.
v®
 == 17) {

423 
	`NEEDBITS
(
h”e
.
b™s
 + 3);

424 
	`DROPBITS
(
h”e
.
b™s
);

425 
Ën
 = 0;

426 
cÝy
 = 3 + 
	`BITS
(3);

427 
	`DROPBITS
(3);

430 
	`NEEDBITS
(
h”e
.
b™s
 + 7);

431 
	`DROPBITS
(
h”e
.
b™s
);

432 
Ën
 = 0;

433 
cÝy
 = 11 + 
	`BITS
(7);

434 
	`DROPBITS
(7);

436 ià(
¡©e
->
have
 + 
cÝy
 > s‹->
Æ’
 + s‹->
ndi¡
) {

437 
¡rm
->
msg
 = (*)"invalid bit†ength„epeat";

438 
¡©e
->
mode
 = 
BAD
;

441 
cÝy
--)

442 
¡©e
->
Ëns
[¡©e->
have
++] = ()
Ën
;

447 ià(
¡©e
->
mode
 =ð
BAD
) ;

450 ià(
¡©e
->
Ëns
[256] == 0) {

451 
¡rm
->
msg
 = (*)"invalid code -- missingƒnd-of-block";

452 
¡©e
->
mode
 = 
BAD
;

459 
¡©e
->
Ãxt
 = s‹->
codes
;

460 
¡©e
->
Ëncode
 = (
code
 cÚ¡ 
FAR
 *)(¡©e->
Ãxt
);

461 
¡©e
->
Ënb™s
 = 9;

462 
»t
 = 
	`šæ©e_bË
(
LENS
, 
¡©e
->
Ëns
, s‹->
Æ’
, &(¡©e->
Ãxt
),

463 &(
¡©e
->
Ënb™s
), s‹->
wÜk
);

464 ià(
»t
) {

465 
¡rm
->
msg
 = (*)"invalid†iteral/lengths set";

466 
¡©e
->
mode
 = 
BAD
;

469 
¡©e
->
di¡code
 = (
code
 cÚ¡ 
FAR
 *)(¡©e->
Ãxt
);

470 
¡©e
->
di¡b™s
 = 6;

471 
»t
 = 
	`šæ©e_bË
(
DISTS
, 
¡©e
->
Ëns
 + s‹->
Æ’
, s‹->
ndi¡
,

472 &(
¡©e
->
Ãxt
), &(¡©e->
di¡b™s
), s‹->
wÜk
);

473 ià(
»t
) {

474 
¡rm
->
msg
 = (*)"invalid distances set";

475 
¡©e
->
mode
 = 
BAD
;

478 
	`T¿ûv
((
¡d”r
, "inflate: codes ok\n"));

479 
¡©e
->
mode
 = 
LEN
;

481 
LEN
:

483 ià(
have
 >ð6 && 
Ëá
 >= 258) {

484 
	`RESTORE
();

485 ià(
¡©e
->
whave
 < s‹->
wsize
)

486 
¡©e
->
whave
 = s‹->
wsize
 - 
Ëá
;

487 
	`šæ©e_ç¡
(
¡rm
, 
¡©e
->
wsize
);

488 
	`LOAD
();

494 
h”e
 = 
¡©e
->
Ëncode
[
	`BITS
(¡©e->
Ënb™s
)];

495 ià(()(
h”e
.
b™s
) <= bits) ;

496 
	`PULLBYTE
();

498 ià(
h”e
.
Ý
 && (here.op & 0xf0) == 0) {

499 
Ï¡
 = 
h”e
;

501 
h”e
 = 
¡©e
->
Ëncode
[
Ï¡
.
v®
 +

502 (
	`BITS
(
Ï¡
.
b™s
 +†a¡.
Ý
) >>†ast.bits)];

503 ià(()(
Ï¡
.
b™s
 + 
h”e
.bits) <= bits) ;

504 
	`PULLBYTE
();

506 
	`DROPBITS
(
Ï¡
.
b™s
);

508 
	`DROPBITS
(
h”e
.
b™s
);

509 
¡©e
->
Ëngth
 = ()
h”e
.
v®
;

512 ià(
h”e
.
Ý
 == 0) {

513 
	`T¿ûvv
((
¡d”r
, 
h”e
.
v®
 >= 0x20 && here.val < 0x7f ?

515 "šæ©e:†™”® 0x%02x\n", 
h”e
.
v®
));

516 
	`ROOM
();

517 *
put
++ = ()(
¡©e
->
Ëngth
);

518 
Ëá
--;

519 
¡©e
->
mode
 = 
LEN
;

524 ià(
h”e
.
Ý
 & 32) {

525 
	`T¿ûvv
((
¡d”r
, "inflate:ƒnd of block\n"));

526 
¡©e
->
mode
 = 
TYPE
;

531 ià(
h”e
.
Ý
 & 64) {

532 
¡rm
->
msg
 = (*)"invalid†iteral/length code";

533 
¡©e
->
mode
 = 
BAD
;

538 
¡©e
->
exŒa
 = ()(
h”e
.
Ý
) & 15;

539 ià(
¡©e
->
exŒa
 != 0) {

540 
	`NEEDBITS
(
¡©e
->
exŒa
);

541 
¡©e
->
Ëngth
 +ð
	`BITS
(¡©e->
exŒa
);

542 
	`DROPBITS
(
¡©e
->
exŒa
);

544 
	`T¿ûvv
((
¡d”r
, "šæ©e:†’gth %u\n", 
¡©e
->
Ëngth
));

548 
h”e
 = 
¡©e
->
di¡code
[
	`BITS
(¡©e->
di¡b™s
)];

549 ià(()(
h”e
.
b™s
) <= bits) ;

550 
	`PULLBYTE
();

552 ià((
h”e
.
Ý
 & 0xf0) == 0) {

553 
Ï¡
 = 
h”e
;

555 
h”e
 = 
¡©e
->
di¡code
[
Ï¡
.
v®
 +

556 (
	`BITS
(
Ï¡
.
b™s
 +†a¡.
Ý
) >>†ast.bits)];

557 ià(()(
Ï¡
.
b™s
 + 
h”e
.bits) <= bits) ;

558 
	`PULLBYTE
();

560 
	`DROPBITS
(
Ï¡
.
b™s
);

562 
	`DROPBITS
(
h”e
.
b™s
);

563 ià(
h”e
.
Ý
 & 64) {

564 
¡rm
->
msg
 = (*)"invalid distance code";

565 
¡©e
->
mode
 = 
BAD
;

568 
¡©e
->
off£t
 = ()
h”e
.
v®
;

571 
¡©e
->
exŒa
 = ()(
h”e
.
Ý
) & 15;

572 ià(
¡©e
->
exŒa
 != 0) {

573 
	`NEEDBITS
(
¡©e
->
exŒa
);

574 
¡©e
->
off£t
 +ð
	`BITS
(¡©e->
exŒa
);

575 
	`DROPBITS
(
¡©e
->
exŒa
);

577 ià(
¡©e
->
off£t
 > s‹->
wsize
 - (¡©e->
whave
 < state->wsize ?

578 
Ëá
 : 0)) {

579 
¡rm
->
msg
 = (*)"invalid distanceoo far back";

580 
¡©e
->
mode
 = 
BAD
;

583 
	`T¿ûvv
((
¡d”r
, "šæ©e: di¡ªû %u\n", 
¡©e
->
off£t
));

587 
	`ROOM
();

588 
cÝy
 = 
¡©e
->
wsize
 - s‹->
off£t
;

589 ià(
cÝy
 < 
Ëá
) {

590 
äom
 = 
put
 + 
cÝy
;

591 
cÝy
 = 
Ëá
 - copy;

594 
äom
 = 
put
 - 
¡©e
->
off£t
;

595 
cÝy
 = 
Ëá
;

597 ià(
cÝy
 > 
¡©e
->
Ëngth
) copy = state->length;

598 
¡©e
->
Ëngth
 -ð
cÝy
;

599 
Ëá
 -ð
cÝy
;

601 *
put
++ = *
äom
++;

602 } --
cÝy
);

603 } 
¡©e
->
Ëngth
 != 0);

606 
DONE
:

608 
»t
 = 
Z_STREAM_END
;

609 ià(
Ëá
 < 
¡©e
->
wsize
) {

610 ià(
	`out
(
out_desc
, 
¡©e
->
wšdow
, s‹->
wsize
 - 
Ëá
))

611 
»t
 = 
Z_BUF_ERROR
;

613 
šf_Ëave
;

615 
BAD
:

616 
»t
 = 
Z_DATA_ERROR
;

617 
šf_Ëave
;

620 
»t
 = 
Z_STREAM_ERROR
;

621 
šf_Ëave
;

625 
šf_Ëave
:

626 
¡rm
->
Ãxt_š
 = 
Ãxt
;

627 
¡rm
->
avaž_š
 = 
have
;

628  
»t
;

629 
	}
}

631 
ZEXPORT
 
	$šæ©eBackEnd
(
¡rm
)

632 
z_¡»amp
 
¡rm
;

634 ià(
¡rm
 =ð
Z_NULL
 || sŒm->
¡©e
 =ðZ_NULL || sŒm->
zä“
 =ð(
ä“_func
)0)

635  
Z_STREAM_ERROR
;

636 
	`ZFREE
(
¡rm
, sŒm->
¡©e
);

637 
¡rm
->
¡©e
 = 
Z_NULL
;

638 
	`T¿ûv
((
¡d”r
, "inflate:ƒnd\n"));

639  
Z_OK
;

640 
	}
}

	@zlib/inffast.c

6 
	~"zutž.h
"

7 
	~"šá»es.h
"

8 
	~"šæ©e.h
"

9 
	~"šfç¡.h
"

11 #ifdeà
ASMINF


12 #´agm¨
mes§ge
("Assembler code may have bugs -- use‡t your own„isk")

50 
ZLIB_INTERNAL
 
	$šæ©e_ç¡
(
¡rm
, 
¡¬t
)

51 
z_¡»amp
 
¡rm
;

52 
¡¬t
;

54 
šæ©e_¡©e
 
FAR
 *
¡©e
;

55 
z_cÚ¡
 
FAR
 *
š
;

56 
z_cÚ¡
 
FAR
 *
Ï¡
;

57 
FAR
 *
out
;

58 
FAR
 *
beg
;

59 
FAR
 *
’d
;

60 #ifdeà
INFLATE_STRICT


61 
dmax
;

63 
wsize
;

64 
whave
;

65 
wÃxt
;

66 
FAR
 *
wšdow
;

67 
hÞd
;

68 
b™s
;

69 
code
 cÚ¡ 
FAR
 *
lcode
;

70 
code
 cÚ¡ 
FAR
 *
dcode
;

71 
lmask
;

72 
dmask
;

73 
code
 
h”e
;

74 
Ý
;

76 
Ën
;

77 
di¡
;

78 
FAR
 *
äom
;

81 
¡©e
 = (
šæ©e_¡©e
 
FAR
 *)
¡rm
->state;

82 
š
 = 
¡rm
->
Ãxt_š
;

83 
Ï¡
 = 
š
 + (
¡rm
->
avaž_š
 - 5);

84 
out
 = 
¡rm
->
Ãxt_out
;

85 
beg
 = 
out
 - (
¡¬t
 - 
¡rm
->
avaž_out
);

86 
’d
 = 
out
 + (
¡rm
->
avaž_out
 - 257);

87 #ifdeà
INFLATE_STRICT


88 
dmax
 = 
¡©e
->dmax;

90 
wsize
 = 
¡©e
->wsize;

91 
whave
 = 
¡©e
->whave;

92 
wÃxt
 = 
¡©e
->wnext;

93 
wšdow
 = 
¡©e
->window;

94 
hÞd
 = 
¡©e
->hold;

95 
b™s
 = 
¡©e
->bits;

96 
lcode
 = 
¡©e
->
Ëncode
;

97 
dcode
 = 
¡©e
->
di¡code
;

98 
lmask
 = (1U << 
¡©e
->
Ënb™s
) - 1;

99 
dmask
 = (1U << 
¡©e
->
di¡b™s
) - 1;

104 ià(
b™s
 < 15) {

105 
hÞd
 +ð()(*
š
++è<< 
b™s
;

106 
b™s
 += 8;

107 
hÞd
 +ð()(*
š
++è<< 
b™s
;

108 
b™s
 += 8;

110 
h”e
 = 
lcode
[
hÞd
 & 
lmask
];

111 
dÞ’
:

112 
Ý
 = ()(
h”e
.
b™s
);

113 
hÞd
 >>ð
Ý
;

114 
b™s
 -ð
Ý
;

115 
Ý
 = ()(
h”e
.op);

116 ià(
Ý
 == 0) {

117 
	`T¿ûvv
((
¡d”r
, 
h”e
.
v®
 >= 0x20 && here.val < 0x7f ?

119 "šæ©e:†™”® 0x%02x\n", 
h”e
.
v®
));

120 *
out
++ = ()(
h”e
.
v®
);

122 ià(
Ý
 & 16) {

123 
Ën
 = ()(
h”e
.
v®
);

124 
Ý
 &= 15;

125 ià(
Ý
) {

126 ià(
b™s
 < 
Ý
) {

127 
hÞd
 +ð()(*
š
++è<< 
b™s
;

128 
b™s
 += 8;

130 
Ën
 +ð()
hÞd
 & ((1U << 
Ý
) - 1);

131 
hÞd
 >>ð
Ý
;

132 
b™s
 -ð
Ý
;

134 
	`T¿ûvv
((
¡d”r
, "šæ©e:†’gth %u\n", 
Ën
));

135 ià(
b™s
 < 15) {

136 
hÞd
 +ð()(*
š
++è<< 
b™s
;

137 
b™s
 += 8;

138 
hÞd
 +ð()(*
š
++è<< 
b™s
;

139 
b™s
 += 8;

141 
h”e
 = 
dcode
[
hÞd
 & 
dmask
];

142 
dodi¡
:

143 
Ý
 = ()(
h”e
.
b™s
);

144 
hÞd
 >>ð
Ý
;

145 
b™s
 -ð
Ý
;

146 
Ý
 = ()(
h”e
.op);

147 ià(
Ý
 & 16) {

148 
di¡
 = ()(
h”e
.
v®
);

149 
Ý
 &= 15;

150 ià(
b™s
 < 
Ý
) {

151 
hÞd
 +ð()(*
š
++è<< 
b™s
;

152 
b™s
 += 8;

153 ià(
b™s
 < 
Ý
) {

154 
hÞd
 +ð()(*
š
++è<< 
b™s
;

155 
b™s
 += 8;

158 
di¡
 +ð()
hÞd
 & ((1U << 
Ý
) - 1);

159 #ifdeà
INFLATE_STRICT


160 ià(
di¡
 > 
dmax
) {

161 
¡rm
->
msg
 = (*)"invalid distanceoo far back";

162 
¡©e
->
mode
 = 
BAD
;

166 
hÞd
 >>ð
Ý
;

167 
b™s
 -ð
Ý
;

168 
	`T¿ûvv
((
¡d”r
, "šæ©e: di¡ªû %u\n", 
di¡
));

169 
Ý
 = ()(
out
 - 
beg
);

170 ià(
di¡
 > 
Ý
) {

171 
Ý
 = 
di¡
 - op;

172 ià(
Ý
 > 
whave
) {

173 ià(
¡©e
->
§Ã
) {

174 
¡rm
->
msg
 =

176 
¡©e
->
mode
 = 
BAD
;

179 #ifdeà
INFLATE_ALLOW_INVALID_DISTANCE_TOOFAR_ARRR


180 ià(
Ën
 <ð
Ý
 - 
whave
) {

182 *
out
++ = 0;

183 } --
Ën
);

186 
Ën
 -ð
Ý
 - 
whave
;

188 *
out
++ = 0;

189 } --
Ý
 > 
whave
);

190 ià(
Ý
 == 0) {

191 
äom
 = 
out
 - 
di¡
;

193 *
out
++ = *
äom
++;

194 } --
Ën
);

199 
äom
 = 
wšdow
;

200 ià(
wÃxt
 == 0) {

201 
äom
 +ð
wsize
 - 
Ý
;

202 ià(
Ý
 < 
Ën
) {

203 
Ën
 -ð
Ý
;

205 *
out
++ = *
äom
++;

206 } --
Ý
);

207 
äom
 = 
out
 - 
di¡
;

210 ià(
wÃxt
 < 
Ý
) {

211 
äom
 +ð
wsize
 + 
wÃxt
 - 
Ý
;

212 
Ý
 -ð
wÃxt
;

213 ià(
Ý
 < 
Ën
) {

214 
Ën
 -ð
Ý
;

216 *
out
++ = *
äom
++;

217 } --
Ý
);

218 
äom
 = 
wšdow
;

219 ià(
wÃxt
 < 
Ën
) {

220 
Ý
 = 
wÃxt
;

221 
Ën
 -ð
Ý
;

223 *
out
++ = *
äom
++;

224 } --
Ý
);

225 
äom
 = 
out
 - 
di¡
;

230 
äom
 +ð
wÃxt
 - 
Ý
;

231 ià(
Ý
 < 
Ën
) {

232 
Ën
 -ð
Ý
;

234 *
out
++ = *
äom
++;

235 } --
Ý
);

236 
äom
 = 
out
 - 
di¡
;

239 
Ën
 > 2) {

240 *
out
++ = *
äom
++;

241 *
out
++ = *
äom
++;

242 *
out
++ = *
äom
++;

243 
Ën
 -= 3;

245 ià(
Ën
) {

246 *
out
++ = *
äom
++;

247 ià(
Ën
 > 1)

248 *
out
++ = *
äom
++;

252 
äom
 = 
out
 - 
di¡
;

254 *
out
++ = *
äom
++;

255 *
out
++ = *
äom
++;

256 *
out
++ = *
äom
++;

257 
Ën
 -= 3;

258 } 
Ën
 > 2);

259 ià(
Ën
) {

260 *
out
++ = *
äom
++;

261 ià(
Ën
 > 1)

262 *
out
++ = *
äom
++;

266 ià((
Ý
 & 64) == 0) {

267 
h”e
 = 
dcode
[h”e.
v®
 + (
hÞd
 & ((1U << 
Ý
) - 1))];

268 
dodi¡
;

271 
¡rm
->
msg
 = (*)"invalid distance code";

272 
¡©e
->
mode
 = 
BAD
;

276 ià((
Ý
 & 64) == 0) {

277 
h”e
 = 
lcode
[h”e.
v®
 + (
hÞd
 & ((1U << 
Ý
) - 1))];

278 
dÞ’
;

280 ià(
Ý
 & 32) {

281 
	`T¿ûvv
((
¡d”r
, "inflate:ƒnd of block\n"));

282 
¡©e
->
mode
 = 
TYPE
;

286 
¡rm
->
msg
 = (*)"invalid†iteral/length code";

287 
¡©e
->
mode
 = 
BAD
;

290 } 
š
 < 
Ï¡
 && 
out
 < 
’d
);

293 
Ën
 = 
b™s
 >> 3;

294 
š
 -ð
Ën
;

295 
b™s
 -ð
Ën
 << 3;

296 
hÞd
 &ð(1U << 
b™s
) - 1;

299 
¡rm
->
Ãxt_š
 = 
š
;

300 
¡rm
->
Ãxt_out
 = 
out
;

301 
¡rm
->
avaž_š
 = ()(
š
 < 
Ï¡
 ? 5 + (last - in) : 5 - (in -†ast));

302 
¡rm
->
avaž_out
 = ()(
out
 < 
’d
 ?

303 257 + (
’d
 - 
out
) : 257 - (out -ƒnd));

304 
¡©e
->
hÞd
 = hold;

305 
¡©e
->
b™s
 = bits;

307 
	}
}

	@zlib/inffast.h

11 
ZLIB_INTERNAL
 
šæ©e_ç¡
 
OF
((
z_¡»amp
 
¡rm
, 
¡¬t
));

	@zlib/inffixed.h

10 cÚ¡ 
code
 
	gËnfix
[512] = {

87 cÚ¡ 
code
 
	gdi¡fix
[32] = {

	@zlib/inflate.c

83 
	~"zutž.h
"

84 
	~"šá»es.h
"

85 
	~"šæ©e.h
"

86 
	~"šfç¡.h
"

88 #ifdeà
MAKEFIXED


89 #iâdeà
BUILDFIXED


90 
	#BUILDFIXED


	)

95 
loÿl
 
šæ©eS‹Check
 
OF
((
z_¡»amp
 
¡rm
));

96 
loÿl
 
fixedbËs
 
OF
((
šæ©e_¡©e
 
FAR
 *
¡©e
));

97 
loÿl
 
upd©ewšdow
 
OF
((
z_¡»amp
 
¡rm
, cÚ¡ 
FAR
 *
’d
,

98 
cÝy
));

99 #ifdeà
BUILDFIXED


100 
makefixed
 
OF
(());

102 
loÿl
 
sync£¬ch
 
OF
((
FAR
 *
have
, cÚ¡ FAR *
buf
,

103 
Ën
));

105 
loÿl
 
	$šæ©eS‹Check
(
¡rm
)

106 
z_¡»amp
 
¡rm
;

108 
šæ©e_¡©e
 
FAR
 *
¡©e
;

109 ià(
¡rm
 =ð
Z_NULL
 ||

110 
¡rm
->
z®loc
 =ð(
®loc_func
)0 || sŒm->
zä“
 =ð(
ä“_func
)0)

112 
¡©e
 = (
šæ©e_¡©e
 
FAR
 *)
¡rm
->state;

113 ià(
¡©e
 =ð
Z_NULL
 || s‹->
¡rm
 != strm ||

114 
¡©e
->
mode
 < 
HEAD
 || s‹->mod> 
SYNC
)

117 
	}
}

119 
ZEXPORT
 
	$šæ©eRe£tK“p
(
¡rm
)

120 
z_¡»amp
 
¡rm
;

122 
šæ©e_¡©e
 
FAR
 *
¡©e
;

124 ià(
	`šæ©eS‹Check
(
¡rm
)è 
Z_STREAM_ERROR
;

125 
¡©e
 = (
šæ©e_¡©e
 
FAR
 *)
¡rm
->state;

126 
¡rm
->
tÙ®_š
 = sŒm->
tÙ®_out
 = 
¡©e
->
tÙ®
 = 0;

127 
¡rm
->
msg
 = 
Z_NULL
;

128 ià(
¡©e
->
w¿p
)

129 
¡rm
->
adËr
 = 
¡©e
->
w¿p
 & 1;

130 
¡©e
->
mode
 = 
HEAD
;

131 
¡©e
->
Ï¡
 = 0;

132 
¡©e
->
havediù
 = 0;

133 
¡©e
->
dmax
 = 32768U;

134 
¡©e
->
h—d
 = 
Z_NULL
;

135 
¡©e
->
hÞd
 = 0;

136 
¡©e
->
b™s
 = 0;

137 
¡©e
->
Ëncode
 = s‹->
di¡code
 = s‹->
Ãxt
 = s‹->
codes
;

138 
¡©e
->
§Ã
 = 1;

139 
¡©e
->
back
 = -1;

140 
	`T¿ûv
((
¡d”r
, "inflate:„eset\n"));

141  
Z_OK
;

142 
	}
}

144 
ZEXPORT
 
	$šæ©eRe£t
(
¡rm
)

145 
z_¡»amp
 
¡rm
;

147 
šæ©e_¡©e
 
FAR
 *
¡©e
;

149 ià(
	`šæ©eS‹Check
(
¡rm
)è 
Z_STREAM_ERROR
;

150 
¡©e
 = (
šæ©e_¡©e
 
FAR
 *)
¡rm
->state;

151 
¡©e
->
wsize
 = 0;

152 
¡©e
->
whave
 = 0;

153 
¡©e
->
wÃxt
 = 0;

154  
	`šæ©eRe£tK“p
(
¡rm
);

155 
	}
}

157 
ZEXPORT
 
	$šæ©eRe£t2
(
¡rm
, 
wšdowB™s
)

158 
z_¡»amp
 
¡rm
;

159 
wšdowB™s
;

161 
w¿p
;

162 
šæ©e_¡©e
 
FAR
 *
¡©e
;

165 ià(
	`šæ©eS‹Check
(
¡rm
)è 
Z_STREAM_ERROR
;

166 
¡©e
 = (
šæ©e_¡©e
 
FAR
 *)
¡rm
->state;

169 ià(
wšdowB™s
 < 0) {

170 
w¿p
 = 0;

171 
wšdowB™s
 = -windowBits;

174 
w¿p
 = (
wšdowB™s
 >> 4) + 5;

175 #ifdeà
GUNZIP


176 ià(
wšdowB™s
 < 48)

177 
wšdowB™s
 &= 15;

182 ià(
wšdowB™s
 && (windowBits < 8 || windowBits > 15))

183  
Z_STREAM_ERROR
;

184 ià(
¡©e
->
wšdow
 !ð
Z_NULL
 && s‹->
wb™s
 !ð()
wšdowB™s
) {

185 
	`ZFREE
(
¡rm
, 
¡©e
->
wšdow
);

186 
¡©e
->
wšdow
 = 
Z_NULL
;

190 
¡©e
->
w¿p
 = wrap;

191 
¡©e
->
wb™s
 = ()
wšdowB™s
;

192  
	`šæ©eRe£t
(
¡rm
);

193 
	}
}

195 
ZEXPORT
 
	$šæ©eIn™2_
(
¡rm
, 
wšdowB™s
, 
v”siÚ
, 
¡»am_size
)

196 
z_¡»amp
 
¡rm
;

197 
wšdowB™s
;

198 cÚ¡ *
v”siÚ
;

199 
¡»am_size
;

201 
»t
;

202 
šæ©e_¡©e
 
FAR
 *
¡©e
;

204 ià(
v”siÚ
 =ð
Z_NULL
 || v”siÚ[0] !ð
ZLIB_VERSION
[0] ||

205 
¡»am_size
 !ð()((
z_¡»am
)))

206  
Z_VERSION_ERROR
;

207 ià(
¡rm
 =ð
Z_NULL
è 
Z_STREAM_ERROR
;

208 
¡rm
->
msg
 = 
Z_NULL
;

209 ià(
¡rm
->
z®loc
 =ð(
®loc_func
)0) {

210 #ifdeà
Z_SOLO


211  
Z_STREAM_ERROR
;

213 
¡rm
->
z®loc
 = 
zÿÎoc
;

214 
¡rm
->
Ýaque
 = (
voidpf
)0;

217 ià(
¡rm
->
zä“
 =ð(
ä“_func
)0)

218 #ifdeà
Z_SOLO


219  
Z_STREAM_ERROR
;

221 
¡rm
->
zä“
 = 
zcä“
;

223 
¡©e
 = (
šæ©e_¡©e
 
FAR
 *)

224 
	`ZALLOC
(
¡rm
, 1, (
šæ©e_¡©e
));

225 ià(
¡©e
 =ð
Z_NULL
è 
Z_MEM_ERROR
;

226 
	`T¿ûv
((
¡d”r
, "inflate:‡llocated\n"));

227 
¡rm
->
¡©e
 = (
š‹º®_¡©e
 
FAR
 *)state;

228 
¡©e
->
¡rm
 = strm;

229 
¡©e
->
wšdow
 = 
Z_NULL
;

230 
¡©e
->
mode
 = 
HEAD
;

231 
»t
 = 
	`šæ©eRe£t2
(
¡rm
, 
wšdowB™s
);

232 ià(
»t
 !ð
Z_OK
) {

233 
	`ZFREE
(
¡rm
, 
¡©e
);

234 
¡rm
->
¡©e
 = 
Z_NULL
;

236  
»t
;

237 
	}
}

239 
ZEXPORT
 
	$šæ©eIn™_
(
¡rm
, 
v”siÚ
, 
¡»am_size
)

240 
z_¡»amp
 
¡rm
;

241 cÚ¡ *
v”siÚ
;

242 
¡»am_size
;

244  
	`šæ©eIn™2_
(
¡rm
, 
DEF_WBITS
, 
v”siÚ
, 
¡»am_size
);

245 
	}
}

247 
ZEXPORT
 
	$šæ©ePrime
(
¡rm
, 
b™s
, 
v®ue
)

248 
z_¡»amp
 
¡rm
;

249 
b™s
;

250 
v®ue
;

252 
šæ©e_¡©e
 
FAR
 *
¡©e
;

254 ià(
	`šæ©eS‹Check
(
¡rm
)è 
Z_STREAM_ERROR
;

255 
¡©e
 = (
šæ©e_¡©e
 
FAR
 *)
¡rm
->state;

256 ià(
b™s
 < 0) {

257 
¡©e
->
hÞd
 = 0;

258 
¡©e
->
b™s
 = 0;

259  
Z_OK
;

261 ià(
b™s
 > 16 || 
¡©e
->b™ + (
uIÁ
)b™ > 32è 
Z_STREAM_ERROR
;

262 
v®ue
 &ð(1L << 
b™s
) - 1;

263 
¡©e
->
hÞd
 +ð()
v®ue
 << s‹->
b™s
;

264 
¡©e
->
b™s
 +ð(
uIÁ
)bits;

265  
Z_OK
;

266 
	}
}

278 
loÿl
 
	$fixedbËs
(
¡©e
)

279 
šæ©e_¡©e
 
FAR
 *
¡©e
;

281 #ifdeà
BUILDFIXED


282 
vœgš
 = 1;

283 
code
 *
Ënfix
, *
di¡fix
;

284 
code
 
fixed
[544];

287 ià(
vœgš
) {

288 
sym
, 
b™s
;

289 
code
 *
Ãxt
;

292 
sym
 = 0;

293 
sym
 < 144è
¡©e
->
Ëns
[sym++] = 8;

294 
sym
 < 256è
¡©e
->
Ëns
[sym++] = 9;

295 
sym
 < 280è
¡©e
->
Ëns
[sym++] = 7;

296 
sym
 < 288è
¡©e
->
Ëns
[sym++] = 8;

297 
Ãxt
 = 
fixed
;

298 
Ënfix
 = 
Ãxt
;

299 
b™s
 = 9;

300 
	`šæ©e_bË
(
LENS
, 
¡©e
->
Ëns
, 288, &(
Ãxt
), &(
b™s
), s‹->
wÜk
);

303 
sym
 = 0;

304 
sym
 < 32è
¡©e
->
Ëns
[sym++] = 5;

305 
di¡fix
 = 
Ãxt
;

306 
b™s
 = 5;

307 
	`šæ©e_bË
(
DISTS
, 
¡©e
->
Ëns
, 32, &(
Ãxt
), &(
b™s
), s‹->
wÜk
);

310 
vœgš
 = 0;

313 
	~"šffixed.h
"

315 
¡©e
->
Ëncode
 = 
Ënfix
;

316 
¡©e
->
Ënb™s
 = 9;

317 
¡©e
->
di¡code
 = 
di¡fix
;

318 
¡©e
->
di¡b™s
 = 5;

319 
	}
}

321 #ifdeà
MAKEFIXED


322 
	~<¡dio.h
>

342 
	$makefixed
()

344 
low
, 
size
;

345 
šæ©e_¡©e
 
¡©e
;

347 
	`fixedbËs
(&
¡©e
);

348 
	`puts
(" /* inffixed.h --able for decoding fixed codes");

349 
	`puts
(" * Generated‡utomatically by makefixed().");

350 
	`puts
(" */");

351 
	`puts
("");

352 
	`puts
(" /* WARNING:his file should *not* be used by‡pplications.");

353 
	`puts
(" It is…art ofhe implementation ofhis†ibrary‡nd is");

354 
	`puts
(" subjecto change. Applications should only use zlib.h.");

355 
	`puts
(" */");

356 
	`puts
("");

357 
size
 = 1U << 9;

358 
	`´štf
(" stiøcÚ¡ codËnfix[%u] = {", 
size
);

359 
low
 = 0;

361 ià((
low
 % 7è=ð0è
	`´štf
("\n ");

362 
	`´štf
("{%u,%u,%d}", (
low
 & 127è=ð99 ? 64 : 
¡©e
.
Ëncode
[low].
Ý
,

363 
¡©e
.
Ëncode
[
low
].
b™s
, s‹.Ëncode[low].
v®
);

364 ià(++
low
 =ð
size
) ;

365 
	`putch¬
(',');

367 
	`puts
("\n };");

368 
size
 = 1U << 5;

369 
	`´štf
("\À stiøcÚ¡ coddi¡fix[%u] = {", 
size
);

370 
low
 = 0;

372 ià((
low
 % 6è=ð0è
	`´štf
("\n ");

373 
	`´štf
("{%u,%u,%d}", 
¡©e
.
di¡code
[
low
].
Ý
, s‹.di¡code[low].
b™s
,

374 
¡©e
.
di¡code
[
low
].
v®
);

375 ià(++
low
 =ð
size
) ;

376 
	`putch¬
(',');

378 
	`puts
("\n };");

379 
	}
}

396 
loÿl
 
	$upd©ewšdow
(
¡rm
, 
’d
, 
cÝy
)

397 
z_¡»amp
 
¡rm
;

398 cÚ¡ 
By‹f
 *
’d
;

399 
cÝy
;

401 
šæ©e_¡©e
 
FAR
 *
¡©e
;

402 
di¡
;

404 
¡©e
 = (
šæ©e_¡©e
 
FAR
 *)
¡rm
->state;

407 ià(
¡©e
->
wšdow
 =ð
Z_NULL
) {

408 
¡©e
->
wšdow
 = (
FAR
 *)

409 
	`ZALLOC
(
¡rm
, 1U << 
¡©e
->
wb™s
,

411 ià(
¡©e
->
wšdow
 =ð
Z_NULL
)  1;

415 ià(
¡©e
->
wsize
 == 0) {

416 
¡©e
->
wsize
 = 1U << s‹->
wb™s
;

417 
¡©e
->
wÃxt
 = 0;

418 
¡©e
->
whave
 = 0;

422 ià(
cÝy
 >ð
¡©e
->
wsize
) {

423 
	`zmemýy
(
¡©e
->
wšdow
, 
’d
 - s‹->
wsize
, state->wsize);

424 
¡©e
->
wÃxt
 = 0;

425 
¡©e
->
whave
 = s‹->
wsize
;

428 
di¡
 = 
¡©e
->
wsize
 - s‹->
wÃxt
;

429 ià(
di¡
 > 
cÝy
) dist = copy;

430 
	`zmemýy
(
¡©e
->
wšdow
 + s‹->
wÃxt
, 
’d
 - 
cÝy
, 
di¡
);

431 
cÝy
 -ð
di¡
;

432 ià(
cÝy
) {

433 
	`zmemýy
(
¡©e
->
wšdow
, 
’d
 - 
cÝy
, copy);

434 
¡©e
->
wÃxt
 = 
cÝy
;

435 
¡©e
->
whave
 = s‹->
wsize
;

438 
¡©e
->
wÃxt
 +ð
di¡
;

439 ià(
¡©e
->
wÃxt
 =ð¡©e->
wsize
) state->wnext = 0;

440 ià(
¡©e
->
whave
 < s‹->
wsize
è¡©e->whav+ð
di¡
;

444 
	}
}

449 #ifdeà
GUNZIP


450 
	#UPDATE
(
check
, 
buf
, 
Ën
) \

451 (
¡©e
->
æags
 ? 
	`üc32
(
check
, 
buf
, 
Ën
è: 
	`adËr32
(check, buf,†’))

	)

453 
	#UPDATE
(
check
, 
buf
, 
Ën
è
	`adËr32
(check, buf,†’)

	)

457 #ifdeà
GUNZIP


458 
	#CRC2
(
check
, 
wÜd
) \

460 
hbuf
[0] = ()(
wÜd
); \

461 
hbuf
[1] = ()((
wÜd
) >> 8); \

462 
check
 = 
	`üc32
(check, 
hbuf
, 2); \

463 } 0)

	)

465 
	#CRC4
(
check
, 
wÜd
) \

467 
hbuf
[0] = ()(
wÜd
); \

468 
hbuf
[1] = ()((
wÜd
) >> 8); \

469 
hbuf
[2] = ()((
wÜd
) >> 16); \

470 
hbuf
[3] = ()((
wÜd
) >> 24); \

471 
check
 = 
	`üc32
(check, 
hbuf
, 4); \

472 } 0)

	)

476 
	#LOAD
() \

478 
put
 = 
¡rm
->
Ãxt_out
; \

479 
Ëá
 = 
¡rm
->
avaž_out
; \

480 
Ãxt
 = 
¡rm
->
Ãxt_š
; \

481 
have
 = 
¡rm
->
avaž_š
; \

482 
hÞd
 = 
¡©e
->hold; \

483 
b™s
 = 
¡©e
->bits; \

484 } 0)

	)

487 
	#RESTORE
() \

489 
¡rm
->
Ãxt_out
 = 
put
; \

490 
¡rm
->
avaž_out
 = 
Ëá
; \

491 
¡rm
->
Ãxt_š
 = 
Ãxt
; \

492 
¡rm
->
avaž_š
 = 
have
; \

493 
¡©e
->
hÞd
 = hold; \

494 
¡©e
->
b™s
 = bits; \

495 } 0)

	)

498 
	#INITBITS
() \

500 
hÞd
 = 0; \

501 
b™s
 = 0; \

502 } 0)

	)

506 
	#PULLBYTE
() \

508 ià(
have
 =ð0è
šf_Ëave
; \

509 
have
--; \

510 
hÞd
 +ð()(*
Ãxt
++è<< 
b™s
; \

511 
b™s
 += 8; \

512 } 0)

	)

516 
	#NEEDBITS
(
n
) \

518 
b™s
 < ()(
n
)) \

519 
	`PULLBYTE
(); \

520 } 0)

	)

523 
	#BITS
(
n
) \

524 (()
hÞd
 & ((1U << (
n
)è- 1))

	)

527 
	#DROPBITS
(
n
) \

529 
hÞd
 >>ð(
n
); \

530 
b™s
 -ð()(
n
); \

531 } 0)

	)

534 
	#BYTEBITS
() \

536 
hÞd
 >>ð
b™s
 & 7; \

537 
b™s
 -= bits & 7; \

538 } 0)

	)

622 
ZEXPORT
 
	$šæ©e
(
¡rm
, 
æush
)

623 
z_¡»amp
 
¡rm
;

624 
æush
;

626 
šæ©e_¡©e
 
FAR
 *
¡©e
;

627 
z_cÚ¡
 
FAR
 *
Ãxt
;

628 
FAR
 *
put
;

629 
have
, 
Ëá
;

630 
hÞd
;

631 
b™s
;

632 
š
, 
out
;

633 
cÝy
;

634 
FAR
 *
äom
;

635 
code
 
h”e
;

636 
code
 
Ï¡
;

637 
Ën
;

638 
»t
;

639 #ifdeà
GUNZIP


640 
hbuf
[4];

642 cÚ¡ 
Üd”
[19] =

645 ià(
	`šæ©eS‹Check
(
¡rm
è|| sŒm->
Ãxt_out
 =ð
Z_NULL
 ||

646 (
¡rm
->
Ãxt_š
 =ð
Z_NULL
 && sŒm->
avaž_š
 != 0))

647  
Z_STREAM_ERROR
;

649 
¡©e
 = (
šæ©e_¡©e
 
FAR
 *)
¡rm
->state;

650 ià(
¡©e
->
mode
 =ð
TYPE
è¡©e->modð
TYPEDO
;

651 
	`LOAD
();

652 
š
 = 
have
;

653 
out
 = 
Ëá
;

654 
»t
 = 
Z_OK
;

656 
¡©e
->
mode
) {

657 
HEAD
:

658 ià(
¡©e
->
w¿p
 == 0) {

659 
¡©e
->
mode
 = 
TYPEDO
;

662 
	`NEEDBITS
(16);

663 #ifdeà
GUNZIP


664 ià((
¡©e
->
w¿p
 & 2è&& 
hÞd
 == 0x8b1f) {

665 ià(
¡©e
->
wb™s
 == 0)

666 
¡©e
->
wb™s
 = 15;

667 
¡©e
->
check
 = 
	`üc32
(0L, 
Z_NULL
, 0);

668 
	`CRC2
(
¡©e
->
check
, 
hÞd
);

669 
	`INITBITS
();

670 
¡©e
->
mode
 = 
FLAGS
;

673 
¡©e
->
æags
 = 0;

674 ià(
¡©e
->
h—d
 !ð
Z_NULL
)

675 
¡©e
->
h—d
->
dÚe
 = -1;

676 ià(!(
¡©e
->
w¿p
 & 1) ||

680 ((
	`BITS
(8è<< 8è+ (
hÞd
 >> 8)) % 31) {

681 
¡rm
->
msg
 = (*)"incorrect header check";

682 
¡©e
->
mode
 = 
BAD
;

685 ià(
	`BITS
(4è!ð
Z_DEFLATED
) {

686 
¡rm
->
msg
 = (*)"unknown compression method";

687 
¡©e
->
mode
 = 
BAD
;

690 
	`DROPBITS
(4);

691 
Ën
 = 
	`BITS
(4) + 8;

692 ià(
¡©e
->
wb™s
 == 0)

693 
¡©e
->
wb™s
 = 
Ën
;

694 ià(
Ën
 > 15 ||†’ > 
¡©e
->
wb™s
) {

695 
¡rm
->
msg
 = (*)"invalid window size";

696 
¡©e
->
mode
 = 
BAD
;

699 
¡©e
->
dmax
 = 1U << 
Ën
;

700 
	`T¿ûv
((
¡d”r
, "inflate: zlib header ok\n"));

701 
¡rm
->
adËr
 = 
¡©e
->
check
 = 
	`adËr32
(0L, 
Z_NULL
, 0);

702 
¡©e
->
mode
 = 
hÞd
 & 0x200 ? 
DICTID
 : 
TYPE
;

703 
	`INITBITS
();

705 #ifdeà
GUNZIP


706 
FLAGS
:

707 
	`NEEDBITS
(16);

708 
¡©e
->
æags
 = ()(
hÞd
);

709 ià((
¡©e
->
æags
 & 0xffè!ð
Z_DEFLATED
) {

710 
¡rm
->
msg
 = (*)"unknown compression method";

711 
¡©e
->
mode
 = 
BAD
;

714 ià(
¡©e
->
æags
 & 0xe000) {

715 
¡rm
->
msg
 = (*)"unknown header flags set";

716 
¡©e
->
mode
 = 
BAD
;

719 ià(
¡©e
->
h—d
 !ð
Z_NULL
)

720 
¡©e
->
h—d
->
‹xt
 = ()((
hÞd
 >> 8) & 1);

721 ià((
¡©e
->
æags
 & 0x0200è&& (¡©e->
w¿p
 & 4))

722 
	`CRC2
(
¡©e
->
check
, 
hÞd
);

723 
	`INITBITS
();

724 
¡©e
->
mode
 = 
TIME
;

725 
TIME
:

726 
	`NEEDBITS
(32);

727 ià(
¡©e
->
h—d
 !ð
Z_NULL
)

728 
¡©e
->
h—d
->
time
 = 
hÞd
;

729 ià((
¡©e
->
æags
 & 0x0200è&& (¡©e->
w¿p
 & 4))

730 
	`CRC4
(
¡©e
->
check
, 
hÞd
);

731 
	`INITBITS
();

732 
¡©e
->
mode
 = 
OS
;

733 
OS
:

734 
	`NEEDBITS
(16);

735 ià(
¡©e
->
h—d
 !ð
Z_NULL
) {

736 
¡©e
->
h—d
->
xæags
 = ()(
hÞd
 & 0xff);

737 
¡©e
->
h—d
->
os
 = ()(
hÞd
 >> 8);

739 ià((
¡©e
->
æags
 & 0x0200è&& (¡©e->
w¿p
 & 4))

740 
	`CRC2
(
¡©e
->
check
, 
hÞd
);

741 
	`INITBITS
();

742 
¡©e
->
mode
 = 
EXLEN
;

743 
EXLEN
:

744 ià(
¡©e
->
æags
 & 0x0400) {

745 
	`NEEDBITS
(16);

746 
¡©e
->
Ëngth
 = ()(
hÞd
);

747 ià(
¡©e
->
h—d
 !ð
Z_NULL
)

748 
¡©e
->
h—d
->
exŒa_Ën
 = ()
hÞd
;

749 ià((
¡©e
->
æags
 & 0x0200è&& (¡©e->
w¿p
 & 4))

750 
	`CRC2
(
¡©e
->
check
, 
hÞd
);

751 
	`INITBITS
();

753 ià(
¡©e
->
h—d
 !ð
Z_NULL
)

754 
¡©e
->
h—d
->
exŒa
 = 
Z_NULL
;

755 
¡©e
->
mode
 = 
EXTRA
;

756 
EXTRA
:

757 ià(
¡©e
->
æags
 & 0x0400) {

758 
cÝy
 = 
¡©e
->
Ëngth
;

759 ià(
cÝy
 > 
have
) copy = have;

760 ià(
cÝy
) {

761 ià(
¡©e
->
h—d
 !ð
Z_NULL
 &&

762 
¡©e
->
h—d
->
exŒa
 !ð
Z_NULL
) {

763 
Ën
 = 
¡©e
->
h—d
->
exŒa_Ën
 - s‹->
Ëngth
;

764 
	`zmemýy
(
¡©e
->
h—d
->
exŒa
 + 
Ën
, 
Ãxt
,

765 
Ën
 + 
cÝy
 > 
¡©e
->
h—d
->
exŒa_max
 ?

766 
¡©e
->
h—d
->
exŒa_max
 - 
Ën
 : 
cÝy
);

768 ià((
¡©e
->
æags
 & 0x0200è&& (¡©e->
w¿p
 & 4))

769 
¡©e
->
check
 = 
	`üc32
(¡©e->check, 
Ãxt
, 
cÝy
);

770 
have
 -ð
cÝy
;

771 
Ãxt
 +ð
cÝy
;

772 
¡©e
->
Ëngth
 -ð
cÝy
;

774 ià(
¡©e
->
Ëngth
è
šf_Ëave
;

776 
¡©e
->
Ëngth
 = 0;

777 
¡©e
->
mode
 = 
NAME
;

778 
NAME
:

779 ià(
¡©e
->
æags
 & 0x0800) {

780 ià(
have
 =ð0è
šf_Ëave
;

781 
cÝy
 = 0;

783 
Ën
 = ()(
Ãxt
[
cÝy
++]);

784 ià(
¡©e
->
h—d
 !ð
Z_NULL
 &&

785 
¡©e
->
h—d
->
Çme
 !ð
Z_NULL
 &&

786 
¡©e
->
Ëngth
 < s‹->
h—d
->
Çme_max
)

787 
¡©e
->
h—d
->
Çme
[¡©e->
Ëngth
++] = (
By‹f
)
Ën
;

788 } 
Ën
 && 
cÝy
 < 
have
);

789 ià((
¡©e
->
æags
 & 0x0200è&& (¡©e->
w¿p
 & 4))

790 
¡©e
->
check
 = 
	`üc32
(¡©e->check, 
Ãxt
, 
cÝy
);

791 
have
 -ð
cÝy
;

792 
Ãxt
 +ð
cÝy
;

793 ià(
Ën
è
šf_Ëave
;

795 ià(
¡©e
->
h—d
 !ð
Z_NULL
)

796 
¡©e
->
h—d
->
Çme
 = 
Z_NULL
;

797 
¡©e
->
Ëngth
 = 0;

798 
¡©e
->
mode
 = 
COMMENT
;

799 
COMMENT
:

800 ià(
¡©e
->
æags
 & 0x1000) {

801 ià(
have
 =ð0è
šf_Ëave
;

802 
cÝy
 = 0;

804 
Ën
 = ()(
Ãxt
[
cÝy
++]);

805 ià(
¡©e
->
h—d
 !ð
Z_NULL
 &&

806 
¡©e
->
h—d
->
comm’t
 !ð
Z_NULL
 &&

807 
¡©e
->
Ëngth
 < s‹->
h—d
->
comm_max
)

808 
¡©e
->
h—d
->
comm’t
[¡©e->
Ëngth
++] = (
By‹f
)
Ën
;

809 } 
Ën
 && 
cÝy
 < 
have
);

810 ià((
¡©e
->
æags
 & 0x0200è&& (¡©e->
w¿p
 & 4))

811 
¡©e
->
check
 = 
	`üc32
(¡©e->check, 
Ãxt
, 
cÝy
);

812 
have
 -ð
cÝy
;

813 
Ãxt
 +ð
cÝy
;

814 ià(
Ën
è
šf_Ëave
;

816 ià(
¡©e
->
h—d
 !ð
Z_NULL
)

817 
¡©e
->
h—d
->
comm’t
 = 
Z_NULL
;

818 
¡©e
->
mode
 = 
HCRC
;

819 
HCRC
:

820 ià(
¡©e
->
æags
 & 0x0200) {

821 
	`NEEDBITS
(16);

822 ià((
¡©e
->
w¿p
 & 4è&& 
hÞd
 !ð(¡©e->
check
 & 0xffff)) {

823 
¡rm
->
msg
 = (*)"header crc mismatch";

824 
¡©e
->
mode
 = 
BAD
;

827 
	`INITBITS
();

829 ià(
¡©e
->
h—d
 !ð
Z_NULL
) {

830 
¡©e
->
h—d
->
hüc
 = ()((¡©e->
æags
 >> 9) & 1);

831 
¡©e
->
h—d
->
dÚe
 = 1;

833 
¡rm
->
adËr
 = 
¡©e
->
check
 = 
	`üc32
(0L, 
Z_NULL
, 0);

834 
¡©e
->
mode
 = 
TYPE
;

837 
DICTID
:

838 
	`NEEDBITS
(32);

839 
¡rm
->
adËr
 = 
¡©e
->
check
 = 
	`ZSWAP32
(
hÞd
);

840 
	`INITBITS
();

841 
¡©e
->
mode
 = 
DICT
;

842 
DICT
:

843 ià(
¡©e
->
havediù
 == 0) {

844 
	`RESTORE
();

845  
Z_NEED_DICT
;

847 
¡rm
->
adËr
 = 
¡©e
->
check
 = 
	`adËr32
(0L, 
Z_NULL
, 0);

848 
¡©e
->
mode
 = 
TYPE
;

849 
TYPE
:

850 ià(
æush
 =ð
Z_BLOCK
 || flush =ð
Z_TREES
è
šf_Ëave
;

851 
TYPEDO
:

852 ià(
¡©e
->
Ï¡
) {

853 
	`BYTEBITS
();

854 
¡©e
->
mode
 = 
CHECK
;

857 
	`NEEDBITS
(3);

858 
¡©e
->
Ï¡
 = 
	`BITS
(1);

859 
	`DROPBITS
(1);

860 
	`BITS
(2)) {

862 
	`T¿ûv
((
¡d”r
, "inflate: stored block%s\n",

863 
¡©e
->
Ï¡
 ? " (last)" : ""));

864 
¡©e
->
mode
 = 
STORED
;

867 
	`fixedbËs
(
¡©e
);

868 
	`T¿ûv
((
¡d”r
, "inflate: fixed codes block%s\n",

869 
¡©e
->
Ï¡
 ? " (last)" : ""));

870 
¡©e
->
mode
 = 
LEN_
;

871 ià(
æush
 =ð
Z_TREES
) {

872 
	`DROPBITS
(2);

873 
šf_Ëave
;

877 
	`T¿ûv
((
¡d”r
, "inflate: dynamic codes block%s\n",

878 
¡©e
->
Ï¡
 ? " (last)" : ""));

879 
¡©e
->
mode
 = 
TABLE
;

882 
¡rm
->
msg
 = (*)"invalid blockype";

883 
¡©e
->
mode
 = 
BAD
;

885 
	`DROPBITS
(2);

887 
STORED
:

888 
	`BYTEBITS
();

889 
	`NEEDBITS
(32);

890 ià((
hÞd
 & 0xffff) != ((hold >> 16) ^ 0xffff)) {

891 
¡rm
->
msg
 = (*)"invalid stored block†engths";

892 
¡©e
->
mode
 = 
BAD
;

895 
¡©e
->
Ëngth
 = ()
hÞd
 & 0xffff;

896 
	`T¿ûv
((
¡d”r
, "inflate: stored†ength %u\n",

897 
¡©e
->
Ëngth
));

898 
	`INITBITS
();

899 
¡©e
->
mode
 = 
COPY_
;

900 ià(
æush
 =ð
Z_TREES
è
šf_Ëave
;

901 
COPY_
:

902 
¡©e
->
mode
 = 
COPY
;

903 
COPY
:

904 
cÝy
 = 
¡©e
->
Ëngth
;

905 ià(
cÝy
) {

906 ià(
cÝy
 > 
have
) copy = have;

907 ià(
cÝy
 > 
Ëá
) copy =†eft;

908 ià(
cÝy
 =ð0è
šf_Ëave
;

909 
	`zmemýy
(
put
, 
Ãxt
, 
cÝy
);

910 
have
 -ð
cÝy
;

911 
Ãxt
 +ð
cÝy
;

912 
Ëá
 -ð
cÝy
;

913 
put
 +ð
cÝy
;

914 
¡©e
->
Ëngth
 -ð
cÝy
;

917 
	`T¿ûv
((
¡d”r
, "inflate: storedƒnd\n"));

918 
¡©e
->
mode
 = 
TYPE
;

920 
TABLE
:

921 
	`NEEDBITS
(14);

922 
¡©e
->
Æ’
 = 
	`BITS
(5) + 257;

923 
	`DROPBITS
(5);

924 
¡©e
->
ndi¡
 = 
	`BITS
(5) + 1;

925 
	`DROPBITS
(5);

926 
¡©e
->
ncode
 = 
	`BITS
(4) + 4;

927 
	`DROPBITS
(4);

928 #iâdeà
PKZIP_BUG_WORKAROUND


929 ià(
¡©e
->
Æ’
 > 286 || s‹->
ndi¡
 > 30) {

930 
¡rm
->
msg
 = (*)"too many†ength or distance symbols";

931 
¡©e
->
mode
 = 
BAD
;

935 
	`T¿ûv
((
¡d”r
, "inflate:able sizes ok\n"));

936 
¡©e
->
have
 = 0;

937 
¡©e
->
mode
 = 
LENLENS
;

938 
LENLENS
:

939 
¡©e
->
have
 < s‹->
ncode
) {

940 
	`NEEDBITS
(3);

941 
¡©e
->
Ëns
[
Üd”
[¡©e->
have
++]] = ()
	`BITS
(3);

942 
	`DROPBITS
(3);

944 
¡©e
->
have
 < 19)

945 
¡©e
->
Ëns
[
Üd”
[¡©e->
have
++]] = 0;

946 
¡©e
->
Ãxt
 = s‹->
codes
;

947 
¡©e
->
Ëncode
 = (cÚ¡ 
code
 
FAR
 *)(¡©e->
Ãxt
);

948 
¡©e
->
Ënb™s
 = 7;

949 
»t
 = 
	`šæ©e_bË
(
CODES
, 
¡©e
->
Ëns
, 19, &(¡©e->
Ãxt
),

950 &(
¡©e
->
Ënb™s
), s‹->
wÜk
);

951 ià(
»t
) {

952 
¡rm
->
msg
 = (*)"invalid code†engths set";

953 
¡©e
->
mode
 = 
BAD
;

956 
	`T¿ûv
((
¡d”r
, "inflate: code†engths ok\n"));

957 
¡©e
->
have
 = 0;

958 
¡©e
->
mode
 = 
CODELENS
;

959 
CODELENS
:

960 
¡©e
->
have
 < s‹->
Æ’
 + s‹->
ndi¡
) {

962 
h”e
 = 
¡©e
->
Ëncode
[
	`BITS
(¡©e->
Ënb™s
)];

963 ià(()(
h”e
.
b™s
) <= bits) ;

964 
	`PULLBYTE
();

966 ià(
h”e
.
v®
 < 16) {

967 
	`DROPBITS
(
h”e
.
b™s
);

968 
¡©e
->
Ëns
[¡©e->
have
++] = 
h”e
.
v®
;

971 ià(
h”e
.
v®
 == 16) {

972 
	`NEEDBITS
(
h”e
.
b™s
 + 2);

973 
	`DROPBITS
(
h”e
.
b™s
);

974 ià(
¡©e
->
have
 == 0) {

975 
¡rm
->
msg
 = (*)"invalid bit†ength„epeat";

976 
¡©e
->
mode
 = 
BAD
;

979 
Ën
 = 
¡©e
->
Ëns
[¡©e->
have
 - 1];

980 
cÝy
 = 3 + 
	`BITS
(2);

981 
	`DROPBITS
(2);

983 ià(
h”e
.
v®
 == 17) {

984 
	`NEEDBITS
(
h”e
.
b™s
 + 3);

985 
	`DROPBITS
(
h”e
.
b™s
);

986 
Ën
 = 0;

987 
cÝy
 = 3 + 
	`BITS
(3);

988 
	`DROPBITS
(3);

991 
	`NEEDBITS
(
h”e
.
b™s
 + 7);

992 
	`DROPBITS
(
h”e
.
b™s
);

993 
Ën
 = 0;

994 
cÝy
 = 11 + 
	`BITS
(7);

995 
	`DROPBITS
(7);

997 ià(
¡©e
->
have
 + 
cÝy
 > s‹->
Æ’
 + s‹->
ndi¡
) {

998 
¡rm
->
msg
 = (*)"invalid bit†ength„epeat";

999 
¡©e
->
mode
 = 
BAD
;

1002 
cÝy
--)

1003 
¡©e
->
Ëns
[¡©e->
have
++] = ()
Ën
;

1008 ià(
¡©e
->
mode
 =ð
BAD
) ;

1011 ià(
¡©e
->
Ëns
[256] == 0) {

1012 
¡rm
->
msg
 = (*)"invalid code -- missingƒnd-of-block";

1013 
¡©e
->
mode
 = 
BAD
;

1020 
¡©e
->
Ãxt
 = s‹->
codes
;

1021 
¡©e
->
Ëncode
 = (cÚ¡ 
code
 
FAR
 *)(¡©e->
Ãxt
);

1022 
¡©e
->
Ënb™s
 = 9;

1023 
»t
 = 
	`šæ©e_bË
(
LENS
, 
¡©e
->
Ëns
, s‹->
Æ’
, &(¡©e->
Ãxt
),

1024 &(
¡©e
->
Ënb™s
), s‹->
wÜk
);

1025 ià(
»t
) {

1026 
¡rm
->
msg
 = (*)"invalid†iteral/lengths set";

1027 
¡©e
->
mode
 = 
BAD
;

1030 
¡©e
->
di¡code
 = (cÚ¡ 
code
 
FAR
 *)(¡©e->
Ãxt
);

1031 
¡©e
->
di¡b™s
 = 6;

1032 
»t
 = 
	`šæ©e_bË
(
DISTS
, 
¡©e
->
Ëns
 + s‹->
Æ’
, s‹->
ndi¡
,

1033 &(
¡©e
->
Ãxt
), &(¡©e->
di¡b™s
), s‹->
wÜk
);

1034 ià(
»t
) {

1035 
¡rm
->
msg
 = (*)"invalid distances set";

1036 
¡©e
->
mode
 = 
BAD
;

1039 
	`T¿ûv
((
¡d”r
, "inflate: codes ok\n"));

1040 
¡©e
->
mode
 = 
LEN_
;

1041 ià(
æush
 =ð
Z_TREES
è
šf_Ëave
;

1042 
LEN_
:

1043 
¡©e
->
mode
 = 
LEN
;

1044 
LEN
:

1045 ià(
have
 >ð6 && 
Ëá
 >= 258) {

1046 
	`RESTORE
();

1047 
	`šæ©e_ç¡
(
¡rm
, 
out
);

1048 
	`LOAD
();

1049 ià(
¡©e
->
mode
 =ð
TYPE
)

1050 
¡©e
->
back
 = -1;

1053 
¡©e
->
back
 = 0;

1055 
h”e
 = 
¡©e
->
Ëncode
[
	`BITS
(¡©e->
Ënb™s
)];

1056 ià(()(
h”e
.
b™s
) <= bits) ;

1057 
	`PULLBYTE
();

1059 ià(
h”e
.
Ý
 && (here.op & 0xf0) == 0) {

1060 
Ï¡
 = 
h”e
;

1062 
h”e
 = 
¡©e
->
Ëncode
[
Ï¡
.
v®
 +

1063 (
	`BITS
(
Ï¡
.
b™s
 +†a¡.
Ý
) >>†ast.bits)];

1064 ià(()(
Ï¡
.
b™s
 + 
h”e
.bits) <= bits) ;

1065 
	`PULLBYTE
();

1067 
	`DROPBITS
(
Ï¡
.
b™s
);

1068 
¡©e
->
back
 +ð
Ï¡
.
b™s
;

1070 
	`DROPBITS
(
h”e
.
b™s
);

1071 
¡©e
->
back
 +ð
h”e
.
b™s
;

1072 
¡©e
->
Ëngth
 = ()
h”e
.
v®
;

1073 ià(()(
h”e
.
Ý
) == 0) {

1074 
	`T¿ûvv
((
¡d”r
, 
h”e
.
v®
 >= 0x20 && here.val < 0x7f ?

1076 "šæ©e:†™”® 0x%02x\n", 
h”e
.
v®
));

1077 
¡©e
->
mode
 = 
LIT
;

1080 ià(
h”e
.
Ý
 & 32) {

1081 
	`T¿ûvv
((
¡d”r
, "inflate:ƒnd of block\n"));

1082 
¡©e
->
back
 = -1;

1083 
¡©e
->
mode
 = 
TYPE
;

1086 ià(
h”e
.
Ý
 & 64) {

1087 
¡rm
->
msg
 = (*)"invalid†iteral/length code";

1088 
¡©e
->
mode
 = 
BAD
;

1091 
¡©e
->
exŒa
 = ()(
h”e
.
Ý
) & 15;

1092 
¡©e
->
mode
 = 
LENEXT
;

1093 
LENEXT
:

1094 ià(
¡©e
->
exŒa
) {

1095 
	`NEEDBITS
(
¡©e
->
exŒa
);

1096 
¡©e
->
Ëngth
 +ð
	`BITS
(¡©e->
exŒa
);

1097 
	`DROPBITS
(
¡©e
->
exŒa
);

1098 
¡©e
->
back
 +ð¡©e->
exŒa
;

1100 
	`T¿ûvv
((
¡d”r
, "šæ©e:†’gth %u\n", 
¡©e
->
Ëngth
));

1101 
¡©e
->
was
 = s‹->
Ëngth
;

1102 
¡©e
->
mode
 = 
DIST
;

1103 
DIST
:

1105 
h”e
 = 
¡©e
->
di¡code
[
	`BITS
(¡©e->
di¡b™s
)];

1106 ià(()(
h”e
.
b™s
) <= bits) ;

1107 
	`PULLBYTE
();

1109 ià((
h”e
.
Ý
 & 0xf0) == 0) {

1110 
Ï¡
 = 
h”e
;

1112 
h”e
 = 
¡©e
->
di¡code
[
Ï¡
.
v®
 +

1113 (
	`BITS
(
Ï¡
.
b™s
 +†a¡.
Ý
) >>†ast.bits)];

1114 ià(()(
Ï¡
.
b™s
 + 
h”e
.bits) <= bits) ;

1115 
	`PULLBYTE
();

1117 
	`DROPBITS
(
Ï¡
.
b™s
);

1118 
¡©e
->
back
 +ð
Ï¡
.
b™s
;

1120 
	`DROPBITS
(
h”e
.
b™s
);

1121 
¡©e
->
back
 +ð
h”e
.
b™s
;

1122 ià(
h”e
.
Ý
 & 64) {

1123 
¡rm
->
msg
 = (*)"invalid distance code";

1124 
¡©e
->
mode
 = 
BAD
;

1127 
¡©e
->
off£t
 = ()
h”e
.
v®
;

1128 
¡©e
->
exŒa
 = ()(
h”e
.
Ý
) & 15;

1129 
¡©e
->
mode
 = 
DISTEXT
;

1130 
DISTEXT
:

1131 ià(
¡©e
->
exŒa
) {

1132 
	`NEEDBITS
(
¡©e
->
exŒa
);

1133 
¡©e
->
off£t
 +ð
	`BITS
(¡©e->
exŒa
);

1134 
	`DROPBITS
(
¡©e
->
exŒa
);

1135 
¡©e
->
back
 +ð¡©e->
exŒa
;

1137 #ifdeà
INFLATE_STRICT


1138 ià(
¡©e
->
off£t
 > s‹->
dmax
) {

1139 
¡rm
->
msg
 = (*)"invalid distanceoo far back";

1140 
¡©e
->
mode
 = 
BAD
;

1144 
	`T¿ûvv
((
¡d”r
, "šæ©e: di¡ªû %u\n", 
¡©e
->
off£t
));

1145 
¡©e
->
mode
 = 
MATCH
;

1146 
MATCH
:

1147 ià(
Ëá
 =ð0è
šf_Ëave
;

1148 
cÝy
 = 
out
 - 
Ëá
;

1149 ià(
¡©e
->
off£t
 > 
cÝy
) {

1150 
cÝy
 = 
¡©e
->
off£t
 - copy;

1151 ià(
cÝy
 > 
¡©e
->
whave
) {

1152 ià(
¡©e
->
§Ã
) {

1153 
¡rm
->
msg
 = (*)"invalid distanceoo far back";

1154 
¡©e
->
mode
 = 
BAD
;

1157 #ifdeà
INFLATE_ALLOW_INVALID_DISTANCE_TOOFAR_ARRR


1158 
	`T¿û
((
¡d”r
, "inflate.coo far\n"));

1159 
cÝy
 -ð
¡©e
->
whave
;

1160 ià(
cÝy
 > 
¡©e
->
Ëngth
) copy = state->length;

1161 ià(
cÝy
 > 
Ëá
) copy =†eft;

1162 
Ëá
 -ð
cÝy
;

1163 
¡©e
->
Ëngth
 -ð
cÝy
;

1165 *
put
++ = 0;

1166 } --
cÝy
);

1167 ià(
¡©e
->
Ëngth
 =ð0è¡©e->
mode
 = 
LEN
;

1171 ià(
cÝy
 > 
¡©e
->
wÃxt
) {

1172 
cÝy
 -ð
¡©e
->
wÃxt
;

1173 
äom
 = 
¡©e
->
wšdow
 + (¡©e->
wsize
 - 
cÝy
);

1176 
äom
 = 
¡©e
->
wšdow
 + (¡©e->
wÃxt
 - 
cÝy
);

1177 ià(
cÝy
 > 
¡©e
->
Ëngth
) copy = state->length;

1180 
äom
 = 
put
 - 
¡©e
->
off£t
;

1181 
cÝy
 = 
¡©e
->
Ëngth
;

1183 ià(
cÝy
 > 
Ëá
) copy =†eft;

1184 
Ëá
 -ð
cÝy
;

1185 
¡©e
->
Ëngth
 -ð
cÝy
;

1187 *
put
++ = *
äom
++;

1188 } --
cÝy
);

1189 ià(
¡©e
->
Ëngth
 =ð0è¡©e->
mode
 = 
LEN
;

1191 
LIT
:

1192 ià(
Ëá
 =ð0è
šf_Ëave
;

1193 *
put
++ = ()(
¡©e
->
Ëngth
);

1194 
Ëá
--;

1195 
¡©e
->
mode
 = 
LEN
;

1197 
CHECK
:

1198 ià(
¡©e
->
w¿p
) {

1199 
	`NEEDBITS
(32);

1200 
out
 -ð
Ëá
;

1201 
¡rm
->
tÙ®_out
 +ð
out
;

1202 
¡©e
->
tÙ®
 +ð
out
;

1203 ià((
¡©e
->
w¿p
 & 4è&& 
out
)

1204 
¡rm
->
adËr
 = 
¡©e
->
check
 =

1205 
	`UPDATE
(
¡©e
->
check
, 
put
 - 
out
, out);

1206 
out
 = 
Ëá
;

1207 ià((
¡©e
->
w¿p
 & 4) && (

1208 #ifdeà
GUNZIP


1209 
¡©e
->
æags
 ? 
hÞd
 :

1211 
	`ZSWAP32
(
hÞd
)è!ð
¡©e
->
check
) {

1212 
¡rm
->
msg
 = (*)"incorrect data check";

1213 
¡©e
->
mode
 = 
BAD
;

1216 
	`INITBITS
();

1217 
	`T¿ûv
((
¡d”r
, "inflate: check matchesrailer\n"));

1219 #ifdeà
GUNZIP


1220 
¡©e
->
mode
 = 
LENGTH
;

1221 
LENGTH
:

1222 ià(
¡©e
->
w¿p
 && s‹->
æags
) {

1223 
	`NEEDBITS
(32);

1224 ià(
hÞd
 !ð(
¡©e
->
tÙ®
 & 0xffffffffUL)) {

1225 
¡rm
->
msg
 = (*)"incorrect†ength check";

1226 
¡©e
->
mode
 = 
BAD
;

1229 
	`INITBITS
();

1230 
	`T¿ûv
((
¡d”r
, "inflate:†ength matchesrailer\n"));

1233 
¡©e
->
mode
 = 
DONE
;

1234 
DONE
:

1235 
»t
 = 
Z_STREAM_END
;

1236 
šf_Ëave
;

1237 
BAD
:

1238 
»t
 = 
Z_DATA_ERROR
;

1239 
šf_Ëave
;

1240 
MEM
:

1241  
Z_MEM_ERROR
;

1242 
SYNC
:

1244  
Z_STREAM_ERROR
;

1253 
šf_Ëave
:

1254 
	`RESTORE
();

1255 ià(
¡©e
->
wsize
 || (
out
 !ð
¡rm
->
avaž_out
 && s‹->
mode
 < 
BAD
 &&

1256 (
¡©e
->
mode
 < 
CHECK
 || 
æush
 !ð
Z_FINISH
)))

1257 ià(
	`upd©ewšdow
(
¡rm
, sŒm->
Ãxt_out
, 
out
 - sŒm->
avaž_out
)) {

1258 
¡©e
->
mode
 = 
MEM
;

1259  
Z_MEM_ERROR
;

1261 
š
 -ð
¡rm
->
avaž_š
;

1262 
out
 -ð
¡rm
->
avaž_out
;

1263 
¡rm
->
tÙ®_š
 +ð
š
;

1264 
¡rm
->
tÙ®_out
 +ð
out
;

1265 
¡©e
->
tÙ®
 +ð
out
;

1266 ià((
¡©e
->
w¿p
 & 4è&& 
out
)

1267 
¡rm
->
adËr
 = 
¡©e
->
check
 =

1268 
	`UPDATE
(
¡©e
->
check
, 
¡rm
->
Ãxt_out
 - 
out
, out);

1269 
¡rm
->
d©a_ty³
 = ()
¡©e
->
b™s
 + (¡©e->
Ï¡
 ? 64 : 0) +

1270 (
¡©e
->
mode
 =ð
TYPE
 ? 128 : 0) +

1271 (
¡©e
->
mode
 =ð
LEN_
 || s‹->mod=ð
COPY_
 ? 256 : 0);

1272 ià(((
š
 =ð0 && 
out
 =ð0è|| 
æush
 =ð
Z_FINISH
è&& 
»t
 =ð
Z_OK
)

1273 
»t
 = 
Z_BUF_ERROR
;

1274  
»t
;

1275 
	}
}

1277 
ZEXPORT
 
	$šæ©eEnd
(
¡rm
)

1278 
z_¡»amp
 
¡rm
;

1280 
šæ©e_¡©e
 
FAR
 *
¡©e
;

1281 ià(
	`šæ©eS‹Check
(
¡rm
))

1282  
Z_STREAM_ERROR
;

1283 
¡©e
 = (
šæ©e_¡©e
 
FAR
 *)
¡rm
->state;

1284 ià(
¡©e
->
wšdow
 !ð
Z_NULL
è
	`ZFREE
(
¡rm
, state->window);

1285 
	`ZFREE
(
¡rm
, sŒm->
¡©e
);

1286 
¡rm
->
¡©e
 = 
Z_NULL
;

1287 
	`T¿ûv
((
¡d”r
, "inflate:ƒnd\n"));

1288  
Z_OK
;

1289 
	}
}

1291 
ZEXPORT
 
	$šæ©eG‘DiùiÚ¬y
(
¡rm
, 
diùiÚ¬y
, 
diùL’gth
)

1292 
z_¡»amp
 
¡rm
;

1293 
By‹f
 *
diùiÚ¬y
;

1294 
uIÁ
 *
diùL’gth
;

1296 
šæ©e_¡©e
 
FAR
 *
¡©e
;

1299 ià(
	`šæ©eS‹Check
(
¡rm
)è 
Z_STREAM_ERROR
;

1300 
¡©e
 = (
šæ©e_¡©e
 
FAR
 *)
¡rm
->state;

1303 ià(
¡©e
->
whave
 && 
diùiÚ¬y
 !ð
Z_NULL
) {

1304 
	`zmemýy
(
diùiÚ¬y
, 
¡©e
->
wšdow
 + s‹->
wÃxt
,

1305 
¡©e
->
whave
 - s‹->
wÃxt
);

1306 
	`zmemýy
(
diùiÚ¬y
 + 
¡©e
->
whave
 - s‹->
wÃxt
,

1307 
¡©e
->
wšdow
, s‹->
wÃxt
);

1309 ià(
diùL’gth
 !ð
Z_NULL
)

1310 *
diùL’gth
 = 
¡©e
->
whave
;

1311  
Z_OK
;

1312 
	}
}

1314 
ZEXPORT
 
	$šæ©eS‘DiùiÚ¬y
(
¡rm
, 
diùiÚ¬y
, 
diùL’gth
)

1315 
z_¡»amp
 
¡rm
;

1316 cÚ¡ 
By‹f
 *
diùiÚ¬y
;

1317 
uIÁ
 
diùL’gth
;

1319 
šæ©e_¡©e
 
FAR
 *
¡©e
;

1320 
diùid
;

1321 
»t
;

1324 ià(
	`šæ©eS‹Check
(
¡rm
)è 
Z_STREAM_ERROR
;

1325 
¡©e
 = (
šæ©e_¡©e
 
FAR
 *)
¡rm
->state;

1326 ià(
¡©e
->
w¿p
 !ð0 && s‹->
mode
 !ð
DICT
)

1327  
Z_STREAM_ERROR
;

1330 ià(
¡©e
->
mode
 =ð
DICT
) {

1331 
diùid
 = 
	`adËr32
(0L, 
Z_NULL
, 0);

1332 
diùid
 = 
	`adËr32
(diùid, 
diùiÚ¬y
, 
diùL’gth
);

1333 ià(
diùid
 !ð
¡©e
->
check
)

1334  
Z_DATA_ERROR
;

1339 
»t
 = 
	`upd©ewšdow
(
¡rm
, 
diùiÚ¬y
 + 
diùL’gth
, dictLength);

1340 ià(
»t
) {

1341 
¡©e
->
mode
 = 
MEM
;

1342  
Z_MEM_ERROR
;

1344 
¡©e
->
havediù
 = 1;

1345 
	`T¿ûv
((
¡d”r
, "inflate: dictionary set\n"));

1346  
Z_OK
;

1347 
	}
}

1349 
ZEXPORT
 
	$šæ©eG‘H—d”
(
¡rm
, 
h—d
)

1350 
z_¡»amp
 
¡rm
;

1351 
gz_h—d”p
 
h—d
;

1353 
šæ©e_¡©e
 
FAR
 *
¡©e
;

1356 ià(
	`šæ©eS‹Check
(
¡rm
)è 
Z_STREAM_ERROR
;

1357 
¡©e
 = (
šæ©e_¡©e
 
FAR
 *)
¡rm
->state;

1358 ià((
¡©e
->
w¿p
 & 2è=ð0è 
Z_STREAM_ERROR
;

1361 
¡©e
->
h—d
 = head;

1362 
h—d
->
dÚe
 = 0;

1363  
Z_OK
;

1364 
	}
}

1377 
loÿl
 
	$sync£¬ch
(
have
, 
buf
, 
Ën
)

1378 
FAR
 *
have
;

1379 cÚ¡ 
FAR
 *
buf
;

1380 
Ën
;

1382 
gÙ
;

1383 
Ãxt
;

1385 
gÙ
 = *
have
;

1386 
Ãxt
 = 0;

1387 
Ãxt
 < 
Ën
 && 
gÙ
 < 4) {

1388 ià(()(
buf
[
Ãxt
]è=ð(
gÙ
 < 2 ? 0 : 0xff))

1389 
gÙ
++;

1390 ià(
buf
[
Ãxt
])

1391 
gÙ
 = 0;

1393 
gÙ
 = 4 - got;

1394 
Ãxt
++;

1396 *
have
 = 
gÙ
;

1397  
Ãxt
;

1398 
	}
}

1400 
ZEXPORT
 
	$šæ©eSync
(
¡rm
)

1401 
z_¡»amp
 
¡rm
;

1403 
Ën
;

1404 
š
, 
out
;

1405 
buf
[4];

1406 
šæ©e_¡©e
 
FAR
 *
¡©e
;

1409 ià(
	`šæ©eS‹Check
(
¡rm
)è 
Z_STREAM_ERROR
;

1410 
¡©e
 = (
šæ©e_¡©e
 
FAR
 *)
¡rm
->state;

1411 ià(
¡rm
->
avaž_š
 =ð0 && 
¡©e
->
b™s
 < 8è 
Z_BUF_ERROR
;

1414 ià(
¡©e
->
mode
 !ð
SYNC
) {

1415 
¡©e
->
mode
 = 
SYNC
;

1416 
¡©e
->
hÞd
 <<ð¡©e->
b™s
 & 7;

1417 
¡©e
->
b™s
 -= state->bits & 7;

1418 
Ën
 = 0;

1419 
¡©e
->
b™s
 >= 8) {

1420 
buf
[
Ën
++] = ()(
¡©e
->
hÞd
);

1421 
¡©e
->
hÞd
 >>= 8;

1422 
¡©e
->
b™s
 -= 8;

1424 
¡©e
->
have
 = 0;

1425 
	`sync£¬ch
(&(
¡©e
->
have
), 
buf
, 
Ën
);

1429 
Ën
 = 
	`sync£¬ch
(&(
¡©e
->
have
), 
¡rm
->
Ãxt_š
, sŒm->
avaž_š
);

1430 
¡rm
->
avaž_š
 -ð
Ën
;

1431 
¡rm
->
Ãxt_š
 +ð
Ën
;

1432 
¡rm
->
tÙ®_š
 +ð
Ën
;

1435 ià(
¡©e
->
have
 !ð4è 
Z_DATA_ERROR
;

1436 
š
 = 
¡rm
->
tÙ®_š
; 
out
 = sŒm->
tÙ®_out
;

1437 
	`šæ©eRe£t
(
¡rm
);

1438 
¡rm
->
tÙ®_š
 = 
š
; sŒm->
tÙ®_out
 = 
out
;

1439 
¡©e
->
mode
 = 
TYPE
;

1440  
Z_OK
;

1441 
	}
}

1451 
ZEXPORT
 
	$šæ©eSyncPošt
(
¡rm
)

1452 
z_¡»amp
 
¡rm
;

1454 
šæ©e_¡©e
 
FAR
 *
¡©e
;

1456 ià(
	`šæ©eS‹Check
(
¡rm
)è 
Z_STREAM_ERROR
;

1457 
¡©e
 = (
šæ©e_¡©e
 
FAR
 *)
¡rm
->state;

1458  
¡©e
->
mode
 =ð
STORED
 && s‹->
b™s
 == 0;

1459 
	}
}

1461 
ZEXPORT
 
	$šæ©eCÝy
(
de¡
, 
sourû
)

1462 
z_¡»amp
 
de¡
;

1463 
z_¡»amp
 
sourû
;

1465 
šæ©e_¡©e
 
FAR
 *
¡©e
;

1466 
šæ©e_¡©e
 
FAR
 *
cÝy
;

1467 
FAR
 *
wšdow
;

1468 
wsize
;

1471 ià(
	`šæ©eS‹Check
(
sourû
è|| 
de¡
 =ð
Z_NULL
)

1472  
Z_STREAM_ERROR
;

1473 
¡©e
 = (
šæ©e_¡©e
 
FAR
 *)
sourû
->state;

1476 
cÝy
 = (
šæ©e_¡©e
 
FAR
 *)

1477 
	`ZALLOC
(
sourû
, 1, (
šæ©e_¡©e
));

1478 ià(
cÝy
 =ð
Z_NULL
è 
Z_MEM_ERROR
;

1479 
wšdow
 = 
Z_NULL
;

1480 ià(
¡©e
->
wšdow
 !ð
Z_NULL
) {

1481 
wšdow
 = (
FAR
 *)

1482 
	`ZALLOC
(
sourû
, 1U << 
¡©e
->
wb™s
, ());

1483 ià(
wšdow
 =ð
Z_NULL
) {

1484 
	`ZFREE
(
sourû
, 
cÝy
);

1485  
Z_MEM_ERROR
;

1490 
	`zmemýy
((
voidpf
)
de¡
, (voidpf)
sourû
, (
z_¡»am
));

1491 
	`zmemýy
((
voidpf
)
cÝy
, (voidpf)
¡©e
, (
šæ©e_¡©e
));

1492 
cÝy
->
¡rm
 = 
de¡
;

1493 ià(
¡©e
->
Ëncode
 >ð¡©e->
codes
 &&

1494 
¡©e
->
Ëncode
 <ð¡©e->
codes
 + 
ENOUGH
 - 1) {

1495 
cÝy
->
Ëncode
 = cÝy->
codes
 + (
¡©e
->lencode - state->codes);

1496 
cÝy
->
di¡code
 = cÝy->
codes
 + (
¡©e
->distcode - state->codes);

1498 
cÝy
->
Ãxt
 = cÝy->
codes
 + (
¡©e
->next - state->codes);

1499 ià(
wšdow
 !ð
Z_NULL
) {

1500 
wsize
 = 1U << 
¡©e
->
wb™s
;

1501 
	`zmemýy
(
wšdow
, 
¡©e
->wšdow, 
wsize
);

1503 
cÝy
->
wšdow
 = window;

1504 
de¡
->
¡©e
 = (
š‹º®_¡©e
 
FAR
 *)
cÝy
;

1505  
Z_OK
;

1506 
	}
}

1508 
ZEXPORT
 
	$šæ©eUnd”mše
(
¡rm
, 
subv”t
)

1509 
z_¡»amp
 
¡rm
;

1510 
subv”t
;

1512 
šæ©e_¡©e
 
FAR
 *
¡©e
;

1514 ià(
	`šæ©eS‹Check
(
¡rm
)è 
Z_STREAM_ERROR
;

1515 
¡©e
 = (
šæ©e_¡©e
 
FAR
 *)
¡rm
->state;

1516 #ifdeà
INFLATE_ALLOW_INVALID_DISTANCE_TOOFAR_ARRR


1517 
¡©e
->
§Ã
 = !
subv”t
;

1518  
Z_OK
;

1520 ()
subv”t
;

1521 
¡©e
->
§Ã
 = 1;

1522  
Z_DATA_ERROR
;

1524 
	}
}

1526 
ZEXPORT
 
	$šæ©eV®id©e
(
¡rm
, 
check
)

1527 
z_¡»amp
 
¡rm
;

1528 
check
;

1530 
šæ©e_¡©e
 
FAR
 *
¡©e
;

1532 ià(
	`šæ©eS‹Check
(
¡rm
)è 
Z_STREAM_ERROR
;

1533 
¡©e
 = (
šæ©e_¡©e
 
FAR
 *)
¡rm
->state;

1534 ià(
check
)

1535 
¡©e
->
w¿p
 |= 4;

1537 
¡©e
->
w¿p
 &= ~4;

1538  
Z_OK
;

1539 
	}
}

1541 
ZEXPORT
 
	$šæ©eM¬k
(
¡rm
)

1542 
z_¡»amp
 
¡rm
;

1544 
šæ©e_¡©e
 
FAR
 *
¡©e
;

1546 ià(
	`šæ©eS‹Check
(
¡rm
))

1548 
¡©e
 = (
šæ©e_¡©e
 
FAR
 *)
¡rm
->state;

1549  ()((()(()
¡©e
->
back
)) << 16) +

1550 (
¡©e
->
mode
 =ð
COPY
 ? s‹->
Ëngth
 :

1551 (
¡©e
->
mode
 =ð
MATCH
 ? s‹->
was
 - s‹->
Ëngth
 : 0));

1552 
	}
}

1554 
ZEXPORT
 
	$šæ©eCodesU£d
(
¡rm
)

1555 
z_¡»amp
 
¡rm
;

1557 
šæ©e_¡©e
 
FAR
 *
¡©e
;

1558 ià(
	`šæ©eS‹Check
(
¡rm
))  ()-1;

1559 
¡©e
 = (
šæ©e_¡©e
 
FAR
 *)
¡rm
->state;

1560  ()(
¡©e
->
Ãxt
 - s‹->
codes
);

1561 
	}
}

	@zlib/inflate.h

15 #iâdeà
NO_GZIP


16 
	#GUNZIP


	)

21 
	mHEAD
 = 16180,

22 
	mFLAGS
,

23 
	mTIME
,

24 
	mOS
,

25 
	mEXLEN
,

26 
	mEXTRA
,

27 
	mNAME
,

28 
	mCOMMENT
,

29 
	mHCRC
,

30 
	mDICTID
,

31 
	mDICT
,

32 
	mTYPE
,

33 
	mTYPEDO
,

34 
	mSTORED
,

35 
	mCOPY_
,

36 
	mCOPY
,

37 
	mTABLE
,

38 
	mLENLENS
,

39 
	mCODELENS
,

40 
	mLEN_
,

41 
	mLEN
,

42 
	mLENEXT
,

43 
	mDIST
,

44 
	mDISTEXT
,

45 
	mMATCH
,

46 
	mLIT
,

47 
	mCHECK
,

48 
	mLENGTH
,

49 
	mDONE
,

50 
	mBAD
,

51 
	mMEM
,

52 
	mSYNC


53 } 
	tšæ©e_mode
;

82 
	sšæ©e_¡©e
 {

83 
z_¡»amp
 
	m¡rm
;

84 
šæ©e_mode
 
	mmode
;

85 
	mÏ¡
;

86 
	mw¿p
;

88 
	mhavediù
;

89 
	mæags
;

90 
	mdmax
;

91 
	mcheck
;

92 
	mtÙ®
;

93 
gz_h—d”p
 
	mh—d
;

95 
	mwb™s
;

96 
	mwsize
;

97 
	mwhave
;

98 
	mwÃxt
;

99 
FAR
 *
	mwšdow
;

101 
	mhÞd
;

102 
	mb™s
;

104 
	mËngth
;

105 
	moff£t
;

107 
	mexŒa
;

109 
code
 cÚ¡ 
FAR
 *
	mËncode
;

110 
code
 cÚ¡ 
FAR
 *
	mdi¡code
;

111 
	mËnb™s
;

112 
	mdi¡b™s
;

114 
	mncode
;

115 
	mÆ’
;

116 
	mndi¡
;

117 
	mhave
;

118 
code
 
FAR
 *
	mÃxt
;

119 
	mËns
[320];

120 
	mwÜk
[288];

121 
code
 
	mcodes
[
ENOUGH
];

122 
	m§Ã
;

123 
	mback
;

124 
	mwas
;

	@zlib/inftrees.c

6 
	~"zutž.h
"

7 
	~"šá»es.h
"

9 
	#MAXBITS
 15

	)

11 cÚ¡ 
	gšæ©e_cÝyright
[] =

32 
ZLIB_INTERNAL
 
	$šæ©e_bË
(
ty³
, 
Ëns
, 
codes
, 
bË
, 
b™s
, 
wÜk
)

33 
cod‘y³
 
ty³
;

34 
FAR
 *
Ëns
;

35 
codes
;

36 
code
 
FAR
 * FAR *
bË
;

37 
FAR
 *
b™s
;

38 
FAR
 *
wÜk
;

40 
Ën
;

41 
sym
;

42 
mš
, 
max
;

43 
roÙ
;

44 
cu¼
;

45 
drÝ
;

46 
Ëá
;

47 
u£d
;

48 
huff
;

49 
šü
;

50 
fžl
;

51 
low
;

52 
mask
;

53 
code
 
h”e
;

54 
code
 
FAR
 *
Ãxt
;

55 cÚ¡ 
FAR
 *
ba£
;

56 cÚ¡ 
FAR
 *
exŒa
;

57 
m©ch
;

58 
couÁ
[
MAXBITS
+1];

59 
offs
[
MAXBITS
+1];

60 cÚ¡ 
lba£
[31] = {

63 cÚ¡ 
Ëxt
[31] = {

66 cÚ¡ 
dba£
[32] = {

70 cÚ¡ 
dext
[32] = {

107 
Ën
 = 0;†’ <ð
MAXBITS
;†en++)

108 
couÁ
[
Ën
] = 0;

109 
sym
 = 0; sym < 
codes
; sym++)

110 
couÁ
[
Ëns
[
sym
]]++;

113 
roÙ
 = *
b™s
;

114 
max
 = 
MAXBITS
; max >= 1; max--)

115 ià(
couÁ
[
max
] != 0) ;

116 ià(
roÙ
 > 
max
)„oot = max;

117 ià(
max
 == 0) {

118 
h”e
.
Ý
 = ()64;

119 
h”e
.
b™s
 = ()1;

120 
h”e
.
v®
 = ()0;

121 *(*
bË
)++ = 
h”e
;

122 *(*
bË
)++ = 
h”e
;

123 *
b™s
 = 1;

126 
mš
 = 1; mš < 
max
; min++)

127 ià(
couÁ
[
mš
] != 0) ;

128 ià(
roÙ
 < 
mš
)„oot = min;

131 
Ëá
 = 1;

132 
Ën
 = 1;†’ <ð
MAXBITS
;†en++) {

133 
Ëá
 <<= 1;

134 
Ëá
 -ð
couÁ
[
Ën
];

135 ià(
Ëá
 < 0)  -1;

137 ià(
Ëá
 > 0 && (
ty³
 =ð
CODES
 || 
max
 != 1))

141 
offs
[1] = 0;

142 
Ën
 = 1;†’ < 
MAXBITS
;†en++)

143 
offs
[
Ën
 + 1] = offs[Ën] + 
couÁ
[len];

146 
sym
 = 0; sym < 
codes
; sym++)

147 ià(
Ëns
[
sym
] !ð0è
wÜk
[
offs
[lens[sym]]++] = ()sym;

181 
ty³
) {

182 
CODES
:

183 
ba£
 = 
exŒa
 = 
wÜk
;

184 
m©ch
 = 20;

186 
LENS
:

187 
ba£
 = 
lba£
;

188 
exŒa
 = 
Ëxt
;

189 
m©ch
 = 257;

192 
ba£
 = 
dba£
;

193 
exŒa
 = 
dext
;

194 
m©ch
 = 0;

198 
huff
 = 0;

199 
sym
 = 0;

200 
Ën
 = 
mš
;

201 
Ãxt
 = *
bË
;

202 
cu¼
 = 
roÙ
;

203 
drÝ
 = 0;

204 
low
 = ()(-1);

205 
u£d
 = 1U << 
roÙ
;

206 
mask
 = 
u£d
 - 1;

209 ià((
ty³
 =ð
LENS
 && 
u£d
 > 
ENOUGH_LENS
) ||

210 (
ty³
 =ð
DISTS
 && 
u£d
 > 
ENOUGH_DISTS
))

216 
h”e
.
b™s
 = ()(
Ën
 - 
drÝ
);

217 ià(
wÜk
[
sym
] + 1U < 
m©ch
) {

218 
h”e
.
Ý
 = ()0;

219 
h”e
.
v®
 = 
wÜk
[
sym
];

221 ià(
wÜk
[
sym
] >ð
m©ch
) {

222 
h”e
.
Ý
 = ()(
exŒa
[
wÜk
[
sym
] - 
m©ch
]);

223 
h”e
.
v®
 = 
ba£
[
wÜk
[
sym
] - 
m©ch
];

226 
h”e
.
Ý
 = ()(32 + 64);

227 
h”e
.
v®
 = 0;

231 
šü
 = 1U << (
Ën
 - 
drÝ
);

232 
fžl
 = 1U << 
cu¼
;

233 
mš
 = 
fžl
;

235 
fžl
 -ð
šü
;

236 
Ãxt
[(
huff
 >> 
drÝ
è+ 
fžl
] = 
h”e
;

237 } 
fžl
 != 0);

240 
šü
 = 1U << (
Ën
 - 1);

241 
huff
 & 
šü
)

242 
šü
 >>= 1;

243 ià(
šü
 != 0) {

244 
huff
 &ð
šü
 - 1;

245 
huff
 +ð
šü
;

248 
huff
 = 0;

251 
sym
++;

252 ià(--(
couÁ
[
Ën
]) == 0) {

253 ià(
Ën
 =ð
max
) ;

254 
Ën
 = 
Ëns
[
wÜk
[
sym
]];

258 ià(
Ën
 > 
roÙ
 && (
huff
 & 
mask
è!ð
low
) {

260 ià(
drÝ
 == 0)

261 
drÝ
 = 
roÙ
;

264 
Ãxt
 +ð
mš
;

267 
cu¼
 = 
Ën
 - 
drÝ
;

268 
Ëá
 = ()(1 << 
cu¼
);

269 
cu¼
 + 
drÝ
 < 
max
) {

270 
Ëá
 -ð
couÁ
[
cu¼
 + 
drÝ
];

271 ià(
Ëá
 <= 0) ;

272 
cu¼
++;

273 
Ëá
 <<= 1;

277 
u£d
 +ð1U << 
cu¼
;

278 ià((
ty³
 =ð
LENS
 && 
u£d
 > 
ENOUGH_LENS
) ||

279 (
ty³
 =ð
DISTS
 && 
u£d
 > 
ENOUGH_DISTS
))

283 
low
 = 
huff
 & 
mask
;

284 (*
bË
)[
low
].
Ý
 = ()
cu¼
;

285 (*
bË
)[
low
].
b™s
 = ()
roÙ
;

286 (*
bË
)[
low
].
v®
 = ()(
Ãxt
 - *table);

293 ià(
huff
 != 0) {

294 
h”e
.
Ý
 = ()64;

295 
h”e
.
b™s
 = ()(
Ën
 - 
drÝ
);

296 
h”e
.
v®
 = ()0;

297 
Ãxt
[
huff
] = 
h”e
;

301 *
bË
 +ð
u£d
;

302 *
b™s
 = 
roÙ
;

304 
	}
}

	@zlib/inftrees.h

25 
	mÝ
;

26 
	mb™s
;

27 
	mv®
;

28 } 
	tcode
;

49 
	#ENOUGH_LENS
 852

	)

50 
	#ENOUGH_DISTS
 592

	)

51 
	#ENOUGH
 (
ENOUGH_LENS
+
ENOUGH_DISTS
)

	)

55 
	mCODES
,

56 
	mLENS
,

57 
	mDISTS


58 } 
	tcod‘y³
;

60 
ZLIB_INTERNAL
 
šæ©e_bË
 
OF
((
cod‘y³
 
ty³
, 
FAR
 *
Ëns
,

61 
codes
, 
code
 
FAR
 * FAR *
bË
,

62 
FAR
 *
b™s
, FAR *
wÜk
));

	@zlib/minigzip.c

18 
	~"zlib.h
"

19 
	~<¡dio.h
>

21 #ifdeà
STDC


22 
	~<¡ršg.h
>

23 
	~<¡dlib.h
>

26 #ifdeà
USE_MMAP


27 
	~<sys/ty³s.h
>

28 
	~<sys/mmª.h
>

29 
	~<sys/¡©.h
>

32 #ià
defšed
(
MSDOS
è|| defšed(
OS2
è|| defšed(
WIN32
è|| defšed(
__CYGWIN__
)

33 
	~<fúŽ.h
>

34 
	~<io.h
>

35 #ifdeà
UNDER_CE


36 
	~<¡dlib.h
>

38 
	#SET_BINARY_MODE
(
fže
è
	`£tmode
(
	`fž’o
(fže), 
O_BINARY
)

	)

40 
	#SET_BINARY_MODE
(
fže
)

	)

43 #ifdeà
VMS


44 
	#uÆšk
 
d–‘e


	)

45 
	#GZ_SUFFIX
 "-gz"

	)

47 #ifdeà
RISCOS


48 
	#uÆšk
 
»move


	)

49 
	#GZ_SUFFIX
 "-gz"

	)

50 
	#fž’o
(
fže
èfže->
__fže


	)

52 #ià
defšed
(
__MWERKS__
è&& 
__de¡_os
 !ð
__be_os
 && __de¡_o !ð
__wš32_os


53 
	~<unix.h
>

56 #ià!
defšed
(
Z_HAVE_UNISTD_H
è&& !defšed(
_LARGEFILE64_SOURCE
)

57 #iâdeà
WIN32


58 
uÆšk
 
OF
((const *));

62 #ià
defšed
(
UNDER_CE
)

63 
	~<wšdows.h
>

64 
	#³¼Ü
(
s
è
	`pwš”rÜ
(s)

	)

76 *
	$¡rwš”rÜ
 (
”rÜ
)

77 
DWORD
 
”rÜ
;

79 
buf
[1024];

81 
wch¬_t
 *
msgbuf
;

82 
DWORD
 
Ï¡”r
 = 
	`G‘La¡E¼Ü
();

83 
DWORD
 
ch¬s
 = 
	`FÜm©Mes§ge
(
FORMAT_MESSAGE_FROM_SYSTEM


84 | 
FORMAT_MESSAGE_ALLOCATE_BUFFER
,

85 
NULL
,

86 
”rÜ
,

88 (
LPVOID
)&
msgbuf
,

90 
NULL
);

91 ià(
ch¬s
 != 0) {

93 ià(
ch¬s
 >= 2

94 && 
msgbuf
[
ch¬s
 - 2] == '\r' && msgbuf[chars - 1] == '\n') {

95 
ch¬s
 -= 2;

96 
msgbuf
[
ch¬s
] = 0;

99 ià(
ch¬s
 >  (
buf
) - 1) {

100 
ch¬s
 =  (
buf
) - 1;

101 
msgbuf
[
ch¬s
] = 0;

104 
	`wc¡ombs
(
buf
, 
msgbuf
, 
ch¬s
 + 1);

105 
	`LoÿlF»e
(
msgbuf
);

108 
	`¥rštf
(
buf
, "unknowÀwš32ƒ¼Ü (%ld)", 
”rÜ
);

111 
	`S‘La¡E¼Ü
(
Ï¡”r
);

112  
buf
;

113 
	}
}

115 
	$pwš”rÜ
 (
s
)

116 cÚ¡ *
s
;

118 ià(
s
 && *s)

119 
	`årštf
(
¡d”r
, "%s: %s\n", 
s
, 
	`¡rwš”rÜ
(
	`G‘La¡E¼Ü
 ()));

121 
	`årštf
(
¡d”r
, "%s\n", 
	`¡rwš”rÜ
(
	`G‘La¡E¼Ü
 ()));

122 
	}
}

126 #iâdeà
GZ_SUFFIX


127 
	#GZ_SUFFIX
 ".gz"

	)

129 
	#SUFFIX_LEN
 ((
GZ_SUFFIX
)-1)

	)

131 
	#BUFLEN
 16384

	)

132 
	#MAX_NAME_LEN
 1024

	)

134 #ifdeà
MAXSEG_64K


135 
	#loÿl
 

	)

138 
	#loÿl


	)

141 *
	g´og
;

143 
”rÜ
 
OF
((cÚ¡ *
msg
));

144 
gz_com´ess
 
OF
((
FILE
 *
š
, 
gzFže
 
out
));

145 #ifdeà
USE_MMAP


146 
gz_com´ess_mm­
 
OF
((
FILE
 *
š
, 
gzFže
 
out
));

148 
gz_uncom´ess
 
OF
((
gzFže
 
š
, 
FILE
 *
out
));

149 
fže_com´ess
 
OF
((*
fže
, *
mode
));

150 
fže_uncom´ess
 
OF
((*
fže
));

151 
maš
 
OF
((
¬gc
, *
¬gv
[]));

156 
	$”rÜ
(
msg
)

157 cÚ¡ *
msg
;

159 
	`årštf
(
¡d”r
, "%s: %s\n", 
´og
, 
msg
);

160 
	`ex™
(1);

161 
	}
}

167 
	$gz_com´ess
(
š
, 
out
)

168 
FILE
 *
š
;

169 
gzFže
 
out
;

171 
loÿl
 
buf
[
BUFLEN
];

172 
Ën
;

173 
”r
;

175 #ifdeà
USE_MMAP


179 ià(
	`gz_com´ess_mm­
(
š
, 
out
è=ð
Z_OK
) ;

182 
Ën
 = ()
	`ä—d
(
buf
, 1, (buf), 
š
);

183 ià(
	`ã¼Ü
(
š
)) {

184 
	`³¼Ü
("fread");

185 
	`ex™
(1);

187 ià(
Ën
 == 0) ;

189 ià(
	`gzwr™e
(
out
, 
buf
, ()
Ën
è!ðËnè
	`”rÜ
(
	`gz”rÜ
(out, &
”r
));

191 
	`fþo£
(
š
);

192 ià(
	`gzþo£
(
out
è!ð
Z_OK
è
	`”rÜ
("failed gzclose");

193 
	}
}

195 #ifdeà
USE_MMAP


200 
	$gz_com´ess_mm­
(
š
, 
out
)

201 
FILE
 *
š
;

202 
gzFže
 
out
;

204 
Ën
;

205 
”r
;

206 
ifd
 = 
	`fž’o
(
š
);

207 
ÿddr_t
 
buf
;

208 
off_t
 
buf_Ën
;

209 
¡©
 
sb
;

212 ià(
	`f¡©
(
ifd
, &
sb
è< 0è 
Z_ERRNO
;

213 
buf_Ën
 = 
sb
.
¡_size
;

214 ià(
buf_Ën
 <ð0è 
Z_ERRNO
;

217 
buf
 = 
	`mm­
((
ÿddr_t
è0, 
buf_Ën
, 
PROT_READ
, 
MAP_SHARED
, 
ifd
, (
off_t
)0);

218 ià(
buf
 =ð(
ÿddr_t
)(-1)è 
Z_ERRNO
;

221 
Ën
 = 
	`gzwr™e
(
out
, (*)
buf
, ()
buf_Ën
);

223 ià(
Ën
 !ð()
buf_Ën
è
	`”rÜ
(
	`gz”rÜ
(
out
, &
”r
));

225 
	`munm­
(
buf
, 
buf_Ën
);

226 
	`fþo£
(
š
);

227 ià(
	`gzþo£
(
out
è!ð
Z_OK
è
	`”rÜ
("failed gzclose");

228  
Z_OK
;

229 
	}
}

235 
	$gz_uncom´ess
(
š
, 
out
)

236 
gzFže
 
š
;

237 
FILE
 *
out
;

239 
loÿl
 
buf
[
BUFLEN
];

240 
Ën
;

241 
”r
;

244 
Ën
 = 
	`gz»ad
(
š
, 
buf
, (buf));

245 ià(
Ën
 < 0è
	`”rÜ
 (
	`gz”rÜ
(
š
, &
”r
));

246 ià(
Ën
 == 0) ;

248 ià(()
	`fwr™e
(
buf
, 1, ()
Ën
, 
out
) !=†en) {

249 
	`”rÜ
("failed fwrite");

252 ià(
	`fþo£
(
out
)è
	`”rÜ
("failed fclose");

254 ià(
	`gzþo£
(
š
è!ð
Z_OK
è
	`”rÜ
("failed gzclose");

255 
	}
}

262 
	$fže_com´ess
(
fže
, 
mode
)

263 *
fže
;

264 *
mode
;

266 
loÿl
 
outfže
[
MAX_NAME_LEN
];

267 
FILE
 *
š
;

268 
gzFže
 
out
;

270 ià(
	`¡¾’
(
fže
è+ sŒËn(
GZ_SUFFIX
è>ð(
outfže
)) {

271 
	`årštf
(
¡d”r
, "%s: fž’amtoØlÚg\n", 
´og
);

272 
	`ex™
(1);

275 
	`¡rýy
(
outfže
, 
fže
);

276 
	`¡rÿt
(
outfže
, 
GZ_SUFFIX
);

278 
š
 = 
	`fÝ’
(
fže
, "rb");

279 ià(
š
 =ð
NULL
) {

280 
	`³¼Ü
(
fže
);

281 
	`ex™
(1);

283 
out
 = 
	`gzÝ’
(
outfže
, 
mode
);

284 ià(
out
 =ð
NULL
) {

285 
	`årštf
(
¡d”r
, "%s: cª'ˆgzÝ’ %s\n", 
´og
, 
outfže
);

286 
	`ex™
(1);

288 
	`gz_com´ess
(
š
, 
out
);

290 
	`uÆšk
(
fže
);

291 
	}
}

297 
	$fže_uncom´ess
(
fže
)

298 *
fže
;

300 
loÿl
 
buf
[
MAX_NAME_LEN
];

301 *
šfže
, *
outfže
;

302 
FILE
 *
out
;

303 
gzFže
 
š
;

304 
size_t
 
Ën
 = 
	`¡¾’
(
fže
);

306 ià(
Ën
 + 
	`¡¾’
(
GZ_SUFFIX
è>ð(
buf
)) {

307 
	`årštf
(
¡d”r
, "%s: fž’amtoØlÚg\n", 
´og
);

308 
	`ex™
(1);

311 
	`¡rýy
(
buf
, 
fže
);

313 ià(
Ën
 > 
SUFFIX_LEN
 && 
	`¡rcmp
(
fže
+Ën-SUFFIX_LEN, 
GZ_SUFFIX
) == 0) {

314 
šfže
 = 
fže
;

315 
outfže
 = 
buf
;

316 
outfže
[
Ën
-3] = '\0';

318 
outfže
 = 
fže
;

319 
šfže
 = 
buf
;

320 
	`¡rÿt
(
šfže
, 
GZ_SUFFIX
);

322 
š
 = 
	`gzÝ’
(
šfže
, "rb");

323 ià(
š
 =ð
NULL
) {

324 
	`årštf
(
¡d”r
, "%s: cª'ˆgzÝ’ %s\n", 
´og
, 
šfže
);

325 
	`ex™
(1);

327 
out
 = 
	`fÝ’
(
outfže
, "wb");

328 ià(
out
 =ð
NULL
) {

329 
	`³¼Ü
(
fže
);

330 
	`ex™
(1);

333 
	`gz_uncom´ess
(
š
, 
out
);

335 
	`uÆšk
(
šfže
);

336 
	}
}

349 
	$maš
(
¬gc
, 
¬gv
)

350 
¬gc
;

351 *
¬gv
[];

353 
cÝyout
 = 0;

354 
uncom´
 = 0;

355 
gzFže
 
fže
;

356 *
bÇme
, 
outmode
[20];

358 
	`¡rýy
(
outmode
, "wb6 ");

360 
´og
 = 
¬gv
[0];

361 
bÇme
 = 
	`¡¼chr
(
¬gv
[0], '/');

362 ià(
bÇme
)

363 
bÇme
++;

365 
bÇme
 = 
¬gv
[0];

366 
¬gc
--, 
¬gv
++;

368 ià(!
	`¡rcmp
(
bÇme
, "gunzip"))

369 
uncom´
 = 1;

370 ià(!
	`¡rcmp
(
bÇme
, "zcat"))

371 
cÝyout
 = 
uncom´
 = 1;

373 
¬gc
 > 0) {

374 ià(
	`¡rcmp
(*
¬gv
, "-c") == 0)

375 
cÝyout
 = 1;

376 ià(
	`¡rcmp
(*
¬gv
, "-d") == 0)

377 
uncom´
 = 1;

378 ià(
	`¡rcmp
(*
¬gv
, "-f") == 0)

379 
outmode
[3] = 'f';

380 ià(
	`¡rcmp
(*
¬gv
, "-h") == 0)

381 
outmode
[3] = 'h';

382 ià(
	`¡rcmp
(*
¬gv
, "-r") == 0)

383 
outmode
[3] = 'R';

384 ià((*
¬gv
)[0] == '-' && (*argv)[1] >= '1' && (*argv)[1] <= '9' &&

385 (*
¬gv
)[2] == 0)

386 
outmode
[2] = (*
¬gv
)[1];

389 
¬gc
--, 
¬gv
++;

391 ià(
outmode
[3] == ' ')

392 
outmode
[3] = 0;

393 ià(
¬gc
 == 0) {

394 
	`SET_BINARY_MODE
(
¡dš
);

395 
	`SET_BINARY_MODE
(
¡dout
);

396 ià(
uncom´
) {

397 
fže
 = 
	`gzdÝ’
(
	`fž’o
(
¡dš
), "rb");

398 ià(
fže
 =ð
NULL
è
	`”rÜ
("can't gzdopen stdin");

399 
	`gz_uncom´ess
(
fže
, 
¡dout
);

401 
fže
 = 
	`gzdÝ’
(
	`fž’o
(
¡dout
), 
outmode
);

402 ià(
fže
 =ð
NULL
è
	`”rÜ
("can't gzdopen stdout");

403 
	`gz_com´ess
(
¡dš
, 
fže
);

406 ià(
cÝyout
) {

407 
	`SET_BINARY_MODE
(
¡dout
);

410 ià(
uncom´
) {

411 ià(
cÝyout
) {

412 
fže
 = 
	`gzÝ’
(*
¬gv
, "rb");

413 ià(
fže
 =ð
NULL
)

414 
	`årštf
(
¡d”r
, "%s: cª'ˆgzÝ’ %s\n", 
´og
, *
¬gv
);

416 
	`gz_uncom´ess
(
fže
, 
¡dout
);

418 
	`fže_uncom´ess
(*
¬gv
);

421 ià(
cÝyout
) {

422 
FILE
 * 
š
 = 
	`fÝ’
(*
¬gv
, "rb");

424 ià(
š
 =ð
NULL
) {

425 
	`³¼Ü
(*
¬gv
);

427 
fže
 = 
	`gzdÝ’
(
	`fž’o
(
¡dout
), 
outmode
);

428 ià(
fže
 =ð
NULL
è
	`”rÜ
("can't gzdopen stdout");

430 
	`gz_com´ess
(
š
, 
fže
);

434 
	`fže_com´ess
(*
¬gv
, 
outmode
);

437 } 
¬gv
++, --
¬gc
);

440 
	}
}

	@zlib/trees.c

37 
	~"deæ©e.h
"

39 #ifdeà
ZLIB_DEBUG


40 
	~<ùy³.h
>

47 
	#MAX_BL_BITS
 7

	)

50 
	#END_BLOCK
 256

	)

53 
	#REP_3_6
 16

	)

56 
	#REPZ_3_10
 17

	)

59 
	#REPZ_11_138
 18

	)

62 
loÿl
 cÚ¡ 
	gexŒa_lb™s
[
LENGTH_CODES
]

65 
loÿl
 cÚ¡ 
	gexŒa_db™s
[
D_CODES
]

68 
loÿl
 cÚ¡ 
	gexŒa_blb™s
[
BL_CODES
]

71 
loÿl
 cÚ¡ 
uch
 
	gbl_Üd”
[
BL_CODES
]

81 
	#DIST_CODE_LEN
 512

	)

83 #ià
defšed
(
GEN_TREES_H
è|| !defšed(
STDC
)

86 
loÿl
 
ù_d©a
 
	g¡©ic_É»e
[
L_CODES
+2];

93 
loÿl
 
ù_d©a
 
	g¡©ic_dŒ“
[
D_CODES
];

98 
uch
 
	g_di¡_code
[
DIST_CODE_LEN
];

104 
uch
 
	g_Ëngth_code
[
MAX_MATCH
-
MIN_MATCH
+1];

107 
loÿl
 
	gba£_Ëngth
[
LENGTH_CODES
];

110 
loÿl
 
	gba£_di¡
[
D_CODES
];

114 
	~"Œ“s.h
"

117 
	s¡©ic_Œ“_desc_s
 {

118 cÚ¡ 
ù_d©a
 *
	m¡©ic_Œ“
;

119 cÚ¡ 
štf
 *
	mexŒa_b™s
;

120 
	mexŒa_ba£
;

121 
	m–ems
;

122 
	mmax_Ëngth
;

125 
loÿl
 cÚ¡ 
¡©ic_Œ“_desc
 
	g¡©ic_l_desc
 =

126 {
¡©ic_É»e
, 
exŒa_lb™s
, 
LITERALS
+1, 
L_CODES
, 
MAX_BITS
};

128 
loÿl
 cÚ¡ 
¡©ic_Œ“_desc
 
	g¡©ic_d_desc
 =

129 {
¡©ic_dŒ“
, 
exŒa_db™s
, 0, 
D_CODES
, 
MAX_BITS
};

131 
loÿl
 cÚ¡ 
¡©ic_Œ“_desc
 
	g¡©ic_bl_desc
 =

132 {(cÚ¡ 
ù_d©a
 *)0, 
exŒa_blb™s
, 0, 
BL_CODES
, 
MAX_BL_BITS
};

138 
loÿl
 
Œ_¡©ic_š™
 
OF
(());

139 
loÿl
 
š™_block
 
OF
((
deæ©e_¡©e
 *
s
));

140 
loÿl
 
pqdownh—p
 
OF
((
deæ©e_¡©e
 *
s
, 
ù_d©a
 *
Œ“
, 
k
));

141 
loÿl
 
g’_b™Ën
 
OF
((
deæ©e_¡©e
 *
s
, 
Œ“_desc
 *
desc
));

142 
loÿl
 
g’_codes
 
OF
((
ù_d©a
 *
Œ“
, 
max_code
, 
ushf
 *
bl_couÁ
));

143 
loÿl
 
bužd_Œ“
 
OF
((
deæ©e_¡©e
 *
s
, 
Œ“_desc
 *
desc
));

144 
loÿl
 
sÿn_Œ“
 
OF
((
deæ©e_¡©e
 *
s
, 
ù_d©a
 *
Œ“
, 
max_code
));

145 
loÿl
 
£nd_Œ“
 
OF
((
deæ©e_¡©e
 *
s
, 
ù_d©a
 *
Œ“
, 
max_code
));

146 
loÿl
 
bužd_bl_Œ“
 
OF
((
deæ©e_¡©e
 *
s
));

147 
loÿl
 
£nd_®l_Œ“s
 
OF
((
deæ©e_¡©e
 *
s
, 
lcodes
, 
dcodes
,

148 
blcodes
));

149 
loÿl
 
com´ess_block
 
OF
((
deæ©e_¡©e
 *
s
, cÚ¡ 
ù_d©a
 *
É»e
,

150 cÚ¡ 
ù_d©a
 *
dŒ“
));

151 
loÿl
 
d‘eù_d©a_ty³
 
OF
((
deæ©e_¡©e
 *
s
));

152 
loÿl
 
bi_»v”£
 
OF
((
v®ue
, 
Ëngth
));

153 
loÿl
 
bi_wšdup
 
OF
((
deæ©e_¡©e
 *
s
));

154 
loÿl
 
bi_æush
 
OF
((
deæ©e_¡©e
 *
s
));

156 #ifdeà
GEN_TREES_H


157 
loÿl
 
g’_Œ“s_h—d”
 
OF
(());

160 #iâdeà
ZLIB_DEBUG


161 
	#£nd_code
(
s
, 
c
, 
Œ“
è
	`£nd_b™s
(s,»e[c].
Code
,»e[c].
L’
)

	)

165 
	#£nd_code
(
s
, 
c
, 
Œ“
) \

166 { ià(
z_v”bo£
>2è
	`årštf
(
¡d”r
,"\ncd %3d ",(
c
)); \

167 
	`£nd_b™s
(
s
, 
Œ“
[
c
].
Code
,»e[c].
L’
); }

	)

174 
	#put_shÜt
(
s
, 
w
) { \

175 
	`put_by‹
(
s
, (
uch
)((
w
) & 0xff)); \

176 
	`put_by‹
(
s
, (
uch
)((
ush
)(
w
) >> 8)); \

177 }

	)

183 #ifdeà
ZLIB_DEBUG


184 
loÿl
 
£nd_b™s
 
OF
((
deæ©e_¡©e
 *
s
, 
v®ue
, 
Ëngth
));

186 
loÿl
 
	$£nd_b™s
(
s
, 
v®ue
, 
Ëngth
)

187 
deæ©e_¡©e
 *
s
;

188 
v®ue
;

189 
Ëngth
;

191 
	`T¿ûvv
((
¡d”r
,"† %2d v %4x ", 
Ëngth
, 
v®ue
));

192 
	`As£¹
(
Ëngth
 > 0 &&†ength <= 15, "invalid†ength");

193 
s
->
b™s_£Á
 +ð(
ulg
)
Ëngth
;

199 ià(
s
->
bi_v®id
 > ()
Buf_size
 - 
Ëngth
) {

200 
s
->
bi_buf
 |ð(
ush
)
v®ue
 << s->
bi_v®id
;

201 
	`put_shÜt
(
s
, s->
bi_buf
);

202 
s
->
bi_buf
 = (
ush
)
v®ue
 >> (
Buf_size
 - s->
bi_v®id
);

203 
s
->
bi_v®id
 +ð
Ëngth
 - 
Buf_size
;

205 
s
->
bi_buf
 |ð(
ush
)
v®ue
 << s->
bi_v®id
;

206 
s
->
bi_v®id
 +ð
Ëngth
;

208 
	}
}

211 
	#£nd_b™s
(
s
, 
v®ue
, 
Ëngth
) \

212 { 
Ën
 = 
Ëngth
;\

213 ià(
s
->
bi_v®id
 > ()
Buf_size
 - 
Ën
) {\

214 
v®
 = ()
v®ue
;\

215 
s
->
bi_buf
 |ð(
ush
)
v®
 << s->
bi_v®id
;\

216 
	`put_shÜt
(
s
, s->
bi_buf
);\

217 
s
->
bi_buf
 = (
ush
)
v®
 >> (
Buf_size
 - s->
bi_v®id
);\

218 
s
->
bi_v®id
 +ð
Ën
 - 
Buf_size
;\

220 
s
->
bi_buf
 |ð(
ush
)(
v®ue
è<< s->
bi_v®id
;\

221 
s
->
bi_v®id
 +ð
Ën
;\

223 }

	)

232 
loÿl
 
	$Œ_¡©ic_š™
()

234 #ià
	`defšed
(
GEN_TREES_H
è|| !defšed(
STDC
)

235 
¡©ic_š™_dÚe
 = 0;

236 
n
;

237 
b™s
;

238 
Ëngth
;

239 
code
;

240 
di¡
;

241 
ush
 
bl_couÁ
[
MAX_BITS
+1];

244 ià(
¡©ic_š™_dÚe
) ;

247 #ifdeà
NO_INIT_GLOBAL_POINTERS


248 
¡©ic_l_desc
.
¡©ic_Œ“
 = 
¡©ic_É»e
;

249 
¡©ic_l_desc
.
exŒa_b™s
 = 
exŒa_lb™s
;

250 
¡©ic_d_desc
.
¡©ic_Œ“
 = 
¡©ic_dŒ“
;

251 
¡©ic_d_desc
.
exŒa_b™s
 = 
exŒa_db™s
;

252 
¡©ic_bl_desc
.
exŒa_b™s
 = 
exŒa_blb™s
;

256 
Ëngth
 = 0;

257 
code
 = 0; cod< 
LENGTH_CODES
-1; code++) {

258 
ba£_Ëngth
[
code
] = 
Ëngth
;

259 
n
 = 0;‚ < (1<<
exŒa_lb™s
[
code
]);‚++) {

260 
_Ëngth_code
[
Ëngth
++] = (
uch
)
code
;

263 
	`As£¹
 (
Ëngth
 == 256, "tr_static_init:†ength != 256");

268 
_Ëngth_code
[
Ëngth
-1] = (
uch
)
code
;

271 
di¡
 = 0;

272 
code
 = 0 ; code < 16; code++) {

273 
ba£_di¡
[
code
] = 
di¡
;

274 
n
 = 0;‚ < (1<<
exŒa_db™s
[
code
]);‚++) {

275 
_di¡_code
[
di¡
++] = (
uch
)
code
;

278 
	`As£¹
 (
di¡
 == 256, "tr_static_init: dist != 256");

279 
di¡
 >>= 7;

280  ; 
code
 < 
D_CODES
; code++) {

281 
ba£_di¡
[
code
] = 
di¡
 << 7;

282 
n
 = 0;‚ < (1<<(
exŒa_db™s
[
code
]-7));‚++) {

283 
_di¡_code
[256 + 
di¡
++] = (
uch
)
code
;

286 
	`As£¹
 (
di¡
 == 256, "tr_static_init: 256+dist != 512");

289 
b™s
 = 0; b™ <ð
MAX_BITS
; b™s++è
bl_couÁ
[bits] = 0;

290 
n
 = 0;

291 
n
 <ð143è
¡©ic_É»e
[n++].
L’
 = 8, 
bl_couÁ
[8]++;

292 
n
 <ð255è
¡©ic_É»e
[n++].
L’
 = 9, 
bl_couÁ
[9]++;

293 
n
 <ð279è
¡©ic_É»e
[n++].
L’
 = 7, 
bl_couÁ
[7]++;

294 
n
 <ð287è
¡©ic_É»e
[n++].
L’
 = 8, 
bl_couÁ
[8]++;

299 
	`g’_codes
((
ù_d©a
 *)
¡©ic_É»e
, 
L_CODES
+1, 
bl_couÁ
);

302 
n
 = 0;‚ < 
D_CODES
;‚++) {

303 
¡©ic_dŒ“
[
n
].
L’
 = 5;

304 
¡©ic_dŒ“
[
n
].
Code
 = 
	`bi_»v”£
(()n, 5);

306 
¡©ic_š™_dÚe
 = 1;

308 #ifdeà
GEN_TREES_H


309 
	`g’_Œ“s_h—d”
();

312 
	}
}

317 #ifdeà
GEN_TREES_H


318 #iâdeà
ZLIB_DEBUG


319 
	~<¡dio.h
>

322 
	#SEPARATOR
(
i
, 
Ï¡
, 
width
) \

323 ((
i
è=ð(
Ï¡
)? "\n};\n\n" : \

324 ((
i
è% (
width
è=ð(width)-1 ? ",\n" : ", "))

	)

326 
	$g’_Œ“s_h—d”
()

328 
FILE
 *
h—d”
 = 
	`fÝ’
("trees.h", "w");

329 
i
;

331 
	`As£¹
 (
h—d”
 !ð
NULL
, "Can't openrees.h");

332 
	`årštf
(
h—d”
,

335 
	`årštf
(
h—d”
, "local const ct_data static_ltree[L_CODES+2] = {\n");

336 
i
 = 0; i < 
L_CODES
+2; i++) {

337 
	`årštf
(
h—d”
, "{{%3u},{%3u}}%s", 
¡©ic_É»e
[
i
].
Code
,

338 
¡©ic_É»e
[
i
].
L’
, 
	`SEPARATOR
(i, 
L_CODES
+1, 5));

341 
	`årštf
(
h—d”
, "local const ct_data static_dtree[D_CODES] = {\n");

342 
i
 = 0; i < 
D_CODES
; i++) {

343 
	`årštf
(
h—d”
, "{{%2u},{%2u}}%s", 
¡©ic_dŒ“
[
i
].
Code
,

344 
¡©ic_dŒ“
[
i
].
L’
, 
	`SEPARATOR
(i, 
D_CODES
-1, 5));

347 
	`årštf
(
h—d”
, "const uch ZLIB_INTERNAL _dist_code[DIST_CODE_LEN] = {\n");

348 
i
 = 0; i < 
DIST_CODE_LEN
; i++) {

349 
	`årštf
(
h—d”
, "%2u%s", 
_di¡_code
[
i
],

350 
	`SEPARATOR
(
i
, 
DIST_CODE_LEN
-1, 20));

353 
	`årštf
(
h—d”
,

355 
i
 = 0; i < 
MAX_MATCH
-
MIN_MATCH
+1; i++) {

356 
	`årštf
(
h—d”
, "%2u%s", 
_Ëngth_code
[
i
],

357 
	`SEPARATOR
(
i
, 
MAX_MATCH
-
MIN_MATCH
, 20));

360 
	`årštf
(
h—d”
, "local const int base_length[LENGTH_CODES] = {\n");

361 
i
 = 0; i < 
LENGTH_CODES
; i++) {

362 
	`årštf
(
h—d”
, "%1u%s", 
ba£_Ëngth
[
i
],

363 
	`SEPARATOR
(
i
, 
LENGTH_CODES
-1, 20));

366 
	`årštf
(
h—d”
, "local const int base_dist[D_CODES] = {\n");

367 
i
 = 0; i < 
D_CODES
; i++) {

368 
	`årštf
(
h—d”
, "%5u%s", 
ba£_di¡
[
i
],

369 
	`SEPARATOR
(
i
, 
D_CODES
-1, 10));

372 
	`fþo£
(
h—d”
);

373 
	}
}

379 
ZLIB_INTERNAL
 
	$_Œ_š™
(
s
)

380 
deæ©e_¡©e
 *
s
;

382 
	`Œ_¡©ic_š™
();

384 
s
->
l_desc
.
dyn_Œ“
 = s->
dyn_É»e
;

385 
s
->
l_desc
.
¡©_desc
 = &
¡©ic_l_desc
;

387 
s
->
d_desc
.
dyn_Œ“
 = s->
dyn_dŒ“
;

388 
s
->
d_desc
.
¡©_desc
 = &
¡©ic_d_desc
;

390 
s
->
bl_desc
.
dyn_Œ“
 = s->
bl_Œ“
;

391 
s
->
bl_desc
.
¡©_desc
 = &
¡©ic_bl_desc
;

393 
s
->
bi_buf
 = 0;

394 
s
->
bi_v®id
 = 0;

395 #ifdeà
ZLIB_DEBUG


396 
s
->
com´es£d_Ën
 = 0L;

397 
s
->
b™s_£Á
 = 0L;

401 
	`š™_block
(
s
);

402 
	}
}

407 
loÿl
 
	$š™_block
(
s
)

408 
deæ©e_¡©e
 *
s
;

410 
n
;

413 
n
 = 0;‚ < 
L_CODES
;‚++è
s
->
dyn_É»e
[n].
F»q
 = 0;

414 
n
 = 0;‚ < 
D_CODES
;‚++è
s
->
dyn_dŒ“
[n].
F»q
 = 0;

415 
n
 = 0;‚ < 
BL_CODES
;‚++è
s
->
bl_Œ“
[n].
F»q
 = 0;

417 
s
->
dyn_É»e
[
END_BLOCK
].
F»q
 = 1;

418 
s
->
Ýt_Ën
 = s->
¡©ic_Ën
 = 0L;

419 
s
->
Ï¡_l™
 = s->
m©ches
 = 0;

420 
	}
}

422 
	#SMALLEST
 1

	)

430 
	#pq»move
(
s
, 
Œ“
, 
tÝ
) \

432 
tÝ
 = 
s
->
h—p
[
SMALLEST
]; \

433 
s
->
h—p
[
SMALLEST
] = s->h—p[s->
h—p_Ën
--]; \

434 
	`pqdownh—p
(
s
, 
Œ“
, 
SMALLEST
); \

435 }

	)

441 
	#sm®Ër
(
Œ“
, 
n
, 
m
, 
d•th
) \

442 (
Œ“
[
n
].
F»q
 <»e[
m
].Freq || \

443 (
Œ“
[
n
].
F»q
 =ðŒ“[
m
].F»q && 
d•th
[n] <ðd•th[m]))

	)

451 
loÿl
 
	$pqdownh—p
(
s
, 
Œ“
, 
k
)

452 
deæ©e_¡©e
 *
s
;

453 
ù_d©a
 *
Œ“
;

454 
k
;

456 
v
 = 
s
->
h—p
[
k
];

457 
j
 = 
k
 << 1;

458 
j
 <ð
s
->
h—p_Ën
) {

460 ià(
j
 < 
s
->
h—p_Ën
 &&

461 
	`sm®Ër
(
Œ“
, 
s
->
h—p
[
j
+1], s->h—p[j], s->
d•th
)) {

462 
j
++;

465 ià(
	`sm®Ër
(
Œ“
, 
v
, 
s
->
h—p
[
j
], s->
d•th
)) ;

468 
s
->
h—p
[
k
] = s->h—p[
j
]; k = j;

471 
j
 <<= 1;

473 
s
->
h—p
[
k
] = 
v
;

474 
	}
}

486 
loÿl
 
	$g’_b™Ën
(
s
, 
desc
)

487 
deæ©e_¡©e
 *
s
;

488 
Œ“_desc
 *
desc
;

490 
ù_d©a
 *
Œ“
 = 
desc
->
dyn_Œ“
;

491 
max_code
 = 
desc
->max_code;

492 cÚ¡ 
ù_d©a
 *
¡»e
 = 
desc
->
¡©_desc
->
¡©ic_Œ“
;

493 cÚ¡ 
štf
 *
exŒa
 = 
desc
->
¡©_desc
->
exŒa_b™s
;

494 
ba£
 = 
desc
->
¡©_desc
->
exŒa_ba£
;

495 
max_Ëngth
 = 
desc
->
¡©_desc
->max_length;

496 
h
;

497 
n
, 
m
;

498 
b™s
;

499 
xb™s
;

500 
ush
 
f
;

501 
ov”æow
 = 0;

503 
b™s
 = 0; b™ <ð
MAX_BITS
; b™s++è
s
->
bl_couÁ
[bits] = 0;

508 
Œ“
[
s
->
h—p
[s->
h—p_max
]].
L’
 = 0;

510 
h
 = 
s
->
h—p_max
+1; h < 
HEAP_SIZE
; h++) {

511 
n
 = 
s
->
h—p
[
h
];

512 
b™s
 = 
Œ“
[Œ“[
n
].
Dad
].
L’
 + 1;

513 ià(
b™s
 > 
max_Ëngth
èb™ ðmax_Ëngth, 
ov”æow
++;

514 
Œ“
[
n
].
L’
 = (
ush
)
b™s
;

517 ià(
n
 > 
max_code
) ;

519 
s
->
bl_couÁ
[
b™s
]++;

520 
xb™s
 = 0;

521 ià(
n
 >ð
ba£
è
xb™s
 = 
exŒa
[n-base];

522 
f
 = 
Œ“
[
n
].
F»q
;

523 
s
->
Ýt_Ën
 +ð(
ulg
)
f
 * ()(
b™s
 + 
xb™s
);

524 ià(
¡»e
è
s
->
¡©ic_Ën
 +ð(
ulg
)
f
 * ()(¡»e[
n
].
L’
 + 
xb™s
);

526 ià(
ov”æow
 == 0) ;

528 
	`T¿ûv
((
¡d”r
,"\nbit†ength overflow\n"));

533 
b™s
 = 
max_Ëngth
-1;

534 
s
->
bl_couÁ
[
b™s
] == 0) bits--;

535 
s
->
bl_couÁ
[
b™s
]--;

536 
s
->
bl_couÁ
[
b™s
+1] += 2;

537 
s
->
bl_couÁ
[
max_Ëngth
]--;

541 
ov”æow
 -= 2;

542 } 
ov”æow
 > 0);

549 
b™s
 = 
max_Ëngth
; bits != 0; bits--) {

550 
n
 = 
s
->
bl_couÁ
[
b™s
];

551 
n
 != 0) {

552 
m
 = 
s
->
h—p
[--
h
];

553 ià(
m
 > 
max_code
) ;

554 ià((è
Œ“
[
m
].
L’
 !ð(è
b™s
) {

555 
	`T¿ûv
((
¡d”r
,"cod%d b™ %d->%d\n", 
m
, 
Œ“
[m].
L’
, 
b™s
));

556 
s
->
Ýt_Ën
 +ð((
ulg
)
b™s
 - 
Œ“
[
m
].
L’
è*»e[m].
F»q
;

557 
Œ“
[
m
].
L’
 = (
ush
)
b™s
;

559 
n
--;

562 
	}
}

572 
loÿl
 
	$g’_codes
 (
Œ“
, 
max_code
, 
bl_couÁ
)

573 
ù_d©a
 *
Œ“
;

574 
max_code
;

575 
ushf
 *
bl_couÁ
;

577 
ush
 
Ãxt_code
[
MAX_BITS
+1];

578 
code
 = 0;

579 
b™s
;

580 
n
;

585 
b™s
 = 1; b™ <ð
MAX_BITS
; bits++) {

586 
code
 = (cod+ 
bl_couÁ
[
b™s
-1]) << 1;

587 
Ãxt_code
[
b™s
] = (
ush
)
code
;

592 
	`As£¹
 (
code
 + 
bl_couÁ
[
MAX_BITS
]-1 == (1<<MAX_BITS)-1,

594 
	`T¿ûv
((
¡d”r
,"\ng’_codes: max_cod%d ", 
max_code
));

596 
n
 = 0;‚ <ð
max_code
;‚++) {

597 
Ën
 = 
Œ“
[
n
].
L’
;

598 ià(
Ën
 == 0) ;

600 
Œ“
[
n
].
Code
 = (
ush
)
	`bi_»v”£
(
Ãxt_code
[
Ën
]++,†en);

602 
	`T¿ûcv
(
Œ“
 !ð
¡©ic_É»e
, (
¡d”r
,"\nn %3d %c† %2d c %4x (%x) ",

603 
n
, (
	`isg¿ph
Òè?‚ : ' '), 
Ën
, 
Œ“
[n].
Code
, 
Ãxt_code
[len]-1));

605 
	}
}

615 
loÿl
 
	$bužd_Œ“
(
s
, 
desc
)

616 
deæ©e_¡©e
 *
s
;

617 
Œ“_desc
 *
desc
;

619 
ù_d©a
 *
Œ“
 = 
desc
->
dyn_Œ“
;

620 cÚ¡ 
ù_d©a
 *
¡»e
 = 
desc
->
¡©_desc
->
¡©ic_Œ“
;

621 
–ems
 = 
desc
->
¡©_desc
->elems;

622 
n
, 
m
;

623 
max_code
 = -1;

624 
node
;

630 
s
->
h—p_Ën
 = 0, s->
h—p_max
 = 
HEAP_SIZE
;

632 
n
 = 0;‚ < 
–ems
;‚++) {

633 ià(
Œ“
[
n
].
F»q
 != 0) {

634 
s
->
h—p
[++(s->
h—p_Ën
)] = 
max_code
 = 
n
;

635 
s
->
d•th
[
n
] = 0;

637 
Œ“
[
n
].
L’
 = 0;

646 
s
->
h—p_Ën
 < 2) {

647 
node
 = 
s
->
h—p
[++(s->
h—p_Ën
)] = (
max_code
 < 2 ? ++max_code : 0);

648 
Œ“
[
node
].
F»q
 = 1;

649 
s
->
d•th
[
node
] = 0;

650 
s
->
Ýt_Ën
--; ià(
¡»e
ès->
¡©ic_Ën
 -ð¡»e[
node
].
L’
;

653 
desc
->
max_code
 = max_code;

658 
n
 = 
s
->
h—p_Ën
/2;‚ >ð1;‚--è
	`pqdownh—p
(s, 
Œ“
,‚);

663 
node
 = 
–ems
;

665 
	`pq»move
(
s
, 
Œ“
, 
n
);

666 
m
 = 
s
->
h—p
[
SMALLEST
];

668 
s
->
h—p
[--(s->
h—p_max
)] = 
n
;

669 
s
->
h—p
[--(s->
h—p_max
)] = 
m
;

672 
Œ“
[
node
].
F»q
 =»e[
n
].F»q +»e[
m
].Freq;

673 
s
->
d•th
[
node
] = (
uch
)((s->d•th[
n
] >ðs->d•th[
m
] ?

674 
s
->
d•th
[
n
] : s->d•th[
m
]) + 1);

675 
Œ“
[
n
].
Dad
 =»e[
m
].Dad = (
ush
)
node
;

676 #ifdeà
DUMP_BL_TREE


677 ià(
Œ“
 =ð
s
->
bl_Œ“
) {

678 
	`årštf
(
¡d”r
,"\nnode %d(%d), sons %d(%d) %d(%d)",

679 
node
, 
Œ“
[node].
F»q
, 
n
,»e[n].F»q, 
m
,ree[m].Freq);

683 
s
->
h—p
[
SMALLEST
] = 
node
++;

684 
	`pqdownh—p
(
s
, 
Œ“
, 
SMALLEST
);

686 } 
s
->
h—p_Ën
 >= 2);

688 
s
->
h—p
[--(s->
h—p_max
)] = s->h—p[
SMALLEST
];

693 
	`g’_b™Ën
(
s
, (
Œ“_desc
 *)
desc
);

696 
	`g’_codes
 ((
ù_d©a
 *)
Œ“
, 
max_code
, 
s
->
bl_couÁ
);

697 
	}
}

703 
loÿl
 
	$sÿn_Œ“
 (
s
, 
Œ“
, 
max_code
)

704 
deæ©e_¡©e
 *
s
;

705 
ù_d©a
 *
Œ“
;

706 
max_code
;

708 
n
;

709 
´evËn
 = -1;

710 
cu¾’
;

711 
ÃxŽ’
 = 
Œ“
[0].
L’
;

712 
couÁ
 = 0;

713 
max_couÁ
 = 7;

714 
mš_couÁ
 = 4;

716 ià(
ÃxŽ’
 =ð0è
max_couÁ
 = 138, 
mš_couÁ
 = 3;

717 
Œ“
[
max_code
+1].
L’
 = (
ush
)0xffff;

719 
n
 = 0;‚ <ð
max_code
;‚++) {

720 
cu¾’
 = 
ÃxŽ’
;‚exŽ’ = 
Œ“
[
n
+1].
L’
;

721 ià(++
couÁ
 < 
max_couÁ
 && 
cu¾’
 =ð
ÃxŽ’
) {

723 } ià(
couÁ
 < 
mš_couÁ
) {

724 
s
->
bl_Œ“
[
cu¾’
].
F»q
 +ð
couÁ
;

725 } ià(
cu¾’
 != 0) {

726 ià(
cu¾’
 !ð
´evËn
è
s
->
bl_Œ“
[cu¾’].
F»q
++;

727 
s
->
bl_Œ“
[
REP_3_6
].
F»q
++;

728 } ià(
couÁ
 <= 10) {

729 
s
->
bl_Œ“
[
REPZ_3_10
].
F»q
++;

731 
s
->
bl_Œ“
[
REPZ_11_138
].
F»q
++;

733 
couÁ
 = 0; 
´evËn
 = 
cu¾’
;

734 ià(
ÃxŽ’
 == 0) {

735 
max_couÁ
 = 138, 
mš_couÁ
 = 3;

736 } ià(
cu¾’
 =ð
ÃxŽ’
) {

737 
max_couÁ
 = 6, 
mš_couÁ
 = 3;

739 
max_couÁ
 = 7, 
mš_couÁ
 = 4;

742 
	}
}

748 
loÿl
 
	$£nd_Œ“
 (
s
, 
Œ“
, 
max_code
)

749 
deæ©e_¡©e
 *
s
;

750 
ù_d©a
 *
Œ“
;

751 
max_code
;

753 
n
;

754 
´evËn
 = -1;

755 
cu¾’
;

756 
ÃxŽ’
 = 
Œ“
[0].
L’
;

757 
couÁ
 = 0;

758 
max_couÁ
 = 7;

759 
mš_couÁ
 = 4;

762 ià(
ÃxŽ’
 =ð0è
max_couÁ
 = 138, 
mš_couÁ
 = 3;

764 
n
 = 0;‚ <ð
max_code
;‚++) {

765 
cu¾’
 = 
ÃxŽ’
;‚exŽ’ = 
Œ“
[
n
+1].
L’
;

766 ià(++
couÁ
 < 
max_couÁ
 && 
cu¾’
 =ð
ÃxŽ’
) {

768 } ià(
couÁ
 < 
mš_couÁ
) {

769 dØ{ 
	`£nd_code
(
s
, 
cu¾’
, s->
bl_Œ“
); } --
couÁ
 != 0);

771 } ià(
cu¾’
 != 0) {

772 ià(
cu¾’
 !ð
´evËn
) {

773 
	`£nd_code
(
s
, 
cu¾’
, s->
bl_Œ“
); 
couÁ
--;

775 
	`As£¹
(
couÁ
 >= 3 && count <= 6, " 3_6?");

776 
	`£nd_code
(
s
, 
REP_3_6
, s->
bl_Œ“
); 
	`£nd_b™s
(s, 
couÁ
-3, 2);

778 } ià(
couÁ
 <= 10) {

779 
	`£nd_code
(
s
, 
REPZ_3_10
, s->
bl_Œ“
); 
	`£nd_b™s
(s, 
couÁ
-3, 3);

782 
	`£nd_code
(
s
, 
REPZ_11_138
, s->
bl_Œ“
); 
	`£nd_b™s
(s, 
couÁ
-11, 7);

784 
couÁ
 = 0; 
´evËn
 = 
cu¾’
;

785 ià(
ÃxŽ’
 == 0) {

786 
max_couÁ
 = 138, 
mš_couÁ
 = 3;

787 } ià(
cu¾’
 =ð
ÃxŽ’
) {

788 
max_couÁ
 = 6, 
mš_couÁ
 = 3;

790 
max_couÁ
 = 7, 
mš_couÁ
 = 4;

793 
	}
}

799 
loÿl
 
	$bužd_bl_Œ“
(
s
)

800 
deæ©e_¡©e
 *
s
;

802 
max_blšdex
;

805 
	`sÿn_Œ“
(
s
, (
ù_d©a
 *)s->
dyn_É»e
, s->
l_desc
.
max_code
);

806 
	`sÿn_Œ“
(
s
, (
ù_d©a
 *)s->
dyn_dŒ“
, s->
d_desc
.
max_code
);

809 
	`bužd_Œ“
(
s
, (
Œ“_desc
 *)(&(s->
bl_desc
)));

818 
max_blšdex
 = 
BL_CODES
-1; max_blindex >= 3; max_blindex--) {

819 ià(
s
->
bl_Œ“
[
bl_Üd”
[
max_blšdex
]].
L’
 != 0) ;

822 
s
->
Ýt_Ën
 +ð3*((
ulg
)
max_blšdex
+1) + 5+5+4;

823 
	`T¿ûv
((
¡d”r
, "\ndynrees: dyn %ld, stat %ld",

824 
s
->
Ýt_Ën
, s->
¡©ic_Ën
));

826  
max_blšdex
;

827 
	}
}

834 
loÿl
 
	$£nd_®l_Œ“s
(
s
, 
lcodes
, 
dcodes
, 
blcodes
)

835 
deæ©e_¡©e
 *
s
;

836 
lcodes
, 
dcodes
, 
blcodes
;

838 
¿nk
;

840 
	`As£¹
 (
lcodes
 >ð257 && 
dcodes
 >ð1 && 
blcodes
 >= 4, "notƒnough codes");

841 
	`As£¹
 (
lcodes
 <ð
L_CODES
 && 
dcodes
 <ð
D_CODES
 && 
blcodes
 <ð
BL_CODES
,

843 
	`T¿ûv
((
¡d”r
, "\nbl counts: "));

844 
	`£nd_b™s
(
s
, 
lcodes
-257, 5);

845 
	`£nd_b™s
(
s
, 
dcodes
-1, 5);

846 
	`£nd_b™s
(
s
, 
blcodes
-4, 4);

847 
¿nk
 = 0;„ªk < 
blcodes
;„ank++) {

848 
	`T¿ûv
((
¡d”r
, "\nbÈcod%2d ", 
bl_Üd”
[
¿nk
]));

849 
	`£nd_b™s
(
s
, s->
bl_Œ“
[
bl_Üd”
[
¿nk
]].
L’
, 3);

851 
	`T¿ûv
((
¡d”r
, "\nbÈŒ“: s’ˆ%ld", 
s
->
b™s_£Á
));

853 
	`£nd_Œ“
(
s
, (
ù_d©a
 *)s->
dyn_É»e
, 
lcodes
-1);

854 
	`T¿ûv
((
¡d”r
, "\Æ™»e: s’ˆ%ld", 
s
->
b™s_£Á
));

856 
	`£nd_Œ“
(
s
, (
ù_d©a
 *)s->
dyn_dŒ“
, 
dcodes
-1);

857 
	`T¿ûv
((
¡d”r
, "\ndi¡»e: s’ˆ%ld", 
s
->
b™s_£Á
));

858 
	}
}

863 
ZLIB_INTERNAL
 
	$_Œ_¡Üed_block
(
s
, 
buf
, 
¡Üed_Ën
, 
Ï¡
)

864 
deæ©e_¡©e
 *
s
;

865 
ch¬f
 *
buf
;

866 
ulg
 
¡Üed_Ën
;

867 
Ï¡
;

869 
	`£nd_b™s
(
s
, (
STORED_BLOCK
<<1)+
Ï¡
, 3);

870 
	`bi_wšdup
(
s
);

871 
	`put_shÜt
(
s
, (
ush
)
¡Üed_Ën
);

872 
	`put_shÜt
(
s
, (
ush
)~
¡Üed_Ën
);

873 
	`zmemýy
(
s
->
³ndšg_buf
 + s->
³ndšg
, (
By‹f
 *)
buf
, 
¡Üed_Ën
);

874 
s
->
³ndšg
 +ð
¡Üed_Ën
;

875 #ifdeà
ZLIB_DEBUG


876 
s
->
com´es£d_Ën
 = (s->com´es£d_ËÀ+ 3 + 7è& (
ulg
)~7L;

877 
s
->
com´es£d_Ën
 +ð(
¡Üed_Ën
 + 4) << 3;

878 
s
->
b™s_£Á
 += 2*16;

879 
s
->
b™s_£Á
 +ð
¡Üed_Ën
<<3;

881 
	}
}

886 
ZLIB_INTERNAL
 
	$_Œ_æush_b™s
(
s
)

887 
deæ©e_¡©e
 *
s
;

889 
	`bi_æush
(
s
);

890 
	}
}

896 
ZLIB_INTERNAL
 
	$_Œ_®ign
(
s
)

897 
deæ©e_¡©e
 *
s
;

899 
	`£nd_b™s
(
s
, 
STATIC_TREES
<<1, 3);

900 
	`£nd_code
(
s
, 
END_BLOCK
, 
¡©ic_É»e
);

901 #ifdeà
ZLIB_DEBUG


902 
s
->
com´es£d_Ën
 += 10L;

904 
	`bi_æush
(
s
);

905 
	}
}

911 
ZLIB_INTERNAL
 
	$_Œ_æush_block
(
s
, 
buf
, 
¡Üed_Ën
, 
Ï¡
)

912 
deæ©e_¡©e
 *
s
;

913 
ch¬f
 *
buf
;

914 
ulg
 
¡Üed_Ën
;

915 
Ï¡
;

917 
ulg
 
Ýt_Ënb
, 
¡©ic_Ënb
;

918 
max_blšdex
 = 0;

921 ià(
s
->
Ëv–
 > 0) {

924 ià(
s
->
¡rm
->
d©a_ty³
 =ð
Z_UNKNOWN
)

925 
s
->
¡rm
->
d©a_ty³
 = 
	`d‘eù_d©a_ty³
(s);

928 
	`bužd_Œ“
(
s
, (
Œ“_desc
 *)(&(s->
l_desc
)));

929 
	`T¿ûv
((
¡d”r
, "\Æ™ d©a: dyÀ%ld, sˆ%ld", 
s
->
Ýt_Ën
,

930 
s
->
¡©ic_Ën
));

932 
	`bužd_Œ“
(
s
, (
Œ“_desc
 *)(&(s->
d_desc
)));

933 
	`T¿ûv
((
¡d”r
, "\ndi¡ d©a: dyÀ%ld, sˆ%ld", 
s
->
Ýt_Ën
,

934 
s
->
¡©ic_Ën
));

942 
max_blšdex
 = 
	`bužd_bl_Œ“
(
s
);

945 
Ýt_Ënb
 = (
s
->
Ýt_Ën
+3+7)>>3;

946 
¡©ic_Ënb
 = (
s
->
¡©ic_Ën
+3+7)>>3;

948 
	`T¿ûv
((
¡d”r
, "\nopt %lu(%lu) stat %lu(%lu) stored %lu†it %u ",

949 
Ýt_Ënb
, 
s
->
Ýt_Ën
, 
¡©ic_Ënb
, s->
¡©ic_Ën
, 
¡Üed_Ën
,

950 
s
->
Ï¡_l™
));

952 ià(
¡©ic_Ënb
 <ð
Ýt_Ënb
) opt_lenb = static_lenb;

955 
	`As£¹
(
buf
 != (*)0, "lost buf");

956 
Ýt_Ënb
 = 
¡©ic_Ënb
 = 
¡Üed_Ën
 + 5;

959 #ifdeà
FORCE_STORED


960 ià(
buf
 != (*)0) {

962 ià(
¡Üed_Ën
+4 <ð
Ýt_Ënb
 && 
buf
 != (*)0) {

971 
	`_Œ_¡Üed_block
(
s
, 
buf
, 
¡Üed_Ën
, 
Ï¡
);

973 #ifdeà
FORCE_STATIC


974 } ià(
¡©ic_Ënb
 >= 0) {

976 } ià(
s
->
¡¿‹gy
 =ð
Z_FIXED
 || 
¡©ic_Ënb
 =ð
Ýt_Ënb
) {

978 
	`£nd_b™s
(
s
, (
STATIC_TREES
<<1)+
Ï¡
, 3);

979 
	`com´ess_block
(
s
, (cÚ¡ 
ù_d©a
 *)
¡©ic_É»e
,

980 (cÚ¡ 
ù_d©a
 *)
¡©ic_dŒ“
);

981 #ifdeà
ZLIB_DEBUG


982 
s
->
com´es£d_Ën
 +ð3 + s->
¡©ic_Ën
;

985 
	`£nd_b™s
(
s
, (
DYN_TREES
<<1)+
Ï¡
, 3);

986 
	`£nd_®l_Œ“s
(
s
, s->
l_desc
.
max_code
+1, s->
d_desc
.max_code+1,

987 
max_blšdex
+1);

988 
	`com´ess_block
(
s
, (cÚ¡ 
ù_d©a
 *)s->
dyn_É»e
,

989 (cÚ¡ 
ù_d©a
 *)
s
->
dyn_dŒ“
);

990 #ifdeà
ZLIB_DEBUG


991 
s
->
com´es£d_Ën
 +ð3 + s->
Ýt_Ën
;

994 
	`As£¹
 (
s
->
com´es£d_Ën
 =ðs->
b™s_£Á
, "bad compressed size");

998 
	`š™_block
(
s
);

1000 ià(
Ï¡
) {

1001 
	`bi_wšdup
(
s
);

1002 #ifdeà
ZLIB_DEBUG


1003 
s
->
com´es£d_Ën
 += 7;

1006 
	`T¿ûv
((
¡d”r
,"\ncom´ËÀ%lu(%luè", 
s
->
com´es£d_Ën
>>3,

1007 
s
->
com´es£d_Ën
-7*
Ï¡
));

1008 
	}
}

1014 
ZLIB_INTERNAL
 
	$_Œ_Îy
 (
s
, 
di¡
, 
lc
)

1015 
deæ©e_¡©e
 *
s
;

1016 
di¡
;

1017 
lc
;

1019 
s
->
d_buf
[s->
Ï¡_l™
] = (
ush
)
di¡
;

1020 
s
->
l_buf
[s->
Ï¡_l™
++] = (
uch
)
lc
;

1021 ià(
di¡
 == 0) {

1023 
s
->
dyn_É»e
[
lc
].
F»q
++;

1025 
s
->
m©ches
++;

1027 
di¡
--;

1028 
	`As£¹
((
ush
)
di¡
 < (ush)
	`MAX_DIST
(
s
) &&

1029 (
ush
)
lc
 <ð(ush)(
MAX_MATCH
-
MIN_MATCH
) &&

1030 (
ush
)
	`d_code
(
di¡
è< (ush)
D_CODES
, "_tr_tally: bad match");

1032 
s
->
dyn_É»e
[
_Ëngth_code
[
lc
]+
LITERALS
+1].
F»q
++;

1033 
s
->
dyn_dŒ“
[
	`d_code
(
di¡
)].
F»q
++;

1036 #ifdeà
TRUNCATE_BLOCK


1038 ià((
s
->
Ï¡_l™
 & 0x1fffè=ð0 && s->
Ëv–
 > 2) {

1040 
ulg
 
out_Ëngth
 = (ulg)
s
->
Ï¡_l™
*8L;

1041 
ulg
 
š_Ëngth
 = (ulg)(()
s
->
¡r¡¬t
 - s->
block_¡¬t
);

1042 
dcode
;

1043 
dcode
 = 0; dcod< 
D_CODES
; dcode++) {

1044 
out_Ëngth
 +ð(
ulg
)
s
->
dyn_dŒ“
[
dcode
].
F»q
 *

1045 (5L+
exŒa_db™s
[
dcode
]);

1047 
out_Ëngth
 >>= 3;

1048 
	`T¿ûv
((
¡d”r
,"\nlast_lit %u, in %ld, out ~%ld(%ld%%) ",

1049 
s
->
Ï¡_l™
, 
š_Ëngth
, 
out_Ëngth
,

1050 100L - 
out_Ëngth
*100L/
š_Ëngth
));

1051 ià(
s
->
m©ches
 < s->
Ï¡_l™
/2 && 
out_Ëngth
 < 
š_Ëngth
/2)  1;

1054  (
s
->
Ï¡_l™
 =ðs->
l™_bufsize
-1);

1059 
	}
}

1064 
loÿl
 
	$com´ess_block
(
s
, 
É»e
, 
dŒ“
)

1065 
deæ©e_¡©e
 *
s
;

1066 cÚ¡ 
ù_d©a
 *
É»e
;

1067 cÚ¡ 
ù_d©a
 *
dŒ“
;

1069 
di¡
;

1070 
lc
;

1071 
lx
 = 0;

1072 
code
;

1073 
exŒa
;

1075 ià(
s
->
Ï¡_l™
 != 0) do {

1076 
di¡
 = 
s
->
d_buf
[
lx
];

1077 
lc
 = 
s
->
l_buf
[
lx
++];

1078 ià(
di¡
 == 0) {

1079 
	`£nd_code
(
s
, 
lc
, 
É»e
);

1080 
	`T¿ûcv
(
	`isg¿ph
(
lc
), (
¡d”r
," '%c' ",†c));

1083 
code
 = 
_Ëngth_code
[
lc
];

1084 
	`£nd_code
(
s
, 
code
+
LITERALS
+1, 
É»e
);

1085 
exŒa
 = 
exŒa_lb™s
[
code
];

1086 ià(
exŒa
 != 0) {

1087 
lc
 -ð
ba£_Ëngth
[
code
];

1088 
	`£nd_b™s
(
s
, 
lc
, 
exŒa
);

1090 
di¡
--;

1091 
code
 = 
	`d_code
(
di¡
);

1092 
	`As£¹
 (
code
 < 
D_CODES
, "bad d_code");

1094 
	`£nd_code
(
s
, 
code
, 
dŒ“
);

1095 
exŒa
 = 
exŒa_db™s
[
code
];

1096 ià(
exŒa
 != 0) {

1097 
di¡
 -ð()
ba£_di¡
[
code
];

1098 
	`£nd_b™s
(
s
, 
di¡
, 
exŒa
);

1103 
	`As£¹
((
uIÁ
)(
s
->
³ndšg
è< s->
l™_bufsize
 + 2*
lx
,

1106 } 
lx
 < 
s
->
Ï¡_l™
);

1108 
	`£nd_code
(
s
, 
END_BLOCK
, 
É»e
);

1109 
	}
}

1124 
loÿl
 
	$d‘eù_d©a_ty³
(
s
)

1125 
deæ©e_¡©e
 *
s
;

1131 
bÏck_mask
 = 0xf3ffc07fUL;

1132 
n
;

1135 
n
 = 0;‚ <ð31;‚++, 
bÏck_mask
 >>= 1)

1136 ià((
bÏck_mask
 & 1è&& (
s
->
dyn_É»e
[
n
].
F»q
 != 0))

1137  
Z_BINARY
;

1140 ià(
s
->
dyn_É»e
[9].
F»q
 != 0 || s->dyn_ltree[10].Freq != 0

1141 || 
s
->
dyn_É»e
[13].
F»q
 != 0)

1142  
Z_TEXT
;

1143 
n
 = 32;‚ < 
LITERALS
;‚++)

1144 ià(
s
->
dyn_É»e
[
n
].
F»q
 != 0)

1145  
Z_TEXT
;

1150  
Z_BINARY
;

1151 
	}
}

1158 
loÿl
 
	$bi_»v”£
(
code
, 
Ën
)

1159 
code
;

1160 
Ën
;

1162 
»s
 = 0;

1164 
»s
 |ð
code
 & 1;

1165 
code
 >>ð1, 
»s
 <<= 1;

1166 } --
Ën
 > 0);

1167  
»s
 >> 1;

1168 
	}
}

1173 
loÿl
 
	$bi_æush
(
s
)

1174 
deæ©e_¡©e
 *
s
;

1176 ià(
s
->
bi_v®id
 == 16) {

1177 
	`put_shÜt
(
s
, s->
bi_buf
);

1178 
s
->
bi_buf
 = 0;

1179 
s
->
bi_v®id
 = 0;

1180 } ià(
s
->
bi_v®id
 >= 8) {

1181 
	`put_by‹
(
s
, (
By‹
)s->
bi_buf
);

1182 
s
->
bi_buf
 >>= 8;

1183 
s
->
bi_v®id
 -= 8;

1185 
	}
}

1190 
loÿl
 
	$bi_wšdup
(
s
)

1191 
deæ©e_¡©e
 *
s
;

1193 ià(
s
->
bi_v®id
 > 8) {

1194 
	`put_shÜt
(
s
, s->
bi_buf
);

1195 } ià(
s
->
bi_v®id
 > 0) {

1196 
	`put_by‹
(
s
, (
By‹
)s->
bi_buf
);

1198 
s
->
bi_buf
 = 0;

1199 
s
->
bi_v®id
 = 0;

1200 #ifdeà
ZLIB_DEBUG


1201 
s
->
b™s_£Á
 = (s->bits_sent+7) & ~7;

1203 
	}
}

	@zlib/trees.h

3 
loÿl
 cÚ¡ 
ù_d©a
 
	g¡©ic_É»e
[
L_CODES
+2] = {

64 
loÿl
 cÚ¡ 
ù_d©a
 
	g¡©ic_dŒ“
[
D_CODES
] = {

73 cÚ¡ 
uch
 
ZLIB_INTERNAL
 
	g_di¡_code
[
DIST_CODE_LEN
] = {

102 cÚ¡ 
uch
 
ZLIB_INTERNAL
 
	g_Ëngth_code
[
MAX_MATCH
-
MIN_MATCH
+1]= {

118 
loÿl
 cÚ¡ 
	gba£_Ëngth
[
LENGTH_CODES
] = {

123 
loÿl
 cÚ¡ 
	gba£_di¡
[
D_CODES
] = {

	@zlib/uncompr.c

8 
	#ZLIB_INTERNAL


	)

9 
	~"zlib.h
"

27 
ZEXPORT
 
	$uncom´ess2
 (
de¡
, 
de¡L’
, 
sourû
, 
sourûL’
)

28 
By‹f
 *
de¡
;

29 
uLÚgf
 *
de¡L’
;

30 cÚ¡ 
By‹f
 *
sourû
;

31 
uLÚg
 *
sourûL’
;

33 
z_¡»am
 
¡»am
;

34 
”r
;

35 cÚ¡ 
uIÁ
 
max
 = (uInt)-1;

36 
uLÚg
 
Ën
, 
Ëá
;

37 
By‹
 
buf
[1];

39 
Ën
 = *
sourûL’
;

40 ià(*
de¡L’
) {

41 
Ëá
 = *
de¡L’
;

42 *
de¡L’
 = 0;

45 
Ëá
 = 1;

46 
de¡
 = 
buf
;

49 
¡»am
.
Ãxt_š
 = (
z_cÚ¡
 
By‹f
 *)
sourû
;

50 
¡»am
.
avaž_š
 = 0;

51 
¡»am
.
z®loc
 = (
®loc_func
)0;

52 
¡»am
.
zä“
 = (
ä“_func
)0;

53 
¡»am
.
Ýaque
 = (
voidpf
)0;

55 
”r
 = 
	`šæ©eIn™
(&
¡»am
);

56 ià(
”r
 !ð
Z_OK
) ƒrr;

58 
¡»am
.
Ãxt_out
 = 
de¡
;

59 
¡»am
.
avaž_out
 = 0;

62 ià(
¡»am
.
avaž_out
 == 0) {

63 
¡»am
.
avaž_out
 = 
Ëá
 > (
uLÚg
)
max
 ? max : (
uIÁ
)left;

64 
Ëá
 -ð
¡»am
.
avaž_out
;

66 ià(
¡»am
.
avaž_š
 == 0) {

67 
¡»am
.
avaž_š
 = 
Ën
 > (
uLÚg
)
max
 ? max : (
uIÁ
)len;

68 
Ën
 -ð
¡»am
.
avaž_š
;

70 
”r
 = 
	`šæ©e
(&
¡»am
, 
Z_NO_FLUSH
);

71 } 
”r
 =ð
Z_OK
);

73 *
sourûL’
 -ð
Ën
 + 
¡»am
.
avaž_š
;

74 ià(
de¡
 !ð
buf
)

75 *
de¡L’
 = 
¡»am
.
tÙ®_out
;

76 ià(
¡»am
.
tÙ®_out
 && 
”r
 =ð
Z_BUF_ERROR
)

77 
Ëá
 = 1;

79 
	`šæ©eEnd
(&
¡»am
);

80  
”r
 =ð
Z_STREAM_END
 ? 
Z_OK
 :

81 
”r
 =ð
Z_NEED_DICT
 ? 
Z_DATA_ERROR
 :

82 
”r
 =ð
Z_BUF_ERROR
 && 
Ëá
 + 
¡»am
.
avaž_out
 ? 
Z_DATA_ERROR
 :

83 
”r
;

84 
	}
}

86 
ZEXPORT
 
	$uncom´ess
 (
de¡
, 
de¡L’
, 
sourû
, 
sourûL’
)

87 
By‹f
 *
de¡
;

88 
uLÚgf
 *
de¡L’
;

89 cÚ¡ 
By‹f
 *
sourû
;

90 
uLÚg
 
sourûL’
;

92  
	`uncom´ess2
(
de¡
, 
de¡L’
, 
sourû
, &
sourûL’
);

93 
	}
}

	@zlib/zconf.h

8 #iâdeà
ZCONF_H


9 
	#ZCONF_H


	)

17 #ifdeà
Z_PREFIX


18 
	#Z_PREFIX_SET


	)

21 
	#_di¡_code
 
z__di¡_code


	)

22 
	#_Ëngth_code
 
z__Ëngth_code


	)

23 
	#_Œ_®ign
 
z__Œ_®ign


	)

24 
	#_Œ_æush_b™s
 
z__Œ_æush_b™s


	)

25 
	#_Œ_æush_block
 
z__Œ_æush_block


	)

26 
	#_Œ_š™
 
z__Œ_š™


	)

27 
	#_Œ_¡Üed_block
 
z__Œ_¡Üed_block


	)

28 
	#_Œ_Îy
 
z__Œ_Îy


	)

29 
	#adËr32
 
z_adËr32


	)

30 
	#adËr32_combše
 
z_adËr32_combše


	)

31 
	#adËr32_combše64
 
z_adËr32_combše64


	)

32 
	#adËr32_z
 
z_adËr32_z


	)

33 #iâdeà
Z_SOLO


34 
	#com´ess
 
z_com´ess


	)

35 
	#com´ess2
 
z_com´ess2


	)

36 
	#com´essBound
 
z_com´essBound


	)

38 
	#üc32
 
z_üc32


	)

39 
	#üc32_combše
 
z_üc32_combše


	)

40 
	#üc32_combše64
 
z_üc32_combše64


	)

41 
	#üc32_z
 
z_üc32_z


	)

42 
	#deæ©e
 
z_deæ©e


	)

43 
	#deæ©eBound
 
z_deæ©eBound


	)

44 
	#deæ©eCÝy
 
z_deæ©eCÝy


	)

45 
	#deæ©eEnd
 
z_deæ©eEnd


	)

46 
	#deæ©eG‘DiùiÚ¬y
 
z_deæ©eG‘DiùiÚ¬y


	)

47 
	#deæ©eIn™
 
z_deæ©eIn™


	)

48 
	#deæ©eIn™2
 
z_deæ©eIn™2


	)

49 
	#deæ©eIn™2_
 
z_deæ©eIn™2_


	)

50 
	#deæ©eIn™_
 
z_deæ©eIn™_


	)

51 
	#deæ©eP¬ams
 
z_deæ©eP¬ams


	)

52 
	#deæ©eP’dšg
 
z_deæ©eP’dšg


	)

53 
	#deæ©ePrime
 
z_deæ©ePrime


	)

54 
	#deæ©eRe£t
 
z_deæ©eRe£t


	)

55 
	#deæ©eRe£tK“p
 
z_deæ©eRe£tK“p


	)

56 
	#deæ©eS‘DiùiÚ¬y
 
z_deæ©eS‘DiùiÚ¬y


	)

57 
	#deæ©eS‘H—d”
 
z_deæ©eS‘H—d”


	)

58 
	#deæ©eTuÃ
 
z_deæ©eTuÃ


	)

59 
	#deæ©e_cÝyright
 
z_deæ©e_cÝyright


	)

60 
	#g‘_üc_bË
 
z_g‘_üc_bË


	)

61 #iâdeà
Z_SOLO


62 
	#gz_”rÜ
 
z_gz_”rÜ


	)

63 
	#gz_štmax
 
z_gz_štmax


	)

64 
	#gz_¡rwš”rÜ
 
z_gz_¡rwš”rÜ


	)

65 
	#gzbufãr
 
z_gzbufãr


	)

66 
	#gzþ—»¼
 
z_gzþ—»¼


	)

67 
	#gzþo£
 
z_gzþo£


	)

68 
	#gzþo£_r
 
z_gzþo£_r


	)

69 
	#gzþo£_w
 
z_gzþo£_w


	)

70 
	#gzdœeù
 
z_gzdœeù


	)

71 
	#gzdÝ’
 
z_gzdÝ’


	)

72 
	#gzeof
 
z_gzeof


	)

73 
	#gz”rÜ
 
z_gz”rÜ


	)

74 
	#gzæush
 
z_gzæush


	)

75 
	#gzä—d
 
z_gzä—d


	)

76 
	#gzfwr™e
 
z_gzfwr™e


	)

77 
	#gzg‘c
 
z_gzg‘c


	)

78 
	#gzg‘c_
 
z_gzg‘c_


	)

79 
	#gzg‘s
 
z_gzg‘s


	)

80 
	#gzoff£t
 
z_gzoff£t


	)

81 
	#gzoff£t64
 
z_gzoff£t64


	)

82 
	#gzÝ’
 
z_gzÝ’


	)

83 
	#gzÝ’64
 
z_gzÝ’64


	)

84 #ifdeà
_WIN32


85 
	#gzÝ’_w
 
z_gzÝ’_w


	)

87 
	#gz´štf
 
z_gz´štf


	)

88 
	#gzputc
 
z_gzputc


	)

89 
	#gzputs
 
z_gzputs


	)

90 
	#gz»ad
 
z_gz»ad


	)

91 
	#gz»wšd
 
z_gz»wšd


	)

92 
	#gz£ek
 
z_gz£ek


	)

93 
	#gz£ek64
 
z_gz£ek64


	)

94 
	#gz£¬ams
 
z_gz£¬ams


	)

95 
	#gz‹Î
 
z_gz‹Î


	)

96 
	#gz‹Î64
 
z_gz‹Î64


	)

97 
	#gzung‘c
 
z_gzung‘c


	)

98 
	#gzv´štf
 
z_gzv´štf


	)

99 
	#gzwr™e
 
z_gzwr™e


	)

101 
	#šæ©e
 
z_šæ©e


	)

102 
	#šæ©eBack
 
z_šæ©eBack


	)

103 
	#šæ©eBackEnd
 
z_šæ©eBackEnd


	)

104 
	#šæ©eBackIn™
 
z_šæ©eBackIn™


	)

105 
	#šæ©eBackIn™_
 
z_šæ©eBackIn™_


	)

106 
	#šæ©eCodesU£d
 
z_šæ©eCodesU£d


	)

107 
	#šæ©eCÝy
 
z_šæ©eCÝy


	)

108 
	#šæ©eEnd
 
z_šæ©eEnd


	)

109 
	#šæ©eG‘DiùiÚ¬y
 
z_šæ©eG‘DiùiÚ¬y


	)

110 
	#šæ©eG‘H—d”
 
z_šæ©eG‘H—d”


	)

111 
	#šæ©eIn™
 
z_šæ©eIn™


	)

112 
	#šæ©eIn™2
 
z_šæ©eIn™2


	)

113 
	#šæ©eIn™2_
 
z_šæ©eIn™2_


	)

114 
	#šæ©eIn™_
 
z_šæ©eIn™_


	)

115 
	#šæ©eM¬k
 
z_šæ©eM¬k


	)

116 
	#šæ©ePrime
 
z_šæ©ePrime


	)

117 
	#šæ©eRe£t
 
z_šæ©eRe£t


	)

118 
	#šæ©eRe£t2
 
z_šæ©eRe£t2


	)

119 
	#šæ©eRe£tK“p
 
z_šæ©eRe£tK“p


	)

120 
	#šæ©eS‘DiùiÚ¬y
 
z_šæ©eS‘DiùiÚ¬y


	)

121 
	#šæ©eSync
 
z_šæ©eSync


	)

122 
	#šæ©eSyncPošt
 
z_šæ©eSyncPošt


	)

123 
	#šæ©eUnd”mše
 
z_šæ©eUnd”mše


	)

124 
	#šæ©eV®id©e
 
z_šæ©eV®id©e


	)

125 
	#šæ©e_cÝyright
 
z_šæ©e_cÝyright


	)

126 
	#šæ©e_ç¡
 
z_šæ©e_ç¡


	)

127 
	#šæ©e_bË
 
z_šæ©e_bË


	)

128 #iâdeà
Z_SOLO


129 
	#uncom´ess
 
z_uncom´ess


	)

130 
	#uncom´ess2
 
z_uncom´ess2


	)

132 
	#zE¼Ü
 
z_zE¼Ü


	)

133 #iâdeà
Z_SOLO


134 
	#zÿÎoc
 
z_zÿÎoc


	)

135 
	#zcä“
 
z_zcä“


	)

137 
	#zlibCompžeFÏgs
 
z_zlibCompžeFÏgs


	)

138 
	#zlibV”siÚ
 
z_zlibV”siÚ


	)

141 
	#By‹
 
z_By‹


	)

142 
	#By‹f
 
z_By‹f


	)

143 
	#®loc_func
 
z_®loc_func


	)

144 
	#ch¬f
 
z_ch¬f


	)

145 
	#ä“_func
 
z_ä“_func


	)

146 #iâdeà
Z_SOLO


147 
	#gzFže
 
z_gzFže


	)

149 
	#gz_h—d”
 
z_gz_h—d”


	)

150 
	#gz_h—d”p
 
z_gz_h—d”p


	)

151 
	#š_func
 
z_š_func


	)

152 
	#štf
 
z_štf


	)

153 
	#out_func
 
z_out_func


	)

154 
	#uIÁ
 
z_uIÁ


	)

155 
	#uIÁf
 
z_uIÁf


	)

156 
	#uLÚg
 
z_uLÚg


	)

157 
	#uLÚgf
 
z_uLÚgf


	)

158 
	#voidp
 
z_voidp


	)

159 
	#voidpc
 
z_voidpc


	)

160 
	#voidpf
 
z_voidpf


	)

163 
	#gz_h—d”_s
 
z_gz_h—d”_s


	)

164 
	#š‹º®_¡©e
 
z_š‹º®_¡©e


	)

168 #ià
defšed
(
__MSDOS__
è&& !defšed(
MSDOS
)

169 
	#MSDOS


	)

171 #ià(
defšed
(
OS_2
è|| defšed(
__OS2__
)è&& !defšed(
OS2
)

172 
	#OS2


	)

174 #ià
defšed
(
_WINDOWS
è&& !defšed(
WINDOWS
)

175 
	#WINDOWS


	)

177 #ià
defšed
(
_WIN32
è|| defšed(
_WIN32_WCE
è|| defšed(
__WIN32__
)

178 #iâdeà
WIN32


179 
	#WIN32


	)

182 #ià(
defšed
(
MSDOS
è|| defšed(
OS2
è|| defšed(
WINDOWS
)è&& !defšed(
WIN32
)

183 #ià!
defšed
(
__GNUC__
è&& !defšed(
__FLAT__
è&& !defšed(
__386__
)

184 #iâdeà
SYS16BIT


185 
	#SYS16BIT


	)

194 #ifdeà
SYS16BIT


195 
	#MAXSEG_64K


	)

197 #ifdeà
MSDOS


198 
	#UNALIGNED_OK


	)

201 #ifdeà
__STDC_VERSION__


202 #iâdeà
STDC


203 
	#STDC


	)

205 #ià
__STDC_VERSION__
 >= 199901L

206 #iâdeà
STDC99


207 
	#STDC99


	)

211 #ià!
defšed
(
STDC
è&& (defšed(
__STDC__
è|| defšed(
__ýlu¥lus
))

212 
	#STDC


	)

214 #ià!
defšed
(
STDC
è&& (defšed(
__GNUC__
è|| defšed(
__BORLANDC__
))

215 
	#STDC


	)

217 #ià!
defšed
(
STDC
è&& (defšed(
MSDOS
è|| defšed(
WINDOWS
è|| defšed(
WIN32
))

218 
	#STDC


	)

220 #ià!
defšed
(
STDC
è&& (defšed(
OS2
è|| defšed(
__HOS_AIX__
))

221 
	#STDC


	)

224 #ià
defšed
(
__OS400__
è&& !defšed(
STDC
)

225 
	#STDC


	)

228 #iâdeà
STDC


230 cÚ¡

	)

234 #ià
defšed
(
ZLIB_CONST
è&& !defšed(
z_cÚ¡
)

235 
	#z_cÚ¡
 cÚ¡

	)

237 
	#z_cÚ¡


	)

240 #ifdeà
Z_SOLO


241 
	tz_size_t
;

243 
	#z_lÚglÚg
 

	)

244 #ià
defšed
(
NO_SIZE_T
)

245 
	tNO_SIZE_T
 
	tz_size_t
;

246 #–ià
defšed
(
STDC
)

247 
	~<¡ddef.h
>

248 
size_t
 
	tz_size_t
;

250 
	tz_size_t
;

252 #undeà
z_lÚglÚg


256 #iâdeà
MAX_MEM_LEVEL


257 #ifdeà
MAXSEG_64K


258 
	#MAX_MEM_LEVEL
 8

	)

260 
	#MAX_MEM_LEVEL
 9

	)

269 #iâdeà
MAX_WBITS


270 
	#MAX_WBITS
 15

	)

288 #iâdeà
OF


289 #ifdeà
STDC


290 
	#OF
(
¬gs
è
	)
args

292 
	#OF
(
¬gs
è()

	)

296 #iâdeà
Z_ARG


297 #ià
defšed
(
STDC
è|| defšed(
Z_HAVE_STDARG_H
)

298 
	#Z_ARG
(
¬gs
è
	)
args

300 
	#Z_ARG
(
¬gs
è()

	)

310 #ifdeà
SYS16BIT


311 #ià
defšed
(
M_I86SM
è|| defšed(
M_I86MM
)

313 
	#SMALL_MEDIUM


	)

314 #ifdeà
_MSC_VER


315 
	#FAR
 
_çr


	)

317 
	#FAR
 
çr


	)

320 #ià(
defšed
(
__SMALL__
è|| defšed(
__MEDIUM__
))

322 
	#SMALL_MEDIUM


	)

323 #ifdeà
__BORLANDC__


324 
	#FAR
 
_çr


	)

326 
	#FAR
 
çr


	)

331 #ià
defšed
(
WINDOWS
è|| defšed(
WIN32
)

335 #ifdeà
ZLIB_DLL


336 #ià
defšed
(
WIN32
è&& (!defšed(
__BORLANDC__
) || (__BORLANDC__ >= 0x500))

337 #ifdeà
ZLIB_INTERNAL


338 
	#ZEXTERN
 
	`__deþ¥ec
(
dÎexpÜt
)

	)

340 
	#ZEXTERN
 
	`__deþ¥ec
(
dÎimpÜt
)

	)

348 #ifdeà
ZLIB_WINAPI


349 #ifdeà
FAR


350 #undeà
FAR


352 
	~<wšdows.h
>

355 
	#ZEXPORT
 
WINAPI


	)

356 #ifdeà
WIN32


357 
	#ZEXPORTVA
 
WINAPIV


	)

359 
	#ZEXPORTVA
 
FAR
 
CDECL


	)

364 #ià
defšed
 (
__BEOS__
)

365 #ifdeà
ZLIB_DLL


366 #ifdeà
ZLIB_INTERNAL


367 
	#ZEXPORT
 
	`__deþ¥ec
(
dÎexpÜt
)

	)

368 
	#ZEXPORTVA
 
	`__deþ¥ec
(
dÎexpÜt
)

	)

370 
	#ZEXPORT
 
	`__deþ¥ec
(
dÎimpÜt
)

	)

371 
	#ZEXPORTVA
 
	`__deþ¥ec
(
dÎimpÜt
)

	)

376 #iâdeà
ZEXTERN


377 
	#ZEXTERN
 

	)

379 #iâdeà
ZEXPORT


380 
	#ZEXPORT


	)

382 #iâdeà
ZEXPORTVA


383 
	#ZEXPORTVA


	)

386 #iâdeà
FAR


387 
	#FAR


	)

390 #ià!
defšed
(
__MACTYPES__
)

391 
	tBy‹
;

393 
	tuIÁ
;

394 
	tuLÚg
;

396 #ifdeà
SMALL_MEDIUM


398 
	#By‹f
 
By‹
 
FAR


	)

400 
By‹
 
	tFAR
 
	tBy‹f
;

402 
	tFAR
 
	tch¬f
;

403 
	tFAR
 
	tštf
;

404 
uIÁ
 
	tFAR
 
	tuIÁf
;

405 
uLÚg
 
	tFAR
 
	tuLÚgf
;

407 #ifdeà
STDC


408 cÚ¡ *
	tvoidpc
;

409 
	tFAR
 *
	tvoidpf
;

410 *
	tvoidp
;

412 
By‹
 cÚ¡ *
	tvoidpc
;

413 
By‹
 
	tFAR
 *
	tvoidpf
;

414 
By‹
 *
	tvoidp
;

417 #ià!
defšed
(
Z_U4
è&& !defšed(
Z_SOLO
è&& defšed(
STDC
)

418 
	~<lim™s.h
>

419 #ià(
UINT_MAX
 == 0xffffffffUL)

420 
	#Z_U4
 

	)

421 #–ià(
ULONG_MAX
 == 0xffffffffUL)

422 
	#Z_U4
 

	)

423 #–ià(
USHRT_MAX
 == 0xffffffffUL)

424 
	#Z_U4
 

	)

428 #ifdeà
Z_U4


429 
Z_U4
 
	tz_üc_t
;

431 
	tz_üc_t
;

434 #ifdeà
HAVE_UNISTD_H


435 
	#Z_HAVE_UNISTD_H


	)

438 #ifdeà
HAVE_STDARG_H


439 
	#Z_HAVE_STDARG_H


	)

442 #ifdeà
STDC


443 #iâdeà
Z_SOLO


444 
	~<sys/ty³s.h
>

448 #ià
defšed
(
STDC
è|| defšed(
Z_HAVE_STDARG_H
)

449 #iâdeà
Z_SOLO


450 
	~<¡d¬g.h
>

454 #ifdeà
_WIN32


455 #iâdeà
Z_SOLO


456 
	~<¡ddef.h
>

466 #ià
defšed
(
_LARGEFILE64_SOURCE
) && -_LARGEFILE64_SOURCE - -1 == 1

467 #undeà
_LARGEFILE64_SOURCE


470 #ià
defšed
(
__WATCOMC__
è&& !defšed(
Z_HAVE_UNISTD_H
)

471 
	#Z_HAVE_UNISTD_H


	)

473 #iâdeà
Z_SOLO


474 #ià
defšed
(
Z_HAVE_UNISTD_H
è|| defšed(
_LARGEFILE64_SOURCE
)

475 
	~<uni¡d.h
>

476 #ifdeà
VMS


477 
	~<unixio.h
>

479 #iâdeà
z_off_t


480 
	#z_off_t
 
off_t


	)

485 #ià
defšed
(
_LFS64_LARGEFILE
) && _LFS64_LARGEFILE-0

486 
	#Z_LFS64


	)

489 #ià
defšed
(
_LARGEFILE64_SOURCE
è&& defšed(
Z_LFS64
)

490 
	#Z_LARGE64


	)

493 #ià
defšed
(
_FILE_OFFSET_BITS
è&& _FILE_OFFSET_BITS-0 =ð64 && defšed(
Z_LFS64
)

494 
	#Z_WANT64


	)

497 #ià!
defšed
(
SEEK_SET
è&& !defšed(
Z_SOLO
)

498 
	#SEEK_SET
 0

	)

499 
	#SEEK_CUR
 1

	)

500 
	#SEEK_END
 2

	)

503 #iâdeà
z_off_t


504 
	#z_off_t
 

	)

507 #ià!
defšed
(
_WIN32
è&& defšed(
Z_LARGE64
)

508 
	#z_off64_t
 
off64_t


	)

510 #ià
defšed
(
_WIN32
è&& !defšed(
__GNUC__
è&& !defšed(
Z_SOLO
)

511 
	#z_off64_t
 
__št64


	)

513 
	#z_off64_t
 
z_off_t


	)

518 #ià
defšed
(
__MVS__
)

519 #´agm¨
m­
(
deæ©eIn™_
,"DEIN")

520 #´agm¨
m­
(
deæ©eIn™2_
,"DEIN2")

521 #´agm¨
m­
(
deæ©eEnd
,"DEEND")

522 #´agm¨
m­
(
deæ©eBound
,"DEBND")

523 #´agm¨
m­
(
šæ©eIn™_
,"ININ")

524 #´agm¨
m­
(
šæ©eIn™2_
,"ININ2")

525 #´agm¨
m­
(
šæ©eEnd
,"INEND")

526 #´agm¨
m­
(
šæ©eSync
,"INSY")

527 #´agm¨
m­
(
šæ©eS‘DiùiÚ¬y
,"INSEDI")

528 #´agm¨
m­
(
com´essBound
,"CMBND")

529 #´agm¨
m­
(
šæ©e_bË
,"INTABL")

530 #´agm¨
m­
(
šæ©e_ç¡
,"INFA")

531 #´agm¨
m­
(
šæ©e_cÝyright
,"INCOPY")

	@zlib/zlib.h

31 #iâdeà
ZLIB_H


32 
	#ZLIB_H


	)

34 
	~"zcÚf.h
"

36 #ifdeà
__ýlu¥lus


40 
	#ZLIB_VERSION
 "1.2.11"

	)

41 
	#ZLIB_VERNUM
 0x12b0

	)

42 
	#ZLIB_VER_MAJOR
 1

	)

43 
	#ZLIB_VER_MINOR
 2

	)

44 
	#ZLIB_VER_REVISION
 11

	)

45 
	#ZLIB_VER_SUBREVISION
 0

	)

81 
voidpf
 (*
	t®loc_func
è
	tOF
((
	tvoidpf
 
	tÝaque
, 
	tuIÁ
 
	t™ems
, uIÁ 
	tsize
));

82 (*
ä“_func
è
	tOF
((
	tvoidpf
 
	tÝaque
, voidpà
	tadd»ss
));

84 
š‹º®_¡©e
;

86 
	sz_¡»am_s
 {

87 
z_cÚ¡
 
By‹f
 *
Ãxt_š
;

88 
uIÁ
 
avaž_š
;

89 
uLÚg
 
tÙ®_š
;

91 
By‹f
 *
Ãxt_out
;

92 
uIÁ
 
avaž_out
;

93 
uLÚg
 
tÙ®_out
;

95 
z_cÚ¡
 *
msg
;

96 
š‹º®_¡©e
 
FAR
 *
¡©e
;

98 
®loc_func
 
z®loc
;

99 
ä“_func
 
zä“
;

100 
voidpf
 
Ýaque
;

102 
d©a_ty³
;

104 
uLÚg
 
adËr
;

105 
uLÚg
 
»£rved
;

106 } 
	tz_¡»am
;

108 
z_¡»am
 
	tFAR
 *
	tz_¡»amp
;

114 
	sgz_h—d”_s
 {

115 
‹xt
;

116 
uLÚg
 
time
;

117 
xæags
;

118 
os
;

119 
By‹f
 *
exŒa
;

120 
uIÁ
 
exŒa_Ën
;

121 
uIÁ
 
exŒa_max
;

122 
By‹f
 *
Çme
;

123 
uIÁ
 
Çme_max
;

124 
By‹f
 *
comm’t
;

125 
uIÁ
 
comm_max
;

126 
hüc
;

127 
dÚe
;

129 } 
	tgz_h—d”
;

131 
gz_h—d”
 
	tFAR
 *
	tgz_h—d”p
;

168 
	#Z_NO_FLUSH
 0

	)

169 
	#Z_PARTIAL_FLUSH
 1

	)

170 
	#Z_SYNC_FLUSH
 2

	)

171 
	#Z_FULL_FLUSH
 3

	)

172 
	#Z_FINISH
 4

	)

173 
	#Z_BLOCK
 5

	)

174 
	#Z_TREES
 6

	)

177 
	#Z_OK
 0

	)

178 
	#Z_STREAM_END
 1

	)

179 
	#Z_NEED_DICT
 2

	)

180 
	#Z_ERRNO
 (-1)

	)

181 
	#Z_STREAM_ERROR
 (-2)

	)

182 
	#Z_DATA_ERROR
 (-3)

	)

183 
	#Z_MEM_ERROR
 (-4)

	)

184 
	#Z_BUF_ERROR
 (-5)

	)

185 
	#Z_VERSION_ERROR
 (-6)

	)

190 
	#Z_NO_COMPRESSION
 0

	)

191 
	#Z_BEST_SPEED
 1

	)

192 
	#Z_BEST_COMPRESSION
 9

	)

193 
	#Z_DEFAULT_COMPRESSION
 (-1)

	)

196 
	#Z_FILTERED
 1

	)

197 
	#Z_HUFFMAN_ONLY
 2

	)

198 
	#Z_RLE
 3

	)

199 
	#Z_FIXED
 4

	)

200 
	#Z_DEFAULT_STRATEGY
 0

	)

203 
	#Z_BINARY
 0

	)

204 
	#Z_TEXT
 1

	)

205 
	#Z_ASCII
 
Z_TEXT


	)

206 
	#Z_UNKNOWN
 2

	)

209 
	#Z_DEFLATED
 8

	)

212 
	#Z_NULL
 0

	)

214 
	#zlib_v”siÚ
 
	`zlibV”siÚ
()

	)

220 
ZEXTERN
 cÚ¡ * 
ZEXPORT
 
zlibV”siÚ
 
OF
(());

250 
ZEXTERN
 
ZEXPORT
 
deæ©e
 
OF
((
z_¡»amp
 
¡rm
, 
æush
));

363 
ZEXTERN
 
ZEXPORT
 
deæ©eEnd
 
OF
((
z_¡»amp
 
¡rm
));

400 
ZEXTERN
 
ZEXPORT
 
šæ©e
 
OF
((
z_¡»amp
 
¡rm
, 
æush
));

520 
ZEXTERN
 
ZEXPORT
 
šæ©eEnd
 
OF
((
z_¡»amp
 
¡rm
));

611 
ZEXTERN
 
ZEXPORT
 
deæ©eS‘DiùiÚ¬y
 
OF
((
z_¡»amp
 
¡rm
,

612 cÚ¡ 
By‹f
 *
diùiÚ¬y
,

613 
uIÁ
 
diùL’gth
));

655 
ZEXTERN
 
ZEXPORT
 
deæ©eG‘DiùiÚ¬y
 
OF
((
z_¡»amp
 
¡rm
,

656 
By‹f
 *
diùiÚ¬y
,

657 
uIÁ
 *
diùL’gth
));

677 
ZEXTERN
 
ZEXPORT
 
deæ©eCÝy
 
OF
((
z_¡»amp
 
de¡
,

678 
z_¡»amp
 
sourû
));

695 
ZEXTERN
 
ZEXPORT
 
deæ©eRe£t
 
OF
((
z_¡»amp
 
¡rm
));

706 
ZEXTERN
 
ZEXPORT
 
deæ©eP¬ams
 
OF
((
z_¡»amp
 
¡rm
,

707 
Ëv–
,

708 
¡¿‹gy
));

743 
ZEXTERN
 
ZEXPORT
 
deæ©eTuÃ
 
OF
((
z_¡»amp
 
¡rm
,

744 
good_Ëngth
,

745 
max_Ïzy
,

746 
niû_Ëngth
,

747 
max_chaš
));

760 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
deæ©eBound
 
OF
((
z_¡»amp
 
¡rm
,

761 
uLÚg
 
sourûL’
));

775 
ZEXTERN
 
ZEXPORT
 
deæ©eP’dšg
 
OF
((
z_¡»amp
 
¡rm
,

776 *
³ndšg
,

777 *
b™s
));

790 
ZEXTERN
 
ZEXPORT
 
deæ©ePrime
 
OF
((
z_¡»amp
 
¡rm
,

791 
b™s
,

792 
v®ue
));

807 
ZEXTERN
 
ZEXPORT
 
deæ©eS‘H—d”
 
OF
((
z_¡»amp
 
¡rm
,

808 
gz_h—d”p
 
h—d
));

884 
ZEXTERN
 
ZEXPORT
 
šæ©eS‘DiùiÚ¬y
 
OF
((
z_¡»amp
 
¡rm
,

885 cÚ¡ 
By‹f
 *
diùiÚ¬y
,

886 
uIÁ
 
diùL’gth
));

907 
ZEXTERN
 
ZEXPORT
 
šæ©eG‘DiùiÚ¬y
 
OF
((
z_¡»amp
 
¡rm
,

908 
By‹f
 *
diùiÚ¬y
,

909 
uIÁ
 *
diùL’gth
));

922 
ZEXTERN
 
ZEXPORT
 
šæ©eSync
 
OF
((
z_¡»amp
 
¡rm
));

941 
ZEXTERN
 
ZEXPORT
 
šæ©eCÝy
 
OF
((
z_¡»amp
 
de¡
,

942 
z_¡»amp
 
sourû
));

957 
ZEXTERN
 
ZEXPORT
 
šæ©eRe£t
 
OF
((
z_¡»amp
 
¡rm
));

967 
ZEXTERN
 
ZEXPORT
 
šæ©eRe£t2
 
OF
((
z_¡»amp
 
¡rm
,

968 
wšdowB™s
));

981 
ZEXTERN
 
ZEXPORT
 
šæ©ePrime
 
OF
((
z_¡»amp
 
¡rm
,

982 
b™s
,

983 
v®ue
));

1002 
ZEXTERN
 
ZEXPORT
 
šæ©eM¬k
 
OF
((
z_¡»amp
 
¡rm
));

1030 
ZEXTERN
 
ZEXPORT
 
šæ©eG‘H—d”
 
OF
((
z_¡»amp
 
¡rm
,

1031 
gz_h—d”p
 
h—d
));

1092 (*
š_func
è
	tOF
((
	tFAR
 *,

1093 
	tz_cÚ¡
 
	tFAR
 * FAR *));

1094 (*
out_func
è
	tOF
((
	tFAR
 *, FAR *, ));

1096 
ZEXTERN
 
ZEXPORT
 
šæ©eBack
 
OF
((
z_¡»amp
 
¡rm
,

1097 
š_func
 
š
, 
FAR
 *
š_desc
,

1098 
out_func
 
out
, 
FAR
 *
out_desc
));

1166 
ZEXTERN
 
ZEXPORT
 
šæ©eBackEnd
 
OF
((
z_¡»amp
 
¡rm
));

1174 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
zlibCompžeFÏgs
 
OF
(());

1215 #iâdeà
Z_SOLO


1227 
ZEXTERN
 
ZEXPORT
 
com´ess
 
OF
((
By‹f
 *
de¡
, 
uLÚgf
 *
de¡L’
,

1228 cÚ¡ 
By‹f
 *
sourû
, 
uLÚg
 
sourûL’
));

1242 
ZEXTERN
 
ZEXPORT
 
com´ess2
 
OF
((
By‹f
 *
de¡
, 
uLÚgf
 *
de¡L’
,

1243 cÚ¡ 
By‹f
 *
sourû
, 
uLÚg
 
sourûL’
,

1244 
Ëv–
));

1258 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
com´essBound
 
OF
((uLÚg 
sourûL’
));

1265 
ZEXTERN
 
ZEXPORT
 
uncom´ess
 
OF
((
By‹f
 *
de¡
, 
uLÚgf
 *
de¡L’
,

1266 cÚ¡ 
By‹f
 *
sourû
, 
uLÚg
 
sourûL’
));

1283 
ZEXTERN
 
ZEXPORT
 
uncom´ess2
 
OF
((
By‹f
 *
de¡
, 
uLÚgf
 *
de¡L’
,

1284 cÚ¡ 
By‹f
 *
sourû
, 
uLÚg
 *
sourûL’
));

1300 
gzFže_s
 *
	tgzFže
;

1340 
ZEXTERN
 
gzFže
 
ZEXPORT
 
gzdÝ’
 
OF
((
fd
, cÚ¡ *
mode
));

1363 
ZEXTERN
 
ZEXPORT
 
gzbufãr
 
OF
((
gzFže
 
fže
, 
size
));

1379 
ZEXTERN
 
ZEXPORT
 
gz£¬ams
 
OF
((
gzFže
 
fže
, 
Ëv–
, 
¡¿‹gy
));

1390 
ZEXTERN
 
ZEXPORT
 
gz»ad
 
OF
((
gzFže
 
fže
, 
voidp
 
buf
, 
Ën
));

1420 
ZEXTERN
 
z_size_t
 
ZEXPORT
 
gzä—d
 
OF
((
voidp
 
buf
, z_size_ˆ
size
, z_size_ˆ
n™ems
,

1421 
gzFže
 
fže
));

1446 
ZEXTERN
 
ZEXPORT
 
gzwr™e
 
OF
((
gzFže
 
fže
,

1447 
voidpc
 
buf
, 
Ën
));

1454 
ZEXTERN
 
z_size_t
 
ZEXPORT
 
gzfwr™e
 
OF
((
voidpc
 
buf
, z_size_ˆ
size
,

1455 
z_size_t
 
n™ems
, 
gzFže
 
fže
));

1468 
ZEXTERN
 
ZEXPORTVA
 
gz´štf
 
Z_ARG
((
gzFže
 
fže
, cÚ¡ *
fÜm©
, ...));

1483 
ZEXTERN
 
ZEXPORT
 
gzputs
 
OF
((
gzFže
 
fže
, cÚ¡ *
s
));

1491 
ZEXTERN
 * 
ZEXPORT
 
gzg‘s
 
OF
((
gzFže
 
fže
, *
buf
, 
Ën
));

1504 
ZEXTERN
 
ZEXPORT
 
gzputc
 
OF
((
gzFže
 
fže
, 
c
));

1510 
ZEXTERN
 
ZEXPORT
 
gzg‘c
 
OF
((
gzFže
 
fže
));

1519 
ZEXTERN
 
ZEXPORT
 
gzung‘c
 
OF
((
c
, 
gzFže
 
fže
));

1531 
ZEXTERN
 
ZEXPORT
 
gzæush
 
OF
((
gzFže
 
fže
, 
æush
));

1566 
ZEXTERN
 
ZEXPORT
 
gz»wšd
 
OF
((
gzFže
 
fže
));

1594 
ZEXTERN
 
ZEXPORT
 
gzeof
 
OF
((
gzFže
 
fže
));

1609 
ZEXTERN
 
ZEXPORT
 
gzdœeù
 
OF
((
gzFže
 
fže
));

1630 
ZEXTERN
 
ZEXPORT
 
gzþo£
 
OF
((
gzFže
 
fže
));

1643 
ZEXTERN
 
ZEXPORT
 
gzþo£_r
 
OF
((
gzFže
 
fže
));

1644 
ZEXTERN
 
ZEXPORT
 
gzþo£_w
 
OF
((
gzFže
 
fže
));

1655 
ZEXTERN
 cÚ¡ * 
ZEXPORT
 
gz”rÜ
 
OF
((
gzFže
 
fže
, *
”ºum
));

1671 
ZEXTERN
 
ZEXPORT
 
gzþ—»¼
 
OF
((
gzFže
 
fže
));

1688 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
adËr32
 
OF
((uLÚg 
adËr
, cÚ¡ 
By‹f
 *
buf
, 
uIÁ
 
Ën
));

1707 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
adËr32_z
 
OF
((uLÚg 
adËr
, cÚ¡ 
By‹f
 *
buf
,

1708 
z_size_t
 
Ën
));

1725 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
üc32
 
OF
((uLÚg 
üc
, cÚ¡ 
By‹f
 *
buf
, 
uIÁ
 
Ën
));

1742 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
üc32_z
 
OF
((uLÚg 
adËr
, cÚ¡ 
By‹f
 *
buf
,

1743 
z_size_t
 
Ën
));

1764 
ZEXTERN
 
ZEXPORT
 
deæ©eIn™_
 
OF
((
z_¡»amp
 
¡rm
, 
Ëv–
,

1765 cÚ¡ *
v”siÚ
, 
¡»am_size
));

1766 
ZEXTERN
 
ZEXPORT
 
šæ©eIn™_
 
OF
((
z_¡»amp
 
¡rm
,

1767 cÚ¡ *
v”siÚ
, 
¡»am_size
));

1768 
ZEXTERN
 
ZEXPORT
 
deæ©eIn™2_
 
OF
((
z_¡»amp
 
¡rm
, 
Ëv–
, 
m‘hod
,

1769 
wšdowB™s
, 
memLev–
,

1770 
¡¿‹gy
, cÚ¡ *
v”siÚ
,

1771 
¡»am_size
));

1772 
ZEXTERN
 
ZEXPORT
 
šæ©eIn™2_
 
OF
((
z_¡»amp
 
¡rm
, 
wšdowB™s
,

1773 cÚ¡ *
v”siÚ
, 
¡»am_size
));

1774 
ZEXTERN
 
ZEXPORT
 
šæ©eBackIn™_
 
OF
((
z_¡»amp
 
¡rm
, 
wšdowB™s
,

1775 
FAR
 *
wšdow
,

1776 cÚ¡ *
v”siÚ
,

1777 
¡»am_size
));

1778 #ifdeà
Z_PREFIX_SET


1779 
	#z_deæ©eIn™
(
¡rm
, 
Ëv–
) \

1780 
	`deæ©eIn™_
((
¡rm
), (
Ëv–
), 
ZLIB_VERSION
, ()(
z_¡»am
))

	)

1781 
	#z_šæ©eIn™
(
¡rm
) \

1782 
	`šæ©eIn™_
((
¡rm
), 
ZLIB_VERSION
, ()(
z_¡»am
))

	)

1783 
	#z_deæ©eIn™2
(
¡rm
, 
Ëv–
, 
m‘hod
, 
wšdowB™s
, 
memLev–
, 
¡¿‹gy
) \

1784 
	`deæ©eIn™2_
((
¡rm
),(
Ëv–
),(
m‘hod
),(
wšdowB™s
),(
memLev–
),\

1785 (
¡¿‹gy
), 
ZLIB_VERSION
, ()(
z_¡»am
))

	)

1786 
	#z_šæ©eIn™2
(
¡rm
, 
wšdowB™s
) \

1787 
	`šæ©eIn™2_
((
¡rm
), (
wšdowB™s
), 
ZLIB_VERSION
, \

1788 ()(
z_¡»am
))

	)

1789 
	#z_šæ©eBackIn™
(
¡rm
, 
wšdowB™s
, 
wšdow
) \

1790 
	`šæ©eBackIn™_
((
¡rm
), (
wšdowB™s
), (
wšdow
), \

1791 
ZLIB_VERSION
, ()(
z_¡»am
))

	)

1793 
	#deæ©eIn™
(
¡rm
, 
Ëv–
) \

1794 
	`deæ©eIn™_
((
¡rm
), (
Ëv–
), 
ZLIB_VERSION
, ()(
z_¡»am
))

	)

1795 
	#šæ©eIn™
(
¡rm
) \

1796 
	`šæ©eIn™_
((
¡rm
), 
ZLIB_VERSION
, ()(
z_¡»am
))

	)

1797 
	#deæ©eIn™2
(
¡rm
, 
Ëv–
, 
m‘hod
, 
wšdowB™s
, 
memLev–
, 
¡¿‹gy
) \

1798 
	`deæ©eIn™2_
((
¡rm
),(
Ëv–
),(
m‘hod
),(
wšdowB™s
),(
memLev–
),\

1799 (
¡¿‹gy
), 
ZLIB_VERSION
, ()(
z_¡»am
))

	)

1800 
	#šæ©eIn™2
(
¡rm
, 
wšdowB™s
) \

1801 
	`šæ©eIn™2_
((
¡rm
), (
wšdowB™s
), 
ZLIB_VERSION
, \

1802 ()(
z_¡»am
))

	)

1803 
	#šæ©eBackIn™
(
¡rm
, 
wšdowB™s
, 
wšdow
) \

1804 
	`šæ©eBackIn™_
((
¡rm
), (
wšdowB™s
), (
wšdow
), \

1805 
ZLIB_VERSION
, ()(
z_¡»am
))

	)

1808 #iâdeà
Z_SOLO


1817 
	sgzFže_s
 {

1818 
have
;

1819 *
Ãxt
;

1820 
z_off64_t
 
pos
;

1822 
ZEXTERN
 
ZEXPORT
 
gzg‘c_
 
OF
((
gzFže
 
fže
));

1823 #ifdeà
Z_PREFIX_SET


1824 #undeà
z_gzg‘c


1825 
	#z_gzg‘c
(
g
) \

1826 ((
g
)->
have
 ? ((g)->have--, (g)->
pos
++, *((g)->
Ãxt
)++è: (
gzg‘c
)(g))

	)

1828 
	#gzg‘c
(
g
) \

1829 ((
g
)->
have
 ? ((g)->have--, (g)->
pos
++, *((g)->
Ãxt
)++è: (
gzg‘c
)(g))

	)

1838 #ifdeà
Z_LARGE64


1839 
ZEXTERN
 
gzFže
 
ZEXPORT
 
gzÝ’64
 
OF
((const *, const *));

1840 
ZEXTERN
 
z_off64_t
 
ZEXPORT
 
gz£ek64
 
OF
((
gzFže
, z_off64_t, ));

1841 
ZEXTERN
 
z_off64_t
 
ZEXPORT
 
gz‹Î64
 
OF
((
gzFže
));

1842 
ZEXTERN
 
z_off64_t
 
ZEXPORT
 
gzoff£t64
 
OF
((
gzFže
));

1843 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
adËr32_combše64
 
OF
((uLÚg, uLÚg, 
z_off64_t
));

1844 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
üc32_combše64
 
OF
((uLÚg, uLÚg, 
z_off64_t
));

1847 #ià!
defšed
(
ZLIB_INTERNAL
è&& defšed(
Z_WANT64
)

1848 #ifdeà
Z_PREFIX_SET


1849 
	#z_gzÝ’
 
z_gzÝ’64


	)

1850 
	#z_gz£ek
 
z_gz£ek64


	)

1851 
	#z_gz‹Î
 
z_gz‹Î64


	)

1852 
	#z_gzoff£t
 
z_gzoff£t64


	)

1853 
	#z_adËr32_combše
 
z_adËr32_combše64


	)

1854 
	#z_üc32_combše
 
z_üc32_combše64


	)

1856 
	#gzÝ’
 
gzÝ’64


	)

1857 
	#gz£ek
 
gz£ek64


	)

1858 
	#gz‹Î
 
gz‹Î64


	)

1859 
	#gzoff£t
 
gzoff£t64


	)

1860 
	#adËr32_combše
 
adËr32_combše64


	)

1861 
	#üc32_combše
 
üc32_combše64


	)

1863 #iâdeà
Z_LARGE64


1864 
ZEXTERN
 
gzFže
 
ZEXPORT
 
gzÝ’64
 
OF
((const *, const *));

1865 
ZEXTERN
 
z_off_t
 
ZEXPORT
 
gz£ek64
 
OF
((
gzFže
, z_off_t, ));

1866 
ZEXTERN
 
z_off_t
 
ZEXPORT
 
gz‹Î64
 
OF
((
gzFže
));

1867 
ZEXTERN
 
z_off_t
 
ZEXPORT
 
gzoff£t64
 
OF
((
gzFže
));

1868 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
adËr32_combše64
 
OF
((uLÚg, uLÚg, 
z_off_t
));

1869 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
üc32_combše64
 
OF
((uLÚg, uLÚg, 
z_off_t
));

1872 
ZEXTERN
 
gzFže
 
ZEXPORT
 
gzÝ’
 
OF
((const *, const *));

1873 
ZEXTERN
 
z_off_t
 
ZEXPORT
 
gz£ek
 
OF
((
gzFže
, z_off_t, ));

1874 
ZEXTERN
 
z_off_t
 
ZEXPORT
 
gz‹Î
 
OF
((
gzFže
));

1875 
ZEXTERN
 
z_off_t
 
ZEXPORT
 
gzoff£t
 
OF
((
gzFže
));

1876 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
adËr32_combše
 
OF
((uLÚg, uLÚg, 
z_off_t
));

1877 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
üc32_combše
 
OF
((uLÚg, uLÚg, 
z_off_t
));

1882 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
adËr32_combše
 
OF
((uLÚg, uLÚg, 
z_off_t
));

1883 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
üc32_combše
 
OF
((uLÚg, uLÚg, 
z_off_t
));

1888 
ZEXTERN
 cÚ¡ * 
ZEXPORT
 
zE¼Ü
 
OF
(());

1889 
ZEXTERN
 
ZEXPORT
 
šæ©eSyncPošt
 
OF
((
z_¡»amp
));

1890 
ZEXTERN
 cÚ¡ 
z_üc_t
 
FAR
 * 
ZEXPORT
 
g‘_üc_bË
 
OF
(());

1891 
ZEXTERN
 
ZEXPORT
 
šæ©eUnd”mše
 
OF
((
z_¡»amp
, ));

1892 
ZEXTERN
 
ZEXPORT
 
šæ©eV®id©e
 
OF
((
z_¡»amp
, ));

1893 
ZEXTERN
 
ZEXPORT
 
šæ©eCodesU£d
 
OF
 ((
z_¡»amp
));

1894 
ZEXTERN
 
ZEXPORT
 
šæ©eRe£tK“p
 
OF
((
z_¡»amp
));

1895 
ZEXTERN
 
ZEXPORT
 
deæ©eRe£tK“p
 
OF
((
z_¡»amp
));

1896 #ià(
defšed
(
_WIN32
è|| defšed(
__CYGWIN__
)è&& !defšed(
Z_SOLO
)

1897 
ZEXTERN
 
gzFže
 
ZEXPORT
 
gzÝ’_w
 
OF
((cÚ¡ 
wch¬_t
 *
·th
,

1898 cÚ¡ *
mode
));

1900 #ià
defšed
(
STDC
è|| defšed(
Z_HAVE_STDARG_H
)

1901 #iâdeà
Z_SOLO


1902 
ZEXTERN
 
ZEXPORTVA
 
gzv´štf
 
Z_ARG
((
gzFže
 
fže
,

1903 cÚ¡ *
fÜm©
,

1904 
va_li¡
 
va
));

1908 #ifdeà
__ýlu¥lus


	@zlib/zutil.c

8 
	~"zutž.h
"

9 #iâdeà
Z_SOLO


10 
	~"gzguts.h
"

13 
z_cÚ¡
 * cÚ¡ 
	gz_”rmsg
[10] = {

14 (
z_cÚ¡
 *)"need dictionary",

15 (
z_cÚ¡
 *)"streamƒnd",

16 (
z_cÚ¡
 *)"",

17 (
z_cÚ¡
 *)"fileƒrror",

18 (
z_cÚ¡
 *)"streamƒrror",

19 (
z_cÚ¡
 *)"dataƒrror",

20 (
z_cÚ¡
 *)"insufficient memory",

21 (
z_cÚ¡
 *)"bufferƒrror",

22 (
z_cÚ¡
 *)"incompatible version",

23 (
z_cÚ¡
 *)""

27 cÚ¡ * 
ZEXPORT
 
	$zlibV”siÚ
()

29  
ZLIB_VERSION
;

30 
	}
}

32 
uLÚg
 
ZEXPORT
 
	$zlibCompžeFÏgs
()

34 
uLÚg
 
æags
;

36 
æags
 = 0;

37 ()((
uIÁ
))) {

39 4: 
æags
 += 1; ;

40 8: 
æags
 += 2; ;

41 : 
æags
 += 3;

43 ()((
uLÚg
))) {

45 4: 
æags
 += 1 << 2; ;

46 8: 
æags
 += 2 << 2; ;

47 : 
æags
 += 3 << 2;

49 ()((
voidpf
))) {

51 4: 
æags
 += 1 << 4; ;

52 8: 
æags
 += 2 << 4; ;

53 : 
æags
 += 3 << 4;

55 ()((
z_off_t
))) {

57 4: 
æags
 += 1 << 6; ;

58 8: 
æags
 += 2 << 6; ;

59 : 
æags
 += 3 << 6;

61 #ifdeà
ZLIB_DEBUG


62 
æags
 += 1 << 8;

64 #ià
	`defšed
(
ASMV
è|| defšed(
ASMINF
)

65 
æags
 += 1 << 9;

67 #ifdeà
ZLIB_WINAPI


68 
æags
 += 1 << 10;

70 #ifdeà
BUILDFIXED


71 
æags
 += 1 << 12;

73 #ifdeà
DYNAMIC_CRC_TABLE


74 
æags
 += 1 << 13;

76 #ifdeà
NO_GZCOMPRESS


77 
æags
 += 1L << 16;

79 #ifdeà
NO_GZIP


80 
æags
 += 1L << 17;

82 #ifdeà
PKZIP_BUG_WORKAROUND


83 
æags
 += 1L << 20;

85 #ifdeà
FASTEST


86 
æags
 += 1L << 21;

88 #ià
	`defšed
(
STDC
è|| defšed(
Z_HAVE_STDARG_H
)

89 #ifdeà
NO_v¢´štf


90 
æags
 += 1L << 25;

91 #ifdeà
HAS_v¥rštf_void


92 
æags
 += 1L << 26;

95 #ifdeà
HAS_v¢´štf_void


96 
æags
 += 1L << 26;

100 
æags
 += 1L << 24;

101 #ifdeà
NO_¢´štf


102 
æags
 += 1L << 25;

103 #ifdeà
HAS_¥rštf_void


104 
æags
 += 1L << 26;

107 #ifdeà
HAS_¢´štf_void


108 
æags
 += 1L << 26;

112  
æags
;

113 
	}
}

115 #ifdeà
ZLIB_DEBUG


116 
	~<¡dlib.h
>

117 #iâdeà
v”bo£


118 
	#v”bo£
 0

	)

120 
ZLIB_INTERNAL
 
	gz_v”bo£
 = 
v”bo£
;

122 
ZLIB_INTERNAL
 
	$z_”rÜ
 (
m
)

123 *
m
;

125 
	`årštf
(
¡d”r
, "%s\n", 
m
);

126 
	`ex™
(1);

127 
	}
}

133 cÚ¡ * 
ZEXPORT
 
	$zE¼Ü
(
”r
)

134 
”r
;

136  
	`ERR_MSG
(
”r
);

137 
	}
}

139 #ià
defšed
(
_WIN32_WCE
)

144 
	g”ºo
 = 0;

147 #iâdeà
HAVE_MEMCPY


149 
ZLIB_INTERNAL
 
	$zmemýy
(
de¡
, 
sourû
, 
Ën
)

150 
By‹f
* 
de¡
;

151 cÚ¡ 
By‹f
* 
sourû
;

152 
uIÁ
 
Ën
;

154 ià(
Ën
 == 0) ;

156 *
de¡
++ = *
sourû
++;

157 } --
Ën
 != 0);

158 
	}
}

160 
ZLIB_INTERNAL
 
	$zmemcmp
(
s1
, 
s2
, 
Ën
)

161 cÚ¡ 
By‹f
* 
s1
;

162 cÚ¡ 
By‹f
* 
s2
;

163 
uIÁ
 
Ën
;

165 
uIÁ
 
j
;

167 
j
 = 0; j < 
Ën
; j++) {

168 ià(
s1
[
j
] !ð
s2
[j])  2*(s1[j] > s2[j])-1;

171 
	}
}

173 
ZLIB_INTERNAL
 
	$zmemz”o
(
de¡
, 
Ën
)

174 
By‹f
* 
de¡
;

175 
uIÁ
 
Ën
;

177 ià(
Ën
 == 0) ;

179 *
de¡
++ = 0;

180 } --
Ën
 != 0);

181 
	}
}

184 #iâdeà
Z_SOLO


186 #ifdeà
SYS16BIT


188 #ifdeà
__TURBOC__


191 
	#MY_ZCALLOC


	)

199 
	#MAX_PTR
 10

	)

202 
loÿl
 
	gÃxt_±r
 = 0;

204 
	s±r_bË_s
 {

205 
voidpf
 
	mÜg_±r
;

206 
voidpf
 
	mÃw_±r
;

207 } 
	t±r_bË
;

209 
loÿl
 
±r_bË
 
	gbË
[
MAX_PTR
];

217 
voidpf
 
ZLIB_INTERNAL
 
	$zÿÎoc
 (
voidpf
 
Ýaque
, 
™ems
, 
size
)

219 
voidpf
 
buf
;

220 
ulg
 
bsize
 = (ulg)
™ems
*
size
;

222 ()
Ýaque
;

227 ià(
bsize
 < 65520L) {

228 
buf
 = 
	`çrm®loc
(
bsize
);

229 ià(*(
ush
*)&
buf
 != 0)  buf;

231 
buf
 = 
	`çrm®loc
(
bsize
 + 16L);

233 ià(
buf
 =ð
NULL
 || 
Ãxt_±r
 >ð
MAX_PTR
)  NULL;

234 
bË
[
Ãxt_±r
].
Üg_±r
 = 
buf
;

237 *((
ush
*)&
buf
+1è+ð((ush)((
uch
*)buf-0) + 15) >> 4;

238 *(
ush
*)&
buf
 = 0;

239 
bË
[
Ãxt_±r
++].
Ãw_±r
 = 
buf
;

240  
buf
;

241 
	}
}

243 
ZLIB_INTERNAL
 
	$zcä“
 (
voidpf
 
Ýaque
, voidpà
±r
)

245 
n
;

247 ()
Ýaque
;

249 ià(*(
ush
*)&
±r
 != 0) {

250 
	`çrä“
(
±r
);

254 
n
 = 0;‚ < 
Ãxt_±r
;‚++) {

255 ià(
±r
 !ð
bË
[
n
].
Ãw_±r
) ;

257 
	`çrä“
(
bË
[
n
].
Üg_±r
);

258 ++
n
 < 
Ãxt_±r
) {

259 
bË
[
n
-1] =able[n];

261 
Ãxt_±r
--;

264 
	`As£¹
(0, "zcfree:…tr‚ot found");

265 
	}
}

270 #ifdeà
M_I86


273 
	#MY_ZCALLOC


	)

275 #ià(!
defšed
(
_MSC_VER
) || (_MSC_VER <= 600))

276 
	#_h®loc
 
h®loc


	)

277 
	#_hä“
 
hä“


	)

280 
voidpf
 
ZLIB_INTERNAL
 
	$zÿÎoc
 (
voidpf
 
Ýaque
, 
uIÁ
 
™ems
, uIÁ 
size
)

282 ()
Ýaque
;

283  
	`_h®loc
(()
™ems
, 
size
);

284 
	}
}

286 
ZLIB_INTERNAL
 
	$zcä“
 (
voidpf
 
Ýaque
, voidpà
±r
)

288 ()
Ýaque
;

289 
	`_hä“
(
±r
);

290 
	}
}

297 #iâdeà
MY_ZCALLOC


299 #iâdeà
STDC


300 
voidp
 
m®loc
 
OF
((
uIÁ
 
size
));

301 
voidp
 
ÿÎoc
 
OF
((
uIÁ
 
™ems
, uIÁ 
size
));

302 
ä“
 
OF
((
voidpf
 
±r
));

305 
voidpf
 
ZLIB_INTERNAL
 
	$zÿÎoc
 (
Ýaque
, 
™ems
, 
size
)

306 
voidpf
 
Ýaque
;

307 
™ems
;

308 
size
;

310 ()
Ýaque
;

311  (
uIÁ
è> 2 ? (
voidpf
)
	`m®loc
(
™ems
 * 
size
) :

312 (
voidpf
)
	`ÿÎoc
(
™ems
, 
size
);

313 
	}
}

315 
ZLIB_INTERNAL
 
	$zcä“
 (
Ýaque
, 
±r
)

316 
voidpf
 
Ýaque
;

317 
voidpf
 
±r
;

319 ()
Ýaque
;

320 
	`ä“
(
±r
);

321 
	}
}

	@zlib/zutil.h

13 #iâdeà
ZUTIL_H


14 
	#ZUTIL_H


	)

16 #ifdeà
HAVE_HIDDEN


17 
	#ZLIB_INTERNAL
 
	`__©Œibu‹__
((
	`visibž™y
 ("hidd’")))

	)

19 
	#ZLIB_INTERNAL


	)

22 
	~"zlib.h
"

24 #ià
defšed
(
STDC
è&& !defšed(
Z_SOLO
)

25 #ià!(
defšed
(
_WIN32_WCE
è&& defšed(
_MSC_VER
))

26 
	~<¡ddef.h
>

28 
	~<¡ršg.h
>

29 
	~<¡dlib.h
>

32 #ifdeà
Z_SOLO


33 
	t±rdiff_t
;

36 #iâdeà
loÿl


37 
	#loÿl
 

	)

43 
	tuch
;

44 
uch
 
	tFAR
 
	tuchf
;

45 
	tush
;

46 
ush
 
	tFAR
 
	tushf
;

47 
	tulg
;

49 
z_cÚ¡
 * cÚ¡ 
z_”rmsg
[10];

52 
	#ERR_MSG
(
”r
è
z_”rmsg
[
Z_NEED_DICT
-Ó¼)]

	)

54 
	#ERR_RETURN
(
¡rm
,
”r
) \

55  (
¡rm
->
msg
 = 
	`ERR_MSG
(
”r
), (”r))

	)

60 #iâdeà
DEF_WBITS


61 
	#DEF_WBITS
 
MAX_WBITS


	)

65 #ià
MAX_MEM_LEVEL
 >= 8

66 
	#DEF_MEM_LEVEL
 8

	)

68 
	#DEF_MEM_LEVEL
 
MAX_MEM_LEVEL


	)

72 
	#STORED_BLOCK
 0

	)

73 
	#STATIC_TREES
 1

	)

74 
	#DYN_TREES
 2

	)

77 
	#MIN_MATCH
 3

	)

78 
	#MAX_MATCH
 258

	)

81 
	#PRESET_DICT
 0x20

	)

85 #ià
defšed
(
MSDOS
è|| (defšed(
WINDOWS
è&& !defšed(
WIN32
))

86 
	#OS_CODE
 0x00

	)

87 #iâdeà
Z_SOLO


88 #ià
defšed
(
__TURBOC__
è|| defšed(
__BORLANDC__
)

89 #ià(
__STDC__
 =ð1è&& (
defšed
(
__LARGE__
è|| defšed(
__COMPACT__
))

91 
_Cdeþ
 
çrä“
Ð*
block
 );

92 *
_Cdeþ
 
çrm®loc
Ð
nby‹s
 );

94 
	~<®loc.h
>

97 
	~<m®loc.h
>

102 #ifdeà
AMIGA


103 
	#OS_CODE
 1

	)

106 #ià
defšed
(
VAXC
è|| defšed(
VMS
)

107 
	#OS_CODE
 2

	)

108 
	#F_OPEN
(
Çme
, 
mode
) \

109 
	`fÝ’
((
Çme
), (
mode
), "mbc=60", "ùx=¡m", "rfm=fix", "mrs=512")

	)

112 #ifdeà
__370__


113 #ià
__TARGET_LIB__
 < 0x20000000

114 
	#OS_CODE
 4

	)

115 #–ià
__TARGET_LIB__
 < 0x40000000

116 
	#OS_CODE
 11

	)

118 
	#OS_CODE
 8

	)

122 #ià
defšed
(
ATARI
è|| defšed(
©¬i¡
)

123 
	#OS_CODE
 5

	)

126 #ifdeà
OS2


127 
	#OS_CODE
 6

	)

128 #ià
defšed
(
M_I86
è&& !defšed(
Z_SOLO
)

129 
	~<m®loc.h
>

133 #ià
defšed
(
MACOS
è|| defšed(
TARGET_OS_MAC
)

134 
	#OS_CODE
 7

	)

135 #iâdeà
Z_SOLO


136 #ià
defšed
(
__MWERKS__
è&& 
__de¡_os
 !ð
__be_os
 && __de¡_o !ð
__wš32_os


137 
	~<unix.h
>

139 #iâdeà
fdÝ’


140 
	#fdÝ’
(
fd
,
mode
è
NULL


	)

146 #ifdeà
__acÜn


147 
	#OS_CODE
 13

	)

150 #ià
defšed
(
WIN32
è&& !defšed(
__CYGWIN__
)

151 
	#OS_CODE
 10

	)

154 #ifdeà
_BEOS_


155 
	#OS_CODE
 16

	)

158 #ifdeà
__TOS_OS400__


159 
	#OS_CODE
 18

	)

162 #ifdeà
__APPLE__


163 
	#OS_CODE
 19

	)

166 #ià
defšed
(
_BEOS_
è|| defšed(
RISCOS
)

167 
	#fdÝ’
(
fd
,
mode
è
NULL


	)

170 #ià(
defšed
(
_MSC_VER
è&& (_MSC_VER > 600)è&& !defšed 
__INTERIX


171 #ià
defšed
(
_WIN32_WCE
)

172 
	#fdÝ’
(
fd
,
mode
è
NULL


	)

173 #iâdeà
_PTRDIFF_T_DEFINED


174 
	t±rdiff_t
;

175 
	#_PTRDIFF_T_DEFINED


	)

178 
	#fdÝ’
(
fd
,
ty³
è
	`_fdÝ’
(fd,ty³)

	)

182 #ià
defšed
(
__BORLANDC__
è&& !defšed(
MSDOS
)

183 #´agm¨
w¬n
 -8004

184 #´agm¨
w¬n
 -8008

185 #´agm¨
w¬n
 -8066

189 #ià!
defšed
(
_WIN32
) && \

190 (!
defšed
(
_LARGEFILE64_SOURCE
è|| 
	g_LFS64_LARGEFILE
-0 == 0)

191 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
adËr32_combše64
 
OF
((uLÚg, uLÚg, 
z_off_t
));

192 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
üc32_combše64
 
OF
((uLÚg, uLÚg, 
z_off_t
));

197 #iâdeà
OS_CODE


198 
	#OS_CODE
 3

	)

201 #iâdeà
F_OPEN


202 
	#F_OPEN
(
Çme
, 
mode
è
	`fÝ’
(Òame), (mode))

	)

207 #ià
defšed
(
pyr
è|| defšed(
Z_SOLO
)

208 
	#NO_MEMCPY


	)

210 #ià
defšed
(
SMALL_MEDIUM
è&& !defšed(
_MSC_VER
è&& !defšed(
__SC__
)

215 
	#NO_MEMCPY


	)

217 #ià
defšed
(
STDC
è&& !defšed(
HAVE_MEMCPY
è&& !defšed(
NO_MEMCPY
)

218 
	#HAVE_MEMCPY


	)

220 #ifdeà
HAVE_MEMCPY


221 #ifdeà
SMALL_MEDIUM


222 
	#zmemýy
 
_fmemýy


	)

223 
	#zmemcmp
 
_fmemcmp


	)

224 
	#zmemz”o
(
de¡
, 
Ën
è
	`_fmem£t
(de¡, 0,†’)

	)

226 
	#zmemýy
 
memýy


	)

227 
	#zmemcmp
 
memcmp


	)

228 
	#zmemz”o
(
de¡
, 
Ën
è
	`mem£t
(de¡, 0,†’)

	)

231 
ZLIB_INTERNAL
 
zmemýy
 
OF
((
By‹f
* 
de¡
, cÚ¡ By‹f* 
sourû
, 
uIÁ
 
Ën
));

232 
ZLIB_INTERNAL
 
zmemcmp
 
OF
((cÚ¡ 
By‹f
* 
s1
, cÚ¡ By‹f* 
s2
, 
uIÁ
 
Ën
));

233 
ZLIB_INTERNAL
 
zmemz”o
 
OF
((
By‹f
* 
de¡
, 
uIÁ
 
Ën
));

237 #ifdeà
ZLIB_DEBUG


238 
	~<¡dio.h
>

239 
ZLIB_INTERNAL
 
z_v”bo£
;

240 
ZLIB_INTERNAL
 
z_”rÜ
 
OF
((*
m
));

241 
	#As£¹
(
cÚd
,
msg
è{if(!(cÚd)è
	`z_”rÜ
(msg);}

	)

242 
	#T¿û
(
x
è{ià(
z_v”bo£
>=0è
årštf
 x ;}

	)

243 
	#T¿ûv
(
x
è{ià(
z_v”bo£
>0è
årštf
 x ;}

	)

244 
	#T¿ûvv
(
x
è{ià(
z_v”bo£
>1è
årštf
 x ;}

	)

245 
	#T¿ûc
(
c
,
x
è{ià(
z_v”bo£
>0 && (c)è
årštf
 x ;}

	)

246 
	#T¿ûcv
(
c
,
x
è{ià(
z_v”bo£
>1 && (c)è
årštf
 x ;}

	)

248 
	#As£¹
(
cÚd
,
msg
)

	)

249 
	#T¿û
(
x
)

	)

250 
	#T¿ûv
(
x
)

	)

251 
	#T¿ûvv
(
x
)

	)

252 
	#T¿ûc
(
c
,
x
)

	)

253 
	#T¿ûcv
(
c
,
x
)

	)

256 #iâdeà
Z_SOLO


257 
voidpf
 
ZLIB_INTERNAL
 
zÿÎoc
 
OF
((voidpà
Ýaque
, 
™ems
,

258 
size
));

259 
ZLIB_INTERNAL
 
zcä“
 
OF
((
voidpf
 
Ýaque
, voidpà
±r
));

262 
	#ZALLOC
(
¡rm
, 
™ems
, 
size
) \

263 (*((
¡rm
)->
z®loc
))((¡rm)->
Ýaque
, (
™ems
), (
size
))

	)

264 
	#ZFREE
(
¡rm
, 
addr
è(*((¡rm)->
zä“
))((¡rm)->
Ýaque
, (
voidpf
)×ddr))

	)

265 
	#TRY_FREE
(
s
, 
p
è{iàÕè
	`ZFREE
(s,…);}

	)

268 
	#ZSWAP32
(
q
) ((((q) >> 24) & 0xff) + (((q) >> 8) & 0xff00) + \

269 (((
q
è& 0xff00è<< 8è+ (((qè& 0xffè<< 24))

	)

	@
1
.
0
222
5699
client/ma_plugin_info.c
cmake/libressl_version.c
include/errmsg.h
include/ma_common.h
include/ma_context.h
include/ma_crypt.h
include/ma_global.h
include/ma_hash.h
include/ma_list.h
include/ma_priv.h
include/ma_pthread.h
include/ma_pvio.h
include/ma_server_error.h
include/ma_sha1.h
include/ma_string.h
include/ma_sys.h
include/ma_tls.h
include/mariadb/ma_io.h
include/mariadb_async.h
include/mariadb_com.h
include/mariadb_ctype.h
include/mariadb_dyncol.h
include/mariadb_rpl.h
include/mariadb_stmt.h
include/mysql.h
include/mysql/client_plugin.h
include/mysql/plugin_auth.h
include/mysql/plugin_auth_common.h
include/mysqld_error.h
libmariadb/bmove_upp.c
libmariadb/get_password.c
libmariadb/ma_alloc.c
libmariadb/ma_array.c
libmariadb/ma_charset.c
libmariadb/ma_compress.c
libmariadb/ma_context.c
libmariadb/ma_default.c
libmariadb/ma_dtoa.c
libmariadb/ma_errmsg.c
libmariadb/ma_hash.c
libmariadb/ma_init.c
libmariadb/ma_io.c
libmariadb/ma_list.c
libmariadb/ma_ll2str.c
libmariadb/ma_loaddata.c
libmariadb/ma_net.c
libmariadb/ma_password.c
libmariadb/ma_pvio.c
libmariadb/ma_sha1.c
libmariadb/ma_stmt_codec.c
libmariadb/ma_string.c
libmariadb/ma_time.c
libmariadb/ma_tls.c
libmariadb/mariadb_async.c
libmariadb/mariadb_charset.c
libmariadb/mariadb_dyncol.c
libmariadb/mariadb_lib.c
libmariadb/mariadb_rpl.c
libmariadb/mariadb_stmt.c
libmariadb/secure/gnutls.c
libmariadb/secure/gnutls_crypt.c
libmariadb/secure/ma_schannel.c
libmariadb/secure/ma_schannel.h
libmariadb/secure/openssl.c
libmariadb/secure/openssl_crypt.c
libmariadb/secure/schannel.c
libmariadb/secure/schannel_certs.c
libmariadb/secure/schannel_certs.h
libmariadb/secure/win_crypt.c
libmariadb/win32_errmsg.c
libmariadb/win32_errmsg.h
plugins/auth/auth_gssapi_client.c
plugins/auth/caching_sha2_pw.c
plugins/auth/common.h
plugins/auth/dialog.c
plugins/auth/ed25519.c
plugins/auth/gssapi_client.c
plugins/auth/gssapi_errmsg.c
plugins/auth/gssapi_errmsg.h
plugins/auth/mariadb_cleartext.c
plugins/auth/my_auth.c
plugins/auth/old_password.c
plugins/auth/ref10/api.h
plugins/auth/ref10/base.h
plugins/auth/ref10/base2.h
plugins/auth/ref10/common.h
plugins/auth/ref10/crypto_hash_sha512.h
plugins/auth/ref10/crypto_int32.h
plugins/auth/ref10/crypto_int64.h
plugins/auth/ref10/crypto_sign.h
plugins/auth/ref10/crypto_uint32.h
plugins/auth/ref10/crypto_uint64.h
plugins/auth/ref10/crypto_verify.h
plugins/auth/ref10/crypto_verify_32.h
plugins/auth/ref10/d.h
plugins/auth/ref10/d2.h
plugins/auth/ref10/fe.h
plugins/auth/ref10/fe_0.c
plugins/auth/ref10/fe_1.c
plugins/auth/ref10/fe_add.c
plugins/auth/ref10/fe_cmov.c
plugins/auth/ref10/fe_copy.c
plugins/auth/ref10/fe_frombytes.c
plugins/auth/ref10/fe_invert.c
plugins/auth/ref10/fe_isnegative.c
plugins/auth/ref10/fe_isnonzero.c
plugins/auth/ref10/fe_mul.c
plugins/auth/ref10/fe_neg.c
plugins/auth/ref10/fe_pow22523.c
plugins/auth/ref10/fe_sq.c
plugins/auth/ref10/fe_sq2.c
plugins/auth/ref10/fe_sub.c
plugins/auth/ref10/fe_tobytes.c
plugins/auth/ref10/ge.h
plugins/auth/ref10/ge_add.c
plugins/auth/ref10/ge_add.h
plugins/auth/ref10/ge_double_scalarmult.c
plugins/auth/ref10/ge_frombytes.c
plugins/auth/ref10/ge_madd.c
plugins/auth/ref10/ge_madd.h
plugins/auth/ref10/ge_msub.c
plugins/auth/ref10/ge_msub.h
plugins/auth/ref10/ge_p1p1_to_p2.c
plugins/auth/ref10/ge_p1p1_to_p3.c
plugins/auth/ref10/ge_p2_0.c
plugins/auth/ref10/ge_p2_dbl.c
plugins/auth/ref10/ge_p2_dbl.h
plugins/auth/ref10/ge_p3_0.c
plugins/auth/ref10/ge_p3_dbl.c
plugins/auth/ref10/ge_p3_to_cached.c
plugins/auth/ref10/ge_p3_to_p2.c
plugins/auth/ref10/ge_p3_tobytes.c
plugins/auth/ref10/ge_precomp_0.c
plugins/auth/ref10/ge_scalarmult_base.c
plugins/auth/ref10/ge_sub.c
plugins/auth/ref10/ge_sub.h
plugins/auth/ref10/ge_tobytes.c
plugins/auth/ref10/keypair.c
plugins/auth/ref10/open.c
plugins/auth/ref10/pow22523.h
plugins/auth/ref10/pow225521.h
plugins/auth/ref10/sc.h
plugins/auth/ref10/sc_muladd.c
plugins/auth/ref10/sc_reduce.c
plugins/auth/ref10/sign.c
plugins/auth/ref10/sqrtm1.h
plugins/auth/ref10/verify.c
plugins/auth/server_plugin.h
plugins/auth/sha256_pw.c
plugins/auth/sspi_client.c
plugins/auth/sspi_common.h
plugins/auth/sspi_errmsg.c
plugins/connection/aurora.c
plugins/connection/replication.c
plugins/io/remote_io.c
plugins/pvio/pvio_npipe.c
plugins/pvio/pvio_shmem.c
plugins/pvio/pvio_socket.c
plugins/trace/trace_example.c
unittest/libmariadb/async.c
unittest/libmariadb/basic-t.c
unittest/libmariadb/bulk1.c
unittest/libmariadb/charset.c
unittest/libmariadb/conc336.c
unittest/libmariadb/connection.c
unittest/libmariadb/cursor.c
unittest/libmariadb/dyncol.c
unittest/libmariadb/errors.c
unittest/libmariadb/features-10_2.c
unittest/libmariadb/fetch.c
unittest/libmariadb/getopt.c
unittest/libmariadb/logs.c
unittest/libmariadb/ma_getopt.c
unittest/libmariadb/ma_getopt.h
unittest/libmariadb/misc.c
unittest/libmariadb/my_test.h
unittest/libmariadb/performance.c
unittest/libmariadb/ps.c
unittest/libmariadb/ps_bugs.c
unittest/libmariadb/ps_new.c
unittest/libmariadb/result.c
unittest/libmariadb/rpl_api.c
unittest/libmariadb/sp.c
unittest/libmariadb/ssl.c
unittest/libmariadb/t_aurora.c
unittest/libmariadb/t_conc173.c
unittest/libmariadb/thread.c
unittest/libmariadb/view.c
unittest/mytap/t/basic-t.c
unittest/mytap/tap.c
unittest/mytap/tap.h
win-iconv/iconv.h
win-iconv/mlang.h
win-iconv/win_iconv.c
zlib/adler32.c
zlib/compress.c
zlib/crc32.c
zlib/crc32.h
zlib/deflate.c
zlib/deflate.h
zlib/example.c
zlib/gzclose.c
zlib/gzguts.h
zlib/gzlib.c
zlib/gzread.c
zlib/gzwrite.c
zlib/infback.c
zlib/inffast.c
zlib/inffast.h
zlib/inffixed.h
zlib/inflate.c
zlib/inflate.h
zlib/inftrees.c
zlib/inftrees.h
zlib/minigzip.c
zlib/trees.c
zlib/trees.h
zlib/uncompr.c
zlib/zconf.h
zlib/zlib.h
zlib/zutil.c
zlib/zutil.h
